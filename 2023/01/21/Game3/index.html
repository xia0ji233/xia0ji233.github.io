<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>游戏安全的学习（3） | xia0ji233's blog</title><meta name="author" content="xia0ji233"><meta name="copyright" content="xia0ji233"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="游戏安全的学习（3）—— SDK dump。 学这个的终极目标肯定是去搞原嘛，但是虽然⚪的保护比上不足但是比下有余啊。所以还是先从无保护的游戏入手，是之前很火的一个 3d 恐怖解谜游戏 Granny。">
<meta property="og:type" content="article">
<meta property="og:title" content="游戏安全的学习（3）">
<meta property="og:url" content="https://xia0ji233.github.io/2023/01/21/Game3/index.html">
<meta property="og:site_name" content="xia0ji233&#39;s blog">
<meta property="og:description" content="游戏安全的学习（3）—— SDK dump。 学这个的终极目标肯定是去搞原嘛，但是虽然⚪的保护比上不足但是比下有余啊。所以还是先从无保护的游戏入手，是之前很火的一个 3d 恐怖解谜游戏 Granny。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://xia0ji233.github.io/img/avatar.png">
<meta property="article:published_time" content="2023-01-21T06:00:00.000Z">
<meta property="article:modified_time" content="2024-04-09T05:23:09.852Z">
<meta property="article:author" content="xia0ji233">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://xia0ji233.github.io/img/avatar.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://xia0ji233.github.io/2023/01/21/Game3/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '游戏安全的学习（3）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-04-09 13:23:09'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="xia0ji233's blog" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">283</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">24</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">170</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heartbeat"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-history"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-bars"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/friends/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/backgroud.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="xia0ji233's blog"><span class="site-name">xia0ji233's blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heartbeat"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-history"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-bars"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/friends/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">游戏安全的学习（3）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-01-21T06:00:00.000Z" title="发表于 2023-01-21 14:00:00">2023-01-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-04-09T05:23:09.852Z" title="更新于 2024-04-09 13:23:09">2024-04-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Windows/">Windows</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Windows/GameSec/">GameSec</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>21分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="游戏安全的学习（3）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>游戏安全的学习（3）—— SDK dump。</p>
<p>学这个的终极目标肯定是去搞原嘛，但是虽然⚪的保护比上不足但是比下有余啊。所以还是先从无保护的游戏入手，是之前很火的一个 3d 恐怖解谜游戏 Granny。</p>
<span id="more"></span>



<h2 id="Unity引擎"><a href="#Unity引擎" class="headerlink" title="Unity引擎"></a>Unity引擎</h2><p>Unity 引擎是个很火的支持跨平台的游戏引擎，它主要的实现有 <code>il2cpp</code> 和 <code>mono</code> 两个工具来完成。</p>
<p>因此它生成的游戏中，就会隐含这两个工具其中一个的接口，通过这些接口，我们可以 dump 出所有这些基类的派生类，方法名，属性名，属性类型以及它们的偏移等等。</p>
<p>获取了这些东西之后，我们要对游戏 hook 就非常容易了。</p>
<h2 id="dump-mono-平台的符号"><a href="#dump-mono-平台的符号" class="headerlink" title="dump mono 平台的符号"></a>dump mono 平台的符号</h2><p>这里 CE 的源码其实实现了这些功能，对于一些基本的没有保护的游戏，我们就是一键 dump 符号。但是处出于学习的目的还是选择自己写一遍，复刻它 dump 的方法。</p>
<h3 id="dump准备"><a href="#dump准备" class="headerlink" title="dump准备"></a>dump准备</h3><p>这里选择 dll 注入然后获取模块列表，得到之后直接去寻找关键的函数。对于 Mono 平台来说，关键函数是 <code>mono_thread_attach</code>，而 <code>il2cpp</code> 的关键函数是 <code>il2cpp_thread_attach</code>。</p>
<p>先写一个注入器去注入 dll。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;TlHelp32.h&gt;</span></span></span><br><span class="line"><span class="function">DWORD <span class="title">FindProcess</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    HANDLE hSnap = <span class="built_in">CreateToolhelp32Snapshot</span>(TH32CS_SNAPPROCESS, <span class="number">0</span>);</span><br><span class="line">    PROCESSENTRY32 pe32;</span><br><span class="line">    pe32 = &#123; <span class="built_in">sizeof</span>(pe32) &#125;;</span><br><span class="line">    BOOL ret = <span class="built_in">Process32First</span>(hSnap, &amp;pe32);</span><br><span class="line">    <span class="keyword">while</span> (ret)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//wprintf(L&quot;%s\n&quot;, pe32.szExeFile);</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">wcsncmp</span>(pe<span class="number">32.</span>szExeFile, <span class="string">L&quot;Granny.exe&quot;</span>, <span class="number">11</span>)) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Find Granny.exe Process %d\n&quot;</span>, pe<span class="number">32.</span>th32ProcessID);</span><br><span class="line">            <span class="keyword">return</span> pe<span class="number">32.</span>th32ProcessID;</span><br><span class="line">        &#125;</span><br><span class="line">        ret = <span class="built_in">Process32Next</span>(hSnap, &amp;pe32);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">InjectModule</span><span class="params">(DWORD ProcessId, <span class="type">const</span> <span class="type">char</span>* szPath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    HANDLE hProcess = <span class="built_in">OpenProcess</span>(PROCESS_ALL_ACCESS, FALSE, ProcessId);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;进程句柄:%p\n&quot;</span>, hProcess);</span><br><span class="line">    LPVOID lpAddress = <span class="built_in">VirtualAllocEx</span>(hProcess, <span class="literal">NULL</span>, <span class="number">0x100</span>, MEM_COMMIT | MEM_RESERVE, PAGE_READWRITE);</span><br><span class="line">    SIZE_T dwWriteLength = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">WriteProcessMemory</span>(hProcess, lpAddress, szPath, <span class="built_in">strlen</span>(szPath), &amp;dwWriteLength);</span><br><span class="line">    HANDLE hThread = <span class="built_in">CreateRemoteThread</span>(hProcess, <span class="literal">NULL</span>, <span class="literal">NULL</span>, (LPTHREAD_START_ROUTINE)LoadLibraryA, lpAddress, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">WaitForSingleObject</span>(hThread, <span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">VirtualFreeEx</span>(hProcess, lpAddress, <span class="number">0</span>, MEM_RELEASE);</span><br><span class="line">    <span class="built_in">CloseHandle</span>(hProcess);</span><br><span class="line">    <span class="built_in">CloseHandle</span>(hThread);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, 112788);</span></span><br><span class="line">    <span class="comment">//TerminateProcess(hProcess, 0);</span></span><br><span class="line">    DWORD ProcessId = <span class="built_in">FindProcess</span>();</span><br><span class="line">    <span class="comment">//printf(&quot;HANDLE:%d\n&quot;, hProcess);</span></span><br><span class="line">    <span class="keyword">while</span> (!ProcessId) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;未找到Granny程序，等待两秒中再试\n&quot;</span>);</span><br><span class="line">        <span class="built_in">Sleep</span>(<span class="number">2000</span>);</span><br><span class="line">        ProcessId = <span class="built_in">FindProcess</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;开始注入进程...\n&quot;</span>);</span><br><span class="line">    <span class="built_in">InjectModule</span>(ProcessId, <span class="string">&quot;C:\\Users\\xia0ji233\\source\\repos\\Game3\\x64\\Debug\\GrannyConsole.dll&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;注入完毕\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后就是创建一个普通的 dll 去搞。</p>
<p>这里有一些小技巧，因为有些程序运行不带命令行，调试信息打印十分不方便，在 PROCESS ATTACH 的时候就可以使用以下代码创建一个终端。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">AllocConsole</span>();</span><br><span class="line"><span class="built_in">freopen</span>(<span class="string">&quot;CONOUT$&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout);</span><br></pre></td></tr></table></figure>

<p>然后就能用 printf 或者是 cout 去打印调试信息了。</p>
<p>先创建一个进程快照，然后遍历进程里的模块，找到指定函数之后获取该模块的模块句柄。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">HANDLE ths = <span class="built_in">CreateToolhelp32Snapshot</span>(TH32CS_SNAPMODULE, <span class="built_in">GetCurrentProcessId</span>());</span><br><span class="line"><span class="keyword">if</span> (ths != INVALID_HANDLE_VALUE)</span><br><span class="line">&#123;</span><br><span class="line">    MODULEENTRY32 me;</span><br><span class="line">    me.dwSize = <span class="built_in">sizeof</span>(me);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Module32First</span>(ths, &amp;me))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">GetProcAddress</span>(me.hModule, <span class="string">&quot;mono_thread_attach&quot;</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">wprintf</span>(<span class="string">L&quot;DLL：%s\n&quot;</span>, me.szExePath);</span><br><span class="line">                hMono = me.hModule;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">while</span> (<span class="built_in">Module32Next</span>(ths, &amp;me));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">CloseHandle</span>(ths);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>找到模块之后就可以初始化 Mono 平台的那些 api 了。</p>
<p>这里给出一下这些 api 的定义和获取：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">InitAPI</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    g_free = (G_FREE)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;g_free&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!g_free)</span><br><span class="line">        g_free = (G_FREE)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_unity_g_free&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    mono_free = (MONO_FREE)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_free&quot;</span>);</span><br><span class="line"></span><br><span class="line">    mono_get_root_domain = (MONO_GET_ROOT_DOMAIN)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_get_root_domain&quot;</span>);</span><br><span class="line">    mono_thread_attach = (MONO_THREAD_ATTACH)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_thread_attach&quot;</span>);</span><br><span class="line">    mono_thread_detach = (MONO_THREAD_DETACH)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_thread_detach&quot;</span>);</span><br><span class="line">    mono_thread_cleanup = (MONO_THREAD_CLEANUP)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_thread_cleanup&quot;</span>);</span><br><span class="line"></span><br><span class="line">    mono_object_get_class = (MONO_OBJECT_GET_CLASS)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_object_get_class&quot;</span>);</span><br><span class="line"></span><br><span class="line">    mono_domain_foreach = (MONO_DOMAIN_FOREACH)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_domain_foreach&quot;</span>);</span><br><span class="line">    mono_domain_set = (MONO_DOMAIN_SET)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_domain_set&quot;</span>);</span><br><span class="line">    mono_domain_get = (MONO_DOMAIN_GET)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_domain_get&quot;</span>);</span><br><span class="line">    mono_assembly_foreach = (MONO_ASSEMBLY_FOREACH)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_assembly_foreach&quot;</span>);</span><br><span class="line">    mono_assembly_get_image = (MONO_ASSEMBLY_GET_IMAGE)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_assembly_get_image&quot;</span>);</span><br><span class="line">    mono_image_get_assembly = (MONO_IMAGE_GET_ASSEMBLY)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_image_get_assembly&quot;</span>);</span><br><span class="line"></span><br><span class="line">    mono_image_get_name = (MONO_IMAGE_GET_NAME)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_image_get_name&quot;</span>);</span><br><span class="line">    mono_image_get_filename = (MONO_IMAGE_GET_FILENAME)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_image_get_filename&quot;</span>);</span><br><span class="line"></span><br><span class="line">    mono_image_get_table_info = (MONO_IMAGE_GET_TABLE_INFO)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_image_get_table_info&quot;</span>);</span><br><span class="line">    mono_image_rva_map = (MONO_IMAGE_RVA_MAP)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_image_rva_map&quot;</span>);</span><br><span class="line"></span><br><span class="line">    mono_table_info_get_rows = (MONO_TABLE_INFO_GET_ROWS)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_table_info_get_rows&quot;</span>);</span><br><span class="line">    mono_metadata_decode_row_col = (MONO_METADATA_DECODE_ROW_COL)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_metadata_decode_row_col&quot;</span>);</span><br><span class="line">    mono_metadata_string_heap = (MONO_METADATA_STRING_HEAP)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_metadata_string_heap&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    mono_class_get = (MONO_CLASS_GET)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_class_get&quot;</span>);</span><br><span class="line">    mono_class_from_typeref = (MONO_CLASS_FROM_TYPEREF)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_class_from_typeref&quot;</span>);</span><br><span class="line">    mono_class_name_from_token = (MONO_CLASS_NAME_FROM_TOKEN)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_class_name_from_token&quot;</span>);</span><br><span class="line">    mono_class_from_name_case = (MONO_CLASS_FROM_NAME_CASE)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_class_from_name_case&quot;</span>);</span><br><span class="line">    mono_class_from_name = (MONO_CLASS_FROM_NAME_CASE)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_class_from_name&quot;</span>);</span><br><span class="line">    mono_class_get_name = (MONO_CLASS_GET_NAME)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_class_get_name&quot;</span>);</span><br><span class="line">    mono_class_get_namespace = (MONO_CLASS_GET_NAMESPACE)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_class_get_namespace&quot;</span>);</span><br><span class="line">    mono_class_get_methods = (MONO_CLASS_GET_METHODS)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_class_get_methods&quot;</span>);</span><br><span class="line">    mono_class_get_method_from_name = (MONO_CLASS_GET_METHOD_FROM_NAME)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_class_get_method_from_name&quot;</span>);</span><br><span class="line">    mono_class_get_fields = (MONO_CLASS_GET_FIELDS)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_class_get_fields&quot;</span>);</span><br><span class="line">    mono_class_get_parent = (MONO_CLASS_GET_PARENT)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_class_get_parent&quot;</span>);</span><br><span class="line">    mono_class_get_image = (MONO_CLASS_GET_IMAGE)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_class_get_image&quot;</span>);</span><br><span class="line">    mono_class_is_generic = (MONO_CLASS_IS_GENERIC)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_class_is_generic&quot;</span>);</span><br><span class="line">    mono_class_vtable = (MONO_CLASS_VTABLE)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_class_vtable&quot;</span>);</span><br><span class="line">    mono_class_from_mono_type = (MONO_CLASS_FROM_MONO_TYPE)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_class_from_mono_type&quot;</span>);</span><br><span class="line">    mono_class_get_element_class = (MONO_CLASS_GET_ELEMENT_CLASS)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_class_get_element_class&quot;</span>);</span><br><span class="line">    mono_class_instance_size = (MONO_CLASS_INSTANCE_SIZE)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_class_instance_size&quot;</span>);</span><br><span class="line"></span><br><span class="line">    mono_class_num_fields = (MONO_CLASS_NUM_FIELDS)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_class_num_fields&quot;</span>);</span><br><span class="line">    mono_class_num_methods = (MONO_CLASS_NUM_METHODS)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_class_num_methods&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    mono_field_get_name = (MONO_FIELD_GET_NAME)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_field_get_name&quot;</span>);</span><br><span class="line">    mono_field_get_type = (MONO_FIELD_GET_TYPE)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_field_get_type&quot;</span>);</span><br><span class="line">    mono_field_get_parent = (MONO_FIELD_GET_PARENT)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_field_get_parent&quot;</span>);</span><br><span class="line">    mono_field_get_offset = (MONO_FIELD_GET_OFFSET)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_field_get_offset&quot;</span>);</span><br><span class="line">    mono_field_get_flags = (MONO_FIELD_GET_FLAGS)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_field_get_flags&quot;</span>);</span><br><span class="line"></span><br><span class="line">    mono_type_get_name = (MONO_TYPE_GET_NAME)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_type_get_name&quot;</span>);</span><br><span class="line">    mono_type_get_type = (MONO_TYPE_GET_TYPE)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_type_get_type&quot;</span>);</span><br><span class="line">    mono_type_get_name_full = (MONO_TYPE_GET_NAME_FULL)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_type_get_name_full&quot;</span>);</span><br><span class="line"></span><br><span class="line">    mono_method_get_name = (MONO_METHOD_GET_NAME)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_method_get_name&quot;</span>);</span><br><span class="line">    mono_method_get_class = (MONO_METHOD_GET_CLASS)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_method_get_class&quot;</span>);</span><br><span class="line">    mono_method_get_header = (MONO_METHOD_GET_HEADER)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_method_get_header&quot;</span>);</span><br><span class="line">    mono_method_get_flags = (MONO_METHOD_GET_FLAGS)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_method_get_flags&quot;</span>);</span><br><span class="line">    mono_method_signature = (MONO_METHOD_SIG)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_method_signature&quot;</span>);</span><br><span class="line">    mono_method_get_param_names = (MONO_METHOD_GET_PARAM_NAMES)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_method_get_param_names&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    mono_signature_get_desc = (MONO_SIGNATURE_GET_DESC)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_signature_get_desc&quot;</span>);</span><br><span class="line">    mono_signature_get_params = (MONO_SIGNATURE_GET_PARAMS)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_signature_get_params&quot;</span>);</span><br><span class="line">    mono_signature_get_param_count = (MONO_SIGNATURE_GET_PARAM_COUNT)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_signature_get_param_count&quot;</span>);</span><br><span class="line">    mono_signature_get_return_type = (MONO_SIGNATURE_GET_RETURN_TYPE)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_signature_get_return_type&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    mono_compile_method = (MONO_COMPILE_METHOD)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_compile_method&quot;</span>);</span><br><span class="line">    mono_free_method = (MONO_FREE_METHOD)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_free_method&quot;</span>);</span><br><span class="line">    mono_jit_info_table_find = (MONO_JIT_INFO_TABLE_FIND)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_jit_info_table_find&quot;</span>);</span><br><span class="line">    mono_jit_info_get_method = (MONO_JIT_INFO_GET_METHOD)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_jit_info_get_method&quot;</span>);</span><br><span class="line">    mono_jit_info_get_code_start = (MONO_JIT_INFO_GET_CODE_START)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_jit_info_get_code_start&quot;</span>);</span><br><span class="line">    mono_jit_info_get_code_size = (MONO_JIT_INFO_GET_CODE_SIZE)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_jit_info_get_code_size&quot;</span>);</span><br><span class="line">    mono_jit_exec = (MONO_JIT_EXEC)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_jit_exec&quot;</span>);</span><br><span class="line"></span><br><span class="line">    mono_method_header_get_code = (MONO_METHOD_HEADER_GET_CODE)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_method_header_get_code&quot;</span>);</span><br><span class="line">    mono_disasm_code = (MONO_DISASM_CODE)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_disasm_code&quot;</span>);</span><br><span class="line"></span><br><span class="line">    mono_vtable_get_static_field_data = (MONO_VTABLE_GET_STATIC_FIELD_DATA)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_vtable_get_static_field_data&quot;</span>);</span><br><span class="line"></span><br><span class="line">    mono_method_desc_new = (MONO_METHOD_DESC_NEW)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_method_desc_new&quot;</span>);;</span><br><span class="line">    mono_method_desc_from_method = (MONO_METHOD_DESC_FROM_METHOD)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_method_desc_from_method&quot;</span>);;</span><br><span class="line">    mono_method_desc_free = (MONO_METHOD_DESC_FREE)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_method_desc_free&quot;</span>);;</span><br><span class="line"></span><br><span class="line">    mono_string_new = (MONO_STRING_NEW)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_string_new&quot;</span>);</span><br><span class="line">    mono_string_to_utf8 = (MONO_STRING_TO_UTF8)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_string_to_utf8&quot;</span>);</span><br><span class="line">    mono_array_new = (MONO_ARRAY_NEW)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_array_new&quot;</span>);</span><br><span class="line">    mono_value_box = (MONO_VALUE_BOX)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_value_box&quot;</span>);</span><br><span class="line">    mono_object_unbox = (MONO_OBJECT_UNBOX)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_object_unbox&quot;</span>);</span><br><span class="line">    mono_object_new = (MONO_OBJECT_NEW)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_object_new&quot;</span>);</span><br><span class="line"></span><br><span class="line">    mono_class_get_type = (MONO_CLASS_GET_TYPE)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_class_get_type&quot;</span>);</span><br><span class="line">    mono_class_get_nesting_type = (MONO_CLASS_GET_NESTING_TYPE)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_class_get_nesting_type&quot;</span>);</span><br><span class="line"></span><br><span class="line">    mono_method_desc_search_in_image = (MONO_METHOD_DESC_SEARCH_IN_IMAGE)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_method_desc_search_in_image&quot;</span>);</span><br><span class="line">    mono_runtime_invoke = (MONO_RUNTIME_INVOKE)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_runtime_invoke&quot;</span>);</span><br><span class="line">    mono_runtime_object_init = (MONO_RUNTIME_OBJECT_INIT)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_runtime_object_init&quot;</span>);</span><br><span class="line">    mono_assembly_name_new = (MONO_ASSEMBLY_NAME_NEW)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_assembly_name_new&quot;</span>);</span><br><span class="line">    mono_assembly_loaded = (MONO_ASSEMBLY_LOADED)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_assembly_loaded&quot;</span>);</span><br><span class="line">    mono_assembly_open = (MONO_ASSEMBLY_OPEN)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_assembly_open&quot;</span>);</span><br><span class="line">    mono_image_open = (MONO_IMAGE_OPEN)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_image_open&quot;</span>);</span><br><span class="line">    mono_field_static_get_value = (MONO_FIELD_STATIC_GET_VALUE)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_field_static_get_value&quot;</span>);</span><br><span class="line">    mono_field_static_set_value = (MONO_FIELD_STATIC_SET_VALUE)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_field_static_set_value&quot;</span>);</span><br><span class="line">    mono_runtime_is_shutting_down = (MONO_RUNTIME_IS_SHUTTING_DOWN)<span class="built_in">GetProcAddress</span>(hMono, <span class="string">&quot;mono_runtime_is_shutting_down&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后最好再新建一个头文件，把下面的定义放到里面，在 dllmain 中包含上这个头文件。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_INITMONO 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_OBJECT_GETCLASS 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_ENUMDOMAINS 2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_SETCURRENTDOMAIN 3</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_ENUMASSEMBLIES 4</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_GETIMAGEFROMASSEMBLY 5</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_GETIMAGENAME 6</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_ENUMCLASSESINIMAGE 7</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_ENUMFIELDSINCLASS 8</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_ENUMMETHODSINCLASS 9</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_COMPILEMETHOD 10</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_GETMETHODHEADER 11</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_GETMETHODHEADER_CODE 12</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_LOOKUPRVA 13</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_GETJITINFO 14</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_FINDCLASS 15</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_FINDMETHOD 16</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_GETMETHODNAME 17</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_GETMETHODCLASS 18</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_GETCLASSNAME 19</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_GETCLASSNAMESPACE 20</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_FREEMETHOD 21</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_TERMINATE 22</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_DISASSEMBLE 23</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_GETMETHODSIGNATURE 24</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_GETPARENTCLASS 25</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_GETSTATICFIELDADDRESSFROMCLASS 26</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_GETTYPECLASS 27</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_GETARRAYELEMENTCLASS 28</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_FINDMETHODBYDESC 29</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_INVOKEMETHOD 30</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_LOADASSEMBLY 31</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_GETFULLTYPENAME 32</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_OBJECT_NEW 33</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_OBJECT_INIT 34</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_GETVTABLEFROMCLASS 35</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_GETMETHODPARAMETERS 36</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_ISCLASSGENERIC 37</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_ISIL2CPP 38</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_FILLOPTIONALFUNCTIONLIST 39</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_GETSTATICFIELDVALUE 40</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_SETSTATICFIELDVALUE 41</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_GETCLASSIMAGE 42</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_FREE 43</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_GETIMAGEFILENAME 44</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MONOCMD_GETCLASSNESTINGTYPE 45</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;&#125; MonoType;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;&#125; MonoMethodSignature;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* gpointer;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span><span class="params">(__cdecl* MonoDomainFunc)</span> <span class="params">(<span class="type">void</span>* domain, <span class="type">void</span>* user_data)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span><span class="params">(__cdecl* GFunc)</span>          <span class="params">(<span class="type">void</span>* data, <span class="type">void</span>* user_data)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span><span class="params">(__cdecl* G_FREE)</span><span class="params">(<span class="type">void</span>* ptr)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_GET_ROOT_DOMAIN)(<span class="type">void</span>);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_THREAD_ATTACH)(<span class="type">void</span>* domain);</span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span><span class="params">(__cdecl* MONO_THREAD_DETACH)</span><span class="params">(<span class="type">void</span>* monothread)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span><span class="params">(__cdecl* MONO_THREAD_CLEANUP)</span><span class="params">(<span class="type">void</span>)</span></span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_OBJECT_GET_CLASS)(<span class="type">void</span>* object);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span><span class="params">(__cdecl* MONO_DOMAIN_FOREACH)</span><span class="params">(MonoDomainFunc func, <span class="type">void</span>* user_data)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span><span class="params">(__cdecl* MONO_DOMAIN_SET)</span><span class="params">(<span class="type">void</span>* domain, BOOL force)</span></span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_DOMAIN_GET)();</span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span><span class="params">(__cdecl* MONO_ASSEMBLY_FOREACH)</span><span class="params">(GFunc func, <span class="type">void</span>* user_data)</span></span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_ASSEMBLY_GET_IMAGE)(<span class="type">void</span>* assembly);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_ASSEMBLY_OPEN)(<span class="type">void</span>* fname, <span class="type">int</span>* status);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_IMAGE_GET_ASSEMBLY)(<span class="type">void</span>* image);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">char</span>* (__cdecl* MONO_IMAGE_GET_NAME)(<span class="type">void</span>* image);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_IMAGE_OPEN)(<span class="type">const</span> <span class="type">char</span>* fname, <span class="type">int</span>* status);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">char</span>* (__cdecl* MONO_IMAGE_GET_FILENAME)(<span class="type">void</span>* image);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_IMAGE_GET_TABLE_INFO)(<span class="type">void</span>* image, <span class="type">int</span> table_id);</span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span><span class="params">(__cdecl* MONO_TABLE_INFO_GET_ROWS)</span><span class="params">(<span class="type">void</span>* tableinfo)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span><span class="params">(__cdecl* MONO_METADATA_DECODE_ROW_COL)</span><span class="params">(<span class="type">void</span>* tableinfo, <span class="type">int</span> idx, <span class="type">unsigned</span> <span class="type">int</span> col)</span></span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">char</span>* (__cdecl* MONO_METADATA_STRING_HEAP)(<span class="type">void</span>* image, UINT32 index);</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_CLASS_FROM_NAME_CASE)(<span class="type">void</span>* image, <span class="type">char</span>* name_space, <span class="type">char</span>* name);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_CLASS_FROM_NAME)(<span class="type">void</span>* image, <span class="type">char</span>* name_space, <span class="type">char</span>* name);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">char</span>* (__cdecl* MONO_CLASS_GET_NAME)(<span class="type">void</span>* klass);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">char</span>* (__cdecl* MONO_CLASS_GET_NAMESPACE)(<span class="type">void</span>* klass);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_CLASS_GET)(<span class="type">void</span>* image, UINT32 tokenindex);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_CLASS_FROM_TYPEREF)(<span class="type">void</span>* image, UINT32 type_token);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">char</span>* (__cdecl* MONO_CLASS_NAME_FROM_TOKEN)(<span class="type">void</span>* image, UINT32 token);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_CLASS_GET_PROPERTIES)(<span class="type">void</span>* klass, <span class="type">void</span>* iter);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_CLASS_GET_METHODS)(<span class="type">void</span>* klass, <span class="type">void</span>* iter);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_CLASS_GET_METHOD_FROM_NAME)(<span class="type">void</span>* klass, <span class="type">char</span>* methodname, <span class="type">int</span> paramcount);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_CLASS_GET_FIELDS)(<span class="type">void</span>* klass, <span class="type">void</span>* iter);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_CLASS_GET_PARENT)(<span class="type">void</span>* klass);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_CLASS_GET_IMAGE)(<span class="type">void</span>* klass);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_CLASS_VTABLE)(<span class="type">void</span>* domain, <span class="type">void</span>* klass);</span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span><span class="params">(__cdecl* MONO_CLASS_INSTANCE_SIZE)</span><span class="params">(<span class="type">void</span>* klass)</span></span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_CLASS_FROM_MONO_TYPE)(<span class="type">void</span>* type);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_CLASS_GET_ELEMENT_CLASS)(<span class="type">void</span>* klass);</span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span><span class="params">(__cdecl* MONO_CLASS_IS_GENERIC)</span><span class="params">(<span class="type">void</span>* klass)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span><span class="params">(__cdecl* MONO_CLASS_NUM_FIELDS)</span><span class="params">(<span class="type">void</span>* klass)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span><span class="params">(__cdecl* MONO_CLASS_NUM_METHODS)</span><span class="params">(<span class="type">void</span>* klass)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">char</span>* (__cdecl* MONO_FIELD_GET_NAME)(<span class="type">void</span>* field);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_FIELD_GET_TYPE)(<span class="type">void</span>* field);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_FIELD_GET_PARENT)(<span class="type">void</span>* field);</span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span><span class="params">(__cdecl* MONO_FIELD_GET_OFFSET)</span><span class="params">(<span class="type">void</span>* field)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">char</span>* (__cdecl* MONO_TYPE_GET_NAME)(<span class="type">void</span>* type);</span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span><span class="params">(__cdecl* MONO_TYPE_GET_TYPE)</span><span class="params">(<span class="type">void</span>* type)</span></span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">char</span>* (__cdecl* MONO_TYPE_GET_NAME_FULL)(<span class="type">void</span>* type, <span class="type">int</span> format);</span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span><span class="params">(__cdecl* MONO_FIELD_GET_FLAGS)</span><span class="params">(<span class="type">void</span>* type)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">char</span>* (__cdecl* MONO_METHOD_GET_NAME)(<span class="type">void</span>* method);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_COMPILE_METHOD)(<span class="type">void</span>* method);</span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span><span class="params">(__cdecl* MONO_FREE_METHOD)</span><span class="params">(<span class="type">void</span>* method)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_JIT_INFO_TABLE_FIND)(<span class="type">void</span>* domain, <span class="type">void</span>* addr);</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_JIT_INFO_GET_METHOD)(<span class="type">void</span>* jitinfo);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_JIT_INFO_GET_CODE_START)(<span class="type">void</span>* jitinfo);</span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span><span class="params">(__cdecl* MONO_JIT_INFO_GET_CODE_SIZE)</span><span class="params">(<span class="type">void</span>* jitinfo)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span><span class="params">(__cdecl* MONO_JIT_EXEC)</span><span class="params">(<span class="type">void</span>* domain, <span class="type">void</span>* assembly, <span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_METHOD_GET_HEADER)(<span class="type">void</span>* method);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_METHOD_GET_CLASS)(<span class="type">void</span>* method);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_METHOD_SIG)(<span class="type">void</span>* method);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_METHOD_GET_PARAM_NAMES)(<span class="type">void</span>* method, <span class="type">const</span> <span class="type">char</span>** names);</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_METHOD_HEADER_GET_CODE)(<span class="type">void</span>* methodheader, UINT32* code_size, UINT32* max_stack);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">char</span>* (__cdecl* MONO_DISASM_CODE)(<span class="type">void</span>* dishelper, <span class="type">void</span>* method, <span class="type">void</span>* ip, <span class="type">void</span>* end);</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">char</span>* (__cdecl* MONO_SIGNATURE_GET_DESC)(<span class="type">void</span>* signature, <span class="type">int</span> include_namespace);</span><br><span class="line"><span class="keyword">typedef</span> MonoType* (__cdecl* MONO_SIGNATURE_GET_PARAMS)(MonoMethodSignature* sig, gpointer* iter);</span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span><span class="params">(__cdecl* MONO_SIGNATURE_GET_PARAM_COUNT)</span><span class="params">(<span class="type">void</span>* signature)</span></span>;</span><br><span class="line"><span class="keyword">typedef</span> MonoType* (__cdecl* MONO_SIGNATURE_GET_RETURN_TYPE)(<span class="type">void</span>* signature);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_IMAGE_RVA_MAP)(<span class="type">void</span>* image, UINT32 addr);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_VTABLE_GET_STATIC_FIELD_DATA)(<span class="type">void</span>* vtable);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_METHOD_DESC_NEW)(<span class="type">const</span> <span class="type">char</span>* name, <span class="type">int</span> include_namespace);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_METHOD_DESC_FROM_METHOD)(<span class="type">void</span>* method);</span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span><span class="params">(__cdecl* MONO_METHOD_DESC_FREE)</span><span class="params">(<span class="type">void</span>* desc)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_ASSEMBLY_NAME_NEW)(<span class="type">const</span> <span class="type">char</span>* name);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_ASSEMBLY_LOADED)(<span class="type">void</span>* aname);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_IMAGE_LOADED)(<span class="type">void</span>* aname);</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_STRING_NEW)(<span class="type">void</span>* domain, <span class="type">const</span> <span class="type">char</span>* text);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">char</span>* (__cdecl* MONO_STRING_TO_UTF8)(<span class="type">void</span>*);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_ARRAY_NEW)(<span class="type">void</span>* domain, <span class="type">void</span>* eclass, <span class="type">uintptr_t</span> n);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_OBJECT_TO_STRING)(<span class="type">void</span>* object, <span class="type">void</span>** exc);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_OBJECT_NEW)(<span class="type">void</span>* domain, <span class="type">void</span>* klass);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span><span class="params">(__cdecl* MONO_FREE)</span><span class="params">(<span class="type">void</span>*)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_METHOD_DESC_SEARCH_IN_IMAGE)(<span class="type">void</span>* desc, <span class="type">void</span>* image);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_RUNTIME_INVOKE)(<span class="type">void</span>* method, <span class="type">void</span>* obj, <span class="type">void</span>** params, <span class="type">void</span>** exc);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_RUNTIME_INVOKE_ARRAY)(<span class="type">void</span>* method, <span class="type">void</span>* obj, <span class="type">void</span>* params, <span class="type">void</span>** exc);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_RUNTIME_OBJECT_INIT)(<span class="type">void</span>* object);</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_FIELD_STATIC_GET_VALUE)(<span class="type">void</span>* vtable, <span class="type">void</span>* field, <span class="type">void</span>* output);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_FIELD_STATIC_SET_VALUE)(<span class="type">void</span>* vtable, <span class="type">void</span>* field, <span class="type">void</span>* input);</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* IL2CPP_FIELD_STATIC_GET_VALUE)(<span class="type">void</span>* field, <span class="type">void</span>* output);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* IL2CPP_FIELD_STATIC_SET_VALUE)(<span class="type">void</span>* field, <span class="type">void</span>* input);</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_VALUE_BOX)(<span class="type">void</span>* domain, <span class="type">void</span>* klass, <span class="type">void</span>* val);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_OBJECT_UNBOX)(<span class="type">void</span>* obj);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_CLASS_GET_TYPE)(<span class="type">void</span>* klass);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* MONO_CLASS_GET_NESTING_TYPE)(<span class="type">void</span>* klass);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//il2cpp:</span></span><br><span class="line"><span class="keyword">typedef</span> UINT_PTR* (__cdecl* IL2CPP_DOMAIN_GET_ASSEMBLIES)(<span class="type">void</span>* domain, SIZE_T* size);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span><span class="params">(__cdecl* IL2CPP_IMAGE_GET_CLASS_COUNT)</span><span class="params">(<span class="type">void</span>* image)</span></span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* IL2CPP_IMAGE_GET_CLASS)(<span class="type">void</span>* image, <span class="type">int</span> index);</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">char</span>* (__cdecl* IL2CPP_TYPE_GET_NAME)(<span class="type">void</span>* ptype);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">char</span>* (__cdecl* IL2CPP_TYPE_GET_ASSEMBLY_QUALIFIED_NAME)(<span class="type">void</span>* ptype);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span><span class="params">(__cdecl* IL2CPP_METHOD_GET_PARAM_COUNT)</span><span class="params">(<span class="type">void</span>* method)</span></span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">char</span>* (__cdecl* IL2CPP_METHOD_GET_PARAM_NAME)(<span class="type">void</span>* method, <span class="type">int</span> index);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* IL2CPP_METHOD_GET_PARAM)(<span class="type">void</span>* method, <span class="type">int</span> index);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* IL2CPP_METHOD_GET_RETURN_TYPE)(<span class="type">void</span>* method);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (__cdecl* IL2CPP_CLASS_FROM_TYPE)(<span class="type">void</span>* type);</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">wchar_t</span>* (__cdecl* IL2CPP_STRING_CHARS)(<span class="type">void</span>* stringobject);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">uint32_t</span><span class="params">(__cdecl* MONO_METHOD_GET_FLAGS)</span><span class="params">(<span class="type">void</span>* method, <span class="type">uint32_t</span>* iflags)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span><span class="params">(__cdecl* MONO_RUNTIME_IS_SHUTTING_DOWN)</span><span class="params">(<span class="type">void</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">G_FREE g_free;</span><br><span class="line">MONO_GET_ROOT_DOMAIN mono_get_root_domain;</span><br><span class="line">MONO_THREAD_ATTACH mono_thread_attach;</span><br><span class="line">MONO_THREAD_DETACH mono_thread_detach;</span><br><span class="line">MONO_THREAD_CLEANUP mono_thread_cleanup;</span><br><span class="line">MONO_OBJECT_GET_CLASS mono_object_get_class;</span><br><span class="line">MONO_CLASS_GET_NAME mono_class_get_name;</span><br><span class="line">MONO_CLASS_GET_NAMESPACE mono_class_get_namespace;</span><br><span class="line">MONO_CLASS_GET_PROPERTIES mono_class_get_properties;</span><br><span class="line">MONO_CLASS_GET_PARENT mono_class_get_parent;</span><br><span class="line">MONO_CLASS_GET_IMAGE mono_class_get_image;</span><br><span class="line">MONO_CLASS_VTABLE mono_class_vtable;</span><br><span class="line">MONO_CLASS_INSTANCE_SIZE mono_class_instance_size;</span><br><span class="line">MONO_CLASS_FROM_MONO_TYPE mono_class_from_mono_type;</span><br><span class="line">MONO_CLASS_IS_GENERIC mono_class_is_generic;</span><br><span class="line"></span><br><span class="line">MONO_DOMAIN_FOREACH mono_domain_foreach;</span><br><span class="line">MONO_DOMAIN_SET mono_domain_set;</span><br><span class="line">MONO_DOMAIN_GET mono_domain_get;</span><br><span class="line">MONO_ASSEMBLY_FOREACH mono_assembly_foreach;</span><br><span class="line">MONO_ASSEMBLY_GET_IMAGE mono_assembly_get_image;</span><br><span class="line">MONO_IMAGE_GET_ASSEMBLY mono_image_get_assembly;</span><br><span class="line">MONO_ASSEMBLY_OPEN mono_assembly_open;</span><br><span class="line"></span><br><span class="line">MONO_IMAGE_GET_NAME mono_image_get_name;</span><br><span class="line">MONO_IMAGE_GET_TABLE_INFO mono_image_get_table_info;</span><br><span class="line">MONO_IMAGE_GET_FILENAME mono_image_get_filename;</span><br><span class="line">MONO_IMAGE_RVA_MAP mono_image_rva_map;</span><br><span class="line">MONO_IMAGE_OPEN mono_image_open;</span><br><span class="line">MONO_IMAGE_LOADED mono_image_loaded;</span><br><span class="line"></span><br><span class="line">MONO_TABLE_INFO_GET_ROWS mono_table_info_get_rows;</span><br><span class="line">MONO_METADATA_DECODE_ROW_COL mono_metadata_decode_row_col;</span><br><span class="line">MONO_METADATA_STRING_HEAP mono_metadata_string_heap;</span><br><span class="line">MONO_CLASS_GET mono_class_get;</span><br><span class="line">MONO_CLASS_FROM_TYPEREF mono_class_from_typeref;</span><br><span class="line">MONO_CLASS_NAME_FROM_TOKEN mono_class_name_from_token;</span><br><span class="line"></span><br><span class="line">MONO_CLASS_FROM_NAME_CASE mono_class_from_name_case;</span><br><span class="line">MONO_CLASS_FROM_NAME mono_class_from_name;</span><br><span class="line"></span><br><span class="line">MONO_CLASS_NUM_FIELDS mono_class_num_fields;</span><br><span class="line">MONO_CLASS_GET_FIELDS mono_class_get_fields;</span><br><span class="line"></span><br><span class="line">MONO_CLASS_NUM_METHODS mono_class_num_methods;</span><br><span class="line">MONO_CLASS_GET_METHODS mono_class_get_methods;</span><br><span class="line"></span><br><span class="line">MONO_CLASS_GET_METHOD_FROM_NAME mono_class_get_method_from_name;</span><br><span class="line">MONO_CLASS_GET_ELEMENT_CLASS mono_class_get_element_class;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MONO_FIELD_GET_NAME mono_field_get_name;</span><br><span class="line">MONO_FIELD_GET_TYPE mono_field_get_type;</span><br><span class="line">MONO_FIELD_GET_PARENT mono_field_get_parent;</span><br><span class="line">MONO_FIELD_GET_OFFSET mono_field_get_offset;</span><br><span class="line"></span><br><span class="line">MONO_TYPE_GET_NAME mono_type_get_name;</span><br><span class="line">MONO_TYPE_GET_TYPE mono_type_get_type;</span><br><span class="line">MONO_TYPE_GET_NAME_FULL mono_type_get_name_full;</span><br><span class="line">MONO_FIELD_GET_FLAGS mono_field_get_flags;</span><br><span class="line"></span><br><span class="line">MONO_METHOD_GET_NAME mono_method_get_name;</span><br><span class="line">MONO_METHOD_GET_HEADER mono_method_get_header;</span><br><span class="line">MONO_METHOD_GET_CLASS mono_method_get_class;</span><br><span class="line">MONO_METHOD_SIG mono_method_signature;</span><br><span class="line">MONO_METHOD_GET_PARAM_NAMES mono_method_get_param_names;</span><br><span class="line"></span><br><span class="line">MONO_SIGNATURE_GET_DESC mono_signature_get_desc;</span><br><span class="line">MONO_SIGNATURE_GET_PARAMS mono_signature_get_params;</span><br><span class="line">MONO_SIGNATURE_GET_PARAM_COUNT mono_signature_get_param_count;</span><br><span class="line">MONO_SIGNATURE_GET_RETURN_TYPE mono_signature_get_return_type;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MONO_COMPILE_METHOD mono_compile_method;</span><br><span class="line">MONO_FREE_METHOD mono_free_method;</span><br><span class="line"></span><br><span class="line">MONO_JIT_INFO_TABLE_FIND mono_jit_info_table_find;</span><br><span class="line">MONO_JIT_INFO_GET_METHOD mono_jit_info_get_method;</span><br><span class="line">MONO_JIT_INFO_GET_CODE_START mono_jit_info_get_code_start;</span><br><span class="line">MONO_JIT_INFO_GET_CODE_SIZE mono_jit_info_get_code_size;</span><br><span class="line">MONO_JIT_EXEC mono_jit_exec;</span><br><span class="line"></span><br><span class="line">MONO_METHOD_HEADER_GET_CODE mono_method_header_get_code;</span><br><span class="line">MONO_DISASM_CODE mono_disasm_code;</span><br><span class="line"></span><br><span class="line">MONO_VTABLE_GET_STATIC_FIELD_DATA mono_vtable_get_static_field_data;</span><br><span class="line"></span><br><span class="line">MONO_METHOD_DESC_NEW mono_method_desc_new;</span><br><span class="line">MONO_METHOD_DESC_FROM_METHOD mono_method_desc_from_method;</span><br><span class="line">MONO_METHOD_DESC_FREE mono_method_desc_free;</span><br><span class="line">MONO_ASSEMBLY_NAME_NEW mono_assembly_name_new;</span><br><span class="line">MONO_ASSEMBLY_LOADED mono_assembly_loaded;</span><br><span class="line"></span><br><span class="line">MONO_STRING_NEW mono_string_new;</span><br><span class="line">MONO_STRING_TO_UTF8 mono_string_to_utf8;</span><br><span class="line">MONO_ARRAY_NEW mono_array_new;</span><br><span class="line">MONO_OBJECT_TO_STRING mono_object_to_string;</span><br><span class="line">MONO_OBJECT_NEW mono_object_new;</span><br><span class="line">MONO_FREE mono_free;</span><br><span class="line">MONO_VALUE_BOX mono_value_box;</span><br><span class="line">MONO_OBJECT_UNBOX mono_object_unbox;</span><br><span class="line">MONO_CLASS_GET_TYPE mono_class_get_type;</span><br><span class="line">MONO_CLASS_GET_NESTING_TYPE mono_class_get_nesting_type;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MONO_METHOD_DESC_SEARCH_IN_IMAGE mono_method_desc_search_in_image;</span><br><span class="line">MONO_RUNTIME_INVOKE mono_runtime_invoke;</span><br><span class="line">MONO_RUNTIME_OBJECT_INIT mono_runtime_object_init;</span><br><span class="line"></span><br><span class="line">MONO_FIELD_STATIC_GET_VALUE mono_field_static_get_value;</span><br><span class="line">MONO_FIELD_STATIC_SET_VALUE mono_field_static_set_value;</span><br><span class="line"></span><br><span class="line"><span class="comment">//il2cpp</span></span><br><span class="line">IL2CPP_FIELD_STATIC_GET_VALUE il2cpp_field_static_get_value;</span><br><span class="line">IL2CPP_FIELD_STATIC_SET_VALUE il2cpp_field_static_set_value;</span><br><span class="line"></span><br><span class="line">IL2CPP_DOMAIN_GET_ASSEMBLIES il2cpp_domain_get_assemblies;</span><br><span class="line"></span><br><span class="line">IL2CPP_IMAGE_GET_CLASS_COUNT il2cpp_image_get_class_count;</span><br><span class="line">IL2CPP_IMAGE_GET_CLASS il2cpp_image_get_class;</span><br><span class="line"></span><br><span class="line">IL2CPP_TYPE_GET_NAME il2cpp_type_get_name;</span><br><span class="line">IL2CPP_TYPE_GET_ASSEMBLY_QUALIFIED_NAME il2cpp_type_get_assembly_qualified_name;</span><br><span class="line"></span><br><span class="line">IL2CPP_METHOD_GET_PARAM_COUNT il2cpp_method_get_param_count;</span><br><span class="line">IL2CPP_METHOD_GET_PARAM_NAME il2cpp_method_get_param_name;</span><br><span class="line">IL2CPP_METHOD_GET_PARAM il2cpp_method_get_param;</span><br><span class="line">IL2CPP_METHOD_GET_RETURN_TYPE il2cpp_method_get_return_type;</span><br><span class="line">IL2CPP_CLASS_FROM_TYPE il2cpp_class_from_type;</span><br><span class="line">IL2CPP_STRING_CHARS il2cpp_string_chars;</span><br><span class="line">MONO_METHOD_GET_FLAGS mono_method_get_flags;</span><br><span class="line">MONO_RUNTIME_IS_SHUTTING_DOWN mono_runtime_is_shutting_down;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">HMODULE hMono = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> &#123;</span><br><span class="line">    MONO_TYPE_END = <span class="number">0x00</span>,       <span class="comment">/* End of List */</span></span><br><span class="line">    MONO_TYPE_VOID = <span class="number">0x01</span>,</span><br><span class="line">    MONO_TYPE_BOOLEAN = <span class="number">0x02</span>,</span><br><span class="line">    MONO_TYPE_CHAR = <span class="number">0x03</span>,</span><br><span class="line">    MONO_TYPE_I1 = <span class="number">0x04</span>,</span><br><span class="line">    MONO_TYPE_U1 = <span class="number">0x05</span>,</span><br><span class="line">    MONO_TYPE_I2 = <span class="number">0x06</span>,</span><br><span class="line">    MONO_TYPE_U2 = <span class="number">0x07</span>,</span><br><span class="line">    MONO_TYPE_I4 = <span class="number">0x08</span>,</span><br><span class="line">    MONO_TYPE_U4 = <span class="number">0x09</span>,</span><br><span class="line">    MONO_TYPE_I8 = <span class="number">0x0a</span>,</span><br><span class="line">    MONO_TYPE_U8 = <span class="number">0x0b</span>,</span><br><span class="line">    MONO_TYPE_R4 = <span class="number">0x0c</span>,</span><br><span class="line">    MONO_TYPE_R8 = <span class="number">0x0d</span>,</span><br><span class="line">    MONO_TYPE_STRING = <span class="number">0x0e</span>,</span><br><span class="line">    MONO_TYPE_PTR = <span class="number">0x0f</span>,       <span class="comment">/* arg: &lt;type&gt; token */</span></span><br><span class="line">    MONO_TYPE_BYREF = <span class="number">0x10</span>,       <span class="comment">/* arg: &lt;type&gt; token */</span></span><br><span class="line">    MONO_TYPE_VALUETYPE = <span class="number">0x11</span>,       <span class="comment">/* arg: &lt;type&gt; token */</span></span><br><span class="line">    MONO_TYPE_CLASS = <span class="number">0x12</span>,       <span class="comment">/* arg: &lt;type&gt; token */</span></span><br><span class="line">    MONO_TYPE_VAR = <span class="number">0x13</span>,       <span class="comment">/* number */</span></span><br><span class="line">    MONO_TYPE_ARRAY = <span class="number">0x14</span>,       <span class="comment">/* type, rank, boundsCount, bound1, loCount, lo1 */</span></span><br><span class="line">    MONO_TYPE_GENERICINST = <span class="number">0x15</span>,       <span class="comment">/* &lt;type&gt; &lt;type-arg-count&gt; &lt;type-1&gt; \x&#123;2026&#125; &lt;type-n&gt; */</span></span><br><span class="line">    MONO_TYPE_TYPEDBYREF = <span class="number">0x16</span>,</span><br><span class="line">    MONO_TYPE_I = <span class="number">0x18</span>,</span><br><span class="line">    MONO_TYPE_U = <span class="number">0x19</span>,</span><br><span class="line">    MONO_TYPE_FNPTR = <span class="number">0x1b</span>,          <span class="comment">/* arg: full method signature */</span></span><br><span class="line">    MONO_TYPE_OBJECT = <span class="number">0x1c</span>,</span><br><span class="line">    MONO_TYPE_SZARRAY = <span class="number">0x1d</span>,       <span class="comment">/* 0-based one-dim-array */</span></span><br><span class="line">    MONO_TYPE_MVAR = <span class="number">0x1e</span>,       <span class="comment">/* number */</span></span><br><span class="line">    MONO_TYPE_CMOD_REQD = <span class="number">0x1f</span>,       <span class="comment">/* arg: typedef or typeref token */</span></span><br><span class="line">    MONO_TYPE_CMOD_OPT = <span class="number">0x20</span>,       <span class="comment">/* optional arg: typedef or typref token */</span></span><br><span class="line">    MONO_TYPE_INTERNAL = <span class="number">0x21</span>,       <span class="comment">/* CLR internal type */</span></span><br><span class="line"></span><br><span class="line">    MONO_TYPE_MODIFIER = <span class="number">0x40</span>,       <span class="comment">/* Or with the following types */</span></span><br><span class="line">    MONO_TYPE_SENTINEL = <span class="number">0x41</span>,       <span class="comment">/* Sentinel for varargs method signature */</span></span><br><span class="line">    MONO_TYPE_PINNED = <span class="number">0x45</span>,       <span class="comment">/* Local var that points to pinned object */</span></span><br><span class="line"></span><br><span class="line">    MONO_TYPE_ENUM = <span class="number">0x55</span>        <span class="comment">/* an enumeration */</span></span><br><span class="line">&#125; MonoTypeEnum;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> &#123;</span><br><span class="line">    MONO_TABLE_MODULE,</span><br><span class="line">    MONO_TABLE_TYPEREF,</span><br><span class="line">    MONO_TABLE_TYPEDEF,</span><br><span class="line">    MONO_TABLE_FIELD_POINTER,</span><br><span class="line">    MONO_TABLE_FIELD,</span><br><span class="line">    MONO_TABLE_METHOD_POINTER,</span><br><span class="line">    MONO_TABLE_METHOD,</span><br><span class="line">    MONO_TABLE_PARAM_POINTER,</span><br><span class="line">    MONO_TABLE_PARAM,</span><br><span class="line">    MONO_TABLE_INTERFACEIMPL,</span><br><span class="line">    MONO_TABLE_MEMBERREF, <span class="comment">/* 0xa */</span></span><br><span class="line">    MONO_TABLE_CONSTANT,</span><br><span class="line">    MONO_TABLE_CUSTOMATTRIBUTE,</span><br><span class="line">    MONO_TABLE_FIELDMARSHAL,</span><br><span class="line">    MONO_TABLE_DECLSECURITY,</span><br><span class="line">    MONO_TABLE_CLASSLAYOUT,</span><br><span class="line">    MONO_TABLE_FIELDLAYOUT, <span class="comment">/* 0x10 */</span></span><br><span class="line">    MONO_TABLE_STANDALONESIG,</span><br><span class="line">    MONO_TABLE_EVENTMAP,</span><br><span class="line">    MONO_TABLE_EVENT_POINTER,</span><br><span class="line">    MONO_TABLE_EVENT,</span><br><span class="line">    MONO_TABLE_PROPERTYMAP,</span><br><span class="line">    MONO_TABLE_PROPERTY_POINTER,</span><br><span class="line">    MONO_TABLE_PROPERTY,</span><br><span class="line">    MONO_TABLE_METHODSEMANTICS,</span><br><span class="line">    MONO_TABLE_METHODIMPL,</span><br><span class="line">    MONO_TABLE_MODULEREF, <span class="comment">/* 0x1a */</span></span><br><span class="line">    MONO_TABLE_TYPESPEC,</span><br><span class="line">    MONO_TABLE_IMPLMAP,</span><br><span class="line">    MONO_TABLE_FIELDRVA,</span><br><span class="line">    MONO_TABLE_UNUSED6,</span><br><span class="line">    MONO_TABLE_UNUSED7,</span><br><span class="line">    MONO_TABLE_ASSEMBLY, <span class="comment">/* 0x20 */</span></span><br><span class="line">    MONO_TABLE_ASSEMBLYPROCESSOR,</span><br><span class="line">    MONO_TABLE_ASSEMBLYOS,</span><br><span class="line">    MONO_TABLE_ASSEMBLYREF,</span><br><span class="line">    MONO_TABLE_ASSEMBLYREFPROCESSOR,</span><br><span class="line">    MONO_TABLE_ASSEMBLYREFOS,</span><br><span class="line">    MONO_TABLE_FILE,</span><br><span class="line">    MONO_TABLE_EXPORTEDTYPE,</span><br><span class="line">    MONO_TABLE_MANIFESTRESOURCE,</span><br><span class="line">    MONO_TABLE_NESTEDCLASS,</span><br><span class="line">    MONO_TABLE_GENERICPARAM, <span class="comment">/* 0x2a */</span></span><br><span class="line">    MONO_TABLE_METHODSPEC,</span><br><span class="line">    MONO_TABLE_GENERICPARAMCONSTRAINT</span><br><span class="line">&#125; MonoMetaTableEnum;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> &#123;</span><br><span class="line">    MONO_TYPEDEF_FLAGS,</span><br><span class="line">    MONO_TYPEDEF_NAME,</span><br><span class="line">    MONO_TYPEDEF_NAMESPACE,</span><br><span class="line">    MONO_TYPEDEF_EXTENDS,</span><br><span class="line">    MONO_TYPEDEF_FIELD_LIST,</span><br><span class="line">    MONO_TYPEDEF_METHOD_LIST,</span><br><span class="line">    MONO_TYPEDEF_SIZE</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> &#123;</span><br><span class="line">    MONO_METHOD_RVA,</span><br><span class="line">    MONO_METHOD_IMPLFLAGS,</span><br><span class="line">    MONO_METHOD_FLAGS,</span><br><span class="line">    MONO_METHOD_NAME,</span><br><span class="line">    MONO_METHOD_SIGNATURE,</span><br><span class="line">    MONO_METHOD_PARAMLIST,</span><br><span class="line">    MONO_METHOD_SIZE</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> &#123;</span><br><span class="line">    MONO_TOKEN_MODULE = <span class="number">0x00000000</span>,</span><br><span class="line">    MONO_TOKEN_TYPE_REF = <span class="number">0x01000000</span>,</span><br><span class="line">    MONO_TOKEN_TYPE_DEF = <span class="number">0x02000000</span>,</span><br><span class="line">    MONO_TOKEN_FIELD_DEF = <span class="number">0x04000000</span>,</span><br><span class="line">    MONO_TOKEN_METHOD_DEF = <span class="number">0x06000000</span>,</span><br><span class="line">    MONO_TOKEN_PARAM_DEF = <span class="number">0x08000000</span>,</span><br><span class="line">    MONO_TOKEN_INTERFACE_IMPL = <span class="number">0x09000000</span>,</span><br><span class="line">    MONO_TOKEN_MEMBER_REF = <span class="number">0x0a000000</span>,</span><br><span class="line">    MONO_TOKEN_CUSTOM_ATTRIBUTE = <span class="number">0x0c000000</span>,</span><br><span class="line">    MONO_TOKEN_PERMISSION = <span class="number">0x0e000000</span>,</span><br><span class="line">    MONO_TOKEN_SIGNATURE = <span class="number">0x11000000</span>,</span><br><span class="line">    MONO_TOKEN_EVENT = <span class="number">0x14000000</span>,</span><br><span class="line">    MONO_TOKEN_PROPERTY = <span class="number">0x17000000</span>,</span><br><span class="line">    MONO_TOKEN_MODULE_REF = <span class="number">0x1a000000</span>,</span><br><span class="line">    MONO_TOKEN_TYPE_SPEC = <span class="number">0x1b000000</span>,</span><br><span class="line">    MONO_TOKEN_ASSEMBLY = <span class="number">0x20000000</span>,</span><br><span class="line">    MONO_TOKEN_ASSEMBLY_REF = <span class="number">0x23000000</span>,</span><br><span class="line">    MONO_TOKEN_FILE = <span class="number">0x26000000</span>,</span><br><span class="line">    MONO_TOKEN_EXPORTED_TYPE = <span class="number">0x27000000</span>,</span><br><span class="line">    MONO_TOKEN_MANIFEST_RESOURCE = <span class="number">0x28000000</span>,</span><br><span class="line">    MONO_TOKEN_GENERIC_PARAM = <span class="number">0x2a000000</span>,</span><br><span class="line">    MONO_TOKEN_METHOD_SPEC = <span class="number">0x2b000000</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * These do not match metadata tables directly</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">     MONO_TOKEN_STRING = <span class="number">0x70000000</span>,</span><br><span class="line">     MONO_TOKEN_NAME = <span class="number">0x71000000</span>,</span><br><span class="line">     MONO_TOKEN_BASE_TYPE = <span class="number">0x72000000</span></span><br><span class="line">&#125; MonoTokenType;</span><br></pre></td></tr></table></figure>

<p>然后就是通过 API 去获取了，中间踩了很多坑。</p>
<p>第一就是在 <code>get main root</code> 之后，我们需要使用函数 <code>mono_thread_attach</code> 去进行线程的附加，不然出现的情况就是每个 image 你只能获取第一个类，后面的类获取不到。</p>
<p>第二是 如果抄 CE 的代码整合一定要注意循环变量不要定义重复了，这里就是内外循环写错了循环变量导致的指针获取一直是错误的，后面通过调试才发现问题。</p>
<img src="/2023/01/21/Game3/1.png" class="">

<p>这里是我写了<code>names[i]</code>，此时正在获取第一个参数，而我此时发现这行代码获取的下标竟然是 8（rax）的值。于是才明白是循环变量写错了。</p>
<img src="/2023/01/21/Game3/2.png" class="">

<p>第三是 在遍历方法和属性的时候一定要记得清空第二个参数的指针，不然会出现很难以理解的问题，如果抄着 CE 的代码导致的问题就是属性可以获取，方法获取很容易出错。</p>
<h3 id="dllmain代码"><a href="#dllmain代码" class="headerlink" title="dllmain代码"></a>dllmain代码</h3><p>以下是 mono 平台 dumpsdk的完整代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> _cdecl <span class="title">AssemblyEnumerator</span><span class="params">(<span class="type">void</span>* domain, vector&lt;UINT64&gt;* v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    v-&gt;<span class="built_in">push_back</span>((UINT_PTR)domain);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">WORD <span class="title">UTF8TOUTF16</span><span class="params">(<span class="type">char</span>* szUtf8)</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> (_WINDOWS &amp;&amp; (_MSC_VER &lt;= 1916))</span></span><br><span class="line">    std::wstring_convert&lt;std::codecvt_utf8&lt;<span class="type">wchar_t</span>&gt;, <span class="type">wchar_t</span>&gt; convert;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        std::wstring dest = convert.<span class="built_in">from_bytes</span>(szUtf8);</span><br><span class="line">        <span class="keyword">return</span> *(WORD*)&amp;dest[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">catch</span> (<span class="type">const</span> std::range_error&amp;) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    std::wstring_convert&lt;std::codecvt_utf8_utf16&lt;<span class="type">char16_t</span>&gt;, <span class="type">char16_t</span>&gt; convert;</span><br><span class="line">    std::u16string dest = convert.<span class="built_in">from_bytes</span>(szUtf8);</span><br><span class="line">    <span class="keyword">return</span> *(WORD*)&amp;dest[<span class="number">0</span>];</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dumpsdk</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    HANDLE ths = <span class="built_in">CreateToolhelp32Snapshot</span>(TH32CS_SNAPMODULE, <span class="built_in">GetCurrentProcessId</span>());</span><br><span class="line">    <span class="keyword">if</span> (ths != INVALID_HANDLE_VALUE)</span><br><span class="line">    &#123;</span><br><span class="line">        MODULEENTRY32 me;</span><br><span class="line">        me.dwSize = <span class="built_in">sizeof</span>(me);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">Module32First</span>(ths, &amp;me))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">do</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">GetProcAddress</span>(me.hModule, <span class="string">&quot;mono_thread_attach&quot;</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">wprintf</span>(<span class="string">L&quot;MODULE：%s\n&quot;</span>, me.szExePath);</span><br><span class="line">                    hMono = me.hModule;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">while</span> (<span class="built_in">Module32Next</span>(ths, &amp;me));</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">CloseHandle</span>(ths);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">InitAPI</span>();</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;API init down&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="type">int</span> status;</span><br><span class="line">    <span class="keyword">if</span> (!mono_get_root_domain) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;API init error\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">void</span>* domain = (<span class="type">void</span>*)<span class="built_in">mono_get_root_domain</span>();</span><br><span class="line">    <span class="type">void</span>* mono_selfthread = <span class="built_in">mono_thread_attach</span>(domain);<span class="comment">//出错点 1，一定要进行thread_attach</span></span><br><span class="line">    vector&lt;UINT64&gt;v;</span><br><span class="line">    <span class="built_in">mono_assembly_foreach</span>((GFunc)AssemblyEnumerator, &amp;v);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;module count:%d\n&quot;</span>, v.<span class="built_in">size</span>());</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> assembly : v) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">void</span> *image = <span class="built_in">mono_assembly_get_image</span>((<span class="type">void</span> *)assembly);</span><br><span class="line">        <span class="type">char</span>* s = <span class="built_in">mono_image_get_name</span>(image);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;module name: %s\n&quot;</span>, s);</span><br><span class="line">        <span class="type">void</span>* tdef = <span class="built_in">mono_image_get_table_info</span>(image, MONO_TABLE_TYPEDEF);</span><br><span class="line">        <span class="keyword">if</span> (tdef) &#123;<span class="comment">//遍历类</span></span><br><span class="line">            <span class="type">int</span> tdefcount = <span class="built_in">mono_table_info_get_rows</span>(tdef);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;\tclass count:%d\n&quot;</span>, tdefcount);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;\tclass list:\n&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; tdefcount; i++) &#123;</span><br><span class="line">                <span class="type">void</span>* c = <span class="built_in">mono_class_get</span>(image, MONO_TOKEN_TYPE_DEF | (i + <span class="number">1</span>));</span><br><span class="line">                <span class="keyword">if</span> (c) &#123;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;c:%p\n&quot;</span>, c);</span><br><span class="line">                    <span class="type">void</span>* iter = <span class="literal">NULL</span>;</span><br><span class="line">                    <span class="type">void</span>* field = <span class="literal">NULL</span>;</span><br><span class="line">                    <span class="type">char</span>* name = <span class="built_in">mono_class_get_name</span>(c);</span><br><span class="line">                    <span class="type">char</span>* type;</span><br><span class="line">                    std::string sName = std::<span class="built_in">string</span>(name);</span><br><span class="line">                    <span class="keyword">if</span> ((BYTE)name[<span class="number">0</span>] == <span class="number">0xEE</span>) &#123;</span><br><span class="line">                        <span class="type">char</span> szUeName[<span class="number">32</span>];</span><br><span class="line">                        <span class="built_in">sprintf_s</span>(szUeName, <span class="number">32</span>, <span class="string">&quot;\\u%04X&quot;</span>, <span class="built_in">UTF8TOUTF16</span>(name));</span><br><span class="line">                        sName = szUeName;</span><br><span class="line">                    &#125;</span><br><span class="line">                    cout &lt;&lt; <span class="string">&quot;\t\t\tclass name: &quot;</span> &lt;&lt; sName &lt;&lt; endl;</span><br><span class="line">                    name = <span class="built_in">mono_class_get_namespace</span>(c);</span><br><span class="line">                    cout &lt;&lt; <span class="string">&quot;\t\t\t&quot;</span> &lt;&lt; <span class="string">&quot;field List&quot;</span> &lt;&lt; endl;</span><br><span class="line">                    <span class="keyword">do</span> &#123;<span class="comment">//遍历属性</span></span><br><span class="line">                        field = <span class="built_in">mono_class_get_fields</span>(c, &amp;iter);</span><br><span class="line">                        <span class="keyword">if</span> (field) &#123;</span><br><span class="line">                            <span class="type">void</span>* fieldtype = <span class="built_in">mono_field_get_type</span>(field);</span><br><span class="line">                            name = <span class="built_in">mono_field_get_name</span>(field);</span><br><span class="line">                            type = <span class="built_in">mono_type_get_name</span>(fieldtype);</span><br><span class="line">                            std::string sName = std::<span class="built_in">string</span>(name);</span><br><span class="line">                            std::string sType = std::<span class="built_in">string</span>(type);</span><br><span class="line">                            <span class="keyword">if</span> ((BYTE)name[<span class="number">0</span>] == <span class="number">0xEE</span>) &#123;</span><br><span class="line">                                <span class="type">char</span> szUeName[<span class="number">32</span>];</span><br><span class="line">                                <span class="built_in">sprintf_s</span>(szUeName, <span class="number">32</span>, <span class="string">&quot;\\u%04X&quot;</span>, <span class="built_in">UTF8TOUTF16</span>(name));</span><br><span class="line">                                sName = szUeName;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">if</span> ((BYTE)type[<span class="number">0</span>] == <span class="number">0xEE</span>) &#123;</span><br><span class="line">                                <span class="type">char</span> szUeName[<span class="number">32</span>];</span><br><span class="line">                                <span class="built_in">sprintf_s</span>(szUeName, <span class="number">32</span>, <span class="string">&quot;\\u%04X&quot;</span>, <span class="built_in">UTF8TOUTF16</span>(type));</span><br><span class="line">                                sType = szUeName;</span><br><span class="line">                            &#125;</span><br><span class="line">                            cout &lt;&lt; <span class="string">&quot;\t\t\t\t&quot;</span> &lt;&lt; sType &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; sName &lt;&lt; <span class="string">&quot;;&quot;</span> &lt;&lt; endl;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">while</span> (field);</span><br><span class="line">                    <span class="type">void</span>* method=<span class="literal">NULL</span>;</span><br><span class="line">                    iter = <span class="literal">NULL</span>;<span class="comment">//出错点3，一定要初始化</span></span><br><span class="line">                    cout &lt;&lt; <span class="string">&quot;\t\t\t&quot;</span> &lt;&lt; <span class="string">&quot;method:&quot;</span> &lt;&lt; endl;</span><br><span class="line">                    <span class="keyword">do</span> &#123;<span class="comment">//遍历方法</span></span><br><span class="line">                        method = <span class="built_in">mono_class_get_methods</span>(c, &amp;iter);</span><br><span class="line">                        <span class="comment">//printf(&quot;method: %p\n&quot;, method);</span></span><br><span class="line">                        <span class="keyword">if</span> (method) &#123;</span><br><span class="line">                            <span class="built_in">printf</span>(<span class="string">&quot;0x%p: &quot;</span>, method);</span><br><span class="line">                            <span class="type">uint32_t</span> flags;</span><br><span class="line">                            name = <span class="built_in">mono_method_get_name</span>(method);</span><br><span class="line">                            flags = <span class="built_in">mono_method_get_flags</span>(method, <span class="literal">NULL</span>);</span><br><span class="line">                            </span><br><span class="line">                            std::string sName = std::<span class="built_in">string</span>(name);</span><br><span class="line">                            <span class="keyword">if</span> ((BYTE)name[<span class="number">0</span>] == <span class="number">0xEE</span>) &#123;</span><br><span class="line">                                <span class="type">char</span> szUeName[<span class="number">32</span>];</span><br><span class="line">                                <span class="built_in">sprintf_s</span>(szUeName, <span class="number">32</span>, <span class="string">&quot;\\u%04X&quot;</span>, <span class="built_in">UTF8TOUTF16</span>(name));</span><br><span class="line">                                sName = szUeName;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="type">void</span>* methodsignature = <span class="built_in">mono_method_signature</span>(method);</span><br><span class="line">                            <span class="keyword">if</span> (methodsignature) &#123;</span><br><span class="line">                                MonoType* returntype = <span class="built_in">mono_signature_get_return_type</span>(methodsignature);</span><br><span class="line">                                <span class="type">char</span>* returntypename = <span class="built_in">mono_type_get_name</span>(returntype);</span><br><span class="line">                                <span class="type">int</span> paramcount = <span class="built_in">mono_signature_get_param_count</span>(methodsignature);</span><br><span class="line">                                <span class="type">char</span>** names = (<span class="type">char</span>**)<span class="built_in">calloc</span>(<span class="built_in">sizeof</span>(<span class="type">char</span>*), paramcount);</span><br><span class="line">                                <span class="built_in">printf</span>(<span class="string">&quot;\t\t\t\t%s &quot;</span>,returntypename);</span><br><span class="line">                                cout &lt;&lt;  sName &lt;&lt; <span class="string">&quot;(&quot;</span>;</span><br><span class="line">                                <span class="comment">//printf(&quot;\t\t\t\tnames:%p\n&quot;, names);</span></span><br><span class="line">                                <span class="built_in">mono_method_get_param_names</span>(method, (<span class="type">const</span> <span class="type">char</span>**)names);</span><br><span class="line">                                <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;  paramcount; j++) &#123; </span><br><span class="line">                                    gpointer ITER = <span class="literal">NULL</span>;</span><br><span class="line">                                    MonoType* paramtype;</span><br><span class="line">                                    </span><br><span class="line">                                    paramtype = <span class="built_in">mono_signature_get_params</span>((MonoMethodSignature*)methodsignature, &amp;ITER);</span><br><span class="line">                                    <span class="keyword">if</span> (paramtype) &#123;</span><br><span class="line">                                        <span class="type">void</span>* type = <span class="built_in">mono_class_from_mono_type</span>(paramtype);</span><br><span class="line">                                        <span class="type">char</span>* TypeName;</span><br><span class="line">                                        TypeName = <span class="built_in">mono_class_get_name</span>(type);</span><br><span class="line">                                        <span class="built_in">printf</span>(<span class="string">&quot;%s &quot;</span>, TypeName);</span><br><span class="line">                                        <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, names[j]);<span class="comment">//出错点2</span></span><br><span class="line">                                        <span class="keyword">if</span> (j != paramcount - <span class="number">1</span>) &#123;</span><br><span class="line">                                            <span class="built_in">putchar</span>(<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">                                        &#125;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                    </span><br><span class="line">                                &#125;</span><br><span class="line"></span><br><span class="line">                                cout &lt;&lt; <span class="string">&quot;);&quot;</span>&lt;&lt;endl;</span><br><span class="line">                                </span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">while</span> (method);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="dump结果"><a href="#dump结果" class="headerlink" title="dump结果"></a>dump结果</h3><img src="/2023/01/21/Game3/3.png" class="">

<h2 id="END"><a href="#END" class="headerlink" title="END"></a>END</h2><p>感谢 Q 师傅给我的方向上很大的一个建议，那第一就是学东西不能求多，得求精。</p>
<p>所以目标上就先放一放别的，专注游戏安全，以及基础的巩固，<code>windows</code>，<code>C</code>，<code>OS</code> 这些基础确实还是差了很多，所以有时间可以去多学学这些。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://xia0ji233.github.io">xia0ji233</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://xia0ji233.github.io/2023/01/21/Game3/">https://xia0ji233.github.io/2023/01/21/Game3/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://xia0ji233.github.io" target="_blank">xia0ji233's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/avatar.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/01/23/CSAPP_7/" title="CS:APP第七章学习"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">CS:APP第七章学习</div></div></a></div><div class="next-post pull-right"><a href="/2023/01/19/CSAPP_6/" title="CS:APP第六章学习"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">CS:APP第六章学习</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><a href="/"> <div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div></a><div class="author-info__name">xia0ji233</div><div class="author-info__description">Nepnep team</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">283</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">24</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">170</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xia0ji233"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/xia0ji233" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:xia0ji233@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">老当益壮，宁移白首之心？穷且益坚，不坠青云之志。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Unity%E5%BC%95%E6%93%8E"><span class="toc-number">1.</span> <span class="toc-text">Unity引擎</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dump-mono-%E5%B9%B3%E5%8F%B0%E7%9A%84%E7%AC%A6%E5%8F%B7"><span class="toc-number">2.</span> <span class="toc-text">dump mono 平台的符号</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#dump%E5%87%86%E5%A4%87"><span class="toc-number">2.1.</span> <span class="toc-text">dump准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dllmain%E4%BB%A3%E7%A0%81"><span class="toc-number">2.2.</span> <span class="toc-text">dllmain代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dump%E7%BB%93%E6%9E%9C"><span class="toc-number">2.3.</span> <span class="toc-text">dump结果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#END"><span class="toc-number">3.</span> <span class="toc-text">END</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/31/Summary2024/" title="2024年终总结">2024年终总结</a><time datetime="2024-12-31T11:00:00.000Z" title="发表于 2024-12-31 19:00:00">2024-12-31</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/11/qwb2024_final_reverse/" title="强网杯S8决赛Reverse writeup">强网杯S8决赛Reverse writeup</a><time datetime="2024-12-11T05:00:00.000Z" title="发表于 2024-12-11 13:00:00">2024-12-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/08/qwb2024_final/" title="强网杯S8决赛pwn writeup">强网杯S8决赛pwn writeup</a><time datetime="2024-12-07T17:00:00.000Z" title="发表于 2024-12-08 01:00:00">2024-12-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/11/24/WindowsDriver1/" title="windows驱动开发（1）——Windows驱动字符串">windows驱动开发（1）——Windows驱动字符串</a><time datetime="2024-11-24T15:00:00.000Z" title="发表于 2024-11-24 23:00:00">2024-11-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/11/23/WindowsDriver0/" title="windows驱动开发（0）——Windows驱动开发的基础知识">windows驱动开发（0）——Windows驱动开发的基础知识</a><time datetime="2024-11-22T19:00:00.000Z" title="发表于 2024-11-23 03:00:00">2024-11-23</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2025 By xia0ji233</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">welcome to my blog</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>